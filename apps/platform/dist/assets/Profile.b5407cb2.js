var Gn=Object.defineProperty;var _n=(l,e,t)=>e in l?Gn(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var vt=(l,e,t)=>(_n(l,typeof e!="symbol"?e+"":e,t),t);import{a as A,ad as en,j as q,T as tt,w as jn,r as ke,b as se,W as Ot,ao as Me,F as Ut,bm as Kn,bn as Zn,bo as Jn,L as ne,ah as zt,ak as er,ai as Je,bp as tr,m as tn,I as ir,au as nr,av as rr,aV as Li,bq as sr,aj as Gt,n as _t,al as ar}from"./index.ec2996a9.js";import{u as De,P as lr,C as Pi,S as Ve,a as Vt,r as or,c as hr,b as dr,d as ur,e as cr,f as gr}from"./urls.4a718162.js";import{D as fr}from"./Description.b8e792eb.js";import{d as nn,T as ui,M as mr,D as pr,P as rn,a as vr}from"./TableDrawer.dc5a9538.js";import{M as br}from"./TablePagination.6ed57057.js";import{D as ci}from"./DataTable.ed138147.js";import{a as Sr,B as yr}from"./Body.34aa58e8.js";import{u as wr}from"./useBatchDownloader.27945310.js";import"./ErrorBoundary.830e98b1.js";import"./CardContent.9d8c6621.js";import"./LinearProgress.9b082d1f.js";import"./graphiql.min.35449f36.js";import"./ToolbarSelect.cd37b9c4.js";import"./FormGroup.c3f2d311.js";import"./FormControlLabel.47f62ae2.js";function Pe({title:l,loading:e,children:t}){return e?A(en,{}):!t||Array.isArray(t)&&t.length===0?null:q(tt,{variant:"subtitle2",children:[l,":"," ",A(tt,{display:"inline",variant:"body2",children:t})]})}class Re{static round(e,t){return t=t||1,Number(Math.round(e+"e"+t)+"e-"+t)}static meanAngle(e){let t=0,i=0;for(var n=0;n<e.length;n++)t+=Math.sin(e[n]),i+=Math.cos(e[n]);return Math.atan2(t/e.length,i/e.length)}static innerAngle(e){return Re.toRad((e-2)*180/e)}static polyCircumradius(e,t){return e/(2*Math.sin(Math.PI/t))}static apothem(e,t){return e*Math.cos(Math.PI/t)}static apothemFromSideLength(e,t){let i=Re.polyCircumradius(e,t);return Re.apothem(i,t)}static centralAngle(e){return Re.toRad(360/e)}static toDeg(e){return e*Re.degFactor}static toRad(e){return e*Re.radFactor}static parityOfPermutation(e){let t=new Uint8Array(e.length),i=0,n=function(a,r=0){return t[a]===1?r:(r++,t[a]=1,n(e[a],r))};for(var s=0;s<e.length;s++){if(t[s]===1)continue;let a=n(s);i+=1-a%2}return i%2?-1:1}static get radFactor(){return Math.PI/180}static get degFactor(){return 180/Math.PI}static get twoPI(){return 2*Math.PI}}var Wt=Re;class It{static clone(e){let t=Array.isArray(e)?Array():{};for(let i in e){let n=e[i];typeof n.clone=="function"?t[i]=n.clone():t[i]=typeof n=="object"?It.clone(n):n}return t}static equals(e,t){if(e.length!==t.length)return!1;let i=e.slice().sort(),n=t.slice().sort();for(var s=0;s<i.length;s++)if(i[s]!==n[s])return!1;return!0}static print(e){if(e.length==0)return"";let t="(";for(let i=0;i<e.length;i++)t+=e[i].id?e[i].id+", ":e[i]+", ";return t=t.substring(0,t.length-2),t+")"}static each(e,t){for(let i=0;i<e.length;i++)t(e[i])}static get(e,t,i){for(let n=0;n<e.length;n++)if(e[n][t]==i)return e[n]}static contains(e,t){if(!t.property&&!t.func){for(let i=0;i<e.length;i++)if(e[i]==t.value)return!0}else if(t.func){for(let i=0;i<e.length;i++)if(t.func(e[i]))return!0}else for(let i=0;i<e.length;i++)if(e[i][t.property]==t.value)return!0;return!1}static intersection(e,t){let i=new Array;for(let n=0;n<e.length;n++)for(let s=0;s<t.length;s++)e[n]===t[s]&&i.push(e[n]);return i}static unique(e){let t={};return e.filter(function(i){return t[i]!==void 0?!1:t[i]=!0})}static count(e,t){let i=0;for(let n=0;n<e.length;n++)e[n]===t&&i++;return i}static toggle(e,t){let i=Array(),n=!1;for(let s=0;s<e.length;s++)e[s]!==t?i.push(e[s]):n=!0;return n||i.push(t),i}static remove(e,t){let i=Array();for(let n=0;n<e.length;n++)e[n]!==t&&i.push(e[n]);return i}static removeUnique(e,t){let i=e.indexOf(t);return i>-1&&e.splice(i,1),e}static removeAll(e,t){return e.filter(function(i){return t.indexOf(i)===-1})}static merge(e,t){let i=new Array(e.length+t.length);for(let n=0;n<e.length;n++)i[n]=e[n];for(let n=0;n<t.length;n++)i[e.length+n]=t[n];return i}static containsAll(e,t){let i=0;for(let n=0;n<e.length;n++)for(let s=0;s<t.length;s++)e[n]===t[s]&&i++;return i===t.length}static sortByAtomicNumberDesc(e){let t=e.map(function(i,n){return{index:n,value:i.atomicNumber.split(".").map(Number)}});return t.sort(function(i,n){let s=Math.min(n.value.length,i.value.length),a=0;for(;a<s&&n.value[a]===i.value[a];)a++;return a===s?n.value.length-i.value.length:n.value[a]-i.value[a]}),t.map(function(i){return e[i.index]})}static deepCopy(e){let t=Array();for(let i=0;i<e.length;i++){let n=e[i];n instanceof Array?t[i]=It.deepCopy(n):t[i]=n}return t}}var st=It;class W{constructor(e,t){arguments.length==0?(this.x=0,this.y=0):arguments.length==1?(this.x=e.x,this.y=e.y):(this.x=e,this.y=t)}clone(){return new W(this.x,this.y)}toString(){return"("+this.x+","+this.y+")"}add(e){return this.x+=e.x,this.y+=e.y,this}subtract(e){return this.x-=e.x,this.y-=e.y,this}divide(e){return this.x/=e,this.y/=e,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}invert(){return this.x=-this.x,this.y=-this.y,this}angle(){return Math.atan2(this.y,this.x)}distance(e){return Math.sqrt((e.x-this.x)*(e.x-this.x)+(e.y-this.y)*(e.y-this.y))}distanceSq(e){return(e.x-this.x)*(e.x-this.x)+(e.y-this.y)*(e.y-this.y)}clockwise(e){let t=this.y*e.x,i=this.x*e.y;return t>i?-1:t===i?0:1}relativeClockwise(e,t){let i=(this.y-e.y)*(t.x-e.x),n=(this.x-e.x)*(t.y-e.y);return i>n?-1:i===n?0:1}rotate(e){let t=new W(0,0),i=Math.cos(e),n=Math.sin(e);return t.x=this.x*i-this.y*n,t.y=this.x*n+this.y*i,this.x=t.x,this.y=t.y,this}rotateAround(e,t){let i=Math.sin(e),n=Math.cos(e);this.x-=t.x,this.y-=t.y;let s=this.x*n-this.y*i,a=this.x*i+this.y*n;return this.x=s+t.x,this.y=a+t.y,this}rotateTo(e,t,i=0){this.x+=.001,this.y-=.001;let n=W.subtract(this,t),s=W.subtract(e,t),a=W.angle(s,n);return this.rotateAround(a+i,t),this}rotateAwayFrom(e,t,i){this.rotateAround(i,t);let n=this.distanceSq(e);this.rotateAround(-2*i,t),this.distanceSq(e)<n&&this.rotateAround(2*i,t)}getRotateAwayFromAngle(e,t,i){let n=this.clone();n.rotateAround(i,t);let s=n.distanceSq(e);return n.rotateAround(-2*i,t),n.distanceSq(e)<s?i:-i}getRotateTowardsAngle(e,t,i){let n=this.clone();n.rotateAround(i,t);let s=n.distanceSq(e);return n.rotateAround(-2*i,t),n.distanceSq(e)>s?i:-i}getRotateToAngle(e,t){let i=W.subtract(this,t),n=W.subtract(e,t),s=W.angle(n,i);return Number.isNaN(s)?0:s}isInPolygon(e){let t=!1;for(let i=0,n=e.length-1;i<e.length;n=i++)e[i].y>this.y!=e[n].y>this.y&&this.x<(e[n].x-e[i].x)*(this.y-e[i].y)/(e[n].y-e[i].y)+e[i].x&&(t=!t);return t}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}lengthSq(){return this.x*this.x+this.y*this.y}normalize(){return this.divide(this.length()),this}normalized(){return W.divideScalar(this,this.length())}whichSide(e,t){return(this.x-e.x)*(t.y-e.y)-(this.y-e.y)*(t.x-e.x)}sameSideAs(e,t,i){let n=this.whichSide(e,t),s=i.whichSide(e,t);return n<0&&s<0||n==0&&s==0||n>0&&s>0}static add(e,t){return new W(e.x+t.x,e.y+t.y)}static subtract(e,t){return new W(e.x-t.x,e.y-t.y)}static multiply(e,t){return new W(e.x*t.x,e.y*t.y)}static multiplyScalar(e,t){return new W(e.x,e.y).multiplyScalar(t)}static midpoint(e,t){return new W((e.x+t.x)/2,(e.y+t.y)/2)}static normals(e,t){let i=W.subtract(t,e);return[new W(-i.y,i.x),new W(i.y,-i.x)]}static units(e,t){let i=W.subtract(t,e);return[new W(-i.y,i.x).normalize(),new W(i.y,-i.x).normalize()]}static divide(e,t){return new W(e.x/t.x,e.y/t.y)}static divideScalar(e,t){return new W(e.x/t,e.y/t)}static dot(e,t){return e.x*t.x+e.y*t.y}static angle(e,t){let i=W.dot(e,t);return Math.acos(i/(e.length()*t.length()))}static threePointangle(e,t,i){let n=W.subtract(t,e),s=W.subtract(i,t),a=e.distance(t),r=t.distance(i);return Math.acos(W.dot(n,s)/(a*r))}static scalarProjection(e,t){let i=t.normalized();return W.dot(e,i)}static averageDirection(e){let t=new W(0,0);for(var i=0;i<e.length;i++){let n=e[i];t.add(n)}return t.normalize()}}var Ee=W;const Be=Ee;class gi{constructor(e=new Be(0,0),t=new Be(0,0),i=null,n=null,s=!1,a=!1){this.from=e,this.to=t,this.elementFrom=i,this.elementTo=n,this.chiralFrom=s,this.chiralTo=a}clone(){return new gi(this.from.clone(),this.to.clone(),this.elementFrom,this.elementTo)}getLength(){return Math.sqrt(Math.pow(this.to.x-this.from.x,2)+Math.pow(this.to.y-this.from.y,2))}getAngle(){return Be.subtract(this.getRightVector(),this.getLeftVector()).angle()}getRightVector(){return this.from.x<this.to.x?this.to:this.from}getLeftVector(){return this.from.x<this.to.x?this.from:this.to}getRightElement(){return this.from.x<this.to.x?this.elementTo:this.elementFrom}getLeftElement(){return this.from.x<this.to.x?this.elementFrom:this.elementTo}getRightChiral(){return this.from.x<this.to.x?this.chiralTo:this.chiralFrom}getLeftChiral(){return this.from.x<this.to.x?this.chiralFrom:this.chiralTo}setRightVector(e,t){return this.from.x<this.to.x?(this.to.x=e,this.to.y=t):(this.from.x=e,this.from.y=t),this}setLeftVector(e,t){return this.from.x<this.to.x?(this.from.x=e,this.from.y=t):(this.to.x=e,this.to.y=t),this}rotateToXAxis(){let e=this.getLeftVector();return this.setRightVector(e.x+this.getLength(),e.y),this}rotate(e){let t=this.getLeftVector(),i=this.getRightVector(),n=Math.sin(e),s=Math.cos(e),a=s*(i.x-t.x)-n*(i.y-t.y)+t.x,r=n*(i.x-t.x)-s*(i.y-t.y)+t.y;return this.setRightVector(a,r),this}shortenFrom(e){let t=Be.subtract(this.to,this.from);return t.normalize(),t.multiplyScalar(e),this.from.add(t),this}shortenTo(e){let t=Be.subtract(this.from,this.to);return t.normalize(),t.multiplyScalar(e),this.to.add(t),this}shortenRight(e){return this.from.x<this.to.x?this.shortenTo(e):this.shortenFrom(e),this}shortenLeft(e){return this.from.x<this.to.x?this.shortenFrom(e):this.shortenTo(e),this}shorten(e){let t=Be.subtract(this.from,this.to);return t.normalize(),t.multiplyScalar(e/2),this.to.add(t),this.from.subtract(t),this}}var fi=gi;class kr{constructor(e,t){this.id=null,this.firstRingId=e.id,this.secondRingId=t.id,this.vertices=new Set;for(var i=0;i<e.members.length;i++){let n=e.members[i];for(let s=0;s<t.members.length;s++){let a=t.members[s];n===a&&this.addVertex(n)}}}addVertex(e){this.vertices.add(e)}updateOther(e,t){this.firstRingId===t?this.secondRingId=e:this.firstRingId=e}containsRing(e){return this.firstRingId===e||this.secondRingId===e}isBridge(e){if(this.vertices.size>2)return!0;for(let t of this.vertices)if(e[t].value.rings.length>2)return!0;return!1}static isBridge(e,t,i,n){let s=null;for(let a=0;a<e.length;a++)if(s=e[a],s.firstRingId===i&&s.secondRingId===n||s.firstRingId===n&&s.secondRingId===i)return s.isBridge(t);return!1}static getNeighbours(e,t){let i=[];for(let n=0;n<e.length;n++){let s=e[n];s.firstRingId===t?i.push(s.secondRingId):s.secondRingId===t&&i.push(s.firstRingId)}return i}static getVertices(e,t,i){for(let n=0;n<e.length;n++){let s=e[n];if(s.firstRingId===t&&s.secondRingId===i||s.firstRingId===i&&s.secondRingId===t)return[...s.vertices]}}}var sn=kr;const jt=st,Cr=Ee,Ar=sn;class mi{constructor(e){this.id=null,this.members=e,this.edges=[],this.insiders=[],this.neighbours=[],this.positioned=!1,this.center=new Cr(0,0),this.rings=[],this.isBridged=!1,this.isPartOfBridged=!1,this.isSpiro=!1,this.isFused=!1,this.centralAngle=0,this.canFlip=!0}clone(){let e=new mi(this.members);return e.id=this.id,e.insiders=jt.clone(this.insiders),e.neighbours=jt.clone(this.neighbours),e.positioned=this.positioned,e.center=this.center.clone(),e.rings=jt.clone(this.rings),e.isBridged=this.isBridged,e.isPartOfBridged=this.isPartOfBridged,e.isSpiro=this.isSpiro,e.isFused=this.isFused,e.centralAngle=this.centralAngle,e.canFlip=this.canFlip,e}getSize(){return this.members.length}getPolygon(e){let t=[];for(let i=0;i<this.members.length;i++)t.push(e[this.members[i]].position);return t}getAngle(){return Math.PI-this.centralAngle}eachMember(e,t,i,n){i=i||i===0?i:this.members[0];let s=i,a=0;for(;s!=null&&a<100;){let r=s;t(r),s=e[s].getNextInRing(e,this.id,n),n=r,s==i&&(s=null),a++}}getOrderedNeighbours(e){let t=Array(this.neighbours.length);for(let i=0;i<this.neighbours.length;i++){let n=Ar.getVertices(e,this.id,this.neighbours[i]);t[i]={n:n.length,neighbour:this.neighbours[i]}}return t.sort(function(i,n){return n.n-i.n}),t}isBenzeneLike(e){let t=this.getDoubleBondCount(e),i=this.members.length;return t===3&&i===6||t===2&&i===5}getDoubleBondCount(e){let t=0;for(let i=0;i<this.members.length;i++){let n=e[this.members[i]].value;(n.bondType==="="||n.branchBond==="=")&&t++}return t}contains(e){for(let t=0;t<this.members.length;t++)if(this.members[t]==e)return!0;return!1}}var Nr=mi;const xr=st;class Mt{constructor(e,t="-"){this.element=e.length===1?e.toUpperCase():e,this.drawExplicit=!1,this.ringbonds=Array(),this.rings=Array(),this.bondType=t,this.branchBond=null,this.isBridge=!1,this.isBridgeNode=!1,this.originalRings=Array(),this.bridgedRing=null,this.anchoredRings=Array(),this.bracket=null,this.plane=0,this.attachedPseudoElements={},this.hasAttachedPseudoElements=!1,this.isDrawn=!0,this.isConnectedToRing=!1,this.neighbouringElements=Array(),this.isPartOfAromaticRing=e!==this.element,this.bondCount=0,this.chirality="",this.isStereoCenter=!1,this.priority=0,this.mainChain=!1,this.hydrogenDirection="down",this.subtreeDepth=1,this.hasHydrogen=!1}addNeighbouringElement(e){this.neighbouringElements.push(e)}attachPseudoElement(e,t,i=0,n=0){i===null&&(i=0),n===null&&(n=0);let s=i+e+n;this.attachedPseudoElements[s]?this.attachedPseudoElements[s].count+=1:this.attachedPseudoElements[s]={element:e,count:1,hydrogenCount:i,previousElement:t,charge:n},this.hasAttachedPseudoElements=!0}getAttachedPseudoElements(){let e={},t=this;return Object.keys(this.attachedPseudoElements).sort().forEach(function(i){e[i]=t.attachedPseudoElements[i]}),e}getAttachedPseudoElementsCount(){return Object.keys(this.attachedPseudoElements).length}isHeteroAtom(){return this.element!=="C"&&this.element!=="H"}addAnchoredRing(e){xr.contains(this.anchoredRings,{value:e})||this.anchoredRings.push(e)}getRingbondCount(){return this.ringbonds.length}backupRings(){this.originalRings=Array(this.rings.length);for(let e=0;e<this.rings.length;e++)this.originalRings[e]=this.rings[e]}restoreRings(){this.rings=Array(this.originalRings.length);for(let e=0;e<this.originalRings.length;e++)this.rings[e]=this.originalRings[e]}haveCommonRingbond(e,t){for(let i=0;i<e.ringbonds.length;i++)for(let n=0;n<t.ringbonds.length;n++)if(e.ringbonds[i].id==t.ringbonds[n].id)return!0;return!1}neighbouringElementsEqual(e){if(e.length!==this.neighbouringElements.length)return!1;e.sort(),this.neighbouringElements.sort();for(var t=0;t<this.neighbouringElements.length;t++)if(e[t]!==this.neighbouringElements[t])return!1;return!0}getAtomicNumber(){return Mt.atomicNumbers[this.element]}getMaxBonds(){return Mt.maxBonds[this.element]}static get maxBonds(){return{H:1,C:4,N:3,O:2,P:3,S:2,B:3,F:1,I:1,Cl:1,Br:1}}static get atomicNumbers(){return{H:1,He:2,Li:3,Be:4,B:5,b:5,C:6,c:6,N:7,n:7,O:8,o:8,F:9,Ne:10,Na:11,Mg:12,Al:13,Si:14,P:15,p:15,S:16,s:16,Cl:17,Ar:18,K:19,Ca:20,Sc:21,Ti:22,V:23,Cr:24,Mn:25,Fe:26,Co:27,Ni:28,Cu:29,Zn:30,Ga:31,Ge:32,As:33,Se:34,Br:35,Kr:36,Rb:37,Sr:38,Y:39,Zr:40,Nb:41,Mo:42,Tc:43,Ru:44,Rh:45,Pd:46,Ag:47,Cd:48,In:49,Sn:50,Sb:51,Te:52,I:53,Xe:54,Cs:55,Ba:56,La:57,Ce:58,Pr:59,Nd:60,Pm:61,Sm:62,Eu:63,Gd:64,Tb:65,Dy:66,Ho:67,Er:68,Tm:69,Yb:70,Lu:71,Hf:72,Ta:73,W:74,Re:75,Os:76,Ir:77,Pt:78,Au:79,Hg:80,Tl:81,Pb:82,Bi:83,Po:84,At:85,Rn:86,Fr:87,Ra:88,Ac:89,Th:90,Pa:91,U:92,Np:93,Pu:94,Am:95,Cm:96,Bk:97,Cf:98,Es:99,Fm:100,Md:101,No:102,Lr:103,Rf:104,Db:105,Sg:106,Bh:107,Hs:108,Mt:109,Ds:110,Rg:111,Cn:112,Uut:113,Uuq:114,Uup:115,Uuh:116,Uus:117,Uuo:118}}static get mass(){return{H:1,He:2,Li:3,Be:4,B:5,b:5,C:6,c:6,N:7,n:7,O:8,o:8,F:9,Ne:10,Na:11,Mg:12,Al:13,Si:14,P:15,p:15,S:16,s:16,Cl:17,Ar:18,K:19,Ca:20,Sc:21,Ti:22,V:23,Cr:24,Mn:25,Fe:26,Co:27,Ni:28,Cu:29,Zn:30,Ga:31,Ge:32,As:33,Se:34,Br:35,Kr:36,Rb:37,Sr:38,Y:39,Zr:40,Nb:41,Mo:42,Tc:43,Ru:44,Rh:45,Pd:46,Ag:47,Cd:48,In:49,Sn:50,Sb:51,Te:52,I:53,Xe:54,Cs:55,Ba:56,La:57,Ce:58,Pr:59,Nd:60,Pm:61,Sm:62,Eu:63,Gd:64,Tb:65,Dy:66,Ho:67,Er:68,Tm:69,Yb:70,Lu:71,Hf:72,Ta:73,W:74,Re:75,Os:76,Ir:77,Pt:78,Au:79,Hg:80,Tl:81,Pb:82,Bi:83,Po:84,At:85,Rn:86,Fr:87,Ra:88,Ac:89,Th:90,Pa:91,U:92,Np:93,Pu:94,Am:95,Cm:96,Bk:97,Cf:98,Es:99,Fm:100,Md:101,No:102,Lr:103,Rf:104,Db:105,Sg:106,Bh:107,Hs:108,Mt:109,Ds:110,Rg:111,Cn:112,Uut:113,Uuq:114,Uup:115,Uuh:116,Uus:117,Uuo:118}}}var pi=Mt;const Bi=Wt,bt=st,et=Ee;class vi{constructor(e,t=0,i=0){this.id=null,this.value=e,this.position=new et(t||0,i||0),this.previousPosition=new et(0,0),this.parentVertexId=null,this.children=Array(),this.spanningTreeChildren=Array(),this.edges=Array(),this.positioned=!1,this.angle=null,this.dir=1,this.neighbourCount=0,this.neighbours=Array(),this.neighbouringElements=Array(),this.forcePositioned=!1}setPosition(e,t){this.position.x=e,this.position.y=t}setPositionFromVector(e){this.position.x=e.x,this.position.y=e.y}addChild(e){this.children.push(e),this.neighbours.push(e),this.neighbourCount++}addRingbondChild(e,t){if(this.children.push(e),this.value.bracket){let i=1;this.id===0&&this.value.bracket.hcount===0&&(i=0),this.value.bracket.hcount===1&&t===0&&(i=2),this.value.bracket.hcount===1&&t===1&&(this.neighbours.length<3?i=2:i=3),this.value.bracket.hcount===null&&t===0&&(i=1),this.value.bracket.hcount===null&&t===1&&(this.neighbours.length<3?i=1:i=2),this.neighbours.splice(i,0,e)}else this.neighbours.push(e);this.neighbourCount++}setParentVertexId(e){this.neighbourCount++,this.parentVertexId=e,this.neighbours.push(e)}isTerminal(){return this.value.hasAttachedPseudoElements?!0:this.parentVertexId===null&&this.children.length<2||this.children.length===0}clone(){let e=new vi(this.value,this.position.x,this.position.y);return e.id=this.id,e.previousPosition=new et(this.previousPosition.x,this.previousPosition.y),e.parentVertexId=this.parentVertexId,e.children=bt.clone(this.children),e.spanningTreeChildren=bt.clone(this.spanningTreeChildren),e.edges=bt.clone(this.edges),e.positioned=this.positioned,e.angle=this.angle,e.forcePositioned=this.forcePositioned,e}equals(e){return this.id===e.id}getAngle(e=null,t=!1){let i=null;return e?i=et.subtract(this.position,e):i=et.subtract(this.position,this.previousPosition),t?Bi.toDeg(i.angle()):i.angle()}getTextDirection(e){let t=this.getDrawnNeighbours(e),i=Array();for(let a=0;a<t.length;a++)i.push(this.getAngle(e[t[a]].position));let n=Bi.meanAngle(i),s=Math.PI/2;return n=Math.round(Math.round(n/s)*s),n===2?"down":n===-2?"up":n===0||n===-0?"right":n===3||n===-3?"left":"down"}getNeighbours(e=null){if(e===null)return this.neighbours.slice();let t=Array();for(let i=0;i<this.neighbours.length;i++)this.neighbours[i]!==e&&t.push(this.neighbours[i]);return t}getDrawnNeighbours(e){let t=Array();for(let i=0;i<this.neighbours.length;i++)e[this.neighbours[i]].value.isDrawn&&t.push(this.neighbours[i]);return t}getNeighbourCount(){return this.neighbourCount}getSpanningTreeNeighbours(e=null){let t=Array();for(let i=0;i<this.spanningTreeChildren.length;i++)(e===void 0||e!=this.spanningTreeChildren[i])&&t.push(this.spanningTreeChildren[i]);return this.parentVertexId!=null&&(e===void 0||e!=this.parentVertexId)&&t.push(this.parentVertexId),t}getNextInRing(e,t,i){let n=this.getNeighbours();for(let s=0;s<n.length;s++)if(bt.contains(e[n[s]].value.rings,{value:t})&&n[s]!=i)return n[s];return null}}var Rr=vi;class bi{constructor(e,t,i=1){this.id=null,this.sourceId=e,this.targetId=t,this.weight=i,this.bondType="-",this.isPartOfAromaticRing=!1,this.center=!1,this.wedge=""}setBondType(e){this.bondType=e,this.weight=bi.bonds[e]}static get bonds(){return{"-":1,"/":1,"\\":1,"=":2,"#":3,$:4}}}var an=bi;function Dr(l){return console.log("in the utility version of getChargeText"),l===1?"+":l===2?"2+":l===-1?"-":l===-2?"2-":""}var ln={getChargeText:Dr};const Oe=Wt,ee=Ee,{getChargeText:Oi}=ln;class Tr{constructor(e,t,i){typeof e=="string"||e instanceof String?this.canvas=document.getElementById(e):this.canvas=e,this.ctx=this.canvas.getContext("2d"),this.themeManager=t,this.opts=i,this.drawingWidth=0,this.drawingHeight=0,this.offsetX=0,this.offsetY=0,this.fontLarge=this.opts.fontSizeLarge+"pt Helvetica, Arial, sans-serif",this.fontSmall=this.opts.fontSizeSmall+"pt Helvetica, Arial, sans-serif",this.updateSize(this.opts.width,this.opts.height),this.ctx.font=this.fontLarge,this.hydrogenWidth=this.ctx.measureText("H").width,this.halfHydrogenWidth=this.hydrogenWidth/2,this.halfBondThickness=this.opts.bondThickness/2}updateSize(e,t){this.devicePixelRatio=window.devicePixelRatio||1,this.backingStoreRatio=this.ctx.webkitBackingStorePixelRatio||this.ctx.mozBackingStorePixelRatio||this.ctx.msBackingStorePixelRatio||this.ctx.oBackingStorePixelRatio||this.ctx.backingStorePixelRatio||1,this.ratio=this.devicePixelRatio/this.backingStoreRatio,this.ratio!==1?(this.canvas.width=e*this.ratio,this.canvas.height=t*this.ratio,this.canvas.style.width=e+"px",this.canvas.style.height=t+"px",this.ctx.setTransform(this.ratio,0,0,this.ratio,0,0)):(this.canvas.width=e*this.ratio,this.canvas.height=t*this.ratio)}setTheme(e){this.colors=e}scale(e){let t=-Number.MAX_VALUE,i=-Number.MAX_VALUE,n=Number.MAX_VALUE,s=Number.MAX_VALUE;for(var a=0;a<e.length;a++){if(!e[a].value.isDrawn)continue;let c=e[a].position;t<c.x&&(t=c.x),i<c.y&&(i=c.y),n>c.x&&(n=c.x),s>c.y&&(s=c.y)}var r=this.opts.padding;t+=r,i+=r,n-=r,s-=r,this.drawingWidth=t-n,this.drawingHeight=i-s;var h=this.canvas.offsetWidth/this.drawingWidth,o=this.canvas.offsetHeight/this.drawingHeight,d=h<o?h:o;this.ctx.scale(d,d),this.offsetX=-n,this.offsetY=-s,h<o?this.offsetY+=this.canvas.offsetHeight/(2*d)-this.drawingHeight/2:this.offsetX+=this.canvas.offsetWidth/(2*d)-this.drawingWidth/2}reset(){this.ctx.setTransform(1,0,0,1,0,0)}getColor(e){return e=e.toUpperCase(),e in this.colors?this.colors[e]:this.colors.C}drawCircle(e,t,i,n,s=!0,a=!1,r=""){let h=this.ctx,o=this.offsetX,d=this.offsetY;h.save(),h.lineWidth=1.5,h.beginPath(),h.arc(e+o,t+d,i,0,Oe.twoPI,!0),h.closePath(),a?(s?(h.fillStyle="#f00",h.fill()):(h.strokeStyle="#f00",h.stroke()),this.drawDebugText(e,t,r)):s?(h.fillStyle=n,h.fill()):(h.strokeStyle=n,h.stroke()),h.restore()}drawLine(e,t=!1,i=1){let n=this.ctx,s=this.offsetX,a=this.offsetY,r=e.clone().shorten(4),h=r.getLeftVector().clone(),o=r.getRightVector().clone();h.x+=s,h.y+=a,o.x+=s,o.y+=a,t||(n.save(),n.globalCompositeOperation="destination-out",n.beginPath(),n.moveTo(h.x,h.y),n.lineTo(o.x,o.y),n.lineCap="round",n.lineWidth=this.opts.bondThickness+1.2,n.strokeStyle=this.themeManager.getColor("BACKGROUND"),n.stroke(),n.globalCompositeOperation="source-over",n.restore()),h=e.getLeftVector().clone(),o=e.getRightVector().clone(),h.x+=s,h.y+=a,o.x+=s,o.y+=a,n.save(),n.beginPath(),n.moveTo(h.x,h.y),n.lineTo(o.x,o.y),n.lineCap="round",n.lineWidth=this.opts.bondThickness;let d=this.ctx.createLinearGradient(h.x,h.y,o.x,o.y);d.addColorStop(.4,this.themeManager.getColor(e.getLeftElement())||this.themeManager.getColor("C")),d.addColorStop(.6,this.themeManager.getColor(e.getRightElement())||this.themeManager.getColor("C")),t&&(n.setLineDash([1,1.5]),n.lineWidth=this.opts.bondThickness/1.5),i<1&&(n.globalAlpha=i),n.strokeStyle=d,n.stroke(),n.restore()}drawWedge(e,t=1){if(isNaN(e.from.x)||isNaN(e.from.y)||isNaN(e.to.x)||isNaN(e.to.y))return;let i=this.ctx,n=this.offsetX,s=this.offsetY,a=e.clone().shorten(5),r=a.getLeftVector().clone(),h=a.getRightVector().clone();r.x+=n,r.y+=s,h.x+=n,h.y+=s,r=e.getLeftVector().clone(),h=e.getRightVector().clone(),r.x+=n,r.y+=s,h.x+=n,h.y+=s,i.save();let o=ee.normals(r,h);o[0].normalize(),o[1].normalize();let d=e.getRightChiral(),c=r,u=h;d&&(c=h,u=r);let m=ee.add(c,ee.multiplyScalar(o[0],this.halfBondThickness)),S=ee.add(u,ee.multiplyScalar(o[0],1.5+this.halfBondThickness)),p=ee.add(u,ee.multiplyScalar(o[1],1.5+this.halfBondThickness)),w=ee.add(c,ee.multiplyScalar(o[1],this.halfBondThickness));i.beginPath(),i.moveTo(m.x,m.y),i.lineTo(S.x,S.y),i.lineTo(p.x,p.y),i.lineTo(w.x,w.y);let k=this.ctx.createRadialGradient(h.x,h.y,this.opts.bondLength,h.x,h.y,0);k.addColorStop(.4,this.themeManager.getColor(e.getLeftElement())||this.themeManager.getColor("C")),k.addColorStop(.6,this.themeManager.getColor(e.getRightElement())||this.themeManager.getColor("C")),i.fillStyle=k,i.fill(),i.restore()}drawDashedWedge(e){if(isNaN(e.from.x)||isNaN(e.from.y)||isNaN(e.to.x)||isNaN(e.to.y))return;let t=this.ctx,i=this.offsetX,n=this.offsetY,s=e.getLeftVector().clone(),a=e.getRightVector().clone();s.x+=i,s.y+=n,a.x+=i,a.y+=n,t.save();let r=ee.normals(s,a);r[0].normalize(),r[1].normalize();let h=e.getRightChiral(),o,d,c,u,m=e.clone();h?(o=a,d=s,m.shortenRight(1),c=m.getRightVector().clone(),u=m.getLeftVector().clone()):(o=s,d=a,m.shortenLeft(1),c=m.getLeftVector().clone(),u=m.getRightVector().clone()),c.x+=i,c.y+=n,u.x+=i,u.y+=n;let S=ee.subtract(d,o).normalize();t.strokeStyle=this.themeManager.getColor("C"),t.lineCap="round",t.lineWidth=this.opts.bondThickness,t.beginPath();let p=e.getLength(),w=1.25/(p/(this.opts.bondThickness*3)),k=!1;for(var D=0;D<1;D+=w){let x=ee.multiplyScalar(S,D*p),N=ee.add(o,x),B=1.5*D,T=ee.multiplyScalar(r[0],B);!k&&D>.5&&(t.stroke(),t.beginPath(),t.strokeStyle=this.themeManager.getColor(e.getRightElement())||this.themeManager.getColor("C"),k=!0),N.subtract(T),t.moveTo(N.x,N.y),N.add(ee.multiplyScalar(T,2)),t.lineTo(N.x,N.y)}t.stroke(),t.restore()}drawDebugText(e,t,i){let n=this.ctx;n.save(),n.font="5px Droid Sans, sans-serif",n.textAlign="start",n.textBaseline="top",n.fillStyle="#ff0000",n.fillText(i,e+this.offsetX,t+this.offsetY),n.restore()}drawBall(e,t,i){let n=this.ctx;n.save(),n.beginPath(),n.arc(e+this.offsetX,t+this.offsetY,this.opts.bondLength/4.5,0,Oe.twoPI,!1),n.fillStyle=this.themeManager.getColor(i),n.fill(),n.restore()}drawPoint(e,t,i){let n=this.ctx,s=this.offsetX,a=this.offsetY;n.save(),n.globalCompositeOperation="destination-out",n.beginPath(),n.arc(e+s,t+a,1.5,0,Oe.twoPI,!0),n.closePath(),n.fill(),n.globalCompositeOperation="source-over",n.beginPath(),n.arc(e+this.offsetX,t+this.offsetY,.75,0,Oe.twoPI,!1),n.fillStyle=this.themeManager.getColor(i),n.fill(),n.restore()}drawText(e,t,i,n,s,a,r,h,o={}){let d=this.ctx,c=this.offsetX,u=this.offsetY;d.save(),d.textAlign="start",d.textBaseline="alphabetic";let m="",S=0;r&&(m=Oi(r),d.font=this.fontSmall,S=d.measureText(m).width);let p="0",w=0;h>0&&(p=h.toString(),d.font=this.fontSmall,w=d.measureText(p).width),r===1&&i==="N"&&o.hasOwnProperty("0O")&&o.hasOwnProperty("0O-1")&&(o={"0O":{element:"O",count:2,hydrogenCount:0,previousElement:"C",charge:""}},r=0),d.font=this.fontLarge,d.fillStyle=this.themeManager.getColor("BACKGROUND");let k=d.measureText(i);k.totalWidth=k.width+S,k.height=parseInt(this.fontLarge,10);let D=k.width>this.opts.fontSizeLarge?k.width:this.opts.fontSizeLarge;D/=1.5,d.globalCompositeOperation="destination-out",d.beginPath(),d.arc(e+c,t+u,D,0,Oe.twoPI,!0),d.closePath(),d.fill(),d.globalCompositeOperation="source-over";let x=-k.width/2,N=-k.width/2;d.fillStyle=this.themeManager.getColor(i),d.fillText(i,e+c+x,t+this.opts.halfFontSizeLarge+u),x+=k.width,r&&(d.font=this.fontSmall,d.fillText(m,e+c+x,t-this.opts.fifthFontSizeSmall+u),x+=S),h>0&&(d.font=this.fontSmall,d.fillText(p,e+c+N-w,t-this.opts.fifthFontSizeSmall+u),N-=w),d.font=this.fontLarge;let B=0,T=0;if(n===1){let P=e+c,V=t+u+this.opts.halfFontSizeLarge;B=this.hydrogenWidth,N-=B,s==="left"?P+=N:s==="right"||s==="up"&&a||s==="down"&&a?P+=x:s==="up"&&!a?(V-=this.opts.fontSizeLarge+this.opts.quarterFontSizeLarge,P-=this.halfHydrogenWidth):s==="down"&&!a&&(V+=this.opts.fontSizeLarge+this.opts.quarterFontSizeLarge,P-=this.halfHydrogenWidth),d.fillText("H",P,V),x+=B}else if(n>1){let P=e+c,V=t+u+this.opts.halfFontSizeLarge;B=this.hydrogenWidth,d.font=this.fontSmall,T=d.measureText(n).width,N-=B+T,s==="left"?P+=N:s==="right"||s==="up"&&a||s==="down"&&a?P+=x:s==="up"&&!a?(V-=this.opts.fontSizeLarge+this.opts.quarterFontSizeLarge,P-=this.halfHydrogenWidth):s==="down"&&!a&&(V+=this.opts.fontSizeLarge+this.opts.quarterFontSizeLarge,P-=this.halfHydrogenWidth),d.font=this.fontLarge,d.fillText("H",P,V),d.font=this.fontSmall,d.fillText(n,P+this.halfHydrogenWidth+T,V+this.opts.fifthFontSizeSmall),x+=B+this.halfHydrogenWidth+T}for(let P in o){if(!o.hasOwnProperty(P))continue;let V=0,M=0,O=o[P].element,z=o[P].count,I=o[P].hydrogenCount,he=o[P].charge;d.font=this.fontLarge,z>1&&I>0&&(V=d.measureText("(").width,M=d.measureText(")").width);let fe=d.measureText(O).width,de=0,ae="",Ae=0;B=0,I>0&&(B=this.hydrogenWidth),d.font=this.fontSmall,z>1&&(de=d.measureText(z).width),he!==0&&(ae=Oi(he),Ae=d.measureText(ae).width),T=0,I>1&&(T=d.measureText(I).width),d.font=this.fontLarge;let Q=e+c,j=t+u+this.opts.halfFontSizeLarge;d.fillStyle=this.themeManager.getColor(O),z>0&&(N-=de),z>1&&I>0&&(s==="left"?(N-=M,d.fillText(")",Q+N,j)):(d.fillText("(",Q+x,j),x+=V)),s==="left"?(N-=fe,d.fillText(O,Q+N,j)):(d.fillText(O,Q+x,j),x+=fe),I>0&&(s==="left"?(N-=B+T,d.fillText("H",Q+N,j),I>1&&(d.font=this.fontSmall,d.fillText(I,Q+N+B,j+this.opts.fifthFontSizeSmall))):(d.fillText("H",Q+x,j),x+=B,I>1&&(d.font=this.fontSmall,d.fillText(I,Q+x,j+this.opts.fifthFontSizeSmall),x+=T))),d.font=this.fontLarge,z>1&&I>0&&(s==="left"?(N-=V,d.fillText("(",Q+N,j)):(d.fillText(")",Q+x,j),x+=M)),d.font=this.fontSmall,z>1&&(s==="left"?d.fillText(z,Q+N+V+M+B+T+fe,j+this.opts.fifthFontSizeSmall):(d.fillText(z,Q+x,j+this.opts.fifthFontSizeSmall),x+=de)),he!==0&&(s==="left"?d.fillText(ae,Q+N+V+M+B+T+fe,t-this.opts.fifthFontSizeSmall+u):(d.fillText(ae,Q+x,t-this.opts.fifthFontSizeSmall+u),x+=Ae))}d.restore()}getChargeText(e){return e===1?"+":e===2?"2+":e===-1?"-":e===-2?"2-":""}drawDebugPoint(e,t,i="",n="#f00"){this.drawCircle(e,t,2,n,!0,!0,i)}drawAromaticityRing(e){let t=this.ctx,i=Oe.apothemFromSideLength(this.opts.bondLength,e.getSize());t.save(),t.strokeStyle=this.themeManager.getColor("C"),t.lineWidth=this.opts.bondThickness,t.beginPath(),t.arc(e.center.x+this.offsetX,e.center.y+this.offsetY,i-this.opts.bondSpacing,0,Math.PI*2,!0),t.closePath(),t.stroke(),t.restore()}clear(){this.ctx.clearRect(0,0,this.canvas.offsetWidth,this.canvas.offsetHeight)}}var Er=Tr;const Ii=Wt,Fr=Rr,$r=an,Lr=pi;class Ie{constructor(e,t=!1){this.vertices=Array(),this.edges=Array(),this.vertexIdsToEdgeId={},this.isomeric=t,this._time=0,this._init(e)}_init(e,t=0,i=null,n=!1){let s=new Lr(e.atom.element?e.atom.element:e.atom,e.bond);s.branchBond=e.branchBond,s.ringbonds=e.ringbonds,s.bracket=e.atom.element?e.atom:null;let a=new Fr(s),r=this.vertices[i];if(this.addVertex(a),i!==null){a.setParentVertexId(i),a.value.addNeighbouringElement(r.value.element),r.addChild(a.id),r.value.addNeighbouringElement(s.element),r.spanningTreeChildren.push(a.id);let c=new $r(i,a.id,1);n?(c.setBondType(a.value.branchBond||"-"),c.setBondType(a.value.branchBond||"-")):c.setBondType(r.value.bondType||"-"),this.addEdge(c)}let h=e.ringbondCount+1;s.bracket&&(h+=s.bracket.hcount);let o=0;if(s.bracket&&s.bracket.chirality){s.isStereoCenter=!0,o=s.bracket.hcount;for(var d=0;d<o;d++)this._init({atom:"H",isBracket:"false",branches:Array(),branchCount:0,ringbonds:Array(),ringbondCount:!1,next:null,hasNext:!1,bond:"-"},d,a.id,!0)}for(var d=0;d<e.branchCount;d++)this._init(e.branches[d],d+h,a.id,!0);e.hasNext&&this._init(e.next,e.branchCount+h,a.id)}clear(){this.vertices=Array(),this.edges=Array(),this.vertexIdsToEdgeId={}}addVertex(e){return e.id=this.vertices.length,this.vertices.push(e),e.id}addEdge(e){let t=this.vertices[e.sourceId],i=this.vertices[e.targetId];return e.id=this.edges.length,this.edges.push(e),this.vertexIdsToEdgeId[e.sourceId+"_"+e.targetId]=e.id,this.vertexIdsToEdgeId[e.targetId+"_"+e.sourceId]=e.id,e.isPartOfAromaticRing=t.value.isPartOfAromaticRing&&i.value.isPartOfAromaticRing,t.value.bondCount+=e.weight,i.value.bondCount+=e.weight,t.edges.push(e.id),i.edges.push(e.id),e.id}getEdge(e,t){let i=this.vertexIdsToEdgeId[e+"_"+t];return i===void 0?null:this.edges[i]}getEdges(e){let t=Array(),i=this.vertices[e];for(var n=0;n<i.neighbours.length;n++)t.push(this.vertexIdsToEdgeId[e+"_"+i.neighbours[n]]);return t}hasEdge(e,t){return this.vertexIdsToEdgeId[e+"_"+t]!==void 0}getVertexList(){let e=[this.vertices.length];for(var t=0;t<this.vertices.length;t++)e[t]=this.vertices[t].id;return e}getEdgeList(){let e=Array(this.edges.length);for(var t=0;t<this.edges.length;t++)e[t]=[this.edges[t].sourceId,this.edges[t].targetId];return e}getAdjacencyMatrix(){let e=this.vertices.length,t=Array(e);for(var i=0;i<e;i++)t[i]=new Array(e),t[i].fill(0);for(var i=0;i<this.edges.length;i++){let s=this.edges[i];t[s.sourceId][s.targetId]=1,t[s.targetId][s.sourceId]=1}return t}getComponentsAdjacencyMatrix(){let e=this.vertices.length,t=Array(e),i=this.getBridges();for(var n=0;n<e;n++)t[n]=new Array(e),t[n].fill(0);for(var n=0;n<this.edges.length;n++){let a=this.edges[n];t[a.sourceId][a.targetId]=1,t[a.targetId][a.sourceId]=1}for(var n=0;n<i.length;n++)t[i[n][0]][i[n][1]]=0,t[i[n][1]][i[n][0]]=0;return t}getSubgraphAdjacencyMatrix(e){let t=e.length,i=Array(t);for(var n=0;n<t;n++){i[n]=new Array(t),i[n].fill(0);for(var s=0;s<t;s++)n!==s&&this.hasEdge(e[n],e[s])&&(i[n][s]=1)}return i}getDistanceMatrix(){let e=this.vertices.length,t=this.getAdjacencyMatrix(),i=Array(e);for(var n=0;n<e;n++)i[n]=Array(e),i[n].fill(1/0);for(var n=0;n<e;n++)for(var s=0;s<e;s++)t[n][s]===1&&(i[n][s]=1);for(var a=0;a<e;a++)for(var n=0;n<e;n++)for(var s=0;s<e;s++)i[n][s]>i[n][a]+i[a][s]&&(i[n][s]=i[n][a]+i[a][s]);return i}getSubgraphDistanceMatrix(e){let t=e.length,i=this.getSubgraphAdjacencyMatrix(e),n=Array(t);for(var s=0;s<t;s++)n[s]=Array(t),n[s].fill(1/0);for(var s=0;s<t;s++)for(var a=0;a<t;a++)i[s][a]===1&&(n[s][a]=1);for(var r=0;r<t;r++)for(var s=0;s<t;s++)for(var a=0;a<t;a++)n[s][a]>n[s][r]+n[r][a]&&(n[s][a]=n[s][r]+n[r][a]);return n}getAdjacencyList(){let e=this.vertices.length,t=Array(e);for(var i=0;i<e;i++){t[i]=[];for(var n=0;n<e;n++)i!==n&&this.hasEdge(this.vertices[i].id,this.vertices[n].id)&&t[i].push(n)}return t}getSubgraphAdjacencyList(e){let t=e.length,i=Array(t);for(var n=0;n<t;n++){i[n]=Array();for(var s=0;s<t;s++)n!==s&&this.hasEdge(e[n],e[s])&&i[n].push(s)}return i}getBridges(){let e=this.vertices.length,t=new Array(e),i=new Array(e),n=new Array(e),s=new Array(e),a=this.getAdjacencyList(),r=Array();t.fill(!1),s.fill(null),this._time=0;for(var h=0;h<e;h++)t[h]||this._bridgeDfs(h,t,i,n,s,a,r);return r}traverseBF(e,t){let i=this.vertices.length,n=new Array(i);n.fill(!1);for(var s=[e];s.length>0;){let r=s.shift(),h=this.vertices[r];t(h);for(var a=0;a<h.neighbours.length;a++){let o=h.neighbours[a];n[o]||(n[o]=!0,s.push(o))}}}getTreeDepth(e,t){if(e===null||t===null)return 0;let i=this.vertices[e].getSpanningTreeNeighbours(t),n=0;for(var s=0;s<i.length;s++){let a=i[s],r=this.getTreeDepth(a,e);r>n&&(n=r)}return n+1}traverseTree(e,t,i,n=999999,s=!1,a=1,r=null){if(r===null&&(r=new Uint8Array(this.vertices.length)),a>n+1||r[e]===1)return;r[e]=1;let h=this.vertices[e],o=h.getNeighbours(t);(!s||a>1)&&i(h);for(var d=0;d<o.length;d++)this.traverseTree(o[d],e,i,n,s,a+1,r)}kkLayout(e,t,i,n,s,a=.1,r=.1,h=2e3,o=50,d=1e9){let c=s;for(var u=e.length;u--;)var m=this.vertices[e[u]].neighbours.length;let S=this.getSubgraphDistanceMatrix(e),p=e.length,w=Ii.polyCircumradius(500,p),k=Ii.centralAngle(p),D=0,x=new Float32Array(p),N=new Float32Array(p),B=Array(p);for(u=p;u--;){let L=this.vertices[e[u]];L.positioned?(x[u]=L.position.x,N[u]=L.position.y):(x[u]=t.x+Math.cos(D)*w,N[u]=t.y+Math.sin(D)*w),B[u]=L.positioned,D+=k}let T=Array(p);for(u=p;u--;){T[u]=new Array(p);for(var m=p;m--;)T[u][m]=s*S[u][m]}let P=Array(p);for(u=p;u--;){P[u]=Array(p);for(var m=p;m--;)P[u][m]=c*Math.pow(S[u][m],-2)}let V=Array(p),M=new Float32Array(p),O=new Float32Array(p);for(u=p;u--;)V[u]=Array(p);u=p;let z,I,he,fe,de,ae,Ae;for(;u--;){z=x[u],I=N[u],he=0,fe=0;let L=p;for(;L--;)u!==L&&(de=x[L],ae=N[L],Ae=1/Math.sqrt((z-de)*(z-de)+(I-ae)*(I-ae)),V[u][L]=[P[u][L]*(z-de-T[u][L]*(z-de)*Ae),P[u][L]*(I-ae-T[u][L]*(I-ae)*Ae)],V[L][u]=V[u][L],he+=V[u][L][0],fe+=V[u][L][1]);M[u]=he,O[u]=fe}let Q=function(L){return[M[L]*M[L]+O[L]*O[L],M[L],O[L]]},j=function(){let L=0,K=0,Se=0,ue=0;for(u=p;u--;){let[ye,ce,le]=Q(u);ye>L&&B[u]===!1&&(L=ye,K=u,Se=ce,ue=le)}return[K,L,Se,ue]},Xt=function(L,K,Se){let ue=0,ye=0,ce=0,le=x[L],oe=N[L],Qe=T[L],ge=P[L];for(u=p;u--;){if(u===L)continue;let Fe=x[u],xe=N[u],$e=Qe[u],je=ge[u],Ke=(le-Fe)*(le-Fe),Ze=1/Math.pow(Ke+(oe-xe)*(oe-xe),1.5);ue+=je*(1-$e*(oe-xe)*(oe-xe)*Ze),ye+=je*(1-$e*Ke*Ze),ce+=je*($e*(le-Fe)*(oe-xe)*Ze)}ue===0&&(ue=.1),ye===0&&(ye=.1),ce===0&&(ce=.1);let Z=K/ue+Se/ce;Z/=ce/ue-ye/ce;let G=-(ce*Z+K)/ue;x[L]+=G,N[L]+=Z;let J=V[L];K=0,Se=0,le=x[L],oe=N[L];let Te,Ne,Ue,Ge,_e;for(u=p;u--;)L!==u&&(Te=x[u],Ne=N[u],Ue=J[u][0],Ge=J[u][1],_e=1/Math.sqrt((le-Te)*(le-Te)+(oe-Ne)*(oe-Ne)),G=ge[u]*(le-Te-Qe[u]*(le-Te)*_e),Z=ge[u]*(oe-Ne-Qe[u]*(oe-Ne)*_e),J[u]=[G,Z],K+=G,Se+=Z,M[u]+=G-Ue,O[u]+=Z-Ge);M[L]=K,O[L]=Se},We=0,qe=0,He=0,Ye=0,ct=0,Xe=0;for(;d>a&&h>ct;)for(ct++,[We,d,qe,He]=j(),Ye=d,Xe=0;Ye>r&&o>Xe;)Xe++,Xt(We,qe,He),[Ye,qe,He]=Q(We);for(u=p;u--;){let L=e[u],K=this.vertices[L];K.position.x=x[u],K.position.y=N[u],K.positioned=!0,K.forcePositioned=!0}}_bridgeDfs(e,t,i,n,s,a,r){t[e]=!0,i[e]=n[e]=++this._time;for(var h=0;h<a[e].length;h++){let o=a[e][h];t[o]?o!==s[e]&&(n[e]=Math.min(n[e],i[o])):(s[o]=e,this._bridgeDfs(o,t,i,n,s,a,r),n[e]=Math.min(n[e],n[o]),n[o]>i[e]&&r.push([e,o]))}}static getConnectedComponents(e){let t=e.length,i=new Array(t),n=new Array;i.fill(!1);for(var s=0;s<t;s++)if(!i[s]){let a=Array();i[s]=!0,a.push(s),Ie._ccGetDfs(s,i,e,a),a.length>1&&n.push(a)}return n}static getConnectedComponentCount(e){let t=e.length,i=new Array(t),n=0;i.fill(!1);for(var s=0;s<t;s++)i[s]||(i[s]=!0,n++,Ie._ccCountDfs(s,i,e));return n}static _ccCountDfs(e,t,i){for(var n=0;n<i[e].length;n++)!i[e][n]||t[n]||e===n||(t[n]=!0,Ie._ccCountDfs(n,t,i))}static _ccGetDfs(e,t,i,n){for(var s=0;s<i[e].length;s++)!i[e][s]||t[s]||e===s||(t[s]=!0,n.push(s),Ie._ccGetDfs(s,t,i,n))}}var on=Ie;const Pr=on;class re{static getRings(e,t=!1){let i=e.getComponentsAdjacencyMatrix();if(i.length===0)return null;let n=Pr.getConnectedComponents(i),s=Array();for(var a=0;a<n.length;a++){let o=n[a],d=e.getSubgraphAdjacencyMatrix([...o]),c=new Uint16Array(d.length),u=new Uint16Array(d.length);for(var r=0;r<d.length;r++){u[r]=0,c[r]=0;for(var h=0;h<d[r].length;h++)c[r]+=d[r][h]}let m=0;for(var r=0;r<d.length;r++)for(var h=r+1;h<d.length;h++)m+=d[r][h];let S=m-d.length+1,p=!0;for(var r=0;r<c.length;r++)c[r]!==3&&(p=!1);if(p&&(S=2+m-d.length),S===1){s.push([...o]);continue}t&&(S=999);let{d:w,pe:k,pe_prime:D}=re.getPathIncludedDistanceMatrices(d),x=re.getRingCandidates(w,k,D),N=re.getSSSR(x,w,d,k,D,c,u,S);for(var r=0;r<N.length;r++){let T=Array(N[r].size),P=0;for(let V of N[r])T[P++]=o[V];s.push(T)}}return s}static matrixToString(e){let t="";for(var i=0;i<e.length;i++){for(var n=0;n<e[i].length;n++)t+=e[i][n]+" ";t+=`
`}return t}static getPathIncludedDistanceMatrices(e){let t=e.length,i=Array(t),n=Array(t),s=Array(t);for(var a=0,r=0,h=0,o=t;o--;){i[o]=Array(t),n[o]=Array(t),s[o]=Array(t);for(var c=t;c--;)i[o][c]=o===c||e[o][c]===1?e[o][c]:Number.POSITIVE_INFINITY,i[o][c]===1?n[o][c]=[[[o,c]]]:n[o][c]=Array(),s[o][c]=Array()}for(var d=t,c;d--;)for(o=t;o--;)for(c=t;c--;){const u=i[o][c],m=i[o][d]+i[d][c];if(u>m){var a,r,h;if(u===m+1)for(s[o][c]=[n[o][c].length],a=n[o][c].length;a--;)for(s[o][c][a]=[n[o][c][a].length],r=n[o][c][a].length;r--;)for(s[o][c][a][r]=[n[o][c][a][r].length],h=n[o][c][a][r].length;h--;)s[o][c][a][r][h]=[n[o][c][a][r][0],n[o][c][a][r][1]];else s[o][c]=Array();for(i[o][c]=m,n[o][c]=[[]],a=n[o][d][0].length;a--;)n[o][c][0].push(n[o][d][0][a]);for(a=n[d][c][0].length;a--;)n[o][c][0].push(n[d][c][0][a])}else if(u===m){if(n[o][d].length&&n[d][c].length){var a;if(n[o][c].length){let p=Array();for(a=n[o][d][0].length;a--;)p.push(n[o][d][0][a]);for(a=n[d][c][0].length;a--;)p.push(n[d][c][0][a]);n[o][c].push(p)}else{let p=Array();for(a=n[o][d][0].length;a--;)p.push(n[o][d][0][a]);for(a=n[d][c][0].length;a--;)p.push(n[d][c][0][a]);n[o][c][0]=p}}}else if(u===m-1){var a;if(s[o][c].length){let p=Array();for(a=n[o][d][0].length;a--;)p.push(n[o][d][0][a]);for(a=n[d][c][0].length;a--;)p.push(n[d][c][0][a]);s[o][c].push(p)}else{let p=Array();for(a=n[o][d][0].length;a--;)p.push(n[o][d][0][a]);for(a=n[d][c][0].length;a--;)p.push(n[d][c][0][a]);s[o][c][0]=p}}}return{d:i,pe:n,pe_prime:s}}static getRingCandidates(e,t,i){let n=e.length,s=Array(),a=0;for(let r=0;r<n;r++)for(let h=0;h<n;h++)e[r][h]===0||t[r][h].length===1&&i[r][h]===0||(i[r][h].length!==0?a=2*(e[r][h]+.5):a=2*e[r][h],a!==1/0&&s.push([a,t[r][h],i[r][h]]));return s.sort(function(r,h){return r[0]-h[0]}),s}static getSSSR(e,t,i,n,s,a,r,h){let o=Array(),d=Array();for(let u=0;u<e.length;u++)if(e[u][0]%2!==0)for(let m=0;m<e[u][2].length;m++){let S=e[u][1][0].concat(e[u][2][m]);for(var c=0;c<S.length;c++)S[c][0].constructor===Array&&(S[c]=S[c][0]);let p=re.bondsToAtoms(S);if(re.getBondCount(p,i)===p.size&&!re.pathSetsContain(o,p,S,d,a,r)&&(o.push(p),d=d.concat(S)),o.length>h)return o}else for(let m=0;m<e[u][1].length-1;m++){let S=e[u][1][m].concat(e[u][1][m+1]);for(var c=0;c<S.length;c++)S[c][0].constructor===Array&&(S[c]=S[c][0]);let p=re.bondsToAtoms(S);if(re.getBondCount(p,i)===p.size&&!re.pathSetsContain(o,p,S,d,a,r)&&(o.push(p),d=d.concat(S)),o.length>h)return o}return o}static getEdgeCount(e){let t=0,i=e.length;for(var n=i-1;n--;)for(var s=i;s--;)e[n][s]===1&&t++;return t}static getEdgeList(e){let t=e.length,i=Array();for(var n=t-1;n--;)for(var s=t;s--;)e[n][s]===1&&i.push([n,s]);return i}static bondsToAtoms(e){let t=new Set;for(var i=e.length;i--;)t.add(e[i][0]),t.add(e[i][1]);return t}static getBondCount(e,t){let i=0;for(let n of e)for(let s of e)n!==s&&(i+=t[n][s]);return i/2}static pathSetsContain(e,t,i,n,s,a){for(var r=e.length;r--;){if(re.isSupersetOf(t,e[r]))return!0;if(e[r].size===t.size&&re.areSetsEqual(e[r],t))return!0}let h=0,o=!1;for(r=i.length;r--;)for(var d=n.length;d--;)(i[r][0]===n[d][0]&&i[r][1]===n[d][1]||i[r][1]===n[d][0]&&i[r][0]===n[d][1])&&h++,h===i.length&&(o=!0);let c=!1;if(o){for(let u of t)if(a[u]<s[u]){c=!0;break}}if(o&&!c)return!0;for(let u of t)a[u]++;return!1}static areSetsEqual(e,t){if(e.size!==t.size)return!1;for(let i of e)if(!t.has(i))return!1;return!0}static isSupersetOf(e,t){for(var i of t)if(!e.has(i))return!1;return!0}}var Br=re;class Or{constructor(e,t){this.colors=e,this.theme=this.colors[t]}getColor(e){return e&&(e=e.toUpperCase(),e in this.theme)?this.theme[e]:this.theme.C}setTheme(e){this.colors.hasOwnProperty(e)&&(this.theme=this.colors[e])}}var hn=Or;const H=Wt,be=st,F=Ee,X=fi,Ir=an,St=pi,Mi=Nr,yt=sn,Mr=Er,zr=on,Vr=Br,Wr=hn;class qr{constructor(e){this.graph=null,this.doubleBondConfigCount=0,this.doubleBondConfig=null,this.ringIdCounter=0,this.ringConnectionIdCounter=0,this.canvasWrapper=null,this.totalOverlapScore=0,this.defaultOptions={width:500,height:500,bondThickness:.6,bondLength:15,shortBondLength:.85,bondSpacing:.18*15,atomVisualization:"default",isomeric:!0,debug:!1,terminalCarbons:!1,explicitHydrogens:!0,overlapSensitivity:.42,overlapResolutionIterations:1,compactDrawing:!0,fontSizeLarge:5,fontSizeSmall:3,padding:20,experimentalSSSR:!1,kkThreshold:.1,kkInnerThreshold:.1,kkMaxIteration:2e4,kkMaxInnerIteration:50,kkMaxEnergy:1e9,themes:{dark:{C:"#fff",O:"#e74c3c",N:"#3498db",F:"#27ae60",CL:"#16a085",BR:"#d35400",I:"#8e44ad",P:"#d35400",S:"#f1c40f",B:"#e67e22",SI:"#e67e22",H:"#fff",BACKGROUND:"#141414"},light:{C:"#222",O:"#e74c3c",N:"#3498db",F:"#27ae60",CL:"#16a085",BR:"#d35400",I:"#8e44ad",P:"#d35400",S:"#f1c40f",B:"#e67e22",SI:"#e67e22",H:"#222",BACKGROUND:"#fff"}}},this.opts=this.extend(!0,this.defaultOptions,e),this.opts.halfBondSpacing=this.opts.bondSpacing/2,this.opts.bondLengthSq=this.opts.bondLength*this.opts.bondLength,this.opts.halfFontSizeLarge=this.opts.fontSizeLarge/2,this.opts.quarterFontSizeLarge=this.opts.fontSizeLarge/4,this.opts.fifthFontSizeSmall=this.opts.fontSizeSmall/5,this.theme=this.opts.themes.dark}extend(){let e=this,t={},i=!1,n=0,s=arguments.length;Object.prototype.toString.call(arguments[0])==="[object Boolean]"&&(i=arguments[0],n++);let a=function(r){for(var h in r)Object.prototype.hasOwnProperty.call(r,h)&&(i&&Object.prototype.toString.call(r[h])==="[object Object]"?t[h]=e.extend(!0,t[h],r[h]):t[h]=r[h])};for(;n<s;n++){let r=arguments[n];a(r)}return t}draw(e,t,i="light",n=!1){this.initDraw(e,i,n),this.infoOnly||(this.themeManager=new Wr(this.opts.themes,i),this.canvasWrapper=new Mr(t,this.themeManager,this.opts)),n||(this.processGraph(),this.canvasWrapper.scale(this.graph.vertices),this.drawEdges(this.opts.debug),this.drawVertices(this.opts.debug),this.canvasWrapper.reset(),this.opts.debug&&(console.log(this.graph),console.log(this.rings),console.log(this.ringConnections)))}edgeRingCount(e){let t=this.graph.edges[e],i=this.graph.vertices[t.sourceId],n=this.graph.vertices[t.targetId];return Math.min(i.value.rings.length,n.value.rings.length)}getBridgedRings(){let e=Array();for(var t=0;t<this.rings.length;t++)this.rings[t].isBridged&&e.push(this.rings[t]);return e}getFusedRings(){let e=Array();for(var t=0;t<this.rings.length;t++)this.rings[t].isFused&&e.push(this.rings[t]);return e}getSpiros(){let e=Array();for(var t=0;t<this.rings.length;t++)this.rings[t].isSpiro&&e.push(this.rings[t]);return e}printRingInfo(){let e="";for(var t=0;t<this.rings.length;t++){const i=this.rings[t];e+=i.id+";",e+=i.members.length+";",e+=i.neighbours.length+";",e+=i.isSpiro?"true;":"false;",e+=i.isFused?"true;":"false;",e+=i.isBridged?"true;":"false;",e+=i.rings.length+";",e+=`
`}return e}rotateDrawing(){let e=0,t=0,i=0;for(var n=0;n<this.graph.vertices.length;n++){let r=this.graph.vertices[n];if(!!r.value.isDrawn)for(var s=n+1;s<this.graph.vertices.length;s++){let h=this.graph.vertices[s];if(!h.value.isDrawn)continue;let o=r.position.distanceSq(h.position);o>i&&(i=o,e=n,t=s)}}let a=-F.subtract(this.graph.vertices[e].position,this.graph.vertices[t].position).angle();if(!isNaN(a)){let r=a%.523599;r<.2617995?a=a-r:a+=.523599-r;for(var n=0;n<this.graph.vertices.length;n++)n!==t&&this.graph.vertices[n].position.rotateAround(a,this.graph.vertices[t].position);for(var n=0;n<this.rings.length;n++)this.rings[n].center.rotateAround(a,this.graph.vertices[t].position)}}getTotalOverlapScore(){return this.totalOverlapScore}getRingCount(){return this.rings.length}hasBridgedRing(){return this.bridgedRing}getHeavyAtomCount(){let e=0;for(var t=0;t<this.graph.vertices.length;t++)this.graph.vertices[t].value.element!=="H"&&e++;return e}getMolecularFormula(){let e="",t=new Map;for(var i=0;i<this.graph.vertices.length;i++){let s=this.graph.vertices[i].value;if(t.has(s.element)?t.set(s.element,t.get(s.element)+1):t.set(s.element,1),s.bracket&&!s.bracket.chirality&&(t.has("H")?t.set("H",t.get("H")+s.bracket.hcount):t.set("H",s.bracket.hcount)),!s.bracket){let a=St.maxBonds[s.element]-s.bondCount;s.isPartOfAromaticRing&&a--,t.has("H")?t.set("H",t.get("H")+a):t.set("H",a)}}if(t.has("C")){let s=t.get("C");e+="C"+(s>1?s:""),t.delete("C")}if(t.has("H")){let s=t.get("H");e+="H"+(s>1?s:""),t.delete("H")}return Object.keys(St.atomicNumbers).sort().map(s=>{if(t.has(s)){let a=t.get(s);e+=s+(a>1?a:"")}}),e}getRingbondType(e,t){if(e.value.getRingbondCount()<1||t.value.getRingbondCount()<1)return null;for(var i=0;i<e.value.ringbonds.length;i++)for(var n=0;n<t.value.ringbonds.length;n++)if(e.value.ringbonds[i].id===t.value.ringbonds[n].id)return e.value.ringbonds[i].bondType==="-"?t.value.ringbonds[n].bond:e.value.ringbonds[i].bond;return null}initDraw(e,t,i){this.data=e,this.infoOnly=i,this.ringIdCounter=0,this.ringConnectionIdCounter=0,this.graph=new zr(e,this.opts.isomeric),this.rings=Array(),this.ringConnections=Array(),this.originalRings=Array(),this.originalRingConnections=Array(),this.bridgedRing=!1,this.doubleBondConfigCount=null,this.doubleBondConfig=null,this.initRings(),this.initHydrogens()}processGraph(){this.position(),this.restoreRingInformation(),this.resolvePrimaryOverlaps();let e=this.getOverlapScore();this.totalOverlapScore=this.getOverlapScore().total;for(var t=0;t<this.opts.overlapResolutionIterations;t++)for(var i=0;i<this.graph.edges.length;i++){let n=this.graph.edges[i];if(this.isEdgeRotatable(n)){let s=this.graph.getTreeDepth(n.sourceId,n.targetId),a=this.graph.getTreeDepth(n.targetId,n.sourceId),r=n.targetId,h=n.sourceId;if(s>a&&(r=n.sourceId,h=n.targetId),this.getSubtreeOverlapScore(h,r,e.vertexScores).value>this.opts.overlapSensitivity){let d=this.graph.vertices[r],c=this.graph.vertices[h],u=c.getNeighbours(r);if(u.length===1){let m=this.graph.vertices[u[0]],S=m.position.getRotateAwayFromAngle(d.position,c.position,H.toRad(120));this.rotateSubtree(m.id,c.id,S,c.position);let p=this.getOverlapScore().total;p>this.totalOverlapScore?this.rotateSubtree(m.id,c.id,-S,c.position):this.totalOverlapScore=p}else if(u.length===2){if(c.value.rings.length!==0&&d.value.rings.length!==0)continue;let m=this.graph.vertices[u[0]],S=this.graph.vertices[u[1]];if(m.value.rings.length===1&&S.value.rings.length===1){if(m.value.rings[0]!==S.value.rings[0])continue}else{if(m.value.rings.length!==0||S.value.rings.length!==0)continue;{let p=m.position.getRotateAwayFromAngle(d.position,c.position,H.toRad(120)),w=S.position.getRotateAwayFromAngle(d.position,c.position,H.toRad(120));this.rotateSubtree(m.id,c.id,p,c.position),this.rotateSubtree(S.id,c.id,w,c.position);let k=this.getOverlapScore().total;k>this.totalOverlapScore?(this.rotateSubtree(m.id,c.id,-p,c.position),this.rotateSubtree(S.id,c.id,-w,c.position)):this.totalOverlapScore=k}}}e=this.getOverlapScore()}}}this.resolveSecondaryOverlaps(e.scores),this.opts.isomeric&&this.annotateStereochemistry(),this.opts.compactDrawing&&this.opts.atomVisualization==="default"&&this.initPseudoElements(),this.rotateDrawing()}initRings(){let e=new Map;for(var t=this.graph.vertices.length-1;t>=0;t--){let s=this.graph.vertices[t];if(s.value.ringbonds.length!==0)for(var i=0;i<s.value.ringbonds.length;i++){let a=s.value.ringbonds[i].id,r=s.value.ringbonds[i].bond;if(!e.has(a))e.set(a,[s.id,r]);else{let h=s.id,o=e.get(a)[0],d=e.get(a)[1],c=new Ir(h,o,1);c.setBondType(d||r||"-");let u=this.graph.addEdge(c),m=this.graph.vertices[o];s.addRingbondChild(o,i),s.value.addNeighbouringElement(m.value.element),m.addRingbondChild(h,i),m.value.addNeighbouringElement(s.value.element),s.edges.push(u),m.edges.push(u),e.delete(a)}}}let n=Vr.getRings(this.graph,this.opts.experimentalSSSR);if(n!==null){for(var t=0;t<n.length;t++){let a=[...n[t]],r=this.addRing(new Mi(a));for(var i=0;i<a.length;i++)this.graph.vertices[a[i]].value.rings.push(r)}for(var t=0;t<this.rings.length-1;t++)for(var i=t+1;i<this.rings.length;i++){let r=this.rings[t],h=this.rings[i],o=new yt(r,h);o.vertices.size>0&&this.addRingConnection(o)}for(var t=0;t<this.rings.length;t++){let a=this.rings[t];a.neighbours=yt.getNeighbours(this.ringConnections,a.id)}for(var t=0;t<this.rings.length;t++){let a=this.rings[t];this.graph.vertices[a.members[0]].value.addAnchoredRing(a.id)}for(this.backupRingInformation();this.rings.length>0;){let s=-1;for(var t=0;t<this.rings.length;t++){let o=this.rings[t];this.isPartOfBridgedRing(o.id)&&!o.isBridged&&(s=o.id)}if(s===-1)break;let a=this.getRing(s),r=this.getBridgedRingRings(a.id);this.bridgedRing=!0,this.createBridgedRing(r,a.members[0]);for(var t=0;t<r.length;t++)this.removeRing(r[t])}}}initHydrogens(){if(!this.opts.explicitHydrogens)for(var e=0;e<this.graph.vertices.length;e++){let t=this.graph.vertices[e];if(t.value.element!=="H")continue;let i=this.graph.vertices[t.neighbours[0]];i.value.hasHydrogen=!0,(!i.value.isStereoCenter||i.value.rings.length<2&&!i.value.bridgedRing||i.value.bridgedRing&&i.value.originalRings.length<2)&&(t.value.isDrawn=!1)}}getBridgedRingRings(e){let t=Array(),i=this,n=function(s){let a=i.getRing(s);t.push(s);for(var r=0;r<a.neighbours.length;r++){let h=a.neighbours[r];t.indexOf(h)===-1&&h!==s&&yt.isBridge(i.ringConnections,i.graph.vertices,s,h)&&n(h)}};return n(e),be.unique(t)}isPartOfBridgedRing(e){for(var t=0;t<this.ringConnections.length;t++)if(this.ringConnections[t].containsRing(e)&&this.ringConnections[t].isBridge(this.graph.vertices))return!0;return!1}createBridgedRing(e,t){let i=new Set,n=new Set,s=new Set;for(var a=0;a<e.length;a++){let c=this.getRing(e[a]);c.isPartOfBridged=!0;for(var r=0;r<c.members.length;r++)n.add(c.members[r]);for(var r=0;r<c.neighbours.length;r++){let m=c.neighbours[r];e.indexOf(m)===-1&&s.add(c.neighbours[r])}}let h=new Set;for(let c of n){let u=this.graph.vertices[c],m=be.intersection(e,u.value.rings);u.value.rings.length===1||m.length===1?i.add(u.id):h.add(u.id)}Array();let o=Array();for(let c of h){let u=this.graph.vertices[c],m=!1;for(let S=0;S<u.edges.length;S++)this.edgeRingCount(u.edges[S])===1&&(m=!0);m?(u.value.isBridgeNode=!0,i.add(u.id)):(u.value.isBridge=!0,i.add(u.id))}let d=new Mi([...i]);this.addRing(d),d.isBridged=!0,d.neighbours=[...s];for(var a=0;a<e.length;a++)d.rings.push(this.getRing(e[a]).clone());for(var a=0;a<d.members.length;a++)this.graph.vertices[d.members[a]].value.bridgedRing=d.id;for(var a=0;a<o.length;a++){let u=this.graph.vertices[o[a]];u.value.rings=Array()}for(let c of i){let u=this.graph.vertices[c];u.value.rings=be.removeAll(u.value.rings,e),u.value.rings.push(d.id)}for(var a=0;a<e.length;a++)for(var r=a+1;r<e.length;r++)this.removeRingConnectionsBetween(e[a],e[r]);for(let c of s){let u=this.getRingConnections(c,e);for(var r=0;r<u.length;r++)this.getRingConnection(u[r]).updateOther(d.id,c);this.getRing(c).neighbours.push(d.id)}return d}areVerticesInSameRing(e,t){for(var i=0;i<e.value.rings.length;i++)for(var n=0;n<t.value.rings.length;n++)if(e.value.rings[i]===t.value.rings[n])return!0;return!1}getCommonRings(e,t){let i=Array();for(var n=0;n<e.value.rings.length;n++)for(var s=0;s<t.value.rings.length;s++)e.value.rings[n]==t.value.rings[s]&&i.push(e.value.rings[n]);return i}getLargestOrAromaticCommonRing(e,t){let i=this.getCommonRings(e,t),n=0,s=null;for(var a=0;a<i.length;a++){let r=this.getRing(i[a]),h=r.getSize();if(r.isBenzeneLike(this.graph.vertices))return r;h>n&&(n=h,s=r)}return s}getVerticesAt(e,t,i){let n=Array();for(var s=0;s<this.graph.vertices.length;s++){let a=this.graph.vertices[s];if(a.id===i||!a.positioned)continue;e.distanceSq(a.position)<=t*t&&n.push(a.id)}return n}getClosestVertex(e){let t=99999,i=null;for(var n=0;n<this.graph.vertices.length;n++){let s=this.graph.vertices[n];if(s.id===e.id)continue;let a=e.position.distanceSq(s.position);a<t&&(t=a,i=s)}return i}addRing(e){return e.id=this.ringIdCounter++,this.rings.push(e),e.id}removeRing(e){this.rings=this.rings.filter(function(i){return i.id!==e}),this.ringConnections=this.ringConnections.filter(function(i){return i.firstRingId!==e&&i.secondRingId!==e});for(var t=0;t<this.rings.length;t++){let i=this.rings[t];i.neighbours=i.neighbours.filter(function(n){return n!==e})}}getRing(e){for(var t=0;t<this.rings.length;t++)if(this.rings[t].id==e)return this.rings[t]}addRingConnection(e){return e.id=this.ringConnectionIdCounter++,this.ringConnections.push(e),e.id}removeRingConnection(e){this.ringConnections=this.ringConnections.filter(function(t){return t.id!==e})}removeRingConnectionsBetween(e,t){let i=Array();for(var n=0;n<this.ringConnections.length;n++){let s=this.ringConnections[n];(s.firstRingId===e&&s.secondRingId===t||s.firstRingId===t&&s.secondRingId===e)&&i.push(s.id)}for(var n=0;n<i.length;n++)this.removeRingConnection(i[n])}getRingConnection(e){for(var t=0;t<this.ringConnections.length;t++)if(this.ringConnections[t].id==e)return this.ringConnections[t]}getRingConnections(e,t){let i=Array();for(var n=0;n<this.ringConnections.length;n++){let a=this.ringConnections[n];for(var s=0;s<t.length;s++){let r=t[s];(a.firstRingId===e&&a.secondRingId===r||a.firstRingId===r&&a.secondRingId===e)&&i.push(a.id)}}return i}getOverlapScore(){let e=0,t=new Float32Array(this.graph.vertices.length);for(var i=0;i<this.graph.vertices.length;i++)t[i]=0;for(var i=0;i<this.graph.vertices.length;i++)for(var n=this.graph.vertices.length;--n>i;){let r=this.graph.vertices[i],h=this.graph.vertices[n];if(!r.value.isDrawn||!h.value.isDrawn)continue;let o=F.subtract(r.position,h.position).lengthSq();if(o<this.opts.bondLengthSq){let d=(this.opts.bondLength-Math.sqrt(o))/this.opts.bondLength;e+=d,t[i]+=d,t[n]+=d}}let s=Array();for(var i=0;i<this.graph.vertices.length;i++)s.push({id:i,score:t[i]});return s.sort(function(a,r){return r.score-a.score}),{total:e,scores:s,vertexScores:t}}chooseSide(e,t,i){let n=e.getNeighbours(t.id),s=t.getNeighbours(e.id),a=n.length,r=s.length,h=be.merge(n,s),o=[0,0];for(var d=0;d<h.length;d++)this.graph.vertices[h[d]].position.sameSideAs(e.position,t.position,i[0])?o[0]++:o[1]++;let c=[0,0];for(var d=0;d<this.graph.vertices.length;d++)this.graph.vertices[d].position.sameSideAs(e.position,t.position,i[0])?c[0]++:c[1]++;return{totalSideCount:c,totalPosition:c[0]>c[1]?0:1,sideCount:o,position:o[0]>o[1]?0:1,anCount:a,bnCount:r}}setRingCenter(e){let t=e.getSize(),i=new F(0,0);for(var n=0;n<t;n++)i.add(this.graph.vertices[e.members[n]].position);e.center=i.divide(t)}getSubringCenter(e,t){let i=t.value.originalRings,n=e.center,s=Number.MAX_VALUE;for(var a=0;a<i.length;a++)for(var r=0;r<e.rings.length;r++)i[a]===e.rings[r].id&&e.rings[r].getSize()<s&&(n=e.rings[r].center,s=e.rings[r].getSize());return n}drawEdges(e){let t=this,i=Array(this.graph.edges.length);if(i.fill(!1),this.graph.traverseBF(0,function(s){let a=t.graph.getEdges(s.id);for(var r=0;r<a.length;r++){let h=a[r];i[h]||(i[h]=!0,t.drawEdge(h,e))}}),!this.bridgedRing)for(var n=0;n<this.rings.length;n++){let s=this.rings[n];this.isRingAromatic(s)&&this.canvasWrapper.drawAromaticityRing(s)}}drawEdge(e,t){let i=this,n=this.graph.edges[e],s=this.graph.vertices[n.sourceId],a=this.graph.vertices[n.targetId],r=s.value.element,h=a.value.element;if((!s.value.isDrawn||!a.value.isDrawn)&&this.opts.atomVisualization==="default")return;let o=s.position,d=a.position,c=this.getEdgeNormals(n),u=be.clone(c);if(u[0].multiplyScalar(10).add(o),u[1].multiplyScalar(10).add(o),n.bondType==="="||this.getRingbondType(s,a)==="="||n.isPartOfAromaticRing&&this.bridgedRing){let m=this.areVerticesInSameRing(s,a),S=this.chooseSide(s,a,u);if(m){let w=this.getLargestOrAromaticCommonRing(s,a).center;c[0].multiplyScalar(i.opts.bondSpacing),c[1].multiplyScalar(i.opts.bondSpacing);let k=null;w.sameSideAs(s.position,a.position,F.add(o,c[0]))?k=new X(F.add(o,c[0]),F.add(d,c[0]),r,h):k=new X(F.add(o,c[1]),F.add(d,c[1]),r,h),k.shorten(this.opts.bondLength-this.opts.shortBondLength*this.opts.bondLength),n.isPartOfAromaticRing?this.canvasWrapper.drawLine(k,!0):this.canvasWrapper.drawLine(k),this.canvasWrapper.drawLine(new X(o,d,r,h))}else if(n.center||s.isTerminal()&&a.isTerminal()){c[0].multiplyScalar(i.opts.halfBondSpacing),c[1].multiplyScalar(i.opts.halfBondSpacing);let p=new X(F.add(o,c[0]),F.add(d,c[0]),r,h),w=new X(F.add(o,c[1]),F.add(d,c[1]),r,h);this.canvasWrapper.drawLine(p),this.canvasWrapper.drawLine(w)}else if(S.anCount==0&&S.bnCount>1||S.bnCount==0&&S.anCount>1){c[0].multiplyScalar(i.opts.halfBondSpacing),c[1].multiplyScalar(i.opts.halfBondSpacing);let p=new X(F.add(o,c[0]),F.add(d,c[0]),r,h),w=new X(F.add(o,c[1]),F.add(d,c[1]),r,h);this.canvasWrapper.drawLine(p),this.canvasWrapper.drawLine(w)}else if(S.sideCount[0]>S.sideCount[1]){c[0].multiplyScalar(i.opts.bondSpacing),c[1].multiplyScalar(i.opts.bondSpacing);let p=new X(F.add(o,c[0]),F.add(d,c[0]),r,h);p.shorten(this.opts.bondLength-this.opts.shortBondLength*this.opts.bondLength),this.canvasWrapper.drawLine(p),this.canvasWrapper.drawLine(new X(o,d,r,h))}else if(S.sideCount[0]<S.sideCount[1]){c[0].multiplyScalar(i.opts.bondSpacing),c[1].multiplyScalar(i.opts.bondSpacing);let p=new X(F.add(o,c[1]),F.add(d,c[1]),r,h);p.shorten(this.opts.bondLength-this.opts.shortBondLength*this.opts.bondLength),this.canvasWrapper.drawLine(p),this.canvasWrapper.drawLine(new X(o,d,r,h))}else if(S.totalSideCount[0]>S.totalSideCount[1]){c[0].multiplyScalar(i.opts.bondSpacing),c[1].multiplyScalar(i.opts.bondSpacing);let p=new X(F.add(o,c[0]),F.add(d,c[0]),r,h);p.shorten(this.opts.bondLength-this.opts.shortBondLength*this.opts.bondLength),this.canvasWrapper.drawLine(p),this.canvasWrapper.drawLine(new X(o,d,r,h))}else if(S.totalSideCount[0]<=S.totalSideCount[1]){c[0].multiplyScalar(i.opts.bondSpacing),c[1].multiplyScalar(i.opts.bondSpacing);let p=new X(F.add(o,c[1]),F.add(d,c[1]),r,h);p.shorten(this.opts.bondLength-this.opts.shortBondLength*this.opts.bondLength),this.canvasWrapper.drawLine(p),this.canvasWrapper.drawLine(new X(o,d,r,h))}}else if(n.bondType==="#"){c[0].multiplyScalar(i.opts.bondSpacing/1.5),c[1].multiplyScalar(i.opts.bondSpacing/1.5);let m=new X(F.add(o,c[0]),F.add(d,c[0]),r,h),S=new X(F.add(o,c[1]),F.add(d,c[1]),r,h);this.canvasWrapper.drawLine(m),this.canvasWrapper.drawLine(S),this.canvasWrapper.drawLine(new X(o,d,r,h))}else if(n.bondType!=="."){let m=s.value.isStereoCenter,S=a.value.isStereoCenter;n.wedge==="up"?this.canvasWrapper.drawWedge(new X(o,d,r,h,m,S)):n.wedge==="down"?this.canvasWrapper.drawDashedWedge(new X(o,d,r,h,m,S)):this.canvasWrapper.drawLine(new X(o,d,r,h,m,S))}if(t){let m=F.midpoint(o,d);this.canvasWrapper.drawDebugText(m.x,m.y,"e: "+e)}}drawVertices(e){for(var t=this.graph.vertices.length,t=0;t<this.graph.vertices.length;t++){let n=this.graph.vertices[t],s=n.value,a=0,r=0,h=n.value.bondCount,o=s.element,d=St.maxBonds[o]-h,c=n.getTextDirection(this.graph.vertices),u=this.opts.terminalCarbons||o!=="C"||s.hasAttachedPseudoElements?n.isTerminal():!1,m=s.element==="C";if(s.element==="N"&&s.isPartOfAromaticRing&&(d=0),s.bracket&&(d=s.bracket.hcount,a=s.bracket.charge,r=s.bracket.isotope),this.opts.atomVisualization==="allballs")this.canvasWrapper.drawBall(n.position.x,n.position.y,o);else if(s.isDrawn&&(!m||s.drawExplicit||u||s.hasAttachedPseudoElements)||this.graph.vertices.length===1)this.opts.atomVisualization==="default"?this.canvasWrapper.drawText(n.position.x,n.position.y,o,d,c,u,a,r,s.getAttachedPseudoElements()):this.opts.atomVisualization==="balls"&&this.canvasWrapper.drawBall(n.position.x,n.position.y,o);else if(n.getNeighbourCount()===2&&n.forcePositioned==!0){let S=this.graph.vertices[n.neighbours[0]].position,p=this.graph.vertices[n.neighbours[1]].position,w=F.threePointangle(n.position,S,p);Math.abs(Math.PI-w)<.1&&this.canvasWrapper.drawPoint(n.position.x,n.position.y,o)}if(e){let S="v: "+n.id+" "+be.print(s.ringbonds);this.canvasWrapper.drawDebugText(n.position.x,n.position.y,S)}}if(this.opts.debug)for(var t=0;t<this.rings.length;t++){let n=this.rings[t].center;this.canvasWrapper.drawDebugPoint(n.x,n.y,"r: "+this.rings[t].id)}}position(){let e=null;for(var t=0;t<this.graph.vertices.length;t++)if(this.graph.vertices[t].value.bridgedRing!==null){e=this.graph.vertices[t];break}for(var t=0;t<this.rings.length;t++)this.rings[t].isBridged&&(e=this.graph.vertices[this.rings[t].members[0]]);this.rings.length>0&&e===null&&(e=this.graph.vertices[this.rings[0].members[0]]),e===null&&(e=this.graph.vertices[0]),this.createNextBond(e,null,0)}backupRingInformation(){this.originalRings=Array(),this.originalRingConnections=Array();for(var e=0;e<this.rings.length;e++)this.originalRings.push(this.rings[e]);for(var e=0;e<this.ringConnections.length;e++)this.originalRingConnections.push(this.ringConnections[e]);for(var e=0;e<this.graph.vertices.length;e++)this.graph.vertices[e].value.backupRings()}restoreRingInformation(){let e=this.getBridgedRings();this.rings=Array(),this.ringConnections=Array();for(var t=0;t<e.length;t++){let n=e[t];for(var i=0;i<n.rings.length;i++){let s=n.rings[i];this.originalRings[s.id].center=s.center}}for(var t=0;t<this.originalRings.length;t++)this.rings.push(this.originalRings[t]);for(var t=0;t<this.originalRingConnections.length;t++)this.ringConnections.push(this.originalRingConnections[t]);for(var t=0;t<this.graph.vertices.length;t++)this.graph.vertices[t].value.restoreRings()}createRing(e,t=null,i=null,n=null){if(e.positioned)return;t=t||new F(0,0);let s=e.getOrderedNeighbours(this.ringConnections),a=i?F.subtract(i.position,t).angle():0,r=H.polyCircumradius(this.opts.bondLength,e.getSize()),h=H.centralAngle(e.getSize());e.centralAngle=h;let o=a,d=this,c=i?i.id:null;if(e.members.indexOf(c)===-1&&(i&&(i.positioned=!1),c=e.members[0]),e.isBridged){this.graph.kkLayout(e.members.slice(),t,i.id,e,this.opts.bondLength,this.opts.kkThreshold,this.opts.kkInnerThreshold,this.opts.kkMaxIteration,this.opts.kkMaxInnerIteration,this.opts.kkMaxEnergy),e.positioned=!0,this.setRingCenter(e),t=e.center;for(var u=0;u<e.rings.length;u++)this.setRingCenter(e.rings[u])}else e.eachMember(this.graph.vertices,function(S){let p=d.graph.vertices[S];p.positioned||p.setPosition(t.x+Math.cos(o)*r,t.y+Math.sin(o)*r),o+=h,(!e.isBridged||e.rings.length<3)&&(p.angle=o,p.positioned=!0)},c,n?n.id:null);e.positioned=!0,e.center=t;for(var u=0;u<s.length;u++){let p=this.getRing(s[u].neighbour);if(p.positioned)continue;let w=yt.getVertices(this.ringConnections,e.id,p.id);if(w.length===2){e.isFused=!0,p.isFused=!0;let k=this.graph.vertices[w[0]],D=this.graph.vertices[w[1]],x=F.midpoint(k.position,D.position),N=F.normals(k.position,D.position);N[0].normalize(),N[1].normalize();let B=H.polyCircumradius(this.opts.bondLength,p.getSize()),T=H.apothem(B,p.getSize());N[0].multiplyScalar(T).add(x),N[1].multiplyScalar(T).add(x);let P=N[0];F.subtract(t,N[1]).lengthSq()>F.subtract(t,N[0]).lengthSq()&&(P=N[1]);let V=F.subtract(k.position,P),M=F.subtract(D.position,P);V.clockwise(M)===-1?p.positioned||this.createRing(p,P,k,D):p.positioned||this.createRing(p,P,D,k)}else if(w.length===1){e.isSpiro=!0,p.isSpiro=!0;let k=this.graph.vertices[w[0]],D=F.subtract(t,k.position);D.invert(),D.normalize();let x=H.polyCircumradius(this.opts.bondLength,p.getSize());D.multiplyScalar(x),D.add(k.position),p.positioned||this.createRing(p,D,k)}}for(var u=0;u<e.members.length;u++){let p=this.graph.vertices[e.members[u]],w=p.neighbours;for(var m=0;m<w.length;m++){let k=this.graph.vertices[w[m]];k.positioned||(k.value.isConnectedToRing=!0,this.createNextBond(k,p,0))}}}rotateSubtree(e,t,i,n){let s=this;this.graph.traverseTree(e,t,function(a){a.position.rotateAround(i,n);for(var r=0;r<a.value.anchoredRings.length;r++){let h=s.rings[a.value.anchoredRings[r]];h&&h.center.rotateAround(i,n)}})}getSubtreeOverlapScore(e,t,i){let n=this,s=0,a=new F(0,0),r=0;return this.graph.traverseTree(e,t,function(h){if(!h.value.isDrawn)return;let o=i[h.id];o>n.opts.overlapSensitivity&&(s+=o,r++);let d=n.graph.vertices[h.id].position.clone();d.multiplyScalar(o),a.add(d)}),a.divide(s),{value:s/r,center:a}}getCurrentCenterOfMass(){let e=new F(0,0),t=0;for(var i=0;i<this.graph.vertices.length;i++){let n=this.graph.vertices[i];n.positioned&&(e.add(n.position),t++)}return e.divide(t)}getCurrentCenterOfMassInNeigbourhood(e,t=this.opts.bondLength*2){let i=new F(0,0),n=0,s=t*t;for(var a=0;a<this.graph.vertices.length;a++){let r=this.graph.vertices[a];r.positioned&&e.distanceSq(r.position)<s&&(i.add(r.position),n++)}return i.divide(n)}resolvePrimaryOverlaps(){let e=Array(),t=Array(this.graph.vertices.length);for(var i=0;i<this.rings.length;i++){let a=this.rings[i];for(var n=0;n<a.members.length;n++){let r=this.graph.vertices[a.members[n]];if(t[r.id])continue;t[r.id]=!0;let h=this.getNonRingNeighbours(r.id);if(h.length>1){let o=Array();for(var s=0;s<r.value.rings.length;s++)o.push(r.value.rings[s]);e.push({common:r,rings:o,vertices:h})}else if(h.length===1&&r.value.rings.length===2){let o=Array();for(var s=0;s<r.value.rings.length;s++)o.push(r.value.rings[s]);e.push({common:r,rings:o,vertices:h})}}}for(var i=0;i<e.length;i++){let r=e[i];if(r.vertices.length===2){let h=r.vertices[0],o=r.vertices[1];if(!h.value.isDrawn||!o.value.isDrawn)continue;let d=(2*Math.PI-this.getRing(r.rings[0]).getAngle())/6;this.rotateSubtree(h.id,r.common.id,d,r.common.position),this.rotateSubtree(o.id,r.common.id,-d,r.common.position);let c=this.getOverlapScore(),u=this.getSubtreeOverlapScore(h.id,r.common.id,c.vertexScores),m=this.getSubtreeOverlapScore(o.id,r.common.id,c.vertexScores),S=u.value+m.value;this.rotateSubtree(h.id,r.common.id,-2*d,r.common.position),this.rotateSubtree(o.id,r.common.id,2*d,r.common.position),c=this.getOverlapScore(),u=this.getSubtreeOverlapScore(h.id,r.common.id,c.vertexScores),m=this.getSubtreeOverlapScore(o.id,r.common.id,c.vertexScores),u.value+m.value>S&&(this.rotateSubtree(h.id,r.common.id,2*d,r.common.position),this.rotateSubtree(o.id,r.common.id,-2*d,r.common.position))}else r.vertices.length===1&&r.rings.length}}resolveSecondaryOverlaps(e){for(var t=0;t<e.length;t++)if(e[t].score>this.opts.overlapSensitivity){let i=this.graph.vertices[e[t].id];if(i.isTerminal()){let n=this.getClosestVertex(i);if(n){let s=null;n.isTerminal()?s=n.id===0?this.graph.vertices[1].position:n.previousPosition:s=n.id===0?this.graph.vertices[1].position:n.position;let a=i.id===0?this.graph.vertices[1].position:i.previousPosition;i.position.rotateAwayFrom(s,a,H.toRad(20))}}}}getLastVertexWithAngle(e){let t=0,i=null;for(;!t&&e;)i=this.graph.vertices[e],t=i.angle,e=i.parentVertexId;return i}createNextBond(e,t=null,i=0,n=!1,s=!1){if(e.positioned&&!s)return;let a=!1;if(t){let h=this.graph.getEdge(e.id,t.id);(h.bondType==="/"||h.bondType==="\\")&&++this.doubleBondConfigCount%2===1&&this.doubleBondConfig===null&&(this.doubleBondConfig=h.bondType,a=!0,t.parentVertexId===null&&e.value.branchBond&&(this.doubleBondConfig==="/"?this.doubleBondConfig="\\":this.doubleBondConfig==="\\"&&(this.doubleBondConfig="/")))}if(!s)if(t)if(t.value.rings.length>0){let h=t.neighbours,o=null,d=new F(0,0);if(t.value.bridgedRing===null&&t.value.rings.length>1)for(var r=0;r<h.length;r++){let c=this.graph.vertices[h[r]];if(be.containsAll(c.value.rings,t.value.rings)){o=c;break}}if(o===null){for(var r=0;r<h.length;r++){let u=this.graph.vertices[h[r]];u.positioned&&this.areVerticesInSameRing(u,t)&&d.add(F.subtract(u.position,t.position))}d.invert().normalize().multiplyScalar(this.opts.bondLength).add(t.position)}else d=o.position.clone().rotateAround(Math.PI,t.position);e.previousPosition=t.position,e.setPositionFromVector(d),e.positioned=!0}else{let h=new F(this.opts.bondLength,0);h.rotate(i),h.add(t.position),e.setPositionFromVector(h),e.previousPosition=t.position,e.positioned=!0}else{let h=new F(this.opts.bondLength,0);h.rotate(H.toRad(-60)),e.previousPosition=h,e.setPosition(this.opts.bondLength,0),e.angle=H.toRad(-60),e.value.bridgedRing===null&&(e.positioned=!0)}if(e.value.bridgedRing!==null){let h=this.getRing(e.value.bridgedRing);if(!h.positioned){let o=F.subtract(e.previousPosition,e.position);o.invert(),o.normalize();let d=H.polyCircumradius(this.opts.bondLength,h.members.length);o.multiplyScalar(d),o.add(e.position),this.createRing(h,o,e)}}else if(e.value.rings.length>0){let h=this.getRing(e.value.rings[0]);if(!h.positioned){let o=F.subtract(e.previousPosition,e.position);o.invert(),o.normalize();let d=H.polyCircumradius(this.opts.bondLength,h.getSize());o.multiplyScalar(d),o.add(e.position),this.createRing(h,o,e)}}else{e.value.isStereoCenter;let h=e.getNeighbours(),o=Array();for(var r=0;r<h.length;r++)this.graph.vertices[h[r]].value.isDrawn&&o.push(h[r]);t&&(o=be.remove(o,t.id));let d=e.getAngle();if(o.length===1){let c=this.graph.vertices[o[0]];if(e.value.bondType==="#"||t&&t.value.bondType==="#"||e.value.bondType==="="&&t&&t.value.rings.length===0&&t.value.bondType==="="&&e.value.branchBond!=="-"){if(e.value.drawExplicit=!1,t){let m=this.graph.getEdge(e.id,t.id);m.center=!0}let u=this.graph.getEdge(e.id,c.id);u.center=!0,(e.value.bondType==="#"||t&&t.value.bondType==="#")&&(c.angle=0),c.drawExplicit=!0,this.createNextBond(c,e,d+c.angle)}else if(t&&t.value.rings.length>0){let u=H.toRad(60),m=-u,S=new F(this.opts.bondLength,0),p=new F(this.opts.bondLength,0);S.rotate(u).add(e.position),p.rotate(m).add(e.position);let w=this.getCurrentCenterOfMass(),k=S.distanceSq(w),D=p.distanceSq(w);c.angle=k<D?m:u,this.createNextBond(c,e,d+c.angle)}else{let u=e.angle;if(t&&t.neighbours.length>3?u>0?u=Math.min(1.0472,u):u<0?u=Math.max(-1.0472,u):u=1.0472:u||(u=this.getLastVertexWithAngle(e.id).angle,u||(u=1.0472)),t&&!a){let m=this.graph.getEdge(e.id,c.id).bondType;m==="/"?(this.doubleBondConfig==="/"||this.doubleBondConfig==="\\"&&(u=-u),this.doubleBondConfig=null):m==="\\"&&(this.doubleBondConfig==="/"?u=-u:this.doubleBondConfig,this.doubleBondConfig=null)}n?c.angle=u:c.angle=-u,this.createNextBond(c,e,d+c.angle)}}else if(o.length===2){let c=e.angle;c||(c=1.0472);let u=this.graph.getTreeDepth(o[0],e.id),m=this.graph.getTreeDepth(o[1],e.id),S=this.graph.vertices[o[0]],p=this.graph.vertices[o[1]];S.value.subtreeDepth=u,p.value.subtreeDepth=m;let w=this.graph.getTreeDepth(t?t.id:null,e.id);t&&(t.value.subtreeDepth=w);let k=0,D=1;p.value.element==="C"&&S.value.element!=="C"&&m>1&&u<5?(k=1,D=0):p.value.element!=="C"&&S.value.element==="C"&&u>1&&m<5?(k=0,D=1):m>u&&(k=1,D=0);let x=this.graph.vertices[o[k]],N=this.graph.vertices[o[D]];this.graph.getEdge(e.id,x.id),this.graph.getEdge(e.id,N.id);let B=!1;w<u&&w<m&&(B=!0),N.angle=c,x.angle=-c,this.doubleBondConfig==="\\"?N.value.branchBond==="\\"&&(N.angle=-c,x.angle=c):this.doubleBondConfig==="/"&&N.value.branchBond==="/"&&(N.angle=-c,x.angle=c),this.createNextBond(N,e,d+N.angle,B),this.createNextBond(x,e,d+x.angle,B)}else if(o.length===3){let c=this.graph.getTreeDepth(o[0],e.id),u=this.graph.getTreeDepth(o[1],e.id),m=this.graph.getTreeDepth(o[2],e.id),S=this.graph.vertices[o[0]],p=this.graph.vertices[o[1]],w=this.graph.vertices[o[2]];S.value.subtreeDepth=c,p.value.subtreeDepth=u,w.value.subtreeDepth=m,u>c&&u>m?(S=this.graph.vertices[o[1]],p=this.graph.vertices[o[0]],w=this.graph.vertices[o[2]]):m>c&&m>u&&(S=this.graph.vertices[o[2]],p=this.graph.vertices[o[0]],w=this.graph.vertices[o[1]]),t&&t.value.rings.length<1&&S.value.rings.length<1&&p.value.rings.length<1&&w.value.rings.length<1&&this.graph.getTreeDepth(p.id,e.id)===1&&this.graph.getTreeDepth(w.id,e.id)===1&&this.graph.getTreeDepth(S.id,e.id)>1?(S.angle=-e.angle,e.angle>=0?(p.angle=H.toRad(30),w.angle=H.toRad(90)):(p.angle=-H.toRad(30),w.angle=-H.toRad(90)),this.createNextBond(S,e,d+S.angle),this.createNextBond(p,e,d+p.angle),this.createNextBond(w,e,d+w.angle)):(S.angle=0,p.angle=H.toRad(90),w.angle=-H.toRad(90),this.createNextBond(S,e,d+S.angle),this.createNextBond(p,e,d+p.angle),this.createNextBond(w,e,d+w.angle))}else if(o.length===4){let c=this.graph.getTreeDepth(o[0],e.id),u=this.graph.getTreeDepth(o[1],e.id),m=this.graph.getTreeDepth(o[2],e.id),S=this.graph.getTreeDepth(o[3],e.id),p=this.graph.vertices[o[0]],w=this.graph.vertices[o[1]],k=this.graph.vertices[o[2]],D=this.graph.vertices[o[3]];p.value.subtreeDepth=c,w.value.subtreeDepth=u,k.value.subtreeDepth=m,D.value.subtreeDepth=S,u>c&&u>m&&u>S?(p=this.graph.vertices[o[1]],w=this.graph.vertices[o[0]],k=this.graph.vertices[o[2]],D=this.graph.vertices[o[3]]):m>c&&m>u&&m>S?(p=this.graph.vertices[o[2]],w=this.graph.vertices[o[0]],k=this.graph.vertices[o[1]],D=this.graph.vertices[o[3]]):S>c&&S>u&&S>m&&(p=this.graph.vertices[o[3]],w=this.graph.vertices[o[0]],k=this.graph.vertices[o[1]],D=this.graph.vertices[o[2]]),p.angle=-H.toRad(36),w.angle=H.toRad(36),k.angle=-H.toRad(108),D.angle=H.toRad(108),this.createNextBond(p,e,d+p.angle),this.createNextBond(w,e,d+w.angle),this.createNextBond(k,e,d+k.angle),this.createNextBond(D,e,d+D.angle)}}}getCommonRingbondNeighbour(e){let t=e.neighbours;for(var i=0;i<t.length;i++){let n=this.graph.vertices[t[i]];if(be.containsAll(n.value.rings,e.value.rings))return n}return null}isPointInRing(e){for(var t=0;t<this.rings.length;t++){let i=this.rings[t];if(!i.positioned)continue;let n=H.polyCircumradius(this.opts.bondLength,i.getSize()),s=n*n;if(e.distanceSq(i.center)<s)return!0}return!1}isEdgeInRing(e){let t=this.graph.vertices[e.sourceId],i=this.graph.vertices[e.targetId];return this.areVerticesInSameRing(t,i)}isEdgeRotatable(e){let t=this.graph.vertices[e.sourceId],i=this.graph.vertices[e.targetId];return!(e.bondType!=="-"||t.isTerminal()||i.isTerminal()||t.value.rings.length>0&&i.value.rings.length>0&&this.areVerticesInSameRing(t,i))}isRingAromatic(e){for(var t=0;t<e.members.length;t++)if(!this.graph.vertices[e.members[t]].value.isPartOfAromaticRing)return!1;return!0}getEdgeNormals(e){let t=this.graph.vertices[e.sourceId].position,i=this.graph.vertices[e.targetId].position;return F.units(t,i)}getNonRingNeighbours(e){let t=Array(),i=this.graph.vertices[e],n=i.neighbours;for(var s=0;s<n.length;s++){let a=this.graph.vertices[n[s]];be.intersection(i.value.rings,a.value.rings).length===0&&a.value.isBridge==!1&&t.push(a)}return t}annotateStereochemistry(){let e=10;for(var t=0;t<this.graph.vertices.length;t++){let a=this.graph.vertices[t];if(!a.value.isStereoCenter)continue;let r=a.getNeighbours(),h=r.length,o=Array(h);for(var i=0;i<h;i++){let M=new Uint8Array(this.graph.vertices.length),O=Array(Array());M[a.id]=1,this.visitStereochemistry(r[i],a.id,M,O,e,0);for(var n=0;n<O.length;n++)O[n].sort(function(z,I){return I-z});o[i]=[i,O]}let d=0,c=0;for(var i=0;i<o.length;i++){o[i][1].length>d&&(d=o[i][1].length);for(var n=0;n<o[i][1].length;n++)o[i][1][n].length>c&&(c=o[i][1][n].length)}for(var i=0;i<o.length;i++){let O=d-o[i][1].length;for(var n=0;n<O;n++)o[i][1].push([]);o[i][1].push([r[i]]);for(var n=0;n<o[i][1].length;n++){let I=c-o[i][1][n].length;for(var s=0;s<I;s++)o[i][1][n].push(0)}}o.sort(function(M,O){for(var z=0;z<M[1].length;z++)for(var I=0;I<M[1][z].length;I++){if(M[1][z][I]>O[1][z][I])return-1;if(M[1][z][I]<O[1][z][I])return 1}return 0});let u=new Uint8Array(h);for(var i=0;i<h;i++)u[i]=o[i][0],a.value.priority=i;let m=this.graph.vertices[r[u[0]]].position,S=this.graph.vertices[r[u[1]]].position,p=this.graph.vertices[r[u[2]]].position,w=m.relativeClockwise(S,a.position);m.relativeClockwise(p,a.position);let k=w===-1,D=a.value.bracket.chirality==="@"?-1:1,x=H.parityOfPermutation(u)*D===1?"R":"S",N="down",B="up";(k&&x!=="R"||!k&&x!=="S")&&(a.value.hydrogenDirection="up",N="up",B="down"),a.value.hasHydrogen&&(this.graph.getEdge(a.id,r[u[u.length-1]]).wedge=N);let T=new Array(r.length-1),P=a.value.rings.length>1&&a.value.hasHydrogen,V=a.value.hasHydrogen?1:0;for(var i=0;i<u.length-V;i++){T[i]=new Uint32Array(2);let O=this.graph.vertices[r[u[i]]];T[i][0]+=O.value.isStereoCenter?0:1e5,T[i][0]+=this.areVerticesInSameRing(O,a)?0:1e4,T[i][0]+=O.value.isHeteroAtom()?1e3:0,T[i][0]-=O.value.subtreeDepth===0?1e3:0,T[i][0]+=1e3-O.value.subtreeDepth,T[i][1]=r[u[i]]}if(T.sort(function(M,O){return M[0]>O[0]?-1:M[0]<O[0]?1:0}),!P){let M=T[0][1];if(a.value.hasHydrogen)this.graph.getEdge(a.id,M).wedge=B;else{let O=B;for(var i=u.length-1;i>=0&&(O===N?O=B:O=N,r[u[i]]!==M);i--);this.graph.getEdge(a.id,M).wedge=O}}a.value.chirality=x}}visitStereochemistry(e,t,i,n,s,a,r=0){i[e]=1;let h=this.graph.vertices[e],o=h.value.getAtomicNumber();n.length<=a&&n.push(Array());for(var d=0;d<this.graph.getEdge(e,t).weight;d++)n[a].push(r*1e3+o);let c=this.graph.vertices[e].neighbours;for(var d=0;d<c.length;d++)i[c[d]]!==1&&a<s-1&&this.visitStereochemistry(c[d],e,i.slice(),n,s,a+1,o);if(a<s-1){let u=0;for(var d=0;d<c.length;d++)u+=this.graph.getEdge(e,c[d]).weight;for(var d=0;d<h.value.getMaxBonds()-u;d++)n.length<=a+1&&n.push(Array()),n[a+1].push(o*1e3+1)}}initPseudoElements(){for(var e=0;e<this.graph.vertices.length;e++){const i=this.graph.vertices[e],n=i.neighbours;let s=Array(n.length);for(var t=0;t<n.length;t++)s[t]=this.graph.vertices[n[t]];if(i.getNeighbourCount()<3||i.value.rings.length>0||i.value.element==="P"||i.value.element==="C"&&s.length===3&&s[0].value.element==="N"&&s[1].value.element==="N"&&s[2].value.element==="N")continue;let a=0,r=0;for(var t=0;t<s.length;t++){let d=s[t],c=d.value.element,u=d.getNeighbourCount();c!=="C"&&c!=="H"&&u===1&&a++,u>1&&r++}if(r>1||a<2)continue;let h=null;for(var t=0;t<s.length;t++){let d=s[t];d.getNeighbourCount()>1&&(h=d)}for(var t=0;t<s.length;t++){let d=s[t];if(d.getNeighbourCount()>1)continue;d.value.isDrawn=!1;let c=St.maxBonds[d.value.element]-d.value.bondCount,u="";d.value.bracket&&(c=d.value.bracket.hcount,u=d.value.bracket.charge||0),i.value.attachPseudoElement(d.value.element,h?h.value.element:null,c,u)}}for(var e=0;e<this.graph.vertices.length;e++){const n=this.graph.vertices[e],s=n.value,a=s.element;if(a==="C"||a==="H"||!s.isDrawn)continue;const r=n.neighbours;let h=Array(r.length);for(var t=0;t<r.length;t++)h[t]=this.graph.vertices[r[t]];for(var t=0;t<h.length;t++){let d=h[t].value;if(!d.hasAttachedPseudoElements||d.getAttachedPseudoElementsCount()!==2)continue;const c=d.getAttachedPseudoElements();c.hasOwnProperty("0O")&&c.hasOwnProperty("3C")&&(d.isDrawn=!1,n.value.attachPseudoElement("Ac","",0))}}}}var dn=qr,Hr=function(){function l(i,n){function s(){this.constructor=i}s.prototype=n.prototype,i.prototype=new s}function e(i,n,s,a){this.message=i,this.expected=n,this.found=s,this.location=a,this.name="SyntaxError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,e)}l(e,Error),e.buildMessage=function(i,n){var s={literal:function(u){return'"'+r(u.text)+'"'},class:function(u){var m="",S;for(S=0;S<u.parts.length;S++)m+=u.parts[S]instanceof Array?h(u.parts[S][0])+"-"+h(u.parts[S][1]):h(u.parts[S]);return"["+(u.inverted?"^":"")+m+"]"},any:function(u){return"any character"},end:function(u){return"end of input"},other:function(u){return u.description}};function a(u){return u.charCodeAt(0).toString(16).toUpperCase()}function r(u){return u.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(m){return"\\x0"+a(m)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(m){return"\\x"+a(m)})}function h(u){return u.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(m){return"\\x0"+a(m)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(m){return"\\x"+a(m)})}function o(u){return s[u.type](u)}function d(u){var m=new Array(u.length),S,p;for(S=0;S<u.length;S++)m[S]=o(u[S]);if(m.sort(),m.length>0){for(S=1,p=1;S<m.length;S++)m[S-1]!==m[S]&&(m[p]=m[S],p++);m.length=p}switch(m.length){case 1:return m[0];case 2:return m[0]+" or "+m[1];default:return m.slice(0,-1).join(", ")+", or "+m[m.length-1]}}function c(u){return u?'"'+r(u)+'"':"end of input"}return"Expected "+d(i)+" but "+c(n)+" found."};function t(i,n){n=n!==void 0?n:{};var s=i.split("(").length-1,a=i.split(")").length-1;if(s!==a)throw Ti("The number of opening parentheses does not match the number of closing parentheses.",0);var r={},h={chain:mt},o=mt,d=function(b){for(var g=[],y=[],v=0;v<b[1].length;v++)g.push(b[1][v]);for(var v=0;v<b[2].length;v++){var C=b[2][v][0]?b[2][v][0]:"-";y.push({bond:C,id:b[2][v][1]})}for(var v=0;v<b[3].length;v++)g.push(b[3][v]);for(var v=0;v<b[6].length;v++)g.push(b[6][v]);return{atom:b[0],isBracket:!!b[0].element,branches:g,branchCount:g.length,ringbonds:y,ringbondCount:y.length,bond:b[4]?b[4]:"-",next:b[5],hasNext:!!b[5]}},c="(",u=Y("(",!1),m=")",S=Y(")",!1),p=function(b){var g=b[1]?b[1]:"-";return b[2].branchBond=g,b[2]},w=function(b){return b},k=/^[\-=#$:\/\\.]/,D=pe(["-","=","#","$",":","/","\\","."],!1,!1),x=function(b){return b},N="[",B=Y("[",!1),T="se",P=Y("se",!1),V="as",M=Y("as",!1),O="]",z=Y("]",!1),I=function(b){return{isotope:b[1],element:b[2],chirality:b[3],hcount:b[4],charge:b[5],class:b[6]}},he="B",fe=Y("B",!1),de="r",ae=Y("r",!1),Ae="C",Q=Y("C",!1),j="l",Xt=Y("l",!1),We=/^[NOPSFI]/,qe=pe(["N","O","P","S","F","I"],!1,!1),He=function(b){return b.length>1?b.join(""):b},Ye=/^[bcnops]/,ct=pe(["b","c","n","o","p","s"],!1,!1),Xe="*",L=Y("*",!1),K=function(b){return b},Se=/^[A-Z]/,ue=pe([["A","Z"]],!1,!1),ye=/^[a-z]/,ce=pe([["a","z"]],!1,!1),le=function(b){return b.join("")},oe="%",Qe=Y("%",!1),ge=/^[1-9]/,Z=pe([["1","9"]],!1,!1),G=/^[0-9]/,J=pe([["0","9"]],!1,!1),Te=function(b){return b.length==1?Number(b):Number(b.join("").replace("%",""))},Ne="@",Ue=Y("@",!1),Ge="TH",_e=Y("TH",!1),Fe=/^[12]/,xe=pe(["1","2"],!1,!1),$e="AL",je=Y("AL",!1),Ke="SP",Ze=Y("SP",!1),bn=/^[1-3]/,Sn=pe([["1","3"]],!1,!1),wi="TB",yn=Y("TB",!1),ki="OH",wn=Y("OH",!1),kn=function(b){return b[1]?b[1]=="@"?"@@":b[1].join("").replace(",",""):"@"},Cn=function(b){return b},Ci="+",Ai=Y("+",!1),An=function(b){return b[1]?b[1]!="+"?Number(b[1].join("")):2:1},Ni="-",xi=Y("-",!1),Nn=function(b){return b[1]?b[1]!="-"?-Number(b[1].join("")):-2:-1},xn="H",Rn=Y("H",!1),Dn=function(b){return b[1]?Number(b[1]):1},Tn=":",En=Y(":",!1),Fn=/^[0]/,$n=pe(["0"],!1,!1),Ln=function(b){return Number(b[1][0]+b[1][1].join(""))},Pn=function(b){return Number(b.join(""))},f=0,gt=[{line:1,column:1}],me=0,Qt=[],ft;if("startRule"in n){if(!(n.startRule in h))throw new Error(`Can't start parsing from rule "`+n.startRule+'".');o=h[n.startRule]}function Y(b,g){return{type:"literal",text:b,ignoreCase:g}}function pe(b,g,y){return{type:"class",parts:b,inverted:g,ignoreCase:y}}function Bn(){return{type:"end"}}function Ri(b){var g=gt[b],y;if(g)return g;for(y=b-1;!gt[y];)y--;for(g=gt[y],g={line:g.line,column:g.column};y<b;)i.charCodeAt(y)===10?(g.line++,g.column=1):g.column++,y++;return gt[b]=g,g}function Di(b,g){var y=Ri(b),v=Ri(g);return{start:{offset:b,line:y.line,column:y.column},end:{offset:g,line:v.line,column:v.column}}}function E(b){f<me||(f>me&&(me=f,Qt=[]),Qt.push(b))}function Ti(b,g){return new e(b,null,null,g)}function On(b,g,y){return new e(e.buildMessage(b,g),b,g,y)}function mt(){var b,g,y,v,C,R,$,_,ve,we;if(b=f,g=f,y=In(),y!==r){for(v=[],C=Le();C!==r;)v.push(C),C=Le();if(v!==r){for(C=[],R=f,$=pt(),$===r&&($=null),$!==r?(_=$i(),_!==r?($=[$,_],R=$):(f=R,R=r)):(f=R,R=r);R!==r;)C.push(R),R=f,$=pt(),$===r&&($=null),$!==r?(_=$i(),_!==r?($=[$,_],R=$):(f=R,R=r)):(f=R,R=r);if(C!==r){for(R=[],$=Le();$!==r;)R.push($),$=Le();if(R!==r)if($=pt(),$===r&&($=null),$!==r)if(_=mt(),_===r&&(_=null),_!==r){for(ve=[],we=Le();we!==r;)ve.push(we),we=Le();ve!==r?(y=[y,v,C,R,$,_,ve],g=y):(f=g,g=r)}else f=g,g=r;else f=g,g=r;else f=g,g=r}else f=g,g=r}else f=g,g=r}else f=g,g=r;return g!==r&&(g=d(g)),b=g,b}function Le(){var b,g,y,v,C,R;return b=f,g=f,i.charCodeAt(f)===40?(y=c,f++):(y=r,E(u)),y!==r?(v=pt(),v===r&&(v=null),v!==r?(C=mt(),C!==r?(i.charCodeAt(f)===41?(R=m,f++):(R=r,E(S)),R!==r?(y=[y,v,C,R],g=y):(f=g,g=r)):(f=g,g=r)):(f=g,g=r)):(f=g,g=r),g!==r&&(g=p(g)),b=g,b}function In(){var b,g;return b=f,g=zn(),g===r&&(g=Ei(),g===r&&(g=Mn(),g===r&&(g=Fi()))),g!==r&&(g=w(g)),b=g,b}function pt(){var b,g;if(b=f,k.test(i.charAt(f))){if(g=i.charAt(f),g===i.charAt(f+1))throw g=r,Ti("The parser encountered a bond repetition.",f+1);f++}else g=r,E(D);return g!==r&&(g=x(g)),b=g,b}function Mn(){var b,g,y,v,C,R,$,_,ve,we;return b=f,g=f,i.charCodeAt(f)===91?(y=N,f++):(y=r,E(B)),y!==r?(v=Un(),v===r&&(v=null),v!==r?(i.substr(f,2)===T?(C=T,f+=2):(C=r,E(P)),C===r&&(i.substr(f,2)===V?(C=V,f+=2):(C=r,E(M)),C===r&&(C=Ei(),C===r&&(C=Vn(),C===r&&(C=Fi())))),C!==r?(R=Wn(),R===r&&(R=null),R!==r?($=Xn(),$===r&&($=null),$!==r?(_=qn(),_===r&&(_=null),_!==r?(ve=Qn(),ve===r&&(ve=null),ve!==r?(i.charCodeAt(f)===93?(we=O,f++):(we=r,E(z)),we!==r?(y=[y,v,C,R,$,_,ve,we],g=y):(f=g,g=r)):(f=g,g=r)):(f=g,g=r)):(f=g,g=r)):(f=g,g=r)):(f=g,g=r)):(f=g,g=r)):(f=g,g=r),g!==r&&(g=I(g)),b=g,b}function zn(){var b,g,y,v;return b=f,g=f,i.charCodeAt(f)===66?(y=he,f++):(y=r,E(fe)),y!==r?(i.charCodeAt(f)===114?(v=de,f++):(v=r,E(ae)),v===r&&(v=null),v!==r?(y=[y,v],g=y):(f=g,g=r)):(f=g,g=r),g===r&&(g=f,i.charCodeAt(f)===67?(y=Ae,f++):(y=r,E(Q)),y!==r?(i.charCodeAt(f)===108?(v=j,f++):(v=r,E(Xt)),v===r&&(v=null),v!==r?(y=[y,v],g=y):(f=g,g=r)):(f=g,g=r),g===r&&(We.test(i.charAt(f))?(g=i.charAt(f),f++):(g=r,E(qe)))),g!==r&&(g=He(g)),b=g,b}function Ei(){var b,g;return b=f,Ye.test(i.charAt(f))?(g=i.charAt(f),f++):(g=r,E(ct)),g!==r&&(g=w(g)),b=g,b}function Fi(){var b,g;return b=f,i.charCodeAt(f)===42?(g=Xe,f++):(g=r,E(L)),g!==r&&(g=K(g)),b=g,b}function Vn(){var b,g,y,v;return b=f,g=f,Se.test(i.charAt(f))?(y=i.charAt(f),f++):(y=r,E(ue)),y!==r?(ye.test(i.charAt(f))?(v=i.charAt(f),f++):(v=r,E(ce)),v===r&&(v=null),v!==r?(y=[y,v],g=y):(f=g,g=r)):(f=g,g=r),g!==r&&(g=le(g)),b=g,b}function $i(){var b,g,y,v,C;return b=f,g=f,i.charCodeAt(f)===37?(y=oe,f++):(y=r,E(Qe)),y!==r?(ge.test(i.charAt(f))?(v=i.charAt(f),f++):(v=r,E(Z)),v!==r?(G.test(i.charAt(f))?(C=i.charAt(f),f++):(C=r,E(J)),C!==r?(y=[y,v,C],g=y):(f=g,g=r)):(f=g,g=r)):(f=g,g=r),g===r&&(G.test(i.charAt(f))?(g=i.charAt(f),f++):(g=r,E(J))),g!==r&&(g=Te(g)),b=g,b}function Wn(){var b,g,y,v,C,R,$;return b=f,g=f,i.charCodeAt(f)===64?(y=Ne,f++):(y=r,E(Ue)),y!==r?(i.charCodeAt(f)===64?(v=Ne,f++):(v=r,E(Ue)),v===r&&(v=f,i.substr(f,2)===Ge?(C=Ge,f+=2):(C=r,E(_e)),C!==r?(Fe.test(i.charAt(f))?(R=i.charAt(f),f++):(R=r,E(xe)),R!==r?(C=[C,R],v=C):(f=v,v=r)):(f=v,v=r),v===r&&(v=f,i.substr(f,2)===$e?(C=$e,f+=2):(C=r,E(je)),C!==r?(Fe.test(i.charAt(f))?(R=i.charAt(f),f++):(R=r,E(xe)),R!==r?(C=[C,R],v=C):(f=v,v=r)):(f=v,v=r),v===r&&(v=f,i.substr(f,2)===Ke?(C=Ke,f+=2):(C=r,E(Ze)),C!==r?(bn.test(i.charAt(f))?(R=i.charAt(f),f++):(R=r,E(Sn)),R!==r?(C=[C,R],v=C):(f=v,v=r)):(f=v,v=r),v===r&&(v=f,i.substr(f,2)===wi?(C=wi,f+=2):(C=r,E(yn)),C!==r?(ge.test(i.charAt(f))?(R=i.charAt(f),f++):(R=r,E(Z)),R!==r?(G.test(i.charAt(f))?($=i.charAt(f),f++):($=r,E(J)),$===r&&($=null),$!==r?(C=[C,R,$],v=C):(f=v,v=r)):(f=v,v=r)):(f=v,v=r),v===r&&(v=f,i.substr(f,2)===ki?(C=ki,f+=2):(C=r,E(wn)),C!==r?(ge.test(i.charAt(f))?(R=i.charAt(f),f++):(R=r,E(Z)),R!==r?(G.test(i.charAt(f))?($=i.charAt(f),f++):($=r,E(J)),$===r&&($=null),$!==r?(C=[C,R,$],v=C):(f=v,v=r)):(f=v,v=r)):(f=v,v=r)))))),v===r&&(v=null),v!==r?(y=[y,v],g=y):(f=g,g=r)):(f=g,g=r),g!==r&&(g=kn(g)),b=g,b}function qn(){var b,g;return b=f,g=Hn(),g===r&&(g=Yn()),g!==r&&(g=Cn(g)),b=g,b}function Hn(){var b,g,y,v,C,R;return b=f,g=f,i.charCodeAt(f)===43?(y=Ci,f++):(y=r,E(Ai)),y!==r?(i.charCodeAt(f)===43?(v=Ci,f++):(v=r,E(Ai)),v===r&&(v=f,ge.test(i.charAt(f))?(C=i.charAt(f),f++):(C=r,E(Z)),C!==r?(G.test(i.charAt(f))?(R=i.charAt(f),f++):(R=r,E(J)),R===r&&(R=null),R!==r?(C=[C,R],v=C):(f=v,v=r)):(f=v,v=r)),v===r&&(v=null),v!==r?(y=[y,v],g=y):(f=g,g=r)):(f=g,g=r),g!==r&&(g=An(g)),b=g,b}function Yn(){var b,g,y,v,C,R;return b=f,g=f,i.charCodeAt(f)===45?(y=Ni,f++):(y=r,E(xi)),y!==r?(i.charCodeAt(f)===45?(v=Ni,f++):(v=r,E(xi)),v===r&&(v=f,ge.test(i.charAt(f))?(C=i.charAt(f),f++):(C=r,E(Z)),C!==r?(G.test(i.charAt(f))?(R=i.charAt(f),f++):(R=r,E(J)),R===r&&(R=null),R!==r?(C=[C,R],v=C):(f=v,v=r)):(f=v,v=r)),v===r&&(v=null),v!==r?(y=[y,v],g=y):(f=g,g=r)):(f=g,g=r),g!==r&&(g=Nn(g)),b=g,b}function Xn(){var b,g,y,v;return b=f,g=f,i.charCodeAt(f)===72?(y=xn,f++):(y=r,E(Rn)),y!==r?(G.test(i.charAt(f))?(v=i.charAt(f),f++):(v=r,E(J)),v===r&&(v=null),v!==r?(y=[y,v],g=y):(f=g,g=r)):(f=g,g=r),g!==r&&(g=Dn(g)),b=g,b}function Qn(){var b,g,y,v,C,R,$;if(b=f,g=f,i.charCodeAt(f)===58?(y=Tn,f++):(y=r,E(En)),y!==r){if(v=f,ge.test(i.charAt(f))?(C=i.charAt(f),f++):(C=r,E(Z)),C!==r){for(R=[],G.test(i.charAt(f))?($=i.charAt(f),f++):($=r,E(J));$!==r;)R.push($),G.test(i.charAt(f))?($=i.charAt(f),f++):($=r,E(J));R!==r?(C=[C,R],v=C):(f=v,v=r)}else f=v,v=r;v===r&&(Fn.test(i.charAt(f))?(v=i.charAt(f),f++):(v=r,E($n))),v!==r?(y=[y,v],g=y):(f=g,g=r)}else f=g,g=r;return g!==r&&(g=Ln(g)),b=g,b}function Un(){var b,g,y,v,C;return b=f,g=f,ge.test(i.charAt(f))?(y=i.charAt(f),f++):(y=r,E(Z)),y!==r?(G.test(i.charAt(f))?(v=i.charAt(f),f++):(v=r,E(J)),v===r&&(v=null),v!==r?(G.test(i.charAt(f))?(C=i.charAt(f),f++):(C=r,E(J)),C===r&&(C=null),C!==r?(y=[y,v,C],g=y):(f=g,g=r)):(f=g,g=r)):(f=g,g=r),g!==r&&(g=Pn(g)),b=g,b}if(ft=o(),ft!==r&&f===i.length)return ft;throw ft!==r&&f<i.length&&E(Bn()),On(Qt,me<i.length?i.charAt(me):null,me<i.length?Di(me,me+1):Di(me,me))}return{SyntaxError:e,parse:t}}();const{getChargeText:zi}=ln,Yr=fi,te=Ee;class Xr{constructor(e,t,i){this.svg=document.getElementById(t),this.opts=i,this.gradientId=0,this.paths=[],this.vertices=[],this.gradients=[],this.offsetX=0,this.offsetY=0,this.drawingWidth=0,this.drawingHeight=0,this.halfBondThickness=this.opts.bondThickness/2,this.themeManager=e,this.maskElements=[];let n=document.createElementNS("http://www.w3.org/2000/svg","rect");for(n.setAttributeNS(null,"x",0),n.setAttributeNS(null,"y",0),n.setAttributeNS(null,"width","100%"),n.setAttributeNS(null,"height","100%"),n.setAttributeNS(null,"fill","white"),this.maskElements.push(n);this.svg.firstChild;)this.svg.removeChild(this.svg.firstChild)}constructSvg(){let e=document.createElementNS("http://www.w3.org/2000/svg","defs"),t=document.createElementNS("http://www.w3.org/2000/svg","mask"),i=document.createElementNS("http://www.w3.org/2000/svg","style"),n=document.createElementNS("http://www.w3.org/2000/svg","g"),s=document.createElementNS("http://www.w3.org/2000/svg","g"),a=this.paths;t.setAttributeNS(null,"id","text-mask"),i.appendChild(document.createTextNode(`
                .element {
                    font: ${this.opts.fontSizeLarge}pt Helvetica, Arial, sans-serif;
                    alignment-baseline: 'middle';
                }
                .sub {
                    font: ${this.opts.fontSizeSmall}pt Helvetica, Arial, sans-serif;
                }
            `));for(let r of a)n.appendChild(r);for(let r of this.vertices)s.appendChild(r);for(let r of this.maskElements)t.appendChild(r);for(let r of this.gradients)e.appendChild(r);if(n.setAttributeNS(null,"mask","url(#text-mask)"),this.svg)return this.svg.appendChild(e),this.svg.appendChild(t),this.svg.appendChild(i),this.svg.appendChild(n),this.svg.appendChild(s),this.svg;{let r=document.createElementNS("http://www.w3.org/2000/svg","g");return r.appendChild(e),r.appendChild(t),r.appendChild(i),r.appendChild(n),r.appendChild(s),r}}createGradient(e){let t=document.createElementNS("http://www.w3.org/2000/svg","linearGradient"),i=`line-${this.gradientId++}`,n=e.getLeftVector(),s=e.getRightVector(),a=n.x+this.offsetX,r=n.y+this.offsetY,h=s.x+this.offsetX,o=s.y+this.offsetY;t.setAttributeNS(null,"id",i),t.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),t.setAttributeNS(null,"x1",a),t.setAttributeNS(null,"y1",r),t.setAttributeNS(null,"x2",h),t.setAttributeNS(null,"y2",o);let d=document.createElementNS("http://www.w3.org/2000/svg","stop");d.setAttributeNS(null,"stop-color",this.themeManager.getColor(e.getLeftElement())||this.themeManager.getColor("C")),d.setAttributeNS(null,"offset","20%");let c=document.createElementNS("http://www.w3.org/2000/svg","stop");return c.setAttributeNS(null,"stop-color",this.themeManager.getColor(e.getRightElement()||this.themeManager.getColor("C"))),c.setAttributeNS(null,"offset","100%"),t.appendChild(d),t.appendChild(c),this.gradients.push(t),i}createSubSuperScripts(e,t){let i=document.createElementNS("http://www.w3.org/2000/svg","tspan");return i.setAttributeNS(null,"baseline-shift",t),i.appendChild(document.createTextNode(e)),i.setAttributeNS(null,"class","sub"),i}determineDimensions(e){let t=-Number.MAX_VALUE,i=-Number.MAX_VALUE,n=Number.MAX_VALUE,s=Number.MAX_VALUE;for(var a=0;a<e.length;a++){if(!e[a].value.isDrawn)continue;let u=e[a].position;t<u.x&&(t=u.x),i<u.y&&(i=u.y),n>u.x&&(n=u.x),s>u.y&&(s=u.y)}let r=this.opts.padding;t+=r,i+=r,n-=r,s-=r,this.drawingWidth=t-n,this.drawingHeight=i-s;let h=this.svg.clientWidth/this.drawingWidth,o=this.svg.clientHeight/this.drawingHeight,d=h<o?h:o,c=Math.round(this.drawingWidth>this.drawingHeight?this.drawingWidth:this.drawingHeight);this.svg.setAttributeNS(null,"viewBox",`0 0 ${c} ${c}`),this.offsetX=-n,this.offsetY=-s,h<o?this.offsetY+=this.svg.clientHeight/(2*d)-this.drawingHeight/2:this.offsetX+=this.svg.clientWidth/(2*d)-this.drawingWidth/2}drawBall(e,t,i){let n=document.createElementNS("http://www.w3.org/2000/svg","circle");n.setAttributeNS(null,"cx",e+this.offsetX),n.setAttributeNS(null,"cy",t+this.offsetY),n.setAttributeNS(null,"r",this.opts.bondLength/4.5),n.setAttributeNS(null,"fill",this.themeManager.getColor(i)),this.vertices.push(n)}drawDashedWedge(e){if(isNaN(e.from.x)||isNaN(e.from.y)||isNaN(e.to.x)||isNaN(e.to.y))return;this.offsetX,this.offsetY;let t=e.getLeftVector().clone(),i=e.getRightVector().clone(),n=te.normals(t,i);n[0].normalize(),n[1].normalize();let s=e.getRightChiral(),a,r;s?(a=i,r=t):(a=t,r=i);let h=te.subtract(r,a).normalize(),o=e.getLength(),d=1.25/(o/(this.opts.bondThickness*3)),c=this.createGradient(e);for(let u=0;u<1;u+=d){let m=te.multiplyScalar(h,u*o),S=te.add(a,m),p=1.5*u,w=te.multiplyScalar(n[0],p);S.subtract(w);let k=S.clone();k.add(te.multiplyScalar(w,2)),this.drawLine(new Yr(S,k),null,c)}}drawDebugPoint(e,t,i="",n="#f00"){let s=document.createElementNS("http://www.w3.org/2000/svg","circle");s.setAttributeNS(null,"cx",e+this.offsetX),s.setAttributeNS(null,"cy",t+this.offsetY),s.setAttributeNS(null,"r","2"),s.setAttributeNS(null,"fill","#f00"),this.vertices.push(s),this.drawDebugText(e,t,i)}drawDebugText(e,t,i){let n=document.createElementNS("http://www.w3.org/2000/svg","text");n.setAttributeNS(null,"x",e+this.offsetX),n.setAttributeNS(null,"y",t+this.offsetY),n.setAttributeNS(null,"class","debug"),n.setAttributeNS(null,"fill","#ff0000"),n.setAttributeNS(null,"style",`
                font: 5px Droid Sans, sans-serif;
            `),n.appendChild(document.createTextNode(i)),this.vertices.push(n)}drawLine(e,t=!1,i=null){this.opts;let n=[["stroke-linecap","round"],["stroke-dasharray",t?"5, 5":"none"]],s=e.getLeftVector(),a=e.getRightVector(),r=s.x+this.offsetX,h=s.y+this.offsetY,o=a.x+this.offsetX,d=a.y+this.offsetY,c=n.map(m=>m.join(":")).join(";"),u=document.createElementNS("http://www.w3.org/2000/svg","line");u.setAttributeNS(null,"x1",r),u.setAttributeNS(null,"y1",h),u.setAttributeNS(null,"x2",o),u.setAttributeNS(null,"y2",d),u.setAttributeNS(null,"style",c),this.paths.push(u),i==null&&(i=this.createGradient(e,r,h,o,d)),u.setAttributeNS(null,"stroke",`url('#${i}')`)}drawPoint(e,t,i){this.ctx;let n=this.offsetX,s=this.offsetY,a=document.createElementNS("http://www.w3.org/2000/svg","circle");a.setAttributeNS(null,"cx",e+n),a.setAttributeNS(null,"cy",t+s),a.setAttributeNS(null,"r","1.5"),a.setAttributeNS(null,"fill","black"),this.maskElements.push(a);let r=document.createElementNS("http://www.w3.org/2000/svg","circle");r.setAttributeNS(null,"cx",e+n),r.setAttributeNS(null,"cy",t+s),r.setAttributeNS(null,"r","0.75"),r.setAttributeNS(null,"fill",this.themeManager.getColor(i)),this.vertices.push(r)}drawText(e,t,i,n,s,a,r,h,o={}){let d=this.offsetX,c=this.offsetY,u={x:e+d,y:t+c},m=document.createElementNS("http://www.w3.org/2000/svg","text"),S="horizontal-tb",p="normal",w="mixed",k="direction: ltr;",D=-2,x=2.5,N=document.createElementNS("http://www.w3.org/2000/svg","circle");N.setAttributeNS(null,"cx",u.x),N.setAttributeNS(null,"cy",u.y),N.setAttributeNS(null,"r","3.5"),N.setAttributeNS(null,"fill","black"),this.maskElements.push(N),/up|down/.test(s)&&!a&&(S="vertical-rl",w="upright",p="-1px"),s==="down"&&!a?(D=0,x=-2):s==="up"&&!a?D=.5:s==="left"&&(D=2),(s==="left"||s==="up"&&!a)&&(k="direction: rtl; unicode-bidi: bidi-override;"),m.setAttributeNS(null,"x",u.x+D),m.setAttributeNS(null,"y",u.y+x),m.setAttributeNS(null,"class","element"),m.setAttributeNS(null,"fill",this.themeManager.getColor(i)),m.setAttributeNS(null,"style",`
                text-anchor: start;
                writing-mode: ${S};
                text-orientation: ${w};
                letter-spacing: ${p};
                ${k}
            `);let B=document.createElementNS("http://www.w3.org/2000/svg","tspan");if(i.length>1){let T=/up|down/.test(s)?"middle":"start";B.setAttributeNS(null,"style",`
                unicode-bidi: plaintext;
                writing-mode: lr-tb;
                letter-spacing: normal;
                text-anchor: ${T};
            `)}if(B.appendChild(document.createTextNode(i)),m.appendChild(B),r){let T=this.createSubSuperScripts(zi(r),"super");B.appendChild(T)}if(h>0){let T=this.createSubSuperScripts(h.toString(),"super");B.appendChild(T)}if(r===1&&i==="N"&&o.hasOwnProperty("0O")&&o.hasOwnProperty("0O-1")&&(o={"0O":{element:"O",count:2,hydrogenCount:0,previousElement:"C",charge:""}},r=0),n>0){let T=document.createElementNS("http://www.w3.org/2000/svg","tspan");if(T.setAttributeNS(null,"style","unicode-bidi: plaintext;"),T.appendChild(document.createTextNode("H")),m.appendChild(T),n>1){let P=this.createSubSuperScripts(n,"sub");T.appendChild(P)}}for(let T in o){if(!o.hasOwnProperty(T))continue;let P=o[T].element,V=o[T].count,M=o[T].hydrogenCount,O=o[T].charge,z=document.createElementNS("http://www.w3.org/2000/svg","tspan");if(z.setAttributeNS(null,"style","unicode-bidi: plaintext;"),z.appendChild(document.createTextNode(P)),z.setAttributeNS(null,"fill",this.themeManager.getColor(P)),O!==0){let I=this.createSubSuperScripts(zi(O),"super");z.appendChild(I)}if(M>0){let I=document.createElementNS("http://www.w3.org/2000/svg","tspan");if(I.setAttributeNS(null,"style","unicode-bidi: plaintext;"),I.appendChild(document.createTextNode("H")),z.appendChild(I),M>1){let he=this.createSubSuperScripts(M,"sub");I.appendChild(he)}}if(V>1){let I=this.createSubSuperScripts(V,"sub");z.appendChild(I)}m.appendChild(z)}this.vertices.push(m)}drawWedge(e){let t=this.offsetX,i=this.offsetY,n=e.getLeftVector().clone(),s=e.getRightVector().clone();n.x+=t,n.y+=i,s.x+=t,s.y+=i;let a=te.normals(n,s);a[0].normalize(),a[1].normalize();let r=e.getRightChiral(),h=n,o=s;r&&(h=s,o=n);let d=te.add(h,te.multiplyScalar(a[0],this.halfBondThickness)),c=te.add(o,te.multiplyScalar(a[0],1.5+this.halfBondThickness)),u=te.add(o,te.multiplyScalar(a[1],1.5+this.halfBondThickness)),m=te.add(h,te.multiplyScalar(a[1],this.halfBondThickness)),S=document.createElementNS("http://www.w3.org/2000/svg","polygon"),p=this.createGradient(e,n.x,n.y,s.x,s.y);S.setAttributeNS(null,"points",`${d.x},${d.y} ${c.x},${c.y} ${u.x},${u.y} ${m.x},${m.y}`),S.setAttributeNS(null,"fill",`url('#${p}')`),this.paths.push(S)}}var Qr=Xr;const Vi=st,Ur=pi,Gr=dn,ie=fi,_r=Qr,jr=hn,U=Ee;class Kr{constructor(e){this.preprocessor=new Gr(e)}draw(e,t,i="light",n=!1){let s=this.preprocessor;return s.initDraw(e,i,n),n||(this.themeManager=new jr(this.preprocessor.opts.themes,i),this.svgWrapper=new _r(this.themeManager,t,this.preprocessor.opts)),s.processGraph(),this.svgWrapper.determineDimensions(s.graph.vertices),this.drawEdges(s.opts.debug),this.drawVertices(s.opts.debug),s.opts.debug&&(console.log(s.graph),console.log(s.rings),console.log(s.ringConnections)),this.svgWrapper.constructSvg()}drawAromaticityRing(e){let t=this.ctx,i=MathHelper.apothemFromSideLength(this.opts.bondLength,e.getSize());t.save(),t.strokeStyle=this.getColor("C"),t.lineWidth=this.opts.bondThickness,t.beginPath(),t.arc(e.center.x+this.offsetX,e.center.y+this.offsetY,i-this.opts.bondSpacing,0,Math.PI*2,!0),t.closePath(),t.stroke(),t.restore()}drawEdges(e){let t=this.preprocessor,i=t.graph,n=t.rings,s=Array(this.preprocessor.graph.edges.length);if(s.fill(!1),i.traverseBF(0,r=>{let h=i.getEdges(r.id);for(var o=0;o<h.length;o++){let d=h[o];s[d]||(s[d]=!0,this.drawEdge(d,e))}}),!this.bridgedRing)for(var a=0;a<n.length;a++){let r=n[a];t.isRingAromatic(r)&&this.drawAromaticityRing(r)}}drawEdge(e,t){let i=this.preprocessor,n=i.opts,s=this.svgWrapper,a=i.graph.edges[e],r=i.graph.vertices[a.sourceId],h=i.graph.vertices[a.targetId],o=r.value.element,d=h.value.element;if((!r.value.isDrawn||!h.value.isDrawn)&&i.opts.atomVisualization==="default")return;let c=r.position,u=h.position,m=i.getEdgeNormals(a),S=Vi.clone(m);if(S[0].multiplyScalar(10).add(c),S[1].multiplyScalar(10).add(c),a.bondType==="="||i.getRingbondType(r,h)==="="||a.isPartOfAromaticRing&&i.bridgedRing){let p=i.areVerticesInSameRing(r,h),w=i.chooseSide(r,h,S);if(p){let D=i.getLargestOrAromaticCommonRing(r,h).center;m[0].multiplyScalar(n.bondSpacing),m[1].multiplyScalar(n.bondSpacing);let x=null;D.sameSideAs(r.position,h.position,U.add(c,m[0]))?x=new ie(U.add(c,m[0]),U.add(u,m[0]),o,d):x=new ie(U.add(c,m[1]),U.add(u,m[1]),o,d),x.shorten(n.bondLength-n.shortBondLength*n.bondLength),a.isPartOfAromaticRing?s.drawLine(x,!0):s.drawLine(x),s.drawLine(new ie(c,u,o,d))}else if(a.center||r.isTerminal()&&h.isTerminal()||w.anCount==0&&w.bnCount>1||w.bnCount==0&&w.anCount>1){this.multiplyNormals(m,n.halfBondSpacing);let k=new ie(U.add(c,m[0]),U.add(u,m[0]),o,d),D=new ie(U.add(c,m[1]),U.add(u,m[1]),o,d);s.drawLine(k),s.drawLine(D)}else if(w.sideCount[0]>w.sideCount[1]||w.totalSideCount[0]>w.totalSideCount[1]){this.multiplyNormals(m,n.bondSpacing);let k=new ie(U.add(c,m[0]),U.add(u,m[0]),o,d);k.shorten(n.bondLength-n.shortBondLength*n.bondLength),s.drawLine(k),s.drawLine(new ie(c,u,o,d))}else if(w.sideCount[0]<w.sideCount[1]||w.totalSideCount[0]<=w.totalSideCount[1]){this.multiplyNormals(m,n.bondSpacing);let k=new ie(U.add(c,m[1]),U.add(u,m[1]),o,d);k.shorten(n.bondLength-n.shortBondLength*n.bondLength),s.drawLine(k),s.drawLine(new ie(c,u,o,d))}}else if(a.bondType==="#"){m[0].multiplyScalar(n.bondSpacing/1.5),m[1].multiplyScalar(n.bondSpacing/1.5);let p=new ie(U.add(c,m[0]),U.add(u,m[0]),o,d),w=new ie(U.add(c,m[1]),U.add(u,m[1]),o,d);s.drawLine(p),s.drawLine(w),s.drawLine(new ie(c,u,o,d))}else if(a.bondType!=="."){let p=r.value.isStereoCenter,w=h.value.isStereoCenter;a.wedge==="up"?s.drawWedge(new ie(c,u,o,d,p,w)):a.wedge==="down"?s.drawDashedWedge(new ie(c,u,o,d,p,w)):s.drawLine(new ie(c,u,o,d,p,w))}if(t){let p=U.midpoint(c,u);s.drawDebugText(p.x,p.y,"e: "+e)}}drawVertices(e){let t=this.preprocessor,i=t.opts,n=t.graph,s=t.rings,a=this.svgWrapper;for(var r=n.vertices.length,r=0;r<n.vertices.length;r++){let o=n.vertices[r],d=o.value,c=0,u=0,m=o.value.bondCount,S=d.element,p=Ur.maxBonds[S]-m,w=o.getTextDirection(n.vertices),k=i.terminalCarbons||S!=="C"||d.hasAttachedPseudoElements?o.isTerminal():!1,D=d.element==="C";if(d.element==="N"&&d.isPartOfAromaticRing&&(p=0),d.bracket&&(p=d.bracket.hcount,c=d.bracket.charge,u=d.bracket.isotope),i.atomVisualization==="allballs")a.drawBall(o.position.x,o.position.y,S);else if(d.isDrawn&&(!D||d.drawExplicit||k||d.hasAttachedPseudoElements)||n.vertices.length===1)i.atomVisualization==="default"?a.drawText(o.position.x,o.position.y,S,p,w,k,c,u,d.getAttachedPseudoElements()):i.atomVisualization==="balls"&&a.drawBall(o.position.x,o.position.y,S);else if(o.getNeighbourCount()===2&&o.forcePositioned==!0){let x=n.vertices[o.neighbours[0]].position,N=n.vertices[o.neighbours[1]].position,B=U.threePointangle(o.position,x,N);Math.abs(Math.PI-B)<.1&&a.drawPoint(o.position.x,o.position.y,S)}if(e){let x="v: "+o.id+" "+Vi.print(d.ringbonds);a.drawDebugText(o.position.x,o.position.y,x)}else a.drawDebugText(o.position.x,o.position.y,o.value.chirality)}if(i.debug)for(var r=0;r<s.length;r++){let o=s[r].center;a.drawDebugPoint(o.x,o.y,"r: "+s[r].id)}}getTotalOverlapScore(){return this.preprocessor.getTotalOverlapScore()}getMolecularFormula(){return this.preprocessor.getMolecularFormula()}multiplyNormals(e,t){e[0].multiplyScalar(t),e[1].multiplyScalar(t)}}var Zr=Kr;const un=dn,cn=Hr,Jr=Zr;var es=!!(typeof window!="undefined"&&window.document&&window.document.createElement),Ce={Version:"1.0.0"};Ce.Drawer=un;Ce.Parser=cn;Ce.SvgDrawer=Jr;Ce.clean=function(l){return l.replace(/[^A-Za-z0-9@\.\+\-\?!\(\)\[\]\{\}/\\=#\$:\*]/g,"")};Ce.apply=function(l,e="canvas[data-smiles]",t="light",i=null){let n=new un(l),s=document.querySelectorAll(e);for(var a=0;a<s.length;a++){let r=s[a];Ce.parse(r.getAttribute("data-smiles"),function(h){n.draw(h,r,t,!1)},function(h){i&&i(h)})}};Ce.parse=function(l,e,t){try{e&&e(cn.parse(l))}catch(i){t&&t(i)}};es&&(window.SmilesDrawer=Ce);Array.prototype.fill||Object.defineProperty(Array.prototype,"fill",{value:function(l){if(this==null)throw new TypeError("this is null or not defined");for(var e=Object(this),t=e.length>>>0,i=arguments[1],n=i>>0,s=n<0?Math.max(t+n,0):Math.min(n,t),a=arguments[2],r=a===void 0?t:a>>0,h=r<0?Math.max(t+r,0):Math.min(r,t);s<h;)e[s]=l,s++;return e}});var wt=Ce;const ts=l=>({container:{border:`1px solid ${l.palette.grey[300]}`,cursor:"pointer",height:"240px",marginLeft:"auto",width:"fit-content"},modal:{width:"800px",margin:"130px auto 0 auto"},modalCanvas:{display:"block",margin:"0 auto"},close:{cursor:"pointer",float:"right",fill:l.palette.grey[800]}});let Kt=class extends ke.exports.Component{constructor(){super(...arguments);vt(this,"state",{open:!1});vt(this,"toggleModal",()=>{this.setState(({open:l})=>({open:!l}))})}componentDidMount(){const{smiles:l,chemblId:e}=this.props,t=new wt.Drawer({width:450,height:240,padding:10});wt.parse(l,i=>{t.draw(i,e)},()=>{console.error("error parsing smiles")})}componentDidUpdate(){const{open:l}=this.state;if(l){const{smiles:e,chemblId:t}=this.props,i=new wt.Drawer({width:750,height:440,padding:10});wt.parse(e,n=>{i.draw(n,`${t}-modal`)},()=>{console.error("error parsing smiles")})}}render(){const{chemblId:l,classes:e}=this.props,{open:t}=this.state;return q(se,{children:[A(Ot,{className:e.container,elevation:0,onClick:this.toggleModal,children:A("canvas",{id:l})}),A(br,{open:t,onClose:this.toggleModal,keepMounted:!0,children:q(Ot,{className:e.modal,children:[A(nn,{className:e.close,onClick:this.toggleModal}),A("canvas",{id:`${l}-modal`,className:e.modalCanvas})]})})]})}};Kt=jn(ts)(Kt);class is extends ke.exports.Component{constructor(){super(...arguments);vt(this,"state",{smiles:void 0})}componentDidMount(){this.mounted=!0;const{chemblId:e}=this.props;fetch(`https://www.ebi.ac.uk/chembl/api/data/molecule/${e}?format=json`).then(t=>t.json()).then(t=>{var i;this.mounted&&this.setState({smiles:t.molecule_type==="Small molecule"?(i=t.molecule_structures)==null?void 0:i.canonical_smiles:null})})}componentWillUnmount(){this.mounted=!1}render(){const{chemblId:e}=this.props,{smiles:t}=this.state;return t===null?null:t?A(Kt,{chemblId:e,smiles:t}):A(en,{style:{marginLeft:"auto"},height:"240px",variant:"rect",width:"450px"})}}var qt={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"DrugProfileHeaderFragment"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Drug"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"description"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"drugType"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"synonyms"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"parentMolecule"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"childMolecules"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"isApproved"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"hasBeenWithdrawn"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"blackBoxWarning"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"maximumClinicalTrialPhase"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"tradeNames"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"yearOfFirstApproval"},arguments:[],directives:[]}]}}],loc:{start:0,end:274}};qt.loc.source={body:`fragment DrugProfileHeaderFragment on Drug {
  description
  drugType
  synonyms
  parentMolecule {
    id
    name
  }
  childMolecules {
    id
    name
  }
  isApproved
  hasBeenWithdrawn
  blackBoxWarning
  maximumClinicalTrialPhase
  tradeNames
  yearOfFirstApproval
}
`,name:"GraphQL request",locationOffset:{line:1,column:1}};function kt(l,e){if(l.kind==="FragmentSpread")e.add(l.name.value);else if(l.kind==="VariableDefinition"){var t=l.type;t.kind==="NamedType"&&e.add(t.name.value)}l.selectionSet&&l.selectionSet.selections.forEach(function(i){kt(i,e)}),l.variableDefinitions&&l.variableDefinitions.forEach(function(i){kt(i,e)}),l.definitions&&l.definitions.forEach(function(i){kt(i,e)})}var Zt={};(function(){qt.definitions.forEach(function(e){if(e.name){var t=new Set;kt(e,t),Zt[e.name.value]=t}})})();function Wi(l,e){for(var t=0;t<l.definitions.length;t++){var i=l.definitions[t];if(i.name&&i.name.value==e)return i}}function ns(l,e){var t={kind:l.kind,definitions:[Wi(l,e)]};l.hasOwnProperty("loc")&&(t.loc=l.loc);var i=Zt[e]||new Set,n=new Set,s=new Set;for(i.forEach(function(r){s.add(r)});s.size>0;){var a=s;s=new Set,a.forEach(function(r){if(!n.has(r)){n.add(r);var h=Zt[r]||new Set;h.forEach(function(o){s.add(o)})}})}return n.forEach(function(r){var h=Wi(l,r);h&&t.definitions.push(h)}),t}ns(qt,"DrugProfileHeaderFragment");function Si({chemblId:l}){const{loading:e,error:t,data:i}=De();if(t)return null;const{description:n,parentMolecule:s,childMolecules:a=[],synonyms:r,tradeNames:h,drugType:o,yearOfFirstApproval:d,maximumClinicalTrialPhase:c,isApproved:u,hasBeenWithdrawn:m,blackBoxWarning:S}=(i==null?void 0:i.drug)||{};return q(lr,{children:[q(se,{children:[A(fr,{loading:e,children:n}),A(Pe,{loading:e,title:"Molecule type",children:o}),A(Pe,{loading:e,title:"First approval",children:d||"N/A"}),A(Pe,{loading:e,title:"Max phase",children:c}),q(Pe,{loading:e,title:"Status",children:[u?q(Me,{component:"span",mr:2,children:[A(Ut,{icon:Kn})," Approved"]}):null,m?q(Me,{component:"span",mr:2,children:[A(Ut,{icon:Zn})," Withdrawn"]}):null,S?q(Me,{component:"span",mr:2,children:[A(Ut,{icon:Jn})," Black box warning"]}):null]}),A(Pe,{loading:e,title:"Parent molecule",children:s?A(ne,{to:`/drug/${s.id}`,children:s.name}):null}),A(Pe,{loading:e,title:"Child molecules",children:a.map(({id:p,name:w},k)=>q(ke.exports.Fragment,{children:[A(ne,{to:`/drug/${p}`,children:w}),k<a.length-1?", ":null]},p))}),A(Pi,{title:"Synonyms",inline:!0,loading:e,children:r}),A(Pi,{title:"Known trade names",inline:!0,loading:e,children:h})]}),A(is,{chemblId:l})]})}Si.fragments={profileHeader:qt};var at={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"DrugWarningsSummaryFragment"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Drug"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"hasBeenWithdrawn"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"blackBoxWarning"},arguments:[],directives:[]}]}}],loc:{start:0,end:86}};at.loc.source={body:`fragment DrugWarningsSummaryFragment on Drug {
  hasBeenWithdrawn
  blackBoxWarning
}
`,name:"GraphQL request",locationOffset:{line:1,column:1}};function Ct(l,e){if(l.kind==="FragmentSpread")e.add(l.name.value);else if(l.kind==="VariableDefinition"){var t=l.type;t.kind==="NamedType"&&e.add(t.name.value)}l.selectionSet&&l.selectionSet.selections.forEach(function(i){Ct(i,e)}),l.variableDefinitions&&l.variableDefinitions.forEach(function(i){Ct(i,e)}),l.definitions&&l.definitions.forEach(function(i){Ct(i,e)})}var Jt={};(function(){at.definitions.forEach(function(e){if(e.name){var t=new Set;Ct(e,t),Jt[e.name.value]=t}})})();function qi(l,e){for(var t=0;t<l.definitions.length;t++){var i=l.definitions[t];if(i.name&&i.name.value==e)return i}}function rs(l,e){var t={kind:l.kind,definitions:[qi(l,e)]};l.hasOwnProperty("loc")&&(t.loc=l.loc);var i=Jt[e]||new Set,n=new Set,s=new Set;for(i.forEach(function(r){s.add(r)});s.size>0;){var a=s;s=new Set,a.forEach(function(r){if(!n.has(r)){n.add(r);var h=Jt[r]||new Set;h.forEach(function(o){s.add(o)})}})}return n.forEach(function(r){var h=qi(l,r);h&&t.definitions.push(h)}),t}rs(at,"DrugWarningsSummaryFragment");function gn({definition:l}){const e=De(at);return A(Ve,{definition:l,request:e,renderSummary:({hasBeenWithdrawn:t,blackBoxWarning:i})=>{if(t&&i)return"Withdrawn \u2022 Black Box";if(t)return"Withdrawn";if(i)return"Black Box"}})}gn.fragments={DrugWarningsSummaryFragment:at};function ss({name:l}){return q(se,{children:["Manually curated withdrawn and black box warnings for"," ",A("strong",{children:l}),". Source:"," ",A(ne,{to:"https://www.ebi.ac.uk/chembl",external:!0,children:"ChEMBL"})]})}var it={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DrugWarningsQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"chemblId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"drug"},arguments:[{kind:"Argument",name:{kind:"Name",value:"chemblId"},value:{kind:"Variable",name:{kind:"Name",value:"chemblId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"drugWarnings"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"warningType"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"description"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"toxicityClass"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"meddraSocCode"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"country"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"year"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"references"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"source"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"url"},arguments:[],directives:[]}]}}]}}]}}]}}],loc:{start:0,end:279}};it.loc.source={body:`query DrugWarningsQuery($chemblId: String!) {
  drug(chemblId: $chemblId) {
    id
    drugWarnings {
      warningType
      description
      toxicityClass
      meddraSocCode
      country
      year
      references {
        id
        source
        url
      }
    }
  }
}`,name:"GraphQL request",locationOffset:{line:1,column:1}};function At(l,e){if(l.kind==="FragmentSpread")e.add(l.name.value);else if(l.kind==="VariableDefinition"){var t=l.type;t.kind==="NamedType"&&e.add(t.name.value)}l.selectionSet&&l.selectionSet.selections.forEach(function(i){At(i,e)}),l.variableDefinitions&&l.variableDefinitions.forEach(function(i){At(i,e)}),l.definitions&&l.definitions.forEach(function(i){At(i,e)})}var ei={};(function(){it.definitions.forEach(function(e){if(e.name){var t=new Set;At(e,t),ei[e.name.value]=t}})})();function Hi(l,e){for(var t=0;t<l.definitions.length;t++){var i=l.definitions[t];if(i.name&&i.name.value==e)return i}}function as(l,e){var t={kind:l.kind,definitions:[Hi(l,e)]};l.hasOwnProperty("loc")&&(t.loc=l.loc);var i=ei[e]||new Set,n=new Set,s=new Set;for(i.forEach(function(r){s.add(r)});s.size>0;){var a=s;s=new Set,a.forEach(function(r){if(!n.has(r)){n.add(r);var h=ei[r]||new Set;h.forEach(function(o){s.add(o)})}})}return n.forEach(function(r){var h=Hi(l,r);h&&t.definitions.push(h)}),t}as(it,"DrugWarningsQuery");const ls=[{id:"warningType",label:"Warning type"},{id:"description",label:"Description",renderCell:({description:l})=>l!=null?l:Je},{id:"toxicityClass",label:"ChEMBL warning class",renderCell:({toxicityClass:l})=>l!=null?l:Je},{id:"meddraSocCode",label:"MedDRA SOC code",renderCell:({meddraSocCode:l})=>l?A(ne,{external:!0,to:tr("meddra",l),children:l}):Je},{id:"country",label:"Country / region",renderCell:({country:l})=>l!=null?l:Je},{id:"year",label:"Year",renderCell:({year:l})=>l!=null?l:Je},{id:"references",label:"References",renderCell:({references:l})=>{const e=new Set,t=[];l.forEach(n=>{e.add(n.source),t.push({name:n.id,url:n.url,group:n.source})});const i=Array.from(e).join(", ");return A(ui,{entries:t,showSingle:!1,message:i})}}];function os({definition:l,id:e,label:t}){const i={chemblId:e},n=zt(it,{variables:i});return A(Vt,{definition:l,request:n,renderDescription:()=>A(ss,{name:t}),renderBody:({drug:s})=>A(ci,{showGlobalFilter:!0,dataDownloader:!0,columns:ls,rows:s.drugWarnings,rowsPerPageOptions:er,query:it.loc.source.body,variables:i})})}const hs={id:"drugWarnings",name:"Drug Warnings",shortName:"DW",hasData:({hasBeenWithdrawn:l,blackBoxWarning:e})=>l||e};var ds=Object.freeze(Object.defineProperty({__proto__:null,definition:hs,Summary:gn,Body:os},Symbol.toStringTag,{value:"Module"})),lt={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"DrugBibliography"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Drug"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"literatureOcurrences"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"count"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:77}};lt.loc.source={body:`fragment DrugBibliography on Drug {
  literatureOcurrences {
    count
  }
}
`,name:"GraphQL request",locationOffset:{line:1,column:1}};function Nt(l,e){if(l.kind==="FragmentSpread")e.add(l.name.value);else if(l.kind==="VariableDefinition"){var t=l.type;t.kind==="NamedType"&&e.add(t.name.value)}l.selectionSet&&l.selectionSet.selections.forEach(function(i){Nt(i,e)}),l.variableDefinitions&&l.variableDefinitions.forEach(function(i){Nt(i,e)}),l.definitions&&l.definitions.forEach(function(i){Nt(i,e)})}var ti={};(function(){lt.definitions.forEach(function(e){if(e.name){var t=new Set;Nt(e,t),ti[e.name.value]=t}})})();function Yi(l,e){for(var t=0;t<l.definitions.length;t++){var i=l.definitions[t];if(i.name&&i.name.value==e)return i}}function us(l,e){var t={kind:l.kind,definitions:[Yi(l,e)]};l.hasOwnProperty("loc")&&(t.loc=l.loc);var i=ti[e]||new Set,n=new Set,s=new Set;for(i.forEach(function(r){s.add(r)});s.size>0;){var a=s;s=new Set,a.forEach(function(r){if(!n.has(r)){n.add(r);var h=ti[r]||new Set;h.forEach(function(o){s.add(o)})}})}return n.forEach(function(r){var h=Yi(l,r);h&&t.definitions.push(h)}),t}us(lt,"DrugBibliography");function fn({definition:l}){const e=De(lt);return A(Ve,{definition:l,request:e,renderSummary:t=>{var i;return((i=t.literatureOcurrences)==null?void 0:i.count)>0?q(se,{children:[t.literatureOcurrences.count.toLocaleString()," publication",t.literatureOcurrences.count===1?"":"s"]}):A(se,{children:"no data"})}})}fn.fragments={DrugBibliography:lt};var Ht={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"SimilarEntitiesQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"ids"}},type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},defaultValue:{kind:"ListValue",values:[]},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"threshold"}},type:{kind:"NamedType",name:{kind:"Name",value:"Float"}},defaultValue:{kind:"FloatValue",value:"0.5"},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"size"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},defaultValue:{kind:"IntValue",value:"15"},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"entityNames"}},type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},defaultValue:{kind:"ListValue",values:[]},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"cursor"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},defaultValue:{kind:"NullValue"},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"drug"},arguments:[{kind:"Argument",name:{kind:"Name",value:"chemblId"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"similarEntities"},arguments:[{kind:"Argument",name:{kind:"Name",value:"additionalIds"},value:{kind:"Variable",name:{kind:"Name",value:"ids"}}},{kind:"Argument",name:{kind:"Name",value:"threshold"},value:{kind:"Variable",name:{kind:"Name",value:"threshold"}}},{kind:"Argument",name:{kind:"Name",value:"size"},value:{kind:"Variable",name:{kind:"Name",value:"size"}}},{kind:"Argument",name:{kind:"Name",value:"entityNames"},value:{kind:"Variable",name:{kind:"Name",value:"entityNames"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"score"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"object"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Target"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"approvedSymbol"},arguments:[],directives:[]}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Drug"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Disease"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]}]}}]}}]}},{kind:"Field",name:{kind:"Name",value:"literatureOcurrences"},arguments:[{kind:"Argument",name:{kind:"Name",value:"additionalIds"},value:{kind:"Variable",name:{kind:"Name",value:"ids"}}},{kind:"Argument",name:{kind:"Name",value:"cursor"},value:{kind:"Variable",name:{kind:"Name",value:"cursor"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"count"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"cursor"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"rows"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"pmid"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"pmcid"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"publicationDate"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"sentences"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"section"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"matches"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"mappedId"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"matchedLabel"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"sectionStart"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"sectionEnd"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"startInSentence"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"endInSentence"},arguments:[],directives:[]}]}}]}}]}}]}}]}}]}}],loc:{start:0,end:990}};Ht.loc.source={body:`query SimilarEntitiesQuery(
  $id: String!
  $ids: [String!] = []
  $threshold: Float = 0.5
  $size: Int! = 15
  $entityNames: [String!] = []
  $cursor: String = null
) {
  drug(chemblId: $id) {
    id
    name
    similarEntities(
      additionalIds: $ids
      threshold: $threshold
      size: $size
      entityNames: $entityNames
    ) {
      score
      id
      object {
        ... on Target {
          id
          approvedSymbol
        }
        ... on Drug {
          id
          name
        }
        ... on Disease {
          id
          name
        }
      }
    }
    literatureOcurrences(additionalIds: $ids, cursor: $cursor) {
      count
      cursor
      rows {
        pmid
        pmcid
        publicationDate
        sentences {
          section
          matches {
            mappedId
            matchedLabel
            sectionStart
            sectionEnd
            startInSentence
            endInSentence
          }
        }
      }
    }
  }
}`,name:"GraphQL request",locationOffset:{line:1,column:1}};function xt(l,e){if(l.kind==="FragmentSpread")e.add(l.name.value);else if(l.kind==="VariableDefinition"){var t=l.type;t.kind==="NamedType"&&e.add(t.name.value)}l.selectionSet&&l.selectionSet.selections.forEach(function(i){xt(i,e)}),l.variableDefinitions&&l.variableDefinitions.forEach(function(i){xt(i,e)}),l.definitions&&l.definitions.forEach(function(i){xt(i,e)})}var ii={};(function(){Ht.definitions.forEach(function(e){if(e.name){var t=new Set;xt(e,t),ii[e.name.value]=t}})})();function Xi(l,e){for(var t=0;t<l.definitions.length;t++){var i=l.definitions[t];if(i.name&&i.name.value==e)return i}}function cs(l,e){var t={kind:l.kind,definitions:[Xi(l,e)]};l.hasOwnProperty("loc")&&(t.loc=l.loc);var i=ii[e]||new Set,n=new Set,s=new Set;for(i.forEach(function(r){s.add(r)});s.size>0;){var a=s;s=new Set,a.forEach(function(r){if(!n.has(r)){n.add(r);var h=ii[r]||new Set;h.forEach(function(o){s.add(o)})}})}return n.forEach(function(r){var h=Xi(l,r);h&&t.definitions.push(h)}),t}cs(Ht,"SimilarEntitiesQuery");function gs({definition:l,id:e,label:t}){return A(Sr,{definition:l,entity:"drug",id:e,name:t,BODY_QUERY:Ht})}const fs={id:"bibliography",name:"Bibliography",shortName:"B",hasData:l=>{var e;return((e=l.literatureOcurrences)==null?void 0:e.count)>0}};var ms=Object.freeze(Object.defineProperty({__proto__:null,definition:fs,Summary:fn,Body:gs},Symbol.toStringTag,{value:"Module"})),ot={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"DrugKnownDrugsSummaryFragment"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Drug"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"knownDrugs"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"count"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"uniqueTargets"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"uniqueDiseases"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:117}};ot.loc.source={body:`fragment DrugKnownDrugsSummaryFragment on Drug {
  knownDrugs {
    count
    uniqueTargets
    uniqueDiseases
  }
}
`,name:"GraphQL request",locationOffset:{line:1,column:1}};function Rt(l,e){if(l.kind==="FragmentSpread")e.add(l.name.value);else if(l.kind==="VariableDefinition"){var t=l.type;t.kind==="NamedType"&&e.add(t.name.value)}l.selectionSet&&l.selectionSet.selections.forEach(function(i){Rt(i,e)}),l.variableDefinitions&&l.variableDefinitions.forEach(function(i){Rt(i,e)}),l.definitions&&l.definitions.forEach(function(i){Rt(i,e)})}var ni={};(function(){ot.definitions.forEach(function(e){if(e.name){var t=new Set;Rt(e,t),ni[e.name.value]=t}})})();function Qi(l,e){for(var t=0;t<l.definitions.length;t++){var i=l.definitions[t];if(i.name&&i.name.value==e)return i}}function ps(l,e){var t={kind:l.kind,definitions:[Qi(l,e)]};l.hasOwnProperty("loc")&&(t.loc=l.loc);var i=ni[e]||new Set,n=new Set,s=new Set;for(i.forEach(function(r){s.add(r)});s.size>0;){var a=s;s=new Set,a.forEach(function(r){if(!n.has(r)){n.add(r);var h=ni[r]||new Set;h.forEach(function(o){s.add(o)})}})}return n.forEach(function(r){var h=Qi(l,r);h&&t.definitions.push(h)}),t}ps(ot,"DrugKnownDrugsSummaryFragment");function mn({definition:l}){const e=De(ot);return A(Ve,{definition:l,request:e,renderSummary:t=>q(se,{children:[(t.knownDrugs.uniqueTargets||0).toLocaleString()," target",t.knownDrugs.uniqueTargets===1?"":"s"," and"," ",(t.knownDrugs.uniqueDiseases||0).toLocaleString()," indication",t.knownDrugs.uniqueDiseases===1?"":"s"]})})}mn.fragments={DrugKnownDrugsSummaryFragment:ot};function vs({name:l}){return q(se,{children:["Clinical trial records, including curated indication and mechanism of action for ",A("strong",{children:l}),". Source:"," ",A(ne,{external:!0,to:"https://www.ebi.ac.uk/chembl/",children:"ChEMBL"}),"."]})}var Yt={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"KnownDrugsQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"chemblId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"cursor"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"freeTextQuery"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"size"}},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}},defaultValue:{kind:"IntValue",value:"10"},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"drug"},arguments:[{kind:"Argument",name:{kind:"Name",value:"chemblId"},value:{kind:"Variable",name:{kind:"Name",value:"chemblId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"knownDrugs"},arguments:[{kind:"Argument",name:{kind:"Name",value:"cursor"},value:{kind:"Variable",name:{kind:"Name",value:"cursor"}}},{kind:"Argument",name:{kind:"Name",value:"freeTextQuery"},value:{kind:"Variable",name:{kind:"Name",value:"freeTextQuery"}}},{kind:"Argument",name:{kind:"Name",value:"size"},value:{kind:"Variable",name:{kind:"Name",value:"size"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"count"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"cursor"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"rows"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"phase"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"status"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"urls"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"url"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"disease"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"target"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"approvedName"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"approvedSymbol"},arguments:[],directives:[]}]}}]}}]}}]}}]}}],loc:{start:0,end:509}};Yt.loc.source={body:`query KnownDrugsQuery(
  $chemblId: String!
  $cursor: String
  $freeTextQuery: String
  $size: Int = 10
) {
  drug(chemblId: $chemblId) {
    id
    knownDrugs(cursor: $cursor, freeTextQuery: $freeTextQuery, size: $size) {
      count
      cursor
      rows {
        phase
        status
        urls {
          name
          url
        }
        disease {
          id
          name
        }
        target {
          id
          approvedName
          approvedSymbol
        }
      }
    }
  }
}
`,name:"GraphQL request",locationOffset:{line:1,column:1}};function Dt(l,e){if(l.kind==="FragmentSpread")e.add(l.name.value);else if(l.kind==="VariableDefinition"){var t=l.type;t.kind==="NamedType"&&e.add(t.name.value)}l.selectionSet&&l.selectionSet.selections.forEach(function(i){Dt(i,e)}),l.variableDefinitions&&l.variableDefinitions.forEach(function(i){Dt(i,e)}),l.definitions&&l.definitions.forEach(function(i){Dt(i,e)})}var ri={};(function(){Yt.definitions.forEach(function(e){if(e.name){var t=new Set;Dt(e,t),ri[e.name.value]=t}})})();function Ui(l,e){for(var t=0;t<l.definitions.length;t++){var i=l.definitions[t];if(i.name&&i.name.value==e)return i}}function bs(l,e){var t={kind:l.kind,definitions:[Ui(l,e)]};l.hasOwnProperty("loc")&&(t.loc=l.loc);var i=ri[e]||new Set,n=new Set,s=new Set;for(i.forEach(function(r){s.add(r)});s.size>0;){var a=s;s=new Set,a.forEach(function(r){if(!n.has(r)){n.add(r);var h=ri[r]||new Set;h.forEach(function(o){s.add(o)})}})}return n.forEach(function(r){var h=Ui(l,r);h&&t.definitions.push(h)}),t}bs(Yt,"KnownDrugsQuery");const Ss=[{label:"diseaseId",exportValue:l=>l.disease.id},{label:"diseaseName",exportValue:l=>l.disease.name},{label:"symbol",exportValue:l=>l.target.approvedSymbol},{label:"name",exportValue:l=>l.target.approvedName},{label:"phase",exportValue:l=>l.phase},{label:"status",exportValue:l=>l.status},{label:"source",exportValue:l=>l.urls.map(e=>e.url)}];function ys({definition:l,id:e,label:t}){return A(yr,{definition:l,entity:"drug",variables:{chemblId:e},BODY_QUERY:Yt,Description:()=>A(vs,{name:t}),columnsToShow:["disease","target","clinicalTrials"],stickyColumn:"disease",exportColumns:Ss})}const ws={id:"knownDrugs",name:"Clinical Precedence",shortName:"CP",hasData:l=>{var e;return((e=l.knownDrugs)==null?void 0:e.count)>0||!1}};var ks=Object.freeze(Object.defineProperty({__proto__:null,definition:ws,Summary:mn,Body:ys},Symbol.toStringTag,{value:"Module"})),ht={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"IndicationsSummaryFragment"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Drug"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"indications"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"count"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:78}};ht.loc.source={body:`fragment IndicationsSummaryFragment on Drug {
  indications {
    count
  }
}
`,name:"GraphQL request",locationOffset:{line:1,column:1}};function Tt(l,e){if(l.kind==="FragmentSpread")e.add(l.name.value);else if(l.kind==="VariableDefinition"){var t=l.type;t.kind==="NamedType"&&e.add(t.name.value)}l.selectionSet&&l.selectionSet.selections.forEach(function(i){Tt(i,e)}),l.variableDefinitions&&l.variableDefinitions.forEach(function(i){Tt(i,e)}),l.definitions&&l.definitions.forEach(function(i){Tt(i,e)})}var si={};(function(){ht.definitions.forEach(function(e){if(e.name){var t=new Set;Tt(e,t),si[e.name.value]=t}})})();function Gi(l,e){for(var t=0;t<l.definitions.length;t++){var i=l.definitions[t];if(i.name&&i.name.value==e)return i}}function Cs(l,e){var t={kind:l.kind,definitions:[Gi(l,e)]};l.hasOwnProperty("loc")&&(t.loc=l.loc);var i=si[e]||new Set,n=new Set,s=new Set;for(i.forEach(function(r){s.add(r)});s.size>0;){var a=s;s=new Set,a.forEach(function(r){if(!n.has(r)){n.add(r);var h=si[r]||new Set;h.forEach(function(o){s.add(o)})}})}return n.forEach(function(r){var h=Gi(l,r);h&&t.definitions.push(h)}),t}Cs(ht,"IndicationsSummaryFragment");function pn({definition:l}){const e=De(ht);return A(Ve,{definition:l,request:e,renderSummary:t=>`${t.indications.count} indication${t.indications.count!==1?"s":""}`})}pn.fragments={IndicationsSummaryFragment:ht};function As({name:l}){return q(se,{children:["Investigational and approved indications for ",A("strong",{children:l})," ","curated from clinical trial records and post-marketing package inserts. Source:"," ",A(ne,{to:"https://www.ebi.ac.uk/chembl/",external:!0,children:"ChEMBL"}),"."]})}const Ns=tn(l=>({drawerBody:{overflowY:"overlay"},drawerBodyPaperRoot:{border:"1px solid #ccc",margin:"1rem 1rem 0 1rem",padding:"1rem","&::before":{backgroundColor:"transparent"}},drawerLink:{cursor:"pointer"},drawerModal:{"& .MuiBackdrop-root":{opacity:"0 !important"}},drawerPaper:{backgroundColor:l.palette.grey[300]},drawerTitle:{borderBottom:"1px solid #ccc",padding:"1rem"},drawerTitleCaption:{color:l.palette.grey[700],fontSize:"1.2rem",fontWeight:"bold"},drawerSubtitleCaption:{color:l.palette.grey[400],fontSize:"0.8rem",fontStyle:"italic"}}));function xs({therapeuticAreas:l}){const[e,t]=ke.exports.useState(!1),i=Ns();if(l.length===0)return"N/A";if(l.length===1)return A(ne,{to:`/disease/${l[0].id}`,children:l[0].name});const n=r=>{r.type==="keydown"&&(r.key==="Tab"||r.key==="Shift")||t(!0)},s=()=>{t(!1)},a=q(se,{children:[A(Ot,{classes:{root:i.drawerTitle},elevation:0,children:q(Me,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[q(Me,{display:"flex",flexDirection:"column",children:[A(tt,{className:i.drawerTitleCaption,children:"Therapeutic Areas"}),q(tt,{className:i.drawerSubtitleCaption,children:[l.length," entries"]})]}),A(ir,{onClick:s,children:A(nn,{})})]})}),A(Me,{className:i.drawerBody,children:A(Ot,{elevation:0,classes:{root:i.drawerBodyPaperRoot},children:A(nr,{children:l.map((r,h)=>A(rr,{children:A(ne,{to:`/disease/${r.id}`,children:r.name})},h))})})})]});return q(se,{children:[q(mr,{onClick:n,className:i.drawerLink,children:[l.length," areas"]}),A(pr,{anchor:"right",classes:{modal:i.drawerModal,paper:i.drawerPaper},open:e,onClose:s,children:a})]})}var nt={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"IndicationsQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"chemblId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"drug"},arguments:[{kind:"Argument",name:{kind:"Name",value:"chemblId"},value:{kind:"Variable",name:{kind:"Name",value:"chemblId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"indications"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"rows"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"maxPhaseForIndication"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"disease"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"therapeuticAreas"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]}]}}]}},{kind:"Field",name:{kind:"Name",value:"references"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"ids"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"source"},arguments:[],directives:[]}]}}]}}]}}]}}]}}],loc:{start:0,end:353}};nt.loc.source={body:`query IndicationsQuery($chemblId: String!) {
  drug(chemblId: $chemblId) {
    id
    indications {
      rows {
        maxPhaseForIndication
        disease {
          id
          name
          therapeuticAreas {
            id
            name
          }
        }
        references {
          ids
          source
        }
      }
    }
  }
}`,name:"GraphQL request",locationOffset:{line:1,column:1}};function Et(l,e){if(l.kind==="FragmentSpread")e.add(l.name.value);else if(l.kind==="VariableDefinition"){var t=l.type;t.kind==="NamedType"&&e.add(t.name.value)}l.selectionSet&&l.selectionSet.selections.forEach(function(i){Et(i,e)}),l.variableDefinitions&&l.variableDefinitions.forEach(function(i){Et(i,e)}),l.definitions&&l.definitions.forEach(function(i){Et(i,e)})}var ai={};(function(){nt.definitions.forEach(function(e){if(e.name){var t=new Set;Et(e,t),ai[e.name.value]=t}})})();function _i(l,e){for(var t=0;t<l.definitions.length;t++){var i=l.definitions[t];if(i.name&&i.name.value==e)return i}}function Rs(l,e){var t={kind:l.kind,definitions:[_i(l,e)]};l.hasOwnProperty("loc")&&(t.loc=l.loc);var i=ai[e]||new Set,n=new Set,s=new Set;for(i.forEach(function(r){s.add(r)});s.size>0;){var a=s;s=new Set,a.forEach(function(r){if(!n.has(r)){n.add(r);var h=ai[r]||new Set;h.forEach(function(o){s.add(o)})}})}return n.forEach(function(r){var h=_i(l,r);h&&t.definitions.push(h)}),t}Rs(nt,"IndicationsQuery");const Ds=[{id:"indication",propertyPath:"disease.name",renderCell:l=>A(ne,{to:`/disease/${l.disease.id}`,children:l.disease.name}),width:"38%"},{id:"therapeuticAreas",renderCell:l=>A(xs,{therapeuticAreas:l.disease.therapeuticAreas}),exportValue:l=>l.disease.therapeuticAreas.map(e=>e.id),width:"38%"},{id:"maxPhaseForIndication",label:"Max Phase",sortable:!0,width:"10%",renderCell:({maxPhaseForIndication:l})=>Li[l],filterValue:({maxPhaseForIndication:l})=>Li[l]},{id:"references",label:"Source",renderCell:({references:l})=>{if(!l)return"N/A";const e=[];return l.forEach(t=>{t.ids.forEach((i,n)=>{e.push({name:i,url:or[t.source](i),group:sr[t.source]})})}),e.length===1?A(ne,{external:!0,to:e[0].url,children:e[0].group}):A(ui,{entries:e})}}];function Ts({definition:l,id:e,label:t}){const i={chemblId:e},n=zt(nt,{variables:i});return A(Vt,{definition:l,request:n,renderDescription:()=>A(As,{name:t}),renderBody:s=>{const{rows:a}=s.drug.indications;return A(ci,{columns:Ds,dataDownloader:!0,dataDownloaderFileStem:`${e}-indications`,rows:a,showGlobalFilter:!0,sortBy:"maxPhaseForIndication",order:"desc",rowsPerPageOptions:[10,25,100],ActionsComponent:rn,query:nt.loc.source.body,variables:i})}})}const Es={id:"indications",name:"Indications",shortName:"I",hasData:l=>{var e;return((e=l.indications)==null?void 0:e.count)>0||!1}};var Fs=Object.freeze(Object.defineProperty({__proto__:null,definition:Es,Summary:pn,Body:Ts},Symbol.toStringTag,{value:"Module"})),dt={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"MechanismsOfActionSummaryFragment"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Drug"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"mechanismsOfAction"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"uniqueActionTypes"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"uniqueTargetTypes"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"parentMolecule"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"childMolecules"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:204}};dt.loc.source={body:`fragment MechanismsOfActionSummaryFragment on Drug {
  mechanismsOfAction {
    uniqueActionTypes
    uniqueTargetTypes
  }
  parentMolecule {
    id
    name
  }
  childMolecules {
    id
    name
  }
}
`,name:"GraphQL request",locationOffset:{line:1,column:1}};function Ft(l,e){if(l.kind==="FragmentSpread")e.add(l.name.value);else if(l.kind==="VariableDefinition"){var t=l.type;t.kind==="NamedType"&&e.add(t.name.value)}l.selectionSet&&l.selectionSet.selections.forEach(function(i){Ft(i,e)}),l.variableDefinitions&&l.variableDefinitions.forEach(function(i){Ft(i,e)}),l.definitions&&l.definitions.forEach(function(i){Ft(i,e)})}var li={};(function(){dt.definitions.forEach(function(e){if(e.name){var t=new Set;Ft(e,t),li[e.name.value]=t}})})();function ji(l,e){for(var t=0;t<l.definitions.length;t++){var i=l.definitions[t];if(i.name&&i.name.value==e)return i}}function $s(l,e){var t={kind:l.kind,definitions:[ji(l,e)]};l.hasOwnProperty("loc")&&(t.loc=l.loc);var i=li[e]||new Set,n=new Set,s=new Set;for(i.forEach(function(r){s.add(r)});s.size>0;){var a=s;s=new Set,a.forEach(function(r){if(!n.has(r)){n.add(r);var h=li[r]||new Set;h.forEach(function(o){s.add(o)})}})}return n.forEach(function(r){var h=ji(l,r);h&&t.definitions.push(h)}),t}$s(dt,"MechanismsOfActionSummaryFragment");function yi({definition:l}){const e=De(dt);return A(Ve,{definition:l,request:e,renderSummary:t=>q(se,{children:[t.mechanismsOfAction.uniqueActionTypes.length>0?t.mechanismsOfAction.uniqueActionTypes.join(" \u2022 "):null,A("br",{}),t.mechanismsOfAction.uniqueTargetTypes.length>0?t.mechanismsOfAction.uniqueTargetTypes.join(" \u2022 "):null]})})}yi.fragments={MechanismsOfActionSummaryFragment:dt};function Ls({name:l,parentMolecule:e,childMolecules:t}){const i=[...t];return e&&i.push(e),q(ke.exports.Fragment,{children:[A("strong",{children:l}),i.length>0?q(se,{children:[", and related molecules"," ",i.map(n=>q(ke.exports.Fragment,{children:[A(ne,{to:`/drug/${n.id}`,children:n.name}),", "]},n.id))]}):null," ","biochemical interactions to produce intended pharmacological effects. Curated from scientific literature and post-marketing package inserts. Source:"," ",A(ne,{to:"https://www.ebi.ac.uk/chembl/",external:!0,children:"ChEMBL"})]})}var rt={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"MechanismsOfActionSectionQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"chemblId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"drug"},arguments:[{kind:"Argument",name:{kind:"Name",value:"chemblId"},value:{kind:"Variable",name:{kind:"Name",value:"chemblId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"mechanismsOfAction"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"rows"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"mechanismOfAction"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"targetName"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"targets"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"approvedSymbol"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"references"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"source"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"urls"},arguments:[],directives:[]}]}}]}}]}}]}}]}}],loc:{start:0,end:328}};rt.loc.source={body:`query MechanismsOfActionSectionQuery($chemblId: String!) {
  drug(chemblId: $chemblId) {
    id
    mechanismsOfAction {
      rows {
        mechanismOfAction
        targetName
        targets {
          id
          approvedSymbol
        }
        references {
          source
          urls
        }
      }
    }
  }
}
`,name:"GraphQL request",locationOffset:{line:1,column:1}};function $t(l,e){if(l.kind==="FragmentSpread")e.add(l.name.value);else if(l.kind==="VariableDefinition"){var t=l.type;t.kind==="NamedType"&&e.add(t.name.value)}l.selectionSet&&l.selectionSet.selections.forEach(function(i){$t(i,e)}),l.variableDefinitions&&l.variableDefinitions.forEach(function(i){$t(i,e)}),l.definitions&&l.definitions.forEach(function(i){$t(i,e)})}var oi={};(function(){rt.definitions.forEach(function(e){if(e.name){var t=new Set;$t(e,t),oi[e.name.value]=t}})})();function Ki(l,e){for(var t=0;t<l.definitions.length;t++){var i=l.definitions[t];if(i.name&&i.name.value==e)return i}}function Ps(l,e){var t={kind:l.kind,definitions:[Ki(l,e)]};l.hasOwnProperty("loc")&&(t.loc=l.loc);var i=oi[e]||new Set,n=new Set,s=new Set;for(i.forEach(function(r){s.add(r)});s.size>0;){var a=s;s=new Set,a.forEach(function(r){if(!n.has(r)){n.add(r);var h=oi[r]||new Set;h.forEach(function(o){s.add(o)})}})}return n.forEach(function(r){var h=Ki(l,r);h&&t.definitions.push(h)}),t}Ps(rt,"MechanismsOfActionSectionQuery");const Bs=[{id:"mechanismOfAction",label:"Mechanism of Action"},{id:"targetName",label:"Target Name"},{id:"targets",label:"Human targets",filterValue:l=>l.targets.map(e=>e.approvedSymbol).join(" "),exportValue:l=>l.targets.map(e=>e.approvedSymbol).join(),renderCell:({targets:l})=>{if(!l)return"non-human";const e=l.map(t=>({name:t.approvedSymbol,url:`/target/${t.id}`,group:"Human targets"}));return A(ui,{entries:e})}},{id:"references",label:"References",filterValue:l=>l.references.map(e=>e.source).join(" "),exportValue:l=>l.references.map(e=>e.source).join(),renderCell:l=>l.references?l.references.map((e,t)=>q(ke.exports.Fragment,{children:[t>0?", ":null,e.urls?A(ne,{external:!0,to:e.urls[0],children:e.source}):e.source]},t)):"n/a"}];function Os({definition:l,id:e,label:t}){const i={chemblId:e},n=zt(rt,{variables:i}),{data:s}=De(yi.fragments.MechanismsOfActionSummaryFragment);return A(Vt,{definition:l,request:n,renderDescription:()=>A(Ls,{name:t,parentMolecule:s.parentMolecule,childMolecules:s.childMolecules}),renderBody:a=>{const r=a.drug.mechanismsOfAction.rows;return A(ci,{showGlobalFilter:!0,columns:Bs,rows:r,dataDownloader:!0,dataDownloaderFileStem:`${e}-mechanisms-of-action`,query:rt.loc.source.body,variables:i})}})}const Is={id:"mechanismsOfAction",name:"Mechanisms of Action",shortName:"MA",hasData:l=>{var e,t;return((e=l.mechanismsOfAction)==null?void 0:e.uniqueActionTypes.length)>0&&((t=l.mechanismsOfAction)==null?void 0:t.uniqueTargetTypes.length)>0||!1}};var Ms=Object.freeze(Object.defineProperty({__proto__:null,definition:Is,Summary:yi,Body:Os},Symbol.toStringTag,{value:"Module"})),ut={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"AdverseEventsSummaryFragment"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Drug"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"adverseEvents"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"count"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:82}};ut.loc.source={body:`fragment AdverseEventsSummaryFragment on Drug {
  adverseEvents {
    count
  }
}
`,name:"GraphQL request",locationOffset:{line:1,column:1}};function Lt(l,e){if(l.kind==="FragmentSpread")e.add(l.name.value);else if(l.kind==="VariableDefinition"){var t=l.type;t.kind==="NamedType"&&e.add(t.name.value)}l.selectionSet&&l.selectionSet.selections.forEach(function(i){Lt(i,e)}),l.variableDefinitions&&l.variableDefinitions.forEach(function(i){Lt(i,e)}),l.definitions&&l.definitions.forEach(function(i){Lt(i,e)})}var hi={};(function(){ut.definitions.forEach(function(e){if(e.name){var t=new Set;Lt(e,t),hi[e.name.value]=t}})})();function Zi(l,e){for(var t=0;t<l.definitions.length;t++){var i=l.definitions[t];if(i.name&&i.name.value==e)return i}}function zs(l,e){var t={kind:l.kind,definitions:[Zi(l,e)]};l.hasOwnProperty("loc")&&(t.loc=l.loc);var i=hi[e]||new Set,n=new Set,s=new Set;for(i.forEach(function(r){s.add(r)});s.size>0;){var a=s;s=new Set,a.forEach(function(r){if(!n.has(r)){n.add(r);var h=hi[r]||new Set;h.forEach(function(o){s.add(o)})}})}return n.forEach(function(r){var h=Zi(l,r);h&&t.definitions.push(h)}),t}zs(ut,"AdverseEventsSummaryFragment");function vn({definition:l}){const e=De(ut);return A(Ve,{definition:l,request:e,renderSummary:t=>`${t.adverseEvents.count} adverse event${t.adverseEvents.count!==1?"s":""}`})}vn.fragments={AdverseEventsSummaryFragment:ut};function Vs({name:l}){return q(se,{children:["Significant post-marketing adverse events for ",A("strong",{children:l})," ","estimated from reports submitted to the FDA Adverse Event Reporting database by healthcare professionals. Source:"," ",A(ne,{to:"https://platform-docs.opentargets.org/drug/pharmacovigilence",external:!0,children:"Open Targets"}),"."]})}var ze={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AdverseEventsQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"chemblId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"index"}},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}},defaultValue:{kind:"IntValue",value:"0"},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"size"}},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}},defaultValue:{kind:"IntValue",value:"10"},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"drug"},arguments:[{kind:"Argument",name:{kind:"Name",value:"chemblId"},value:{kind:"Variable",name:{kind:"Name",value:"chemblId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",alias:{kind:"Name",value:"maxLlr"},name:{kind:"Name",value:"adverseEvents"},arguments:[{kind:"Argument",name:{kind:"Name",value:"page"},value:{kind:"ObjectValue",fields:[{kind:"ObjectField",name:{kind:"Name",value:"index"},value:{kind:"IntValue",value:"0"}},{kind:"ObjectField",name:{kind:"Name",value:"size"},value:{kind:"IntValue",value:"1"}}]}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"rows"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"logLR"},arguments:[],directives:[]}]}}]}},{kind:"Field",name:{kind:"Name",value:"adverseEvents"},arguments:[{kind:"Argument",name:{kind:"Name",value:"page"},value:{kind:"ObjectValue",fields:[{kind:"ObjectField",name:{kind:"Name",value:"index"},value:{kind:"Variable",name:{kind:"Name",value:"index"}}},{kind:"ObjectField",name:{kind:"Name",value:"size"},value:{kind:"Variable",name:{kind:"Name",value:"size"}}}]}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"criticalValue"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"count"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"rows"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"count"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"logLR"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"meddraCode"},arguments:[],directives:[]}]}}]}}]}}]}}],loc:{start:0,end:404}};ze.loc.source={body:`query AdverseEventsQuery(
  $chemblId: String!
  $index: Int = 0
  $size: Int = 10
) {
  drug(chemblId: $chemblId) {
    id
    maxLlr: adverseEvents(page: { index: 0, size: 1 }) {
      rows {
        logLR
      }
    }
    adverseEvents(page: { index: $index, size: $size }) {
      criticalValue
      count
      rows {
        name
        count
        logLR
        meddraCode
      }
    }
  }
}`,name:"GraphQL request",locationOffset:{line:1,column:1}};function Pt(l,e){if(l.kind==="FragmentSpread")e.add(l.name.value);else if(l.kind==="VariableDefinition"){var t=l.type;t.kind==="NamedType"&&e.add(t.name.value)}l.selectionSet&&l.selectionSet.selections.forEach(function(i){Pt(i,e)}),l.variableDefinitions&&l.variableDefinitions.forEach(function(i){Pt(i,e)}),l.definitions&&l.definitions.forEach(function(i){Pt(i,e)})}var di={};(function(){ze.definitions.forEach(function(e){if(e.name){var t=new Set;Pt(e,t),di[e.name.value]=t}})})();function Ji(l,e){for(var t=0;t<l.definitions.length;t++){var i=l.definitions[t];if(i.name&&i.name.value==e)return i}}function Ws(l,e){var t={kind:l.kind,definitions:[Ji(l,e)]};l.hasOwnProperty("loc")&&(t.loc=l.loc);var i=di[e]||new Set,n=new Set,s=new Set;for(i.forEach(function(r){s.add(r)});s.size>0;){var a=s;s=new Set,a.forEach(function(r){if(!n.has(r)){n.add(r);var h=di[r]||new Set;h.forEach(function(o){s.add(o)})}})}return n.forEach(function(r){var h=Ji(l,r);h&&t.definitions.push(h)}),t}Ws(ze,"AdverseEventsQuery");const qs=tn(l=>({levelBarContainer:{display:"flex",alignItems:"center"},levelBar:{backgroundColor:l.palette.primary.main,borderRight:`1px solid ${l.palette.primary.main}`,height:"10px",marginRight:"5px"}})),Hs=(l,e,t)=>[{id:"name",label:"Adverse event (MedDRA)",renderCell:i=>i.meddraCode?A(ne,{to:`https://identifiers.org/meddra:${i.meddraCode}`,external:!0,children:A(tt,{variant:"caption",noWrap:!0,display:"block",title:Gt.upperFirst(i.name),children:Gt.upperFirst(i.name)})}):Gt.upperFirst(i.name),width:"30%"},{id:"count",label:"Number of reported events",numeric:!0,width:"25%"},{id:"llr",label:`Log likelihood ratio (CV = ${l.toFixed(2)})`,renderCell:i=>{const n=(i.logLR/e*85).toFixed(2);return q("div",{className:t.levelBarContainer,children:[A("div",{className:t.levelBar,style:{width:`${n}%`}}),A("div",{children:i.logLR.toFixed(2)})]})},exportValue:i=>i.logLR.toFixed(2),width:"45%"}];function Ys({definition:l,id:e,label:t}){const i=qs(),n={chemblId:e},[s,a]=ke.exports.useState(0),[r,h]=ke.exports.useState(10),{loading:o,error:d,data:c,fetchMore:u}=zt(ze,{variables:n});function m(k,D){u({variables:{index:k,size:D},updateQuery:(x,{fetchMoreResult:N})=>N})}const S=k=>{a(k),m(k,r)};function p(k){h(k),a(0),m(0,k)}const w=wr(ze,n,"data.drug.adverseEvents");return A(Vt,{definition:l,request:{loading:o,error:d,data:c},renderDescription:()=>A(Vs,{name:t}),renderBody:k=>{const D=k.drug.maxLlr.rows[0].logLR,{criticalValue:x,rows:N,count:B}=k.drug.adverseEvents;return A(vr,{dataDownloader:!0,dataDownloaderRows:w,dataDownloaderFileStem:`${t}-adverse-events`,loading:o,columns:Hs(x,D,i),rows:N,rowCount:B,page:s,onPageChange:S,ActionsComponent:rn,fixed:!0,pageSize:r,rowsPerPageOptions:[10,25,50,100],onRowsPerPageChange:p,query:ze.loc.source.body,variables:n})}})}const Xs={id:"adverseEvents",name:"Pharmacovigilance",shortName:"PV",hasData:l=>{var e;return((e=l.adverseEvents)==null?void 0:e.count)>0||!1}};var Qs=Object.freeze(Object.defineProperty({__proto__:null,definition:Xs,Summary:vn,Body:Ys},Symbol.toStringTag,{value:"Module"}));const Bt=[Ms,Fs,ks,ds,Qs,ms].filter(l=>(_t.profile.hideDrugSectionIds.length===0||!_t.profile.hideDrugSectionIds.includes(l.definition.id))&&(!l.definition.isPrivate||l.definition.isPrivate&&_t.profile.isPartnerPreview)),Us=hr(Bt,"Drug"),Gs=ar`
  query DrugProfileQuery($chemblId: String!) {
    drug(chemblId: $chemblId) {
      id
      ...DrugProfileHeaderFragment
      ...DrugProfileSummaryFragment
    }
  }
  ${Si.fragments.profileHeader}
  ${Us}
`;function ua({chemblId:l,name:e}){return q(dr,{entity:"drug",query:Gs,variables:{chemblId:l},children:[A(Si,{chemblId:l}),q(ur,{sections:Bt,children:[A(cr,{children:Bt.map(({Summary:t,definition:i})=>A(t,{id:l,label:e,definition:i},i.id))}),A(gr,{children:Bt.map(({Body:t,definition:i})=>A(t,{id:l,label:e,definition:i},i.id))})]})]})}export{ua as default};
