var w7=Object.defineProperty,A7=Object.defineProperties;var P7=Object.getOwnPropertyDescriptors;var IA=Object.getOwnPropertySymbols;var T7=Object.prototype.hasOwnProperty,E7=Object.prototype.propertyIsEnumerable;var MA=(e,t,r)=>t in e?w7(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Ha=(e,t)=>{for(var r in t||(t={}))T7.call(t,r)&&MA(e,r,t[r]);if(IA)for(var r of IA(t))E7.call(t,r)&&MA(e,r,t[r]);return e},ki=(e,t)=>A7(e,P7(t));import{g as er,h as ZM,j as Oh,k as JM,T as eb,l as c_}from"./transform.5b5ae4b7.js";import{s as ha,a as eD,p as I7,b as M7,c as D7}from"./Profile.ae480368.js";import{a as R7,t as O7,b as F7,c as k7,i as B7,d as um,l as vy,f as DA}from"./Legend.6c760add.js";import{i as ev,b as tD,S as sp,c as Po,d as RS,g as rD,e as d_,f as OS,h as nD,j as my,k as L7,M as aD,r as N7,l as RA,m as U7,n as z7,o as tb}from"./Body.34aa58e8.js";import{i as V7,l as H7}from"./line.c272abf8.js";import{m as OA}from"./max.9f900090.js";import{cc as Nt,cd as w,a as L,j as Te,ce as Be,r as kt,b as Rt,aq as nd,cf as ce,cg as de,H as G7}from"./index.ec2996a9.js";import"./urls.4a718162.js";import"./ErrorBoundary.830e98b1.js";import"./TableDrawer.dc5a9538.js";import"./graphiql.min.35449f36.js";import"./ToolbarSelect.cd37b9c4.js";import"./TablePagination.6ed57057.js";import"./CardContent.9d8c6621.js";import"./LinearProgress.9b082d1f.js";import"./TargetDescription.9658be78.js";import"./DownloadSvgPlot.4d1bc4ed.js";import"./EllsWrapper.a87a0fb0.js";import"./DataTable.ed138147.js";import"./FormGroup.c3f2d311.js";import"./FormControlLabel.47f62ae2.js";function iD(){for(var e=er,t;t=e.sourceEvent;)e=t;return e}function oD(e,t){var r=e.ownerSVGElement||e;if(r.createSVGPoint){var n=r.createSVGPoint();return n.x=t.clientX,n.y=t.clientY,n=n.matrixTransform(e.getScreenCTM().inverse()),[n.x,n.y]}var a=e.getBoundingClientRect();return[t.clientX-a.left-e.clientLeft,t.clientY-a.top-e.clientTop]}function xh(e){var t=iD();return t.changedTouches&&(t=t.changedTouches[0]),oD(e,t)}function FS(e,t,r){arguments.length<3&&(r=t,t=iD().changedTouches);for(var n=0,a=t?t.length:0,i;n<a;++n)if((i=t[n]).identifier===r)return oD(e,i);return null}function kS(){er.preventDefault(),er.stopImmediatePropagation()}function sD(e){var t=e.document.documentElement,r=ha(e).on("dragstart.drag",kS,!0);"onselectstart"in t?r.on("selectstart.drag",kS,!0):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function uD(e,t){var r=e.document.documentElement,n=ha(e).on("dragstart.drag",null);t&&(n.on("click.drag",kS,!0),setTimeout(function(){n.on("click.drag",null)},0)),"onselectstart"in r?n.on("selectstart.drag",null):(r.style.MozUserSelect=r.__noselect,delete r.__noselect)}var Yp=Math.SQRT2,rb=2,FA=4,q7=1e-12;function kA(e){return((e=Math.exp(e))+1/e)/2}function j7(e){return((e=Math.exp(e))-1/e)/2}function W7(e){return((e=Math.exp(2*e))-1)/(e+1)}function X7(e,t){var r=e[0],n=e[1],a=e[2],i=t[0],o=t[1],s=t[2],u=i-r,l=o-n,c=u*u+l*l,d,f;if(c<q7)f=Math.log(s/a)/Yp,d=function(y){return[r+y*u,n+y*l,a*Math.exp(Yp*y*f)]};else{var p=Math.sqrt(c),h=(s*s-a*a+FA*c)/(2*a*rb*p),v=(s*s-a*a-FA*c)/(2*s*rb*p),m=Math.log(Math.sqrt(h*h+1)-h),g=Math.log(Math.sqrt(v*v+1)-v);f=(g-m)/Yp,d=function(y){var b=y*f,x=kA(m),S=a/(rb*p)*(x*W7(Yp*b+m)-j7(m));return[r+S*u,n+S*l,a*x/kA(Yp*b+m)]}}return d.duration=f*1e3,d}function nb(e){return function(){return e}}function Y7(e,t,r){this.target=e,this.type=t,this.selection=r}function BA(){er.stopImmediatePropagation()}function ab(){er.preventDefault(),er.stopImmediatePropagation()}var LA={name:"drag"},ib={name:"space"},bf={name:"handle"},Sf={name:"center"};function NA(e){return[+e[0],+e[1]]}function UA(e){return[NA(e[0]),NA(e[1])]}function K7(e){return function(t){return FS(t,er.touches,e)}}var x0={name:"x",handles:["w","e"].map(U0),input:function(e,t){return e==null?null:[[+e[0],t[0][1]],[+e[1],t[1][1]]]},output:function(e){return e&&[e[0][0],e[1][0]]}},ob={name:"y",handles:["n","s"].map(U0),input:function(e,t){return e==null?null:[[t[0][0],+e[0]],[t[1][0],+e[1]]]},output:function(e){return e&&[e[0][1],e[1][1]]}},ru={overlay:"crosshair",selection:"move",n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},zA={e:"w",w:"e",nw:"ne",ne:"nw",se:"sw",sw:"se"},VA={n:"s",s:"n",nw:"sw",ne:"se",se:"ne",sw:"nw"},$7={overlay:1,selection:1,n:null,e:1,s:null,w:-1,nw:-1,ne:1,se:1,sw:-1},Q7={overlay:1,selection:1,n:-1,e:null,s:1,w:null,nw:-1,ne:-1,se:1,sw:1};function U0(e){return{type:e}}function Z7(){return!er.ctrlKey&&!er.button}function J7(){var e=this.ownerSVGElement||this;return e.hasAttribute("viewBox")?(e=e.viewBox.baseVal,[[e.x,e.y],[e.x+e.width,e.y+e.height]]):[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]}function e9(){return navigator.maxTouchPoints||"ontouchstart"in this}function sb(e){for(;!e.__brush;)if(!(e=e.parentNode))return;return e.__brush}function t9(e){return e[0][0]===e[1][0]||e[0][1]===e[1][1]}function r9(){return n9(x0)}function n9(e){var t=J7,r=Z7,n=e9,a=!0,i=ZM("start","brush","end"),o=6,s;function u(m){var g=m.property("__brush",v).selectAll(".overlay").data([U0("overlay")]);g.enter().append("rect").attr("class","overlay").attr("pointer-events","all").attr("cursor",ru.overlay).merge(g).each(function(){var b=sb(this).extent;ha(this).attr("x",b[0][0]).attr("y",b[0][1]).attr("width",b[1][0]-b[0][0]).attr("height",b[1][1]-b[0][1])}),m.selectAll(".selection").data([U0("selection")]).enter().append("rect").attr("class","selection").attr("cursor",ru.selection).attr("fill","#777").attr("fill-opacity",.3).attr("stroke","#fff").attr("shape-rendering","crispEdges");var y=m.selectAll(".handle").data(e.handles,function(b){return b.type});y.exit().remove(),y.enter().append("rect").attr("class",function(b){return"handle handle--"+b.type}).attr("cursor",function(b){return ru[b.type]}),m.each(l).attr("fill","none").attr("pointer-events","all").on("mousedown.brush",f).filter(n).on("touchstart.brush",f).on("touchmove.brush",p).on("touchend.brush touchcancel.brush",h).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}u.move=function(m,g){m.selection?m.on("start.brush",function(){c(this,arguments).beforestart().start()}).on("interrupt.brush end.brush",function(){c(this,arguments).end()}).tween("brush",function(){var y=this,b=y.__brush,x=c(y,arguments),S=b.selection,_=e.input(typeof g=="function"?g.apply(this,arguments):g,b.extent),A=R7(S,_);function T(I){b.selection=I===1&&_===null?null:A(I),l.call(y),x.brush()}return S!==null&&_!==null?T:T(1)}):m.each(function(){var y=this,b=arguments,x=y.__brush,S=e.input(typeof g=="function"?g.apply(y,b):g,x.extent),_=c(y,b).beforestart();Oh(y),x.selection=S===null?null:S,l.call(y),_.start().brush().end()})},u.clear=function(m){u.move(m,null)};function l(){var m=ha(this),g=sb(this).selection;g?(m.selectAll(".selection").style("display",null).attr("x",g[0][0]).attr("y",g[0][1]).attr("width",g[1][0]-g[0][0]).attr("height",g[1][1]-g[0][1]),m.selectAll(".handle").style("display",null).attr("x",function(y){return y.type[y.type.length-1]==="e"?g[1][0]-o/2:g[0][0]-o/2}).attr("y",function(y){return y.type[0]==="s"?g[1][1]-o/2:g[0][1]-o/2}).attr("width",function(y){return y.type==="n"||y.type==="s"?g[1][0]-g[0][0]+o:o}).attr("height",function(y){return y.type==="e"||y.type==="w"?g[1][1]-g[0][1]+o:o})):m.selectAll(".selection,.handle").style("display","none").attr("x",null).attr("y",null).attr("width",null).attr("height",null)}function c(m,g,y){var b=m.__brush.emitter;return b&&(!y||!b.clean)?b:new d(m,g,y)}function d(m,g,y){this.that=m,this.args=g,this.state=m.__brush,this.active=0,this.clean=y}d.prototype={beforestart:function(){return++this.active===1&&(this.state.emitter=this,this.starting=!0),this},start:function(){return this.starting?(this.starting=!1,this.emit("start")):this.emit("brush"),this},brush:function(){return this.emit("brush"),this},end:function(){return--this.active===0&&(delete this.state.emitter,this.emit("end")),this},emit:function(m){JM(new Y7(u,m,e.output(this.state.selection)),i.apply,i,[m,this.that,this.args])}};function f(){if(s&&!er.touches||!r.apply(this,arguments))return;var m=this,g=er.target.__data__.type,y=(a&&er.metaKey?g="overlay":g)==="selection"?LA:a&&er.altKey?Sf:bf,b=e===ob?null:$7[g],x=e===x0?null:Q7[g],S=sb(m),_=S.extent,A=S.selection,T=_[0][0],I,M,O=_[0][1],D,F,G=_[1][0],N,z,$=_[1][1],j,Z,q=0,te=0,he,W=b&&x&&a&&er.shiftKey,K,U,H=er.touches?K7(er.changedTouches[0].identifier):xh,J=H(m),X=J,Q=c(m,arguments,!0).beforestart();g==="overlay"?(A&&(he=!0),S.selection=A=[[I=e===ob?T:J[0],D=e===x0?O:J[1]],[N=e===ob?G:I,j=e===x0?$:D]]):(I=A[0][0],D=A[0][1],N=A[1][0],j=A[1][1]),M=I,F=D,z=N,Z=j;var ee=ha(m).attr("pointer-events","none"),le=ee.selectAll(".overlay").attr("cursor",ru[g]);if(er.touches)Q.moved=be,Q.ended=xe;else{var ye=ha(er.view).on("mousemove.brush",be,!0).on("mouseup.brush",xe,!0);a&&ye.on("keydown.brush",ae,!0).on("keyup.brush",oe,!0),sD(er.view)}BA(),Oh(m),l.call(m),Q.start();function be(){var R=H(m);W&&!K&&!U&&(Math.abs(R[0]-X[0])>Math.abs(R[1]-X[1])?U=!0:K=!0),X=R,he=!0,ab(),Ae()}function Ae(){var R;switch(q=X[0]-J[0],te=X[1]-J[1],y){case ib:case LA:{b&&(q=Math.max(T-I,Math.min(G-N,q)),M=I+q,z=N+q),x&&(te=Math.max(O-D,Math.min($-j,te)),F=D+te,Z=j+te);break}case bf:{b<0?(q=Math.max(T-I,Math.min(G-I,q)),M=I+q,z=N):b>0&&(q=Math.max(T-N,Math.min(G-N,q)),M=I,z=N+q),x<0?(te=Math.max(O-D,Math.min($-D,te)),F=D+te,Z=j):x>0&&(te=Math.max(O-j,Math.min($-j,te)),F=D,Z=j+te);break}case Sf:{b&&(M=Math.max(T,Math.min(G,I-q*b)),z=Math.max(T,Math.min(G,N+q*b))),x&&(F=Math.max(O,Math.min($,D-te*x)),Z=Math.max(O,Math.min($,j+te*x)));break}}z<M&&(b*=-1,R=I,I=N,N=R,R=M,M=z,z=R,g in zA&&le.attr("cursor",ru[g=zA[g]])),Z<F&&(x*=-1,R=D,D=j,j=R,R=F,F=Z,Z=R,g in VA&&le.attr("cursor",ru[g=VA[g]])),S.selection&&(A=S.selection),K&&(M=A[0][0],z=A[1][0]),U&&(F=A[0][1],Z=A[1][1]),(A[0][0]!==M||A[0][1]!==F||A[1][0]!==z||A[1][1]!==Z)&&(S.selection=[[M,F],[z,Z]],l.call(m),Q.brush())}function xe(){if(BA(),er.touches){if(er.touches.length)return;s&&clearTimeout(s),s=setTimeout(function(){s=null},500)}else uD(er.view,he),ye.on("keydown.brush keyup.brush mousemove.brush mouseup.brush",null);ee.attr("pointer-events","all"),le.attr("cursor",ru.overlay),S.selection&&(A=S.selection),t9(A)&&(S.selection=null,l.call(m)),Q.end()}function ae(){switch(er.keyCode){case 16:{W=b&&x;break}case 18:{y===bf&&(b&&(N=z-q*b,I=M+q*b),x&&(j=Z-te*x,D=F+te*x),y=Sf,Ae());break}case 32:{(y===bf||y===Sf)&&(b<0?N=z-q:b>0&&(I=M-q),x<0?j=Z-te:x>0&&(D=F-te),y=ib,le.attr("cursor",ru.selection),Ae());break}default:return}ab()}function oe(){switch(er.keyCode){case 16:{W&&(K=U=W=!1,Ae());break}case 18:{y===Sf&&(b<0?N=z:b>0&&(I=M),x<0?j=Z:x>0&&(D=F),y=bf,Ae());break}case 32:{y===ib&&(er.altKey?(b&&(N=z-q*b,I=M+q*b),x&&(j=Z-te*x,D=F+te*x),y=Sf):(b<0?N=z:b>0&&(I=M),x<0?j=Z:x>0&&(D=F),y=bf),le.attr("cursor",ru[g]),Ae());break}default:return}ab()}}function p(){c(this,arguments).moved()}function h(){c(this,arguments).ended()}function v(){var m=this.__brush||{selection:null};return m.extent=UA(t.apply(this,arguments)),m.dim=e,m}return u.extent=function(m){return arguments.length?(t=typeof m=="function"?m:nb(UA(m)),u):t},u.filter=function(m){return arguments.length?(r=typeof m=="function"?m:nb(!!m),u):r},u.touchable=function(m){return arguments.length?(n=typeof m=="function"?m:nb(!!m),u):n},u.handleSize=function(m){return arguments.length?(o=+m,u):o},u.keyModifiers=function(m){return arguments.length?(a=!!m,u):a},u.on=function(){var m=i.on.apply(i,arguments);return m===i?u:m},u}function HA(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function a9(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function i9(e){return e<0?-e*e:e*e}function o9(e){var t=e(um,um),r=1;function n(){return r===1?e(um,um):r===.5?e(a9,i9):e(HA(r),HA(1/r))}return t.exponent=function(a){return arguments.length?(r=+a,n()):r},F7(t)}function lD(){var e=o9(O7());return e.copy=function(){return k7(e,lD()).exponent(e.exponent())},B7.apply(e,arguments),e}function lm(e){return function(){return e}}function s9(e,t,r){this.target=e,this.type=t,this.transform=r}function ub(){er.stopImmediatePropagation()}function Kp(){er.preventDefault(),er.stopImmediatePropagation()}function u9(){return!er.ctrlKey&&!er.button}function l9(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e,e.hasAttribute("viewBox")?(e=e.viewBox.baseVal,[[e.x,e.y],[e.x+e.width,e.y+e.height]]):[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]):[[0,0],[e.clientWidth,e.clientHeight]]}function GA(){return this.__zoom||c_}function c9(){return-er.deltaY*(er.deltaMode===1?.05:er.deltaMode?1:.002)}function d9(){return navigator.maxTouchPoints||"ontouchstart"in this}function f9(e,t,r){var n=e.invertX(t[0][0])-r[0][0],a=e.invertX(t[1][0])-r[1][0],i=e.invertY(t[0][1])-r[0][1],o=e.invertY(t[1][1])-r[1][1];return e.translate(a>n?(n+a)/2:Math.min(0,n)||Math.max(0,a),o>i?(i+o)/2:Math.min(0,i)||Math.max(0,o))}function p9(){var e=u9,t=l9,r=f9,n=c9,a=d9,i=[0,1/0],o=[[-1/0,-1/0],[1/0,1/0]],s=250,u=X7,l=ZM("start","zoom","end"),c,d,f=500,p=150,h=0;function v(D){D.property("__zoom",GA).on("wheel.zoom",_).on("mousedown.zoom",A).on("dblclick.zoom",T).filter(a).on("touchstart.zoom",I).on("touchmove.zoom",M).on("touchend.zoom touchcancel.zoom",O).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}v.transform=function(D,F,G){var N=D.selection?D.selection():D;N.property("__zoom",GA),D!==N?b(D,F,G):N.interrupt().each(function(){x(this,arguments).start().zoom(null,typeof F=="function"?F.apply(this,arguments):F).end()})},v.scaleBy=function(D,F,G){v.scaleTo(D,function(){var N=this.__zoom.k,z=typeof F=="function"?F.apply(this,arguments):F;return N*z},G)},v.scaleTo=function(D,F,G){v.transform(D,function(){var N=t.apply(this,arguments),z=this.__zoom,$=G==null?y(N):typeof G=="function"?G.apply(this,arguments):G,j=z.invert($),Z=typeof F=="function"?F.apply(this,arguments):F;return r(g(m(z,Z),$,j),N,o)},G)},v.translateBy=function(D,F,G){v.transform(D,function(){return r(this.__zoom.translate(typeof F=="function"?F.apply(this,arguments):F,typeof G=="function"?G.apply(this,arguments):G),t.apply(this,arguments),o)})},v.translateTo=function(D,F,G,N){v.transform(D,function(){var z=t.apply(this,arguments),$=this.__zoom,j=N==null?y(z):typeof N=="function"?N.apply(this,arguments):N;return r(c_.translate(j[0],j[1]).scale($.k).translate(typeof F=="function"?-F.apply(this,arguments):-F,typeof G=="function"?-G.apply(this,arguments):-G),z,o)},N)};function m(D,F){return F=Math.max(i[0],Math.min(i[1],F)),F===D.k?D:new eb(F,D.x,D.y)}function g(D,F,G){var N=F[0]-G[0]*D.k,z=F[1]-G[1]*D.k;return N===D.x&&z===D.y?D:new eb(D.k,N,z)}function y(D){return[(+D[0][0]+ +D[1][0])/2,(+D[0][1]+ +D[1][1])/2]}function b(D,F,G){D.on("start.zoom",function(){x(this,arguments).start()}).on("interrupt.zoom end.zoom",function(){x(this,arguments).end()}).tween("zoom",function(){var N=this,z=arguments,$=x(N,z),j=t.apply(N,z),Z=G==null?y(j):typeof G=="function"?G.apply(N,z):G,q=Math.max(j[1][0]-j[0][0],j[1][1]-j[0][1]),te=N.__zoom,he=typeof F=="function"?F.apply(N,z):F,W=u(te.invert(Z).concat(q/te.k),he.invert(Z).concat(q/he.k));return function(K){if(K===1)K=he;else{var U=W(K),H=q/U[2];K=new eb(H,Z[0]-U[0]*H,Z[1]-U[1]*H)}$.zoom(null,K)}})}function x(D,F,G){return!G&&D.__zooming||new S(D,F)}function S(D,F){this.that=D,this.args=F,this.active=0,this.extent=t.apply(D,F),this.taps=0}S.prototype={start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(D,F){return this.mouse&&D!=="mouse"&&(this.mouse[1]=F.invert(this.mouse[0])),this.touch0&&D!=="touch"&&(this.touch0[1]=F.invert(this.touch0[0])),this.touch1&&D!=="touch"&&(this.touch1[1]=F.invert(this.touch1[0])),this.that.__zoom=F,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(D){JM(new s9(v,D,this.that.__zoom),l.apply,l,[D,this.that,this.args])}};function _(){if(!e.apply(this,arguments))return;var D=x(this,arguments),F=this.__zoom,G=Math.max(i[0],Math.min(i[1],F.k*Math.pow(2,n.apply(this,arguments)))),N=xh(this);if(D.wheel)(D.mouse[0][0]!==N[0]||D.mouse[0][1]!==N[1])&&(D.mouse[1]=F.invert(D.mouse[0]=N)),clearTimeout(D.wheel);else{if(F.k===G)return;D.mouse=[N,F.invert(N)],Oh(this),D.start()}Kp(),D.wheel=setTimeout(z,p),D.zoom("mouse",r(g(m(F,G),D.mouse[0],D.mouse[1]),D.extent,o));function z(){D.wheel=null,D.end()}}function A(){if(d||!e.apply(this,arguments))return;var D=x(this,arguments,!0),F=ha(er.view).on("mousemove.zoom",$,!0).on("mouseup.zoom",j,!0),G=xh(this),N=er.clientX,z=er.clientY;sD(er.view),ub(),D.mouse=[G,this.__zoom.invert(G)],Oh(this),D.start();function $(){if(Kp(),!D.moved){var Z=er.clientX-N,q=er.clientY-z;D.moved=Z*Z+q*q>h}D.zoom("mouse",r(g(D.that.__zoom,D.mouse[0]=xh(D.that),D.mouse[1]),D.extent,o))}function j(){F.on("mousemove.zoom mouseup.zoom",null),uD(er.view,D.moved),Kp(),D.end()}}function T(){if(!!e.apply(this,arguments)){var D=this.__zoom,F=xh(this),G=D.invert(F),N=D.k*(er.shiftKey?.5:2),z=r(g(m(D,N),F,G),t.apply(this,arguments),o);Kp(),s>0?ha(this).transition().duration(s).call(b,z,F):ha(this).call(v.transform,z)}}function I(){if(!!e.apply(this,arguments)){var D=er.touches,F=D.length,G=x(this,arguments,er.changedTouches.length===F),N,z,$,j;for(ub(),z=0;z<F;++z)$=D[z],j=FS(this,D,$.identifier),j=[j,this.__zoom.invert(j),$.identifier],G.touch0?!G.touch1&&G.touch0[2]!==j[2]&&(G.touch1=j,G.taps=0):(G.touch0=j,N=!0,G.taps=1+!!c);c&&(c=clearTimeout(c)),N&&(G.taps<2&&(c=setTimeout(function(){c=null},f)),Oh(this),G.start())}}function M(){if(!!this.__zooming){var D=x(this,arguments),F=er.changedTouches,G=F.length,N,z,$,j;for(Kp(),c&&(c=clearTimeout(c)),D.taps=0,N=0;N<G;++N)z=F[N],$=FS(this,F,z.identifier),D.touch0&&D.touch0[2]===z.identifier?D.touch0[0]=$:D.touch1&&D.touch1[2]===z.identifier&&(D.touch1[0]=$);if(z=D.that.__zoom,D.touch1){var Z=D.touch0[0],q=D.touch0[1],te=D.touch1[0],he=D.touch1[1],W=(W=te[0]-Z[0])*W+(W=te[1]-Z[1])*W,K=(K=he[0]-q[0])*K+(K=he[1]-q[1])*K;z=m(z,Math.sqrt(W/K)),$=[(Z[0]+te[0])/2,(Z[1]+te[1])/2],j=[(q[0]+he[0])/2,(q[1]+he[1])/2]}else if(D.touch0)$=D.touch0[0],j=D.touch0[1];else return;D.zoom("touch",r(g(z,$,j),D.extent,o))}}function O(){if(!!this.__zooming){var D=x(this,arguments),F=er.changedTouches,G=F.length,N,z;for(ub(),d&&clearTimeout(d),d=setTimeout(function(){d=null},f),N=0;N<G;++N)z=F[N],D.touch0&&D.touch0[2]===z.identifier?delete D.touch0:D.touch1&&D.touch1[2]===z.identifier&&delete D.touch1;if(D.touch1&&!D.touch0&&(D.touch0=D.touch1,delete D.touch1),D.touch0)D.touch0[1]=this.__zoom.invert(D.touch0[0]);else if(D.end(),D.taps===2){var $=ha(this).on("dblclick.zoom");$&&$.apply(this,arguments)}}}return v.wheelDelta=function(D){return arguments.length?(n=typeof D=="function"?D:lm(+D),v):n},v.filter=function(D){return arguments.length?(e=typeof D=="function"?D:lm(!!D),v):e},v.touchable=function(D){return arguments.length?(a=typeof D=="function"?D:lm(!!D),v):a},v.extent=function(D){return arguments.length?(t=typeof D=="function"?D:lm([[+D[0][0],+D[0][1]],[+D[1][0],+D[1][1]]]),v):t},v.scaleExtent=function(D){return arguments.length?(i[0]=+D[0],i[1]=+D[1],v):[i[0],i[1]]},v.translateExtent=function(D){return arguments.length?(o[0][0]=+D[0][0],o[1][0]=+D[1][0],o[0][1]=+D[0][1],o[1][1]=+D[1][1],v):[[o[0][0],o[0][1]],[o[1][0],o[1][1]]]},v.constrain=function(D){return arguments.length?(r=D,v):r},v.duration=function(D){return arguments.length?(s=+D,v):s},v.interpolate=function(D){return arguments.length?(u=D,v):u},v.on=function(){var D=l.on.apply(l,arguments);return D===l?v:D},v.clickDistance=function(D){return arguments.length?(h=(D=+D)*D,v):Math.sqrt(h)},v}var h9="[object Symbol]";function gy(e){return typeof e=="symbol"||ev(e)&&tD(e)==h9}function yy(e,t){for(var r=-1,n=e==null?0:e.length,a=Array(n);++r<n;)a[r]=t(e[r],r,e);return a}var v9=1/0,qA=sp?sp.prototype:void 0,jA=qA?qA.toString:void 0;function cD(e){if(typeof e=="string")return e;if(Po(e))return yy(e,cD)+"";if(gy(e))return jA?jA.call(e):"";var t=e+"";return t=="0"&&1/e==-v9?"-0":t}var m9=/\s/;function g9(e){for(var t=e.length;t--&&m9.test(e.charAt(t)););return t}var y9=/^\s+/;function b9(e){return e&&e.slice(0,g9(e)+1).replace(y9,"")}var WA=0/0,S9=/^[-+]0x[0-9a-f]+$/i,x9=/^0b[01]+$/i,C9=/^0o[0-7]+$/i,_9=parseInt;function w9(e){if(typeof e=="number")return e;if(gy(e))return WA;if(RS(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=RS(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=b9(e);var r=x9.test(e);return r||C9.test(e)?_9(e.slice(2),r?2:8):S9.test(e)?WA:+e}var XA=1/0,A9=17976931348623157e292;function P9(e){if(!e)return e===0?e:0;if(e=w9(e),e===XA||e===-XA){var t=e<0?-1:1;return t*A9}return e===e?e:0}function T9(e){var t=P9(e),r=t%1;return t===t?r?t-r:t:0}function f_(e){return e}function E9(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}function I9(){}var M9=800,D9=16,R9=Date.now;function O9(e){var t=0,r=0;return function(){var n=R9(),a=D9-(n-r);if(r=n,a>0){if(++t>=M9)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}function F9(e){return function(){return e}}var k9=function(){try{var e=rD(Object,"defineProperty");return e({},"",{}),e}catch{}}(),z0=k9,B9=z0?function(e,t){return z0(e,"toString",{configurable:!0,enumerable:!1,value:F9(t),writable:!0})}:f_,L9=B9,N9=O9(L9),U9=N9;function z9(e,t,r,n){for(var a=e.length,i=r+(n?1:-1);n?i--:++i<a;)if(t(e[i],i,e))return i;return-1}function V9(e){return e!==e}function H9(e,t,r){for(var n=r-1,a=e.length;++n<a;)if(e[n]===t)return n;return-1}function dD(e,t,r){return t===t?H9(e,t,r):z9(e,V9,r)}function fD(e,t){var r=e==null?0:e.length;return!!r&&dD(e,t,0)>-1}var G9=9007199254740991,q9=/^(?:0|[1-9]\d*)$/;function pD(e,t){var r=typeof e;return t=t==null?G9:t,!!t&&(r=="number"||r!="symbol"&&q9.test(e))&&e>-1&&e%1==0&&e<t}function j9(e,t,r){t=="__proto__"&&z0?z0(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}function hD(e,t){return e===t||e!==e&&t!==t}var YA=Math.max;function W9(e,t,r){return t=YA(t===void 0?e.length-1:t,0),function(){for(var n=arguments,a=-1,i=YA(n.length-t,0),o=Array(i);++a<i;)o[a]=n[t+a];a=-1;for(var s=Array(t+1);++a<t;)s[a]=n[a];return s[t]=r(o),E9(e,this,s)}}function vD(e,t){return U9(W9(e,t,f_),e+"")}function X9(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}var Y9=Object.prototype,K9=Y9.hasOwnProperty;function $9(e,t){var r=Po(e),n=!r&&d_(e),a=!r&&!n&&OS(e),i=!r&&!n&&!a&&nD(e),o=r||n||a||i,s=o?X9(e.length,String):[],u=s.length;for(var l in e)(t||K9.call(e,l))&&!(o&&(l=="length"||a&&(l=="offset"||l=="parent")||i&&(l=="buffer"||l=="byteLength"||l=="byteOffset")||pD(l,u)))&&s.push(l);return s}function by(e){return my(e)?$9(e):L7(e)}var Q9=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Z9=/^\w*$/;function p_(e,t){if(Po(e))return!1;var r=typeof e;return r=="number"||r=="symbol"||r=="boolean"||e==null||gy(e)?!0:Z9.test(e)||!Q9.test(e)||t!=null&&e in Object(t)}var J9=rD(Object,"create"),tv=J9;function eU(){this.__data__=tv?tv(null):{},this.size=0}function tU(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var rU="__lodash_hash_undefined__",nU=Object.prototype,aU=nU.hasOwnProperty;function iU(e){var t=this.__data__;if(tv){var r=t[e];return r===rU?void 0:r}return aU.call(t,e)?t[e]:void 0}var oU=Object.prototype,sU=oU.hasOwnProperty;function uU(e){var t=this.__data__;return tv?t[e]!==void 0:sU.call(t,e)}var lU="__lodash_hash_undefined__";function cU(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=tv&&t===void 0?lU:t,this}function Pd(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Pd.prototype.clear=eU;Pd.prototype.delete=tU;Pd.prototype.get=iU;Pd.prototype.has=uU;Pd.prototype.set=cU;function dU(){this.__data__=[],this.size=0}function Sy(e,t){for(var r=e.length;r--;)if(hD(e[r][0],t))return r;return-1}var fU=Array.prototype,pU=fU.splice;function hU(e){var t=this.__data__,r=Sy(t,e);if(r<0)return!1;var n=t.length-1;return r==n?t.pop():pU.call(t,r,1),--this.size,!0}function vU(e){var t=this.__data__,r=Sy(t,e);return r<0?void 0:t[r][1]}function mU(e){return Sy(this.__data__,e)>-1}function gU(e,t){var r=this.__data__,n=Sy(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this}function tl(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}tl.prototype.clear=dU;tl.prototype.delete=hU;tl.prototype.get=vU;tl.prototype.has=mU;tl.prototype.set=gU;function yU(){this.size=0,this.__data__={hash:new Pd,map:new(aD||tl),string:new Pd}}function bU(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function xy(e,t){var r=e.__data__;return bU(t)?r[typeof t=="string"?"string":"hash"]:r.map}function SU(e){var t=xy(this,e).delete(e);return this.size-=t?1:0,t}function xU(e){return xy(this,e).get(e)}function CU(e){return xy(this,e).has(e)}function _U(e,t){var r=xy(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this}function rl(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}rl.prototype.clear=yU;rl.prototype.delete=SU;rl.prototype.get=xU;rl.prototype.has=CU;rl.prototype.set=_U;var wU="Expected a function";function h_(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(wU);var r=function(){var n=arguments,a=t?t.apply(this,n):n[0],i=r.cache;if(i.has(a))return i.get(a);var o=e.apply(this,n);return r.cache=i.set(a,o)||i,o};return r.cache=new(h_.Cache||rl),r}h_.Cache=rl;var AU=500;function PU(e){var t=h_(e,function(n){return r.size===AU&&r.clear(),n}),r=t.cache;return t}var TU=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,EU=/\\(\\)?/g,IU=PU(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(TU,function(r,n,a,i){t.push(a?i.replace(EU,"$1"):n||r)}),t}),MU=IU;function DU(e){return e==null?"":cD(e)}function mD(e,t){return Po(e)?e:p_(e,t)?[e]:MU(DU(e))}var RU=1/0;function Cy(e){if(typeof e=="string"||gy(e))return e;var t=e+"";return t=="0"&&1/e==-RU?"-0":t}function gD(e,t){t=mD(t,e);for(var r=0,n=t.length;e!=null&&r<n;)e=e[Cy(t[r++])];return r&&r==n?e:void 0}function OU(e,t,r){var n=e==null?void 0:gD(e,t);return n===void 0?r:n}function yD(e,t){for(var r=-1,n=t.length,a=e.length;++r<n;)e[a+r]=t[r];return e}var KA=sp?sp.isConcatSpreadable:void 0;function FU(e){return Po(e)||d_(e)||!!(KA&&e&&e[KA])}function bD(e,t,r,n,a){var i=-1,o=e.length;for(r||(r=FU),a||(a=[]);++i<o;){var s=e[i];t>0&&r(s)?t>1?bD(s,t-1,r,n,a):yD(a,s):n||(a[a.length]=s)}return a}function kU(){this.__data__=new tl,this.size=0}function BU(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r}function LU(e){return this.__data__.get(e)}function NU(e){return this.__data__.has(e)}var UU=200;function zU(e,t){var r=this.__data__;if(r instanceof tl){var n=r.__data__;if(!aD||n.length<UU-1)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new rl(n)}return r.set(e,t),this.size=r.size,this}function Eu(e){var t=this.__data__=new tl(e);this.size=t.size}Eu.prototype.clear=kU;Eu.prototype.delete=BU;Eu.prototype.get=LU;Eu.prototype.has=NU;Eu.prototype.set=zU;function VU(e,t){for(var r=-1,n=e==null?0:e.length,a=0,i=[];++r<n;){var o=e[r];t(o,r,e)&&(i[a++]=o)}return i}function HU(){return[]}var GU=Object.prototype,qU=GU.propertyIsEnumerable,$A=Object.getOwnPropertySymbols,jU=$A?function(e){return e==null?[]:(e=Object(e),VU($A(e),function(t){return qU.call(e,t)}))}:HU,WU=jU;function XU(e,t,r){var n=t(e);return Po(e)?n:yD(n,r(e))}function QA(e){return XU(e,by,WU)}var YU=N7.Uint8Array,ZA=YU,KU="__lodash_hash_undefined__";function $U(e){return this.__data__.set(e,KU),this}function QU(e){return this.__data__.has(e)}function up(e){var t=-1,r=e==null?0:e.length;for(this.__data__=new rl;++t<r;)this.add(e[t])}up.prototype.add=up.prototype.push=$U;up.prototype.has=QU;function ZU(e,t){for(var r=-1,n=e==null?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1}function V0(e,t){return e.has(t)}var JU=1,ez=2;function SD(e,t,r,n,a,i){var o=r&JU,s=e.length,u=t.length;if(s!=u&&!(o&&u>s))return!1;var l=i.get(e),c=i.get(t);if(l&&c)return l==t&&c==e;var d=-1,f=!0,p=r&ez?new up:void 0;for(i.set(e,t),i.set(t,e);++d<s;){var h=e[d],v=t[d];if(n)var m=o?n(v,h,d,t,e,i):n(h,v,d,e,t,i);if(m!==void 0){if(m)continue;f=!1;break}if(p){if(!ZU(t,function(g,y){if(!V0(p,y)&&(h===g||a(h,g,r,n,i)))return p.push(y)})){f=!1;break}}else if(!(h===v||a(h,v,r,n,i))){f=!1;break}}return i.delete(e),i.delete(t),f}function tz(e){var t=-1,r=Array(e.size);return e.forEach(function(n,a){r[++t]=[a,n]}),r}function v_(e){var t=-1,r=Array(e.size);return e.forEach(function(n){r[++t]=n}),r}var rz=1,nz=2,az="[object Boolean]",iz="[object Date]",oz="[object Error]",sz="[object Map]",uz="[object Number]",lz="[object RegExp]",cz="[object Set]",dz="[object String]",fz="[object Symbol]",pz="[object ArrayBuffer]",hz="[object DataView]",JA=sp?sp.prototype:void 0,lb=JA?JA.valueOf:void 0;function vz(e,t,r,n,a,i,o){switch(r){case hz:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case pz:return!(e.byteLength!=t.byteLength||!i(new ZA(e),new ZA(t)));case az:case iz:case uz:return hD(+e,+t);case oz:return e.name==t.name&&e.message==t.message;case lz:case dz:return e==t+"";case sz:var s=tz;case cz:var u=n&rz;if(s||(s=v_),e.size!=t.size&&!u)return!1;var l=o.get(e);if(l)return l==t;n|=nz,o.set(e,t);var c=SD(s(e),s(t),n,a,i,o);return o.delete(e),c;case fz:if(lb)return lb.call(e)==lb.call(t)}return!1}var mz=1,gz=Object.prototype,yz=gz.hasOwnProperty;function bz(e,t,r,n,a,i){var o=r&mz,s=QA(e),u=s.length,l=QA(t),c=l.length;if(u!=c&&!o)return!1;for(var d=u;d--;){var f=s[d];if(!(o?f in t:yz.call(t,f)))return!1}var p=i.get(e),h=i.get(t);if(p&&h)return p==t&&h==e;var v=!0;i.set(e,t),i.set(t,e);for(var m=o;++d<u;){f=s[d];var g=e[f],y=t[f];if(n)var b=o?n(y,g,f,t,e,i):n(g,y,f,e,t,i);if(!(b===void 0?g===y||a(g,y,r,n,i):b)){v=!1;break}m||(m=f=="constructor")}if(v&&!m){var x=e.constructor,S=t.constructor;x!=S&&"constructor"in e&&"constructor"in t&&!(typeof x=="function"&&x instanceof x&&typeof S=="function"&&S instanceof S)&&(v=!1)}return i.delete(e),i.delete(t),v}var Sz=1,e4="[object Arguments]",t4="[object Array]",cm="[object Object]",xz=Object.prototype,r4=xz.hasOwnProperty;function Cz(e,t,r,n,a,i){var o=Po(e),s=Po(t),u=o?t4:RA(e),l=s?t4:RA(t);u=u==e4?cm:u,l=l==e4?cm:l;var c=u==cm,d=l==cm,f=u==l;if(f&&OS(e)){if(!OS(t))return!1;o=!0,c=!1}if(f&&!c)return i||(i=new Eu),o||nD(e)?SD(e,t,r,n,a,i):vz(e,t,u,r,n,a,i);if(!(r&Sz)){var p=c&&r4.call(e,"__wrapped__"),h=d&&r4.call(t,"__wrapped__");if(p||h){var v=p?e.value():e,m=h?t.value():t;return i||(i=new Eu),a(v,m,r,n,i)}}return f?(i||(i=new Eu),bz(e,t,r,n,a,i)):!1}function m_(e,t,r,n,a){return e===t?!0:e==null||t==null||!ev(e)&&!ev(t)?e!==e&&t!==t:Cz(e,t,r,n,m_,a)}var _z=1,wz=2;function Az(e,t,r,n){var a=r.length,i=a,o=!n;if(e==null)return!i;for(e=Object(e);a--;){var s=r[a];if(o&&s[2]?s[1]!==e[s[0]]:!(s[0]in e))return!1}for(;++a<i;){s=r[a];var u=s[0],l=e[u],c=s[1];if(o&&s[2]){if(l===void 0&&!(u in e))return!1}else{var d=new Eu;if(n)var f=n(l,c,u,e,t,d);if(!(f===void 0?m_(c,l,_z|wz,n,d):f))return!1}}return!0}function xD(e){return e===e&&!RS(e)}function Pz(e){for(var t=by(e),r=t.length;r--;){var n=t[r],a=e[n];t[r]=[n,a,xD(a)]}return t}function CD(e,t){return function(r){return r==null?!1:r[e]===t&&(t!==void 0||e in Object(r))}}function Tz(e){var t=Pz(e);return t.length==1&&t[0][2]?CD(t[0][0],t[0][1]):function(r){return r===e||Az(r,e,t)}}function Ez(e,t){return e!=null&&t in Object(e)}function Iz(e,t,r){t=mD(t,e);for(var n=-1,a=t.length,i=!1;++n<a;){var o=Cy(t[n]);if(!(i=e!=null&&r(e,o)))break;e=e[o]}return i||++n!=a?i:(a=e==null?0:e.length,!!a&&U7(a)&&pD(o,a)&&(Po(e)||d_(e)))}function Mz(e,t){return e!=null&&Iz(e,t,Ez)}var Dz=1,Rz=2;function Oz(e,t){return p_(e)&&xD(t)?CD(Cy(e),t):function(r){var n=OU(r,e);return n===void 0&&n===t?Mz(r,e):m_(t,n,Dz|Rz)}}function Fz(e){return function(t){return t==null?void 0:t[e]}}function kz(e){return function(t){return gD(t,e)}}function Bz(e){return p_(e)?Fz(Cy(e)):kz(e)}function Lz(e){return typeof e=="function"?e:e==null?f_:typeof e=="object"?Po(e)?Oz(e[0],e[1]):Tz(e):Bz(e)}function Nz(e,t,r,n){for(var a=-1,i=e==null?0:e.length;++a<i;){var o=e[a];t(n,o,r(o),e)}return n}function Uz(e){return function(t,r,n){for(var a=-1,i=Object(t),o=n(t),s=o.length;s--;){var u=o[e?s:++a];if(r(i[u],u,i)===!1)break}return t}}var zz=Uz(),Vz=zz;function Hz(e,t){return e&&Vz(e,t,by)}function Gz(e,t){return function(r,n){if(r==null)return r;if(!my(r))return e(r,n);for(var a=r.length,i=t?a:-1,o=Object(r);(t?i--:++i<a)&&n(o[i],i,o)!==!1;);return r}}var qz=Gz(Hz),jz=qz;function Wz(e,t,r,n){return jz(e,function(a,i,o){t(n,a,r(a),o)}),n}function Xz(e,t){return function(r,n){var a=Po(r)?Nz:Wz,i=t?t():{};return a(r,e,Lz(n),i)}}function _D(e){return ev(e)&&my(e)}function wD(e,t,r){for(var n=-1,a=e==null?0:e.length;++n<a;)if(r(t,e[n]))return!0;return!1}var Yz=Object.prototype,Kz=Yz.hasOwnProperty,$z=Xz(function(e,t,r){Kz.call(e,r)?e[r].push(t):j9(e,r,[t])}),rv=$z,Qz="[object String]";function Zz(e){return typeof e=="string"||!Po(e)&&ev(e)&&tD(e)==Qz}function Jz(e,t){return yy(t,function(r){return e[r]})}function eV(e){return e==null?[]:Jz(e,by(e))}var tV=Math.max;function rV(e,t,r,n){e=my(e)?e:eV(e),r=r&&!n?T9(r):0;var a=e.length;return r<0&&(r=tV(a+r,0)),Zz(e)?r<=a&&e.indexOf(t,r)>-1:!!a&&dD(e,t,r)>-1}var nV=Math.min;function aV(e,t,r){for(var n=r?wD:fD,a=e[0].length,i=e.length,o=i,s=Array(i),u=1/0,l=[];o--;){var c=e[o];o&&t&&(c=yy(c,z7(t))),u=nV(c.length,u),s[o]=!r&&(t||a>=120&&c.length>=120)?new up(o&&c):void 0}c=e[0];var d=-1,f=s[0];e:for(;++d<a&&l.length<u;){var p=c[d],h=t?t(p):p;if(p=r||p!==0?p:0,!(f?V0(f,h):n(l,h,r))){for(o=i;--o;){var v=s[o];if(!(v?V0(v,h):n(e[o],h,r)))continue e}f&&f.push(h),l.push(p)}}return l}function iV(e){return _D(e)?e:[]}var oV=vD(function(e){var t=yy(e,iV);return t.length&&t[0]===e[0]?aV(t):[]}),AD=oV,sV=1/0,uV=tb&&1/v_(new tb([,-0]))[1]==sV?function(e){return new tb(e)}:I9,lV=uV,cV=200;function dV(e,t,r){var n=-1,a=fD,i=e.length,o=!0,s=[],u=s;if(r)o=!1,a=wD;else if(i>=cV){var l=t?null:lV(e);if(l)return v_(l);o=!1,a=V0,u=new up}else u=t?[]:s;e:for(;++n<i;){var c=e[n],d=t?t(c):c;if(c=r||c!==0?c:0,o&&d===d){for(var f=u.length;f--;)if(u[f]===d)continue e;t&&u.push(d),s.push(c)}else a(u,d,r)||(u!==s&&u.push(d),s.push(c))}return s}var fV=vD(function(e){return dV(bD(e,1,_D,!0))}),PD=fV;/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const n4=typeof window!="undefined"&&window.customElements!=null&&window.customElements.polyfillWrapFlushCallback!==void 0,pV=(e,t,r=null,n=null)=>{for(;t!==r;){const a=t.nextSibling;e.insertBefore(t,n),t=a}},g_=(e,t,r=null)=>{for(;t!==r;){const n=t.nextSibling;e.removeChild(t),t=n}};/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const Iu=`{{lit-${String(Math.random()).slice(2)}}}`,TD=`<!--${Iu}-->`,a4=new RegExp(`${Iu}|${TD}`),Ch="$lit$";class ED{constructor(t,r){this.parts=[],this.element=r;const n=[],a=[],i=document.createTreeWalker(r.content,133,null,!1);let o=0,s=-1,u=0;const{strings:l,values:{length:c}}=t;for(;u<c;){const d=i.nextNode();if(d===null){i.currentNode=a.pop();continue}if(s++,d.nodeType===1){if(d.hasAttributes()){const f=d.attributes,{length:p}=f;let h=0;for(let v=0;v<p;v++)i4(f[v].name,Ch)&&h++;for(;h-- >0;){const v=l[u],m=BS.exec(v)[2],g=m.toLowerCase()+Ch,y=d.getAttribute(g);d.removeAttribute(g);const b=y.split(a4);this.parts.push({type:"attribute",index:s,name:m,strings:b}),u+=b.length-1}}d.tagName==="TEMPLATE"&&(a.push(d),i.currentNode=d.content)}else if(d.nodeType===3){const f=d.data;if(f.indexOf(Iu)>=0){const p=d.parentNode,h=f.split(a4),v=h.length-1;for(let m=0;m<v;m++){let g,y=h[m];if(y==="")g=Gl();else{const b=BS.exec(y);b!==null&&i4(b[2],Ch)&&(y=y.slice(0,b.index)+b[1]+b[2].slice(0,-Ch.length)+b[3]),g=document.createTextNode(y)}p.insertBefore(g,d),this.parts.push({type:"node",index:++s})}h[v]===""?(p.insertBefore(Gl(),d),n.push(d)):d.data=h[v],u+=v}}else if(d.nodeType===8)if(d.data===Iu){const f=d.parentNode;(d.previousSibling===null||s===o)&&(s++,f.insertBefore(Gl(),d)),o=s,this.parts.push({type:"node",index:s}),d.nextSibling===null?d.data="":(n.push(d),s--),u++}else{let f=-1;for(;(f=d.data.indexOf(Iu,f+1))!==-1;)this.parts.push({type:"node",index:-1}),u++}}for(const d of n)d.parentNode.removeChild(d)}}const i4=(e,t)=>{const r=e.length-t.length;return r>=0&&e.slice(r)===t},ID=e=>e.index!==-1,Gl=()=>document.createComment(""),BS=/([ \x09\x0a\x0c\x0d])([^\0-\x1F\x7F-\x9F "'>=/]+)([ \x09\x0a\x0c\x0d]*=[ \x09\x0a\x0c\x0d]*(?:[^ \x09\x0a\x0c\x0d"'`<>=]*|"[^"]*|'[^']*))$/;/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const y_=133;function MD(e,t){const{element:{content:r},parts:n}=e,a=document.createTreeWalker(r,y_,null,!1);let i=Fh(n),o=n[i],s=-1,u=0;const l=[];let c=null;for(;a.nextNode();){s++;const d=a.currentNode;for(d.previousSibling===c&&(c=null),t.has(d)&&(l.push(d),c===null&&(c=d)),c!==null&&u++;o!==void 0&&o.index===s;)o.index=c!==null?-1:o.index-u,i=Fh(n,i),o=n[i]}l.forEach(d=>d.parentNode.removeChild(d))}const hV=e=>{let t=e.nodeType===11?0:1;const r=document.createTreeWalker(e,y_,null,!1);for(;r.nextNode();)t++;return t},Fh=(e,t=-1)=>{for(let r=t+1;r<e.length;r++){const n=e[r];if(ID(n))return r}return-1};function vV(e,t,r=null){const{element:{content:n},parts:a}=e;if(r==null){n.appendChild(t);return}const i=document.createTreeWalker(n,y_,null,!1);let o=Fh(a),s=0,u=-1;for(;i.nextNode();)for(u++,i.currentNode===r&&(s=hV(t),r.parentNode.insertBefore(t,r));o!==-1&&a[o].index===u;){if(s>0){for(;o!==-1;)a[o].index+=s,o=Fh(a,o);return}o=Fh(a,o)}}/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const DD=new WeakMap,mV=e=>(...t)=>{const r=e(...t);return DD.set(r,!0),r},nv=e=>typeof e=="function"&&DD.has(e);/**
 * @license
 * Copyright (c) 2018 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const Zo={},o4={};/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class LS{constructor(t,r,n){this.__parts=[],this.template=t,this.processor=r,this.options=n}update(t){let r=0;for(const n of this.__parts)n!==void 0&&n.setValue(t[r]),r++;for(const n of this.__parts)n!==void 0&&n.commit()}_clone(){const t=n4?this.template.element.content.cloneNode(!0):document.importNode(this.template.element.content,!0),r=[],n=this.template.parts,a=document.createTreeWalker(t,133,null,!1);let i=0,o=0,s,u=a.nextNode();for(;i<n.length;){if(s=n[i],!ID(s)){this.__parts.push(void 0),i++;continue}for(;o<s.index;)o++,u.nodeName==="TEMPLATE"&&(r.push(u),a.currentNode=u.content),(u=a.nextNode())===null&&(a.currentNode=r.pop(),u=a.nextNode());if(s.type==="node"){const l=this.processor.handleTextExpression(this.options);l.insertAfterNode(u.previousSibling),this.__parts.push(l)}else this.__parts.push(...this.processor.handleAttributeExpressions(u,s.name,s.strings,this.options));i++}return n4&&(document.adoptNode(t),customElements.upgrade(t)),t}}/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const s4=window.trustedTypes&&trustedTypes.createPolicy("lit-html",{createHTML:e=>e}),gV=` ${Iu} `;class b_{constructor(t,r,n,a){this.strings=t,this.values=r,this.type=n,this.processor=a}getHTML(){const t=this.strings.length-1;let r="",n=!1;for(let a=0;a<t;a++){const i=this.strings[a],o=i.lastIndexOf("<!--");n=(o>-1||n)&&i.indexOf("-->",o+1)===-1;const s=BS.exec(i);s===null?r+=i+(n?gV:TD):r+=i.substr(0,s.index)+s[1]+s[2]+Ch+s[3]+Iu}return r+=this.strings[t],r}getTemplateElement(){const t=document.createElement("template");let r=this.getHTML();return s4!==void 0&&(r=s4.createHTML(r)),t.innerHTML=r,t}}class yV extends b_{getHTML(){return`<svg>${super.getHTML()}</svg>`}getTemplateElement(){const t=super.getTemplateElement(),r=t.content,n=r.firstChild;return r.removeChild(n),pV(r,n.firstChild),t}}/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const _y=e=>e===null||!(typeof e=="object"||typeof e=="function"),NS=e=>Array.isArray(e)||!!(e&&e[Symbol.iterator]);class RD{constructor(t,r,n){this.dirty=!0,this.element=t,this.name=r,this.strings=n,this.parts=[];for(let a=0;a<n.length-1;a++)this.parts[a]=this._createPart()}_createPart(){return new OD(this)}_getValue(){const t=this.strings,r=t.length-1,n=this.parts;if(r===1&&t[0]===""&&t[1]===""){const i=n[0].value;if(typeof i=="symbol")return String(i);if(typeof i=="string"||!NS(i))return i}let a="";for(let i=0;i<r;i++){a+=t[i];const o=n[i];if(o!==void 0){const s=o.value;if(_y(s)||!NS(s))a+=typeof s=="string"?s:String(s);else for(const u of s)a+=typeof u=="string"?u:String(u)}}return a+=t[r],a}commit(){this.dirty&&(this.dirty=!1,this.element.setAttribute(this.name,this._getValue()))}}class OD{constructor(t){this.value=void 0,this.committer=t}setValue(t){t!==Zo&&(!_y(t)||t!==this.value)&&(this.value=t,nv(t)||(this.committer.dirty=!0))}commit(){for(;nv(this.value);){const t=this.value;this.value=Zo,t(this)}this.value!==Zo&&this.committer.commit()}}class Tv{constructor(t){this.value=void 0,this.__pendingValue=void 0,this.options=t}appendInto(t){this.startNode=t.appendChild(Gl()),this.endNode=t.appendChild(Gl())}insertAfterNode(t){this.startNode=t,this.endNode=t.nextSibling}appendIntoPart(t){t.__insert(this.startNode=Gl()),t.__insert(this.endNode=Gl())}insertAfterPart(t){t.__insert(this.startNode=Gl()),this.endNode=t.endNode,t.endNode=this.startNode}setValue(t){this.__pendingValue=t}commit(){if(this.startNode.parentNode===null)return;for(;nv(this.__pendingValue);){const r=this.__pendingValue;this.__pendingValue=Zo,r(this)}const t=this.__pendingValue;t!==Zo&&(_y(t)?t!==this.value&&this.__commitText(t):t instanceof b_?this.__commitTemplateResult(t):t instanceof Node?this.__commitNode(t):NS(t)?this.__commitIterable(t):t===o4?(this.value=o4,this.clear()):this.__commitText(t))}__insert(t){this.endNode.parentNode.insertBefore(t,this.endNode)}__commitNode(t){this.value!==t&&(this.clear(),this.__insert(t),this.value=t)}__commitText(t){const r=this.startNode.nextSibling;t=t==null?"":t;const n=typeof t=="string"?t:String(t);r===this.endNode.previousSibling&&r.nodeType===3?r.data=n:this.__commitNode(document.createTextNode(n)),this.value=t}__commitTemplateResult(t){const r=this.options.templateFactory(t);if(this.value instanceof LS&&this.value.template===r)this.value.update(t.values);else{const n=new LS(r,t.processor,this.options),a=n._clone();n.update(t.values),this.__commitNode(a),this.value=n}}__commitIterable(t){Array.isArray(this.value)||(this.value=[],this.clear());const r=this.value;let n=0,a;for(const i of t)a=r[n],a===void 0&&(a=new Tv(this.options),r.push(a),n===0?a.appendIntoPart(this):a.insertAfterPart(r[n-1])),a.setValue(i),a.commit(),n++;n<r.length&&(r.length=n,this.clear(a&&a.endNode))}clear(t=this.startNode){g_(this.startNode.parentNode,t.nextSibling,this.endNode)}}class bV{constructor(t,r,n){if(this.value=void 0,this.__pendingValue=void 0,n.length!==2||n[0]!==""||n[1]!=="")throw new Error("Boolean attributes can only contain a single expression");this.element=t,this.name=r,this.strings=n}setValue(t){this.__pendingValue=t}commit(){for(;nv(this.__pendingValue);){const r=this.__pendingValue;this.__pendingValue=Zo,r(this)}if(this.__pendingValue===Zo)return;const t=!!this.__pendingValue;this.value!==t&&(t?this.element.setAttribute(this.name,""):this.element.removeAttribute(this.name),this.value=t),this.__pendingValue=Zo}}class SV extends RD{constructor(t,r,n){super(t,r,n);this.single=n.length===2&&n[0]===""&&n[1]===""}_createPart(){return new xV(this)}_getValue(){return this.single?this.parts[0].value:super._getValue()}commit(){this.dirty&&(this.dirty=!1,this.element[this.name]=this._getValue())}}class xV extends OD{}let FD=!1;(()=>{try{const e={get capture(){return FD=!0,!1}};window.addEventListener("test",e,e),window.removeEventListener("test",e,e)}catch{}})();class CV{constructor(t,r,n){this.value=void 0,this.__pendingValue=void 0,this.element=t,this.eventName=r,this.eventContext=n,this.__boundHandleEvent=a=>this.handleEvent(a)}setValue(t){this.__pendingValue=t}commit(){for(;nv(this.__pendingValue);){const i=this.__pendingValue;this.__pendingValue=Zo,i(this)}if(this.__pendingValue===Zo)return;const t=this.__pendingValue,r=this.value,n=t==null||r!=null&&(t.capture!==r.capture||t.once!==r.once||t.passive!==r.passive),a=t!=null&&(r==null||n);n&&this.element.removeEventListener(this.eventName,this.__boundHandleEvent,this.__options),a&&(this.__options=_V(t),this.element.addEventListener(this.eventName,this.__boundHandleEvent,this.__options)),this.value=t,this.__pendingValue=Zo}handleEvent(t){typeof this.value=="function"?this.value.call(this.eventContext||this.element,t):this.value.handleEvent(t)}}const _V=e=>e&&(FD?{capture:e.capture,passive:e.passive,once:e.once}:e.capture);/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */function wV(e){let t=av.get(e.type);t===void 0&&(t={stringsArray:new WeakMap,keyString:new Map},av.set(e.type,t));let r=t.stringsArray.get(e.strings);if(r!==void 0)return r;const n=e.strings.join(Iu);return r=t.keyString.get(n),r===void 0&&(r=new ED(e,e.getTemplateElement()),t.keyString.set(n,r)),t.stringsArray.set(e.strings,r),r}const av=new Map;/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const Gf=new WeakMap,AV=(e,t,r)=>{let n=Gf.get(t);n===void 0&&(g_(t,t.firstChild),Gf.set(t,n=new Tv(Object.assign({templateFactory:wV},r))),n.appendInto(t)),n.setValue(e),n.commit()};/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class PV{handleAttributeExpressions(t,r,n,a){const i=r[0];return i==="."?new SV(t,r.slice(1),n).parts:i==="@"?[new CV(t,r.slice(1),a.eventContext)]:i==="?"?[new bV(t,r.slice(1),n)]:new RD(t,r,n).parts}handleTextExpression(t){return new Tv(t)}}const kD=new PV;/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */typeof window!="undefined"&&(window.litHtmlVersions||(window.litHtmlVersions=[])).push("1.4.1");const zr=(e,...t)=>new b_(e,t,"html",kD),H0=(e,...t)=>new yV(e,t,"svg",kD);/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const BD=(e,t)=>`${e}--${t}`;let G0=!0;typeof window.ShadyCSS=="undefined"?G0=!1:typeof window.ShadyCSS.prepareTemplateDom=="undefined"&&(console.warn("Incompatible ShadyCSS version detected. Please update to at least @webcomponents/webcomponentsjs@2.0.2 and @webcomponents/shadycss@1.3.1."),G0=!1);const TV=e=>t=>{const r=BD(t.type,e);let n=av.get(r);n===void 0&&(n={stringsArray:new WeakMap,keyString:new Map},av.set(r,n));let a=n.stringsArray.get(t.strings);if(a!==void 0)return a;const i=t.strings.join(Iu);if(a=n.keyString.get(i),a===void 0){const o=t.getTemplateElement();G0&&window.ShadyCSS.prepareTemplateDom(o,e),a=new ED(t,o),n.keyString.set(i,a)}return n.stringsArray.set(t.strings,a),a},EV=["html","svg"],IV=e=>{EV.forEach(t=>{const r=av.get(BD(t,e));r!==void 0&&r.keyString.forEach(n=>{const{element:{content:a}}=n,i=new Set;Array.from(a.querySelectorAll("style")).forEach(o=>{i.add(o)}),MD(n,i)})})},LD=new Set,MV=(e,t,r)=>{LD.add(e);const n=r?r.element:document.createElement("template"),a=t.querySelectorAll("style"),{length:i}=a;if(i===0){window.ShadyCSS.prepareTemplateStyles(n,e);return}const o=document.createElement("style");for(let l=0;l<i;l++){const c=a[l];c.parentNode.removeChild(c),o.textContent+=c.textContent}IV(e);const s=n.content;r?vV(r,o,s.firstChild):s.insertBefore(o,s.firstChild),window.ShadyCSS.prepareTemplateStyles(n,e);const u=s.querySelector("style");if(window.ShadyCSS.nativeShadow&&u!==null)t.insertBefore(u.cloneNode(!0),t.firstChild);else if(r){s.insertBefore(o,s.firstChild);const l=new Set;l.add(o),MD(r,l)}},DV=(e,t,r)=>{if(!r||typeof r!="object"||!r.scopeName)throw new Error("The `scopeName` option is required.");const n=r.scopeName,a=Gf.has(t),i=G0&&t.nodeType===11&&!!t.host,o=i&&!LD.has(n),s=o?document.createDocumentFragment():t;if(AV(e,s,Object.assign({templateFactory:TV(n)},r)),o){const u=Gf.get(s);Gf.delete(s);const l=u.value instanceof LS?u.value.template:void 0;MV(n,s,l),g_(t,t.firstChild),t.appendChild(s),Gf.set(t,u)}!a&&i&&window.ShadyCSS.styleElement(t.host)};/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */var ND;window.JSCompiler_renameProperty=(e,t)=>e;const US={toAttribute(e,t){switch(t){case Boolean:return e?"":null;case Object:case Array:return e==null?e:JSON.stringify(e)}return e},fromAttribute(e,t){switch(t){case Boolean:return e!==null;case Number:return e===null?null:Number(e);case Object:case Array:return JSON.parse(e)}return e}},UD=(e,t)=>t!==e&&(t===t||e===e),cb={attribute:!0,type:String,converter:US,reflect:!1,hasChanged:UD},db=1,fb=1<<2,pb=1<<3,hb=1<<4,zS="finalized";class zD extends HTMLElement{constructor(){super();this.initialize()}static get observedAttributes(){this.finalize();const t=[];return this._classProperties.forEach((r,n)=>{const a=this._attributeNameForProperty(n,r);a!==void 0&&(this._attributeToPropertyMap.set(a,n),t.push(a))}),t}static _ensureClassProperties(){if(!this.hasOwnProperty(JSCompiler_renameProperty("_classProperties",this))){this._classProperties=new Map;const t=Object.getPrototypeOf(this)._classProperties;t!==void 0&&t.forEach((r,n)=>this._classProperties.set(n,r))}}static createProperty(t,r=cb){if(this._ensureClassProperties(),this._classProperties.set(t,r),r.noAccessor||this.prototype.hasOwnProperty(t))return;const n=typeof t=="symbol"?Symbol():`__${t}`,a=this.getPropertyDescriptor(t,n,r);a!==void 0&&Object.defineProperty(this.prototype,t,a)}static getPropertyDescriptor(t,r,n){return{get(){return this[r]},set(a){const i=this[t];this[r]=a,this.requestUpdateInternal(t,i,n)},configurable:!0,enumerable:!0}}static getPropertyOptions(t){return this._classProperties&&this._classProperties.get(t)||cb}static finalize(){const t=Object.getPrototypeOf(this);if(t.hasOwnProperty(zS)||t.finalize(),this[zS]=!0,this._ensureClassProperties(),this._attributeToPropertyMap=new Map,this.hasOwnProperty(JSCompiler_renameProperty("properties",this))){const r=this.properties,n=[...Object.getOwnPropertyNames(r),...typeof Object.getOwnPropertySymbols=="function"?Object.getOwnPropertySymbols(r):[]];for(const a of n)this.createProperty(a,r[a])}}static _attributeNameForProperty(t,r){const n=r.attribute;return n===!1?void 0:typeof n=="string"?n:typeof t=="string"?t.toLowerCase():void 0}static _valueHasChanged(t,r,n=UD){return n(t,r)}static _propertyValueFromAttribute(t,r){const n=r.type,a=r.converter||US,i=typeof a=="function"?a:a.fromAttribute;return i?i(t,n):t}static _propertyValueToAttribute(t,r){if(r.reflect===void 0)return;const n=r.type,a=r.converter;return(a&&a.toAttribute||US.toAttribute)(t,n)}initialize(){this._updateState=0,this._updatePromise=new Promise(t=>this._enableUpdatingResolver=t),this._changedProperties=new Map,this._saveInstanceProperties(),this.requestUpdateInternal()}_saveInstanceProperties(){this.constructor._classProperties.forEach((t,r)=>{if(this.hasOwnProperty(r)){const n=this[r];delete this[r],this._instanceProperties||(this._instanceProperties=new Map),this._instanceProperties.set(r,n)}})}_applyInstanceProperties(){this._instanceProperties.forEach((t,r)=>this[r]=t),this._instanceProperties=void 0}connectedCallback(){this.enableUpdating()}enableUpdating(){this._enableUpdatingResolver!==void 0&&(this._enableUpdatingResolver(),this._enableUpdatingResolver=void 0)}disconnectedCallback(){}attributeChangedCallback(t,r,n){r!==n&&this._attributeToProperty(t,n)}_propertyToAttribute(t,r,n=cb){const a=this.constructor,i=a._attributeNameForProperty(t,n);if(i!==void 0){const o=a._propertyValueToAttribute(r,n);if(o===void 0)return;this._updateState=this._updateState|pb,o==null?this.removeAttribute(i):this.setAttribute(i,o),this._updateState=this._updateState&~pb}}_attributeToProperty(t,r){if(this._updateState&pb)return;const n=this.constructor,a=n._attributeToPropertyMap.get(t);if(a!==void 0){const i=n.getPropertyOptions(a);this._updateState=this._updateState|hb,this[a]=n._propertyValueFromAttribute(r,i),this._updateState=this._updateState&~hb}}requestUpdateInternal(t,r,n){let a=!0;if(t!==void 0){const i=this.constructor;n=n||i.getPropertyOptions(t),i._valueHasChanged(this[t],r,n.hasChanged)?(this._changedProperties.has(t)||this._changedProperties.set(t,r),n.reflect===!0&&!(this._updateState&hb)&&(this._reflectingProperties===void 0&&(this._reflectingProperties=new Map),this._reflectingProperties.set(t,n))):a=!1}!this._hasRequestedUpdate&&a&&(this._updatePromise=this._enqueueUpdate())}requestUpdate(t,r){return this.requestUpdateInternal(t,r),this.updateComplete}async _enqueueUpdate(){this._updateState=this._updateState|fb;try{await this._updatePromise}catch{}const t=this.performUpdate();return t!=null&&await t,!this._hasRequestedUpdate}get _hasRequestedUpdate(){return this._updateState&fb}get hasUpdated(){return this._updateState&db}performUpdate(){if(!this._hasRequestedUpdate)return;this._instanceProperties&&this._applyInstanceProperties();let t=!1;const r=this._changedProperties;try{t=this.shouldUpdate(r),t?this.update(r):this._markUpdated()}catch(n){throw t=!1,this._markUpdated(),n}t&&(this._updateState&db||(this._updateState=this._updateState|db,this.firstUpdated(r)),this.updated(r))}_markUpdated(){this._changedProperties=new Map,this._updateState=this._updateState&~fb}get updateComplete(){return this._getUpdateComplete()}_getUpdateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._updatePromise}shouldUpdate(t){return!0}update(t){this._reflectingProperties!==void 0&&this._reflectingProperties.size>0&&(this._reflectingProperties.forEach((r,n)=>this._propertyToAttribute(n,this[n],r)),this._reflectingProperties=void 0),this._markUpdated()}updated(t){}firstUpdated(t){}}ND=zS;zD[ND]=!0;/**
@license
Copyright (c) 2019 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at
http://polymer.github.io/LICENSE.txt The complete set of authors may be found at
http://polymer.github.io/AUTHORS.txt The complete set of contributors may be
found at http://polymer.github.io/CONTRIBUTORS.txt Code distributed by Google as
part of the polymer project is also subject to an additional IP rights grant
found at http://polymer.github.io/PATENTS.txt
*/const VS=window.ShadowRoot&&(window.ShadyCSS===void 0||window.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,S_=Symbol();class x_{constructor(t,r){if(r!==S_)throw new Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=t}get styleSheet(){return this._styleSheet===void 0&&(VS?(this._styleSheet=new CSSStyleSheet,this._styleSheet.replaceSync(this.cssText)):this._styleSheet=null),this._styleSheet}toString(){return this.cssText}}const RV=e=>new x_(String(e),S_),OV=e=>{if(e instanceof x_)return e.cssText;if(typeof e=="number")return e;throw new Error(`Value passed to 'css' function must be a 'css' function result: ${e}. Use 'unsafeCSS' to pass non-literal values, but
            take care to ensure page security.`)},Ji=(e,...t)=>{const r=t.reduce((n,a,i)=>n+OV(a)+e[i+1],e[0]);return new x_(r,S_)};/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */(window.litElementVersions||(window.litElementVersions=[])).push("2.5.1");const u4={};class nl extends zD{static getStyles(){return this.styles}static _getUniqueStyles(){if(this.hasOwnProperty(JSCompiler_renameProperty("_styles",this)))return;const t=this.getStyles();if(Array.isArray(t)){const r=(i,o)=>i.reduceRight((s,u)=>Array.isArray(u)?r(u,s):(s.add(u),s),o),n=r(t,new Set),a=[];n.forEach(i=>a.unshift(i)),this._styles=a}else this._styles=t===void 0?[]:[t];this._styles=this._styles.map(r=>{if(r instanceof CSSStyleSheet&&!VS){const n=Array.prototype.slice.call(r.cssRules).reduce((a,i)=>a+i.cssText,"");return RV(n)}return r})}initialize(){super.initialize(),this.constructor._getUniqueStyles(),this.renderRoot=this.createRenderRoot(),window.ShadowRoot&&this.renderRoot instanceof window.ShadowRoot&&this.adoptStyles()}createRenderRoot(){return this.attachShadow(this.constructor.shadowRootOptions)}adoptStyles(){const t=this.constructor._styles;t.length!==0&&(window.ShadyCSS!==void 0&&!window.ShadyCSS.nativeShadow?window.ShadyCSS.ScopingShim.prepareAdoptedCssText(t.map(r=>r.cssText),this.localName):VS?this.renderRoot.adoptedStyleSheets=t.map(r=>r instanceof CSSStyleSheet?r:r.styleSheet):this._needsShimAdoptedStyleSheets=!0)}connectedCallback(){super.connectedCallback(),this.hasUpdated&&window.ShadyCSS!==void 0&&window.ShadyCSS.styleElement(this)}update(t){const r=this.render();super.update(t),r!==u4&&this.constructor.render(r,this.renderRoot,{scopeName:this.localName,eventContext:this}),this._needsShimAdoptedStyleSheets&&(this._needsShimAdoptedStyleSheets=!1,this.constructor._styles.forEach(n=>{const a=document.createElement("style");a.textContent=n.cssText,this.renderRoot.appendChild(a)}))}render(){return u4}}nl.finalized=!0;nl.render=DV;nl.shadowRootOptions={mode:"open"};/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const l4=new WeakMap,q0=mV(e=>t=>{if(!(t instanceof Tv))throw new Error("unsafeHTML can only be used in text bindings");const r=l4.get(t);if(r!==void 0&&_y(e)&&e===r.value&&t.value===r.fragment)return;const n=document.createElement("template");n.innerHTML=e;const a=document.importNode(n.content,!0);t.setValue(a),l4.set(t,{value:e,fragment:a})});var FV=function(e){return new Promise(function(t){return setTimeout(function(){return t()},e)})},HS="node";typeof importScripts!="undefined"?HS="worker":typeof window!="undefined"&&(HS="browser");var VD=HS,HD=function(){return FV(0)};VD==="browser"&&"requestAnimationFrame"in window&&(HD=function(){return new Promise(function(e){return window.requestAnimationFrame(function(){return e()})})});var kV=HD;VD==="browser"&&"requestIdleCallback"in window||Object.freeze({didTimeout:!0,timeRemaining:function(){return 1/0}});var BV=kV;class LV{constructor({min:t=-1/0,max:r=1/0}={}){this.segments=[],this.max=r,this.min=t,this.regionString=null}encode(t=!1){return this.segments.map(({start:r,end:n,color:a})=>{if(t)return`${r}:${n}${a?`:${a}`:""}`;const i=r===this.min?"":r,o=n===this.max?"":n;return`${i}:${o}${a?`:${a}`:""}`}).join(",")}decode(t){if(typeof t!="undefined"&&(this.regionString=t),!this.regionString){this.segments=[];return}this.segments=this.regionString.split(",").map(r=>{const[n,a,i,o]=r.split(":");if(typeof o!="undefined")throw new Error(`there should be at most 2 ':' per region. Region: ${r}`);let s=n?Number(n):this.min,u=a?Number(a):this.max;const l=i!==""?i:void 0;if(s>u&&([s,u]=[u,s]),s<this.min&&(s=this.min),u>this.max&&(u=this.max),Number.isNaN(s))throw new Error(`The parsed value of ${n} is NaN. Region: ${r}`);if(Number.isNaN(u))throw new Error(`The parsed value of ${a} is NaN. Region: ${r}`);if(l&&!l.match(/^#[0-9a-f]{6,8}$/i))throw new Error(`The parsed value of ${i} is not a color in hex format. Region: ${r}`);return{start:s,end:u,color:l}})}}const c4="#FFEB3B66",vb=(e,t)=>e?t?`${e},${t}`:e:t;class NV{constructor({element:t,min:r,max:n}){this.element=t,this.element._highlightcolor=c4,this.region=new LV({min:r,max:n}),this.fixedHighlight=null}set max(t){this.region.max=t}setAttributesInElement(){this.region.decode(this.element.getAttribute("highlight")),this.region.segments.length===0&&(this.element._highlightstart=Number(this.element.getAttribute("highlightstart")),this.element._highlightend=Number(this.element.getAttribute("highlightend")),this.element._highlightcolor=this.element.getAttribute("highlightcolor")||c4,this.element._highlightstart!==null&&this.element._highlightend!==null&&typeof this.element._highlightstart=="number"&&typeof this.element._highlightend=="number"&&(this.element._highlight=`${this.element._highlightstart}:${this.element._highlightend}`,this.region.decode(vb(this.fixedHighlight,this.element._highlight))))}setFloatAttribute(t,r){const n=parseFloat(r);this.element[`_${t}`]=Number.isNaN(n)?r:n}changedCallBack(t,r){switch(t){case"highlightstart":case"highlightend":this.setFloatAttribute(t,r),this.element._highlight=Number.isNaN(this.element._highlightstart)||Number.isNaN(this.element._highlightend)||this.element._highlightstart===void 0||this.element._highlightend===void 0||this.element._highlightstart===null||this.element._highlightend===null?"":`${Math.max(this.region.min,this.element._highlightstart)}:${Math.min(this.region.max,this.element._highlightend)}`;break;default:this.element._highlight=r}this.region.decode(vb(this.fixedHighlight,this.element._highlight)),this.element.refresh()}setFixedHighlight(t){this.fixedHighlight=t,this.region.decode(vb(t,this.element._highlight)),this.element.refresh()}appendHighlightTo(t){this.highlighted=t.append("g").attr("class","highlighted")}updateHighlight(){const t=this.highlighted.selectAll("rect").data(this.region.segments);t.enter().append("rect").style("pointer-events","none").merge(t).attr("fill",r=>r.color?r.color:this.element._highlightcolor).attr("height",this.element._height).attr("x",r=>this.element.getXFromSeqPosition(r.start)).attr("width",r=>this.element.getSingleBaseWidth()*(r.end-r.start+1)),t.exit().remove()}}const d4=400;class UV{constructor(t){this.element=t,this.timeStampWheelOutside=0,this.resetScrollableTimeout=null}setElementScrollable(t){this.element.setAttribute("scrollable",t)}startResetScrollableTimer(){this.resetScrollableTimeout&&clearTimeout(this.resetScrollableTimeout),this.resetScrollableTimeout=setTimeout(()=>{this.setElementScrollable(!0),this.resetScrollableTimeout=null},d4)}blockScroll(t){this.timeStampWheelOutside=t,this.setElementScrollable(!1),this.startResetScrollableTimer()}isWheelEventInsideElement(t,r){const{height:n,width:a,x:i,y:o}=this.element.getBoundingClientRect();return t>i&&r<i+a&&r>o&&r<o+n}wheel({x:t,y:r,timeStamp:n}){this.isWheelEventInsideElement(t,r)?n<this.timeStampWheelOutside+d4?this.blockScroll(n):this.setElementScrollable(!0):this.blockScroll(n)}}const GD=["left","right","top","bottom"],f4=GD.map(e=>`margin${e}`),zV=(e,t={initialValue:{top:0,bottom:0,left:0,right:0}})=>{class r extends e{constructor(){super();this.margin=t.initialValue}static get observedAttributes(){return[...super.observedAttributes,...f4]}attributeChangedCallback(a,i,o){i!==o&&f4.includes(a)&&(this[a]=o),super.attributeChangedCallback(a,i,o)}}for(const n of GD)Object.defineProperty(r.prototype,`margin${n}`,{get(){return this.margin[n]||0},set(a){this.margin[n]=+a}});return r},VV=NV,qD=UV,jD=zV;class HV extends HTMLElement{constructor(){super();this._x=null,this._padding=0,this.height=40,this.dontDispatch=!1}_refreshWidth(){this.style.display="block",this.style.width="100%",this.width=this.offsetWidth-this.margin.left-this.margin.right,this.width>0&&(this._padding=10)}connectedCallback(){this._refreshWidth(),this.closest("protvista-manager")&&(this.manager=this.closest("protvista-manager"),this.manager.register(this)),this._length=parseFloat(this.getAttribute("length")),this._displaystart=parseFloat(this.getAttribute("displaystart"))||1,this._displayend=parseFloat(this.getAttribute("displayend"))||this._length,this._highlightStart=parseFloat(this.getAttribute("highlightStart")),this._highlightEnd=parseFloat(this.getAttribute("highlightEnd")),this._rulerstart=parseFloat(this.getAttribute("rulerStart"))||1,this._onResize=this._onResize.bind(this),this._createNavRuler()}disconnectedCallback(){this.manager&&this.manager.unregister(this),this._ro&&this._ro.unobserve(this),window.removeEventListener("resize",this._onResize)}static get observedAttributes(){return["length","displaystart","displayend","highlightStart","highlightEnd","width","rulerstart"]}attributeChangedCallback(t,r,n){r!==n&&(this[`_${t}`]=parseFloat(n),this._updateNavRuler())}get width(){return this._width}set width(t){this._width=t}_createNavRuler(){this._x=vy().range([this._padding,this.width-this._padding]),this._x.domain([this._rulerstart,this._rulerstart+this._length-1]),ha(this).selectAll("div").remove(),this._container=ha(this).append("div").attr("class","container"),this._svg=this._container.append("svg").attr("id","").attr("width",this.width).attr("height",this.height),this._xAxis=eD(this._x),this._displaystartLabel=this._svg.append("text").attr("class","start-label").attr("x",0).attr("y",this.height-this._padding),this._displayendLabel=this._svg.append("text").attr("class","end-label").attr("x",this.width).attr("y",this.height-this._padding).attr("text-anchor","end"),this._axis=this._svg.append("g").attr("class","x axis").call(this._xAxis),this._viewport=r9().extent([[this._padding,0],[this.width-this._padding,this.height*.51]]).on("brush",()=>{er.selection&&(this._displaystart=DA("d")(this._x.invert(er.selection[0])),this._displayend=DA("d")(this._x.invert(er.selection[1])),this.dontDispatch||this.dispatchEvent(new CustomEvent("change",{detail:{displayend:this._displayend,displaystart:this._displaystart,extra:{transform:er.transform}},bubbles:!0,cancelable:!0})),this._updateLabels(),this._updatePolygon())}),this._brushG=this._svg.append("g").attr("class","brush").call(this._viewport),this._brushG.call(this._viewport.move,[this._x(this._displaystart),this._x(this._displayend)]),this.polygon=this._svg.append("polygon").attr("class","zoom-polygon").attr("fill","#777").attr("fill-opacity","0.3"),this._updateNavRuler(),"ResizeObserver"in window&&(this._ro=new ResizeObserver(this._onResize),this._ro.observe(this)),window.addEventListener("resize",this._onResize)}_onResize(){this._refreshWidth(),this._x=this._x.range([this._padding,this.width-this._padding]),this._svg.attr("width",this.width),this._viewport.extent([[this._padding,0],[this.width-this._padding,this.height*.51]]),this._brushG.call(this._viewport),this._updateNavRuler()}_updateNavRuler(){this._x&&(this._container.style("padding-left",`${this.margin.left}px`).style("padding-right",`${this.margin.right}px`).style("padding-top",`${this.margin.top}px`).style("padding-bottom",`${this.margin.bottom}px`),this._x.domain([this._rulerstart,this._rulerstart+this._length-1]),this._axis.call(this._xAxis),this._updatePolygon(),this._updateLabels(),this._brushG&&(this.dontDispatch=!0,this._brushG.call(this._viewport.move,[this._x(this._displaystart),this._x(this._displayend)]),this.dontDispatch=!1))}_updateLabels(){this._displaystartLabel&&this._displaystartLabel.text(this._displaystart),this._displayendLabel&&this._displayendLabel.attr("x",this.width).text(this._displayend)}_updatePolygon(){this.polygon&&this.polygon.attr("points",`${this._x(this._displaystart)},${this.height/2}
        ${this._x(this._displayend)},${this.height/2}
        ${this.width},${this.height}
        0,${this.height}`)}}var GV=jD(HV);const p4=16,h4=10,v4=10,m4=5,dm=(e,t=0)=>{const r=(e||"").match(/(\d+\.?\d*)px/);return r?+r[1]:t};class qV extends nl{static get properties(){return{title:{type:String,reflect:!0},x:{type:Number,reflect:!0},y:{type:Number,reflect:!0},visible:{type:Boolean,reflect:!0},container:{type:String,reflect:!0}}}constructor(){super();this.title="",this.x=0,this.y=0,this.visible=!1,this.container="html",this._changeHandler=()=>this.requestUpdate(),this._observer=new MutationObserver(this._changeHandler)}connectedCallback(){super.connectedCallback(),this._observer.observe(this,{subtree:!0,characterData:!0,childList:!0}),window.addEventListener("resize",this._changeHandler)}disconnectedCallback(){super.disconnectedCallback(),this._observer.disconnect(),window.removeEventListener("resize",this._changeHandler)}static get styles(){return Ji`
      :host {
        --z-index: 50000;
        --title-color: black;
        --text-color: white;
        --body-color: #616161;
        --triangle-width: ${p4}px;
        --triangle-height: ${h4}px;
        --triangle-margin: ${v4}px;
        --vertical-distance: ${m4}px;
      }

      h1,
      h2,
      h3,
      h4,
      h5,
      h6 {
        margin: 0;
      }

      h1 {
        background-color: var(--title-color);
        line-height: 2em;
        padding: 0 1ch;
      }

      .tooltip {
        font-family: Roboto, Arial, sans-serif;
        font-size: 0.9rem;
        top: 0;
        left: 0;
        display: block;
        position: absolute;
        min-width: 220px;
        max-width: 50vw;

        /* user overridable through custom properties */
        z-index: var(--z-index);
        color: var(--text-color);

        /* will change those */
        opacity: 0;
        pointer-events: none;
        transform: translate(0, 0);
      }

      .tooltip.visible {
        opacity: 0.9;
        pointer-events: auto;
      }

      .tooltip::before {
        content: "";
        position: absolute;
        pointer-events: none;
        border-style: solid;
        border-color: transparent;
        border-width: 0 calc(var(--triangle-width) / 2);
      }

      .tooltip.arrow-left::before {
        left: var(--triangle-margin);
      }

      .tooltip.arrow-right::before {
        right: var(--triangle-margin);
      }

      .tooltip.arrow-up::before {
        top: calc(-1 * var(--triangle-height));
        border-bottom-color: var(--title-color);
        border-bottom-width: var(--triangle-height);
      }

      .tooltip.arrow-down::before {
        bottom: calc(-1 * var(--triangle-height));
        border-top-color: var(--body-color);
        border-top-width: var(--triangle-height);
      }

      :host a,
      :host a:link,
      :host a:active,
      :host a:hover {
        color: #fff;
      }

      .tooltip-body {
        padding: 1em;
        background: var(--body-color);
        font-weight: normal;
        overflow-y: auto;
        max-height: 40vh;
      }

      ::slotted(h4) {
        font-size: 1.2rem !important;
        margin: 0 0 0.5rem 0 !important;
        font-weight: 600 !important;
        color: #fff !important;
      }

      ::slotted(h5) {
        font-size: 1rem !important;
        margin: 0 !important;
        font-weight: 500 !important;
        color: #fff !important;
      }

      ::slotted(h6) {
        font-size: 1rem !important;
        margin: 0 !important;
        font-weight: 300 !important;
        color: #fff !important;
      }

      ::slotted(p) {
        margin: 0.25rem 0 1rem 0 !important;
      }

      ::slotted(ul) {
        list-style: none !important;
        margin: 0.25rem 0 1rem 0 !important;
        padding: 0 !important;
      }
    `}_getPosition(){if(!this.shadowRoot.firstElementChild)return{};const r=document.querySelector(this.container||"html").getBoundingClientRect(),n=this.shadowRoot.firstElementChild.getBoundingClientRect(),a=getComputedStyle(this),i=dm(a.getPropertyValue("--triangle-width"),p4),o=dm(a.getPropertyValue("--triangle-height"),h4),s=dm(a.getPropertyValue("--triangle-margin"),v4),u=dm(a.getPropertyValue("--vertical-distance"),m4);let l=this.x-i/2-s,c="left";l+n.width<=r.right||(c="right",l=this.x-n.width+i/2+s);let f=this.y+o+u,p="up";return f+n.height<=r.height||(p="down",f=this.y-n.height-o-u),{x:l,y:f,horizontal:c,vertical:p}}firstUpdated(){this.requestUpdate()}render(){let t=this.title&&this.visible;const r=t?this._getPosition():{};t=r.x&&t;const n=t&&`transform: translate(${r.x}px, ${r.y}px);`;return zr`
        <section
          class="tooltip arrow-${r.horizontal||"left"} arrow-${r.vertical||"up"} ${t?"visible":""}"
          style="${n}"
        >
          <h1>${this.title}</h1>
          <div class="tooltip-body"><slot></slot></div>
        </sectionclass="tooltip>
      `}}class j0 extends HTMLElement{constructor(){super();j0._polyfillElementClosest(),this._updateScaleDomain=this._updateScaleDomain.bind(this),this._initZoom=this._initZoom.bind(this),this.zoomed=this.zoomed.bind(this),this._applyZoomTranslation=this.applyZoomTranslation.bind(this),this._resetEventHandler=this._resetEventHandler.bind(this);let t=!1;this.applyZoomTranslation=()=>{t||(t=!0,requestAnimationFrame(()=>{t=!1,this._applyZoomTranslation()}))},this._onResize=this._onResize.bind(this),this._listenForResize=this._listenForResize.bind(this),this.trackHighlighter=new VV({element:this,min:1}),this.scrollFilter=new qD(this),this.wheelListener=r=>this.scrollFilter.wheel(r)}connectedCallback(){this.style.display="block",this.style.width="100%",this.width=this.offsetWidth,this.closest("protvista-manager")&&(this.manager=this.closest("protvista-manager"),this.manager.register(this)),this._length=this.getAttribute("length")?parseFloat(this.getAttribute("length")):0,this._displaystart=this.getAttribute("displaystart")?parseFloat(this.getAttribute("displaystart")):1,this._displayend=this.getAttribute("displayend")?parseFloat(this.getAttribute("displayend")):this.length,this._height=this.getAttribute("height")?Number(this.getAttribute("height")):44,this._highlightEvent=this.getAttribute("highlight-event")?this.getAttribute("highlight-event"):"onclick",this.trackHighlighter.setAttributesInElement(this),this._updateScaleDomain(),this._originXScale=this.xScale.copy(),this._initZoom(),this._listenForResize(),this.addEventListener("error",t=>{console.error(t)}),this._highlightEvent!=="none"&&this.addEventListener("click",this._resetEventHandler),this.hasAttribute("filter-scroll")&&document.addEventListener("wheel",this.wheelListener,{capture:!0})}disconnectedCallback(){this.manager&&this.manager.unregister(this),this._ro?this._ro.unobserve(this):window.removeEventListener("resize",this._onResize),this._highlightEvent!=="none"&&this.removeEventListener("click",this._resetEventHandler),document.removeEventListener("wheel",this.wheelListener)}get width(){return this._width}set width(t){this._width=t}set height(t){this._height=t}get height(){return this._height}set length(t){this._length=t,this.trackHighlighter.max=t}get length(){return this._length}get xScale(){return this._xScale}set xScale(t){this._xScale=t}get zoom(){return this._zoom}set svg(t){this._svg=t,t.call(this._zoom),this.applyZoomTranslation()}get svg(){return this._svg}set fixedHighlight(t){this.trackHighlighter.setFixedHighlight(t)}getWidthWithMargins(){return this.width?this.width-this.margin.left-this.margin.right:0}_updateScaleDomain(){this.xScale=vy().domain([1,this._length+1]).range([0,this.getWidthWithMargins()])}_initZoom(){this._zoom=p9().scaleExtent([1,1/0]).translateExtent([[0,0],[this.getWidthWithMargins(),0]]).extent([[0,0],[this.getWidthWithMargins(),0]]).filter(()=>{if(!(er instanceof WheelEvent))return!0;if(this.hasAttribute("scroll-filter")){const t=this.getAttribute("scrollable");if(t)return t==="true"}return!this.hasAttribute("use-ctrl-to-zoom")||er.ctrlKey}).on("zoom",this.zoomed)}static get observedAttributes(){return["displaystart","displayend","length","highlight"]}setFloatAttribute(t,r){const n=parseFloat(r);this[`_${t}`]=Number.isNaN(n)?r:n}attributeChangedCallback(t,r,n){if(n==="null"&&(n=null),r!==n){if(t.startsWith("highlight")){this.trackHighlighter.changedCallBack(t,n);return}this.setFloatAttribute(t,n),t==="length"&&(this._updateScaleDomain(),this._originXScale=this.xScale.copy()),this.applyZoomTranslation()}}zoomed(){if(this.xScale=er.transform.rescaleX(this._originXScale),this.dontDispatch)return;const[t,r]=this.xScale.domain();this.dispatchEvent(new CustomEvent("change",{detail:{displaystart:Math.max(1,t),displayend:Math.min(this.length,Math.max(r-1,t+1))},bubbles:!0,cancelable:!0}))}applyZoomTranslation(){if(!this.svg||!this._originXScale)return;const t=Math.max(1,this.length/(1+this._displayend-this._displaystart)),r=-this._originXScale(this._displaystart);this.dontDispatch=!0,this.svg.call(this.zoom.transform,c_.scale(t).translate(r,0)),this.dontDispatch=!1,this.refresh()}_onResize(){this.width=this.offsetWidth,this._updateScaleDomain(),this._originXScale=this.xScale.copy(),this.svg&&this.svg.attr("width",this.width),this._zoom.scaleExtent([1,1/0]).translateExtent([[0,0],[this.getWidthWithMargins(),0]]),this.applyZoomTranslation()}_listenForResize(){this._ro=new V7(this._onResize),this._ro.observe(this)}_resetEventHandler(t){t.target.closest(".feature")||this.dispatchEvent(this.createEvent("reset",null,!0))}getXFromSeqPosition(t){return this.margin.left+this.xScale(t)}getSingleBaseWidth(){return this.xScale(2)-this.xScale(1)}static _getClickCoords(){return er?[er.pageX,er.pageY]:null}static _polyfillElementClosest(){Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.closest||(Element.prototype.closest=t=>{let r=this;do{if(r.matches(t))return r;r=r.parentElement||r.parentNode}while(r!==null&&r.nodeType===1);return null})}createEvent(t,r=null,n=!1,a=!1,i,o,s){r&&(r=r.feature?r.feature:r);const u={eventtype:t,coords:j0._getClickCoords(),feature:r,target:s};return n&&(r&&r.fragments?u.highlight=r.fragments.map(l=>`${l.start}:${l.end}`).join(","):er&&er.shiftKey&&this._highlight?u.highlight=`${this._highlight},${i}:${o}`:u.highlight=i&&o?`${i}:${o}`:null),a&&(u.selectedid=r&&r.protvistaFeatureId),new CustomEvent("change",{detail:u,bubbles:!0,cancelable:!0})}bindEvents(t,r){t.on("mouseover",(n,a,i)=>{r.dispatchEvent(r.createEvent("mouseover",n,r._highlightEvent==="onmouseover",!1,n.start,n.end,i[a]))}).on("mouseout",()=>{r.dispatchEvent(r.createEvent("mouseout",null,r._highlightEvent==="onmouseover"))}).on("click",(n,a,i)=>{r.dispatchEvent(r.createEvent("click",n,r._highlightEvent==="onclick",!0,n.start,n.end,i[a]))})}}var W0=jD(j0,{initialValue:{top:10,right:10,bottom:10,left:10}});const hn=10;class jV{getFeatureShape(t,r,n,a){return a=a||"rectangle",this._ftLength=n,this._ftHeight=r,this._ftWidth=t*n,typeof this["_"+a]!="function"&&(a="rectangle"),this["_"+a]()}static isContinuous(t){return t=t.toLowerCase(),t!=="bridge"}_rectangle(){return"M0,0L"+this._ftWidth+",0L"+this._ftWidth+","+this._ftHeight+"L0,"+this._ftHeight+"Z"}_roundRectangle(){return"M"+6+",0h"+(this._ftWidth-2*6)+",0a"+6+","+6+" 0 0 1 "+6+","+6+"v"+(this._ftHeight-2*6)+"a"+6+","+6+" 0 0 1 "+-6+","+6+"h"+(2*6-this._ftWidth)+"a"+6+","+6+" 0 0 1 "+-6+","+-6+"v"+(2*6-this._ftHeight)+"a"+6+","+6+" 0 0 1 "+6+","+-6+"Z"}_line(){return`M0,${this._ftHeight/2} L${this._ftWidth},${this._ftHeight/2}`}_bridge(){return this._ftLength!==1?"M0,"+this._ftHeight+"L0,0L"+this._ftWidth+",0L"+this._ftWidth+","+this._ftHeight+"L"+this._ftWidth+",2L0,2Z":"M0,"+this._ftHeight+"L0,"+this._ftHeight/2+"L"+this._ftWidth/2+","+this._ftHeight/2+"L"+this._ftWidth/2+",0L"+this._ftWidth/2+","+this._ftHeight/2+"L"+this._ftWidth+","+this._ftHeight/2+"L"+this._ftWidth+","+this._ftHeight+"Z"}_getMiddleLine(t){return"M0,"+t+"L"+this._ftWidth+","+t+"Z"}_diamond(){const t=hn/2,r=this._ftWidth/2,n="M"+r+",0L"+(r+t)+","+t+"L"+r+","+hn+"L"+(r-t)+","+t;return this._ftLength!==1?n+this._getMiddleLine(t,this._ftWidth):n+"Z"}_chevron(){const t=this._ftWidth/2,r=hn/2,n="M"+t+","+r+"L"+(r+t)+",0L"+(r+t)+","+r+"L"+t+","+hn+"L"+(-r+t)+","+r+"L"+(-r+t)+",0";return this._ftLength!==1?n+"L"+t+","+r+this._getMiddleLine(r,this._ftWidth)+"Z":n+"Z"}_catFace(){const t=hn/2,r=hn/10,n=this._ftWidth/2,a="M"+(-t+n)+",0L"+(-t+n)+","+6*r+"L"+(-2*r+n)+","+hn+"L"+(2*r+n)+","+hn+"L"+(t+n)+","+6*r+"L"+(t+n)+",0L"+(2*r+n)+","+4*r+"L"+(-2*r+n)+","+4*r;return this._ftLength!==1?a+"M"+n+",0"+this._getMiddleLine(t,this._ftWidth)+"Z":a+"Z"}_triangle(){const t=hn/2,r=this._ftWidth/2,n="M"+r+",0L"+(t+r)+","+hn+"L"+(-t+r)+","+hn;return this._ftLength!==1?n+"L"+r+",0"+this._getMiddleLine(t,this._ftWidth)+"Z":n+"Z"}_wave(){const t=hn/4,r=hn/2,n=this._ftWidth/2,a="M"+(-hn/2+n)+","+r+"A"+t+","+r+" 0 1,1 "+n+","+r+"A"+t+","+r+" 0 1,0 "+(hn/2+n)+","+r;return this._ftLength!==1?a+this._getMiddleLine(r,this._ftWidth)+"Z":a+"Z"}_getPolygon(t){const r=hn/2;let n="M ";const a=this._ftWidth/2;for(let i=0;i<t;i++)n+=r*Math.cos(2*Math.PI*i/t)+a+","+(r*Math.sin(2*Math.PI*i/t)+r)+" ";return this._ftLength!==1?n+" "+(r*Math.cos(0)+a)+","+(r*Math.sin(0)+r)+" "+this._getMiddleLine(r,this._ftWidth)+"Z":n+"Z"}_hexagon(){return this._getPolygon(6)}_pentagon(){return this._getPolygon(5)}_circle(){const t=this._ftWidth/2,r=Math.sqrt(hn/Math.PI),n="M"+t+",0A"+r+","+r+" 0 1,1 "+t+","+hn+"A"+r+","+r+" 0 1,1 "+t+",0";return this._ftLength!==1?n+this._getMiddleLine(hn/2,this._ftWidth)+"Z":n+"Z"}_arrow(){const t=hn/10,r=this._ftWidth/2,n="M"+r+",0L"+(-t+r)+",0L"+(-5*t+r)+","+4*t+"L"+(-t+r)+","+this._ftHeight+"L"+r+","+this._ftHeight+"L"+(4*t+r)+","+4*t;return this._ftLength!==1?n+"L"+r+",0"+this._getMiddleLine(hn/2,this._ftWidth)+"Z":n+"Z"}_doubleBar(){const t=this._ftWidth/2,r=hn/2,n="M"+t+",0L"+(-r+t)+","+hn+"L"+t+","+hn+"L"+(r+t)+",0";return this._ftLength!==1?n+"L"+t+",0"+this._getMiddleLine(hn/2,this._ftWidth)+"Z":n+"Z"}_getBrokenEnd(){const t=this._ftHeight/4;return"L"+(this._ftWidth-t)+","+t+"L"+this._ftWidth+","+2*t+"L"+(this._ftWidth-t)+","+3*t+"L"+this._ftWidth+","+this._ftHeight}_getBrokenStart(){const t=this._ftHeight/4;return"L"+t+","+3*t+"L0,"+2*t+"L"+t+","+t}_discontinuosStart(){return"M0,0L"+this._ftWidth+",0L"+this._ftWidth+","+this._ftHeight+"L0,"+this._ftHeight+this._getBrokenStart()+"Z"}_discontinuos(){return"M0,0L"+this._ftWidth+",0"+this._getBrokenEnd()+"L0,"+this._ftHeight+this._getBrokenStart()+"Z"}_discontinuosEnd(){return"M0,0L"+this._ftWidth+",0"+this._getBrokenEnd()+"L0,"+this._ftHeight+"Z"}_helix(){const t=hn/2,r=hn/4;let n=t/2;const a=Math.round(this._ftWidth/t);let i="";for(let o=0;o<a;o++)i+="M"+(-(t/2)+n)+","+this._ftHeight+" C"+(n+r)+","+3*r+" "+(t/2+n)+","+r+" "+n+", 0 C"+(n-r)+","+r+" "+n+","+3*r+" "+(t/2+n)+","+this._ftHeight,n+=t;return i}_strand(){let t=0;this._ftWidth>hn/2&&(t=this._ftWidth-hn/2);const r=this._ftHeight/4,n="M0,"+r+"L"+t+","+r+"L"+t+","+3*r+"L0,"+3*r+"L0,"+r,a="M"+t+","+0+"L"+this._ftWidth+","+2*r+"L"+t+","+this._ftHeight+"Z";return n+a}}class C_{constructor({layoutHeight:t,padding:r=1,minHeight:n=17}){this._padding=r,this._minHeight=n,this._layoutHeight=t}init(t){this._features=t}getFeatureYPos(){const t=this.getFeatureHeight();return this._layoutHeight/2-t/2}getFeatureHeight(){return Math.min(this._layoutHeight,this._minHeight)-this._padding}}const WV=(e,t)=>!(Number(t.start)>Number(e.end)||Number(t.end)<Number(e.start)),XV=(e,t)=>t.some(r=>WV(e,r));class YV extends C_{constructor(t){super(t);this.featuresMap=new Map,this._rowHeight=0,this._rows=[],this._minHeight=15}init(t){t.forEach(r=>{const n=this._rows.findIndex(a=>!XV(r,a));n>=0?(this._rows[n].push(r),this.featuresMap.set(r,n)):(this._rows.push([r]),this.featuresMap.set(r,this._rows.length-1))}),this._rowHeight=Math.min(this._layoutHeight/this._rows.length,this._minHeight)}getOffset(){return this._rows.length*this._rowHeight<this._layoutHeight?this._layoutHeight/2-this._rows.length*this._rowHeight/2:0}getFeatureYPos(t){const r=this.featuresMap.get(t);return this.getOffset()+this._rowHeight*r+2*this._padding}getFeatureHeight(){return this._rowHeight-2*this._padding}}const Zf={CHAIN:{name:"chain",label:"Chain",tooltip:"(aka mature region). This describes the extent of a polypeptide chain in the mature protein following processing",shape:"rectangle",color:"#CC9933"},TRANSIT:{name:"transit peptide",label:"Transit peptide",tooltip:"This describes the extent of a transit peptide",shape:"rectangle",color:"#009966"},INIT_MET:{name:"initiator methionine",label:"Initiator methionine",tooltip:"This indicates that the initiator methionine is cleaved from the mature protein",shape:"arrow",color:"#996633"},PROPEP:{name:"propeptide",label:"Propeptide",tooltip:"Part of a protein that is cleaved during maturation or activation",shape:"rectangle",color:"#99CCCC"},PEPTIDE:{name:"peptide",label:"Peptide",tooltip:"The position and length of an active peptide in the mature protein",shape:"rectangle",color:"#006699"},SIGNAL:{name:"signal peptide",label:"Signal peptide",tooltip:"N-terminal signal peptide",shape:"rectangle",color:"#CC0033"},HELIX:{name:"helix",label:"Helix",tooltip:"The positions of experimentally determined helical regions",shape:"rectangle",color:"#FF0066"},STRAND:{name:"strand",label:"Beta strand",tooltip:"The positions of experimentally determined beta strands",shape:"rectangle",color:"#FFCC00"},TURN:{name:"turn",label:"Turn",tooltip:"The positions of experimentally determined hydrogen-bonded turns",shape:"rectangle",color:"#0571AF"},DISULFID:{name:"disulfide bond",label:"Disulfide bond",tooltip:"The positions of cysteine residues participating in disulphide bonds",shape:"bridge",color:"#23B14D"},CROSSLNK:{name:"cross-link",label:"Cross-link",tooltip:"Covalent linkages of various types formed between two proteins or between two parts of the same protein",shape:"bridge",color:"#FF6600"},REGION:{name:"region of interest",label:"Region of interest",tooltip:"Regions in multifunctional enzymes or fusion proteins, or characteristics of a region, e.g., protein-protein interactions mediation",shape:"rectangle",color:"#B33E00"},COILED:{name:"coiled-coil region",label:"Coiled-coil region",tooltip:"Coiled coils are built by two or more alpha-helices that wind around each other to form a supercoil",shape:"rectangle",color:"#006699"},MOTIF:{name:"short sequence motif",label:"Short sequence motif",tooltip:"Short conserved sequence motif of biological significance",shape:"rectangle",color:"#402060"},REPEAT:{name:"repeat",label:"Repeat",tooltip:"Repeated sequence motifs or repeated domains within the protein",shape:"rectangle",color:"#9900FF"},CA_BIND:{name:"calcium-binding region",label:"Calcium-binding region",tooltip:"Calcium-binding regions, such as the EF-hand motif",shape:"rectangle",color:"#FF3399"},DNA_BIND:{name:"DNA-binding region",label:"DNA binding",tooltip:"DNA-binding domains such as AP2/ERF domain, the ETS domain, the Fork-Head domain, the HMG box and the Myb domain",shape:"rectangle",color:"#009933"},DOMAIN:{name:"other domain of interest",label:"Other domain of interest",tooltip:"Specific combination of secondary structures organized into a characteristic three-dimensional structure or fold",shape:"rectangle",color:"#9999FF"},ZN_FING:{name:"zinc finger region",label:"Zinc finger",tooltip:"Small, functional, independently folded domain that coordinates one or more zinc ions",shape:"rectangle",color:"#990066"},NP_BIND:{name:"nucleotide-binding region",label:"Nucleotide-binding region",tooltip:"(aka flavin-binding). Region in the protein which binds nucleotide phosphates",shape:"rectangle",color:"#FF9900"},METAL:{name:"metal ion-binding site",label:"Metal ion-binding site",tooltip:"Binding site for a metal ion",shape:"diamond",color:"#009900"},SITE:{name:"other site of interest",label:"Other site of interest",tooltip:"Any interesting single amino acid site on the sequence",shape:"chevron",color:"#660033"},BINDING:{name:"other binding site",label:"Other binding site",tooltip:"Binding site for any chemical group (co-enzyme, prosthetic group, etc.)",shape:"rectangle",color:"#catFace"},ACT_SITE:{name:"active site",label:"Active site",tooltip:"Amino acid(s) directly involved in the activity of an enzyme",shape:"circle",color:"#FF6666"},MOD_RES:{name:"Post-translationally modified residue",label:"Modified residue",tooltip:"Modified residues such as phosphorylation, acetylation, acylation, methylation",shape:"triangle",color:"#000066"},LIPID:{name:"lipid moiety-binding region",label:"Lipidation",tooltip:"Covalently attached lipid group(s)",shape:"wave",color:"#99CC33"},CARBOHYD:{name:"glycosylation site",label:"Glycosylation",tooltip:"Covalently attached glycan group(s)",shape:"hexagon",color:"#CC3366"},COMPBIAS:{name:"compositionally biased region",label:"Compositionally biased region",tooltip:"Position of regions of compositional bias within the protein and the particular amino acids that are over-represented within those regions",shape:"rectangle",color:"#FF3366"},CONFLICT:{name:"sequence conflict",label:"Sequence conflict",tooltip:"Sequence discrepancies of unknown origin",shape:"rectangle",color:"#6633CC"},NON_CONS:{name:"non-consecutive residues",label:"Non-adjacent residues",tooltip:"Indicates that two residues in a sequence are not consecutive and that there is an undetermined number of unsequenced residues between them",shape:"doubleBar",color:"#FF0033"},NON_TER:{name:"non-terminal residue",label:"Non-terminal residue",tooltip:"The sequence is incomplete. The residue is not the terminal residue of the complete protein",shape:"doubleBar",color:"#339933"},UNSURE:{name:"unsure residue",label:"Sequence uncertainty",tooltip:"Regions of a sequence for which the authors are unsure about the sequence assignment",shape:"rectangle",color:"#33FF00"},NON_STD:{name:"non-standard amino acid",label:"Non-standard residue",tooltip:"Non-standard amino acids (selenocysteine and pyrrolysine)",shape:"pentagon",color:"#330066"},MUTAGEN:{name:"mutagenesis site",label:"Mutagenesis",tooltip:"Site which has been experimentally altered by mutagenesis",shape:"rectangle",color:"#FF9900"},TOPO_DOM:{name:"topological domain",label:"Topological domain",tooltip:"Location of non-membrane regions of membrane-spanning proteins",shape:"rectangle",color:"#CC0000"},TRANSMEM:{name:"transmembrane region",label:"Transmembrane",tooltip:"Extent of a membrane-spanning region",shape:"rectangle",color:"#CC00CC"},INTRAMEM:{name:"intramembrane region",label:"Intramembrane",tooltip:"Extent of a region located in a membrane without crossing it",shape:"rectangle",color:"#0000CC"},VAR_SEQ:{name:"splice variant",label:"Splice variant",tooltip:"",shape:"rectangle",color:"#CC11CC"},VARIANT:{name:"sequence variant",label:"Natural variant",tooltip:"Natural variant of the protein, including polymorphisms, variations between strains, isolates or cultivars, disease-associated mutations and RNA editing events",shape:"circle",color:"black"},UNIQUE:{name:"unique",label:"Unique peptide",tooltip:"",shape:"rectangle",color:"#fc3133"},NON_UNIQUE:{name:"non-unique",label:"Non-unique peptide",tooltip:"",shape:"rectangle",color:"#8585fc"},ANTIGEN:{name:"antigen",label:"Antibody binding sequences",tooltip:"",shape:"rectangle",color:"#996699"},PDBE_COVER:{name:"pdbe coverage",label:"PDBe 3D structure coverage",tooltip:"",shape:"rectangle",color:"#669966"}},g4=e=>{if(Zf[e.toUpperCase()])return Zf[e.toUpperCase()].shape;const t=Object.values(Zf).find(r=>r.name.toUpperCase()===e.toUpperCase());return t?t.shape:"rectangle"},y4=e=>{if(Zf[e.toUpperCase()])return Zf[e.toUpperCase()].color;const t=Object.values(Zf).find(r=>r.name.toUpperCase()===e.toUpperCase());return t||console.log(e),t?t.color:"black"};class Td extends W0{getLayout(){return String(this.getAttribute("layout")).toLowerCase()==="non-overlapping"?new YV({layoutHeight:this._height}):new C_({layoutHeight:this._height})}connectedCallback(){super.connectedCallback(),this._color=this.getAttribute("color"),this._shape=this.getAttribute("shape"),this._featureShape=new jV,this._layoutObj=this.getLayout(),this._data&&this._createTrack(),this.addEventListener("load",t=>{rV(this.children,t.target)&&(this.data=t.detail.payload)})}static normalizeLocations(t){return t.map(r=>{const{locations:n,start:a,end:i}=r;return n?r:Object.assign(r,{locations:[{fragments:[{start:a,end:i}]}]})})}processData(t){this._originalData=Td.normalizeLocations(t)}set data(t){this.processData(t),this._applyFilters(),this._layoutObj=this.getLayout(),this._createTrack()}set filters(t){this._filters=t,this._applyFilters(),this._createTrack()}static get observedAttributes(){return W0.observedAttributes.concat(["highlight","color","shape","filters"])}_getFeatureColor(t){return t.color?t.color:t.feature&&t.feature.color?t.feature.color:this._color?this._color:t.type?y4(t.type):t.feature&&t.feature.type?y4(t.feature.type):"black"}_getFeatureFillColor(t){return t.fill?t.fill:t.feature&&t.feature.fill?t.feature.fill:this._getFeatureColor(t)}_getShape(t){return t.shape?t.shape:t.feature&&t.feature.shape?t.feature.shape:this._shape?this._shape:t.type?g4(t.type):t.feature&&t.feature.type?g4(t.feature.type):"rectangle"}_createTrack(){this._layoutObj.init(this._data),ha(this).selectAll("div").remove(),this.svg=ha(this).append("div").style("line-height",0).append("svg").attr("width",this.width).attr("height",this._height),this.trackHighlighter.appendHighlightTo(this.svg),this.seq_g=this.svg.append("g").attr("class","sequence-features"),this._createFeatures()}_createFeatures(){this.featuresG=this.seq_g.selectAll("g.feature-group").data(this._data),this.locations=this.featuresG.enter().append("g").attr("class","feature-group").attr("id",r=>`g_${r.accession}`).selectAll("g.location-group").data(r=>r.locations.map(n=>Object.assign({},n,{feature:r}))).enter().append("g").attr("class","location-group");const t=this.locations.selectAll("g.fragment-group").data(r=>r.fragments.map(n=>Object.assign({},n,{feature:r.feature}))).enter().append("g").attr("class","fragment-group");t.append("path").attr("class",r=>`${this._getShape(r)} feature`).attr("d",r=>this._featureShape.getFeatureShape(this.getSingleBaseWidth(),this._layoutObj.getFeatureHeight(r),r.end?r.end-r.start+1:1,this._getShape(r))).attr("transform",r=>`translate(${this.getXFromSeqPosition(r.start)},${this._layoutObj.getFeatureYPos(r.feature)})`).attr("fill",r=>this._getFeatureFillColor(r)).attr("stroke",r=>this._getFeatureColor(r)).style("fill-opacity",({feature:r})=>r.opacity?r.opacity:.9).style("stroke-opacity",({feature:r})=>r.opacity?r.opacity:.9),t.append("rect").attr("class","outer-rectangle feature").attr("width",r=>this.getSingleBaseWidth()*(r.end?r.end-r.start+1:1)).attr("height",r=>this._layoutObj.getFeatureHeight(r)).attr("transform",r=>`translate(${this.getXFromSeqPosition(r.start)},${this._layoutObj.getFeatureYPos(r.feature)})`).attr("fill","transparent").attr("stroke","transparent").call(this.bindEvents,this)}_applyFilters(){if(!this._filters||this._filters.length<=0){this._data=this._originalData;return}const t=rv(this._filters,"category"),r=Object.values(t).map(a=>{const i=a.map(o=>o.filterFn(this._originalData));return PD(...i)}),n=AD(...r);this._data=n}refresh(){if(this.xScale&&this.seq_g){const t=this.seq_g.selectAll("g.fragment-group").data(this._data.reduce((r,n)=>r.concat(n.locations.reduce((a,i)=>a.concat(i.fragments.map(o=>Object.assign({},o,{feature:n}))),[])),[]));t.selectAll("path.feature").attr("d",r=>this._featureShape.getFeatureShape(this.getSingleBaseWidth(),this._layoutObj.getFeatureHeight(r),r.end?r.end-r.start+1:1,this._getShape(r))).attr("transform",r=>`translate(${this.getXFromSeqPosition(r.start)},${this._layoutObj.getFeatureYPos(r.feature)})`),t.selectAll("rect.outer-rectangle").attr("width",r=>this.getSingleBaseWidth()*(r.end?r.end-r.start+1:1)).attr("height",r=>this._layoutObj.getFeatureHeight(r)).attr("transform",r=>`translate(${this.getXFromSeqPosition(r.start)},${this._layoutObj.getFeatureYPos(r.feature)})`),this._updateHighlight()}}_updateHighlight(){this.trackHighlighter.updateHighlight()}}const b4=16,KV=14,fm=10;class kh extends C_{init(t,r){let n=0;if(this.height={},this.yPos={},this.maxYPos=0,!t)return;this.innerPadding=(b4-fm)/2;const a={};for(let i=0;i<t.length;i++){const o=t[i];this.height[o.accession]=this.expanded?KV:b4,this.yPos[o.accession]=this._padding,n=this.height[o.accession]+2*this._padding,this.maxYPos=Math.max(this.maxYPos,n),o.accession in a||(a[o.accession]={}),o.residues&&(n=this._initResidues(o.residues,o.accession,o.locations,this.expanded?n:this.yPos[o.accession],i,a,this.expanded))}if(r)for(let i=0;i<r.length;i++){const o=r[i];o.accession in this.height||(this.height[o.accession]=fm,this.yPos[o.accession]=(this.expanded?this.maxYPos:this.innerPadding)+this._padding,n+=2*this._padding+(this.expanded?this.height[o.accession]:0),this.maxYPos=Math.max(this.maxYPos,n)),o.accession in a||(a[o.accession]={}),o.residues&&(n=this._initResidues(o.residues,o.accession,o.locations,o.expanded?n:this.yPos[o.accession],i,a,o.expanded))}this.maxYPos+=this._padding}_initResidues(t,r,n,a,i,o={},s=!0){for(let u=0;u<t.length;u++){const l=t[u];kh._filterOutResidueFragmentsOutOfLocation(l,n),l.accession in o[r]||(o[r][l.accession]={});for(let c=0;c<l.locations.length;c++){const d=l.locations[c].description;d in o[r][l.accession]||(o[r][l.accession][d]={height:s?fm:this.height[r]-2*this.innerPadding,yPos:s?this.maxYPos+this._padding:a+this.innerPadding},a=s?this.maxYPos+2*this._padding+fm:a),this.height[`${l.accession}_${i}_${u}_${c}`]=o[r][l.accession][d].height,this.yPos[`${l.accession}_${i}_${u}_${c}`]=o[r][l.accession][d].yPos,this.maxYPos=Math.max(this.maxYPos,a)}}return s?a:this.maxYPos+2*this._padding}static _filterOutResidueFragmentsOutOfLocation(t,r){t.locations.forEach(n=>n.fragments=n.fragments.filter(a=>r.some(i=>i.fragments.some(o=>a.start>=o.start&&a.end<=o.end)))),t.locations=t.locations.filter(n=>n.fragments.length)}static _getAccFromFeature(t){let r="";return typeof t=="string"?r=t:t.accession&&(r=t.accession),r}getFeatureYPos(t){const r=kh._getAccFromFeature(t);return r in this.yPos?this.yPos[r]:0}getFeatureHeight(t){const r=kh._getAccFromFeature(t);return r in this.height?this.height[r]:0}}const S4=(e,t)=>{let r=Ha({value:1},e);const n=[];for(const a of t)r?r.end<a.start?(n.push(r),r=null,n.push(a)):r.start<a.start&&r.end>=a.end?(n.push({start:r.start,end:a.start-1,value:r.value}),n.push({start:a.start,end:a.end,value:a.value+r.value}),r=a.end===r.end?null:{start:a.end+1,end:r.end,value:r.value}):a.start<r.start&&a.end>r.end?(n.push({start:a.start,end:r.start-1,value:a.value}),n.push({start:r.start,end:r.end,value:a.value+r.value}),n.push({start:r.end+1,end:a.end,value:a.value}),r=null):a.end>=r.start&&a.end<=r.end?(a.start<r.start&&n.push({start:a.start,end:r.start-1,value:a.value}),n.push({start:r.start,end:a.end,value:a.value+r.value}),r=a.end<r.end?{start:a.end+1,end:r.end,value:r.value}:null):r.end>=a.start&&r.end<a.end?(n.push({start:r.start,end:a.start-1,value:r.value}),n.push({start:a.start,end:r.end,value:a.value+r.value}),n.push({start:r.end+1,end:a.end,value:a.value}),r=null):n.push(a):n.push(a);return r&&n.push(r),n},$V=(e,t=100,r=!0)=>{let n=[];return r&&(n=S4({start:1,end:t,value:0},n)),e.forEach(a=>a.locations.forEach(i=>i.fragments.forEach(o=>{n=S4(o,n)}))),n},$p={top:2,right:10,bottom:2,left:10},x4=.8,C4=.3,QV=e=>(e+C4)/(1+C4);class Bh extends Td{_createTrack(){this._layoutObj.expanded=this._expanded,super._createTrack(),this.children_g=null}connectedCallback(){super.connectedCallback(),this._expanded=this.hasAttribute("expanded"),this._haveCreatedFeatures=!1}attributeChangedCallback(t,r,n){if(t==="expanded"&&r!==n&&this._contributors)for(const a of this._contributors)a.expanded=!r;super.attributeChangedCallback(t,r,n)}set contributors(t){this._contributors=Bh.normalizeLocations(t),this._coverage=$V(this._contributors,this._length),this._data&&this._createTrack()}getLayout(){return new kh({layoutHeight:this._height,expanded:this._expanded,padding:2})}static get observedAttributes(){return Td.observedAttributes.concat(["expanded","color"])}set color(t){this._color!==t&&(this._color=t,this.refresh())}static _createResidueGroup(t){return t.selectAll("g.residues-group").data(r=>r.residues?r.residues.map((n,a)=>ki(Ha({},n),{feature:r,i:a})):[]).enter().append("g").attr("class","residues-group").selectAll("g.residues-locations").data(r=>r.locations.map((n,a)=>ki(Ha({},n),{accession:r.accession,feature:r.feature,location:n,i:r.i,j:a}))).enter().append("g").attr("class","residues-locations")}_createResiduePaths(t){return t.selectAll("g.residue").data(r=>r.fragments.map(n=>ki(Ha({},n),{accession:r.accession,feature:ki(Ha({},r.feature),{currentResidue:ki(Ha({},n),{description:r.location.description})}),location:r.location,k:r.feature.k,i:r.i,j:r.j}))).enter().append("path").attr("class","feature rectangle residue").attr("d",r=>this._featureShape.getFeatureShape(this.getSingleBaseWidth(),this._layoutObj.getFeatureHeight(`${r.accession}_${r.k}_${r.i}_${r.j}`),r.end?r.end-r.start+1:1,"rectangle")).attr("transform",r=>`translate(${this.getXFromSeqPosition(r.start)},${$p.top+this._layoutObj.getFeatureYPos(`${r.accession}_${r.k}_${r.i}_${r.j}`)})`).attr("fill",r=>this._getFeatureColor(r)).attr("stroke","transparent").call(this.bindEvents,this)}_refreshResiduePaths(t,r){const n=new Set(t.data().map(a=>`${a.feature.accession}-${a.location.description}`)).size;t.attr("d",a=>this._featureShape.getFeatureShape(this.getSingleBaseWidth(),this._layoutObj.getFeatureHeight(`${a.accession}_${a.k}_${a.i}_${a.j}`),a.end?a.end-a.start+1:1,"rectangle")).attr("transform",a=>`translate(${this.getXFromSeqPosition(a.start)},${$p.top+this._layoutObj.getFeatureYPos(`${a.accession}_${a.k}_${a.i}_${a.j}`)})`).style("pointer-events",a=>r||a.feature&&a.feature.expanded?"auto":"none").style("stroke",()=>r?null:"none").style("opacity",()=>r?null:x4/n).attr("fill",a=>r||a.feature&&a.feature.expanded?this._getFeatureColor(a):"white")}_createFeatures(){if(this._layoutObj.init(this._data,this._contributors),this._data.forEach((t,r)=>t.k=r),this.featuresG=this.seq_g.selectAll("g.feature-group").data(this._data).enter().append("g").attr("class","feature-group").attr("id",t=>`g_${t.accession}`),this.locations=this.featuresG.selectAll("g.location-group").data(t=>t.locations.map(r=>ki(Ha({},r),{feature:t}))).enter().append("g").attr("class","location-group"),this.coverLines=this.locations.selectAll("line.cover").data(t=>[t.fragments.reduce((r,n)=>({start:Math.min(r.start,n.start),end:Math.max(r.end,n.end),feature:t.feature}),{start:1/0,end:-1/0})]).enter().append("line").attr("class","cover"),this.features=this.locations.selectAll("path.feature").data(t=>t.fragments.map(r=>ki(Ha({},r),{feature:t.feature,fragments:t.fragments}))).enter().append("path").attr("class",t=>`${this._getShape(t)} feature`).on("click.expanded",()=>{this._expanded?this.removeAttribute("expanded"):this.setAttribute("expanded","expanded")}).call(this.bindEvents,this),this.residues_g=Bh._createResidueGroup(this.featuresG),this.residues_loc=this._createResiduePaths(this.residues_g),this._contributors){this._contributors.forEach((r,n)=>r.k=n),this.children_g||(this.children_g=this.svg.append("g").attr("class","children-features")),this.childrenGroup=this.children_g.append("g").attr("class","children-group"),this.childGroup=this.childrenGroup.selectAll("g.child-group").data(this._contributors).enter().append("g").attr("class","child-group");const t=this.childGroup.selectAll("g.child-location-group").data(r=>(r.expanded=this._expanded,r.locations.map(n=>ki(Ha({},n),{feature:r})))).enter().append("g").attr("class",(r,n)=>`child-location-group clg-${n}`);this.coverLinesChildren=t.selectAll("line.cover").data(r=>[r.fragments.reduce((n,a)=>({start:Math.min(n.start,a.start),end:Math.max(n.end,a.end),feature:r.feature}),{start:1/0,end:-1/0})]).enter().append("line").attr("class","cover"),this.featureChildren=t.selectAll("path.child-fragment").data(r=>r.fragments.map(n=>ki(Ha({},n),{feature:r.feature,fragments:r.fragments}))).enter().append("path").attr("class",r=>`${this._getShape(r)} child-fragment feature`).call(this.bindEvents,this).on("click.expanded",r=>{r.feature.expanded=!r.feature.expanded,this.refresh()}),this.child_residues_g=Bh._createResidueGroup(this.childGroup),this.child_residues_loc=this._createResiduePaths(this.child_residues_g),this._coverage&&this._coverage.length&&this._createCoverage()}this.svg.attr("height",this._layoutObj.maxYPos),this._haveCreatedFeatures=!0}_createCoverage(){this._accession=this._data&&this._data[0]&&this._data[0].accession||"_",this.coverage_mask=this.svg.append("defs").append("mask").attr("id",`mask-${this._accession}`),this.coverageMaskFragment=this.coverage_mask.selectAll("rect").data(this._coverage).enter().append("rect").attr("y",0).attr("height",this._height)}_refreshCoverage(){this.featuresG.attr("mask",this._expanded?null:`url(#mask-${this._accession})`),this.coverageMaskFragment.attr("x",t=>this.getXFromSeqPosition(t.start)).attr("width",t=>this.getSingleBaseWidth()*(t.end-t.start+1)).attr("fill","white").attr("opacity",t=>QV(t.value/this._contributors.length))}_refreshFeatures(t,r=!0){const n=new Set(t.data().map(a=>a.feature.accession)).size;t.attr("d",a=>this._featureShape.getFeatureShape(this.getSingleBaseWidth(),this._layoutObj.getFeatureHeight(a.feature),a.end?a.end-a.start+1:1,r?this._getShape(a.shape?a:a.feature):"rectangle")).attr("fill",a=>r?this._getFeatureColor(a.feature):"white").attr("opacity",r?1:x4/n).style("stroke",a=>r?this._getFeatureColor(a.feature):"none").attr("transform",a=>`translate(${this.getXFromSeqPosition(a.start)},${$p.top+this._layoutObj.getFeatureYPos(a.feature)})`).style("pointer-events",r?"auto":"none")}_refreshCoverLine(t,r=!0){t.attr("x1",n=>this.getXFromSeqPosition(n.start)).attr("x2",n=>this.getXFromSeqPosition(n.end+1)).attr("y1",n=>$p.top+this._layoutObj.getFeatureYPos(n.feature)+this._layoutObj.getFeatureHeight(n.feature)/2).attr("y2",n=>$p.top+this._layoutObj.getFeatureYPos(n.feature)+this._layoutObj.getFeatureHeight(n.feature)/2).attr("stroke",n=>this._getFeatureColor(n.feature)).attr("visibility",r?"visible":"hidden")}refresh(){this._haveCreatedFeatures&&(this._layoutObj.expanded=this._expanded,this._layoutObj.init(this._data,this._contributors),this.height=this._layoutObj.maxYPos,this._refreshCoverLine(this.coverLines),this._refreshFeatures(this.features),this._refreshResiduePaths(this.residues_loc,this._expanded),this._contributors&&(this.childrenGroup.attr("visibility",this._expanded?"visible":"hidden"),this._refreshCoverLine(this.coverLinesChildren,this._expanded),this._refreshFeatures(this.featureChildren,this._expanded),this.child_residues_g.attr("visibility",()=>this._expanded?"visible":"hidden"),this._refreshResiduePaths(this.child_residues_loc),this._coverage&&this._coverage.length&&this._refreshCoverage()),this._updateHighlight(),this.svg.attr("height",this._layoutObj.maxYPos))}}const ZV=3;class JV extends W0{connectedCallback(){super.connectedCallback(),this.sequence=this.getAttribute("sequence");const t=this.getAttribute("numberofticks");this.numberOfTicks=Number.isInteger(parseInt(t,10))?t:ZV,this.sequence&&this._createSequence(),this.addEventListener("load",r=>{this.data=r.detail.payload})}static get observedAttributes(){return W0.observedAttributes.concat("highlightstart","highlightend")}get data(){return this.sequence}set data(t){typeof t=="string"?this.sequence=t:"sequence"in t&&(this.sequence=t.sequence),this.sequence&&!super.svg?this._createSequence():this.refresh()}_getCharSize(){if(!this.seq_g)return;const t=.8,r=1.6,n=this.seq_g.select("text.base").node();if(n)this.chWidth=n.getBBox().width*t,this.chHeight=n.getBBox().height*r;else{const a=this.seq_g.append("text").attr("class","base").text("T");this.chWidth=a.node().getBBox().width*t,this.chHeight=a.node().getBBox().height*r,a.remove()}}_createSequence(){ha(this).selectAll("div").remove(),super.svg=ha(this).append("div").attr("class","").append("svg").attr("id","").attr("width",this.width).attr("height",this._height),this.seq_bg=super.svg.append("g").attr("class","background"),this.axis=super.svg.append("g").attr("class","x axis"),this.seq_g=super.svg.append("g").attr("class","sequence").attr("transform",`translate(0,${.75*this._height})`),this.trackHighlighter.appendHighlightTo(this.svg),this.refresh()}refresh(){if(this._getCharSize(),this.axis){const t=this.getSingleBaseWidth(),r=t-this.chWidth,n=t/2,a=Math.round(Math.max(0,this._displaystart-2)),i=Math.round(Math.min(this.sequence.length,this._displayend+1)),o=r<0?[]:this.sequence.slice(a,i).split("").map((s,u)=>({start:1+a+u,end:1+a+u,aa:s}));this.height>this.chHeight&&(this.xAxis=eD(this.xScale).tickFormat(s=>Number.isInteger(s)?s:"").ticks(this.numberOfTicks,"s"),this.axis.call(this.xAxis)),this.axis.attr("transform",`translate(${this.margin.left+n},0)`),this.axis.select(".domain").remove(),this.axis.selectAll(".tick line").remove(),this.bases=this.seq_g.selectAll("text.base").data(o,s=>s.start),this.bases.enter().append("text").attr("class","base").attr("text-anchor","middle").attr("x",s=>this.getXFromSeqPosition(s.start)+n).text(s=>s.aa).style("pointer-events","none").style("font-family","monospace"),this.bases.exit().remove(),this.bases.attr("x",s=>this.getXFromSeqPosition(s.start)+n),this.background=this.seq_bg.selectAll("rect.base_bg").data(o,s=>s.start),this.background.enter().append("rect").attr("class","base_bg feature").attr("height",this._height).merge(this.background).attr("width",t).attr("fill",s=>Math.round(s.start)%2?"#ccc":"#eee").attr("x",s=>this.getXFromSeqPosition(s.start)).call(this.bindEvents,this),this.background.exit().remove(),this.seq_g.style("opacity",Math.min(1,r)),this.background.style("opacity",Math.min(1,r)),this._updateHighlight()}}_updateHighlight(){this.trackHighlighter.updateHighlight()}}function eH(e){const{variants:t,sequence:r}=e;if(!r||!t)return null;const a=r.split("").map((i,o)=>({type:"VARIANT",normal:i,pos:o+1,variants:[]}));return t.forEach(i=>{a[i.start-1]&&a[i.start-1].variants.push(i)}),a}class tH{constructor(){this._frequency=lD().exponent(.001).domain([0,1]).range([5,10]),this.drawVariationPlot=this.drawVariationPlot.bind(this)}drawVariationPlot(t,r){const a=r.getSingleBaseWidth()/2;t.each((i,o,s)=>{const u=ha(s[o]),l=i.filter(f=>f.variants.length!==0),c=u.selectAll("g").data(l,f=>f.pos);c.exit().remove();const d=c.enter().append("g").merge(c).selectAll("circle").data(f=>f.variants);d.exit().remove(),d.enter().append("circle").merge(d).attr("class","feature").attr("title",f=>f.start).attr("r",f=>f.size?f.size:5).attr("cx",f=>r.getXFromSeqPosition(f.start)+a).attr("cy",f=>r._yScale(f.variant.charAt(0))).attr("name",f=>{const p=f.alternativeSequence==="*"?"STOP":f.alternativeSequence;return f.internalId=`var_${f.wildType}${f.start}${p}`,f.internalId}).attr("fill",f=>f.color?f.color:r._colorConfig(f)).call(r.bindEvents,r)})}}const rH=["G","A","V","L","I","S","T","C","M","D","N","E","Q","R","K","H","F","Y","W","P","d","*"],_4=(e,t)=>{if(!e||e.length<=0)return null;const r=e[0];return r.forEach((n,a)=>{const i=e.map(o=>o[a].variants);n.variants=t(...i)}),r};class __ extends Td{connectedCallback(){super.connectedCallback();const t=document.createElement("style");t.innerHTML=__.css,this.appendChild(t),this._height=Number(this.getAttribute("height"))?Number(this.getAttribute("height")):430,this._width=this._width?this._width:0,this._yScale=vy(),this._yScale=I7().domain(rH).range([0,this._height-this.margin.top-this.margin.bottom])}processData(t){this._originalData=eH(t)}static get css(){return`
    <style>
    protvista-variation {
      display: flex;
      width: 100%;
    }
    
    protvista-variation svg {
      background-color: #fff;
    }
    
    protvista-variation circle {
      opacity: 0.6;
    }
    protvista-variation circle:hover {
      opacity: 0.9;
    }
    protvista-variation .tick line,
    protvista-variation .axis path {
      opacity: 0.1;
    }
    
    .protvista-highlight {
      fill: #ffe999;
    }
    
    protvista-variation .variation-y-right line,
    protvista-variation .axis path {
      fill: none;
      stroke: none;
    }
    
    </style>
    `}_createFeatures(){this._variationPlot=new tH;const t=super.svg.select("g.sequence-features"),r=t.attr("transform",`translate(0, ${this.margin.top})`).append("g");this._series=r.datum(this._data),this._axisLeft=t.append("g"),this._axisRight=t.append("g"),this.updateScale()}set filters(t){super.filters=t,this.updateData(this._data),this.refresh()}_applyFilters(){if(!this._filters||this._filters.length<=0){this._data=this._originalData;return}const t=rv(this._filters,"category"),r=Object.values(t).map(n=>{const a=n.map(i=>i.filterFn(this._originalData));return _4(a,PD)});this._data=_4(r,AD)}set colorConfig(t){this._colorConfig=t}get colorConfig(){return this._colorConfig}refresh(){this._series&&(this.updateScale(),this._series.call(this._variationPlot.drawVariationPlot,this),this._updateHighlight())}updateScale(){this._yAxisLScale=M7().scale(this._yScale).tickSize(-this.getWidthWithMargins()),this._yAxisRScale=D7().scale(this._yScale),this._axisLeft.attr("class","variation-y-left axis").attr("transform",`translate(${this.margin.left},0)`).call(this._yAxisLScale),this._axisRight.attr("transform",`translate(${this.getWidthWithMargins()-this.margin.right+2}, 0)`).attr("class","variation-y-right axis").call(this._yAxisRScale)}updateData(t){this._series&&this._series.datum(t)}}class nH extends Td{constructor(){super();this._line=H7().x((t,r)=>this.getXFromSeqPosition(r+1)-this.getSingleBaseWidth()/2).y(t=>this._yScale(t))}init(){this._totalsArray={total:null,diseaseTotal:null}}connectedCallback(){super.connectedCallback(),this._data=void 0,this._height=Number(this.getAttribute("height"))||40,this._yScale=vy(),this.init()}set data(t){if(this.init(),!(!t.sequence||t.variants.length<=0)){this._totalsArray.total=new Uint8ClampedArray(t.sequence.length),this._totalsArray.diseaseTotal=new Uint8ClampedArray(t.sequence.length);for(const{start:r,association:n}of t.variants){const a=+r;if(a<1||a>t.sequence.length||(this._totalsArray.total[a]++,!n))continue;n.find(o=>o.disease===!0)&&this._totalsArray.diseaseTotal[a]++}this._createTrack()}}_createTrack(){ha(this).selectAll("svg").remove(),this.svg=ha(this).append("svg").attr("width",this.width).attr("height",this._height),this.trackHighlighter.appendHighlightTo(this.svg),this._initYScale(),this.refresh()}_initYScale(){this._yScale.domain([0,Math.max(OA(this._totalsArray.total),OA(this._totalsArray.diseaseTotal))]).range([this._height,0])}refresh(){!this.svg||(this.svg.selectAll("path").remove(),this.svg.append("path").attr("d",this._line(this._totalsArray.diseaseTotal)).attr("fill","none").attr("stroke","red").attr("transform","translate(0,0)"),this.svg.append("path").attr("d",this._line(this._totalsArray.total)).attr("fill","none").attr("stroke","darkgrey").attr("transform","translate(0,0)"),this._updateHighlight())}}class aH extends nl{static get properties(){return{filters:{type:Array},selectedFilters:{type:Set},for:{type:String}}}constructor(){super();this.filters=[],this.selectedFilters=new Set}connectedCallback(){super.connectedCallback(),this.addEventListener("filterChange",this._onFilterChange),this.closest("protvista-manager")&&(this.manager=this.closest("protvista-manager"),this.manager.register(this))}disconnectedCallback(){super.disconnectedCallback(),this.manager&&this.manager.unregister(this),this.removeEventListener("filterChange",this._onFilterChange)}static get styles(){return Ji`
      :host {
        font-size: 0.8rem;
      }

      :host[disabled] {
        opacity: 0.5;
      }

      .protvista_checkbox {
        position: relative;
        cursor: pointer;
        box-sizing: border-box;
        display: flex;
        align-items: center;
        margin-top: 10px;
        line-height: 24px;
        outline: none;
      }

      .protvista_checkbox_input {
        position: absolute;
        opacity: 0;
        cursor: pointer;
        height: 0;
        width: 0;
      }

      .checkmark {
        opacity: 0.4;
        height: 25px;
        width: 25px;
        background-color: #eee;
        border-radius: 4px;
        box-sizing: border-box;
        border: 1px solid #bdc3c7;
      }

      .protvista_checkbox_input:checked ~ .checkmark {
        opacity: 1;
      }

      .protvista_checkbox_label {
        margin-left: 0.2rem;
        line-height: 1rem;
      }
    `}render(){const t=rv(this.filters,r=>r.type.text);return zr`
      ${Object.keys(t).map(r=>zr`
            <h4>${r}</h4>
            <div>
              ${t[r].map(n=>zr`
                    ${this.getCheckBox(n)}
                  `)}
            </div>
          `)}
    `}getCheckBox(t){const{name:r,options:n}=t,{labels:a}=n;n.colors.length==null&&(n.colors=[n.colors]);const i=n.colors.length>1;return zr`
      <label
        class="protvista_checkbox ${i?"compound":""}"
        tabindex="0"
      >
        <input
          type="checkbox"
          class="protvista_checkbox_input"
          ?checked="true"
          .value="${r}"
          @change="${()=>this.toggleFilter(r)}"
        />
        <span
          class="checkmark"
          style=${`background: ${i?`
            linear-gradient(${n.colors[0]},
            ${n.colors[1]})
          `:n.colors[0]};`}
        ></span>
        <span class="protvista_checkbox_label">
          ${a.join("/")}
        </span>
      </label>
    `}toggleFilter(t){this.selectedFilters.has(t)?this.selectedFilters.delete(t):this.selectedFilters.add(t),this.dispatchEvent(new CustomEvent("change",{bubbles:!0,composed:!0,detail:{type:"filters",handler:"property",for:this.for,value:this.filters.filter(r=>this.selectedFilters.has(r.name)).map(r=>({category:r.type.name,filterFn:r.filterData}))}}))}}const pm="length",hm="displaystart",vm="displayend",mm="highlight";class X0 extends HTMLElement{constructor(){super();this.protvistaElements=new Set,this.attributeValues=new Map,this.propertyValues=new Map,this.mouseOver=!1}static get observedAttributes(){return["attributes",pm,hm,vm,mm]}set length(t){this.attributeValues.set(pm,t)}get length(){return this.attributeValues.get(pm)}set displaystart(t){this.attributeValues.set(hm,t)}get displaystart(){return this.attributeValues.get(hm)}set displayend(t){this.attributeValues.set(vm,t)}get displayend(){return this.attributeValues.get(vm)}set highlight(t){this.attributeValues.set(mm,t)}get highlight(){return this.attributeValues.get(mm)}attributeChangedCallback(t,r,n){if(r!==n){if(t==="attributes"){if(this._attributes=n.split(" "),this._attributes.indexOf("type")!==-1)throw new Error("'type' can't be used as a protvista attribute");if(this._attributes.indexOf("value")!==-1)throw new Error("'value' can't be used as a protvista attribute");this.attributeValues=new Map(this._attributes.filter(a=>!X0.observedAttributes.includes(a)).map(a=>[a,null]))}else t===pm&&(this.length=n),t===hm&&(this.displaystart=n),t===vm&&(this.displayend=n),t===mm&&(this.highlight=n);this.applyAttributes()}}register(t){this.protvistaElements.add(t),this.applyAttributes()}unregister(t){this.protvistaElements.delete(t)}_polyfillElementClosest(){Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.closest||(Element.prototype.closest=t=>{let r=this;do{if(r.matches(t))return r;r=r.parentElement||r.parentNode}while(r!==null&&r.nodeType===1);return null})}applyAttributes(){this.protvistaElements.forEach(t=>{this.attributeValues.forEach((r,n)=>{r===!1||r===null||r===void 0?t.removeAttribute(n):t.setAttribute(n,typeof r=="boolean"?"":r)})})}applyProperties(t){if(t){const r=this.querySelector(`#${t}`);this.propertyValues.forEach((n,a)=>{r[a]=n})}else this.protvistaElements.forEach(r=>{this.propertyValues.forEach((n,a)=>{r[a]=n})})}isRegisteredAttribute(t){return[...this.attributeValues.keys()].includes(t)||X0.observedAttributes.includes(t)}_changeListener(t){if(!!t.detail)switch(t.detail.handler){case"property":this.propertyValues.set(t.detail.type,t.detail.value),this.applyProperties(t.detail.for);break;default:this.isRegisteredAttribute(t.detail.type)&&this.attributeValues.set(t.detail.type,t.detail.value),Object.keys(t.detail).forEach(r=>{this.isRegisteredAttribute(r)&&this.attributeValues.set(r,t.detail[r])}),this.applyAttributes()}}connectedCallback(){this.addEventListener("change",this._changeListener)}}var iH=globalThis&&globalThis.__awaiter||function(e,t,r,n){function a(i){return i instanceof r?i:new r(function(o){o(i)})}return new(r||(r=Promise))(function(i,o){function s(c){try{l(n.next(c))}catch(d){o(d)}}function u(c){try{l(n.throw(c))}catch(d){o(d)}}function l(c){c.done?i(c.value):a(c.value).then(s,u)}l((n=n.apply(e,t||[])).next())})};const mb=new Map,WD=(e,t=new Headers({accept:"application/json"}))=>{const r=mb.get(e);if(r)return r;const n=(()=>iH(void 0,void 0,void 0,function*(){const a=yield window.fetch(e,{headers:t});if(!a.ok)throw new Error(`Request Failed: Status = ${a.status}; URI = ${e}; Time = ${new Date}`);return a.status===204?{payload:null,headers:a.headers}:{payload:yield a.json(),headers:a.headers}}))();return mb.set(e,n),n.catch(()=>mb.delete(e)),n};var gm,oH=new Uint8Array(16);function sH(){if(!gm&&(gm=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto!="undefined"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!gm))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return gm(oH)}var uH=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function lH(e){return typeof e=="string"&&uH.test(e)}var Ra=[];for(var gb=0;gb<256;++gb)Ra.push((gb+256).toString(16).substr(1));function cH(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=(Ra[e[t+0]]+Ra[e[t+1]]+Ra[e[t+2]]+Ra[e[t+3]]+"-"+Ra[e[t+4]]+Ra[e[t+5]]+"-"+Ra[e[t+6]]+Ra[e[t+7]]+"-"+Ra[e[t+8]]+Ra[e[t+9]]+"-"+Ra[e[t+10]]+Ra[e[t+11]]+Ra[e[t+12]]+Ra[e[t+13]]+Ra[e[t+14]]+Ra[e[t+15]]).toLowerCase();if(!lH(r))throw TypeError("Stringified UUID is invalid");return r}var w4,yb,bb=0,Sb=0;function wy(e,t,r){var n=t&&r||0,a=t||new Array(16);e=e||{};var i=e.node||w4,o=e.clockseq!==void 0?e.clockseq:yb;if(i==null||o==null){var s=e.random||(e.rng||sH)();i==null&&(i=w4=[s[0]|1,s[1],s[2],s[3],s[4],s[5]]),o==null&&(o=yb=(s[6]<<8|s[7])&16383)}var u=e.msecs!==void 0?e.msecs:Date.now(),l=e.nsecs!==void 0?e.nsecs:Sb+1,c=u-bb+(l-Sb)/1e4;if(c<0&&e.clockseq===void 0&&(o=o+1&16383),(c<0||u>bb)&&e.nsecs===void 0&&(l=0),l>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");bb=u,Sb=l,yb=o,u+=122192928e5;var d=((u&268435455)*1e4+l)%4294967296;a[n++]=d>>>24&255,a[n++]=d>>>16&255,a[n++]=d>>>8&255,a[n++]=d&255;var f=u/4294967296*1e4&268435455;a[n++]=f>>>8&255,a[n++]=f&255,a[n++]=f>>>24&15|16,a[n++]=f>>>16&255,a[n++]=o>>>8|128,a[n++]=o&255;for(var p=0;p<6;++p)a[n+p]=i[p];return t||cH(a)}const dH=[{name:"ECO:0000269",description:"Manual assertion based on experiment",shortDescription:"Publication",acronym:"EXP",isManual:!0},{name:"ECO:0000303",description:"Manual assertion based on opinion",shortDescription:"Publication",acronym:"NAS",isManual:!0},{name:"ECO:0000305",description:"Manual assertion inferred by curator",shortDescription:"Curated",acronym:"IC",isManual:!0},{name:"ECO:0000250",description:"Manual assertion inferred from sequence similarity",shortDescription:"By similarity",acronym:"ISS",isManual:!0},{name:"ECO:0000255",description:"Manual assertion according to rules",shortDescription:"Sequence Analysis",acronym:"ISM",isManual:!0},{name:"ECO:0000244",description:"Manual assertion inferred from combination of experimental and computational evidence",shortDescription:"Combined sources",acronym:"MIXM",isManual:!0},{name:"ECO:0000312",description:"Manual assertion inferred from database entries",shortDescription:"Imported",acronym:"MI",isManual:!0},{name:"ECO:0000256",description:"Automatic assertion according to rules",shortDescription:"Automatic annotation",acronym:"AA"},{name:"ECO:0000259",description:"Automatic assertion inferred from signature match",shortDescription:"Automatic annotation",acronym:"AA"},{name:"ECO:0000213",description:"Automatic assertion inferred from combination of experimental and computational evidence",shortDescription:"Combined sources",acronym:"MIXA"},{name:"ECO:0000313",description:"Automatic assertion inferred from database entries",shortDescription:"Imported",acronym:"AI"}],XD=e=>e.map(t=>{const r={};return t.begin&&(r.start=t.begin),Ha(Ha({},t),r)}),fH=e=>e.name.toLowerCase()==="PubMed".toLowerCase()?`${e.id}&nbsp;(<a href='${e.url}' style="color:#FFF" target='_blank'>${e.name}</a>&nbsp;<a href='${e.alternativeUrl}' style="color:#FFF" target='_blank'>EuropePMC</a>)`:`&nbsp;<a href='${e.url}' style="color:#FFF" target='_blank'>${e.id}</a>&nbsp;(${e.name})`,YD=e=>e?`
      <ul>${e.map(t=>{const r=dH.find(n=>n.name===t.code);return r?`<li title='${r.description}' style="padding: .25rem 0">${r.shortDescription}:&nbsp;${t.source?fH(t.source):""}</li>`:""}).join("")}</ul>
    `:"",KD=e=>`<ul>${e.map(t=>`<li style="padding: .25rem 0">${t.name} ${t.url?`<a href="${t.url}" style="color:#FFF" target="_blank">${t.id}</a>`:`${t.name} ${t.id}`}</li>`).join("")}</ul>`,$D=e=>{const t=YD(e.evidences);return`
      ${e.description?`<h5>Description</h5><p>${e.description}</p>`:""}
      ${e.matchScore?`<h5>Match score</h5><p>${e.matchScore}%</p>`:""}
      ${e.ftId?`<h5>Feature ID</h5><p>${e.ftId}</p>`:""}
      ${e.alternativeSequence?`<h5>Alternative sequence</h5><p>${e.alternativeSequence}</p>`:""}
      ${t?`<h5>Evidence</h5>${t}`:""}
      ${e.xrefs?`<h5>Cross-references</h5>${KD(e.xrefs)}`:""}
      ${e.peptide?`<h5>Peptide</h5><p>${e.peptide}</p>`:""}
      ${e.ptms?`<h5>PTMs</h5><ul>${e.ptms.map(r=>`<li>${r.name} - position: ${r.position}</li>`)}</ul>`:""}
        `},pH=e=>{let t=[];const{features:r}=e;return r&&r.length>0&&(t=r.map(n=>ki(Ha({},n),{tooltipContent:$D(n),protvistaFeatureId:wy()})),t=XD(t)),t},hH=e=>{let t=[];return e&&e.length!==0&&(t=e.features.map(r=>Object.assign(r,{category:"PROTEOMICS",type:r.unique?"unique":"non_unique",tooltipContent:$D(r),protvistaFeatureId:wy()})),t=XD(t)),t},vH="PDBE_COVER",mH="STRUCTURE_COVERAGE",gH=e=>e.charAt(0).toUpperCase()+e.slice(1),yH=e=>Object.keys(e).reduce((t,r)=>`${t}${gH(r)}: ${e[r]}. `,""),bH=e=>{const t=e.indexOf("="),r=e.indexOf("-");return t===-1||r===-1?{start:0,end:0}:{start:+e.slice(t+1,r),end:+e.slice(r+1)}},SH=e=>e.dbReferences.filter(t=>t.type==="PDB").map(t=>{const r=t.properties.chains?bH(t.properties.chains):{start:0,end:0};return{type:vH,category:mH,structures:[{description:yH(t.properties),start:r.start,end:r.end,source:{id:t.id,url:`http://www.ebi.ac.uk/pdbe-srv/view/entry/${t.id}`}}],start:r.start,end:r.end}}),xH=e=>{if(!e||e.length<=0)return[];const t=e.sort((n,a)=>n.start-a.start),r=[];return t.forEach(n=>{const a=r[r.length-1];!a||a.end<n.start?r.push(n):(a.end<n.end&&(a.end=n.end),a.structures.push(n.structures[0]))}),r},CH=e=>`<ul>
            ${e.map(t=>`<li style="margin: 0.25rem 0"><a style="color:#FFF" href='${t.source.url}' target='_blank'>
            ${t.source.id}
        </a> (${t.start}-${t.end})</li>`).join("")}
        </ul>`,_H=e=>{const t=CH(e.structures);return`${t?`<h5>Structures</h5>${t}`:""}`},wH=e=>{let t=[];if(e&&e.length!==0){const r=SH(e);t=xH(r),t.forEach(n=>{n.tooltipContent=_H(n),n.protvistaFeatureId=wy()})}return t},AH=e=>e==null?void 0:e.map(t=>`
              <h4>Disease association</h4><p>${t.name}</p>
              ${t.description?`<>${t.description}</p>`:""}
              ${t.dbReferences?`<h5>Cross-references</h5>${KD(t.dbReferences)}`:""}
              ${YD(t.evidences)}
          `).join(""),PH=e=>`<hr/><h5>Description</h5>${e.map(t=>`<p>${t.value}</p>`).join("")}
  `,TH=e=>`<hr/><h5>Population frequencies</h5>${e.map(t=>`<p>${t.frequency} - ${t.populationName} (${t.source})</p>`).join("")}`,EH=e=>{if(e.locations.some(r=>r.source==="EnsemblViruses")){const r=e.xrefs.find(n=>n.name==="ENA");return r.id?`<h5>Ensembl COVID-19</h5>
          <p>
          <a href="https://covid-19.ensembl.org/Sars_cov_2/Variation/Explore?v=${r.id}" target="_blank" rel="noopener noreferrer">${r.id}</a>
        </p>`:""}return""},IH=e=>{const t=rv(e,"predAlgorithmNameType");return Object.keys(t).map(n=>{const a=rv(t[n],"predictionValType");return{algorithm:n,values:Object.keys(a).map(i=>({name:i,count:a[i].length}))}}).map(n=>`<h6>${n.algorithm}</h6><ul class="no-bullet">${n.values.map(a=>`<li>${a.name}</li>`).join("")}</ul>`).join("")},MH=e=>`
                <h5>Variant</h5><p>${e.wildType} > ${e.alternativeSequence||""}</p>
                ${e.populationFrequencies?TH(e.populationFrequencies):""}
                ${e.consequenceType?`<h5>Consequence</h5><p>${e.consequenceType}</p>`:""}
                ${e.somaticStatus?`<h5>Somatic</h5><p>${e.somaticStatus===0?"No":"Yes"}</p>`:""}
                ${e.genomicLocation?`<h5>Location</h5><p>${e.genomicLocation}</p>`:""}
                ${e.ftId?`<h5>Feature ID</h5><p>${e.ftId}</p>`:""}
                ${e.descriptions?PH(e.descriptions):""}
                ${e.association?AH(e.association):""}
                ${e.predictions?IH(e.predictions):""}
                ${EH(e)}
                
        `;var GS;(function(e){e.A="A",e.C="C",e.D="D",e.E="E",e.Empty="*",e.F="F",e.G="G",e.H="H",e.I="I",e.K="K",e.L="L",e.M="M",e.N="N",e.Nl="NL",e.P="P",e.Q="Q",e.R="R",e.S="S",e.T="T",e.V="V",e.W="W",e.Y="Y"})(GS||(GS={}));var A4;(function(e){e.CLINVAR="ClinVar",e.ESP="ESP",e.EXAC="ExAC",e.GENOMES1K="1000Genomes",e.BOVINE_SNP50="BovineSNP50",e.BOVINE_LD="BovineLD",e.BOVINE_HD="BovineHD",e.EQUINE_SNP50="EquineSNP50",e.CHICKEN_600K="Chicken600K",e.KG_HQ="1kg_hq",e.COSMIC="cosmic curated",e.REVIEWED="reviewed",e.UNIPROT="UniProt",e.DBSNP="dbSNP",e.ENSEMBL="Ensembl",e.ENSEMBL_PLANTS="EnsemblPlants",e.VECTORBASE="VectorBase",e.REFSEQ="RefSeq",e.DBGAP="dbGaP",e.DDD="DDD",e.PHARMCOGKB="PharmGKB",e.ENSEMBL_FUNGI="EnsemblFungi",e.ENSEMBL_METAZOA="EnsemblMetazoa",e.GNOMAD_V2="gnomAD_v2.0",e.GNOMAD_V3="gnomAD_v3.0",e.TCGA="NCI-TCGA",e.TCGA_COSMIC="NCI-TCGA Cosmic",e.DECIPHER="ddG2P",e.TOPMED="TOPMed",e.GNOMAD="gnomAD",e.PHARMGKB="pharmgkb",e.SGRP="SGRP",e.SGD="SGD",e.JEFFARES_SNPS="Jeffares_SNPs",e.JEFFARES_INDELS="Jeffares_Indels",e.ENSEMBL_VIRUSES="EnsemblViruses"})(A4||(A4={}));var P4;(function(e){e.Benign="Benign",e.Disease="Disease",e.LikelyBenign="Likely benign",e.LikelyPathogenic="Likely pathogenic",e.Pathogenic="Pathogenic",e.Protective="Protective",e.VariantOfUncertainSignificance="Variant of uncertain significance"})(P4||(P4={}));var T4;(function(e){e.Empty="-",e.Frameshift="frameshift",e.InframeDeletion="inframe deletion",e.Insertion="insertion",e.Missense="missense",e.StopGained="stop gained"})(T4||(T4={}));var E4;(function(e){e.PolyPhen="PolyPhen",e.Sift="SIFT"})(E4||(E4={}));var I4;(function(e){e.Benign="benign",e.Deleterious="deleterious",e.DeleteriousLowConfidence="deleterious - low confidence",e.PossiblyDamaging="possibly damaging",e.ProbablyDamaging="probably damaging",e.Tolerated="tolerated",e.ToleratedLowConfidence="tolerated - low confidence",e.Unknown="unknown"})(I4||(I4={}));var M4;(function(e){e.LargeScaleStudy="large_scale_study",e.Mixed="mixed",e.UniProt="uniprot"})(M4||(M4={}));const DH=(e,t)=>{const r=e?e.map(n=>n.name):[];return(t==="uniprot"||t==="mixed")&&r.push("uniprot"),r},RH=e=>{const{sequence:t,features:r}=e,n=r.map(a=>Object.assign(Object.assign({},a),{accession:a.genomicLocation,variant:a.alternativeSequence?a.alternativeSequence:GS.Empty,start:a.begin,xrefNames:DH(a.xrefs,a.sourceType),hasPredictions:a.predictions&&a.predictions.length>0,tooltipContent:MH(a),protvistaFeatureId:wy()}));return n?{sequence:t,variants:n}:null},OH=e=>{try{return e.results.map(({metadata:t,proteins:r})=>ki(Ha({},t),{locations:r[0].entry_protein_locations,start:Math.min(...r[0].entry_protein_locations.map(n=>Math.min(...n.fragments.map(a=>a.start)))),end:Math.max(...r[0].entry_protein_locations.map(n=>Math.max(...n.fragments.map(a=>a.end)))),tooltipContent:`
        <h5>Accession</h5>
        <a
          target="_blank"
          rel="noopener"
          href="https://www.ebi.ac.uk/interpro/entry/InterPro/${t.accession}/"
        >
        ${t.accession}
        </a>
        <h5>Name</h5>
        <p>${t.name}</p>
      `,length:r[0].protein_length}))}catch{throw new Error("Failed transforming the data")}},FH=[{name:"DOMAINS_AND_SITES",label:"Domains & sites",trackType:"protvista-track",tracks:[{name:"domain",label:"Domain",filter:"DOMAIN",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Specific combination of secondary structures organized into a characteristic three-dimensional structure or fold"},{name:"region",label:"Region",filter:"REGION",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Regions in multifunctional enzymes or fusion proteins, or characteristics of a region, e.g., protein-protein interactions mediation"},{name:"motif",label:"Motif",filter:"MOTIF",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Short conserved sequence motif of biological significance"},{name:"metal",label:"Metal binding",filter:"METAL",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Binding site for a metal ion"},{name:"site",label:"Site",filter:"SITE",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Any interesting single amino acid site on the sequence"},{name:"repeat",label:"Repeat",filter:"REPEAT",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Repeated sequence motifs or repeated domains within the protein"},{name:"ca_bind",label:"Calcium binding",filter:"CA_BIND",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Calcium-binding regions, such as the EF-hand motif"},{name:"dna_bind",label:"DNA binding",filter:"DNA_BIND",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"DNA-binding domains such as AP2/ERF domain, the ETS domain, the Fork-Head domain, the HMG box and the Myb domain"},{name:"zn_fing",label:"Zinc finger",filter:"ZN_FING",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Small, functional, independently folded domain that coordinates one or more zinc ions"},{name:"np_bind",label:"Nucleotide binding",filter:"NP_BIND",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"(aka flavin-binding). Region in the protein which binds nucleotide phosphates"},{name:"binding",label:"Binding site",filter:"BINDING",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Binding site for any chemical group (co-enzyme, prosthetic group, etc.)"},{name:"act_site",label:"Active site",filter:"ACT_SITE",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Amino acid(s) directly involved in the activity of an enzyme"}]},{name:"MOLECULE_PROCESSING",label:"Molecule processing",trackType:"protvista-track",tracks:[{name:"signal",label:"Signal peptide",filter:"SIGNAL",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"N-terminal signal peptide"},{name:"chain",label:"Chain",filter:"CHAIN",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"(aka mature region). This describes the extent of a polypeptide chain in the mature protein following processing"},{name:"transit",label:"Transit peptide",filter:"TRANSIT",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"This describes the extent of a transit peptide"},{name:"init_met",label:"Initiator methionine",filter:"INIT_MET",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"This indicates that the initiator methionine is cleaved from the mature protein"},{name:"propep",label:"Propeptide",filter:"PROPEP",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Part of a protein that is cleaved during maturation or activation"},{name:"peptide",label:"Peptide",filter:"PEPTIDE",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"The position and length of an active peptide in the mature protein"}]},{name:"PTM",label:"PTM",trackType:"protvista-track",tracks:[{name:"mod_res",label:"Modified residue",filter:"MOD_RES",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Modified residues such as phosphorylation, acetylation, acylation, methylation"},{name:"carbohyd",label:"Glycosylation",filter:"CARBOHYD",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Covalently attached glycan group(s)"},{name:"disulfid",label:"Disulfide bond",filter:"DISULFID",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"The positions of cysteine residues participating in disulphide bonds"},{name:"crosslnk",label:"Cross-link",filter:"CROSSLNK",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Covalent linkages of various types formed between two proteins or between two parts of the same protein"},{name:"lipid",label:"Lipidation",filter:"LIPID",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Covalently attached lipid group(s)"}]},{name:"SEQUENCE_INFORMATION",label:"Sequence information",trackType:"protvista-track",tracks:[{name:"compbias",label:"Compositional bias",filter:"COMPBIAS",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Position of regions of compositional bias within the protein and the particular amino acids that are over-represented within those regions"},{name:"conflict",label:"Sequence conflict",filter:"CONFLICT",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Sequence discrepancies of unknown origin"},{name:"non_cons",filter:"NON_CONS",trackType:"protvista-track",label:"Non-adjacent residues",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Indicates that two residues in a sequence are not consecutive and that there is an undetermined number of unsequenced residues between them"},{name:"non_ter",filter:"NON_TER",trackType:"protvista-track",label:"Non-terminal residue",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"The sequence is incomplete. The residue is not the terminal residue of the complete protein"},{name:"unsure",filter:"UNSURE",trackType:"protvista-track",label:"Sequence uncertainty",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Regions of a sequence for which the authors are unsure about the sequence assignment"},{name:"non_std",filter:"NON_STD",trackType:"protvista-track",label:"Non-standard residue",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Non-standard amino acids (selenocysteine and pyrrolysine)"}]},{name:"STRUCTURAL",label:"Structural features",trackType:"protvista-track",tracks:[{name:"helix",label:"Helix",filter:"HELIX",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"The positions of experimentally determined helical regions"},{name:"strand",label:"Beta strand",filter:"STRAND",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"The positions of experimentally determined beta strands"},{name:"turn",label:"Turn",filter:"TURN",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"The positions of experimentally determined hydrogen-bonded turns"},{name:"coiled",label:"Coiled coil",filter:"COILED",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Coiled coils are built by two or more alpha-helices that wind around each other to form a supercoil"}]},{name:"STRUCTURE_COVERAGE",label:"PDBe 3D structure coverage",trackType:"protvista-track",tracks:[{name:"pdbe_cover",label:"PDBe coverage",trackType:"protvista-track",tooltip:"PDBe 3D structure coverage",data:[{adapter:"protvista-structure-adapter",url:"https://www.ebi.ac.uk/proteins/api/proteins/{accession}"}]}]},{name:"TOPOLOGY",label:"Topology",trackType:"protvista-track",tracks:[{name:"topo_dom",label:"Topological domain",filter:"TOPO_DOM",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Location of non-membrane regions of membrane-spanning proteins"},{name:"transmem",label:"Transmembrane",filter:"TRANSMEM",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Extent of a membrane-spanning region"},{name:"intramem",label:"Intramembrane",filter:"INTRAMEM",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Extent of a region located in a membrane without crossing it"}]},{name:"MUTAGENESIS",label:"Mutagenesis",trackType:"protvista-track",tracks:[{name:"mutagen",label:"Mutagenesis",filter:"MUTAGEN",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Site which has been experimentally altered by mutagenesis"},{name:"othermutagen",label:"Other Mutagenesis",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/mutagenesis/{accession}"}],tooltip:"Site which has been experimentally altered by mutagenesis"}]},{name:"PROTEOMICS",label:"Proteomics",trackType:"protvista-track",adapter:"protvista-proteomics-adapter",urls:["https://www.ebi.ac.uk/proteins/api/proteomics/{accession}","https://www.ebi.ac.uk/proteins/api/proteomics-ptm/{accession}"],tracks:[{name:"unique",label:"Unique peptide",filter:"unique",trackType:"protvista-track",data:[{adapter:"protvista-proteomics-adapter",url:"https://www.ebi.ac.uk/proteins/api/proteomics/{accession}"}],tooltip:""},{name:"non_unique",label:"Non-unique peptide",filter:"non_unique",trackType:"protvista-track",data:[{adapter:"protvista-proteomics-adapter",url:"https://www.ebi.ac.uk/proteins/api/proteomics/{accession}"}],tooltip:""},{name:"proteomics-ptm",label:"PTM",trackType:"protvista-track",data:[{adapter:"protvista-proteomics-adapter",url:"https://www.ebi.ac.uk/proteins/api/proteomics-ptm/{accession}"}],tooltip:""}]},{name:"ANTIGEN",label:"Antigenic sequences",trackType:"protvista-track",tracks:[{name:"antigen",label:"Antibody binding sequences",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/antigen/{accession}"}],tooltip:""}]},{name:"VARIATION",label:"Variants",trackType:"protvista-variation-graph",tracks:[{name:"variation",filterComponent:"protvista-filter",trackType:"protvista-variation",data:[{adapter:"protvista-variation-adapter",url:"https://www.ebi.ac.uk/proteins/api/variation/{accession}"}],tooltip:"Natural variant of the protein, including polymorphisms, variations between strains, isolates or cultivars, disease-associated mutations and RNA editing events"}]}],kH=[{type:"features",url:"https://www.ebi.ac.uk/proteins/api/features/"},{type:"variants",url:"https://www.ebi.ac.uk/proteins/api/variation/"},{type:"antigens",url:"https://www.ebi.ac.uk/proteins/api/antigen/"},{type:"proteomics",url:"https://www.ebi.ac.uk/proteins/api/proteomics/"}];var BH={categories:FH,download:kH},LH=globalThis&&globalThis.__awaiter||function(e,t,r,n){function a(i){return i instanceof r?i:new r(function(o){o(i)})}return new(r||(r=Promise))(function(i,o){function s(c){try{l(n.next(c))}catch(d){o(d)}}function u(c){try{l(n.throw(c))}catch(d){o(d)}}function l(c){c.done?i(c.value):a(c.value).then(s,u)}l((n=n.apply(e,t||[])).next())})};const xb=new Map,D4=(e,t=new Headers({accept:"application/json"}))=>{const r=xb.get(e);if(r)return r;const n=(()=>LH(void 0,void 0,void 0,function*(){const a=yield window.fetch(e,{headers:t});if(!a.ok)throw new Error(`Request Failed: Status = ${a.status}; URI = ${e}; Time = ${new Date}`);return a.status===204?{payload:null,headers:a.headers}:{payload:yield a.json(),headers:a.headers}}))();return xb.set(e,n),n.catch(()=>xb.delete(e)),n};typeof window!="undefined"&&function(){window.console=window.console||{};for(var e=window.console,t,r,n={},a=function(){},i="memory".split(","),o="assert,clear,count,debug,dir,dirxml,error,exception,group,groupCollapsed,groupEnd,info,log,markTimeline,profile,profiles,profileEnd,show,table,time,timeEnd,timeline,timelineEnd,timeStamp,trace,warn".split(",");t=i.pop();)e[t]||(e[t]=n);for(;r=o.pop();)e[r]||(e[r]=a)}();typeof window.HTMLCanvasElement!="undefined"&&!window.HTMLCanvasElement.prototype.toBlob&&Object.defineProperty(window.HTMLCanvasElement.prototype,"toBlob",{value:function(e,t,r){for(var n=window.atob(this.toDataURL(t,r).split(",")[1]),a=n.length,i=a>>2,o=new Uint8Array(a),s=new Uint32Array(o.buffer,0,i),u=0,l=0;l<i;l++)s[l]=n.charCodeAt(u++)|n.charCodeAt(u++)<<8|n.charCodeAt(u++)<<16|n.charCodeAt(u++)<<24;for(var c=a&3;c--;)o[u]=n.charCodeAt(u++);e(new window.Blob([o],{type:t||"image/png"}))}});Math.cbrt=Math.cbrt||function(e){var t=Math.pow(Math.abs(e),.3333333333333333);return e<0?-t:t};Math.sign||(Math.sign=function(e){return e=+e,e===0||isNaN(e)?Number(e):e>0?1:-1});Number.isInteger||(Number.isInteger=function(t){return typeof t=="number"&&isFinite(t)&&t>-9007199254740992&&t<9007199254740992&&Math.floor(t)===t});Number.isNaN||(Number.isNaN=function(t){return t!==t});Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:function(e){if(e==null)throw new TypeError("Cannot convert first argument to object");for(var t=Object(e),r=!1,n,a=1;a<arguments.length;a++){var i=arguments[a];if(i!=null){for(var o=Object.keys(Object(i)),s=0,u=o.length;s<u;s++){var l=o[s];try{var c=Object.getOwnPropertyDescriptor(i,l);c!==void 0&&c.enumerable&&(t[l]=i[l])}catch(d){r||(r=!0,n=d)}}if(r)throw n}}return t}});String.prototype.startsWith||function(){var e=function(){var n;try{var a={},i=Object.defineProperty;n=i(a,a,a)&&i}catch{}return n}(),t={}.toString,r=function(n){if(this===null)throw TypeError();var a=String(this);if(n&&t.call(n)==="[object RegExp]")throw TypeError();var i=a.length,o=String(n),s=o.length,u=arguments.length>1?arguments[1]:void 0,l=u?Number(u):0;Number.isNaN(l)&&(l=0);var c=Math.min(Math.max(l,0),i);if(s+c>i)return!1;for(var d=-1;++d<s;)if(a.charCodeAt(c+d)!==o.charCodeAt(d))return!1;return!0};e?e(String.prototype,"startsWith",{value:r,configurable:!0,writable:!0}):String.prototype.startsWith=r}();String.prototype.endsWith||(String.prototype.endsWith=function(e,t){var r=this.toString();(typeof t!="number"||!isFinite(t)||Math.floor(t)!==t||t>r.length)&&(t=r.length),t-=e.length;var n=r.indexOf(e,t);return n!==-1&&n===t});String.prototype.repeat||(String.prototype.repeat=function(e){if(this===null)throw new TypeError("can't convert "+this+" to object");var t=""+this;if(e=+e,Number.isNaN(e)&&(e=0),e<0)throw new RangeError("repeat count must be non-negative");if(e===1/0)throw new RangeError("repeat count must be less than infinity");if(e=Math.floor(e),t.length===0||e===0)return"";if(t.length*e>=1<<28)throw new RangeError("repeat count must not overflow maximum string size");for(var r="";(e&1)===1&&(r+=t),e>>>=1,e!==0;)t+=t;return r});String.prototype.includes||(String.prototype.includes=function(e,t){return typeof t!="number"&&(t=0),t+e.length>this.length?!1:this.indexOf(e,t)!==-1});Array.prototype.includes||(Array.prototype.includes=function(e){if(this==null)throw new TypeError("Array.prototype.includes called on null or undefined");var t=Object(this),r=parseInt(t.length,10)||0;if(r===0)return!1;var n=parseInt(arguments[1],10)||0,a;n>=0?a=n:(a=r+n,a<0&&(a=0));for(var i;a<r;){if(i=t[a],e===i||Number.isNaN(e)&&Number.isNaN(i))return!0;a++}return!1});Array.from||(Array.from=function(){var e=Object.prototype.toString,t=function(i){return typeof i=="function"||e.call(i)==="[object Function]"},r=function(i){var o=Number(i);return isNaN(o)?0:o===0||!isFinite(o)?o:(o>0?1:-1)*Math.floor(Math.abs(o))},n=Math.pow(2,53)-1,a=function(i){var o=r(i);return Math.min(Math.max(o,0),n)};return function(o){var s=this,u=Object(o);if(o==null)throw new TypeError("Array.from requires an array-like object - not null or undefined");var l=arguments.length>1?arguments[1]:void 0,c;if(typeof l!="undefined"){if(!t(l))throw new TypeError("Array.from: when provided, the second argument must be a function");arguments.length>2&&(c=arguments[2])}for(var d=a(u.length),f=t(s)?Object(new s(d)):new Array(d),p=0,h;p<d;)h=u[p],l?f[p]=typeof c=="undefined"?l(h,p):l.call(c,h,p):f[p]=h,p+=1;return f.length=d,f}}());typeof window!="undefined"&&function(){for(var e=0,t=["ms","moz","webkit","o"],r=0;r<t.length&&!window.requestAnimationFrame;++r)window.requestAnimationFrame=window[t[r]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[r]+"CancelAnimationFrame"]||window[t[r]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(n){var a=new Date().getTime(),i=Math.max(0,16-(a-e)),o=window.setTimeout(function(){var s=a+i;n(s)},i);return e=a+i,o}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(n){clearTimeout(n)})}();Function.prototype.name===void 0&&Object.defineProperty!==void 0&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*(\S*)\s*\(/)[1]}});typeof window!="undefined"&&(window.performance===void 0&&(window.performance={}),window.performance.now===void 0&&function(){var e=Date.now();window.performance.now=function(){return Date.now()-e}}());Object.defineProperty!==void 0&&(Number.MAX_SAFE_INTEGER===void 0&&Object.defineProperty(Number,"MAX_SAFE_INTEGER",{enumerable:!1,configurable:!1,writable:!1,value:Math.pow(2,53)-1}),Number.MIN_SAFE_INTEGER===void 0&&Object.defineProperty(Number,"MIN_SAFE_INTEGER",{enumerable:!1,configurable:!1,writable:!1,value:-(Math.pow(2,53)-1)}));Object.entries||(Object.entries=function(e){for(var t=Object.keys(e),r=t.length,n=new Array(r);r--;)n[r]=[t[r],e[t[r]]];return n});Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(e){if(this==null)throw TypeError('"this" is null or not defined');var t=Object(this),r=t.length>>>0;if(typeof e!="function")throw TypeError("predicate must be a function");for(var n=arguments[1],a=0;a<r;){var i=t[a];if(e.call(n,i,a,t))return i;a++}},configurable:!0,writable:!0});Array.prototype.fill||Object.defineProperty(Array.prototype,"fill",{value:function(e){if(this==null)throw new TypeError("this is null or not defined");for(var t=Object(this),r=t.length>>>0,n=arguments[1],a=n>>0,i=a<0?Math.max(r+a,0):Math.min(a,r),o=arguments[2],s=o===void 0?r:o>>0,u=s<0?Math.max(r+s,0):Math.min(s,r);i<u;)t[i]=e,i++;return t}});Array.prototype.copyWithin||Object.defineProperty(Array.prototype,"copyWithin",{value:function(e,t){if(this==null)throw new TypeError("this is null or not defined");var r=Object(this),n=r.length>>>0,a=e>>0,i=a<0?Math.max(n+a,0):Math.min(a,n),o=t>>0,s=o<0?Math.max(n+o,0):Math.min(o,n),u=arguments[2],l=u===void 0?n:u>>0,c=l<0?Math.max(n+l,0):Math.min(l,n),d=Math.min(c-s,n-i),f=1;for(s<i&&i<s+d&&(f=-1,s+=d-1,i+=d-1);d>0;)s in r?r[i]=r[s]:delete r[i],s+=f,i+=f,d--;return r},configurable:!0,writable:!0});Int8Array.prototype.copyWithin||Object.defineProperty(Int8Array.prototype,"copyWithin",{value:Array.prototype.copyWithin});Int16Array.prototype.copyWithin||Object.defineProperty(Int16Array.prototype,"copyWithin",{value:Array.prototype.copyWithin});Int32Array.prototype.copyWithin||Object.defineProperty(Int32Array.prototype,"copyWithin",{value:Array.prototype.copyWithin});Uint8Array.prototype.copyWithin||Object.defineProperty(Uint8Array.prototype,"copyWithin",{value:Array.prototype.copyWithin});Uint16Array.prototype.copyWithin||Object.defineProperty(Uint16Array.prototype,"copyWithin",{value:Array.prototype.copyWithin});Uint32Array.prototype.copyWithin||Object.defineProperty(Uint32Array.prototype,"copyWithin",{value:Array.prototype.copyWithin});Float32Array.prototype.copyWithin||Object.defineProperty(Float32Array.prototype,"copyWithin",{value:Array.prototype.copyWithin});Float64Array.prototype.copyWithin||Object.defineProperty(Float64Array.prototype,"copyWithin",{value:Array.prototype.copyWithin});var ka;(function(e){function t(a){return a}e.create=t;function r(a,i){return(a&i)!==0}e.has=r;function n(a,i){return!!i&&(a&i)===i}e.hasAll=n})(ka||(ka={}));var Dr;(function(e){function t(x){return x===void 0&&(x=512),{current:[],offset:0,capacity:x,chunks:[]}}e.create=t;function r(x){return x.chunks.length?(x.offset>0&&(x.chunks[x.chunks.length]=x.current.length===x.offset?x.current.join(""):x.current.slice(0,x.offset).join("")),x.chunks.join("")):x.current.length===x.offset?x.current.join(""):x.current.splice(0,x.offset).join("")}e.getString=r;function n(x){for(var S=0,_=0,A=x.chunks;_<A.length;_++){var T=A[_];S+=T.length}for(var I=0;I<x.offset;I++)S+=x.current[I].length;return S}e.getSize=n;function a(x){return x.offset>0&&(x.current.length===x.offset?x.chunks[x.chunks.length]=x.current.join(""):x.chunks[x.chunks.length]=x.current.slice(0,x.offset).join(""),x.offset=0),x.chunks}e.getChunks=a;var i=[];(function(){for(var x="",S=0;S<512;S++)i[S]=x,x=x+" "})();function o(x){c(x,`
`)}e.newline=o;function s(x,S){S>0&&c(x,i[S])}e.whitespace=s;function u(x){c(x," ")}e.whitespace1=u;function l(x,S){!S||(x.offset===x.capacity&&(x.chunks[x.chunks.length]=x.current.join(""),x.offset=0),x.current[x.offset++]=S)}e.write=l;function c(x,S){x.offset===x.capacity&&(x.chunks[x.chunks.length]=x.current.join(""),x.offset=0),x.current[x.offset++]=S}e.writeSafe=c;function d(x,S,_){if(!S){s(x,_);return}var A=_-S.length;s(x,A),c(x,S)}e.writePadLeft=d;function f(x,S,_){if(!S){s(x,_);return}var A=_-S.length;c(x,S),s(x,A)}e.writePadRight=f;function p(x,S){c(x,""+S)}e.writeInteger=p;function h(x,S){c(x,""+S+" ")}e.writeIntegerAndSpace=h;function v(x,S,_){var A=""+S,T=_-A.length;s(x,T),c(x,A)}e.writeIntegerPadLeft=v;function m(x,S,_){var A=""+S,T=_-A.length;c(x,A),s(x,T)}e.writeIntegerPadRight=m;function g(x,S,_){c(x,""+Math.round(_*S)/_)}e.writeFloat=g;function y(x,S,_,A){var T=""+Math.round(_*S)/_,I=A-T.length;s(x,I),c(x,T)}e.writeFloatPadLeft=y;function b(x,S,_,A){var T=""+Math.round(_*S)/_,I=A-T.length;c(x,T),s(x,I)}e.writeFloatPadRight=b})(Dr||(Dr={}));var xn=function(){if(typeof window!="undefined"&&window.performance){var e=window.performance;return function(){return e.now()}}else return typeof process!="undefined"&&process.hrtime!=="undefined"&&typeof process.hrtime=="function"?function(){var t=process.hrtime();return t[0]*1e3+t[1]/1e6}:Date.now?function(){return Date.now()}:function(){return+new Date}}();function C0(e,t){if(t===void 0&&(t=!0),isNaN(e))return"n/a";for(var r=Math.floor(e/(60*60*1e3)),n=Math.floor(e/(60*1e3)%60),a=Math.floor(e/1e3%60),i=Math.floor(e%1e3).toString();i.length<3;)i="0"+i;for(;!t&&i.length>1&&i[i.length-1]==="0";)i=i.substr(0,i.length-1);return r>0?r+"h"+n+"m"+a+"."+i+"s":n>0?n+"m"+a+"."+i+"s":a>0?a+"."+i+"s":e.toFixed(0)+"ms"}var un;(function(e){var t=typeof btoa!="undefined"?btoa:function(o){return Buffer.from(o).toString("base64")},r=[];function n(){for(var o=+new Date+xn(),s=0;s<16;s++)r[s]=String.fromCharCode((o+Math.random()*255)%255|0),o=Math.floor(o/255);return t(r.join("")).replace(/\+/g,"-").replace(/\//g,"_").substr(0,22)}e.create22=n;function a(){var o=+new Date+xn(),s="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(u){var l=(o+Math.random()*16)%16|0;return o=Math.floor(o/16),(u==="x"?l:l&3|8).toString(16)});return s}e.createv4=a;function i(o){return typeof o=="string"}e.is=i})(un||(un={}));function NH(e,t){return e-t}function UH(e){return Array.prototype.sort.call(e,NH),e}var R4;(function(e){var t=function(){function p(){this.size=0}return p.prototype.has=function(h){return!1},p.prototype.forEach=function(h,v){return v},p}(),r=function(){function p(h){this.idx=h,this.size=1}return p.prototype.has=function(h){return h===this.idx},p.prototype.forEach=function(h,v){return h(this.idx,v),v},p}(),n=function(){function p(h,v){this.mask=h,this.size=v,this.length=h.length}return p.prototype.has=function(h){return h<this.length&&!!this.mask[h]},p.prototype._forEach=function(h,v){for(var m=0;m<this.length;m++)this.mask[m]&&h(m,v)},p.prototype.forEach=function(h,v){return this._forEach(h,v),v},p}(),a=function(){function p(h){this.size=h}return p.prototype.has=function(h){return!0},p.prototype._forEach=function(h,v){for(var m=0;m<this.size;m++)h(m,v)},p.prototype.forEach=function(h,v){return this._forEach(h,v),v},p}(),i=function(){function p(h){this.set=h,this._flat=void 0,this.size=h.size}return p.prototype.has=function(h){return this.set.has(h)},p.prototype._forEach=function(h,v){for(var m=0,g=this.flatten();m<g.length;m++){var y=g[m];h(y,v)}},p.prototype.flatten=function(){if(this._flat)return this._flat;var h=new Int32Array(this.size),v=0;return this.set.forEach(function(m){return h[v++]=m}),UH(h),this._flat=h,this._flat},p.prototype.forEach=function(h,v){return this._forEach(h,v),v},p}();function o(p){return new a(p)}e.always=o,e.never=new t;function s(p){return new i(p)}e.ofSet=s;function u(p){return new r(p)}e.singleton=u;function l(p){var h=p.length;if(h===0)return new t;if(h===1)return new r(p[0]);for(var v=0,m=0,g=p;m<g.length;m++){var y=g[m];y>v&&(v=y)}if(h===v)return new a(h);var b=h/v;if(b<1/12){for(var x=new Set,S=0,_=p;S<_.length;S++){var y=_[S];x.add(y)}return new i(x)}for(var A=new Int8Array(v+1),T=0,I=p;T<I.length;T++){var y=I[T];A[y]=1}return new n(A,p.length)}e.ofUniqueIndices=l;function c(p,h){return new n(p,h)}e.ofMask=c;function d(p,h){for(var v=0,m=h;v<m.length;v++){var g=m[v];if(p.has(g))return!0}return!1}e.hasAny=d;function f(p,h){var v=0,m=0;if(h.forEach(function(b){p.has(b)||(v++,b>m&&(m=b))}),v/m<1/12){var g=new Set;return h.forEach(function(b){p.has(b)||g.add(b)}),s(g)}else{var y=new Uint8Array(m+1);return h.forEach(function(b){p.has(b)||(y[b]=1)}),c(y,v)}}e.complement=f})(R4||(R4={}));function ti(e,t){e===void 0&&(e=0),t===void 0&&(t=Number.MAX_SAFE_INTEGER);var r=e;return function(){var n=r;return r=(r+1)%t,n}}var Lh;(function(e){function t(n){return{ref:n}}e.create=t;function r(n,a){return n.ref=a,n}e.set=r})(Lh||(Lh={}));var zH=ti(0,2147483647),fc;(function(e){function t(n,a){return{id:zH(),version:0,value:n,metadata:a}}e.create=t;function r(n,a){return{id:n.id,version:n.version+1,value:a,metadata:n.metadata}}e.withValue=r})(fc||(fc={}));var k;(function(e){function t(i,o){return Lh.create(fc.create(i,o))}e.create=t;function r(i,o){return Lh.set(i,fc.withValue(i.ref,o))}e.update=r;function n(i,o){return Lh.set(i,o)}e.set=n;function a(i,o){return i.ref.value!==o?r(i,o):i}e.updateIfChanged=a})(k||(k={}));var ql=function(){};function ci(e,t){var r=e.length;if(r!==t.length)return!1;for(var n=0;n<r;n++)if(e[n]!==t[n])return!1;return!0}var QD=Object.prototype.hasOwnProperty;function ku(e,t){if(e===t)return!0;var r=Array.isArray(e),n=Array.isArray(t);if(r&&n){if(e.length!==t.length)return!1;for(var a=0;a<e.length;a++)if(!ku(e[a],t[a]))return!1;return!0}if(r!==n)return!1;if(e&&t&&typeof e=="object"&&typeof t=="object"){var i=Object.keys(e);if(i.length!==Object.keys(t).length)return!1;var o=e instanceof Date,s=t instanceof Date;if(o&&s)return e.getTime()===t.getTime();if(o!==s)return!1;var u=e instanceof RegExp,l=t instanceof RegExp;if(u&&l)return e.toString()===t.toString();if(u!==l)return!1;for(var a=0;a<i.length;a++)if(!QD.call(t,i[a]))return!1;for(var a=0;a<i.length;a++)if(!ku(e[i[a]],t[i[a]]))return!1;return!0}return!1}function Y0(e,t){if(e===t)return!0;var r=Array.isArray(e),n=Array.isArray(t);return r&&n?VH(e,t):r!==n?!1:e&&t&&typeof e=="object"&&typeof t=="object"?lp(e,t):!1}function lp(e,t){if(e===t)return!0;if(!e||!t)return!1;var r=Object.keys(e);if(Object.keys(t).length!==r.length)return!1;for(var n=0,a=r;n<a.length;n++){var i=a[n];if(!QD.call(e,i)||e[i]!==t[i])return!1}return!0}function VH(e,t){if(e===t)return!0;if(!e||!t||e.length!==t.length)return!1;for(var r=0,n=e.length;r<n;++r)if(e[r]!==t[r])return!1;return!0}function ia(e,t){return e!==void 0?e:t}function O4(e){return(e<10?"0":"")+e}function HH(e){var t=e.getHours(),r=e.getMinutes(),n=e.getSeconds();return t+":"+O4(r)+":"+O4(n)}var Nh=Math.PI/2,ZD=Math.PI/180;function Wr(e){return e*ZD}function Jo(e){return e/ZD}function GH(e){return e!==0&&(e&e-1)===0}function qH(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r=0,n=0,a=0,i=e.length;a<i;++a){var o=e[a],s=Math.abs(o);s>n&&(r=o,n=s)}return r}function JD(e,t){return e*t}function jH(e,t,r){return(e-t)/(r-t)}function Ka(e,t,r){return Math.max(t,Math.min(r,e))}function WH(e){return Ka(e,0,1)}function Gi(e,t,r){return e+(t-e)*r}function _0(e,t,r,n,a,i){var o=(r-e)*i,s=(n-t)*i,u=a*a,l=a*u;return(2*t-2*r+o+s)*l+(-3*t+3*r-2*o-s)*u+o*a+t}function Cb(e,t,r,n){var a=1-n;return a*a*e+2*a*n*t+n*n*r}function eR(e,t,r){return r=WH(jH(r,e,t)),r*r*(3-2*r)}function Ia(){return Ia.zero()}(function(e){function t(){var M=[.1,0,0];return M[0]=0,M}e.zero=t;function r(M,O,D){var F=t();return F[0]=M,F[1]=O,F[2]=D,F}e.create=r;function n(M,O){var D=it.toRgb(O),F=D[0],G=D[1],N=D[2],z=I(F,G,N),$=z[0],j=z[1],Z=z[2],q=116*j-16;return M[0]=q<0?0:q,M[1]=500*($-j),M[2]=200*(j-Z),M}e.fromColor=n;function a(M,O){return zs.toLab(M,O)}e.fromHcl=a;function i(M){var O=(M[0]+16)/116,D=isNaN(M[1])?O:O+M[1]/500,F=isNaN(M[2])?O:O-M[2]/200;O=v*_(O),D=h*_(D),F=m*_(F);var G=S(3.2404542*D-1.5371385*O-.4985314*F),N=S(-.969266*D+1.8760108*O+.041556*F),z=S(.0556434*D-.2040259*O+1.0572252*F);return it.fromRgb(Math.round(Ka(G,0,255)),Math.round(Ka(N,0,255)),Math.round(Ka(z,0,255)))}e.toColor=i;function o(M,O){var D=O[0],F=O[1],G=O[2],N=Math.sqrt(F*F+G*G),z=(Jo(Math.atan2(G,F))+360)%360;return Math.round(N*1e4)===0&&(z=Number.NaN),M[0]=z,M[1]=N,M[2]=D,M}e.toHcl=o;function s(M,O){return M[0]=O[0],M[1]=O[1],M[2]=O[2],M}e.copy=s;function u(M,O,D){return M[0]=O[0]-p*D,M[1]=O[1],M[2]=O[2],M}e.darken=u;function l(M,O,D){return u(M,O,-D)}e.lighten=l;var c=[0,0,0];function d(M,O,D){return o(c,O),zs.toLab(M,zs.saturate(c,c,D))}e.saturate=d;function f(M,O,D){return d(M,O,-D)}e.desaturate=f;var p=18,h=.95047,v=1,m=1.08883,g=.137931034,y=.206896552,b=.12841855,x=.008856452;function S(M){return 255*(M<=.00304?12.92*M:1.055*Math.pow(M,1/2.4)-.055)}function _(M){return M>y?M*M*M:b*(M-g)}function A(M){return(M/=255)<=.04045?M/12.92:Math.pow((M+.055)/1.055,2.4)}function T(M){return M>x?Math.pow(M,1/3):M/b+g}function I(M,O,D){M=A(M),O=A(O),D=A(D);var F=T((.4124564*M+.3575761*O+.1804375*D)/h),G=T((.2126729*M+.7151522*O+.072175*D)/v),N=T((.0193339*M+.119192*O+.9503041*D)/m);return[F,G,N]}})(Ia||(Ia={}));function zs(){return zs.zero()}(function(e){function t(){var m=[.1,0,0];return m[0]=0,m}e.zero=t;function r(m,g,y){var b=t();return b[0]=m,b[1]=g,b[2]=y,b}e.create=r;var n=[0,0,0];function a(m,g){return Ia.toHcl(m,Ia.fromColor(n,g))}e.fromColor=a;function i(m,g){return Ia.toHcl(m,g)}e.fromLab=i;var o=[0,0,0];function s(m){return Ia.toColor(u(o,m))}e.toColor=s;function u(m,g){var y=g[0],b=g[1],x=g[2];return isNaN(y)&&(y=0),y=Wr(y),m[0]=x,m[1]=Math.cos(y)*b,m[2]=Math.sin(y)*b,m}e.toLab=u;function l(m,g){return m[0]=g[0],m[1]=g[1],m[2]=g[2],m}e.copy=l;function c(m,g,y){return m[0]=g[0],m[1]=Math.max(0,g[1]+v*y),m[2]=g[2],m}e.saturate=c;function d(m,g,y){return c(m,g,-y)}e.desaturate=d;var f=[0,0,0];function p(m,g,y){return u(f,g),Ia.toHcl(m,Ia.darken(f,f,y))}e.darken=p;function h(m,g,y){return p(m,g,-y)}e.lighten=h;var v=18})(zs||(zs={}));function it(e){return e}(function(e){function t(I){return"rgb("+(I>>16&255)+", "+(I>>8&255)+", "+(I&255)+")"}e.toStyle=t;function r(I){return"0x"+("000000"+I.toString(16)).slice(-6)}e.toHexString=r;function n(I){return"RGB: "+e.toRgb(I).join(", ")}e.toRgbString=n;function a(I){return[I>>16&255,I>>8&255,I&255]}e.toRgb=a;function i(I){return[(I>>16&255)/255,(I>>8&255)/255,(I&255)/255]}e.toRgbNormalized=i;function o(I,M,O){return I<<16|M<<8|O}e.fromRgb=o;function s(I,M,O){return I*255<<16|M*255<<8|O*255}e.fromNormalizedRgb=s;function u(I,M){return o(I[M],I[M+1],I[M+2])}e.fromArray=u;function l(I,M){return s(I[M],I[M+1],I[M+2])}e.fromNormalizedArray=l;function c(I,M,O){return M[O]=I>>16&255,M[O+1]=I>>8&255,M[O+2]=I&255,M}e.toArray=c;function d(I,M,O){return M[O]=(I>>16&255)/255,M[O+1]=(I>>8&255)/255,M[O+2]=(I&255)/255,M}e.toArrayNormalized=d;function f(I,M){return I[0]=M>>16&255,I[1]=M>>8&255,I[2]=M&255,I}e.toVec3=f;function p(I,M){return I[0]=(M>>16&255)/255,I[1]=(M>>8&255)/255,I[2]=(M&255)/255,I}e.toVec3Normalized=p;function h(I,M,O){var D=I>>16&255,F=I>>8&255,G=I&255,N=M>>16&255,z=M>>8&255,$=M&255,j=D+(N-D)*O,Z=F+(z-F)*O,q=G+($-G)*O;return j<<16|Z<<8|q}e.interpolate=h;var v=[0,0,0];function m(I,M){return zs.fromColor(v,I),zs.toColor(zs.saturate(v,v,M))}e.saturate=m;function g(I,M){return m(I,-M)}e.desaturate=g;var y=[0,0,0];function b(I,M){return Ia.fromColor(y,I),Ia.toColor(Ia.darken(y,y,M))}e.darken=b;function x(I,M){return b(I,-M)}e.lighten=x;function S(I){return I<.04045?I*.0773993808:Math.pow(I*.9478672986+.0521327014,2.4)}function _(I){return s(S((I>>16&255)/255),S((I>>8&255)/255),S((I&255)/255))}e.sRGBToLinear=_;function A(I){return I<.0031308?I*12.92:1.055*Math.pow(I,.41666)-.055}function T(I){return s(A((I>>16&255)/255),A((I>>8&255)/255),A((I&255)/255))}e.linearToSRGB=T})(it||(it={}));function gr(e,t,r,n){return{label:e,description:r,list:n,type:t}}function Ay(e,t,r){var n={};for(var a in e){var i=e[a];i=it.saturate(i,t),i=it.darken(i,-r),n[a]=i}return n}function tR(e,t){return t===void 0&&(t=" "),e.replace(/([a-z\xE0-\xFF])([A-Z\xC0\xDF])/g,"$1"+t+"$2")}function Za(e){return Cp(tR(e))}var XH=function(e){return e.toUpperCase()};function YH(e){return e?typeof e=="string"?e.toUpperCase():(""+e).toUpperCase():""}function Cp(e){return e.toLowerCase().replace(/^\w|\s\w/g,XH)}function KH(e){return e.replace(/_/g," ")}function $H(e){return e.replace(/-/g," ")}function ji(e){return Cp(tR(KH($H(e))))}function Wn(e,t,r,n){var a=n.length;if(a>r-t)return!1;for(var i=0;i<a;i++)if(e.charCodeAt(t+i)!==n.charCodeAt(i))return!1;return!0}function QH(e,t){var r=Object.keys(t),n=Object.values(t);return new(Function.bind.apply(Function,Nt(Nt([void 0],r),["return `"+e+"`;"])))().apply(void 0,n)}function Zl(e){return e.replace(/<\/?[^>]+>/g,"")}var wi={"orange-red":gr("Orange-Red","sequential","Orange-Red, sequential color scheme from ColorBrewer 2.0",[16775148,16705736,16635038,16628612,16551257,15689032,14102559,11730944,8323072]),"purple-blue":gr("Purple-Blue","sequential","Purple-Blue, sequential color scheme from ColorBrewer 2.0",[16775163,15525874,13685222,10927579,7645647,3576e3,356528,285325,145496]),"blue-purple":gr("Blue-Purple","sequential","Blue-Purple, sequential color scheme from ColorBrewer 2.0",[16252157,14740724,12571622,10403034,9213638,9202609,8929693,8458108,5046347]),oranges:gr("Oranges","sequential","",[16774635,16705230,16634018,16625259,16616764,15821075,14239745,10892803,8333060]),"blue-green":gr("Blue-Green","sequential","",[16252157,15070713,13429990,10082505,6734500,4304502,2329413,27948,17435]),"yellow-orange-brown":gr("Yellow-Orange-Brown","sequential","",[16777189,16775100,16704401,16696399,16685353,15495188,13388802,10040324,6694150]),"yellow-green":gr("Yellow-Green","sequential","",[16777189,16252089,14282915,11394446,7915129,4303709,2327619,26679,17705]),reds:gr("Reds","sequential","",[16774640,16703698,16563105,16552562,16476746,15678252,13309981,10817301,6750221]),"red-purple":gr("Red-Purple","sequential","",[16775155,16638173,16565696,16424885,16214177,14496919,11403646,7995767,4784234]),greens:gr("Greens","sequential","",[16252149,15070688,13101504,10607003,7652470,4303709,2329413,27948,17435]),"yellow-green-blue":gr("Yellow-Green-Blue","sequential","",[16777177,15595697,13101492,8375739,4306628,1937856,2252456,2438292,531800]),purples:gr("Purples","sequential","",[16579581,15724021,14342891,12369372,10394312,8420794,6967715,5515151,4128893]),"green-blue":gr("Green-Blue","sequential","",[16252144,14742491,13429701,11066805,8113348,5157843,2854078,551084,540801]),greys:gr("Greys","sequential","",[16777215,15790320,14277081,12434877,9868950,7566195,5395026,2434341,0]),"yellow-orange-red":gr("Yellow-Orange-Red","sequential","",[16777164,16772512,16701814,16691788,16616764,16535082,14883356,12386342,8388646]),"purple-red":gr("Purple-Red","sequential","",[16250105,15196655,13941210,13210823,14640560,15149450,13505110,9961539,6750239]),blues:gr("Blues","sequential","",[16251903,14609399,13032431,10406625,7057110,4362950,2191797,545180,536683]),"purple-blue-green":gr("Purple-Blue-Green","sequential","",[16775163,15524592,13685222,10927579,6793679,3576e3,164234,93273,83510]),spectral:gr("Spectral","diverging","",[10355010,13975119,16018755,16625249,16703627,16777151,15136152,11263396,6734501,3311805,6180770]),"red-yellow-green":gr("Red-Yellow-Green","diverging","",[10813478,14102567,16018755,16625249,16703627,16777151,14282635,10934634,6733155,1742928,26679]),"red-blue":gr("Red-Blue","diverging","",[6750239,11671595,14049357,16033154,16636871,16250871,13755888,9618910,4428739,2188972,340065]),"pink-yellow-green":gr("Pink-Yellow-Green","diverging","",[9306450,12917629,14579630,15840986,16638191,16250871,15136208,12116358,8371265,5083681,2581529]),"purple-green":gr("Purple-Green","diverging","",[4194379,7744131,10055851,12756431,15193320,16250871,14282963,10935200,5942881,1800247,17435]),"red-yellow-blue":gr("Red-Yellow-Blue","diverging","Red-Yellow-Blue, diverging color scheme from ColorBrewer 2.0",[10813478,14102567,16018755,16625249,16703632,16777151,14742520,11262441,7646673,4552116,3225237]),"brown-white-green":gr("Brown-White-Green","diverging","",[5517317,9195786,12550445,14664317,16181443,16119285,13101797,8441281,3512207,91742,15408]),"red-grey":gr("Red-Grey","diverging","",[6750239,11671595,14049357,16033154,16636871,16777215,14737632,12237498,8882055,5066061,1710618]),"orange-purple":gr("Orange-Purple","diverging","",[8338184,11753478,14713364,16627811,16703670,16250871,14211819,11709394,8418220,5515144,2949195]),"set-2":gr("Set-2","qualitative","",[6734501,16551266,9281739,15174339,10934356,16767279,15058068,11776947]),accent:gr("Accent","qualitative","",[8374655,12496596,16629894,16777113,3697840,15729279,12540695,6710886]),"set-1":gr("Set-1","qualitative","",[14948892,3636920,5091146,9981603,16744192,16777011,10901032,16220607,10066329]),"set-3":gr("Set-3","qualitative","",[9294791,16777139,12499674,16482418,8434131,16626786,11787881,16567781,14277081,12353725,13429701,16772463]),"dark-2":gr("Dark-2","qualitative","",[1810039,14245634,7696563,15149450,6727198,15117058,10909213,6710886]),paired:gr("Paired","qualitative","",[10931939,2062516,11722634,3383340,16489113,14883356,16629615,16744192,13284054,6962586,16777113,11622696]),"pastel-2":gr("Pastel-2","qualitative","",[11789005,16633260,13358568,16042724,15136201,16773806,15852236,13421772]),"pastel-1":gr("Pastel-1","qualitative","",[16495790,11783651,13429701,14601188,16701862,16777164,15063229,16636652,15921906]),"many-distinct":gr("Many-Distinct","qualitative","",[1810039,14245634,7696563,15149450,6727198,15117058,10909213,6710886,14948892,3636920,5091146,9981603,16744192,16777011,10901032,16220607,10066329,6734501,16551266,9281739,15174339,10934356,16767279,15058068,11776947]),magma:gr("Magma","sequential","Perceptually uniform shades of black-red-white",[4329332,4853881,5378684,5903742,6363263,6888576,7413633,7938689,8463745,8988801,9513600,10038655,10563454,11088508,11613562,12138360,12728949,13254258,13714030,14239338,14699366,15094114,15489119,15753309,16017499,16216411,16350045,16483424,16551523,16619368,16621934,16689780,16692091,16694402,16696969,16633746,16636058,16638371,16575148,16577461,16514239]),inferno:gr("Inferno","sequential","Perceptually uniform shades of black-red-yellow",[4721514,5246316,5771373,6296430,6821486,7346542,7871597,8396651,8921450,9446504,9971557,10496610,10956127,11481435,12006486,12466258,12926285,13386056,13780802,14241085,14570295,14965297,15229227,15558693,15757342,15956248,16154897,16288267,16421638,16489734,16492043,16494612,16496926,16368426,16305463,16111429,15982678,15853928,15856253,16119953,16580260]),plasma:gr("Plasma","sequential","Perceptually uniform shades of blue-red-yellow",[1771148,2426257,3081365,3671193,4195228,4784799,5308834,5833124,6357158,6815911,7340200,7864744,8324007,8783782,9309348,9769377,10164126,10624154,11018902,11413393,11808141,12137352,12466307,12795519,13124730,13453685,13717361,14046573,14309992,14573668,14837344,15035483,15299159,15497299,15695438,15893834,16091974,16224833,16357693,16425017,16557877,16625457,16627245,16629289,16631334,16567845,16438820,16310052,16115494,15921190,15726625]),viridis:gr("Viridis","sequential","Perceptually uniform shades of blue-green-yellow",[4524123,4656994,4658793,4726127,4727668,4663929,4599933,4535937,4406404,4276870,4081800,3952010,3822475,3627148,3497356,3302029,3172237,3042446,2912654,2782862,2652814,2523022,2393229,2328973,2198924,2069132,2004874,2005897,2007175,2139525,2337154,2666111,3060348,3520376,4045684,4570991,5227369,5883748,6605661,7392854,8180303,8967495,9819967,10672695,11525166,12443174,13295646,14148121,15000344,15852828,16639780]),cividis:gr("Cividis","sequential","Perceptually uniform shades of blue-green-yellow, should look effectively identical to colorblind and non-colorblind users",[11367,12400,537456,1455727,2046574,2571629,3031404,3425388,3754092,4148075,4476779,4805227,5133932,5396844,5725549,5988462,6317166,6580079,6843249,7171698,7434867,7697781,7960951,8289656,8618104,8881272,9209976,9538679,9867127,10195830,10524533,10853235,11181938,11510640,11839343,12168045,12497002,12891240,13219941,13548642,13943134,14271834,14666326,14995025,15389516,15718470,16112703,16507190,16639799]),twilight:gr("Twilight","sequential","Perceptually uniform shades of white-blue-black-red-white, cyclic",[14670305,14211037,13554648,12766675,11847630,10993866,10139847,9351365,8628419,8036290,7509952,7048895,6718653,6519739,6386105,6252470,6184114,6181293,6112935,6044831,5976470,5777291,5447293,5052270,4592479,4067665,3674181,3281211,3150646,3543352,4067644,4657728,5379141,6166345,6953549,7741007,8463184,9120336,9777743,10304079,10830671,11291984,11687762,12083541,12348505,12613471,12878439,13077872,13211771,13411209,13545111,13809830,14074293,14338756,14537169,14735067,14801121]),turbo:gr("Turbo","sequential","Improved (smooth) rainbow colormap for visualization",[4866485,4872413,4354034,3770361,3120629,2667241,2475736,2611140,3073454,3928216,5109892,6487408,8126047,9829201,11531332,13167162,14605618,15780908,16693543,16753699,16748063,16741916,16146200,15026195,13644558,12198408,10818563,9833728]),rainbow:gr("Rainbow","sequential","",[3367393,3516485,16383744,15501073,12526114]),"red-white-blue":gr("Red-White-Blue","diverging","",[12526114,16777215,3367393])},ZH=Object.keys(wi),w_=ZH.map(function(e){return[e,wi[e].label,Cp(wi[e].type)]}),JH=w_.filter(function(e){return wi[e[0]].type==="diverging"||wi[e[0]].type==="sequential"}),eG=w_.filter(function(e){return wi[e[0]].type==="qualitative"});function To(e){return e in wi?wi[e]:(console.warn("unknown color list named '"+e+"'"),wi["red-yellow-blue"])}function Pc(e){return{kind:"table-legend",table:e}}function tG(e,t,r){return{kind:"scale-legend",minLabel:e,maxLabel:t,colors:r}}var je;(function(e){function t(f){return f.creator&&f.chunkSize}e.is=t;function r(f){var p=f.growBy*f.elementSize;f.currentSize=p,f.currentIndex=0,f.currentChunk=new f.ctor(p),f.allocatedSize+=p,f.chunks[f.chunks.length]=f.currentChunk}function n(f,p,h,v,m){f.currentIndex>=f.currentSize&&r(f);var g=f.currentChunk,y=f.currentIndex;return g[y]=p,g[y+1]=h,g[y+2]=v,g[y+3]=m,f.currentIndex+=4,f.elementCount++}e.add4=n;function a(f,p,h,v){f.currentIndex>=f.currentSize&&r(f);var m=f.currentChunk,g=f.currentIndex;return m[g]=p,m[g+1]=h,m[g+2]=v,f.currentIndex+=3,f.elementCount++}e.add3=a;function i(f,p,h){f.currentIndex>=f.currentSize&&r(f);var v=f.currentChunk,m=f.currentIndex;return v[m]=p,v[m+1]=h,f.currentIndex+=2,f.elementCount++}e.add2=i;function o(f,p){return f.currentIndex>=f.currentSize&&r(f),f.currentChunk[f.currentIndex]=p,f.currentIndex+=1,f.elementCount++}e.add=o;function s(f,p,h){for(var v=0;v<p;v++)f.currentIndex>=f.currentSize&&r(f),f.currentChunk[f.currentIndex++]=h,f.elementCount++;return f.elementCount}e.addRepeat=s;function u(f,p){for(var h=f.elementSize,v=0,m=p.length;v<m;v+=h){f.currentIndex>=f.currentSize&&r(f);for(var g=f.currentChunk,y=0;y<h;y++)g[f.currentIndex++]=p[v+y];f.elementCount++}return f.elementCount}e.addMany=u;function l(f,p){return p===void 0&&(p=!1),c(f,p)}e.compact=l;function c(f,p){var h=f.ctor,v=f.chunks,m=f.currentIndex;if(!v.length)return new h(0);if(v.length===1&&(p||m===f.allocatedSize))return v[0];for(var g=0,y=0,b=v.length-1;y<b;y++)g+=v[y].length;g+=f.currentIndex;var x=new h(g),S=0;if(x.buffer)for(var y=0,b=v.length-1;y<b;y++)x.set(v[y],S),S+=v[y].length;else for(var y=0,b=v.length-1;y<b;y++){for(var _=v[y],A=0,T=_.length;A<T;A++)x[S+A]=_[A];S+=_.length}var I=v[v.length-1];if(x.buffer&&m>=f.currentSize)x.set(I,S);else for(var A=0,T=I.length;A<T;A++)x[S+A]=I[A];return x}e._compact=c;function d(f,p,h,v){var m={ctor:f,elementSize:p,growBy:Math.max(1,Math.ceil(h)),allocatedSize:0,elementCount:0,currentSize:0,currentChunk:void 0,currentIndex:0,chunks:[]};if(typeof v=="undefined")return m;if(typeof v=="number")return m.currentChunk=new f(v*p),m.allocatedSize=v*p,m.currentSize=m.currentChunk.length,m.chunks[0]=m.currentChunk,m;var g=v;if(g.length%p!==0)throw new Error("initialChunk length must be a multiple of the element size.");return m.currentChunk=g,m.allocatedSize=g.length,m.currentSize=g.length,m.chunks[0]=g,m}e.create=d})(je||(je={}));function K0(e,t,r){return e[t]-e[r]}function ld(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function rR(e,t,r,n){var a=r+n>>1;return t(e,r,n)>0?t(e,r,a)>0?t(e,a,n)>0?a:n:r:t(e,n,a)>0?t(e,a,r)>0?a:r:n}function rG(e,t,r){var n=e.cmp,a=e.swap,i=e.data,o=e.parts,s=t+1,u=r;for(a(i,t,rR(i,n,t,r));n(i,u,t)>0;)--u;for(var l=t+1;l<=u;l++){var c=n(i,l,t);if(c>0){for(a(i,l,u),--u;n(i,u,t)>0;)--u;l--}else c===0&&(a(i,l,s),s++)}for(var l=t;l<s;l++)a(i,l,t+u-l);o[0]=u-s+t+1,o[1]=u}function nG(e,t,r){for(var n=e.data,a=e.cmp,i=e.swap,o=t+1;o<=r;o++)for(var s=o-1;s>=t&&a(n,s,s+1)>0;)i(n,s,s+1),s=s-1}function $0(e,t,r){for(var n=e.parts;t<r;){if(r-t<16){nG(e,t,r);return}rG(e,t,r);var a=n[0],i=n[1];a-t<r-i?($0(e,t,a-1),t=i+1):($0(e,i+1,r),r=a-1)}}function aG(e,t,r,n){var a=r+1,i=n;ld(e,r,rR(e,K0,r,n));for(var o=e[r];e[i]>o;)--i;for(var s=r+1;s<=i;s++){var u=e[s];if(u>o){for(ld(e,s,i),--i;e[i]>o;)--i;s--}else u===o&&(ld(e,s,a),++a)}for(var s=r;s<a;s++)ld(e,s,r+i-s);t[0]=i-a+r+1,t[1]=i}function iG(e,t,r){for(var n=t+1;n<=r;n++){for(var a=e[n],i=n-1;i>=t&&e[i]>a;)e[i+1]=e[i],i=i-1;e[i+1]=a}}function qS(e,t,r,n){for(;r<n;){if(n-r<16){iG(e,r,n);return}aG(e,t,r,n);var a=t[0],i=t[1];a-r<n-i?(qS(e,t,r,a-1),r=i+1):(qS(e,t,i+1,n),n=a-1)}}function es(e,t){return t===void 0&&(t=K0),oG(e,0,e.length,t)}function oG(e,t,r,n){return n===void 0&&(n=K0),n===K0?qS(e,[0,0],t,r-1):$0({data:e,cmp:n,swap:ld,parts:[0,0]},t,r-1),e}function nR(e,t,r,n,a){var i={data:e,cmp:n,swap:a,parts:[0,0]};return $0(i,t,r-1),e}function sG(e,t,r){return e[t].key<e[r].key?-1:1}function uG(e,t,r,n,a){for(var i=new Map,o=[],s=t(e[0]),u=!0,l=n;l<a;l++){var c=t(e[l]);if(i.has(c))i.get(c).count++,s!==c&&(u=!1);else{var d={key:c,count:1,offset:l};i.set(c,d),o[o.length]=d}s=c}var f=new Int32Array(o.length+1);f[o.length]=a;var p=!0;if(r){for(var l=1,h=o.length;l<h;l++)if(o[l-1].key>o[l].key){p=!1;break}}if(u&&p){for(var l=0;l<o.length;l++)f[l]=o[l].offset;return f}r&&!p&&nR(o,0,o.length,sG,ld);for(var v=0,l=0;l<o.length;l++){var m=o[l];m.offset=v,v+=m.count}for(var g=new Int32Array(a-n),l=n;l<a;l++){var c=t(e[l]),d=i.get(c);g[d.offset++]=e[l]}for(var l=0,h=g.length;l<h;l++)e[l+n]=g[l];f[0]=n;for(var l=1;l<o.length;l++)f[l]=o[l-1].offset+n;return f}function _b(e,t,r){var n=r&&r.start||0,a=r&&r.end||e.length;if(a-n<=0)throw new Error("Can only bucket non-empty collections.");return uG(e,t,!!(r&&r.sort),n,a)}var lG=function(){function e(t,r){this.getHash=t,this.areEqual=r,this.id=0,this.byHash=new Map,this.groups=[]}return e.prototype.createGroup=function(t,r){var n=this.id++,a=[t];return this.groups[n]=a,{id:n,keys:a,value:r}},e.prototype.add=function(t,r){var n=this.getHash(r);if(this.byHash.has(n)){for(var a=this.byHash.get(n),i=0,o=a.length;i<o;i++){var s=a[i];if(this.areEqual(r,s.value))return s.keys[s.keys.length]=t,s.value}var u=this.createGroup(t,r);return a[a.length]=u,u.value}else{var u=this.createGroup(t,r);return this.byHash.set(n,[u]),u.value}},e}();function cG(e,t){return new lG(e,t)}function aR(e){var t=e^e>>4;return t=(t^3735928559)+(t<<5),t=t^t>>11,t}function jd(e,t){var r=23;return r=31*r+e|0,r=31*r+t|0,r=r^r>>4,r=(r^3735928559)+(r<<5),r=r^r>>11,r}function dG(e,t,r){var n=23;return n=31*n+e|0,n=31*n+t|0,n=31*n+r|0,n=n^n>>4,n=(n^3735928559)+(n<<5),n=n^n>>11,n}function fG(e,t,r,n){var a=23;return a=31*a+e|0,a=31*a+t|0,a=31*a+r|0,a=31*a+n|0,a=a^a>>4,a=(a^3735928559)+(a<<5),a=a^a>>11,a}function A_(e){for(var t=0,r=0,n=e.length;r<n;r++)t=(t<<5)-t+e.charCodeAt(r++)|0;return t}function oc(e,t){return(e+t)*(e+t+1)/2+t}function Ja(e){for(var t=2166136261,r=0,n=e.length;r<n;++r)t^=e[r],t+=(t<<1)+(t<<4)+(t<<7)+(t<<8)+(t<<24);return t>>>0}function Q0(e,t){var r=t&&typeof t.start!="undefined"?Math.max(Math.min(t.start,e-1),0):0,n=t&&typeof t.end!="undefined"?Math.min(t.end,e):e;return{start:r,end:n}}function Ev(e,t){var r=t&&typeof t.array!="undefined"?t.array:Array,n=Q0(e,t),a=n.start,i=n.end;return{array:new r(i-a),start:a,end:i}}function pG(e,t,r){for(var n=0,a=t.length;n<a;n++)t[n]=e(r+n);return t}function Ta(e,t,r){var n=Ev(e,r),a=n.array,i=n.start;return pG(t,a,i)}function P_(e){return!!e.buffer&&typeof e.byteLength=="number"&&typeof e.BYTES_PER_ELEMENT=="number"}function Z0(e,t){var r=e.constructor,n=e.buffer,a=e.length,i=e.byteOffset,o=e.BYTES_PER_ELEMENT,s=Q0(a,t),u=s.start,l=s.end;return u===0&&l===a?e:new r(n,i+o*u,Math.min(a,l-u))}var fn=1e-6;function cn(e,t,r){return Math.abs(e-t)<=r}function ue(){return ue.zero()}(function(e){function t(){var R=[.1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];return R[0]=0,R}e.zero=t;function r(){var R=t();return R[0]=1,R[1]=0,R[2]=0,R[3]=0,R[4]=0,R[5]=1,R[6]=0,R[7]=0,R[8]=0,R[9]=0,R[10]=1,R[11]=0,R[12]=0,R[13]=0,R[14]=0,R[15]=1,R}e.identity=r;function n(R){return R[0]=1,R[1]=0,R[2]=0,R[3]=0,R[4]=0,R[5]=1,R[6]=0,R[7]=0,R[8]=0,R[9]=0,R[10]=1,R[11]=0,R[12]=0,R[13]=0,R[14]=0,R[15]=1,R}e.setIdentity=n;function a(R){for(var V=0;V<16;V++)R[V]=0;return R}e.setZero=a;function i(R){for(var V=t(),pe=0;pe<4;pe++)for(var _e=R[pe],Ee=0;Ee<4;Ee++)V[4*Ee+pe]=_e[Ee];return V}e.ofRows=i;var o=r();function s(R,V){return l(R,o,typeof V=="undefined"?fn:V)}e.isIdentity=s;function u(R){for(var V=0;V<16;V++)if(isNaN(R[V]))return!0;return!1}e.hasNaN=u;function l(R,V,pe){for(var _e=0;_e<16;_e++)if(Math.abs(R[_e]-V[_e])>pe)return!1;return!0}e.areEqual=l;function c(R,V,pe,_e){R[4*pe+V]=_e}e.setValue=c;function d(R,V,pe){return R[4*pe+V]}e.getValue=d;function f(R,V,pe){return V[pe+0]=R[0],V[pe+1]=R[1],V[pe+2]=R[2],V[pe+3]=R[3],V[pe+4]=R[4],V[pe+5]=R[5],V[pe+6]=R[6],V[pe+7]=R[7],V[pe+8]=R[8],V[pe+9]=R[9],V[pe+10]=R[10],V[pe+11]=R[11],V[pe+12]=R[12],V[pe+13]=R[13],V[pe+14]=R[14],V[pe+15]=R[15],V}e.toArray=f;function p(R,V,pe){return R[0]=V[pe+0],R[1]=V[pe+1],R[2]=V[pe+2],R[3]=V[pe+3],R[4]=V[pe+4],R[5]=V[pe+5],R[6]=V[pe+6],R[7]=V[pe+7],R[8]=V[pe+8],R[9]=V[pe+9],R[10]=V[pe+10],R[11]=V[pe+11],R[12]=V[pe+12],R[13]=V[pe+13],R[14]=V[pe+14],R[15]=V[pe+15],R}e.fromArray=p;function h(R,V,pe,_e){return a(R),c(R,0,0,V[0]),c(R,1,0,V[1]),c(R,2,0,V[2]),c(R,0,1,pe[0]),c(R,1,1,pe[1]),c(R,2,1,pe[2]),c(R,0,2,_e[0]),c(R,1,2,_e[1]),c(R,2,2,_e[2]),c(R,3,3,1),R}e.fromBasis=h;function v(R,V){return R[0]=V[0],R[1]=V[1],R[2]=V[2],R[3]=V[3],R[4]=V[4],R[5]=V[5],R[6]=V[6],R[7]=V[7],R[8]=V[8],R[9]=V[9],R[10]=V[10],R[11]=V[11],R[12]=V[12],R[13]=V[13],R[14]=V[14],R[15]=V[15],R}e.copy=v;function m(R){return v(t(),R)}e.clone=m;function g(R,V){return R[0]=V[12],R[1]=V[13],R[2]=V[14],R}e.getTranslation=g;function y(R,V){var pe=V[0],_e=V[1],Ee=V[2],Ve=V[4],He=V[5],Ye=V[6],lt=V[8],Le=V[9],Qe=V[10];return R[0]=Math.sqrt(pe*pe+_e*_e+Ee*Ee),R[1]=Math.sqrt(Ve*Ve+He*He+Ye*Ye),R[2]=Math.sqrt(lt*lt+Le*Le+Qe*Qe),R}e.getScaling=y;function b(R,V){var pe=V[0]+V[5]+V[10],_e=0;return pe>0?(_e=Math.sqrt(pe+1)*2,R[3]=.25*_e,R[0]=(V[6]-V[9])/_e,R[1]=(V[8]-V[2])/_e,R[2]=(V[1]-V[4])/_e):V[0]>V[5]&&V[0]>V[10]?(_e=Math.sqrt(1+V[0]-V[5]-V[10])*2,R[3]=(V[6]-V[9])/_e,R[0]=.25*_e,R[1]=(V[1]+V[4])/_e,R[2]=(V[8]+V[2])/_e):V[5]>V[10]?(_e=Math.sqrt(1+V[5]-V[0]-V[10])*2,R[3]=(V[8]-V[2])/_e,R[0]=(V[1]+V[4])/_e,R[1]=.25*_e,R[2]=(V[6]+V[9])/_e):(_e=Math.sqrt(1+V[10]-V[0]-V[5])*2,R[3]=(V[1]-V[4])/_e,R[0]=(V[8]+V[2])/_e,R[1]=(V[6]+V[9])/_e,R[2]=.25*_e),R}e.getRotation=b;function x(R,V){var pe=1/Math.sqrt(V[0]*V[0]+V[1]*V[1]+V[2]*V[2]),_e=1/Math.sqrt(V[4]*V[4]+V[5]*V[5]+V[6]*V[6]),Ee=1/Math.sqrt(V[8]*V[8]+V[9]*V[9]+V[10]*V[10]);return R[0]=V[0]*pe,R[1]=V[1]*pe,R[2]=V[2]*pe,R[3]=0,R[4]=V[4]*_e,R[5]=V[5]*_e,R[6]=V[6]*_e,R[7]=0,R[8]=V[8]*Ee,R[9]=V[9]*Ee,R[10]=V[10]*Ee,R[11]=0,R[12]=0,R[13]=0,R[14]=0,R[15]=1,R}e.extractRotation=x;function S(R,V){if(R===V){var pe=V[1],_e=V[2],Ee=V[3],Ve=V[6],He=V[7],Ye=V[11];R[1]=V[4],R[2]=V[8],R[3]=V[12],R[4]=pe,R[6]=V[9],R[7]=V[13],R[8]=_e,R[9]=Ve,R[11]=V[14],R[12]=Ee,R[13]=He,R[14]=Ye}else R[0]=V[0],R[1]=V[4],R[2]=V[8],R[3]=V[12],R[4]=V[1],R[5]=V[5],R[6]=V[9],R[7]=V[13],R[8]=V[2],R[9]=V[6],R[10]=V[10],R[11]=V[14],R[12]=V[3],R[13]=V[7],R[14]=V[11],R[15]=V[15];return R}e.transpose=S;function _(R,V){var pe=V[0],_e=V[1],Ee=V[2],Ve=V[3],He=V[4],Ye=V[5],lt=V[6],Le=V[7],Qe=V[8],at=V[9],ot=V[10],dt=V[11],Oe=V[12],Me=V[13],Ke=V[14],tt=V[15],St=pe*Ye-_e*He,ht=pe*lt-Ee*He,ut=pe*Le-Ve*He,fe=_e*lt-Ee*Ye,me=_e*Le-Ve*Ye,we=Ee*Le-Ve*lt,$e=Qe*Me-at*Oe,gt=Qe*Ke-ot*Oe,Tt=Qe*tt-dt*Oe,Wt=at*Ke-ot*Me,lr=at*tt-dt*Me,wr=ot*tt-dt*Ke,Yt=St*wr-ht*lr+ut*Wt+fe*Tt-me*gt+we*$e;return Yt?(Yt=1/Yt,R[0]=(Ye*wr-lt*lr+Le*Wt)*Yt,R[1]=(Ee*lr-_e*wr-Ve*Wt)*Yt,R[2]=(Me*we-Ke*me+tt*fe)*Yt,R[3]=(ot*me-at*we-dt*fe)*Yt,R[4]=(lt*Tt-He*wr-Le*gt)*Yt,R[5]=(pe*wr-Ee*Tt+Ve*gt)*Yt,R[6]=(Ke*ut-Oe*we-tt*ht)*Yt,R[7]=(Qe*we-ot*ut+dt*ht)*Yt,R[8]=(He*lr-Ye*Tt+Le*$e)*Yt,R[9]=(_e*Tt-pe*lr-Ve*$e)*Yt,R[10]=(Oe*me-Me*ut+tt*St)*Yt,R[11]=(at*ut-Qe*me-dt*St)*Yt,R[12]=(Ye*gt-He*Wt-lt*$e)*Yt,R[13]=(pe*Wt-_e*gt+Ee*$e)*Yt,R[14]=(Me*ht-Oe*fe-Ke*St)*Yt,R[15]=(Qe*fe-at*ht+ot*St)*Yt,!0):!1}e.tryInvert=_;function A(R,V){return _(R,V)||console.warn("non-invertible matrix.",V),R}e.invert=A;function T(R,V,pe){var _e=V[0],Ee=V[1],Ve=V[2],He=V[3],Ye=V[4],lt=V[5],Le=V[6],Qe=V[7],at=V[8],ot=V[9],dt=V[10],Oe=V[11],Me=V[12],Ke=V[13],tt=V[14],St=V[15],ht=pe[0],ut=pe[1],fe=pe[2],me=pe[3];return R[0]=ht*_e+ut*Ye+fe*at+me*Me,R[1]=ht*Ee+ut*lt+fe*ot+me*Ke,R[2]=ht*Ve+ut*Le+fe*dt+me*tt,R[3]=ht*He+ut*Qe+fe*Oe+me*St,ht=pe[4],ut=pe[5],fe=pe[6],me=pe[7],R[4]=ht*_e+ut*Ye+fe*at+me*Me,R[5]=ht*Ee+ut*lt+fe*ot+me*Ke,R[6]=ht*Ve+ut*Le+fe*dt+me*tt,R[7]=ht*He+ut*Qe+fe*Oe+me*St,ht=pe[8],ut=pe[9],fe=pe[10],me=pe[11],R[8]=ht*_e+ut*Ye+fe*at+me*Me,R[9]=ht*Ee+ut*lt+fe*ot+me*Ke,R[10]=ht*Ve+ut*Le+fe*dt+me*tt,R[11]=ht*He+ut*Qe+fe*Oe+me*St,ht=pe[12],ut=pe[13],fe=pe[14],me=pe[15],R[12]=ht*_e+ut*Ye+fe*at+me*Me,R[13]=ht*Ee+ut*lt+fe*ot+me*Ke,R[14]=ht*Ve+ut*Le+fe*dt+me*tt,R[15]=ht*He+ut*Qe+fe*Oe+me*St,R}e.mul=T;function I(R,V,pe,_e,Ee,Ve){var He=V[0+Ee],Ye=V[1+Ee],lt=V[2+Ee],Le=V[3+Ee],Qe=V[4+Ee],at=V[5+Ee],ot=V[6+Ee],dt=V[7+Ee],Oe=V[8+Ee],Me=V[9+Ee],Ke=V[10+Ee],tt=V[11+Ee],St=V[12+Ee],ht=V[13+Ee],ut=V[14+Ee],fe=V[15+Ee],me=pe[0+Ve],we=pe[1+Ve],$e=pe[2+Ve],gt=pe[3+Ve];return R[0+_e]=me*He+we*Qe+$e*Oe+gt*St,R[1+_e]=me*Ye+we*at+$e*Me+gt*ht,R[2+_e]=me*lt+we*ot+$e*Ke+gt*ut,R[3+_e]=me*Le+we*dt+$e*tt+gt*fe,me=pe[4+Ve],we=pe[5+Ve],$e=pe[6+Ve],gt=pe[7+Ve],R[4+_e]=me*He+we*Qe+$e*Oe+gt*St,R[5+_e]=me*Ye+we*at+$e*Me+gt*ht,R[6+_e]=me*lt+we*ot+$e*Ke+gt*ut,R[7+_e]=me*Le+we*dt+$e*tt+gt*fe,me=pe[8+Ve],we=pe[9+Ve],$e=pe[10+Ve],gt=pe[11+Ve],R[8+_e]=me*He+we*Qe+$e*Oe+gt*St,R[9+_e]=me*Ye+we*at+$e*Me+gt*ht,R[10+_e]=me*lt+we*ot+$e*Ke+gt*ut,R[11+_e]=me*Le+we*dt+$e*tt+gt*fe,me=pe[12+Ve],we=pe[13+Ve],$e=pe[14+Ve],gt=pe[15+Ve],R[12+_e]=me*He+we*Qe+$e*Oe+gt*St,R[13+_e]=me*Ye+we*at+$e*Me+gt*ht,R[14+_e]=me*lt+we*ot+$e*Ke+gt*ut,R[15+_e]=me*Le+we*dt+$e*tt+gt*fe,R}e.mulOffset=I;function M(R,V,pe,_e){return T(R,T(R,V,pe),_e)}e.mul3=M;function O(R,V,pe){var _e=pe[0],Ee=pe[1],Ve=pe[2],He,Ye,lt,Le,Qe,at,ot,dt,Oe,Me,Ke,tt;return V===R?(R[12]=V[0]*_e+V[4]*Ee+V[8]*Ve+V[12],R[13]=V[1]*_e+V[5]*Ee+V[9]*Ve+V[13],R[14]=V[2]*_e+V[6]*Ee+V[10]*Ve+V[14],R[15]=V[3]*_e+V[7]*Ee+V[11]*Ve+V[15]):(He=V[0],Ye=V[1],lt=V[2],Le=V[3],Qe=V[4],at=V[5],ot=V[6],dt=V[7],Oe=V[8],Me=V[9],Ke=V[10],tt=V[11],R[0]=He,R[1]=Ye,R[2]=lt,R[3]=Le,R[4]=Qe,R[5]=at,R[6]=ot,R[7]=dt,R[8]=Oe,R[9]=Me,R[10]=Ke,R[11]=tt,R[12]=He*_e+Qe*Ee+Oe*Ve+V[12],R[13]=Ye*_e+at*Ee+Me*Ve+V[13],R[14]=lt*_e+ot*Ee+Ke*Ve+V[14],R[15]=Le*_e+dt*Ee+tt*Ve+V[15]),R}e.translate=O;function D(R,V){return R[0]=1,R[1]=0,R[2]=0,R[3]=0,R[4]=0,R[5]=1,R[6]=0,R[7]=0,R[8]=0,R[9]=0,R[10]=1,R[11]=0,R[12]=V[0],R[13]=V[1],R[14]=V[2],R[15]=1,R}e.fromTranslation=D;function F(R,V){return R[12]=V[0],R[13]=V[1],R[14]=V[2],R}e.setTranslation=F;function G(R,V,pe,_e){return R[0]=pe[0],R[4]=pe[1],R[8]=pe[2],R[1]=_e[0],R[5]=_e[1],R[9]=_e[2],R[2]=V[0],R[6]=V[1],R[10]=V[2],R}e.setAxes=G;function N(R,V,pe,_e){var Ee=_e[0],Ve=_e[1],He=_e[2],Ye=Math.sqrt(Ee*Ee+Ve*Ve+He*He),lt,Le,Qe,at,ot,dt,Oe,Me,Ke,tt,St,ht,ut,fe,me,we,$e,gt,Tt,Wt,lr,wr,Yt,zn;return Math.abs(Ye)<fn?r():(Ye=1/Ye,Ee*=Ye,Ve*=Ye,He*=Ye,lt=Math.sin(pe),Le=Math.cos(pe),Qe=1-Le,at=V[0],ot=V[1],dt=V[2],Oe=V[3],Me=V[4],Ke=V[5],tt=V[6],St=V[7],ht=V[8],ut=V[9],fe=V[10],me=V[11],we=Ee*Ee*Qe+Le,$e=Ve*Ee*Qe+He*lt,gt=He*Ee*Qe-Ve*lt,Tt=Ee*Ve*Qe-He*lt,Wt=Ve*Ve*Qe+Le,lr=He*Ve*Qe+Ee*lt,wr=Ee*He*Qe+Ve*lt,Yt=Ve*He*Qe-Ee*lt,zn=He*He*Qe+Le,R[0]=at*we+Me*$e+ht*gt,R[1]=ot*we+Ke*$e+ut*gt,R[2]=dt*we+tt*$e+fe*gt,R[3]=Oe*we+St*$e+me*gt,R[4]=at*Tt+Me*Wt+ht*lr,R[5]=ot*Tt+Ke*Wt+ut*lr,R[6]=dt*Tt+tt*Wt+fe*lr,R[7]=Oe*Tt+St*Wt+me*lr,R[8]=at*wr+Me*Yt+ht*zn,R[9]=ot*wr+Ke*Yt+ut*zn,R[10]=dt*wr+tt*Yt+fe*zn,R[11]=Oe*wr+St*Yt+me*zn,V!==R&&(R[12]=V[12],R[13]=V[13],R[14]=V[14],R[15]=V[15]),R)}e.rotate=N;function z(R,V,pe){var _e=pe[0],Ee=pe[1],Ve=pe[2],He=Math.sqrt(_e*_e+Ee*Ee+Ve*Ve),Ye,lt,Le;return Math.abs(He)<fn?n(R):(He=1/He,_e*=He,Ee*=He,Ve*=He,Ye=Math.sin(V),lt=Math.cos(V),Le=1-lt,R[0]=_e*_e*Le+lt,R[1]=Ee*_e*Le+Ve*Ye,R[2]=Ve*_e*Le-Ee*Ye,R[3]=0,R[4]=_e*Ee*Le-Ve*Ye,R[5]=Ee*Ee*Le+lt,R[6]=Ve*Ee*Le+_e*Ye,R[7]=0,R[8]=_e*Ve*Le+Ee*Ye,R[9]=Ee*Ve*Le-_e*Ye,R[10]=Ve*Ve*Le+lt,R[11]=0,R[12]=0,R[13]=0,R[14]=0,R[15]=1,R)}e.fromRotation=z;function $(R,V,pe){var _e=pe[0],Ee=pe[1],Ve=pe[2];return R[0]=V[0]*_e,R[1]=V[1]*_e,R[2]=V[2]*_e,R[3]=V[3]*_e,R[4]=V[4]*Ee,R[5]=V[5]*Ee,R[6]=V[6]*Ee,R[7]=V[7]*Ee,R[8]=V[8]*Ve,R[9]=V[9]*Ve,R[10]=V[10]*Ve,R[11]=V[11]*Ve,R[12]=V[12],R[13]=V[13],R[14]=V[14],R[15]=V[15],R}e.scale=$;function j(R,V,pe){return R[0]=V[0]*pe,R[1]=V[1]*pe,R[2]=V[2]*pe,R[3]=V[3]*pe,R[4]=V[4]*pe,R[5]=V[5]*pe,R[6]=V[6]*pe,R[7]=V[7]*pe,R[8]=V[8]*pe,R[9]=V[9]*pe,R[10]=V[10]*pe,R[11]=V[11]*pe,R[12]=V[12],R[13]=V[13],R[14]=V[14],R[15]=V[15],R}e.scaleUniformly=j;function Z(R,V){return R[0]=V[0],R[1]=0,R[2]=0,R[3]=0,R[4]=0,R[5]=V[1],R[6]=0,R[7]=0,R[8]=0,R[9]=0,R[10]=V[2],R[11]=0,R[12]=0,R[13]=0,R[14]=0,R[15]=1,R}e.fromScaling=Z;function q(R,V){return R[0]=V,R[1]=0,R[2]=0,R[3]=0,R[4]=0,R[5]=V,R[6]=0,R[7]=0,R[8]=0,R[9]=0,R[10]=V,R[11]=0,R[12]=0,R[13]=0,R[14]=0,R[15]=1,R}e.fromUniformScaling=q;function te(R,V){return R[0]=V[0],R[1]=V[1],R[2]=V[2],R[4]=V[3],R[5]=V[4],R[6]=V[5],R[8]=V[6],R[9]=V[7],R[10]=V[8],R}e.fromMat3=te;function he(R){for(var V="",pe=0;pe<4;pe++){for(var _e=0;_e<4;_e++)V+=R[4*_e+pe].toString(),_e<3&&(V+=" ");pe<3&&(V+=`
`)}return V}e.makeTable=he;function W(R){var V=R[0],pe=R[1],_e=R[2],Ee=R[3],Ve=R[4],He=R[5],Ye=R[6],lt=R[7],Le=R[8],Qe=R[9],at=R[10],ot=R[11],dt=R[12],Oe=R[13],Me=R[14],Ke=R[15],tt=V*He-pe*Ve,St=V*Ye-_e*Ve,ht=V*lt-Ee*Ve,ut=pe*Ye-_e*He,fe=pe*lt-Ee*He,me=_e*lt-Ee*Ye,we=Le*Oe-Qe*dt,$e=Le*Me-at*dt,gt=Le*Ke-ot*dt,Tt=Qe*Me-at*Oe,Wt=Qe*Ke-ot*Oe,lr=at*Ke-ot*Me;return tt*lr-St*Wt+ht*Tt+ut*gt-fe*$e+me*we}e.determinant=W;function K(R,V){return U(R,typeof V!="undefined"?V:fn)}e.isRotationAndTranslation=K;function U(R,V){var pe=R[0],_e=R[1],Ee=R[2],Ve=R[3],He=R[4],Ye=R[5],lt=R[6],Le=R[7],Qe=R[8],at=R[9],ot=R[10],dt=R[11],Oe=R[15];if(!cn(Oe,1,V)||!cn(Ve,0,V)||!cn(Le,0,V)||!cn(dt,0,V))return!1;var Me=Math.abs(pe*(Ye*ot-lt*at)-_e*(He*ot-lt*Qe)+Ee*(He*at-Ye*Qe));return!!cn(Me,1,V)}function H(R,V){return J(R,typeof V!="undefined"?V:fn)}e.isTranslationAndUniformScaling=H;function J(R,V){var pe=R[0];return cn(R[1],0,V)&&cn(R[2],0,V)&&cn(R[3],0,V)&&cn(R[4],0,V)&&cn(R[5],pe,V)&&cn(R[6],0,V)&&cn(R[7],0,V)&&cn(R[8],0,V)&&cn(R[9],0,V)&&cn(R[10],pe,V)&&cn(R[11],0,V)&&cn(R[15],1,V)}function X(R,V){var pe=V[0],_e=V[1],Ee=V[2],Ve=V[3],He=pe+pe,Ye=_e+_e,lt=Ee+Ee,Le=pe*He,Qe=_e*He,at=_e*Ye,ot=Ee*He,dt=Ee*Ye,Oe=Ee*lt,Me=Ve*He,Ke=Ve*Ye,tt=Ve*lt;return R[0]=1-at-Oe,R[1]=Qe+tt,R[2]=ot-Ke,R[3]=0,R[4]=Qe-tt,R[5]=1-Le-Oe,R[6]=dt+Me,R[7]=0,R[8]=ot+Ke,R[9]=dt-Me,R[10]=1-Le-at,R[11]=0,R[12]=0,R[13]=0,R[14]=0,R[15]=1,R}e.fromQuat=X;function Q(R,V,pe,_e,Ee,Ve,He){var Ye=2*Ve/(pe-V),lt=2*Ve/(_e-Ee),Le=(pe+V)/(pe-V),Qe=(_e+Ee)/(_e-Ee),at=-(He+Ve)/(He-Ve),ot=-2*He*Ve/(He-Ve);return R[0]=Ye,R[1]=0,R[2]=0,R[3]=0,R[4]=0,R[5]=lt,R[6]=0,R[7]=0,R[8]=Le,R[9]=Qe,R[10]=at,R[11]=-1,R[12]=0,R[13]=0,R[14]=ot,R[15]=0,R}e.perspective=Q;function ee(R,V,pe,_e,Ee,Ve,He){var Ye=1/(pe-V),lt=1/(_e-Ee),Le=1/(He-Ve),Qe=(pe+V)*Ye,at=(_e+Ee)*lt,ot=(He+Ve)*Le;return R[0]=2*Ye,R[1]=0,R[2]=0,R[3]=0,R[4]=0,R[5]=2*lt,R[6]=0,R[7]=0,R[8]=0,R[9]=0,R[10]=-2*Le,R[11]=0,R[12]=-Qe,R[13]=-at,R[14]=-ot,R[15]=1,R}e.ortho=ee;function le(R,V,pe,_e){var Ee,Ve,He,Ye,lt,Le,Qe,at,ot,dt,Oe=V[0],Me=V[1],Ke=V[2],tt=_e[0],St=_e[1],ht=_e[2],ut=pe[0],fe=pe[1],me=pe[2];return Math.abs(Oe-ut)<fn&&Math.abs(Me-fe)<fn&&Math.abs(Ke-me)<fn?n(R):(Qe=Oe-ut,at=Me-fe,ot=Ke-me,dt=1/Math.sqrt(Qe*Qe+at*at+ot*ot),Qe*=dt,at*=dt,ot*=dt,Ee=St*ot-ht*at,Ve=ht*Qe-tt*ot,He=tt*at-St*Qe,dt=Math.sqrt(Ee*Ee+Ve*Ve+He*He),dt?(dt=1/dt,Ee*=dt,Ve*=dt,He*=dt):(Ee=0,Ve=0,He=0),Ye=at*He-ot*Ve,lt=ot*Ee-Qe*He,Le=Qe*Ve-at*Ee,dt=Math.sqrt(Ye*Ye+lt*lt+Le*Le),dt?(dt=1/dt,Ye*=dt,lt*=dt,Le*=dt):(Ye=0,lt=0,Le=0),R[0]=Ee,R[1]=Ye,R[2]=Qe,R[3]=0,R[4]=Ve,R[5]=lt,R[6]=at,R[7]=0,R[8]=He,R[9]=Le,R[10]=ot,R[11]=0,R[12]=-(Ee*Oe+Ve*Me+He*Ke),R[13]=-(Ye*Oe+lt*Me+Le*Ke),R[14]=-(Qe*Oe+at*Me+ot*Ke),R[15]=1,R)}e.lookAt=le;function ye(R,V,pe,_e){var Ee=V[0],Ve=V[1],He=V[2],Ye=_e[0],lt=_e[1],Le=_e[2],Qe=Ee-pe[0],at=Ve-pe[1],ot=He-pe[2],dt=Qe*Qe+at*at+ot*ot;dt>0&&(dt=1/Math.sqrt(dt),Qe*=dt,at*=dt,ot*=dt);var Oe=lt*ot-Le*at,Me=Le*Qe-Ye*ot,Ke=Ye*at-lt*Qe;return dt=Oe*Oe+Me*Me+Ke*Ke,dt>0&&(dt=1/Math.sqrt(dt),Oe*=dt,Me*=dt,Ke*=dt),R[0]=Oe,R[1]=Me,R[2]=Ke,R[3]=0,R[4]=at*Ke-ot*Me,R[5]=ot*Oe-Qe*Ke,R[6]=Qe*Me-at*Oe,R[7]=0,R[8]=Qe,R[9]=at,R[10]=ot,R[11]=0,R[12]=Ee,R[13]=Ve,R[14]=He,R[15]=1,R}e.targetTo=ye;function be(R,V){a(R);for(var pe=0;pe<4;pe++){var _e=V[pe];c(R,pe,_e,1)}return R}e.fromPermutation=be;function Ae(R){var V=R[0]*R[0]+R[1]*R[1]+R[2]*R[2],pe=R[4]*R[4]+R[5]*R[5]+R[6]*R[6],_e=R[8]*R[8]+R[9]*R[9]+R[10]*R[10];return Math.sqrt(Math.max(V,pe,_e))}e.getMaxScaleOnAxis=Ae;var xe=[1,0,0],ae=[0,1,0],oe=[0,0,1];e.rotX90=z(t(),Wr(90),xe),e.rotX180=z(t(),Wr(180),xe),e.rotY90=z(t(),Wr(90),ae),e.rotY180=z(t(),Wr(180),ae),e.rotY270=z(t(),Wr(270),ae),e.rotZ90=z(t(),Wr(90),oe),e.rotZ180=z(t(),Wr(180),oe),e.rotXY90=T(t(),e.rotX90,e.rotY90),e.rotZY90=T(t(),e.rotZ90,e.rotY90),e.rotZYZ90=T(t(),e.rotZY90,e.rotZ90),e.rotZ90X180=T(t(),e.rotZ90,e.rotX180),e.rotY90Z180=T(t(),e.rotY90,e.rotZ180),e.id=r()})(ue||(ue={}));function C(){return C.zero()}(function(e){function t(){var fe=[.1,0,0];return fe[0]=0,fe}e.zero=t;function r(fe){var me=t();return me[0]=fe[0],me[1]=fe[1],me[2]=fe[2],me}e.clone=r;function n(fe){return isNaN(fe[0])||isNaN(fe[1])||isNaN(fe[2])}e.hasNaN=n;function a(fe){return fe[0]=NaN,fe[1]=NaN,fe[2]=NaN,fe}e.setNaN=a;function i(fe){return l(fe.x,fe.y,fe.z)}e.fromObj=i;function o(fe){return{x:fe[0],y:fe[1],z:fe[2]}}e.toObj=o;function s(fe,me,we){return fe[0]=me[we+0],fe[1]=me[we+1],fe[2]=me[we+2],fe}e.fromArray=s;function u(fe,me,we){return me[we+0]=fe[0],me[we+1]=fe[1],me[we+2]=fe[2],me}e.toArray=u;function l(fe,me,we){var $e=t();return $e[0]=fe,$e[1]=me,$e[2]=we,$e}e.create=l;function c(fe){var me=t();return me[0]=fe[0],me[1]=fe[1],me[2]=fe[2],me}e.ofArray=c;function d(fe,me,we,$e){return fe[0]=me,fe[1]=we,fe[2]=$e,fe}e.set=d;function f(fe,me){return fe[0]=me[0],fe[1]=me[1],fe[2]=me[2],fe}e.copy=f;function p(fe,me,we){return fe[0]=me[0]+we[0],fe[1]=me[1]+we[1],fe[2]=me[2]+we[2],fe}e.add=p;function h(fe,me,we){return fe[0]=me[0]-we[0],fe[1]=me[1]-we[1],fe[2]=me[2]-we[2],fe}e.sub=h;function v(fe,me,we){return fe[0]=me[0]*we[0],fe[1]=me[1]*we[1],fe[2]=me[2]*we[2],fe}e.mul=v;function m(fe,me,we){return fe[0]=me[0]/we[0],fe[1]=me[1]/we[1],fe[2]=me[2]/we[2],fe}e.div=m;function g(fe,me,we){return fe[0]=me[0]*we,fe[1]=me[1]*we,fe[2]=me[2]*we,fe}e.scale=g;function y(fe,me,we,$e){return fe[0]=me[0]+we[0]*$e,fe[1]=me[1]+we[1]*$e,fe[2]=me[2]+we[2]*$e,fe}e.scaleAndAdd=y;function b(fe,me,we,$e){return fe[0]=me[0]-we[0]*$e,fe[1]=me[1]-we[1]*$e,fe[2]=me[2]-we[2]*$e,fe}e.scaleAndSub=b;function x(fe,me,we){return fe[0]=me[0]+we,fe[1]=me[1]+we,fe[2]=me[2]+we,fe}e.addScalar=x;function S(fe,me,we){return fe[0]=me[0]-we,fe[1]=me[1]-we,fe[2]=me[2]-we,fe}e.subScalar=S;function _(fe,me){return fe[0]=Math.round(me[0]),fe[1]=Math.round(me[1]),fe[2]=Math.round(me[2]),fe}e.round=_;function A(fe,me){return fe[0]=Math.ceil(me[0]),fe[1]=Math.ceil(me[1]),fe[2]=Math.ceil(me[2]),fe}e.ceil=A;function T(fe,me){return fe[0]=Math.floor(me[0]),fe[1]=Math.floor(me[1]),fe[2]=Math.floor(me[2]),fe}e.floor=T;function I(fe,me){return fe[0]=Math.trunc(me[0]),fe[1]=Math.trunc(me[1]),fe[2]=Math.trunc(me[2]),fe}e.trunc=I;function M(fe,me){return fe[0]=Math.abs(me[0]),fe[1]=Math.abs(me[1]),fe[2]=Math.abs(me[2]),fe}e.abs=M;function O(fe,me,we){return fe[0]=Math.min(me[0],we[0]),fe[1]=Math.min(me[1],we[1]),fe[2]=Math.min(me[2],we[2]),fe}e.min=O;function D(fe,me,we){return fe[0]=Math.max(me[0],we[0]),fe[1]=Math.max(me[1],we[1]),fe[2]=Math.max(me[2],we[2]),fe}e.max=D;function F(fe,me){var we=me[0]-fe[0],$e=me[1]-fe[1],gt=me[2]-fe[2];return Math.sqrt(we*we+$e*$e+gt*gt)}e.distance=F;function G(fe,me){var we=me[0]-fe[0],$e=me[1]-fe[1],gt=me[2]-fe[2];return we*we+$e*$e+gt*gt}e.squaredDistance=G;function N(fe){var me=fe[0],we=fe[1],$e=fe[2];return Math.sqrt(me*me+we*we+$e*$e)}e.magnitude=N;function z(fe){var me=fe[0],we=fe[1],$e=fe[2];return me*me+we*we+$e*$e}e.squaredMagnitude=z;function $(fe,me,we){return g(fe,q(fe,me),we)}e.setMagnitude=$;function j(fe,me){return fe[0]=-me[0],fe[1]=-me[1],fe[2]=-me[2],fe}e.negate=j;function Z(fe,me){return fe[0]=1/me[0],fe[1]=1/me[1],fe[2]=1/me[2],fe}e.inverse=Z;function q(fe,me){var we=me[0],$e=me[1],gt=me[2],Tt=we*we+$e*$e+gt*gt;return Tt>0&&(Tt=1/Math.sqrt(Tt),fe[0]=me[0]*Tt,fe[1]=me[1]*Tt,fe[2]=me[2]*Tt),fe}e.normalize=q;function te(fe,me){return fe[0]*me[0]+fe[1]*me[1]+fe[2]*me[2]}e.dot=te;function he(fe,me,we){var $e=me[0],gt=me[1],Tt=me[2],Wt=we[0],lr=we[1],wr=we[2];return fe[0]=gt*wr-Tt*lr,fe[1]=Tt*Wt-$e*wr,fe[2]=$e*lr-gt*Wt,fe}e.cross=he;function W(fe,me,we,$e){var gt=me[0],Tt=me[1],Wt=me[2];return fe[0]=gt+$e*(we[0]-gt),fe[1]=Tt+$e*(we[1]-Tt),fe[2]=Wt+$e*(we[2]-Wt),fe}e.lerp=W;var K=t();function U(fe,me,we,$e){var gt=Ka(te(me,we),-1,1),Tt=Math.acos(gt)*$e;return y(K,we,me,-gt),q(K,K),p(fe,g(fe,me,Math.cos(Tt)),g(K,K,Math.sin(Tt)))}e.slerp=U;function H(fe,me,we,$e,gt,Tt){var Wt=Tt*Tt,lr=Wt*(2*Tt-3)+1,wr=Wt*(Tt-2)+Tt,Yt=Wt*(Tt-1),zn=Wt*(3-2*Tt);return fe[0]=me[0]*lr+we[0]*wr+$e[0]*Yt+gt[0]*zn,fe[1]=me[1]*lr+we[1]*wr+$e[1]*Yt+gt[1]*zn,fe[2]=me[2]*lr+we[2]*wr+$e[2]*Yt+gt[2]*zn,fe}e.hermite=H;function J(fe,me,we,$e,gt,Tt){var Wt=1-Tt,lr=Wt*Wt,wr=Tt*Tt,Yt=lr*Wt,zn=3*Tt*lr,_a=3*wr*Wt,wa=wr*Tt;return fe[0]=me[0]*Yt+we[0]*zn+$e[0]*_a+gt[0]*wa,fe[1]=me[1]*Yt+we[1]*zn+$e[1]*_a+gt[1]*wa,fe[2]=me[2]*Yt+we[2]*zn+$e[2]*_a+gt[2]*wa,fe}e.bezier=J;function X(fe,me,we,$e,gt){return fe[0]=Cb(me[0],we[0],$e[0],gt),fe[1]=Cb(me[1],we[1],$e[1],gt),fe[2]=Cb(me[2],we[2],$e[2],gt),fe}e.quadraticBezier=X;function Q(fe,me,we,$e,gt,Tt,Wt){return fe[0]=_0(me[0],we[0],$e[0],gt[0],Tt,Wt),fe[1]=_0(me[1],we[1],$e[1],gt[1],Tt,Wt),fe[2]=_0(me[2],we[2],$e[2],gt[2],Tt,Wt),fe}e.spline=Q;function ee(fe,me){var we=Math.random()*2*Math.PI,$e=Math.random()*2-1,gt=Math.sqrt(1-$e*$e)*me;return fe[0]=Math.cos(we)*gt,fe[1]=Math.sin(we)*gt,fe[2]=$e*me,fe}e.random=ee;function le(fe,me,we){var $e=me[0],gt=me[1],Tt=me[2],Wt=1/(we[3]*$e+we[7]*gt+we[11]*Tt+we[15]||1);return fe[0]=(we[0]*$e+we[4]*gt+we[8]*Tt+we[12])*Wt,fe[1]=(we[1]*$e+we[5]*gt+we[9]*Tt+we[13])*Wt,fe[2]=(we[2]*$e+we[6]*gt+we[10]*Tt+we[14])*Wt,fe}e.transformMat4=le;function ye(fe,me,we,$e,gt,Tt){var Wt=me[0+gt],lr=me[1+gt],wr=me[2+gt],Yt=1/(we[3+Tt]*Wt+we[7+Tt]*lr+we[11+Tt]*wr+we[15+Tt]||1);return fe[0+$e]=(we[0+Tt]*Wt+we[4+Tt]*lr+we[8+Tt]*wr+we[12+Tt])*Yt,fe[1+$e]=(we[1+Tt]*Wt+we[5+Tt]*lr+we[9+Tt]*wr+we[13+Tt])*Yt,fe[2+$e]=(we[2+Tt]*Wt+we[6+Tt]*lr+we[10+Tt]*wr+we[14+Tt])*Yt,fe}e.transformMat4Offset=ye;function be(fe,me,we){var $e=me[0],gt=me[1],Tt=me[2];return fe[0]=$e*we[0]+gt*we[3]+Tt*we[6],fe[1]=$e*we[1]+gt*we[4]+Tt*we[7],fe[2]=$e*we[2]+gt*we[5]+Tt*we[8],fe}e.transformMat3=be;function Ae(fe,me,we){var $e=me[0],gt=me[1],Tt=me[2],Wt=we[0],lr=we[1],wr=we[2],Yt=we[3],zn=Yt*$e+lr*Tt-wr*gt,_a=Yt*gt+wr*$e-Wt*Tt,wa=Yt*Tt+Wt*gt-lr*$e,Ri=-Wt*$e-lr*gt-wr*Tt;return fe[0]=zn*Yt+Ri*-Wt+_a*-wr-wa*-lr,fe[1]=_a*Yt+Ri*-lr+wa*-Wt-zn*-wr,fe[2]=wa*Yt+Ri*-wr+zn*-lr-_a*-Wt,fe}e.transformQuat=Ae;function xe(fe,me){var we=Math.sqrt(z(fe)*z(me));if(we===0)return Math.PI/2;var $e=te(fe,me)/we;return Math.acos(Ka($e,-1,1))}e.angle=xe;var ae=t(),oe=t(),R=t(),V=t(),pe=t(),_e=t(),Ee=t();function Ve(fe,me,we,$e){h(ae,fe,me),h(oe,we,me),h(R,me,we),h(V,$e,we),he(pe,ae,oe),he(_e,R,V);var gt=xe(pe,_e);return he(Ee,pe,_e),te(oe,Ee)>0?gt:-gt}e.dihedralAngle=Ve;function He(fe,me){return fe[0]===me[0]&&fe[1]===me[1]&&fe[2]===me[2]}e.exactEquals=He;function Ye(fe,me){var we=fe[0],$e=fe[1],gt=fe[2],Tt=me[0],Wt=me[1],lr=me[2];return Math.abs(we-Tt)<=fn*Math.max(1,Math.abs(we),Math.abs(Tt))&&Math.abs($e-Wt)<=fn*Math.max(1,Math.abs($e),Math.abs(Wt))&&Math.abs(gt-lr)<=fn*Math.max(1,Math.abs(gt),Math.abs(lr))}e.equals=Ye;var lt=t();function Le(fe,me,we){var $e=xe(me,we);if(Math.abs($e)<1e-4)return ue.setIdentity(fe);if(Math.abs($e-Math.PI)<fn)return ue.fromScaling(fe,e.negUnit);var gt=he(lt,me,we);return ue.fromRotation(fe,$e,gt)}e.makeRotation=Le;function Qe(fe){return fe[0]===0&&fe[1]===0&&fe[2]===0}e.isZero=Qe;function at(fe,me,we,$e){h(fe,f(fe,me),$e);var gt=te(we,fe)/z(we);return p(fe,g(fe,f(fe,we),gt),$e)}e.projectPointOnVector=at;function ot(fe,me,we){var $e=te(we,me)/z(we);return g(fe,we,$e)}e.projectOnVector=ot;var dt=t();function Oe(fe,me,we){return ot(dt,me,we),h(fe,me,dt)}e.projectOnPlane=Oe;function Me(fe,me,we){return q(fe,he(fe,he(fe,me,we),me))}e.orthogonalize=Me;function Ke(fe,me,we){return te(me,we)>0?f(fe,me):j(fe,f(fe,me)),fe}e.matchDirection=Ke;var tt=t(),St=t();function ht(fe,me,we,$e){return h(tt,we,me),h(St,$e,me),q(fe,he(fe,tt,St))}e.triangleNormal=ht;function ut(fe,me){return"["+fe[0].toPrecision(me)+" "+fe[1].toPrecision(me)+" "+fe[2].toPrecision(me)+"]"}e.toString=ut,e.origin=l(0,0,0),e.unit=l(1,1,1),e.negUnit=l(-1,-1,-1),e.unitX=l(1,0,0),e.unitY=l(0,1,0),e.unitZ=l(0,0,1),e.negUnitX=l(-1,0,0),e.negUnitY=l(0,-1,0),e.negUnitZ=l(0,0,-1)})(C||(C={}));function Mn(){return Mn.zero()}(function(e){function t(){var W=[.1,0,0,0,0,0,0,0,0];return W[0]=0,W}e.zero=t;function r(){var W=t();return W[0]=1,W[1]=0,W[2]=0,W[3]=0,W[4]=1,W[5]=0,W[6]=0,W[7]=0,W[8]=1,W}e.identity=r;function n(W){return W[0]=1,W[1]=0,W[2]=0,W[3]=0,W[4]=1,W[5]=0,W[6]=0,W[7]=0,W[8]=1,W}e.setIdentity=n;function a(W,K,U){return K[U+0]=W[0],K[U+1]=W[1],K[U+2]=W[2],K[U+3]=W[3],K[U+4]=W[4],K[U+5]=W[5],K[U+6]=W[6],K[U+7]=W[7],K[U+8]=W[8],K}e.toArray=a;function i(W,K,U){return W[0]=K[U+0],W[1]=K[U+1],W[2]=K[U+2],W[3]=K[U+3],W[4]=K[U+4],W[5]=K[U+5],W[6]=K[U+6],W[7]=K[U+7],W[8]=K[U+8],W}e.fromArray=i;function o(W,K){return W[0]=K[0],W[1]=K[1],W[2]=K[2],W[3]=K[4],W[4]=K[5],W[5]=K[6],W[6]=K[8],W[7]=K[9],W[8]=K[10],W}e.fromMat4=o;function s(W,K,U,H,J,X,Q,ee,le){var ye=t();return ye[0]=W,ye[1]=K,ye[2]=U,ye[3]=H,ye[4]=J,ye[5]=X,ye[6]=Q,ye[7]=ee,ye[8]=le,ye}e.create=s;var u=r();function l(W,K){return f(W,u,typeof K=="undefined"?fn:K)}e.isIdentity=l;function c(W){for(var K=0;K<9;K++)if(isNaN(W[K]))return!0;return!1}e.hasNaN=c;function d(W){return v(t(),W)}e.clone=d;function f(W,K,U){for(var H=0;H<9;H++)if(Math.abs(W[H]-K[H])>U)return!1;return!0}e.areEqual=f;function p(W,K,U,H){W[3*U+K]=H}e.setValue=p;function h(W,K,U){return W[3*U+K]}e.getValue=h;function v(W,K){return W[0]=K[0],W[1]=K[1],W[2]=K[2],W[3]=K[3],W[4]=K[4],W[5]=K[5],W[6]=K[6],W[7]=K[7],W[8]=K[8],W}e.copy=v;function m(W,K){if(W===K){var U=K[1],H=K[2],J=K[5];W[1]=K[3],W[2]=K[6],W[3]=U,W[5]=K[7],W[6]=H,W[7]=J}else W[0]=K[0],W[1]=K[3],W[2]=K[6],W[3]=K[1],W[4]=K[4],W[5]=K[7],W[6]=K[2],W[7]=K[5],W[8]=K[8];return W}e.transpose=m;function g(W,K){var U=K[0],H=K[1],J=K[2],X=K[3],Q=K[4],ee=K[5],le=K[6],ye=K[7],be=K[8],Ae=be*Q-ee*ye,xe=-be*X+ee*le,ae=ye*X-Q*le,oe=U*Ae+H*xe+J*ae;return oe?(oe=1/oe,W[0]=Ae*oe,W[1]=(-be*H+J*ye)*oe,W[2]=(ee*H-J*Q)*oe,W[3]=xe*oe,W[4]=(be*U-J*le)*oe,W[5]=(-ee*U+J*X)*oe,W[6]=ae*oe,W[7]=(-ye*U+H*le)*oe,W[8]=(Q*U-H*X)*oe,W):(console.warn("non-invertible matrix.",K),W)}e.invert=g;function y(W,K){return W===K?(W[3]=K[1],W[6]=K[2],W[7]=K[5]):(W[0]=K[0],W[1]=K[1],W[2]=K[2],W[3]=K[1],W[4]=K[4],W[5]=K[5],W[6]=K[2],W[7]=K[5],W[8]=K[8]),W}e.symmtricFromUpper=y;function b(W,K){return W===K?(W[1]=K[3],W[2]=K[6],W[5]=K[7]):(W[0]=K[0],W[1]=K[3],W[2]=K[6],W[3]=K[3],W[4]=K[4],W[5]=K[7],W[6]=K[6],W[7]=K[7],W[8]=K[8]),W}e.symmtricFromLower=b;function x(W){var K=W[0],U=W[1],H=W[2],J=W[3],X=W[4],Q=W[5],ee=W[6],le=W[7],ye=W[8],be=ye*X-Q*le,Ae=-ye*J+Q*ee,xe=le*J-X*ee;return K*be+U*Ae+H*xe}e.determinant=x;function S(W){return W[0]+W[4]+W[8]}e.trace=S;function _(W,K,U){return W[0]=K[0]-U[0],W[1]=K[1]-U[1],W[2]=K[2]-U[2],W[3]=K[3]-U[3],W[4]=K[4]-U[4],W[5]=K[5]-U[5],W[6]=K[6]-U[6],W[7]=K[7]-U[7],W[8]=K[8]-U[8],W}e.sub=_;function A(W,K,U){return W[0]=K[0]+U[0],W[1]=K[1]+U[1],W[2]=K[2]+U[2],W[3]=K[3]+U[3],W[4]=K[4]+U[4],W[5]=K[5]+U[5],W[6]=K[6]+U[6],W[7]=K[7]+U[7],W[8]=K[8]+U[8],W}e.add=A;function T(W,K,U){var H=K[0],J=K[1],X=K[2],Q=K[3],ee=K[4],le=K[5],ye=K[6],be=K[7],Ae=K[8],xe=U[0],ae=U[1],oe=U[2],R=U[3],V=U[4],pe=U[5],_e=U[6],Ee=U[7],Ve=U[8];return W[0]=xe*H+ae*Q+oe*ye,W[1]=xe*J+ae*ee+oe*be,W[2]=xe*X+ae*le+oe*Ae,W[3]=R*H+V*Q+pe*ye,W[4]=R*J+V*ee+pe*be,W[5]=R*X+V*le+pe*Ae,W[6]=_e*H+Ee*Q+Ve*ye,W[7]=_e*J+Ee*ee+Ve*be,W[8]=_e*X+Ee*le+Ve*Ae,W}e.mul=T;function I(W,K,U){return W[0]=K[0]-U,W[1]=K[1]-U,W[2]=K[2]-U,W[3]=K[3]-U,W[4]=K[4]-U,W[5]=K[5]-U,W[6]=K[6]-U,W[7]=K[7]-U,W[8]=K[8]-U,W}e.subScalar=I;function M(W,K,U){return W[0]=K[0]+U,W[1]=K[1]+U,W[2]=K[2]+U,W[3]=K[3]+U,W[4]=K[4]+U,W[5]=K[5]+U,W[6]=K[6]+U,W[7]=K[7]+U,W[8]=K[8]+U,W}e.addScalar=M;function O(W,K,U){return W[0]=K[0]*U,W[1]=K[1]*U,W[2]=K[2]*U,W[3]=K[3]*U,W[4]=K[4]*U,W[5]=K[5]*U,W[6]=K[6]*U,W[7]=K[7]*U,W[8]=K[8]*U,W}e.mulScalar=O;var D=Math.PI/3,F=t();function G(W,K){var U=K[1]*K[1]+K[2]*K[2]+K[5]*K[5];if(U===0)W[0]=K[0],W[1]=K[4],W[2]=K[8];else{var H=S(K)/3,J=K[0]-H,X=K[4]-H,Q=K[8]-H,ee=J*J+X*X+Q*Q+2*U,le=Math.sqrt(ee/6);O(F,e.Identity,H),_(F,K,F),O(F,F,1/le);var ye=x(F)/2,be=ye<=-1?D:ye>=1?0:Math.acos(ye)/3;W[0]=H+2*le*Math.cos(be),W[2]=H+2*le*Math.cos(be+2*D),W[1]=3*H-W[0]-W[2]}return W}e.symmetricEigenvalues=G;var N=[.1,0,0],z=[.1,0,0],$=[.1,0,0],j=[.1,0,0],Z=[.1,0,0],q=[.1,0,0];function te(W,K,U){C.set(N,K[0]-U,K[1],K[2]),C.set(z,K[1],K[4]-U,K[5]),C.set($,K[2],K[5],K[8]-U),C.cross(j,N,z),C.cross(Z,N,$),C.cross(q,z,$);var H=C.dot(j,j),J=C.dot(Z,Z),X=C.dot(q,q),Q=H,ee=0;return J>Q&&(Q=J,ee=1),X>Q&&(ee=2),ee===0?C.scale(W,j,1/Math.sqrt(H)):ee===1?C.scale(W,Z,1/Math.sqrt(J)):C.scale(W,q,1/Math.sqrt(X)),W}e.eigenvector=te;function he(W,K){return o(W,K),g(W,W),m(W,W),W}e.directionTransform=he,e.Identity=r()})(Mn||(Mn={}));function Ge(){return Ge.zero()}(function(e){function t(){var T=[.1,0];return T[0]=0,T}e.zero=t;function r(T){var I=t();return I[0]=T[0],I[1]=T[1],I}e.clone=r;function n(T,I){var M=t();return M[0]=T,M[1]=I,M}e.create=n;function a(T){return isNaN(T[0])||isNaN(T[1])}e.hasNaN=a;function i(T,I,M){return I[M+0]=T[0],I[M+1]=T[1],I}e.toArray=i;function o(T,I,M){return T[0]=I[M+0],T[1]=I[M+1],T}e.fromArray=o;function s(T,I){return T[0]=I[0],T[1]=I[1],T}e.copy=s;function u(T,I,M){return T[0]=I,T[1]=M,T}e.set=u;function l(T,I,M){return T[0]=I[0]+M[0],T[1]=I[1]+M[1],T}e.add=l;function c(T,I,M){return T[0]=I[0]-M[0],T[1]=I[1]-M[1],T}e.sub=c;function d(T,I,M){return T[0]=I[0]*M[0],T[1]=I[1]*M[1],T}e.mul=d;function f(T,I,M){return T[0]=I[0]/M[0],T[1]=I[1]/M[1],T}e.div=f;function p(T,I,M){return T[0]=I[0]*M,T[1]=I[1]*M,T}e.scale=p;function h(T,I){return T[0]=Math.round(I[0]),T[1]=Math.round(I[1]),T}e.round=h;function v(T,I){return T[0]=Math.ceil(I[0]),T[1]=Math.ceil(I[1]),T}e.ceil=v;function m(T,I){return T[0]=Math.floor(I[0]),T[1]=Math.floor(I[1]),T}e.floor=m;function g(T,I){var M=I[0]-T[0],O=I[1]-T[1];return Math.sqrt(M*M+O*O)}e.distance=g;function y(T,I){var M=I[0]-T[0],O=I[1]-T[1];return M*M+O*O}e.squaredDistance=y;function b(T){var I=T[0],M=T[1];return Math.sqrt(I*I+M*M)}e.magnitude=b;function x(T){var I=T[0],M=T[1];return I*I+M*M}e.squaredMagnitude=x;function S(T,I){return T[0]=1/I[0],T[1]=1/I[1],T}e.inverse=S;function _(T,I){return T[0]===I[0]&&T[1]===I[1]}e.areEqual=_;function A(T,I){return"["+T[0].toPrecision(I)+" "+T[1].toPrecision(I)+"}]"}e.toString=A})(Ge||(Ge={}));function Cr(){return Cr.zero()}(function(e){function t(){var D=[.1,0,0,0];return D[0]=0,D}e.zero=t;function r(D){var F=t();return F[0]=D[0],F[1]=D[1],F[2]=D[2],F[3]=D[3],F}e.clone=r;function n(D,F,G,N){var z=t();return z[0]=D,z[1]=F,z[2]=G,z[3]=N,z}e.create=n;function a(D,F){return D[0]=F.center[0],D[1]=F.center[1],D[2]=F.center[2],D[3]=F.radius,D}e.fromSphere=a;function i(D){return a(t(),D)}e.ofSphere=i;function o(D){return isNaN(D[0])||isNaN(D[1])||isNaN(D[2])||isNaN(D[3])}e.hasNaN=o;function s(D,F,G){return F[G+0]=D[0],F[G+1]=D[1],F[G+2]=D[2],F[G+3]=D[3],F}e.toArray=s;function u(D,F,G){return D[0]=F[G+0],D[1]=F[G+1],D[2]=F[G+2],D[3]=F[G+3],D}e.fromArray=u;function l(D,F,G){F[G+0]=D[0],F[G+1]=D[1],F[G+2]=D[2]}e.toVec3Array=l;function c(D,F,G){return D[0]=F[G+0],D[1]=F[G+1],D[2]=F[G+2],D[3]=0,D}e.fromVec3Array=c;function d(D,F){return D[0]=F[0],D[1]=F[1],D[2]=F[2],D[3]=F[3],D}e.copy=d;function f(D,F,G,N,z){return D[0]=F,D[1]=G,D[2]=N,D[3]=z,D}e.set=f;function p(D,F,G){return D[0]=F[0]+G[0],D[1]=F[1]+G[1],D[2]=F[2]+G[2],D[3]=F[3]+G[3],D}e.add=p;function h(D,F){var G=F[0]-D[0],N=F[1]-D[1],z=F[2]-D[2],$=F[3]-D[3];return Math.sqrt(G*G+N*N+z*z+$*$)}e.distance=h;function v(D,F,G){return D[0]=F[0]*G,D[1]=F[1]*G,D[2]=F[2]*G,D[4]=F[4]*G,D}e.scale=v;function m(D,F){return D[0]=Math.round(F[0]),D[1]=Math.round(F[1]),D[2]=Math.round(F[2]),D[3]=Math.round(F[3]),D}e.round=m;function g(D,F){return D[0]=Math.ceil(F[0]),D[1]=Math.ceil(F[1]),D[2]=Math.ceil(F[2]),D[3]=Math.ceil(F[3]),D}e.ceil=g;function y(D,F){return D[0]=Math.floor(F[0]),D[1]=Math.floor(F[1]),D[2]=Math.floor(F[2]),D[3]=Math.floor(F[3]),D}e.floor=y;function b(D,F){var G=F[0]-D[0],N=F[1]-D[1],z=F[2]-D[2],$=F[3]-D[3];return G*G+N*N+z*z+$*$}e.squaredDistance=b;function x(D){var F=D[0],G=D[1],N=D[2],z=D[3];return Math.sqrt(F*F+G*G+N*N+z*z)}e.norm=x;function S(D){var F=D[0],G=D[1],N=D[2],z=D[3];return F*F+G*G+N*N+z*z}e.squaredNorm=S;function _(D,F,G){var N=F[0],z=F[1],$=F[2],j=F[3];return D[0]=G[0]*N+G[4]*z+G[8]*$+G[12]*j,D[1]=G[1]*N+G[5]*z+G[9]*$+G[13]*j,D[2]=G[2]*N+G[6]*z+G[10]*$+G[14]*j,D[3]=G[3]*N+G[7]*z+G[11]*$+G[15]*j,D}e.transformMat4=_;function A(D,F){return D[0]*F[0]+D[1]*F[1]+D[2]*F[2]+D[3]*F[3]}e.dot=A;function T(D,F){return D[0]=1/F[0],D[1]=1/F[1],D[2]=1/F[2],D[3]=1/F[3],D}e.inverse=T;function I(D,F){return D[0]===F[0]&&D[1]===F[1]&&D[2]===F[2]&&D[3]===F[3]}e.exactEquals=I;function M(D,F){var G=D[0],N=D[1],z=D[2],$=D[3],j=F[0],Z=F[1],q=F[2],te=F[3];return Math.abs(G-j)<=fn*Math.max(1,Math.abs(G),Math.abs(j))&&Math.abs(N-Z)<=fn*Math.max(1,Math.abs(N),Math.abs(Z))&&Math.abs(z-q)<=fn*Math.max(1,Math.abs(z),Math.abs(q))&&Math.abs($-te)<=fn*Math.max(1,Math.abs($),Math.abs(te))}e.equals=M;function O(D,F){return"["+D[0].toPrecision(F)+" "+D[1].toPrecision(F)+" "+D[2].toPrecision(F)+"  "+D[3].toPrecision(F)+"]"}e.toString=O})(Cr||(Cr={}));function In(){return In.zero()}(function(e){function t(){var q=[.1,0,0,0];return q[0]=0,q}e.zero=t;function r(){var q=t();return q[3]=1,q}e.identity=r;function n(q){q[0]=0,q[1]=0,q[2]=0,q[3]=1}e.setIdentity=n;function a(q){return isNaN(q[0])||isNaN(q[1])||isNaN(q[2])||isNaN(q[3])}e.hasNaN=a;function i(q,te,he,W){var K=r();return K[0]=q,K[1]=te,K[2]=he,K[3]=W,K}e.create=i;function o(q,te,he){he=he*.5;var W=Math.sin(he);return q[0]=W*te[0],q[1]=W*te[1],q[2]=W*te[2],q[3]=Math.cos(he),q}e.setAxisAngle=o;function s(q,te){var he=Math.acos(te[3])*2,W=Math.sin(he/2);return W!==0?(q[0]=te[0]/W,q[1]=te[1]/W,q[2]=te[2]/W):(q[0]=1,q[1]=0,q[2]=0),he}e.getAxisAngle=s;function u(q,te,he){var W=te[0],K=te[1],U=te[2],H=te[3],J=he[0],X=he[1],Q=he[2],ee=he[3];return q[0]=W*ee+H*J+K*Q-U*X,q[1]=K*ee+H*X+U*J-W*Q,q[2]=U*ee+H*Q+W*X-K*J,q[3]=H*ee-W*J-K*X-U*Q,q}e.multiply=u;function l(q,te,he){he*=.5;var W=te[0],K=te[1],U=te[2],H=te[3],J=Math.sin(he),X=Math.cos(he);return q[0]=W*X+H*J,q[1]=K*X+U*J,q[2]=U*X-K*J,q[3]=H*X-W*J,q}e.rotateX=l;function c(q,te,he){he*=.5;var W=te[0],K=te[1],U=te[2],H=te[3],J=Math.sin(he),X=Math.cos(he);return q[0]=W*X-U*J,q[1]=K*X+H*J,q[2]=U*X+W*J,q[3]=H*X-K*J,q}e.rotateY=c;function d(q,te,he){he*=.5;var W=te[0],K=te[1],U=te[2],H=te[3],J=Math.sin(he),X=Math.cos(he);return q[0]=W*X+K*J,q[1]=K*X-W*J,q[2]=U*X+H*J,q[3]=H*X-U*J,q}e.rotateZ=d;function f(q,te){var he=te[0],W=te[1],K=te[2];return q[0]=he,q[1]=W,q[2]=K,q[3]=Math.sqrt(Math.abs(1-he*he-W*W-K*K)),q}e.calculateW=f;function p(q,te,he,W){var K=te[0],U=te[1],H=te[2],J=te[3],X=he[0],Q=he[1],ee=he[2],le=he[3],ye,be,Ae,xe,ae;return be=K*X+U*Q+H*ee+J*le,be<0&&(be=-be,X=-X,Q=-Q,ee=-ee,le=-le),1-be>1e-6?(ye=Math.acos(be),Ae=Math.sin(ye),xe=Math.sin((1-W)*ye)/Ae,ae=Math.sin(W*ye)/Ae):(xe=1-W,ae=W),q[0]=xe*K+ae*X,q[1]=xe*U+ae*Q,q[2]=xe*H+ae*ee,q[3]=xe*J+ae*le,q}e.slerp=p;function h(q,te){var he=te[0],W=te[1],K=te[2],U=te[3],H=he*he+W*W+K*K+U*U,J=H?1/H:0;return q[0]=-he*J,q[1]=-W*J,q[2]=-K*J,q[3]=U*J,q}e.invert=h;function v(q,te){return q[0]=-te[0],q[1]=-te[1],q[2]=-te[2],q[3]=te[3],q}e.conjugate=v;function m(q,te){var he=te[0]+te[4]+te[8],W;if(he>0)W=Math.sqrt(he+1),q[3]=.5*W,W=.5/W,q[0]=(te[5]-te[7])*W,q[1]=(te[6]-te[2])*W,q[2]=(te[1]-te[3])*W;else{var K=0;te[4]>te[0]&&(K=1),te[8]>te[K*3+K]&&(K=2);var U=(K+1)%3,H=(K+2)%3;W=Math.sqrt(te[K*3+K]-te[U*3+U]-te[H*3+H]+1),q[K]=.5*W,W=.5/W,q[3]=(te[U*3+H]-te[H*3+U])*W,q[U]=(te[U*3+K]+te[K*3+U])*W,q[H]=(te[H*3+K]+te[K*3+H])*W}return q}e.fromMat3=m;var g=[0,0,0];function y(q,te,he){var W=C.dot(te,he)+1;return W<fn?(W=0,Math.abs(te[0])>Math.abs(te[2])?C.set(g,-te[1],te[0],0):C.set(g,0,-te[2],te[1])):C.cross(g,te,he),q[0]=g[0],q[1]=g[1],q[2]=g[2],q[3]=W,I(q,q),q}e.fromUnitVec3=y;function b(q){var te=t();return te[0]=q[0],te[1]=q[1],te[2]=q[2],te[3]=q[3],te}e.clone=b;function x(q,te,he){return te[he+0]=q[0],te[he+1]=q[1],te[he+2]=q[2],te[he+3]=q[3],te}e.toArray=x;function S(q,te,he){return q[0]=te[he+0],q[1]=te[he+1],q[2]=te[he+2],q[3]=te[he+3],q}e.fromArray=S;function _(q,te){return q[0]=te[0],q[1]=te[1],q[2]=te[2],q[3]=te[3],q}e.copy=_;function A(q,te,he,W,K){return q[0]=te,q[1]=he,q[2]=W,q[3]=K,q}e.set=A;function T(q,te,he){return q[0]=te[0]+he[0],q[1]=te[1]+he[1],q[2]=te[2]+he[2],q[3]=te[3]+he[3],q}e.add=T;function I(q,te){var he=te[0],W=te[1],K=te[2],U=te[3],H=he*he+W*W+K*K+U*U;return H>0&&(H=1/Math.sqrt(H),q[0]=he*H,q[1]=W*H,q[2]=K*H,q[3]=U*H),q}e.normalize=I;var M=[0,0,0],O=[1,0,0],D=[0,1,0];function F(q,te,he){var W=C.dot(te,he);return W<-.999999?(C.cross(M,O,te),C.magnitude(M)<1e-6&&C.cross(M,D,te),C.normalize(M,M),o(q,M,Math.PI),q):W>.999999?(q[0]=0,q[1]=0,q[2]=0,q[3]=1,q):(C.cross(M,te,he),q[0]=M[0],q[1]=M[1],q[2]=M[2],q[3]=1+W,I(q,q))}e.rotationTo=F;var G=t(),N=t();function z(q,te,he,W,K,U){return p(G,te,K,U),p(N,he,W,U),p(q,G,N,2*U*(1-U)),q}e.sqlerp=z;var $=[0,0,0,0,0,0,0,0,0];function j(q,te,he,W){return $[0]=he[0],$[3]=he[1],$[6]=he[2],$[1]=W[0],$[4]=W[1],$[7]=W[2],$[2]=-te[0],$[5]=-te[1],$[8]=-te[2],I(q,m(q,$))}e.setAxes=j;function Z(q,te){return"["+q[0].toPrecision(te)+" "+q[1].toPrecision(te)+" "+q[2].toPrecision(te)+"  "+q[3].toPrecision(te)+"]"}e.toString=Z,e.Identity=r()})(In||(In={}));var Pr;(function(e){function t(S,_,A){for(var T=[],I=0;I<_.length;I++)T[I]=_[_.length-I-1];for(var M=[1],I=1;I<S.length;I++)M[I]=S[T[I-1]];return{dimensions:S,axisOrderFastToSlow:T,axisOrderSlowToFast:_,accessDimensions:M,defaultCtor:A||Float64Array}}function r(S,_){return{space:S,data:_}}e.create=r;function n(S,_,A){var T=t(S,_,A),I=p(T),M=I.get,O=I.set,D=I.add,F=I.dataOffset,G=I.getCoords;return{rank:S.length,dimensions:S,axisOrderSlowToFast:_,create:h(T),get:M,set:O,add:D,dataOffset:F,getCoords:G}}e.Space=n;function a(S){return S}e.Data1=a;function i(S,_){return n([S],[0],_)}e.Vector=i;function o(S,_,A){return n([S,_],[1,0],A)}e.ColumnMajorMatrix=o;function s(S,_,A){return n([S,_],[0,1],A)}e.RowMajorMatrix=s;function u(S,_,A){if(_.rank!==2)throw new Error("Invalid tensor rank");for(var T=Math.min(4,_.dimensions[0]),I=Math.min(4,_.dimensions[1]),M=0;M<T;M++)for(var O=0;O<I;O++)ue.setValue(S,M,O,_.get(A,M,O));return S}e.toMat4=u;function l(S,_,A){if(_.rank!==2)throw new Error("Invalid tensor rank");for(var T=Math.min(3,_.dimensions[0]),I=Math.min(3,_.dimensions[1]),M=0;M<T;M++)for(var O=0;O<I;O++)Mn.setValue(S,M,O,_.get(A,M,O));return S}e.toMat3=l;function c(S,_,A){if(_.rank!==1)throw new Error("Invalid tensor rank");for(var T=Math.min(3,_.dimensions[0]),I=0;I<T;I++)S[I]=A[I];return S}e.toVec3=c;function d(S,_,A){if(_.rank!==1)throw new Error("Invalid tensor rank");for(var T=Math.min(4,_.dimensions[0]),I=0;I<T;I++)S[I]=A[I];return S}e.toVec4=d;function f(S,_){var A=S.length;if(A!==_.length)return!1;for(var T=0;T<A;T++)if(S[T]!==_[T])return!1;return!0}e.areEqualExact=f;function p(S){var _=S.dimensions,A=S.axisOrderFastToSlow;switch(_.length){case 1:return{get:function(X,Q){return X[Q]},set:function(X,Q,ee){return X[Q]=ee},add:function(X,Q,ee){return X[Q]+=ee},dataOffset:function(X){return X},getCoords:function(X,Q){return Q[0]=X,Q}};case 2:{if(A[0]===0&&A[1]===1){var T=_[0];return{get:function(X,Q,ee){return X[ee*T+Q]},set:function(X,Q,ee,le){return X[ee*T+Q]=le},add:function(X,Q,ee,le){return X[ee*T+Q]+=le},dataOffset:function(X,Q){return Q*T+X},getCoords:function(X,Q){return Q[0]=X%T,Q[1]=Math.floor(X/T),Q}}}if(A[0]===1&&A[1]===0){var I=_[1];return{get:function(X,Q,ee){return X[Q*I+ee]},set:function(X,Q,ee,le){return X[Q*I+ee]=le},add:function(X,Q,ee,le){return X[Q*I+ee]+=le},dataOffset:function(X,Q){return X*I+Q},getCoords:function(X,Q){return Q[0]=Math.floor(X/I),Q[1]=X%I,Q}}}throw new Error("bad axis order")}case 3:{if(A[0]===0&&A[1]===1&&A[2]===2){var M=_[0],O=_[1],D=M*O;return{get:function(X,Q,ee,le){return X[Q+ee*M+le*D]},set:function(X,Q,ee,le,ye){return X[Q+ee*M+le*D]=ye},add:function(X,Q,ee,le,ye){return X[Q+ee*M+le*D]+=ye},dataOffset:function(X,Q,ee){return X+Q*M+ee*D},getCoords:function(X,Q){var ee=Math.floor(X/M);return Q[0]=X%M,Q[1]=ee%O,Q[2]=Math.floor(ee/O),Q}}}if(A[0]===0&&A[1]===2&&A[2]===1){var F=_[0],G=_[2],N=F*G;return{get:function(X,Q,ee,le){return X[Q+le*F+ee*N]},set:function(X,Q,ee,le,ye){return X[Q+le*F+ee*N]=ye},add:function(X,Q,ee,le,ye){return X[Q+le*F+ee*N]+=ye},dataOffset:function(X,Q,ee){return X+ee*F+Q*N},getCoords:function(X,Q){var ee=Math.floor(X/F);return Q[0]=X%F,Q[1]=Math.floor(ee/G),Q[2]=ee%G,Q}}}if(A[0]===1&&A[1]===0&&A[2]===2){var z=_[1],$=_[0],j=z*$;return{get:function(X,Q,ee,le){return X[ee+Q*z+le*j]},set:function(X,Q,ee,le,ye){return X[ee+Q*z+le*j]=ye},add:function(X,Q,ee,le,ye){return X[ee+Q*z+le*j]+=ye},dataOffset:function(X,Q,ee){return Q+X*z+ee*j},getCoords:function(X,Q){var ee=Math.floor(X/z);return Q[0]=ee%$,Q[1]=X%z,Q[2]=Math.floor(ee/$),Q}}}if(A[0]===1&&A[1]===2&&A[2]===0){var Z=_[1],q=_[2],te=Z*q;return{get:function(X,Q,ee,le){return X[ee+le*Z+Q*te]},set:function(X,Q,ee,le,ye){return X[ee+le*Z+Q*te]=ye},add:function(X,Q,ee,le,ye){return X[ee+le*Z+Q*te]+=ye},dataOffset:function(X,Q,ee){return Q+ee*Z+X*te},getCoords:function(X,Q){var ee=Math.floor(X/Z);return Q[0]=Math.floor(ee/q),Q[1]=X%Z,Q[2]=ee%q,Q}}}if(A[0]===2&&A[1]===0&&A[2]===1){var he=_[2],W=_[0],K=he*W;return{get:function(X,Q,ee,le){return X[le+Q*he+ee*K]},set:function(X,Q,ee,le,ye){return X[le+Q*he+ee*K]=ye},add:function(X,Q,ee,le,ye){return X[le+Q*he+ee*K]+=ye},dataOffset:function(X,Q,ee){return ee+X*he+Q*K},getCoords:function(X,Q){var ee=Math.floor(X/he);return Q[0]=ee%W,Q[1]=Math.floor(ee/W),Q[2]=X%he,Q}}}if(A[0]===2&&A[1]===1&&A[2]===0){var U=_[2],H=_[1],J=U*H;return{get:function(X,Q,ee,le){return X[le+ee*U+Q*J]},set:function(X,Q,ee,le,ye){return X[le+ee*U+Q*J]=ye},add:function(X,Q,ee,le,ye){return X[le+ee*U+Q*J]+=ye},dataOffset:function(X,Q,ee){return ee+Q*U+X*J},getCoords:function(X,Q){var ee=Math.floor(X/U);return Q[0]=Math.floor(ee/H),Q[1]=ee%H,Q[2]=X%U,Q}}}throw new Error("bad axis order")}default:return{get:function(X){for(var Q=[],ee=1;ee<arguments.length;ee++)Q[ee-1]=arguments[ee];return X[v(S,Q)]},set:function(X){for(var Q=[],ee=1;ee<arguments.length;ee++)Q[ee-1]=arguments[ee];return X[v(S,Q)]=Q[Q.length-1]},add:function(X){for(var Q=[],ee=1;ee<arguments.length;ee++)Q[ee-1]=arguments[ee];return X[v(S,Q)]+=Q[Q.length-1]},dataOffset:function(){for(var X=[],Q=0;Q<arguments.length;Q++)X[Q]=arguments[Q];return v(S,X)},getCoords:function(X,Q){return m(S,X,Q)}}}}function h(S){for(var _=S.dimensions,A=1,T=0,I=_.length;T<I;T++)A*=_[T];return function(M){return new(M||S.defaultCtor)(A)}}function v(S,_){for(var A=S.accessDimensions,T=S.axisOrderFastToSlow,I=A.length-1,M=A[I]*_[T[I]],O=I-1;O>=0;O--)M=(M+_[T[O]])*A[O];return M}function m(S,_,A){for(var T=S.dimensions,I=S.axisOrderFastToSlow,M=T.length,O=_,D=0;D<M;D++){var F=T[I[D]];A[I[D]]=O%F,O=Math.floor(O/F)}return A[I[M+1]]=O,A}function g(S){for(var _=[],A=0;A<S.length;A++)_[A]=S[S.length-A-1];return _}e.invertAxisOrder=g;function y(S,_){for(var A=[],T=0;T<S.length;T++)A[T]=S[_[T]];return A}function b(S){for(var _=new Int32Array(S.length),A=0;A<S.length;A++)_[S[A]]=A;return function(T){return y(T,_)}}e.convertToCanonicalAxisIndicesFastToSlow=b;function x(S){for(var _=new Int32Array(S.length),A=0;A<S.length;A++)_[S[S.length-A-1]]=A;return function(T){return y(T,_)}}e.convertToCanonicalAxisIndicesSlowToFast=x})(Pr||(Pr={}));function td(e,t,r){for(;t<r&&e.charCodeAt(t)===32;)t++;return sc(e,t,r)}function sc(e,t,r){var n=t,a=0,i=1;for(e.charCodeAt(n)===45?(i=-1,++n):e.charCodeAt(n)===43&&++n;n<r;n++){var o=e.charCodeAt(n)-48;if(o>9||o<0)return i*a|0;a=10*a+o|0}return i*a}function F4(e,t,r,n){return t.charCodeAt(r)===43&&r++,e*Math.pow(10,sc(t,r,n))}function hG(e,t,r){for(;t<r&&e.charCodeAt(t)===32;)t++;return Mu(e,t,r)}function Mu(e,t,r){var n=t,a=1,i=0,o=0,s=1;for(e.charCodeAt(n)===45?(a=-1,++n):e.charCodeAt(n)===43&&++n;n<r;){var u=e.charCodeAt(n)-48;if(u>=0&&u<10)i=i*10+u,++n;else if(u===-2){for(++n;n<r;)if(u=e.charCodeAt(n)-48,u>=0&&u<10)o=10*o+u,s=10*s,++n;else return u===53||u===21?F4(a*(i+o/s),e,n+1,r):a*(i+o/s);return a*(i+o/s)}else{if(u===53||u===21)return F4(a*i,e,n+1,r);break}}return a*i}var ve;(function(e){var t;(function(M){M.str={"@type":"str",T:"",valueType:"str"},M.int={"@type":"int",T:0,valueType:"int"},M.coord={"@type":"coord",T:0,valueType:"float"},M.float={"@type":"float",T:0,valueType:"float"};function O(Z){return Z===void 0&&(Z=""),{"@type":"str",T:Z,valueType:"str"}}M.Str=O;function D(Z){return Z===void 0&&(Z=0),{"@type":"int",T:Z,valueType:"int"}}M.Int=D;function F(Z){return Z===void 0&&(Z=0),{"@type":"float",T:Z,valueType:"float"}}M.Float=F;function G(Z,q){return q===void 0&&(q=M.float),{"@type":"tensor",T:Z.create(),space:Z,valueType:"tensor",baseType:q}}M.Tensor=G;function N(Z,q){return q===void 0&&(q=M.float),G(Pr.Vector(Z,q["@type"]==="int"?Int32Array:Float64Array),q)}M.Vector=N;function z(Z,q,te){return te===void 0&&(te=M.float),G(Pr.ColumnMajorMatrix(Z,q,te["@type"]==="int"?Int32Array:Float64Array),te)}M.Matrix=z;function $(Z,q){return typeof q!="undefined"?w(w({},Z),{T:q}):Z}M.Aliased=$;function j(Z,q,te){return te===void 0&&(te=[]),{"@type":"list",T:te,separator:Z,itemParse:q,valueType:"list"}}M.List=j})(t=e.Schema||(e.Schema={}));function r(M){return!!M&&!!M.schema&&!!M.value}e.is=r;function n(M,O){return k4(O.T,M,O,1)}e.Undefined=n;function a(M,O,D){return k4(M,O,D,0)}e.ofConst=a;function i(M){return ym(M)}e.ofLambda=i;function o(M,O){return i({value:function(D){return D+M},rowCount:Math.max(O-M+1,0),schema:t.int})}e.range=o;function s(M){return gu(M)}e.ofArray=s;function u(M){return gu({array:M,schema:t.int})}e.ofIntArray=u;function l(M){return gu({array:M,schema:t.float})}e.ofFloatArray=l;function c(M){return gu({array:M,schema:t.str})}e.ofStringArray=c;function d(M){return gu({array:M,schema:t.Aliased(t.str)})}e.ofStringAliasArray=d;function f(M,O){return O===void 0&&(O=","),gu({array:M,schema:t.List(O,function(D){return D})})}e.ofStringListArray=f;function p(M){var O=M.count,D=M.data,F=M.indices;return ym({value:function(G){return sc(D,F[2*G],F[2*G+1])||0},rowCount:O,schema:t.int})}e.ofIntTokens=p;function h(M){var O=M.count,D=M.data,F=M.indices;return ym({value:function(G){return Mu(D,F[2*G],F[2*G+1])||0},rowCount:O,schema:t.float})}e.ofFloatTokens=h;function v(M){var O=M.count,D=M.data,F=M.indices;return ym({value:function(G){var N=D.substring(F[2*G],F[2*G+1]);return N==="."||N==="?"?"":N},rowCount:O,schema:t.str})}e.ofStringTokens=v;function m(M,O,D){return gG(M,O,D)}e.window=m;function g(M,O,D){return D===void 0&&(D=!0),xG(M,O,D)}e.view=g;function y(M){return vG(M)}e.createFirstIndexMap=y;function b(M){return mG(M)}e.createIndexer=b;function x(M,O,D){return wG(M,O,D||Array)}e.mapToArray=x;function S(M,O){return AG(M,O)}e.areEqual=S;function _(M,O){return EG(M,O)}e.indicesOf=_;function A(M,O){return M.__array?M:M.isDefined?gu({array:M.toArray({array:O}),schema:M.schema,valueKind:M.valueKind}):n(M.rowCount,M.schema)}e.asArrayColumn=A;function T(M,O,D){if(D===void 0&&(D=0),!!M.isDefined){var F=M.__array;if(F)for(var G=0,N=F.length;G<N;G++)O[D+G]=F[G];else for(var G=0,N=M.rowCount;G<N;G++)O[D+G]=M.value(G)}}e.copyToArray=T;function I(M){for(var O=0,D=M.rowCount;O<D;O++)if(O!==M.value(O))return!1;return!0}e.isIdentity=I})(ve||(ve={}));function vG(e){for(var t=new Map,r=0,n=e.rowCount;r<n;r++){var a=e.value(r);t.has(a)||t.set(e.value(r),r)}return t}function mG(e){for(var t=new Map,r=0,n=e.rowCount;r<n;r++){var a=e.value(r);t.has(a)||t.set(e.value(r),r)}return function(i){return t.has(i)?t.get(i):-1}}function k4(e,t,r,n){var a=function(i){return e};return{schema:r,__array:void 0,isDefined:n===0,rowCount:t,value:a,valueKind:function(i){return n},toArray:function(i){for(var o=Ev(t,i).array,s=0,u=o.length;s<u;s++)o[s]=e;return o},areValuesEqual:function(i,o){return!0}}}function ym(e){var t=e.value,r=e.valueKind,n=e.areValuesEqual,a=e.rowCount,i=e.schema;return{schema:i,__array:void 0,isDefined:!0,rowCount:a,value:t,valueKind:r||function(o){return 0},toArray:function(o){for(var s=Ev(a,o),u=s.array,l=s.start,c=0,d=u.length;c<d;c++)u[c]=t(c+l);return u},areValuesEqual:n||function(o,s){return t(o)===t(s)}}}function gu(e){var t=e.array,r=e.schema,n=e.valueKind,a=t.length,i=r.valueType==="str"?function(s){var u=t[s];return typeof u=="string"?u:""+u}:function(s){return t[s]},o=P_(t);return{schema:r,__array:t,isDefined:!0,rowCount:a,value:i,valueKind:n||function(s){return 0},toArray:r.valueType==="str"?function(s){for(var u=Q0(a,s),l=u.start,c=u.end,d=new(s&&typeof s.array!="undefined"?s.array:t.constructor)(c-l),f=0,p=c-l;f<p;f++){var h=t[l+f];d[f]=typeof h=="string"?h:""+h}return d}:o?function(s){return Z0(t,s)}:function(s){var u=Q0(a,s),l=u.start,c=u.end;if(l===0&&c===t.length)return t;for(var d=new(s&&typeof s.array!="undefined"?s.array:t.constructor)(c-l),f=0,p=c-l;f<p;f++)d[f]=t[l+f];return d},areValuesEqual:function(s,u){return t[s]===t[u]}}}function gG(e,t,r){return e.isDefined?t===0&&r===e.rowCount?e:!!e.__array&&P_(e.__array)?yG(e,t,r):bG(e,t,r):ve.Undefined(r-t,e.schema)}function yG(e,t,r){var n=Z0(e.__array,{start:t,end:r}),a=e.valueKind;return gu({array:n,schema:e.schema,valueKind:function(i){return a(t+i)}})}function bG(e,t,r){var n=e.value,a=e.valueKind,i=e.areValuesEqual,o=t===0?n:function(u){return n(u+t)},s=r-t;return{schema:e.schema,__array:void 0,isDefined:e.isDefined,rowCount:s,value:o,valueKind:t===0?a:function(u){return a(u+t)},toArray:function(u){for(var l=Ev(s,u).array,c=0,d=l.length;c<d;c++)l[c]=n(c+t);return l},areValuesEqual:t===0?i:function(u,l){return i(u+t,l+t)}}}function SG(e,t){if(e.length!==t)return!1;for(var r=0,n=e.length;r<n;r++)if(e[r]!==r)return!1;return!0}function xG(e,t,r){return e.rowCount===0||r&&SG(t,e.rowCount)?e:!!e.__array&&typeof e.value(0)==typeof e.__array[0]?CG(e,t):_G(e,t)}function CG(e,t){for(var r=e.__array,n=new r.constructor(t.length),a=0,i=t.length;a<i;a++)n[a]=r[t[a]];var o=e.valueKind;return gu({array:n,schema:e.schema,valueKind:function(s){return o(t[s])}})}function _G(e,t){var r=e.value,n=e.valueKind,a=e.areValuesEqual,i=function(s){return r(t[s])},o=t.length;return{schema:e.schema,__array:void 0,isDefined:e.isDefined,rowCount:o,value:i,valueKind:function(s){return n(t[s])},toArray:function(s){for(var u=Ev(o,s).array,l=0,c=u.length;l<c;l++)u[l]=r(t[l]);return u},areValuesEqual:function(s,u){return a(t[s],t[u])}}}function wG(e,t,r){for(var n=new r(e.rowCount),a=0,i=e.rowCount;a<i;a++)n[a]=t(e.value(a));return n}function AG(e,t){return e===t?!0:e.rowCount!==t.rowCount||e.isDefined!==t.isDefined||e.schema.valueType!==t.schema.valueType?!1:!!e.__array&&!!t.__array?PG(e,t):TG(e,t)}function PG(e,t){for(var r=e.__array,n=t.__array,a=0,i=e.rowCount;a<i;a++)if(r[a]!==n[a])return!1;return!0}function TG(e,t){for(var r=e.value,n=t.value,a=0,i=e.rowCount;a<i;a++)if(r(a)!==n(a))return!1;return!0}function EG(e,t){for(var r=[],n=e.value,a=0,i=e.rowCount;a<i;a++)t(n(a))&&(r[r.length]=a);return r}var Xr;(function(e){function t(x){return x&&typeof x._rowCount=="number"&&!!x._columns&&!!x._schema}e.is=t;function r(x,S,_){_===void 0&&(_={});var A=Object.create(null),T=Object.keys(x);A._rowCount=S._rowCount,A._columns=T,A._schema=x;for(var I=0,M=T;I<M.length;I++){var O=M[I];if(S[O])A[O]=S[O];else if(_[O])A[O]=_[O];else throw Error("Cannot find column '"+O+"'.")}return A}e.pickColumns=r;function n(x,S){var _=Object.keys(S),A=S[_[0]].rowCount;return w({_rowCount:A,_columns:_,_schema:x},S)}e.ofColumns=n;function a(x,S,_){var A=Object.create(null),T=Object.keys(x);A._rowCount=_,A._columns=T,A._schema=x;for(var I=0,M=T;I<M.length;I++){var O=M[I];O in S?A[O]=S[O]:A[O]=ve.Undefined(_,x[O])}return A}e.ofPartialColumns=a;function i(x,S){var _=Object.create(null),A=Object.keys(x);_._rowCount=S,_._columns=A,_._schema=x;for(var T=0,I=A;T<I.length;T++){var M=I[T];_[M]=ve.Undefined(S,x[M])}return _}e.ofUndefinedColumns=i;function o(x,S){var _=Object.create(null),A=S.length,T=Object.keys(x);_._rowCount=A,_._columns=T,_._schema=x;for(var I=function(F){_[F]=ve.ofLambda({rowCount:A,schema:x[F],value:function(G){return S[G][F]},valueKind:function(G){return typeof S[G][F]=="undefined"?1:0}})},M=0,O=T;M<O.length;M++){var D=O[M];I(D)}return _}e.ofRows=o;function s(x,S){var _,A=Object.create(null),T=Object.keys(x);A._rowCount=0,A._columns=T,A._schema=x;for(var I=0,M=T;I<M.length;I++){var O=M[I];typeof S[O]!="undefined"?(A[O]=ve.ofArray({array:S[O],schema:x[O]}),A._rowCount=(_=S[O])===null||_===void 0?void 0:_.length):A[O]=ve.Undefined(A._rowCount,x[O])}return A}e.ofArrays=s;function u(x,S,_){var A=Object.create(null),T=Object.keys(S);A._rowCount=_.length,A._columns=T,A._schema=S;for(var I=0,M=T;I<M.length;I++){var O=M[I];A[O]=ve.view(x[O],_)}return A}e.view=u;function l(x,S,_){for(var A=[],T=0,I=x._rowCount;T<I;++T)_(T)&&A.push(T);return u(x,S,A)}e.pick=l;function c(x,S,_,A){if(_===0&&A===x._rowCount)return x;var T=Object.create(null),I=Object.keys(S);T._rowCount=A-_,T._columns=I,T._schema=S;for(var M=0,O=I;M<O.length;M++){var D=O[M];T[D]=ve.window(x[D],_,A)}return T}e.window=c;function d(x,S){var _=Object.create(null),A=Object.keys(S);_._rowCount=0;for(var T=0,I=x;T<I.length;T++){var M=I[T];_._rowCount+=M._rowCount}for(var O={},D=0,F=A;D<F.length;D++){var G=F[D];O[G]=new Array(_._rowCount)}_._columns=A,_._schema=S;for(var N=0,z=0,$=x;z<$.length;z++){for(var M=$[z],j=0,Z=A;j<Z.length;j++){var q=Z[j];ve.copyToArray(M[q],O[q],N)}N+=M._rowCount}for(var te=0,he=A;te<he.length;te++){var q=he[te];_[q]=ve.ofArray({array:O[q],schema:S[q]})}return _}e.concat=d;function f(x,S,_){x[S]=ve.asArrayColumn(x[S],_)}e.columnToArray=f;function p(x,S){for(var _=new Int32Array(x._rowCount),A=0,T=_.length;A<T;A++)_[A]=A;es(_,function(G,N,z){return S(N,z)});for(var I=!0,A=0,T=_.length;A<T;A++)if(_[A]!==A){I=!1;break}if(I)return x;var M=Object.create(null);M._rowCount=x._rowCount,M._columns=x._columns,M._schema=x._schema;for(var O=0,D=x._columns;O<D.length;O++){var F=D[O];M[F]=ve.view(x[F],_,!1)}return M}e.sort=p;function h(x,S){if(x._rowCount!==S._rowCount||x._columns.length!==S._columns.length)return!1;for(var _=0,A=x._columns;_<A.length;_++){var T=A[_];if(!S[T])return!1}for(var I=0,M=x._columns;I<M.length;I++){var T=M[I];if(!ve.areEqual(x[T],S[T]))return!1}return!0}e.areEqual=h;function v(x,S){for(var _=Object.create(null),A=x._columns,T=0;T<A.length;T++){var I=A[T];_[I]=x[I].value(S)}return _}e.getRow=v;function m(x,S){for(var _=0,A=x._rowCount;_<A;++_)if(S(_))return v(x,_)}e.pickRow=m;function g(x){for(var S=[],_=x._rowCount,A=0;A<_;A++)S[A]=v(x,A);return S}e.getRows=g;function y(x){for(var S={},_=x._columns,A=0;A<_.length;A++){var T=_[A];S[T]=x[T].toArray()}return S}e.toArrays=y;function b(x){var S=Dr.create(),_=x._columns,A=x._rowCount,T=1;Dr.write(S,"|");for(var I=0;I<_.length;I++)Dr.write(S,_[I]),Dr.write(S,"|"),T+=_[I].length+1;Dr.newline(S),Dr.write(S,new Array(T+1).join("-")),Dr.newline(S);for(var M=0;M<A;M++){Dr.write(S,"|");for(var I=0;I<_.length;I++){var O=x[_[I]];O.valueKind(M)===0?(Dr.write(S,O.value(M)),Dr.write(S,"|")):Dr.write(S,".|")}Dr.newline(S)}return Dr.getString(S)}e.formatToString=b})(Xr||(Xr={}));var jS;(function(e){function t(n,a,i){var o=Object.keys(i),s=Object.create(null),u=[];s._name=n,s._tableNames=u,s._schema=a;for(var l=0,c=o;l<c.length;l++){var d=c[l];!Xr.is(i[d])||(s[d]=i[d],u[u.length]=d)}return s}e.ofTables=t;function r(n){for(var a={},i=0,o=n._tableNames;i<o.length;i++){var s=o[i];a[s]=Xr.getRows(n[s])}return a}e.getTablesAsRows=r})(jS||(jS={}));function T_(e,t){for(var r=0,n=e.length;r<n;r++)if(t(e[r]))return e[r]}function E_(e){if(Array.from)return Array.from(e);for(var t=[];;){var r=e.next(),n=r.done,a=r.value;if(n)break;t[t.length]=a}return t}function WS(e,t,r){for(var n=t-e+1,a=r?new r(n):new Int32Array(n),i=0;i<n;i++)a[i]=i+e;return a}function IG(e,t){for(var r=new(MG(e))(t.length),n=0,a=t.length;n<a;n++)r[n]=e[t[n]];return r}function MG(e){var t=e.constructor;if(!t)throw new Error("data does not define a constructor and it should");return t}var $n;(function(e){e.Zero=0;var t=function(){var v=new ArrayBuffer(8),m=new ArrayBuffer(8);return{_int32:new Int32Array(v),_float64:new Float64Array(v),_int32_1:new Int32Array(m),_float64_1:new Float64Array(m)}}(),r=t._int32,n=t._float64,a=t._int32_1,i=t._float64_1;function o(v){return typeof v=="number"}e.is=o;function s(v,m){return r[0]=v,r[1]=m,n[0]}e.create=s;function u(v){return n[0]=v,r[0]}e.fst=u;function l(v){return n[0]=v,r[1]}e.snd=l;function c(v,m){return n[0]=v,i[0]=m,r[0]===a[0]&&r[1]===a[1]}e.areEqual=c;function d(v,m){n[0]=v,i[0]=m;var g=r[0]-a[0];return g!==0?g:r[1]-a[1]}e.compare=d;function f(v,m,g){n[0]=v[m],i[0]=v[g];var y=r[0]-a[0];return y!==0?y:r[1]-a[1]}e.compareInArray=f;function p(v){return n[0]=v,jd(r[0],r[1])}e.hashCode=p;function h(v){return n[0]=v,"("+r[0]+", "+r[1]+")"}e.toString=h})($n||($n={}));var iR=$n.Zero;function B4(e,t){return t<e?$n.create(e,e):$n.create(e,t+1)}function I_(e,t){return t<=e?$n.create(e,e):$n.create(e,t)}function DG(e){return e<0?$n.create(0,0):$n.create(0,e)}var RG=$n.is,Bu=$n.fst,pc=$n.snd,J0=$n.fst;function eg(e){return $n.snd(e)-1}function md(e){return $n.snd(e)-$n.fst(e)}var OG=$n.hashCode,FG=$n.toString;function kG(e,t){return $n.fst(e)<=t&&t<$n.snd(e)}function BG(e,t){var r=Bu(e);return t>=r&&t<pc(e)?t-r:-1}function LG(e,t){return $n.fst(e)+t}var NG=$n.areEqual;function oR(e,t){var r=md(e),n=md(t);return r===0&&n===0?!0:r>0&&n>0&&eg(e)>=J0(t)&&J0(e)<=eg(t)}function UG(e,t){return md(e)?md(t)?Bu(e)<=Bu(t)&&pc(e)>=pc(t):!0:md(t)===0}function XS(e,t){var r=Bu(e);if(t<=r)return 0;var n=pc(e);return t>=n?n-r:t-r}function zG(e,t,r){var n=Bu(r),a=Bu(e);if(t<=n+a)return n;var i=pc(r);return t>=i+a?i:t-a}function sR(e,t,r){return I_(XS(e,t),XS(e,r+1))}function VG(e,t){return oR(e,t)?I_(Math.max(Bu(e),Bu(t)),Math.min(pc(e),pc(t))):iR}function HG(e,t){return md(sR(e,J0(t),eg(t)))}var Ie;(function(e){e.Empty=iR,e.ofSingleton=function(t){return B4(t,t)},e.ofRange=B4,e.ofBounds=I_,e.ofLength=DG,e.is=RG,e.has=kG,e.indexOf=BG,e.getAt=LG,e.start=Bu,e.end=pc,e.min=J0,e.max=eg,e.size=md,e.hashCode=OG,e.toString=FG,e.areEqual=NG,e.areIntersecting=oR,e.isSubInterval=UG,e.findPredecessorIndex=XS,e.findPredecessorIndexInInterval=zG,e.findRange=sR,e.intersectionSize=HG,e.intersect=VG})(Ie||(Ie={}));var iv=[];function GG(e){return[e]}function qG(e){return e}function jG(e){return es(e),e}function L4(e,t){if(t<e)return[];for(var r=new Int32Array(t-e+1),n=e;n<=t;n++)r[n-e]=n;return r}function WG(e){return e&&(Array.isArray(e)||!!e.buffer)}function YS(e){return e[0]}function KS(e){return e[e.length-1]+1}function XG(e){return e[0]}function YG(e){return e[e.length-1]}function uR(e){return e.length}function KG(e){var t=e.length;return t?t>2?fG(t,e[0],e[t-1],e[t>>1]):dG(t,e[0],e[t-1]):0}function $G(e){var t=e.length;return t>5?"["+e[0]+", "+e[1]+", ..., "+e[t-1]+"], length "+t:"["+e.join(", ")+"]"}function lR(e,t){var r=e.length;return r===0?-1:e[0]<=t&&t<=e[r-1]?dR(e,t,0,r):-1}function QG(e,t,r){return cR(e,t,Ie.start(r),Ie.end(r))}function cR(e,t,r,n){var a=e.length;return a===0||n<=r?-1:e[r]<=t&&t<=e[n-1]?dR(e,t,r,n):-1}function ZG(e,t){return lR(e,t)>=0}function JG(e,t){if(e===t)return!0;var r=e.length;if(r!==t.length||e[0]!==t[0]||e[r-1]!==t[r-1])return!1;for(var n=0;n<r;n++)if(e[n]!==t[n])return!1;return!0}function cd(e,t){var r=e.length;return t<=e[0]?0:t>e[r-1]?r:fR(e,t,0,r)}function eq(e,t,r){var n=Ie.start(r),a=Ie.end(r),i=e[n];return t<=i?n:a>n&&t>e[a-1]?a:t-i<=11?rq(e,t,n+1,a):fR(e,t,n,a)}function tq(e,t,r){return Ie.ofBounds(cd(e,t),cd(e,r+1))}function dR(e,t,r,n){for(var a=r,i=n-1;a<=i;){if(a+11>i){for(var o=a;o<=i;o++)if(t===e[o])return o;return-1}var s=a+i>>1,u=e[s];if(t<u)i=s-1;else if(t>u)a=s+1;else return s}return-1}function fR(e,t,r,n){for(var a=r,i=n-1;a<i;){if(a+11>i){for(var o=a;o<=i;o++)if(t<=e[o])return o;return i+1}var s=a+i>>1,u=e[s];if(t<u)i=s-1;else if(t>u)a=s+1;else return s}return a>i?i+1:e[a]>=t?a:a+1}function rq(e,t,r,n){for(var a=r;a<n;a++)if(t<=e[a])return a;return n}function nq(e,t){if(e===t)return!0;for(var r=Wd(e,t),n=r.startI,a=r.startJ,i=r.endI,o=r.endJ;n<i&&a<o;){var s=e[n],u=t[a];if(s<u)n++;else if(s>u)a++;else return!0}return!1}function aq(e,t){if(e===t)return!0;var r=t.length,n=Wd(e,t),a=n.startI,i=n.startJ,o=n.endI,s=n.endJ;if(s-i<r||o-a<r)return!1;for(var u=0;a<o&&i<s;){var l=e[a],c=t[i];l<c?a++:l>c?i++:(a++,i++,u++)}return u===r}function pR(e,t){if(e===t)return e;var r=e.length,n=t.length;if(r===0)return t;if(n===0)return e;if(e[0]>t[0])return pR(t,e);var a=Wd(e,t),i=a.startI,o=a.startJ,s=a.endI,u=a.endJ,l=M_(e,t,i,o,s,u);if(l===r&&l===n||l===n)return e;if(l===r)return t;var c=new Int32Array(r+n-l),d=0,f=0,p=0;for(d=0;d<i;d++)c[p++]=e[d];for(;f<u&&e[i]>t[f];)c[p++]=t[f++];for(;d<s&&f<u;){var h=e[d],v=t[f];h<v?(c[p++]=h,d++):h>v?(c[p++]=v,f++):(c[p++]=h,d++,f++)}for(;d<s;d++)c[p++]=e[d];for(;f<u;f++)c[p++]=t[f];for(;d<r;d++)c[p++]=e[d];for(;f<n;f++)c[p++]=t[f];return c}function iq(e,t){if(e===t)return uR(e);var r=Wd(e,t),n=r.startI,a=r.startJ,i=r.endI,o=r.endJ;return M_(e,t,n,a,i,o)}function M_(e,t,r,n,a,i){for(var o=r,s=n,u=0;o<a&&s<i;){var l=e[o],c=t[s];l<c?o++:l>c?s++:(o++,s++,u++)}return u}function oq(e,t){if(e===t)return e;var r=Wd(e,t),n=r.startI,a=r.startJ,i=r.endI,o=r.endJ,s=M_(e,t,n,a,i,o),u=e.length,l=t.length;if(!s)return iv;if(s===u&&s===l||s===l)return t;if(s===u)return e;for(var c=new Int32Array(s),d=0,f=n,p=a;f<i&&p<o;){var h=e[f],v=t[p];h<v?f++:(h>v||(c[d++]=h,f++),p++)}return c}function sq(e,t){if(e===t)return iv;for(var r=e.length,n=Wd(e,t),a=n.startI,i=n.startJ,o=n.endI,s=n.endJ,u=a,l=i,c=0;u<o&&l<s;){var d=e[u],f=t[l];d<f?u++:d>f?l++:(u++,l++,c++)}if(!c)return e;if(c>=r)return iv;for(var p=new Int32Array(r-c),h=0,v=0;v<a;v++)p[h++]=e[v];for(u=a,l=i;u<o&&l<s;){var d=e[u],f=t[l];d<f?(p[h++]=d,u++):(d>f||u++,l++)}for(;u<r;u++)p[h++]=e[u];return p}function uq(e){if(e.length<2)return e;for(var t=1,r=0,n=e.length-1;r<n;r++)e[r]!==e[r+1]&&t++;if(t===e.length)return e;for(var a=new Int32Array(t),i=0,r=0,n=e.length-1;r<n;r++)e[r]!==e[r+1]&&(a[i++]=e[r]);return a[i]=e[e.length-1],a}function lq(e,t){if(e===t)return WS(0,e.length-1);for(var r=Wd(e,t),n=r.startI,a=r.startJ,i=r.endI,o=r.endJ,s=n,u=a,l=0;s<i&&u<o;){var c=e[s],d=t[u];c<d?s++:c>d?u++:(s++,u++,l++)}var f=e.length;if(!l)return iv;if(l===f)return WS(0,e.length-1);var p=new Int32Array(l),h=0;for(s=n,u=a;s<i&&u<o;){var c=e[s],d=t[u];c<d?s++:(c>d||(p[h++]=s,s++),u++)}return p}var nu={startI:0,startJ:0,endI:0,endJ:0};function Wd(e,t){var r=e.length,n=t.length,a=r/n;return r>=128||n>=128||a<=.34||a>=2.99?(nu.startI=cd(e,YS(t)),nu.startJ=cd(t,YS(e)),nu.endI=cd(e,KS(t)),nu.endJ=cd(t,KS(e))):(nu.startI=0,nu.startJ=0,nu.endI=r,nu.endJ=n),nu}var Je;(function(e){e.Empty=iv,e.ofUnsortedArray=jG,e.ofSingleton=GG,e.ofSortedArray=qG,e.ofRange=L4,e.ofBounds=function(t,r){return L4(t,r-1)},e.is=WG,e.has=ZG,e.indexOf=lR,e.indexOfInInterval=QG,e.indexOfInRange=cR,e.start=YS,e.end=KS,e.min=XG,e.max=YG,e.size=uR,e.hashCode=KG,e.toString=$G,e.areEqual=JG,e.areIntersecting=nq,e.isSubset=aq,e.union=pR,e.intersect=oq,e.subtract=sq,e.findPredecessorIndex=cd,e.findPredecessorIndexInInterval=eq,e.findRange=tq,e.intersectionSize=iq,e.deduplicate=uq,e.indicesOf=lq})(Je||(Je={}));var Vs=Ie.Empty,cq=Ie.ofSingleton,dq=Ie.ofRange,fq=Ie.ofBounds;function vs(e){return e.length?e[e.length-1]-e[0]+1===e.length?Ie.ofRange(e[0],e[e.length-1]):e:Vs}function gd(e){return Ie.is(e)?Ie.size(e):Je.size(e)}function pq(e,t){return Ie.is(e)?Ie.has(e,t):Je.has(e,t)}function hq(e,t){return Ie.is(e)?Ie.indexOf(e,t):Je.indexOf(e,t)}function $S(e,t){return Ie.is(e)?Ie.getAt(e,t):e[t]}function cp(e){return Ie.is(e)?Ie.min(e):Je.min(e)}function dp(e){return Ie.is(e)?Ie.max(e):Je.max(e)}function vq(e){return Ie.is(e)?Ie.start(e):Je.start(e)}function mq(e){return Ie.is(e)?Ie.end(e):Je.end(e)}function gq(e){return Ie.is(e)?Ie.hashCode(e):Je.hashCode(e)}function yq(e){return Ie.is(e)?Ie.toString(e):Je.toString(e)}function bq(e,t){return Ie.is(e)?Ie.is(t)?Ie.areEqual(e,t):N4(e,t):Ie.is(t)?N4(t,e):Je.areEqual(e,t)}function Sq(e,t){return Ie.is(e)?Ie.is(t)?Ie.areIntersecting(e,t):U4(t,e):Ie.is(t)?U4(e,t):Je.areIntersecting(e,t)}function xq(e,t){return Ie.is(e)?Ie.is(t)?Ie.isSubInterval(e,t):Mq(e,t):Ie.is(t)?Iq(e,t):Je.isSubset(e,t)}function Cq(e,t){return Ie.is(e)?Ie.findPredecessorIndex(e,t):Je.findPredecessorIndex(e,t)}function _q(e,t,r){return Ie.is(e)?Ie.findPredecessorIndexInInterval(e,t,r):Je.findPredecessorIndexInInterval(e,t,r)}function wq(e,t,r){return Ie.is(e)?Ie.findRange(e,t,r):Je.findRange(e,t,r)}function Aq(e,t){return Ie.is(e)?Ie.is(t)?Ie.intersectionSize(e,t):V4(t,e):Ie.is(t)?V4(e,t):Je.intersectionSize(e,t)}function Pq(e,t){return Ie.is(e)?Ie.is(t)?Oq(e,t):z4(t,e):Ie.is(t)?z4(e,t):vs(Je.union(e,t))}function Tq(e,t){return Ie.is(e)?Ie.is(t)?Ie.intersect(e,t):H4(t,e):Ie.is(t)?H4(e,t):vs(Je.intersect(e,t))}function Eq(e,t){return Ie.is(e)?Ie.is(t)?Fq(e,t):Bq(e,t):Ie.is(t)?kq(e,t):vs(Je.subtract(e,t))}function N4(e,t){return Ie.size(e)===Je.size(t)&&Ie.start(e)===Je.start(t)&&Ie.end(e)===Je.end(t)}function U4(e,t){return e.length!==0&&Ie.size(Je.findRange(e,Ie.min(t),Ie.max(t)))!==0}function Iq(e,t){var r=Ie.min(t),n=Ie.max(t);if(n-r+1===0)return!0;var a=Je.min(e),i=Je.max(e);if(r<a||n>i)return!1;var o=Je.findRange(e,r,n);return Ie.size(o)===Ie.size(t)}function Mq(e,t){var r=Ie.min(e),n=Ie.max(e);if(n-r+1===0)return!1;var a=Je.min(t),i=Je.max(t);return a>=r&&i<=n}function Dq(e,t){var r=gd(e),n=gd(t);return r===0&&n===0?!0:r>0&&n>0&&dp(e)>=cp(t)&&cp(e)<=dp(t)}function Rq(e,t){return gd(e)?gd(t)?cp(e)<=cp(t)&&dp(e)>=dp(t):!0:gd(t)===0}function Oq(e,t){if(Ie.areEqual(e,t))return e;var r=Ie.size(e),n=Ie.size(t);if(!n)return e;if(!r)return t;var a=Ie.min(e),i=Ie.min(t);if(Dq(e,t))return Ie.ofRange(Math.min(a,i),Math.max(Ie.max(e),Ie.max(t)));var o,s,u,l;a<i?(o=r,s=a,u=n,l=i):(o=n,s=i,u=r,l=a);for(var c=new Int32Array(r+n),d=0;d<o;d++)c[d]=d+s;for(var d=0;d<u;d++)c[d+o]=d+l;return vs(c)}function z4(e,t){var r=Ie.size(t);if(!r)return e;if(Rq(t,e))return t;for(var n=Ie.min(t),a=Ie.max(t),i=Je.findRange(e,n,a),o=Ie.start(i),s=Ie.end(i),u=new Int32Array(o+(e.length-s)+r),l=0,c=0;c<o;c++)u[l++]=e[c];for(var c=n;c<=a;c++)u[l++]=c;for(var c=s,d=e.length;c<d;c++)u[l++]=e[c];return vs(u)}function V4(e,t){if(!Ie.size(t))return 0;var r=Je.findRange(e,Ie.min(t),Ie.max(t));return Ie.end(r)-Ie.start(r)}function H4(e,t){if(!Ie.size(t))return Vs;var r=Je.findRange(e,Ie.min(t),Ie.max(t)),n=Ie.start(r),a=Ie.end(r),i=a-n;if(!i)return Vs;if(i===e.length)return e;for(var o=new Int32Array(i),s=0,u=n;u<a;u++)o[s++]=e[u];return vs(o)}function Fq(e,t){if(Ie.areEqual(e,t))return Vs;if(!Ie.areIntersecting(e,t))return e;var r=Ie.min(e),n=Ie.max(e),a=Ie.min(t),i=Ie.max(t);if(n<r||i<a)return e;if(Ie.isSubInterval(t,e))return Vs;if(Ie.isSubInterval(e,t)){var o=a-r,s=n-i;if(o<=0)return Ie.ofRange(i+1,i+s);if(s<=0)return Ie.ofRange(r,r+o-1);for(var u=new Int32Array(o+s),l=0,c=0;c<o;c++)u[l++]=r+c;for(var c=1;c<=s;c++)u[l++]=i+c;return vs(u)}return r<a?Ie.ofRange(r,a-1):Ie.ofRange(i+1,n)}function kq(e,t){var r=Ie.min(t),n=Ie.max(t);if(n<r)return e;var a=Je.findRange(e,r,n),i=Ie.start(a),o=Ie.end(a),s=e.length-(o-i);if(s<=0)return Vs;if(s===e.length)return e;for(var u=new Int32Array(s),l=0,c=0;c<i;c++)u[l++]=e[c];for(var c=o,d=e.length;c<d;c++)u[l++]=e[c];return vs(u)}function Bq(e,t){var r=Ie.min(e),n=Ie.max(e);if(n<r)return e;var a=n-r+1,i=Je.findRange(t,r,n),o=Ie.start(i),s=Ie.end(i),u=s-o;if(u===0)return e;var l=a-u;if(l<=0)return Vs;for(var c=new Int32Array(l),d=t.length-1,f=t[Math.min(o,d)],p=t[Math.min(s,d)],h=0,v=r;v<f;v++)c[h++]=v;for(var v=f;v<=p;v++)Je.indexOfInInterval(t,v,i)<0&&(c[h++]=v);for(var v=p+1;v<=n;v++)c[h++]=v;return vs(c)}function Lq(e,t,r){if(Ie.is(e))for(var n=Ie.min(e),a=n,i=Ie.max(e);a<=i;a++)t(a,a-n,r);else for(var a=0,i=e.length;a<i;a++)t(e[a],a,r);return r}function Nq(e,t,r,n){if(Ie.is(e))for(var a=0,i=Ie.min(e),o=Ie.max(e);i<=o;i++){for(var s=t(i),u=i+1;u<o&&t(u)===s;)u++;i=u-1,r(s,a,n),a++}else for(var a=0,i=0,o=e.length;i<o;i++){for(var s=t(e[i]),u=i+1;u<o&&t(e[u])===s;)u++;i=u-1,r(s,a,n),a++}return n}function Uq(e,t,r){if(t===r)return e;var n=gd(e),a=t.length,i=r.length;if(n===0||a===0||i===0)return Vs;for(var o=Je.findPredecessorIndex(r,t[cp(e)]),s=Je.findPredecessorIndex(r,t[dp(e)]+1),u=0,l=0,c=0,d=o;c<n&&d<s;){var f=t[$S(e,c)],p=r[d];f<p?c++:(f>p||(u++,c++),d++)}if(u===0)return Vs;if(u===a&&u===i)return e;var h=new Int32Array(u);for(l=0,c=0,d=o;c<n&&d<s;){var f=t[$S(e,c)],p=r[d];f<p?c++:(f>p||(h[l++]=d,c++),d++)}return vs(h)}var ke;(function(e){e.Empty=Vs,e.ofSingleton=cq,e.ofRange=dq,e.ofBounds=fq,e.ofSortedArray=vs,e.has=pq,e.indexOf=hq,e.getAt=$S,e.min=cp,e.max=dp,e.start=vq,e.end=mq,e.size=gd,e.hashCode=gq,e.areEqual=bq,e.areIntersecting=Sq,e.isSubset=xq,e.union=Pq,e.intersect=Tq,e.indexedIntersect=Uq,e.subtract=Eq,e.findPredecessorIndex=Cq,e.findPredecessorIndexInInterval=_q,e.findRange=wq,e.intersectionSize=Aq;function t(s,u,l){return Lq(s,u,l)}e.forEach=t;function r(s,u,l,c){return Nq(s,u,l,c)}e.forEachSegment=r;function n(s){return Ie.is(s)}e.isInterval=n;function a(s){return!Ie.is(s)}e.isSortedArray=a;function i(s){var u=[];return e.forEach(s,function(l){return u.push(l)}),u}e.toArray=i;function o(s){return yq(s)}e.toString=o})(ke||(ke={}));function hR(e){for(var t=Je.ofSortedArray(e),r=Je.max(t),n=new Int32Array(r),a=0,i=e.length-1;a<i;a++)for(var o=e[a],s=e[a+1];o<s;o++)n[o]=a;return{offsets:t,index:n,count:e.length-1}}function zq(e,t){for(var r=Ie.start(t),n=new Int32Array(e.length+1),a=0,i=e.length;a<i;a++)n[a]=e[a]-r;return n[e.length]=Ie.end(t)-r,hR(n)}function Vq(e){var t=e.count;return t}function Hq(e,t){var r=e.index;return r[t]}function Gq(e,t,r){var n=e.offsets,a=ke.max(n),i=r>=a?-1:ke.findPredecessorIndex(n,r-1);return ke.findRange(t,ke.getAt(n,i),ke.getAt(n,i+1)-1)}var qq=function(){function e(t,r,n,a){this.segments=t,this.segmentMap=r,this.set=n,this.segmentMin=0,this.segmentMax=0,this.setRange=Ie.Empty,this.value={index:0,start:0,end:0},this.hasNext=!1,this.setRange=a,this.updateSegmentRange()}return e.prototype.move=function(){for(;this.hasNext;)if(this.updateValue()){this.value.index=this.segmentMin++,this.hasNext=this.segmentMax>=this.segmentMin&&Ie.size(this.setRange)>0;break}else this.updateSegmentRange();return this.value},e.prototype.updateValue=function(){var t=this.segments[this.segmentMin+1],r=ke.findPredecessorIndexInInterval(this.set,t,this.setRange);return this.value.start=Ie.start(this.setRange),this.value.end=r,this.setRange=Ie.ofBounds(r,Ie.end(this.setRange)),r>this.value.start},e.prototype.updateSegmentRange=function(){var t=Ie.min(this.setRange),r=Ie.max(this.setRange);if(r<t){this.hasNext=!1;return}this.segmentMin=this.segmentMap[ke.getAt(this.set,t)],this.segmentMax=this.segmentMap[ke.getAt(this.set,r)],this.hasNext=this.segmentMax>=this.segmentMin},e.prototype.setSegment=function(t){this.setRange=Ie.ofBounds(t.start,t.end),this.updateSegmentRange()},e}();function jq(e,t,r){var n=typeof r!="undefined"?Ie.ofBounds(r.start,r.end):Ie.ofBounds(0,ke.size(t));return new qq(e.offsets,e.index,t,n)}var nr;(function(e){e.create=hR,e.ofOffsets=zq,e.count=Vq,e.getSegment=Hq,e.projectValue=Gq,e.transientSegments=jq})(nr||(nr={}));function Wq(e){return new Xq(e)}var Xq=function(){function e(t){this.head=t>0?0:-1,this.prev=new Int32Array(t),this.next=new Int32Array(t);for(var r=0;r<t;r++)this.next[r]=r+1,this.prev[r]=r-1;this.prev[0]=-1,this.next[t-1]=-1}return e.prototype.remove=function(t){var r=this,n=r.prev,a=r.next,i=n[t],o=a[t];i>=0&&(a[i]=o,n[t]=-1),o>=0&&(n[o]=i,a[t]=-1),t===this.head&&(i<0?this.head=o:this.head=i)},e.prototype.has=function(t){return this.prev[t]>=0||this.next[t]>=0||this.head===t},e}(),Eo;(function(e){e.Empty=new Map;function t(o){return E_(o.keys())}e.keyArray=t;function r(){return new Map}e.Mutable=r;function n(o){return o}e.asImmutable=n;function a(o){for(var s=r(),u=o.keys();;){var l=u.next(),c=l.done,d=l.value;if(c)break;s.set(d,o.get(d))}return s}e.copy=a;function i(o,s){for(var u=s.keys();;){var l=u.next(),c=l.done,d=l.value;if(c)break;o.set(d,s.get(d))}return o}e.addFrom=i})(Eo||(Eo={}));var Yq=function(){function e(t){this.xs=[],this.index=-1,this.length=0,this.hasNext=!1,this.length=t.length,this.hasNext=t.length>0,this.xs=t,this.index=-1,this.lastValue=t.length>0?t[0]:void 0}return e.prototype.move=function(){return++this.index,this.lastValue=this.xs[this.index],this.hasNext=this.index<this.length-1,this.lastValue},e}(),G4=function(){function e(t,r){this.max=r,this.value=0,this.hasNext=!1,this.value=t-1,this.hasNext=r>=t}return e.prototype.move=function(){return++this.value,this.hasNext=this.value<this.max,this.value},e}(),Kq=function(){function e(t){this.value=t,this.hasNext=!0}return e.prototype.move=function(){return this.hasNext=!1,this.value},e}(),$q=function(){function e(t,r){this.base=t,this.f=r,this.hasNext=!1,this.hasNext=t.hasNext}return e.prototype.move=function(){var t=this.f(this.base.move());return this.hasNext=this.base.hasNext,t},e}(),Qq=function(){function e(t,r){this.base=t,this.p=r,this.hasNext=this.findNext()}return e.prototype.move=function(){var t=this.next;return this.hasNext=this.findNext(),t},e.prototype.findNext=function(){for(;this.base.hasNext;)if(this.next=this.base.move(),this.p(this.next))return!0;return!1},e}(),tg;(function(e){e.Empty=new G4(0,-1);function t(s){return new Yq(s)}e.Array=t;function r(s){return new Kq(s)}e.Value=r;function n(s,u){return new G4(s,u)}e.Range=n;function a(s,u){return new $q(s,u)}e.map=a;function i(s,u){return new Qq(s,u)}e.filter=i;function o(s,u,l){for(;s.hasNext;){var c=u(s.move(),l);if(c)return l}return l}e.forEach=o})(tg||(tg={}));var Zq={domain:[0,1],reverse:!1,listOrName:"red-yellow-blue",minLabel:"",maxLabel:""},us;(function(e){function t(r){var n=w(w({},Zq),r),a=n.domain,i=n.reverse,o=n.listOrName,s=typeof o=="string"?To(o).list:o,u=i?s.slice().reverse():s,l=u.length-1,c=0,d=0,f=0;function p(_,A){d=_,f=A,c=f-d||1}p(a[0],a[1]);var h=ia(r.minLabel,d.toString()),v=ia(r.maxLabel,f.toString()),m,g=u.every(function(_){return Array.isArray(_)});if(g){var y=Nt([],u);y.sort(function(_,A){return _[1]-A[1]});var b=y.map(function(_){return _[0]}),x=Je.ofSortedArray(y.map(function(_){return _[1]})),S=b.length-1;m=function(_){var A=Ka((_-d)/c,0,1),T=Je.findPredecessorIndex(x,A);if(T===0)return b[d];if(T>S)return b[S];var I=x[T-1],M=x[T],O=Ka((A-I)/(M-I),0,1);return it.interpolate(b[T-1],b[T],O)}}else m=function(_){var A=Math.min(u.length-1,Math.max(0,(_-d)/c*l)),T=Math.floor(A),I=u[T],M=u[Math.ceil(A)];return it.interpolate(I,M,A-T)};return{color:m,colorToArray:function(_,A,T){it.toArray(m(_),A,T)},normalizedColorToArray:function(_,A,T){it.toArrayNormalized(m(_),A,T)},setDomain:p,get legend(){return tG(h,v,u)}}}e.create=t})(us||(us={}));function tn(e){return e.svg?L("span",w({className:"msp-icon msp-material-icon"+(e.inline?" msp-icon-inline":""),title:e.title,style:e.style},{children:L(e.svg,{},void 0)}),void 0):null}var Py=L("circle",{r:"6px",id:"circle-left",cy:"12px",cx:"8px",strokeWidth:"1px"},void 0),Ty=L("circle",{r:"6px",id:"circle-right",cy:"12px",cx:"16px",strokeWidth:"1px"},void 0),Jq=Te("svg",w({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:[Te("defs",{children:[Py,Ty]},void 0),Te("g",{children:[L("use",{href:"#circle-left",className:"msp-shape-filled"},void 0),L("use",{href:"#circle-right",className:"msp-shape-filled"},void 0),L("use",{href:"#circle-left",className:"msp-shape-empty"},void 0)]},void 0)]}),void 0);function QS(){return Jq}var ej=Te("svg",w({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:[Te("defs",{children:[Py,Ty,Te("mask",w({id:"mask-left"},{children:[L("use",{href:"#circle-left",fill:"white",stroke:"white"},void 0),L("use",{href:"#circle-right",fill:"black",strokeWidth:"0px",stroke:"white"},void 0)]}),void 0)]},void 0),Te("g",{children:[L("use",{href:"#circle-left",className:"msp-shape-filled",mask:"url(#mask-left)"},void 0),L("use",{href:"#circle-right",className:"msp-shape-empty"},void 0)]},void 0)]}),void 0);function ZS(){return ej}var tj=Te("svg",w({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:[Te("defs",{children:[Py,Ty,L("clipPath",w({id:"clip-left"},{children:L("use",{href:"#circle-right"},void 0)}),void 0)]},void 0),Te("g",{children:[L("use",{href:"#circle-left",className:"msp-shape-filled",clipPath:"url(#clip-left)"},void 0),L("use",{href:"#circle-left",className:"msp-shape-empty"},void 0),L("use",{href:"#circle-right",className:"msp-shape-empty"},void 0)]},void 0)]}),void 0);function JS(){return tj}var rj=Te("svg",w({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:[Te("defs",{children:[Py,Ty]},void 0),Te("g",{children:[L("use",{href:"#circle-left",className:"msp-shape-empty"},void 0),L("use",{href:"#circle-right",className:"msp-shape-filled"},void 0)]},void 0)]}),void 0);function rg(){return rj}var nj=L("svg",w({width:"17px",height:"17px",viewBox:"0 0 299.463 299.463",strokeWidth:"6px"},{children:L("g",{children:L("path",{d:"M256.851,173.832v-48.201c22.916-4.918,34.151-30.668,22.556-50.771c-11.547-20.004-39.486-23.251-55.242-5.844 l-41.746-24.106C189.618,22.603,172.861,0,149.734,0c-23.132,0-39.881,22.609-32.685,44.911L75.305,69.016 C59.522,51.586,31.597,54.88,20.061,74.863c-11.63,20.163-0.298,45.862,22.557,50.769v48.2 c-22.821,4.898-34.195,30.591-22.556,50.771c11.529,19.972,39.454,23.285,55.242,5.845l41.746,24.106 c-7.199,22.308,9.559,44.911,32.685,44.911c23.132,0,39.88-22.609,32.685-44.911l41.745-24.106 c15.817,17.469,43.73,14.099,55.242-5.844c0,0,0-0.001,0.001-0.002c4.587-7.953,5.805-17.213,3.431-26.076 C279.392,185.657,269.129,176.461,256.851,173.832z M249.62,72.088c20.568,0,27.428,27.191,10.008,37.239 c-0.003,0.002-0.006,0.003-0.009,0.005c-10.04,5.81-22.85,1.762-27.877-8.475C225.206,87.548,234.938,72.088,249.62,72.088z M149.734,14.4c11.005,0,19.958,8.954,19.958,19.959c0,11.127-9.077,19.958-19.958,19.958c-10.95,0-19.958-8.9-19.958-19.958 C129.776,23.354,138.729,14.4,149.734,14.4z M39.84,109.328c-17.451-10.067-10.534-37.24,10.01-37.24 c15.311,0,24.922,16.653,17.251,29.942C61.681,111.397,49.517,114.925,39.84,109.328z M59.802,224.702 c-9.535,5.503-21.768,2.229-27.268-7.298c-7.639-13.242,1.887-29.945,17.236-29.945c0.013,0,0.027,0,0.04,0 C70.07,187.48,77.49,214.469,59.802,224.702z M149.734,285.062c-11.005,0-19.958-8.954-19.958-19.958 c0-11.127,9.077-19.958,19.958-19.958c10.954,0,19.958,8.903,19.958,19.958C169.693,276.109,160.74,285.062,149.734,285.062z M216.953,217.982l-41.727,24.095c-13.778-15.22-37.459-14.94-50.983,0l-41.728-24.096c6.196-19.289-5.541-39.835-25.498-44.149 V125.63c19.752-4.268,31.762-24.65,25.498-44.149l41.727-24.095c13.629,15.055,37.32,15.093,50.983,0l41.728,24.096 c-6.196,19.29,5.534,39.835,25.498,44.149v48.202C222.61,178.123,210.721,198.581,216.953,217.982z M266.935,217.404 c-5.501,9.528-17.732,12.802-27.261,7.302c-17.682-10.23-10.301-37.247,10.032-37.247 C264.984,187.459,274.602,204.112,266.935,217.404z"},void 0)},void 0)}),void 0);function aj(){return nj}var ij=L("svg",w({width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px"},{children:L("path",{d:"M21,16.5C21,16.88 20.79,17.21 20.47,17.38L12.57,21.82C12.41,21.94 12.21,22 12,22C11.79,22 11.59,21.94 11.43,21.82L3.53,17.38C3.21,17.21 3,16.88 3,16.5V7.5C3,7.12 3.21,6.79 3.53,6.62L11.43,2.18C11.59,2.06 11.79,2 12,2C12.21,2 12.41,2.06 12.57,2.18L20.47,6.62C20.79,6.79 21,7.12 21,7.5V16.5M12,4.15L6.04,7.5L12,10.85L17.96,7.5L12,4.15M5,15.91L11,19.29V12.58L5,9.21V15.91M19,15.91V9.21L13,12.58V19.29L19,15.91Z"},void 0)}),void 0);function ex(){return ij}L("svg",w({width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px"},{children:L("path",{d:"M17,22V20H20V17H22V20.5C22,20.89 21.84,21.24 21.54,21.54C21.24,21.84 20.89,22 20.5,22H17M7,22H3.5C3.11,22 2.76,21.84 2.46,21.54C2.16,21.24 2,20.89 2,20.5V17H4V20H7V22M17,2H20.5C20.89,2 21.24,2.16 21.54,2.46C21.84,2.76 22,3.11 22,3.5V7H20V4H17V2M7,2V4H4V7H2V3.5C2,3.11 2.16,2.76 2.46,2.46C2.76,2.16 3.11,2 3.5,2H7M13,17.25L17,14.95V10.36L13,12.66V17.25M12,10.92L16,8.63L12,6.28L8,8.63L12,10.92M7,14.95L11,17.25V12.66L7,10.36V14.95M18.23,7.59C18.73,7.91 19,8.34 19,8.91V15.23C19,15.8 18.73,16.23 18.23,16.55L12.75,19.73C12.25,20.05 11.75,20.05 11.25,19.73L5.77,16.55C5.27,16.23 5,15.8 5,15.23V8.91C5,8.34 5.27,7.91 5.77,7.59L11.25,4.41C11.5,4.28 11.75,4.22 12,4.22C12.25,4.22 12.5,4.28 12.75,4.41L18.23,7.59Z"},void 0)}),void 0);L("svg",w({width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px"},{children:L("path",{d:"M16,4L9,8.04V15.96L16,20L23,15.96V8.04M16,6.31L19.8,8.5L16,10.69L12.21,8.5M0,7V9H7V7M11,10.11L15,12.42V17.11L11,14.81M21,10.11V14.81L17,17.11V12.42M2,11V13H7V11M4,15V17H7V15"},void 0)}),void 0);var oj=L("svg",w({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:L("path",{d:"M10.07,14.27C10.57,14.03 11.16,14.25 11.4,14.75L13.7,19.74L15.5,18.89L13.19,13.91C12.95,13.41 13.17,12.81 13.67,12.58L13.95,12.5L16.25,12.05L8,5.12V15.9L9.82,14.43L10.07,14.27M13.64,21.97C13.14,22.21 12.54,22 12.31,21.5L10.13,16.76L7.62,18.78C7.45,18.92 7.24,19 7,19A1,1 0 0,1 6,18V3A1,1 0 0,1 7,2C7.24,2 7.47,2.09 7.64,2.23L7.65,2.22L19.14,11.86C19.57,12.22 19.62,12.85 19.27,13.27C19.12,13.45 18.91,13.57 18.7,13.61L15.54,14.23L17.74,18.96C18,19.46 17.76,20.05 17.26,20.28L13.64,21.97Z"},void 0)}),void 0);function sj(){return oj}L("svg",w({width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px"},{children:L("path",{fill:"currentColor",d:"M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"},void 0)}),void 0);var uj=L("svg",w({width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px"},{children:L("path",{d:"M3 17.25V21H6.75L17.81 9.93L14.06 6.18L3 17.25M22.61 18.36L18.36 22.61L13.16 17.41L14.93 15.64L15.93 16.64L18.4 14.16L19.82 15.58L18.36 17L19.42 18L20.84 16.6L22.61 18.36M6.61 10.83L1.39 5.64L5.64 1.39L7.4 3.16L4.93 5.64L6 6.7L8.46 4.22L9.88 5.64L8.46 7.05L9.46 8.05L6.61 10.83M20.71 7C21.1 6.61 21.1 6 20.71 5.59L18.37 3.29C18 2.9 17.35 2.9 16.96 3.29L15.12 5.12L18.87 8.87L20.71 7Z"},void 0)}),void 0);function lj(){return uj}var cj=L("svg",w({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:L("path",{d:"M22 11V3h-7v3H9V3H2v8h7V8h2v10h4v3h7v-8h-7v3h-2V8h2v3h7zM7 9H4V5h3v4zm10 6h3v4h-3v-4zm0-10h3v4h-3V5z"},void 0)}),void 0);function vR(){return cj}var dj=L("svg",w({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:L("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"},void 0)}),void 0);function _p(){return dj}var fj=L("svg",w({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:L("path",{d:"M20 12l-1.41-1.41L13 16.17V4h-2v12.17l-5.58-5.59L4 12l8 8 8-8z"},void 0)}),void 0);function Ey(){return fj}var pj=L("svg",w({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:L("path",{d:"M7 10l5 5 5-5z"},void 0)}),void 0);function Lu(){return pj}var hj=L("svg",w({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:L("path",{d:"M10 17l5-5-5-5v10z"},void 0)}),void 0);function Nu(){return hj}var vj=L("svg",w({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:L("path",{d:"M4 12l1.41 1.41L11 7.83V20h2V7.83l5.58 5.59L20 12l-8-8-8 8z"},void 0)}),void 0);function Iy(){return vj}var mj=L("svg",w({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:L("path",{d:"M12 6v3l4-4-4-4v3c-4.42 0-8 3.58-8 8 0 1.57.46 3.03 1.24 4.26L6.7 14.8c-.45-.83-.7-1.79-.7-2.8 0-3.31 2.69-6 6-6zm6.76 1.74L17.3 9.2c.44.84.7 1.79.7 2.8 0 3.31-2.69 6-6 6v-3l-4 4 4 4v-3c4.42 0 8-3.58 8-8 0-1.57-.46-3.03-1.24-4.26z"},void 0)}),void 0);function gj(){return mj}var yj=L("svg",w({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:L("path",{d:"M6 13c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0 4c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0-8c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm-3 .5c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zM6 5c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm15 5.5c.28 0 .5-.22.5-.5s-.22-.5-.5-.5-.5.22-.5.5.22.5.5.5zM14 7c.55 0 1-.45 1-1s-.45-1-1-1-1 .45-1 1 .45 1 1 1zm0-3.5c.28 0 .5-.22.5-.5s-.22-.5-.5-.5-.5.22-.5.5.22.5.5.5zm-11 10c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zm7 7c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zm0-17c.28 0 .5-.22.5-.5s-.22-.5-.5-.5-.5.22-.5.5.22.5.5.5zM10 7c.55 0 1-.45 1-1s-.45-1-1-1-1 .45-1 1 .45 1 1 1zm0 5.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm8 .5c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0 4c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0-8c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0-4c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm3 8.5c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zM14 17c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0 3.5c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zm-4-12c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm0 8.5c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm4-4.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm0-4c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5z"},void 0)}),void 0);function mR(){return yj}var bj=L("svg",w({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:L("path",{d:"M15 7v12.97l-4.21-1.81-.79-.34-.79.34L5 19.97V7h10m4-6H8.99C7.89 1 7 1.9 7 3h10c1.1 0 2 .9 2 2v13l2 1V3c0-1.1-.9-2-2-2zm-4 4H5c-1.1 0-2 .9-2 2v16l7-3 7 3V7c0-1.1-.9-2-2-2z"},void 0)}),void 0);function My(){return bj}var Sj=L("svg",w({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:L("path",{d:"M7 14c-1.66 0-3 1.34-3 3 0 1.31-1.16 2-2 2 .92 1.22 2.49 2 4 2 2.21 0 4-1.79 4-4 0-1.66-1.34-3-3-3zm13.71-9.37l-1.34-1.34a.9959.9959 0 00-1.41 0L9 12.25 11.75 15l8.96-8.96c.39-.39.39-1.02 0-1.41z"},void 0)}),void 0);function tx(){return Sj}var xj=L("svg",w({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:L("path",{d:"M22.61 18.99l-9.08-9.08c.93-2.34.45-5.1-1.44-7C9.79.61 6.21.4 3.66 2.26L7.5 6.11 6.08 7.52 2.25 3.69C.39 6.23.6 9.82 2.9 12.11c1.86 1.86 4.57 2.35 6.89 1.48l9.11 9.11c.39.39 1.02.39 1.41 0l2.3-2.3c.4-.38.4-1.01 0-1.41zm-3 1.6l-9.46-9.46c-.61.45-1.29.72-2 .82-1.36.2-2.79-.21-3.83-1.25C3.37 9.76 2.93 8.5 3 7.26l3.09 3.09 4.24-4.24-3.09-3.09c1.24-.07 2.49.37 3.44 1.31 1.08 1.08 1.49 2.57 1.24 3.96-.12.71-.42 1.37-.88 1.96l9.45 9.45-.88.89z"},void 0)}),void 0);function Cj(){return xj}var _j=L("svg",w({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:L("path",{d:"M22.7 19l-9.1-9.1c.9-2.3.4-5-1.5-6.9-2-2-5-2.4-7.4-1.3L9 6 6 9 1.6 4.7C.4 7.1.9 10.1 2.9 12.1c1.9 1.9 4.6 2.4 6.9 1.5l9.1 9.1c.4.4 1 .4 1.4 0l2.3-2.3c.5-.4.5-1.1.1-1.4z"},void 0)}),void 0);function wj(){return _j}var Aj=L("svg",w({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:L("path",{d:"M14.25 2.26l-.08-.04-.01.02C13.46 2.09 12.74 2 12 2 6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10c0-4.75-3.31-8.72-7.75-9.74zM19.41 9h-7.99l2.71-4.7c2.4.66 4.35 2.42 5.28 4.7zM13.1 4.08L10.27 9l-1.15 2L6.4 6.3C7.84 4.88 9.82 4 12 4c.37 0 .74.03 1.1.08zM5.7 7.09L8.54 12l1.15 2H4.26C4.1 13.36 4 12.69 4 12c0-1.85.64-3.55 1.7-4.91zM4.59 15h7.98l-2.71 4.7c-2.4-.67-4.34-2.42-5.27-4.7zm6.31 4.91L14.89 13l2.72 4.7C16.16 19.12 14.18 20 12 20c-.38 0-.74-.04-1.1-.09zm7.4-3l-4-6.91h5.43c.17.64.27 1.31.27 2 0 1.85-.64 3.55-1.7 4.91z"},void 0)}),void 0);function Pj(){return Aj}var Tj=L("svg",w({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:L("path",{d:"M9.4 10.5l4.77-8.26C13.47 2.09 12.75 2 12 2c-2.4 0-4.6.85-6.32 2.25l3.66 6.35.06-.1zM21.54 9c-.92-2.92-3.15-5.26-6-6.34L11.88 9h9.66zm.26 1h-7.49l.29.5 4.76 8.25C21 16.97 22 14.61 22 12c0-.69-.07-1.35-.2-2zM8.54 12l-3.9-6.75C3.01 7.03 2 9.39 2 12c0 .69.07 1.35.2 2h7.49l-1.15-2zm-6.08 3c.92 2.92 3.15 5.26 6 6.34L12.12 15H2.46zm11.27 0l-3.9 6.76c.7.15 1.42.24 2.17.24 2.4 0 4.6-.85 6.32-2.25l-3.66-6.35-.93 1.6z"},void 0)}),void 0);function Ej(){return Tj}var Ij=L("svg",w({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:L("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm3.59-13L12 10.59 8.41 7 7 8.41 10.59 12 7 15.59 8.41 17 12 13.41 15.59 17 17 15.59 13.41 12 17 8.41z"},void 0)}),void 0);function D_(){return Ij}var Mj=L("svg",w({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:L("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12 17 15.59z"},void 0)}),void 0);function gR(){return Mj}var Dj=L("svg",w({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:L("path",{d:"M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm-7 7H3v4c0 1.1.9 2 2 2h4v-2H5v-4zM5 5h4V3H5c-1.1 0-2 .9-2 2v4h2V5zm14-2h-4v2h4v4h2V5c0-1.1-.9-2-2-2zm0 16h-4v2h4c1.1 0 2-.9 2-2v-4h-2v4z"},void 0)}),void 0);function Rj(){return Dj}var Oj=L("svg",w({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:L("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"},void 0)}),void 0);function wp(){return Oj}var Fj=L("svg",w({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:L("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"},void 0)}),void 0);function yR(){return Fj}var kj=L("svg",w({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:L("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"},void 0)}),void 0);function Au(){return kj}var Bj=L("svg",w({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:L("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM14 13v4h-4v-4H7l5-5 5 5h-3z"},void 0)}),void 0);function Lj(){return Bj}var Nj=L("svg",w({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:L("path",{d:"M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"},void 0)}),void 0);function Uj(){return Nj}var zj=L("svg",w({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:L("path",{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm-1 4H8c-1.1 0-1.99.9-1.99 2L6 21c0 1.1.89 2 1.99 2H19c1.1 0 2-.9 2-2V11l-6-6zM8 21V7h6v5h5v9H8z"},void 0)}),void 0);function Vj(){return zj}var Hj=L("svg",w({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:L("path",{d:"M17 15h2V7c0-1.1-.9-2-2-2H9v2h8v8zM7 17V1H5v4H1v2h4v10c0 1.1.9 2 2 2h10v4h2v-4h4v-2H7z"},void 0)}),void 0);function Gj(){return Hj}var qj=L("svg",w({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:L("path",{d:"M3 5v4h2V5h4V3H5c-1.1 0-2 .9-2 2zm2 10H3v4c0 1.1.9 2 2 2h4v-2H5v-4zm14 4h-4v2h4c1.1 0 2-.9 2-2v-4h-2v4zm0-16h-4v2h4v4h2V5c0-1.1-.9-2-2-2z"},void 0)}),void 0);function jj(){return qj}var Wj=L("svg",w({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:L("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14zm-5.04-6.71l-2.75 3.54-1.96-2.36L6.5 17h11l-3.54-4.71z"},void 0)}),void 0);function Xj(){return Wj}var Yj=L("svg",w({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:L("path",{d:"M16 9v10H8V9h8m-1.5-6h-5l-1 1H5v2h14V4h-3.5l-1-1zM18 7H6v12c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7z"},void 0)}),void 0);function Oo(){return Yj}L("svg",w({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:L("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"},void 0)}),void 0);var Kj=L("svg",w({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:L("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"},void 0)}),void 0);function q4(){return Kj}L("svg",w({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:L("path",{d:"M20.5 11H19V7c0-1.1-.9-2-2-2h-4V3.5C13 2.12 11.88 1 10.5 1S8 2.12 8 3.5V5H4c-1.1 0-1.99.9-1.99 2v3.8H3.5c1.49 0 2.7 1.21 2.7 2.7s-1.21 2.7-2.7 2.7H2V20c0 1.1.9 2 2 2h3.8v-1.5c0-1.49 1.21-2.7 2.7-2.7 1.49 0 2.7 1.21 2.7 2.7V22H17c1.1 0 2-.9 2-2v-4h1.5c1.38 0 2.5-1.12 2.5-2.5S21.88 11 20.5 11z"},void 0)}),void 0);var $j=L("svg",w({width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px"},{children:L("path",{d:"M3 13h2v-2H3v2zm0 4h2v-2H3v2zm2 4v-2H3c0 1.1.89 2 2 2zM3 9h2V7H3v2zm12 12h2v-2h-2v2zm4-18H9c-1.11 0-2 .9-2 2v10c0 1.1.89 2 2 2h10c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 12H9V5h10v10zm-8 6h2v-2h-2v2zm-4 0h2v-2H7v2z"},void 0)}),void 0);function Qj(){return $j}var Zj=L("svg",w({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:L("path",{d:"M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"},void 0)}),void 0);function Jj(){return Zj}var eW=L("svg",w({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:L("path",{d:"M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"},void 0)}),void 0);function rx(){return eW}var tW=L("svg",w({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:L("path",{d:"M11 18h2v-2h-2v2zm1-16C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm0-14c-2.21 0-4 1.79-4 4h2c0-1.1.9-2 2-2s2 .9 2 2c0 2-3 1.75-3 5h2c0-2.25 3-2.5 3-5 0-2.21-1.79-4-4-4z"},void 0)}),void 0);function Hs(){return tW}var rW=L("svg",w({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:L("path",{d:"M12 5.69l5 4.5V18h-2v-6H9v6H7v-7.81l5-4.5M12 3L2 12h3v8h6v-6h2v6h6v-8h3L12 3z"},void 0)}),void 0);function nx(){return rW}L("svg",w({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:L("path",{d:"M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"},void 0)}),void 0);var nW=L("svg",w({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:L("path",{d:"M19.5 9.5c-1.03 0-1.9.62-2.29 1.5h-2.92c-.39-.88-1.26-1.5-2.29-1.5s-1.9.62-2.29 1.5H6.79c-.39-.88-1.26-1.5-2.29-1.5C3.12 9.5 2 10.62 2 12s1.12 2.5 2.5 2.5c1.03 0 1.9-.62 2.29-1.5h2.92c.39.88 1.26 1.5 2.29 1.5s1.9-.62 2.29-1.5h2.92c.39.88 1.26 1.5 2.29 1.5 1.38 0 2.5-1.12 2.5-2.5s-1.12-2.5-2.5-2.5z"},void 0)}),void 0);function aW(){return nW}var iW=L("svg",w({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:L("path",{d:"M6 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm12 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"},void 0)}),void 0);function Ed(){return iW}var oW=L("svg",w({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:L("path",{d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"},void 0)}),void 0);function bR(){return oW}var sW=L("svg",w({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:L("path",{d:"M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"},void 0)}),void 0);function SR(){return sW}var uW=L("svg",w({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:L("path",{d:"M19 4H5c-1.11 0-2 .9-2 2v12c0 1.1.89 2 2 2h4v-2H5V8h14v10h-4v2h4c1.1 0 2-.9 2-2V6c0-1.1-.89-2-2-2zm-7 6l-4 4h3v6h2v-6h3l-4-4z"},void 0)}),void 0);function lW(){return uW}var cW=L("svg",w({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:L("path",{d:"M8 5v14l11-7z"},void 0)}),void 0);function xR(){return cW}var dW=L("svg",w({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:L("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"},void 0)}),void 0);function ax(){return dW}var fW=L("svg",w({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:L("path",{d:"M19 13H5v-2h14v2z"},void 0)}),void 0);function ix(){return fW}var pW=L("svg",w({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:L("path",{d:"M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9zm-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8H12z"},void 0)}),void 0);function ox(){return pW}var hW=L("svg",w({width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px"},{children:L("path",{d:"M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm2 16H5V5h11.17L19 7.83V19zm-7-7c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3zM6 6h9v4H6z"},void 0)}),void 0);function CR(){return hW}var vW=Te("svg",w({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:[L("circle",{cx:"7",cy:"14",r:"3"},void 0),L("circle",{cx:"11",cy:"6",r:"3"},void 0),L("circle",{cx:"16.6",cy:"17.6",r:"3"},void 0)]}),void 0);function mW(){return vW}var gW=L("svg",w({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:L("path",{d:"M6 6h2v12H6zm3.5 6l8.5 6V6z"},void 0)}),void 0);function yW(){return gW}var bW=L("svg",w({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:L("path",{d:"M6 6h12v12H6z"},void 0)}),void 0);function _R(){return bW}var SW=L("svg",w({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:L("path",{d:"M4 6h16v2H4zm2-4h12v2H6zm14 8H4c-1.1 0-2 .9-2 2v8c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2v-8c0-1.1-.9-2-2-2zm0 10H4v-8h16v8zm-10-7.27v6.53L16 16z"},void 0)}),void 0);function xW(){return SW}var CW=L("svg",w({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:L("path",{d:"M6.99 11L3 15l3.99 4v-3H14v-2H6.99v-3zM21 9l-3.99-4v3H10v2h7.01v3L21 9z"},void 0)}),void 0);function _W(){return CW}var wW=L("svg",w({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:L("path",{d:"M3 17v2h6v-2H3zM3 5v2h10V5H3zm10 16v-2h8v-2h-8v-2h-2v6h2zM7 9v2H3v2h4v2h2V9H7zm14 4v-2H11v2h10zm-6-4h2V7h4V5h-4V3h-2v6z"},void 0)}),void 0);function Id(){return wW}var AW=L("svg",w({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:L("path",{d:"M12 6c3.79 0 7.17 2.13 8.82 5.5-.59 1.22-1.42 2.27-2.41 3.12l1.41 1.41c1.39-1.23 2.49-2.77 3.18-4.53C21.27 7.11 17 4 12 4c-1.27 0-2.49.2-3.64.57l1.65 1.65C10.66 6.09 11.32 6 12 6zm-1.07 1.14L13 9.21c.57.25 1.03.71 1.28 1.28l2.07 2.07c.08-.34.14-.7.14-1.07C16.5 9.01 14.48 7 12 7c-.37 0-.72.05-1.07.14zM2.01 3.87l2.68 2.68C3.06 7.83 1.77 9.53 1 11.5 2.73 15.89 7 19 12 19c1.52 0 2.98-.29 4.32-.82l3.42 3.42 1.41-1.41L3.42 2.45 2.01 3.87zm7.5 7.5l2.61 2.61c-.04.01-.08.02-.12.02-1.38 0-2.5-1.12-2.5-2.5 0-.05.01-.08.01-.13zm-3.4-3.4l1.75 1.75c-.23.55-.36 1.15-.36 1.78 0 2.48 2.02 4.5 4.5 4.5.63 0 1.23-.13 1.77-.36l.98.98c-.88.24-1.8.38-2.75.38-3.79 0-7.17-2.13-8.82-5.5.7-1.43 1.72-2.61 2.93-3.53z"},void 0)}),void 0);function Xd(){return AW}var PW=L("svg",w({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:L("path",{d:"M12 6c3.79 0 7.17 2.13 8.82 5.5C19.17 14.87 15.79 17 12 17s-7.17-2.13-8.82-5.5C4.83 8.13 8.21 6 12 6m0-2C7 4 2.73 7.11 1 11.5 2.73 15.89 7 19 12 19s9.27-3.11 11-7.5C21.27 7.11 17 4 12 4zm0 5c1.38 0 2.5 1.12 2.5 2.5S13.38 14 12 14s-2.5-1.12-2.5-2.5S10.62 9 12 9m0-2c-2.48 0-4.5 2.02-4.5 4.5S9.52 16 12 16s4.5-2.02 4.5-4.5S14.48 7 12 7z"},void 0)}),void 0);function Yd(){return PW}var TW=L("svg",w({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:L("path",{d:"M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"},void 0)}),void 0);function EW(){return TW}var IW=sj,MW=mW,j4=aW,DW=Qj,Pu=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!!r.props.initialExpanded},r.headerClicked=function(){r.props.onHeaderClick?r.props.onHeaderClick():r.setState({isExpanded:!r.state.isExpanded})},r}return t.prototype.render=function(){var r=this.props.hideOffset?"msp-control-group-children":"msp-control-group-children msp-control-offset";return this.props.childrenClassName&&(r+=" "+this.props.childrenClassName),Te("div",w({className:"msp-control-group-wrapper",style:{position:"relative",marginTop:this.props.noTopMargin?0:void 0}},{children:[L("div",w({className:"msp-control-group-header",style:{marginLeft:this.props.headerLeftMargin},title:this.props.title},{children:Te(pr,w({onClick:this.headerClicked},{children:[!this.props.hideExpander&&L(tn,{svg:this.state.isExpanded?Nu:Lu},void 0),this.props.topRightIcon&&L(tn,{svg:this.props.topRightIcon,style:{position:"absolute",right:"2px",top:0}},void 0),L("b",{children:this.props.header},void 0)]}),void 0)}),void 0),this.state.isExpanded&&L("div",w({className:r,style:{display:this.state.isExpanded?"block":"none",maxHeight:this.props.maxHeight,overflow:"hidden",overflowY:"auto"}},{children:this.props.children}),void 0)]}),void 0)},t}(kt.exports.Component);function W4(e){return e}var Du=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.input=kt.exports.createRef(),r.delayHandle=void 0,r.pendingValue=void 0,r.state={originalValue:"",value:""},r.onBlur=function(){r.setState({value:""+r.state.originalValue}),r.props.onBlur&&r.props.onBlur()},r.raiseOnChange=function(){r.pendingValue!==void 0&&(r.props.onChange(r.pendingValue),r.pendingValue=void 0)},r.onChange=function(n){var a=n.target.value,i=r.props.isValid&&!r.props.isValid(a)||r.props.numeric&&Number.isNaN(+a);if(i){r.clearTimeout(),r.setState({value:a});return}if(r.props.numeric)r.setState({value:a},function(){return r.triggerChanged(a,+a)});else{var o=(r.props.toValue||W4)(a),s=(r.props.fromValue||W4)(o);r.setState({value:s},function(){return r.triggerChanged(s,o)})}},r.onKeyUp=function(n){(n.charCode===27||n.keyCode===27||n.key==="Escape")&&r.props.blurOnEscape&&r.input.current&&r.input.current.blur()},r.onKeyPress=function(n){(n.keyCode===13||n.charCode===13||n.key==="Enter")&&(r.isPending&&(r.clearTimeout(),r.raiseOnChange()),r.props.blurOnEnter&&r.input.current&&r.input.current.blur(),r.props.onEnter&&r.props.onEnter()),n.stopPropagation()},r}return Object.defineProperty(t.prototype,"isPending",{get:function(){return typeof this.delayHandle!="undefined"},enumerable:!1,configurable:!0}),t.prototype.clearTimeout=function(){this.isPending&&(clearTimeout(this.delayHandle),this.delayHandle=void 0)},t.prototype.triggerChanged=function(r,n){this.clearTimeout(),r!==this.state.originalValue&&(this.props.delayMs?(this.pendingValue=n,this.delayHandle=setTimeout(this.raiseOnChange,this.props.delayMs)):this.props.onChange(n))},t.getDerivedStateFromProps=function(r,n){var a=r.fromValue?r.fromValue(r.value):r.value;return a===n.originalValue?null:{originalValue:a,value:a}},t.prototype.render=function(){return L("input",{type:"text",className:this.props.className,style:this.props.style,ref:this.input,onBlur:this.onBlur,value:this.state.value,placeholder:this.props.placeholder,onChange:this.onChange,onKeyPress:this.props.onEnter||this.props.blurOnEnter||this.props.blurOnEscape?this.onKeyPress:void 0,onKeyDown:this.props.blurOnEscape?this.onKeyUp:void 0,disabled:!!this.props.isDisabled},void 0)},t}(kt.exports.PureComponent),RW=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!1},r.toggleExpanded=function(){return r.setState({isExpanded:!r.state.isExpanded})},r}return t.prototype.render=function(){var r=this.props,n=r.label,a=r.pivot,i=r.controls;return Te(Rt,{children:[L(Io,w({label:Te(Rt,{children:[n,L("button",w({className:"msp-btn-link msp-btn-icon msp-control-group-expander",onClick:this.toggleExpanded,title:(this.state.isExpanded?"Less":"More")+" options",style:{background:"transparent",textAlign:"left",padding:"0"}},{children:L(tn,{svg:this.state.isExpanded?ix:_p,style:{display:"inline-block"}},void 0)}),void 0)]},void 0),control:a},{children:this.props.colorStripe&&L("div",{className:"msp-expandable-group-color-stripe",style:{backgroundColor:it.toStyle(this.props.colorStripe)}},void 0)}),void 0),this.state.isExpanded&&L("div",w({className:"msp-control-offset"},{children:i}),void 0)]},void 0)},t}(kt.exports.Component);function Tu(e){return Te("div",w({className:"msp-section-header"+(e.accent?" msp-transform-header-brand-"+e.accent:"")},{children:[e.icon&&L(tn,{svg:e.icon},void 0),e.title," ",L("small",{children:e.desc},void 0)]}),void 0)}function pr(e){var t="msp-btn";e.inline||(t+=" msp-btn-block"),e.noOverflow&&(t+=" msp-no-overflow"),e.flex&&(t+=" msp-flex-item"),(e.commit==="on"||e.commit)&&(t+=" msp-btn-commit msp-btn-commit-on"),e.commit==="off"&&(t+=" msp-btn-commit msp-btn-commit-off"),e.children||(t+=" msp-btn-childless"),e.className&&(t+=" "+e.className);var r=void 0;return e.flex&&(typeof e.flex=="number"?r={flex:"0 0 "+e.flex+"px",padding:0,maxWidth:e.flex+"px"}:typeof e.flex=="string"&&(r={flex:"0 0 "+e.flex,padding:0,maxWidth:e.flex})),e.style&&(r?Object.assign(r,e.style):r=e.style),Te("button",w({onClick:e.onClick,title:e.title,disabled:e.disabled,style:r,className:t,"data-id":e["data-id"],"data-color":e["data-color"],onContextMenu:e.onContextMenu,onMouseEnter:e.onMouseEnter,onMouseLeave:e.onMouseLeave},{children:[e.icon&&L(tn,{svg:e.icon},void 0),e.children]}),void 0)}function Gt(e){var t="msp-btn msp-btn-icon"+(e.small?"-small":"")+(e.className?" "+e.className:"");typeof e.toggleState!="undefined"&&(t+=" msp-btn-link-toggle-"+(e.toggleState?"on":"off")),e.transparent&&(t+=" msp-transparent-bg");var r=void 0;return e.flex&&(typeof e.flex=="boolean"?r={flex:"0 0 32px",padding:0}:typeof e.flex=="number"?r={flex:"0 0 "+e.flex+"px",padding:0,maxWidth:e.flex+"px"}:r={flex:"0 0 "+e.flex,padding:0,maxWidth:e.flex}),e.style&&(r?Object.assign(r,e.style):r=e.style),Te("button",w({className:t,onClick:e.onClick,title:e.title,disabled:e.disabled,"data-id":e["data-id"],style:r},{children:[e.svg&&L(tn,{svg:e.svg},void 0),e.extraContent]}),void 0)}var oa=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onClick=function(n){n.currentTarget.blur(),r.props.toggle()},r}return t.prototype.render=function(){var r=this.props,n=r.label,a=r.isSelected?(r.className||"")+" msp-control-current":r.className;return L(pr,w({icon:this.props.icon,onClick:this.onClick,title:this.props.title,inline:this.props.inline,disabled:r.disabled,style:r.style,className:a},{children:n&&this.props.isSelected?L("b",{children:n},void 0):n}),void 0)},t}(kt.exports.PureComponent),ls=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!!r.props.initiallyExpanded},r.toggleExpanded=function(){return r.setState({isExpanded:!r.state.isExpanded})},r}return t.prototype.render=function(){return Te(Rt,{children:[L("div",w({className:"msp-control-group-header",style:{marginTop:this.props.marginTop!==void 0?this.props.marginTop:"1px",marginLeft:this.props.headerLeftMargin}},{children:Te("button",w({className:"msp-btn msp-form-control msp-btn-block",onClick:this.toggleExpanded,style:this.props.headerStyle},{children:[L(tn,{svg:this.state.isExpanded?Lu:Nu},void 0),this.props.header]}),void 0)}),void 0),this.state.isExpanded&&(this.props.noOffset?this.props.children:L("div",w({className:this.props.accent?"msp-accent-offset":"msp-control-offset"},{children:this.props.children}),void 0))]},void 0)},t}(kt.exports.PureComponent);function Io(e){var t="msp-control-row";return e.className&&(t+=" "+e.className),Te("div",w({className:t},{children:[L("span",w({className:"msp-control-row-label",title:e.title},{children:e.label}),void 0),L("div",w({className:"msp-control-row-ctrl"},{children:e.control}),void 0),e.children]}),void 0)}var Dy=kt.exports.createContext(void 0),hr=function(e){Be(t,e);function t(r,n){var a=e.call(this,r)||this;return a.subs=void 0,a.plugin=n,a.init&&a.init(),a}return t.prototype.subscribe=function(r,n){typeof this.subs=="undefined"&&(this.subs=[]),this.subs.push(r.subscribe(n))},t.prototype.componentWillUnmount=function(){if(!!this.subs){for(var r=0,n=this.subs;r<n.length;r++){var a=n[r];a.unsubscribe()}this.subs=void 0}},t.contextType=Dy,t}(kt.exports.Component),Sa=function(e){Be(t,e);function t(r,n){var a=e.call(this,r,n)||this;return a.subs=void 0,a.plugin=n,a.init&&a.init(),a}return t.prototype.subscribe=function(r,n){typeof this.subs=="undefined"&&(this.subs=[]),this.subs.push(r.subscribe(n))},t.prototype.componentWillUnmount=function(){if(!!this.subs){for(var r=0,n=this.subs;r<n.length;r++){var a=n[r];a.unsubscribe()}this.subs=void 0}},t.contextType=Dy,t}(kt.exports.PureComponent),Ap=function(e){Be(t,e);function t(r,n){var a=e.call(this,r,n)||this;a.toggleCollapsed=function(){a.setState({isCollapsed:!a.state.isCollapsed})};var i=a.defaultState();return r.initiallyCollapsed!==void 0&&(i.isCollapsed=r.initiallyCollapsed),r.header!==void 0&&(i.header=r.header),a.state=i,a}return t.prototype.componentDidUpdate=function(r){this.props.initiallyCollapsed!==void 0&&r.initiallyCollapsed!==this.props.initiallyCollapsed&&this.setState({isCollapsed:this.props.initiallyCollapsed})},t.prototype.render=function(){var r;if(this.state.isHidden)return null;var n=this.state.isCollapsed?"msp-transform-wrapper msp-transform-wrapper-collapsed":"msp-transform-wrapper";return Te("div",w({className:n},{children:[L("div",w({className:"msp-transform-header"},{children:Te(pr,w({icon:this.state.brand?void 0:this.state.isCollapsed?Nu:Lu,noOverflow:!0,onClick:this.toggleCollapsed,className:this.state.brand?"msp-transform-header-brand msp-transform-header-brand-"+this.state.brand.accent:void 0,title:"Click to "+(this.state.isCollapsed?"expand":"collapse")},{children:[L(tn,{svg:(r=this.state.brand)===null||r===void 0?void 0:r.svg,inline:!0},void 0),this.state.header,L("small",w({style:{margin:"0 6px"}},{children:this.state.isCollapsed?"":this.state.description}),void 0)]}),void 0)}),void 0),!this.state.isCollapsed&&this.renderControls()]}),void 0)},t}(hr),Cn;(function(e){function t(){return function(a){return r(a)}}e.factory=t;function r(a){var i;return i=function(){function o(s,u){this.data=s,this.id=un.create22(),this.type=a,this.label=u&&u.label||a.name,this.description=u&&u.description}return o.is=function(s){return!!s&&a===s.type},o}(),i.type=a,i}e.create=r;function n(a,i){if(!a.tags)return!1;for(var o=0,s=a.tags;o<s.length;o++){var u=s[o];if(u===i)return!0}return!1}e.hasTag=n,e.Null={id:un.create22(),type:{name:"Null",typeClass:"Null"},data:void 0,label:"Null"}})(Cn||(Cn={}));var ov;(function(e){function t(n){var a=n;return!!a&&!!a.transform&&!!a.parent&&!!a.status}e.is=t;function r(n,a){var i=typeof a=="string"?a:e.is(a)?a.transform.ref:a.ref;return n.cells.get(i)}e.resolve=r})(ov||(ov={}));var wR=function(){function e(t,r){this.ref=t,this.state=r}return Object.defineProperty(e.prototype,"cell",{get:function(){var t;return(t=this.state)===null||t===void 0?void 0:t.cells.get(this.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"obj",{get:function(){var t,r;return(r=(t=this.state)===null||t===void 0?void 0:t.cells.get(this.ref))===null||r===void 0?void 0:r.obj},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"data",{get:function(){var t;return(t=this.obj)===null||t===void 0?void 0:t.data},enumerable:!1,configurable:!0}),e.prototype.update=function(t,r){if(!this.state)throw new Error("To use update() from StateObjectSelector, 'state' must be defined.");return r||(r=this.state.build()),(r||this.state.build()).to(this).update(t),r},e.prototype.checkValid=function(){if(!this.state)throw new Error("Unassigned State.");var t=this.cell;if(!t)throw new Error("Not created at all. Did you await/then the corresponding state update?");if(t.status==="ok")return!0;throw t.status==="error"?new Error(t.errorText):t.obj===Cn.Null?new Error("The object is Null."):new Error("Unresolved. Did you await/then the corresponding state update?")},Object.defineProperty(e.prototype,"isOk",{get:function(){var t=this.cell;return t&&t.status==="ok"&&t.obj!==Cn.Null},enumerable:!1,configurable:!0}),e}(),ua;(function(e){function t(a){var i;if(!!a)return typeof a=="string"?a:ov.is(a)?a.transform.ref:(i=a.cell)===null||i===void 0?void 0:i.transform.ref}e.resolveRef=t;function r(a,i){if(!!i)return ov.is(i)?i:typeof i=="string"?a.cells.get(i):i.cell}e.resolve=r;function n(a,i){var o=r(a,i);if(!(!o||!o.obj||o.status!=="ok"))return o}e.resolveAndCheck=n})(ua||(ua={}));var Nn={exports:{}};(function(e,t){(function(r,n){e.exports=n()})(nd,function(){var r=Array.prototype.slice;function n(P,B){B&&(P.prototype=Object.create(B.prototype)),P.prototype.constructor=P}function a(P){return u(P)?P:be(P)}n(i,a);function i(P){return l(P)?P:Ae(P)}n(o,a);function o(P){return c(P)?P:xe(P)}n(s,a);function s(P){return u(P)&&!d(P)?P:ae(P)}function u(P){return!!(P&&P[p])}function l(P){return!!(P&&P[h])}function c(P){return!!(P&&P[v])}function d(P){return l(P)||c(P)}function f(P){return!!(P&&P[m])}a.isIterable=u,a.isKeyed=l,a.isIndexed=c,a.isAssociative=d,a.isOrdered=f,a.Keyed=i,a.Indexed=o,a.Set=s;var p="@@__IMMUTABLE_ITERABLE__@@",h="@@__IMMUTABLE_KEYED__@@",v="@@__IMMUTABLE_INDEXED__@@",m="@@__IMMUTABLE_ORDERED__@@",g="delete",y=5,b=1<<y,x=b-1,S={},_={value:!1},A={value:!1};function T(P){return P.value=!1,P}function I(P){P&&(P.value=!0)}function M(){}function O(P,B){B=B||0;for(var Y=Math.max(0,P.length-B),re=new Array(Y),ie=0;ie<Y;ie++)re[ie]=P[ie+B];return re}function D(P){return P.size===void 0&&(P.size=P.__iterate(G)),P.size}function F(P,B){if(typeof B!="number"){var Y=B>>>0;if(""+Y!==B||Y===4294967295)return NaN;B=Y}return B<0?D(P)+B:B}function G(){return!0}function N(P,B,Y){return(P===0||Y!==void 0&&P<=-Y)&&(B===void 0||Y!==void 0&&B>=Y)}function z(P,B){return j(P,B,0)}function $(P,B){return j(P,B,B)}function j(P,B,Y){return P===void 0?Y:P<0?Math.max(0,B+P):B===void 0?P:Math.min(B,P)}var Z=0,q=1,te=2,he=typeof Symbol=="function"&&Symbol.iterator,W="@@iterator",K=he||W;function U(P){this.next=P}U.prototype.toString=function(){return"[Iterator]"},U.KEYS=Z,U.VALUES=q,U.ENTRIES=te,U.prototype.inspect=U.prototype.toSource=function(){return this.toString()},U.prototype[K]=function(){return this};function H(P,B,Y,re){var ie=P===0?B:P===1?Y:[B,Y];return re?re.value=ie:re={value:ie,done:!1},re}function J(){return{value:void 0,done:!0}}function X(P){return!!le(P)}function Q(P){return P&&typeof P.next=="function"}function ee(P){var B=le(P);return B&&B.call(P)}function le(P){var B=P&&(he&&P[he]||P[W]);if(typeof B=="function")return B}function ye(P){return P&&typeof P.length=="number"}n(be,a);function be(P){return P==null?He():u(P)?P.toSeq():Le(P)}be.of=function(){return be(arguments)},be.prototype.toSeq=function(){return this},be.prototype.toString=function(){return this.__toString("Seq {","}")},be.prototype.cacheResult=function(){return!this._cache&&this.__iterateUncached&&(this._cache=this.entrySeq().toArray(),this.size=this._cache.length),this},be.prototype.__iterate=function(P,B){return at(this,P,B,!0)},be.prototype.__iterator=function(P,B){return ot(this,P,B,!0)},n(Ae,be);function Ae(P){return P==null?He().toKeyedSeq():u(P)?l(P)?P.toSeq():P.fromEntrySeq():Ye(P)}Ae.prototype.toKeyedSeq=function(){return this},n(xe,be);function xe(P){return P==null?He():u(P)?l(P)?P.entrySeq():P.toIndexedSeq():lt(P)}xe.of=function(){return xe(arguments)},xe.prototype.toIndexedSeq=function(){return this},xe.prototype.toString=function(){return this.__toString("Seq [","]")},xe.prototype.__iterate=function(P,B){return at(this,P,B,!1)},xe.prototype.__iterator=function(P,B){return ot(this,P,B,!1)},n(ae,be);function ae(P){return(P==null?He():u(P)?l(P)?P.entrySeq():P:lt(P)).toSetSeq()}ae.of=function(){return ae(arguments)},ae.prototype.toSetSeq=function(){return this},be.isSeq=Ee,be.Keyed=Ae,be.Set=ae,be.Indexed=xe;var oe="@@__IMMUTABLE_SEQ__@@";be.prototype[oe]=!0,n(R,xe);function R(P){this._array=P,this.size=P.length}R.prototype.get=function(P,B){return this.has(P)?this._array[F(this,P)]:B},R.prototype.__iterate=function(P,B){for(var Y=this._array,re=Y.length-1,ie=0;ie<=re;ie++)if(P(Y[B?re-ie:ie],ie,this)===!1)return ie+1;return ie},R.prototype.__iterator=function(P,B){var Y=this._array,re=Y.length-1,ie=0;return new U(function(){return ie>re?J():H(P,ie,Y[B?re-ie++:ie++])})},n(V,Ae);function V(P){var B=Object.keys(P);this._object=P,this._keys=B,this.size=B.length}V.prototype.get=function(P,B){return B!==void 0&&!this.has(P)?B:this._object[P]},V.prototype.has=function(P){return this._object.hasOwnProperty(P)},V.prototype.__iterate=function(P,B){for(var Y=this._object,re=this._keys,ie=re.length-1,Se=0;Se<=ie;Se++){var Pe=re[B?ie-Se:Se];if(P(Y[Pe],Pe,this)===!1)return Se+1}return Se},V.prototype.__iterator=function(P,B){var Y=this._object,re=this._keys,ie=re.length-1,Se=0;return new U(function(){var Pe=re[B?ie-Se:Se];return Se++>ie?J():H(P,Pe,Y[Pe])})},V.prototype[m]=!0,n(pe,xe);function pe(P){this._iterable=P,this.size=P.length||P.size}pe.prototype.__iterateUncached=function(P,B){if(B)return this.cacheResult().__iterate(P,B);var Y=this._iterable,re=ee(Y),ie=0;if(Q(re))for(var Se;!(Se=re.next()).done&&P(Se.value,ie++,this)!==!1;);return ie},pe.prototype.__iteratorUncached=function(P,B){if(B)return this.cacheResult().__iterator(P,B);var Y=this._iterable,re=ee(Y);if(!Q(re))return new U(J);var ie=0;return new U(function(){var Se=re.next();return Se.done?Se:H(P,ie++,Se.value)})},n(_e,xe);function _e(P){this._iterator=P,this._iteratorCache=[]}_e.prototype.__iterateUncached=function(P,B){if(B)return this.cacheResult().__iterate(P,B);for(var Y=this._iterator,re=this._iteratorCache,ie=0;ie<re.length;)if(P(re[ie],ie++,this)===!1)return ie;for(var Se;!(Se=Y.next()).done;){var Pe=Se.value;if(re[ie]=Pe,P(Pe,ie++,this)===!1)break}return ie},_e.prototype.__iteratorUncached=function(P,B){if(B)return this.cacheResult().__iterator(P,B);var Y=this._iterator,re=this._iteratorCache,ie=0;return new U(function(){if(ie>=re.length){var Se=Y.next();if(Se.done)return Se;re[ie]=Se.value}return H(P,ie,re[ie++])})};function Ee(P){return!!(P&&P[oe])}var Ve;function He(){return Ve||(Ve=new R([]))}function Ye(P){var B=Array.isArray(P)?new R(P).fromEntrySeq():Q(P)?new _e(P).fromEntrySeq():X(P)?new pe(P).fromEntrySeq():typeof P=="object"?new V(P):void 0;if(!B)throw new TypeError("Expected Array or iterable object of [k, v] entries, or keyed object: "+P);return B}function lt(P){var B=Qe(P);if(!B)throw new TypeError("Expected Array or iterable object of values: "+P);return B}function Le(P){var B=Qe(P)||typeof P=="object"&&new V(P);if(!B)throw new TypeError("Expected Array or iterable object of values, or keyed object: "+P);return B}function Qe(P){return ye(P)?new R(P):Q(P)?new _e(P):X(P)?new pe(P):void 0}function at(P,B,Y,re){var ie=P._cache;if(ie){for(var Se=ie.length-1,Pe=0;Pe<=Se;Pe++){var Ue=ie[Y?Se-Pe:Pe];if(B(Ue[1],re?Ue[0]:Pe,P)===!1)return Pe+1}return Pe}return P.__iterateUncached(B,Y)}function ot(P,B,Y,re){var ie=P._cache;if(ie){var Se=ie.length-1,Pe=0;return new U(function(){var Ue=ie[Y?Se-Pe:Pe];return Pe++>Se?J():H(B,re?Ue[0]:Pe-1,Ue[1])})}return P.__iteratorUncached(B,Y)}function dt(P,B){return B?Oe(B,P,"",{"":P}):Me(P)}function Oe(P,B,Y,re){return Array.isArray(B)?P.call(re,Y,xe(B).map(function(ie,Se){return Oe(P,ie,Se,B)})):Ke(B)?P.call(re,Y,Ae(B).map(function(ie,Se){return Oe(P,ie,Se,B)})):B}function Me(P){return Array.isArray(P)?xe(P).map(Me).toList():Ke(P)?Ae(P).map(Me).toMap():P}function Ke(P){return P&&(P.constructor===Object||P.constructor===void 0)}function tt(P,B){if(P===B||P!==P&&B!==B)return!0;if(!P||!B)return!1;if(typeof P.valueOf=="function"&&typeof B.valueOf=="function"){if(P=P.valueOf(),B=B.valueOf(),P===B||P!==P&&B!==B)return!0;if(!P||!B)return!1}return!!(typeof P.equals=="function"&&typeof B.equals=="function"&&P.equals(B))}function St(P,B){if(P===B)return!0;if(!u(B)||P.size!==void 0&&B.size!==void 0&&P.size!==B.size||P.__hash!==void 0&&B.__hash!==void 0&&P.__hash!==B.__hash||l(P)!==l(B)||c(P)!==c(B)||f(P)!==f(B))return!1;if(P.size===0&&B.size===0)return!0;var Y=!d(P);if(f(P)){var re=P.entries();return B.every(function(et,st){var yt=re.next().value;return yt&&tt(yt[1],et)&&(Y||tt(yt[0],st))})&&re.next().done}var ie=!1;if(P.size===void 0)if(B.size===void 0)typeof P.cacheResult=="function"&&P.cacheResult();else{ie=!0;var Se=P;P=B,B=Se}var Pe=!0,Ue=B.__iterate(function(et,st){if(Y?!P.has(et):ie?!tt(et,P.get(st,S)):!tt(P.get(st,S),et))return Pe=!1,!1});return Pe&&P.size===Ue}n(ht,xe);function ht(P,B){if(!(this instanceof ht))return new ht(P,B);if(this._value=P,this.size=B===void 0?1/0:Math.max(0,B),this.size===0){if(ut)return ut;ut=this}}ht.prototype.toString=function(){return this.size===0?"Repeat []":"Repeat [ "+this._value+" "+this.size+" times ]"},ht.prototype.get=function(P,B){return this.has(P)?this._value:B},ht.prototype.includes=function(P){return tt(this._value,P)},ht.prototype.slice=function(P,B){var Y=this.size;return N(P,B,Y)?this:new ht(this._value,$(B,Y)-z(P,Y))},ht.prototype.reverse=function(){return this},ht.prototype.indexOf=function(P){return tt(this._value,P)?0:-1},ht.prototype.lastIndexOf=function(P){return tt(this._value,P)?this.size:-1},ht.prototype.__iterate=function(P,B){for(var Y=0;Y<this.size;Y++)if(P(this._value,Y,this)===!1)return Y+1;return Y},ht.prototype.__iterator=function(P,B){var Y=this,re=0;return new U(function(){return re<Y.size?H(P,re++,Y._value):J()})},ht.prototype.equals=function(P){return P instanceof ht?tt(this._value,P._value):St(P)};var ut;function fe(P,B){if(!P)throw new Error(B)}n(me,xe);function me(P,B,Y){if(!(this instanceof me))return new me(P,B,Y);if(fe(Y!==0,"Cannot step a Range by 0"),P=P||0,B===void 0&&(B=1/0),Y=Y===void 0?1:Math.abs(Y),B<P&&(Y=-Y),this._start=P,this._end=B,this._step=Y,this.size=Math.max(0,Math.ceil((B-P)/Y-1)+1),this.size===0){if(we)return we;we=this}}me.prototype.toString=function(){return this.size===0?"Range []":"Range [ "+this._start+"..."+this._end+(this._step!==1?" by "+this._step:"")+" ]"},me.prototype.get=function(P,B){return this.has(P)?this._start+F(this,P)*this._step:B},me.prototype.includes=function(P){var B=(P-this._start)/this._step;return B>=0&&B<this.size&&B===Math.floor(B)},me.prototype.slice=function(P,B){return N(P,B,this.size)?this:(P=z(P,this.size),B=$(B,this.size),B<=P?new me(0,0):new me(this.get(P,this._end),this.get(B,this._end),this._step))},me.prototype.indexOf=function(P){var B=P-this._start;if(B%this._step===0){var Y=B/this._step;if(Y>=0&&Y<this.size)return Y}return-1},me.prototype.lastIndexOf=function(P){return this.indexOf(P)},me.prototype.__iterate=function(P,B){for(var Y=this.size-1,re=this._step,ie=B?this._start+Y*re:this._start,Se=0;Se<=Y;Se++){if(P(ie,Se,this)===!1)return Se+1;ie+=B?-re:re}return Se},me.prototype.__iterator=function(P,B){var Y=this.size-1,re=this._step,ie=B?this._start+Y*re:this._start,Se=0;return new U(function(){var Pe=ie;return ie+=B?-re:re,Se>Y?J():H(P,Se++,Pe)})},me.prototype.equals=function(P){return P instanceof me?this._start===P._start&&this._end===P._end&&this._step===P._step:St(this,P)};var we;n($e,a);function $e(){throw TypeError("Abstract")}n(gt,$e);function gt(){}n(Tt,$e);function Tt(){}n(Wt,$e);function Wt(){}$e.Keyed=gt,$e.Indexed=Tt,$e.Set=Wt;var lr=typeof Math.imul=="function"&&Math.imul(4294967295,2)===-2?Math.imul:function(B,Y){B=B|0,Y=Y|0;var re=B&65535,ie=Y&65535;return re*ie+((B>>>16)*ie+re*(Y>>>16)<<16>>>0)|0};function wr(P){return P>>>1&1073741824|P&3221225471}function Yt(P){if(P===!1||P===null||P===void 0||typeof P.valueOf=="function"&&(P=P.valueOf(),P===!1||P===null||P===void 0))return 0;if(P===!0)return 1;var B=typeof P;if(B==="number"){if(P!==P||P===1/0)return 0;var Y=P|0;for(Y!==P&&(Y^=P*4294967295);P>4294967295;)P/=4294967295,Y^=P;return wr(Y)}if(B==="string")return P.length>Sl?zn(P):_a(P);if(typeof P.hashCode=="function")return P.hashCode();if(B==="object")return wa(P);if(typeof P.toString=="function")return _a(P.toString());throw new Error("Value type "+B+" cannot be hashed.")}function zn(P){var B=Oc[P];return B===void 0&&(B=_a(P),Rc===Zv&&(Rc=0,Oc={}),Rc++,Oc[P]=B),B}function _a(P){for(var B=0,Y=0;Y<P.length;Y++)B=31*B+P.charCodeAt(Y)|0;return wr(B)}function wa(P){var B;if(Bo&&(B=Mc.get(P),B!==void 0)||(B=P[hi],B!==void 0)||!ms&&(B=P.propertyIsEnumerable&&P.propertyIsEnumerable[hi],B!==void 0||(B=eu(P),B!==void 0)))return B;if(B=++Dc,Dc&1073741824&&(Dc=0),Bo)Mc.set(P,B);else{if(Ri!==void 0&&Ri(P)===!1)throw new Error("Non-extensible objects are not allowed as keys.");if(ms)Object.defineProperty(P,hi,{enumerable:!1,configurable:!1,writable:!1,value:B});else if(P.propertyIsEnumerable!==void 0&&P.propertyIsEnumerable===P.constructor.prototype.propertyIsEnumerable)P.propertyIsEnumerable=function(){return this.constructor.prototype.propertyIsEnumerable.apply(this,arguments)},P.propertyIsEnumerable[hi]=B;else if(P.nodeType!==void 0)P[hi]=B;else throw new Error("Unable to set a non-enumerable property on object.")}return B}var Ri=Object.isExtensible,ms=function(){try{return Object.defineProperty({},"@",{}),!0}catch{return!1}}();function eu(P){if(P&&P.nodeType>0)switch(P.nodeType){case 1:return P.uniqueID;case 9:return P.documentElement&&P.documentElement.uniqueID}}var Bo=typeof WeakMap=="function",Mc;Bo&&(Mc=new WeakMap);var Dc=0,hi="__immutablehash__";typeof Symbol=="function"&&(hi=Symbol(hi));var Sl=16,Zv=255,Rc=0,Oc={};function ri(P){fe(P!==1/0,"Cannot perform this action with an infinite size.")}n(Yr,gt);function Yr(P){return P==null?Lo():B1(P)&&!f(P)?P:Lo().withMutations(function(B){var Y=i(P);ri(Y.size),Y.forEach(function(re,ie){return B.set(ie,re)})})}Yr.of=function(){var P=r.call(arguments,0);return Lo().withMutations(function(B){for(var Y=0;Y<P.length;Y+=2){if(Y+1>=P.length)throw new Error("Missing value for key: "+P[Y]);B.set(P[Y],P[Y+1])}})},Yr.prototype.toString=function(){return this.__toString("Map {","}")},Yr.prototype.get=function(P,B){return this._root?this._root.get(0,void 0,P,B):B},Yr.prototype.set=function(P,B){return Hw(this,P,B)},Yr.prototype.setIn=function(P,B){return this.updateIn(P,S,function(){return B})},Yr.prototype.remove=function(P){return Hw(this,P,S)},Yr.prototype.deleteIn=function(P){return this.updateIn(P,function(){return S})},Yr.prototype.update=function(P,B,Y){return arguments.length===1?P(this):this.updateIn([P],B,Y)},Yr.prototype.updateIn=function(P,B,Y){Y||(Y=B,B=void 0);var re=Xw(this,hA(P),B,Y);return re===S?void 0:re},Yr.prototype.clear=function(){return this.size===0?this:this.__ownerID?(this.size=0,this._root=null,this.__hash=void 0,this.__altered=!0,this):Lo()},Yr.prototype.merge=function(){return Jv(this,void 0,arguments)},Yr.prototype.mergeWith=function(P){var B=r.call(arguments,1);return Jv(this,P,B)},Yr.prototype.mergeIn=function(P){var B=r.call(arguments,1);return this.updateIn(P,Lo(),function(Y){return typeof Y.merge=="function"?Y.merge.apply(Y,B):B[B.length-1]})},Yr.prototype.mergeDeep=function(){return Jv(this,qw,arguments)},Yr.prototype.mergeDeepWith=function(P){var B=r.call(arguments,1);return Jv(this,jw(P),B)},Yr.prototype.mergeDeepIn=function(P){var B=r.call(arguments,1);return this.updateIn(P,Lo(),function(Y){return typeof Y.mergeDeep=="function"?Y.mergeDeep.apply(Y,B):B[B.length-1]})},Yr.prototype.sort=function(P){return Qn(gf(this,P))},Yr.prototype.sortBy=function(P,B){return Qn(gf(this,B,P))},Yr.prototype.withMutations=function(P){var B=this.asMutable();return P(B),B.wasAltered()?B.__ensureOwner(this.__ownerID):this},Yr.prototype.asMutable=function(){return this.__ownerID?this:this.__ensureOwner(new M)},Yr.prototype.asImmutable=function(){return this.__ensureOwner()},Yr.prototype.wasAltered=function(){return this.__altered},Yr.prototype.__iterator=function(P,B){return new L1(this,P,B)},Yr.prototype.__iterate=function(P,B){var Y=this,re=0;return this._root&&this._root.iterate(function(ie){return re++,P(ie[1],ie[0],Y)},B),re},Yr.prototype.__ensureOwner=function(P){return P===this.__ownerID?this:P?U1(this.size,this._root,P,this.__hash):(this.__ownerID=P,this.__altered=!1,this)};function B1(P){return!!(P&&P[Uw])}Yr.isMap=B1;var Uw="@@__IMMUTABLE_MAP__@@",Hr=Yr.prototype;Hr[Uw]=!0,Hr[g]=Hr.remove,Hr.removeIn=Hr.deleteIn;function Hp(P,B){this.ownerID=P,this.entries=B}Hp.prototype.get=function(P,B,Y,re){for(var ie=this.entries,Se=0,Pe=ie.length;Se<Pe;Se++)if(tt(Y,ie[Se][0]))return ie[Se][1];return re},Hp.prototype.update=function(P,B,Y,re,ie,Se,Pe){for(var Ue=ie===S,et=this.entries,st=0,yt=et.length;st<yt&&!tt(re,et[st][0]);st++);var Bt=st<yt;if(Bt?et[st][1]===ie:Ue)return this;if(I(Pe),(Ue||!Bt)&&I(Se),!(Ue&&et.length===1)){if(!Bt&&!Ue&&et.length>=o7)return t7(P,et,re,ie);var qt=P&&P===this.ownerID,br=qt?et:O(et);return Bt?Ue?st===yt-1?br.pop():br[st]=br.pop():br[st]=[re,ie]:br.push([re,ie]),qt?(this.entries=br,this):new Hp(P,br)}};function df(P,B,Y){this.ownerID=P,this.bitmap=B,this.nodes=Y}df.prototype.get=function(P,B,Y,re){B===void 0&&(B=Yt(Y));var ie=1<<((P===0?B:B>>>P)&x),Se=this.bitmap;return(Se&ie)===0?re:this.nodes[Yw(Se&ie-1)].get(P+y,B,Y,re)},df.prototype.update=function(P,B,Y,re,ie,Se,Pe){Y===void 0&&(Y=Yt(re));var Ue=(B===0?Y:Y>>>B)&x,et=1<<Ue,st=this.bitmap,yt=(st&et)!==0;if(!yt&&ie===S)return this;var Bt=Yw(st&et-1),qt=this.nodes,br=yt?qt[Bt]:void 0,Ur=z1(br,P,B+y,Y,re,ie,Se,Pe);if(Ur===br)return this;if(!yt&&Ur&&qt.length>=s7)return n7(P,qt,st,Ue,Ur);if(yt&&!Ur&&qt.length===2&&Gw(qt[Bt^1]))return qt[Bt^1];if(yt&&Ur&&qt.length===1&&Gw(Ur))return Ur;var On=P&&P===this.ownerID,No=yt?Ur?st:st^et:st|et,Ss=yt?Ur?Kw(qt,Bt,Ur,On):i7(qt,Bt,On):a7(qt,Bt,Ur,On);return On?(this.bitmap=No,this.nodes=Ss,this):new df(P,No,Ss)};function Gp(P,B,Y){this.ownerID=P,this.count=B,this.nodes=Y}Gp.prototype.get=function(P,B,Y,re){B===void 0&&(B=Yt(Y));var ie=(P===0?B:B>>>P)&x,Se=this.nodes[ie];return Se?Se.get(P+y,B,Y,re):re},Gp.prototype.update=function(P,B,Y,re,ie,Se,Pe){Y===void 0&&(Y=Yt(re));var Ue=(B===0?Y:Y>>>B)&x,et=ie===S,st=this.nodes,yt=st[Ue];if(et&&!yt)return this;var Bt=z1(yt,P,B+y,Y,re,ie,Se,Pe);if(Bt===yt)return this;var qt=this.count;if(!yt)qt++;else if(!Bt&&(qt--,qt<u7))return r7(P,st,qt,Ue);var br=P&&P===this.ownerID,Ur=Kw(st,Ue,Bt,br);return br?(this.count=qt,this.nodes=Ur,this):new Gp(P,qt,Ur)};function ff(P,B,Y){this.ownerID=P,this.keyHash=B,this.entries=Y}ff.prototype.get=function(P,B,Y,re){for(var ie=this.entries,Se=0,Pe=ie.length;Se<Pe;Se++)if(tt(Y,ie[Se][0]))return ie[Se][1];return re},ff.prototype.update=function(P,B,Y,re,ie,Se,Pe){Y===void 0&&(Y=Yt(re));var Ue=ie===S;if(Y!==this.keyHash)return Ue?this:(I(Pe),I(Se),V1(this,P,B,Y,[re,ie]));for(var et=this.entries,st=0,yt=et.length;st<yt&&!tt(re,et[st][0]);st++);var Bt=st<yt;if(Bt?et[st][1]===ie:Ue)return this;if(I(Pe),(Ue||!Bt)&&I(Se),Ue&&yt===2)return new tu(P,this.keyHash,et[st^1]);var qt=P&&P===this.ownerID,br=qt?et:O(et);return Bt?Ue?st===yt-1?br.pop():br[st]=br.pop():br[st]=[re,ie]:br.push([re,ie]),qt?(this.entries=br,this):new ff(P,this.keyHash,br)};function tu(P,B,Y){this.ownerID=P,this.keyHash=B,this.entry=Y}tu.prototype.get=function(P,B,Y,re){return tt(Y,this.entry[0])?this.entry[1]:re},tu.prototype.update=function(P,B,Y,re,ie,Se,Pe){var Ue=ie===S,et=tt(re,this.entry[0]);if(et?ie===this.entry[1]:Ue)return this;if(I(Pe),Ue){I(Se);return}return et?P&&P===this.ownerID?(this.entry[1]=ie,this):new tu(P,this.keyHash,[re,ie]):(I(Se),V1(this,P,B,Yt(re),[re,ie]))},Hp.prototype.iterate=ff.prototype.iterate=function(P,B){for(var Y=this.entries,re=0,ie=Y.length-1;re<=ie;re++)if(P(Y[B?ie-re:re])===!1)return!1},df.prototype.iterate=Gp.prototype.iterate=function(P,B){for(var Y=this.nodes,re=0,ie=Y.length-1;re<=ie;re++){var Se=Y[B?ie-re:re];if(Se&&Se.iterate(P,B)===!1)return!1}},tu.prototype.iterate=function(P,B){return P(this.entry)},n(L1,U);function L1(P,B,Y){this._type=B,this._reverse=Y,this._stack=P._root&&zw(P._root)}L1.prototype.next=function(){for(var P=this._type,B=this._stack;B;){var Y=B.node,re=B.index++,ie;if(Y.entry){if(re===0)return N1(P,Y.entry)}else if(Y.entries){if(ie=Y.entries.length-1,re<=ie)return N1(P,Y.entries[this._reverse?ie-re:re])}else if(ie=Y.nodes.length-1,re<=ie){var Se=Y.nodes[this._reverse?ie-re:re];if(Se){if(Se.entry)return N1(P,Se.entry);B=this._stack=zw(Se,B)}continue}B=this._stack=this._stack.__prev}return J()};function N1(P,B){return H(P,B[0],B[1])}function zw(P,B){return{node:P,index:0,__prev:B}}function U1(P,B,Y,re){var ie=Object.create(Hr);return ie.size=P,ie._root=B,ie.__ownerID=Y,ie.__hash=re,ie.__altered=!1,ie}var Vw;function Lo(){return Vw||(Vw=U1(0))}function Hw(P,B,Y){var re,ie;if(P._root){var Se=T(_),Pe=T(A);if(re=z1(P._root,P.__ownerID,0,void 0,B,Y,Se,Pe),!Pe.value)return P;ie=P.size+(Se.value?Y===S?-1:1:0)}else{if(Y===S)return P;ie=1,re=new Hp(P.__ownerID,[[B,Y]])}return P.__ownerID?(P.size=ie,P._root=re,P.__hash=void 0,P.__altered=!0,P):re?U1(ie,re):Lo()}function z1(P,B,Y,re,ie,Se,Pe,Ue){return P?P.update(B,Y,re,ie,Se,Pe,Ue):Se===S?P:(I(Ue),I(Pe),new tu(B,re,[ie,Se]))}function Gw(P){return P.constructor===tu||P.constructor===ff}function V1(P,B,Y,re,ie){if(P.keyHash===re)return new ff(B,re,[P.entry,ie]);var Se=(Y===0?P.keyHash:P.keyHash>>>Y)&x,Pe=(Y===0?re:re>>>Y)&x,Ue,et=Se===Pe?[V1(P,B,Y+y,re,ie)]:(Ue=new tu(B,re,ie),Se<Pe?[P,Ue]:[Ue,P]);return new df(B,1<<Se|1<<Pe,et)}function t7(P,B,Y,re){P||(P=new M);for(var ie=new tu(P,Yt(Y),[Y,re]),Se=0;Se<B.length;Se++){var Pe=B[Se];ie=ie.update(P,0,void 0,Pe[0],Pe[1])}return ie}function r7(P,B,Y,re){for(var ie=0,Se=0,Pe=new Array(Y),Ue=0,et=1,st=B.length;Ue<st;Ue++,et<<=1){var yt=B[Ue];yt!==void 0&&Ue!==re&&(ie|=et,Pe[Se++]=yt)}return new df(P,ie,Pe)}function n7(P,B,Y,re,ie){for(var Se=0,Pe=new Array(b),Ue=0;Y!==0;Ue++,Y>>>=1)Pe[Ue]=Y&1?B[Se++]:void 0;return Pe[re]=ie,new Gp(P,Se+1,Pe)}function Jv(P,B,Y){for(var re=[],ie=0;ie<Y.length;ie++){var Se=Y[ie],Pe=i(Se);u(Se)||(Pe=Pe.map(function(Ue){return dt(Ue)})),re.push(Pe)}return Ww(P,B,re)}function qw(P,B,Y){return P&&P.mergeDeep&&u(B)?P.mergeDeep(B):tt(P,B)?P:B}function jw(P){return function(B,Y,re){if(B&&B.mergeDeepWith&&u(Y))return B.mergeDeepWith(P,Y);var ie=P(B,Y,re);return tt(B,ie)?B:ie}}function Ww(P,B,Y){return Y=Y.filter(function(re){return re.size!==0}),Y.length===0?P:P.size===0&&!P.__ownerID&&Y.length===1?P.constructor(Y[0]):P.withMutations(function(re){for(var ie=B?function(Pe,Ue){re.update(Ue,S,function(et){return et===S?Pe:B(et,Pe,Ue)})}:function(Pe,Ue){re.set(Ue,Pe)},Se=0;Se<Y.length;Se++)Y[Se].forEach(ie)})}function Xw(P,B,Y,re){var ie=P===S,Se=B.next();if(Se.done){var Pe=ie?Y:P,Ue=re(Pe);return Ue===Pe?P:Ue}fe(ie||P&&P.set,"invalid keyPath");var et=Se.value,st=ie?S:P.get(et,S),yt=Xw(st,B,Y,re);return yt===st?P:yt===S?P.remove(et):(ie?Lo():P).set(et,yt)}function Yw(P){return P=P-(P>>1&1431655765),P=(P&858993459)+(P>>2&858993459),P=P+(P>>4)&252645135,P=P+(P>>8),P=P+(P>>16),P&127}function Kw(P,B,Y,re){var ie=re?P:O(P);return ie[B]=Y,ie}function a7(P,B,Y,re){var ie=P.length+1;if(re&&B+1===ie)return P[B]=Y,P;for(var Se=new Array(ie),Pe=0,Ue=0;Ue<ie;Ue++)Ue===B?(Se[Ue]=Y,Pe=-1):Se[Ue]=P[Ue+Pe];return Se}function i7(P,B,Y){var re=P.length-1;if(Y&&B===re)return P.pop(),P;for(var ie=new Array(re),Se=0,Pe=0;Pe<re;Pe++)Pe===B&&(Se=1),ie[Pe]=P[Pe+Se];return ie}var o7=b/4,s7=b/2,u7=b/4;n(Tn,Tt);function Tn(P){var B=H1();if(P==null)return B;if($w(P))return P;var Y=o(P),re=Y.size;return re===0?B:(ri(re),re>0&&re<b?jp(0,re,y,null,new xl(Y.toArray())):B.withMutations(function(ie){ie.setSize(re),Y.forEach(function(Se,Pe){return ie.set(Pe,Se)})}))}Tn.of=function(){return this(arguments)},Tn.prototype.toString=function(){return this.__toString("List [","]")},Tn.prototype.get=function(P,B){if(P=F(this,P),P>=0&&P<this.size){P+=this._origin;var Y=eA(this,P);return Y&&Y.array[P&x]}return B},Tn.prototype.set=function(P,B){return l7(this,P,B)},Tn.prototype.remove=function(P){return this.has(P)?P===0?this.shift():P===this.size-1?this.pop():this.splice(P,1):this},Tn.prototype.insert=function(P,B){return this.splice(P,0,B)},Tn.prototype.clear=function(){return this.size===0?this:this.__ownerID?(this.size=this._origin=this._capacity=0,this._level=y,this._root=this._tail=null,this.__hash=void 0,this.__altered=!0,this):H1()},Tn.prototype.push=function(){var P=arguments,B=this.size;return this.withMutations(function(Y){Cl(Y,0,B+P.length);for(var re=0;re<P.length;re++)Y.set(B+re,P[re])})},Tn.prototype.pop=function(){return Cl(this,0,-1)},Tn.prototype.unshift=function(){var P=arguments;return this.withMutations(function(B){Cl(B,-P.length);for(var Y=0;Y<P.length;Y++)B.set(Y,P[Y])})},Tn.prototype.shift=function(){return Cl(this,1)},Tn.prototype.merge=function(){return em(this,void 0,arguments)},Tn.prototype.mergeWith=function(P){var B=r.call(arguments,1);return em(this,P,B)},Tn.prototype.mergeDeep=function(){return em(this,qw,arguments)},Tn.prototype.mergeDeepWith=function(P){var B=r.call(arguments,1);return em(this,jw(P),B)},Tn.prototype.setSize=function(P){return Cl(this,0,P)},Tn.prototype.slice=function(P,B){var Y=this.size;return N(P,B,Y)?this:Cl(this,z(P,Y),$(B,Y))},Tn.prototype.__iterator=function(P,B){var Y=0,re=Zw(this,B);return new U(function(){var ie=re();return ie===qp?J():H(P,Y++,ie)})},Tn.prototype.__iterate=function(P,B){for(var Y=0,re=Zw(this,B),ie;(ie=re())!==qp&&P(ie,Y++,this)!==!1;);return Y},Tn.prototype.__ensureOwner=function(P){return P===this.__ownerID?this:P?jp(this._origin,this._capacity,this._level,this._root,this._tail,P,this.__hash):(this.__ownerID=P,this)};function $w(P){return!!(P&&P[Qw])}Tn.isList=$w;var Qw="@@__IMMUTABLE_LIST__@@",ni=Tn.prototype;ni[Qw]=!0,ni[g]=ni.remove,ni.setIn=Hr.setIn,ni.deleteIn=ni.removeIn=Hr.removeIn,ni.update=Hr.update,ni.updateIn=Hr.updateIn,ni.mergeIn=Hr.mergeIn,ni.mergeDeepIn=Hr.mergeDeepIn,ni.withMutations=Hr.withMutations,ni.asMutable=Hr.asMutable,ni.asImmutable=Hr.asImmutable,ni.wasAltered=Hr.wasAltered;function xl(P,B){this.array=P,this.ownerID=B}xl.prototype.removeBefore=function(P,B,Y){if(Y===B?1<<B:this.array.length===0)return this;var re=Y>>>B&x;if(re>=this.array.length)return new xl([],P);var ie=re===0,Se;if(B>0){var Pe=this.array[re];if(Se=Pe&&Pe.removeBefore(P,B-y,Y),Se===Pe&&ie)return this}if(ie&&!Se)return this;var Ue=pf(this,P);if(!ie)for(var et=0;et<re;et++)Ue.array[et]=void 0;return Se&&(Ue.array[re]=Se),Ue},xl.prototype.removeAfter=function(P,B,Y){if(Y===(B?1<<B:0)||this.array.length===0)return this;var re=Y-1>>>B&x;if(re>=this.array.length)return this;var ie;if(B>0){var Se=this.array[re];if(ie=Se&&Se.removeAfter(P,B-y,Y),ie===Se&&re===this.array.length-1)return this}var Pe=pf(this,P);return Pe.array.splice(re+1),ie&&(Pe.array[re]=ie),Pe};var qp={};function Zw(P,B){var Y=P._origin,re=P._capacity,ie=Wp(re),Se=P._tail;return Pe(P._root,P._level,0);function Pe(st,yt,Bt){return yt===0?Ue(st,Bt):et(st,yt,Bt)}function Ue(st,yt){var Bt=yt===ie?Se&&Se.array:st&&st.array,qt=yt>Y?0:Y-yt,br=re-yt;return br>b&&(br=b),function(){if(qt===br)return qp;var Ur=B?--br:qt++;return Bt&&Bt[Ur]}}function et(st,yt,Bt){var qt,br=st&&st.array,Ur=Bt>Y?0:Y-Bt>>yt,On=(re-Bt>>yt)+1;return On>b&&(On=b),function(){do{if(qt){var No=qt();if(No!==qp)return No;qt=null}if(Ur===On)return qp;var Ss=B?--On:Ur++;qt=Pe(br&&br[Ss],yt-y,Bt+(Ss<<yt))}while(!0)}}}function jp(P,B,Y,re,ie,Se,Pe){var Ue=Object.create(ni);return Ue.size=B-P,Ue._origin=P,Ue._capacity=B,Ue._level=Y,Ue._root=re,Ue._tail=ie,Ue.__ownerID=Se,Ue.__hash=Pe,Ue.__altered=!1,Ue}var Jw;function H1(){return Jw||(Jw=jp(0,0,y))}function l7(P,B,Y){if(B=F(P,B),B!==B)return P;if(B>=P.size||B<0)return P.withMutations(function(Pe){B<0?Cl(Pe,B).set(0,Y):Cl(Pe,0,B+1).set(B,Y)});B+=P._origin;var re=P._tail,ie=P._root,Se=T(A);return B>=Wp(P._capacity)?re=G1(re,P.__ownerID,0,B,Y,Se):ie=G1(ie,P.__ownerID,P._level,B,Y,Se),Se.value?P.__ownerID?(P._root=ie,P._tail=re,P.__hash=void 0,P.__altered=!0,P):jp(P._origin,P._capacity,P._level,ie,re):P}function G1(P,B,Y,re,ie,Se){var Pe=re>>>Y&x,Ue=P&&Pe<P.array.length;if(!Ue&&ie===void 0)return P;var et;if(Y>0){var st=P&&P.array[Pe],yt=G1(st,B,Y-y,re,ie,Se);return yt===st?P:(et=pf(P,B),et.array[Pe]=yt,et)}return Ue&&P.array[Pe]===ie?P:(I(Se),et=pf(P,B),ie===void 0&&Pe===et.array.length-1?et.array.pop():et.array[Pe]=ie,et)}function pf(P,B){return B&&P&&B===P.ownerID?P:new xl(P?P.array.slice():[],B)}function eA(P,B){if(B>=Wp(P._capacity))return P._tail;if(B<1<<P._level+y){for(var Y=P._root,re=P._level;Y&&re>0;)Y=Y.array[B>>>re&x],re-=y;return Y}}function Cl(P,B,Y){B!==void 0&&(B=B|0),Y!==void 0&&(Y=Y|0);var re=P.__ownerID||new M,ie=P._origin,Se=P._capacity,Pe=ie+B,Ue=Y===void 0?Se:Y<0?Se+Y:ie+Y;if(Pe===ie&&Ue===Se)return P;if(Pe>=Ue)return P.clear();for(var et=P._level,st=P._root,yt=0;Pe+yt<0;)st=new xl(st&&st.array.length?[void 0,st]:[],re),et+=y,yt+=1<<et;yt&&(Pe+=yt,ie+=yt,Ue+=yt,Se+=yt);for(var Bt=Wp(Se),qt=Wp(Ue);qt>=1<<et+y;)st=new xl(st&&st.array.length?[st]:[],re),et+=y;var br=P._tail,Ur=qt<Bt?eA(P,Ue-1):qt>Bt?new xl([],re):br;if(br&&qt>Bt&&Pe<Se&&br.array.length){st=pf(st,re);for(var On=st,No=et;No>y;No-=y){var Ss=Bt>>>No&x;On=On.array[Ss]=pf(On.array[Ss],re)}On.array[Bt>>>y&x]=br}if(Ue<Se&&(Ur=Ur&&Ur.removeAfter(re,0,Ue)),Pe>=qt)Pe-=qt,Ue-=qt,et=y,st=null,Ur=Ur&&Ur.removeBefore(re,0,Pe);else if(Pe>ie||qt<Bt){for(yt=0;st;){var sm=Pe>>>et&x;if(sm!==qt>>>et&x)break;sm&&(yt+=(1<<et)*sm),et-=y,st=st.array[sm]}st&&Pe>ie&&(st=st.removeBefore(re,et,Pe-yt)),st&&qt<Bt&&(st=st.removeAfter(re,et,qt-yt)),yt&&(Pe-=yt,Ue-=yt)}return P.__ownerID?(P.size=Ue-Pe,P._origin=Pe,P._capacity=Ue,P._level=et,P._root=st,P._tail=Ur,P.__hash=void 0,P.__altered=!0,P):jp(Pe,Ue,et,st,Ur)}function em(P,B,Y){for(var re=[],ie=0,Se=0;Se<Y.length;Se++){var Pe=Y[Se],Ue=o(Pe);Ue.size>ie&&(ie=Ue.size),u(Pe)||(Ue=Ue.map(function(et){return dt(et)})),re.push(Ue)}return ie>P.size&&(P=P.setSize(ie)),Ww(P,B,re)}function Wp(P){return P<b?0:P-1>>>y<<y}n(Qn,Yr);function Qn(P){return P==null?tm():tA(P)?P:tm().withMutations(function(B){var Y=i(P);ri(Y.size),Y.forEach(function(re,ie){return B.set(ie,re)})})}Qn.of=function(){return this(arguments)},Qn.prototype.toString=function(){return this.__toString("OrderedMap {","}")},Qn.prototype.get=function(P,B){var Y=this._map.get(P);return Y!==void 0?this._list.get(Y)[1]:B},Qn.prototype.clear=function(){return this.size===0?this:this.__ownerID?(this.size=0,this._map.clear(),this._list.clear(),this):tm()},Qn.prototype.set=function(P,B){return nA(this,P,B)},Qn.prototype.remove=function(P){return nA(this,P,S)},Qn.prototype.wasAltered=function(){return this._map.wasAltered()||this._list.wasAltered()},Qn.prototype.__iterate=function(P,B){var Y=this;return this._list.__iterate(function(re){return re&&P(re[1],re[0],Y)},B)},Qn.prototype.__iterator=function(P,B){return this._list.fromEntrySeq().__iterator(P,B)},Qn.prototype.__ensureOwner=function(P){if(P===this.__ownerID)return this;var B=this._map.__ensureOwner(P),Y=this._list.__ensureOwner(P);return P?q1(B,Y,P,this.__hash):(this.__ownerID=P,this._map=B,this._list=Y,this)};function tA(P){return B1(P)&&f(P)}Qn.isOrderedMap=tA,Qn.prototype[m]=!0,Qn.prototype[g]=Qn.prototype.remove;function q1(P,B,Y,re){var ie=Object.create(Qn.prototype);return ie.size=P?P.size:0,ie._map=P,ie._list=B,ie.__ownerID=Y,ie.__hash=re,ie}var rA;function tm(){return rA||(rA=q1(Lo(),H1()))}function nA(P,B,Y){var re=P._map,ie=P._list,Se=re.get(B),Pe=Se!==void 0,Ue,et;if(Y===S){if(!Pe)return P;ie.size>=b&&ie.size>=re.size*2?(et=ie.filter(function(st,yt){return st!==void 0&&Se!==yt}),Ue=et.toKeyedSeq().map(function(st){return st[0]}).flip().toMap(),P.__ownerID&&(Ue.__ownerID=et.__ownerID=P.__ownerID)):(Ue=re.remove(B),et=Se===ie.size-1?ie.pop():ie.set(Se,void 0))}else if(Pe){if(Y===ie.get(Se)[1])return P;Ue=re,et=ie.set(Se,[B,Y])}else Ue=re.set(B,ie.size),et=ie.set(ie.size,[B,Y]);return P.__ownerID?(P.size=Ue.size,P._map=Ue,P._list=et,P.__hash=void 0,P):q1(Ue,et)}n(no,Ae);function no(P,B){this._iter=P,this._useKeys=B,this.size=P.size}no.prototype.get=function(P,B){return this._iter.get(P,B)},no.prototype.has=function(P){return this._iter.has(P)},no.prototype.valueSeq=function(){return this._iter.valueSeq()},no.prototype.reverse=function(){var P=this,B=j1(this,!0);return this._useKeys||(B.valueSeq=function(){return P._iter.toSeq().reverse()}),B},no.prototype.map=function(P,B){var Y=this,re=iA(this,P,B);return this._useKeys||(re.valueSeq=function(){return Y._iter.toSeq().map(P,B)}),re},no.prototype.__iterate=function(P,B){var Y=this,re;return this._iter.__iterate(this._useKeys?function(ie,Se){return P(ie,Se,Y)}:(re=B?dA(this):0,function(ie){return P(ie,B?--re:re++,Y)}),B)},no.prototype.__iterator=function(P,B){if(this._useKeys)return this._iter.__iterator(P,B);var Y=this._iter.__iterator(q,B),re=B?dA(this):0;return new U(function(){var ie=Y.next();return ie.done?ie:H(P,B?--re:re++,ie.value,ie)})},no.prototype[m]=!0,n(hf,xe);function hf(P){this._iter=P,this.size=P.size}hf.prototype.includes=function(P){return this._iter.includes(P)},hf.prototype.__iterate=function(P,B){var Y=this,re=0;return this._iter.__iterate(function(ie){return P(ie,re++,Y)},B)},hf.prototype.__iterator=function(P,B){var Y=this._iter.__iterator(q,B),re=0;return new U(function(){var ie=Y.next();return ie.done?ie:H(P,re++,ie.value,ie)})},n(vf,ae);function vf(P){this._iter=P,this.size=P.size}vf.prototype.has=function(P){return this._iter.includes(P)},vf.prototype.__iterate=function(P,B){var Y=this;return this._iter.__iterate(function(re){return P(re,re,Y)},B)},vf.prototype.__iterator=function(P,B){var Y=this._iter.__iterator(q,B);return new U(function(){var re=Y.next();return re.done?re:H(P,re.value,re.value,re)})},n(mf,Ae);function mf(P){this._iter=P,this.size=P.size}mf.prototype.entrySeq=function(){return this._iter.toSeq()},mf.prototype.__iterate=function(P,B){var Y=this;return this._iter.__iterate(function(re){if(re){cA(re);var ie=u(re);return P(ie?re.get(1):re[1],ie?re.get(0):re[0],Y)}},B)},mf.prototype.__iterator=function(P,B){var Y=this._iter.__iterator(q,B);return new U(function(){for(;;){var re=Y.next();if(re.done)return re;var ie=re.value;if(ie){cA(ie);var Se=u(ie);return H(P,Se?ie.get(0):ie[0],Se?ie.get(1):ie[1],re)}}})},hf.prototype.cacheResult=no.prototype.cacheResult=vf.prototype.cacheResult=mf.prototype.cacheResult=Y1;function aA(P){var B=gs(P);return B._iter=P,B.size=P.size,B.flip=function(){return P},B.reverse=function(){var Y=P.reverse.apply(this);return Y.flip=function(){return P.reverse()},Y},B.has=function(Y){return P.includes(Y)},B.includes=function(Y){return P.has(Y)},B.cacheResult=Y1,B.__iterateUncached=function(Y,re){var ie=this;return P.__iterate(function(Se,Pe){return Y(Pe,Se,ie)!==!1},re)},B.__iteratorUncached=function(Y,re){if(Y===te){var ie=P.__iterator(Y,re);return new U(function(){var Se=ie.next();if(!Se.done){var Pe=Se.value[0];Se.value[0]=Se.value[1],Se.value[1]=Pe}return Se})}return P.__iterator(Y===q?Z:q,re)},B}function iA(P,B,Y){var re=gs(P);return re.size=P.size,re.has=function(ie){return P.has(ie)},re.get=function(ie,Se){var Pe=P.get(ie,S);return Pe===S?Se:B.call(Y,Pe,ie,P)},re.__iterateUncached=function(ie,Se){var Pe=this;return P.__iterate(function(Ue,et,st){return ie(B.call(Y,Ue,et,st),et,Pe)!==!1},Se)},re.__iteratorUncached=function(ie,Se){var Pe=P.__iterator(te,Se);return new U(function(){var Ue=Pe.next();if(Ue.done)return Ue;var et=Ue.value,st=et[0];return H(ie,st,B.call(Y,et[1],st,P),Ue)})},re}function j1(P,B){var Y=gs(P);return Y._iter=P,Y.size=P.size,Y.reverse=function(){return P},P.flip&&(Y.flip=function(){var re=aA(P);return re.reverse=function(){return P.flip()},re}),Y.get=function(re,ie){return P.get(B?re:-1-re,ie)},Y.has=function(re){return P.has(B?re:-1-re)},Y.includes=function(re){return P.includes(re)},Y.cacheResult=Y1,Y.__iterate=function(re,ie){var Se=this;return P.__iterate(function(Pe,Ue){return re(Pe,Ue,Se)},!ie)},Y.__iterator=function(re,ie){return P.__iterator(re,!ie)},Y}function oA(P,B,Y,re){var ie=gs(P);return re&&(ie.has=function(Se){var Pe=P.get(Se,S);return Pe!==S&&!!B.call(Y,Pe,Se,P)},ie.get=function(Se,Pe){var Ue=P.get(Se,S);return Ue!==S&&B.call(Y,Ue,Se,P)?Ue:Pe}),ie.__iterateUncached=function(Se,Pe){var Ue=this,et=0;return P.__iterate(function(st,yt,Bt){if(B.call(Y,st,yt,Bt))return et++,Se(st,re?yt:et-1,Ue)},Pe),et},ie.__iteratorUncached=function(Se,Pe){var Ue=P.__iterator(te,Pe),et=0;return new U(function(){for(;;){var st=Ue.next();if(st.done)return st;var yt=st.value,Bt=yt[0],qt=yt[1];if(B.call(Y,qt,Bt,P))return H(Se,re?Bt:et++,qt,st)}})},ie}function c7(P,B,Y){var re=Yr().asMutable();return P.__iterate(function(ie,Se){re.update(B.call(Y,ie,Se,P),0,function(Pe){return Pe+1})}),re.asImmutable()}function d7(P,B,Y){var re=l(P),ie=(f(P)?Qn():Yr()).asMutable();P.__iterate(function(Pe,Ue){ie.update(B.call(Y,Pe,Ue,P),function(et){return et=et||[],et.push(re?[Ue,Pe]:Pe),et})});var Se=fA(P);return ie.map(function(Pe){return Sn(P,Se(Pe))})}function W1(P,B,Y,re){var ie=P.size;if(B!==void 0&&(B=B|0),Y!==void 0&&(Y===1/0?Y=ie:Y=Y|0),N(B,Y,ie))return P;var Se=z(B,ie),Pe=$(Y,ie);if(Se!==Se||Pe!==Pe)return W1(P.toSeq().cacheResult(),B,Y,re);var Ue=Pe-Se,et;Ue===Ue&&(et=Ue<0?0:Ue);var st=gs(P);return st.size=et===0?et:P.size&&et||void 0,!re&&Ee(P)&&et>=0&&(st.get=function(yt,Bt){return yt=F(this,yt),yt>=0&&yt<et?P.get(yt+Se,Bt):Bt}),st.__iterateUncached=function(yt,Bt){var qt=this;if(et===0)return 0;if(Bt)return this.cacheResult().__iterate(yt,Bt);var br=0,Ur=!0,On=0;return P.__iterate(function(No,Ss){if(!(Ur&&(Ur=br++<Se)))return On++,yt(No,re?Ss:On-1,qt)!==!1&&On!==et}),On},st.__iteratorUncached=function(yt,Bt){if(et!==0&&Bt)return this.cacheResult().__iterator(yt,Bt);var qt=et!==0&&P.__iterator(yt,Bt),br=0,Ur=0;return new U(function(){for(;br++<Se;)qt.next();if(++Ur>et)return J();var On=qt.next();return re||yt===q?On:yt===Z?H(yt,Ur-1,void 0,On):H(yt,Ur-1,On.value[1],On)})},st}function f7(P,B,Y){var re=gs(P);return re.__iterateUncached=function(ie,Se){var Pe=this;if(Se)return this.cacheResult().__iterate(ie,Se);var Ue=0;return P.__iterate(function(et,st,yt){return B.call(Y,et,st,yt)&&++Ue&&ie(et,st,Pe)}),Ue},re.__iteratorUncached=function(ie,Se){var Pe=this;if(Se)return this.cacheResult().__iterator(ie,Se);var Ue=P.__iterator(te,Se),et=!0;return new U(function(){if(!et)return J();var st=Ue.next();if(st.done)return st;var yt=st.value,Bt=yt[0],qt=yt[1];return B.call(Y,qt,Bt,Pe)?ie===te?st:H(ie,Bt,qt,st):(et=!1,J())})},re}function sA(P,B,Y,re){var ie=gs(P);return ie.__iterateUncached=function(Se,Pe){var Ue=this;if(Pe)return this.cacheResult().__iterate(Se,Pe);var et=!0,st=0;return P.__iterate(function(yt,Bt,qt){if(!(et&&(et=B.call(Y,yt,Bt,qt))))return st++,Se(yt,re?Bt:st-1,Ue)}),st},ie.__iteratorUncached=function(Se,Pe){var Ue=this;if(Pe)return this.cacheResult().__iterator(Se,Pe);var et=P.__iterator(te,Pe),st=!0,yt=0;return new U(function(){var Bt,qt,br;do{if(Bt=et.next(),Bt.done)return re||Se===q?Bt:Se===Z?H(Se,yt++,void 0,Bt):H(Se,yt++,Bt.value[1],Bt);var Ur=Bt.value;qt=Ur[0],br=Ur[1],st&&(st=B.call(Y,br,qt,Ue))}while(st);return Se===te?Bt:H(Se,qt,br,Bt)})},ie}function p7(P,B){var Y=l(P),re=[P].concat(B).map(function(Pe){return u(Pe)?Y&&(Pe=i(Pe)):Pe=Y?Ye(Pe):lt(Array.isArray(Pe)?Pe:[Pe]),Pe}).filter(function(Pe){return Pe.size!==0});if(re.length===0)return P;if(re.length===1){var ie=re[0];if(ie===P||Y&&l(ie)||c(P)&&c(ie))return ie}var Se=new R(re);return Y?Se=Se.toKeyedSeq():c(P)||(Se=Se.toSetSeq()),Se=Se.flatten(!0),Se.size=re.reduce(function(Pe,Ue){if(Pe!==void 0){var et=Ue.size;if(et!==void 0)return Pe+et}},0),Se}function uA(P,B,Y){var re=gs(P);return re.__iterateUncached=function(ie,Se){var Pe=0,Ue=!1;function et(st,yt){var Bt=this;st.__iterate(function(qt,br){return(!B||yt<B)&&u(qt)?et(qt,yt+1):ie(qt,Y?br:Pe++,Bt)===!1&&(Ue=!0),!Ue},Se)}return et(P,0),Pe},re.__iteratorUncached=function(ie,Se){var Pe=P.__iterator(ie,Se),Ue=[],et=0;return new U(function(){for(;Pe;){var st=Pe.next();if(st.done!==!1){Pe=Ue.pop();continue}var yt=st.value;if(ie===te&&(yt=yt[1]),(!B||Ue.length<B)&&u(yt))Ue.push(Pe),Pe=yt.__iterator(ie,Se);else return Y?st:H(ie,et++,yt,st)}return J()})},re}function h7(P,B,Y){var re=fA(P);return P.toSeq().map(function(ie,Se){return re(B.call(Y,ie,Se,P))}).flatten(!0)}function v7(P,B){var Y=gs(P);return Y.size=P.size&&P.size*2-1,Y.__iterateUncached=function(re,ie){var Se=this,Pe=0;return P.__iterate(function(Ue,et){return(!Pe||re(B,Pe++,Se)!==!1)&&re(Ue,Pe++,Se)!==!1},ie),Pe},Y.__iteratorUncached=function(re,ie){var Se=P.__iterator(q,ie),Pe=0,Ue;return new U(function(){return(!Ue||Pe%2)&&(Ue=Se.next(),Ue.done)?Ue:Pe%2?H(re,Pe++,B):H(re,Pe++,Ue.value,Ue)})},Y}function gf(P,B,Y){B||(B=pA);var re=l(P),ie=0,Se=P.toSeq().map(function(Pe,Ue){return[Ue,Pe,ie++,Y?Y(Pe,Ue,P):Pe]}).toArray();return Se.sort(function(Pe,Ue){return B(Pe[3],Ue[3])||Pe[2]-Ue[2]}).forEach(re?function(Pe,Ue){Se[Ue].length=2}:function(Pe,Ue){Se[Ue]=Pe[1]}),re?Ae(Se):c(P)?xe(Se):ae(Se)}function rm(P,B,Y){if(B||(B=pA),Y){var re=P.toSeq().map(function(ie,Se){return[ie,Y(ie,Se,P)]}).reduce(function(ie,Se){return lA(B,ie[1],Se[1])?Se:ie});return re&&re[0]}else return P.reduce(function(ie,Se){return lA(B,ie,Se)?Se:ie})}function lA(P,B,Y){var re=P(Y,B);return re===0&&Y!==B&&(Y==null||Y!==Y)||re>0}function X1(P,B,Y){var re=gs(P);return re.size=new R(Y).map(function(ie){return ie.size}).min(),re.__iterate=function(ie,Se){for(var Pe=this.__iterator(q,Se),Ue,et=0;!(Ue=Pe.next()).done&&ie(Ue.value,et++,this)!==!1;);return et},re.__iteratorUncached=function(ie,Se){var Pe=Y.map(function(st){return st=a(st),ee(Se?st.reverse():st)}),Ue=0,et=!1;return new U(function(){var st;return et||(st=Pe.map(function(yt){return yt.next()}),et=st.some(function(yt){return yt.done})),et?J():H(ie,Ue++,B.apply(null,st.map(function(yt){return yt.value})))})},re}function Sn(P,B){return Ee(P)?B:P.constructor(B)}function cA(P){if(P!==Object(P))throw new TypeError("Expected [K, V] tuple: "+P)}function dA(P){return ri(P.size),D(P)}function fA(P){return l(P)?i:c(P)?o:s}function gs(P){return Object.create((l(P)?Ae:c(P)?xe:ae).prototype)}function Y1(){return this._iter.cacheResult?(this._iter.cacheResult(),this.size=this._iter.size,this):be.prototype.cacheResult.call(this)}function pA(P,B){return P>B?1:P<B?-1:0}function hA(P){var B=ee(P);if(!B){if(!ye(P))throw new TypeError("Expected iterable or array-like: "+P);B=ee(a(P))}return B}n(Oi,gt);function Oi(P,B){var Y,re=function(Pe){if(Pe instanceof re)return Pe;if(!(this instanceof re))return new re(Pe);if(!Y){Y=!0;var Ue=Object.keys(P);m7(ie,Ue),ie.size=Ue.length,ie._name=B,ie._keys=Ue,ie._defaultValues=P}this._map=Yr(Pe)},ie=re.prototype=Object.create(Da);return ie.constructor=re,re}Oi.prototype.toString=function(){return this.__toString(vA(this)+" {","}")},Oi.prototype.has=function(P){return this._defaultValues.hasOwnProperty(P)},Oi.prototype.get=function(P,B){if(!this.has(P))return B;var Y=this._defaultValues[P];return this._map?this._map.get(P,Y):Y},Oi.prototype.clear=function(){if(this.__ownerID)return this._map&&this._map.clear(),this;var P=this.constructor;return P._empty||(P._empty=nm(this,Lo()))},Oi.prototype.set=function(P,B){if(!this.has(P))throw new Error('Cannot set unknown key "'+P+'" on '+vA(this));if(this._map&&!this._map.has(P)){var Y=this._defaultValues[P];if(B===Y)return this}var re=this._map&&this._map.set(P,B);return this.__ownerID||re===this._map?this:nm(this,re)},Oi.prototype.remove=function(P){if(!this.has(P))return this;var B=this._map&&this._map.remove(P);return this.__ownerID||B===this._map?this:nm(this,B)},Oi.prototype.wasAltered=function(){return this._map.wasAltered()},Oi.prototype.__iterator=function(P,B){var Y=this;return i(this._defaultValues).map(function(re,ie){return Y.get(ie)}).__iterator(P,B)},Oi.prototype.__iterate=function(P,B){var Y=this;return i(this._defaultValues).map(function(re,ie){return Y.get(ie)}).__iterate(P,B)},Oi.prototype.__ensureOwner=function(P){if(P===this.__ownerID)return this;var B=this._map&&this._map.__ensureOwner(P);return P?nm(this,B,P):(this.__ownerID=P,this._map=B,this)};var Da=Oi.prototype;Da[g]=Da.remove,Da.deleteIn=Da.removeIn=Hr.removeIn,Da.merge=Hr.merge,Da.mergeWith=Hr.mergeWith,Da.mergeIn=Hr.mergeIn,Da.mergeDeep=Hr.mergeDeep,Da.mergeDeepWith=Hr.mergeDeepWith,Da.mergeDeepIn=Hr.mergeDeepIn,Da.setIn=Hr.setIn,Da.update=Hr.update,Da.updateIn=Hr.updateIn,Da.withMutations=Hr.withMutations,Da.asMutable=Hr.asMutable,Da.asImmutable=Hr.asImmutable;function nm(P,B,Y){var re=Object.create(Object.getPrototypeOf(P));return re._map=B,re.__ownerID=Y,re}function vA(P){return P._name||P.constructor.name||"Record"}function m7(P,B){try{B.forEach(g7.bind(void 0,P))}catch{}}function g7(P,B){Object.defineProperty(P,B,{get:function(){return this.get(B)},set:function(Y){fe(this.__ownerID,"Cannot set on an immutable record."),this.set(B,Y)}})}n(Rn,Wt);function Rn(P){return P==null?Q1():K1(P)&&!f(P)?P:Q1().withMutations(function(B){var Y=s(P);ri(Y.size),Y.forEach(function(re){return B.add(re)})})}Rn.of=function(){return this(arguments)},Rn.fromKeys=function(P){return this(i(P).keySeq())},Rn.prototype.toString=function(){return this.__toString("Set {","}")},Rn.prototype.has=function(P){return this._map.has(P)},Rn.prototype.add=function(P){return $1(this,this._map.set(P,!0))},Rn.prototype.remove=function(P){return $1(this,this._map.remove(P))},Rn.prototype.clear=function(){return $1(this,this._map.clear())},Rn.prototype.union=function(){var P=r.call(arguments,0);return P=P.filter(function(B){return B.size!==0}),P.length===0?this:this.size===0&&!this.__ownerID&&P.length===1?this.constructor(P[0]):this.withMutations(function(B){for(var Y=0;Y<P.length;Y++)s(P[Y]).forEach(function(re){return B.add(re)})})},Rn.prototype.intersect=function(){var P=r.call(arguments,0);if(P.length===0)return this;P=P.map(function(Y){return s(Y)});var B=this;return this.withMutations(function(Y){B.forEach(function(re){P.every(function(ie){return ie.includes(re)})||Y.remove(re)})})},Rn.prototype.subtract=function(){var P=r.call(arguments,0);if(P.length===0)return this;P=P.map(function(Y){return s(Y)});var B=this;return this.withMutations(function(Y){B.forEach(function(re){P.some(function(ie){return ie.includes(re)})&&Y.remove(re)})})},Rn.prototype.merge=function(){return this.union.apply(this,arguments)},Rn.prototype.mergeWith=function(P){var B=r.call(arguments,1);return this.union.apply(this,B)},Rn.prototype.sort=function(P){return ys(gf(this,P))},Rn.prototype.sortBy=function(P,B){return ys(gf(this,B,P))},Rn.prototype.wasAltered=function(){return this._map.wasAltered()},Rn.prototype.__iterate=function(P,B){var Y=this;return this._map.__iterate(function(re,ie){return P(ie,ie,Y)},B)},Rn.prototype.__iterator=function(P,B){return this._map.map(function(Y,re){return re}).__iterator(P,B)},Rn.prototype.__ensureOwner=function(P){if(P===this.__ownerID)return this;var B=this._map.__ensureOwner(P);return P?this.__make(B,P):(this.__ownerID=P,this._map=B,this)};function K1(P){return!!(P&&P[mA])}Rn.isSet=K1;var mA="@@__IMMUTABLE_SET__@@",Fi=Rn.prototype;Fi[mA]=!0,Fi[g]=Fi.remove,Fi.mergeDeep=Fi.merge,Fi.mergeDeepWith=Fi.mergeWith,Fi.withMutations=Hr.withMutations,Fi.asMutable=Hr.asMutable,Fi.asImmutable=Hr.asImmutable,Fi.__empty=Q1,Fi.__make=gA;function $1(P,B){return P.__ownerID?(P.size=B.size,P._map=B,P):B===P._map?P:B.size===0?P.__empty():P.__make(B)}function gA(P,B){var Y=Object.create(Fi);return Y.size=P?P.size:0,Y._map=P,Y.__ownerID=B,Y}var yA;function Q1(){return yA||(yA=gA(Lo()))}n(ys,Rn);function ys(P){return P==null?Z1():bA(P)?P:Z1().withMutations(function(B){var Y=s(P);ri(Y.size),Y.forEach(function(re){return B.add(re)})})}ys.of=function(){return this(arguments)},ys.fromKeys=function(P){return this(i(P).keySeq())},ys.prototype.toString=function(){return this.__toString("OrderedSet {","}")};function bA(P){return K1(P)&&f(P)}ys.isOrderedSet=bA;var am=ys.prototype;am[m]=!0,am.__empty=Z1,am.__make=SA;function SA(P,B){var Y=Object.create(am);return Y.size=P?P.size:0,Y._map=P,Y.__ownerID=B,Y}var xA;function Z1(){return xA||(xA=SA(tm()))}n(Jn,Tt);function Jn(P){return P==null?J1():CA(P)?P:J1().unshiftAll(P)}Jn.of=function(){return this(arguments)},Jn.prototype.toString=function(){return this.__toString("Stack [","]")},Jn.prototype.get=function(P,B){var Y=this._head;for(P=F(this,P);Y&&P--;)Y=Y.next;return Y?Y.value:B},Jn.prototype.peek=function(){return this._head&&this._head.value},Jn.prototype.push=function(){if(arguments.length===0)return this;for(var P=this.size+arguments.length,B=this._head,Y=arguments.length-1;Y>=0;Y--)B={value:arguments[Y],next:B};return this.__ownerID?(this.size=P,this._head=B,this.__hash=void 0,this.__altered=!0,this):Xp(P,B)},Jn.prototype.pushAll=function(P){if(P=o(P),P.size===0)return this;ri(P.size);var B=this.size,Y=this._head;return P.reverse().forEach(function(re){B++,Y={value:re,next:Y}}),this.__ownerID?(this.size=B,this._head=Y,this.__hash=void 0,this.__altered=!0,this):Xp(B,Y)},Jn.prototype.pop=function(){return this.slice(1)},Jn.prototype.unshift=function(){return this.push.apply(this,arguments)},Jn.prototype.unshiftAll=function(P){return this.pushAll(P)},Jn.prototype.shift=function(){return this.pop.apply(this,arguments)},Jn.prototype.clear=function(){return this.size===0?this:this.__ownerID?(this.size=0,this._head=void 0,this.__hash=void 0,this.__altered=!0,this):J1()},Jn.prototype.slice=function(P,B){if(N(P,B,this.size))return this;var Y=z(P,this.size),re=$(B,this.size);if(re!==this.size)return Tt.prototype.slice.call(this,P,B);for(var ie=this.size-Y,Se=this._head;Y--;)Se=Se.next;return this.__ownerID?(this.size=ie,this._head=Se,this.__hash=void 0,this.__altered=!0,this):Xp(ie,Se)},Jn.prototype.__ensureOwner=function(P){return P===this.__ownerID?this:P?Xp(this.size,this._head,P,this.__hash):(this.__ownerID=P,this.__altered=!1,this)},Jn.prototype.__iterate=function(P,B){if(B)return this.reverse().__iterate(P);for(var Y=0,re=this._head;re&&P(re.value,Y++,this)!==!1;)re=re.next;return Y},Jn.prototype.__iterator=function(P,B){if(B)return this.reverse().__iterator(P);var Y=0,re=this._head;return new U(function(){if(re){var ie=re.value;return re=re.next,H(P,Y++,ie)}return J()})};function CA(P){return!!(P&&P[_A])}Jn.isStack=CA;var _A="@@__IMMUTABLE_STACK__@@",yf=Jn.prototype;yf[_A]=!0,yf.withMutations=Hr.withMutations,yf.asMutable=Hr.asMutable,yf.asImmutable=Hr.asImmutable,yf.wasAltered=Hr.wasAltered;function Xp(P,B,Y,re){var ie=Object.create(yf);return ie.size=P,ie._head=B,ie.__ownerID=Y,ie.__hash=re,ie.__altered=!1,ie}var wA;function J1(){return wA||(wA=Xp(0))}function bs(P,B){var Y=function(re){P.prototype[re]=B[re]};return Object.keys(B).forEach(Y),Object.getOwnPropertySymbols&&Object.getOwnPropertySymbols(B).forEach(Y),P}a.Iterator=U,bs(a,{toArray:function(){ri(this.size);var P=new Array(this.size||0);return this.valueSeq().__iterate(function(B,Y){P[Y]=B}),P},toIndexedSeq:function(){return new hf(this)},toJS:function(){return this.toSeq().map(function(P){return P&&typeof P.toJS=="function"?P.toJS():P}).__toJS()},toJSON:function(){return this.toSeq().map(function(P){return P&&typeof P.toJSON=="function"?P.toJSON():P}).__toJS()},toKeyedSeq:function(){return new no(this,!0)},toMap:function(){return Yr(this.toKeyedSeq())},toObject:function(){ri(this.size);var P={};return this.__iterate(function(B,Y){P[Y]=B}),P},toOrderedMap:function(){return Qn(this.toKeyedSeq())},toOrderedSet:function(){return ys(l(this)?this.valueSeq():this)},toSet:function(){return Rn(l(this)?this.valueSeq():this)},toSetSeq:function(){return new vf(this)},toSeq:function(){return c(this)?this.toIndexedSeq():l(this)?this.toKeyedSeq():this.toSetSeq()},toStack:function(){return Jn(l(this)?this.valueSeq():this)},toList:function(){return Tn(l(this)?this.valueSeq():this)},toString:function(){return"[Iterable]"},__toString:function(P,B){return this.size===0?P+B:P+" "+this.toSeq().map(this.__toStringMapper).join(", ")+" "+B},concat:function(){var P=r.call(arguments,0);return Sn(this,p7(this,P))},includes:function(P){return this.some(function(B){return tt(B,P)})},entries:function(){return this.__iterator(te)},every:function(P,B){ri(this.size);var Y=!0;return this.__iterate(function(re,ie,Se){if(!P.call(B,re,ie,Se))return Y=!1,!1}),Y},filter:function(P,B){return Sn(this,oA(this,P,B,!0))},find:function(P,B,Y){var re=this.findEntry(P,B);return re?re[1]:Y},forEach:function(P,B){return ri(this.size),this.__iterate(B?P.bind(B):P)},join:function(P){ri(this.size),P=P!==void 0?""+P:",";var B="",Y=!0;return this.__iterate(function(re){Y?Y=!1:B+=P,B+=re!=null?re.toString():""}),B},keys:function(){return this.__iterator(Z)},map:function(P,B){return Sn(this,iA(this,P,B))},reduce:function(P,B,Y){ri(this.size);var re,ie;return arguments.length<2?ie=!0:re=B,this.__iterate(function(Se,Pe,Ue){ie?(ie=!1,re=Se):re=P.call(Y,re,Se,Pe,Ue)}),re},reduceRight:function(P,B,Y){var re=this.toKeyedSeq().reverse();return re.reduce.apply(re,arguments)},reverse:function(){return Sn(this,j1(this,!0))},slice:function(P,B){return Sn(this,W1(this,P,B,!0))},some:function(P,B){return!this.every(om(P),B)},sort:function(P){return Sn(this,gf(this,P))},values:function(){return this.__iterator(q)},butLast:function(){return this.slice(0,-1)},isEmpty:function(){return this.size!==void 0?this.size===0:!this.some(function(){return!0})},count:function(P,B){return D(P?this.toSeq().filter(P,B):this)},countBy:function(P,B){return c7(this,P,B)},equals:function(P){return St(this,P)},entrySeq:function(){var P=this;if(P._cache)return new R(P._cache);var B=P.toSeq().map(b7).toIndexedSeq();return B.fromEntrySeq=function(){return P.toSeq()},B},filterNot:function(P,B){return this.filter(om(P),B)},findEntry:function(P,B,Y){var re=Y;return this.__iterate(function(ie,Se,Pe){if(P.call(B,ie,Se,Pe))return re=[Se,ie],!1}),re},findKey:function(P,B){var Y=this.findEntry(P,B);return Y&&Y[0]},findLast:function(P,B,Y){return this.toKeyedSeq().reverse().find(P,B,Y)},findLastEntry:function(P,B,Y){return this.toKeyedSeq().reverse().findEntry(P,B,Y)},findLastKey:function(P,B){return this.toKeyedSeq().reverse().findKey(P,B)},first:function(){return this.find(G)},flatMap:function(P,B){return Sn(this,h7(this,P,B))},flatten:function(P){return Sn(this,uA(this,P,!0))},fromEntrySeq:function(){return new mf(this)},get:function(P,B){return this.find(function(Y,re){return tt(re,P)},void 0,B)},getIn:function(P,B){for(var Y=this,re=hA(P),ie;!(ie=re.next()).done;){var Se=ie.value;if(Y=Y&&Y.get?Y.get(Se,S):S,Y===S)return B}return Y},groupBy:function(P,B){return d7(this,P,B)},has:function(P){return this.get(P,S)!==S},hasIn:function(P){return this.getIn(P,S)!==S},isSubset:function(P){return P=typeof P.includes=="function"?P:a(P),this.every(function(B){return P.includes(B)})},isSuperset:function(P){return P=typeof P.isSubset=="function"?P:a(P),P.isSubset(this)},keyOf:function(P){return this.findKey(function(B){return tt(B,P)})},keySeq:function(){return this.toSeq().map(y7).toIndexedSeq()},last:function(){return this.toSeq().reverse().first()},lastKeyOf:function(P){return this.toKeyedSeq().reverse().keyOf(P)},max:function(P){return rm(this,P)},maxBy:function(P,B){return rm(this,B,P)},min:function(P){return rm(this,P?AA(P):TA)},minBy:function(P,B){return rm(this,B?AA(B):TA,P)},rest:function(){return this.slice(1)},skip:function(P){return this.slice(Math.max(0,P))},skipLast:function(P){return Sn(this,this.toSeq().reverse().skip(P).reverse())},skipWhile:function(P,B){return Sn(this,sA(this,P,B,!0))},skipUntil:function(P,B){return this.skipWhile(om(P),B)},sortBy:function(P,B){return Sn(this,gf(this,B,P))},take:function(P){return this.slice(0,Math.max(0,P))},takeLast:function(P){return Sn(this,this.toSeq().reverse().take(P).reverse())},takeWhile:function(P,B){return Sn(this,f7(this,P,B))},takeUntil:function(P,B){return this.takeWhile(om(P),B)},valueSeq:function(){return this.toIndexedSeq()},hashCode:function(){return this.__hash||(this.__hash=x7(this))}});var ai=a.prototype;ai[p]=!0,ai[K]=ai.values,ai.__toJS=ai.toArray,ai.__toStringMapper=PA,ai.inspect=ai.toSource=function(){return this.toString()},ai.chain=ai.flatMap,ai.contains=ai.includes,bs(i,{flip:function(){return Sn(this,aA(this))},mapEntries:function(P,B){var Y=this,re=0;return Sn(this,this.toSeq().map(function(ie,Se){return P.call(B,[Se,ie],re++,Y)}).fromEntrySeq())},mapKeys:function(P,B){var Y=this;return Sn(this,this.toSeq().flip().map(function(re,ie){return P.call(B,re,ie,Y)}).flip())}});var im=i.prototype;im[h]=!0,im[K]=ai.entries,im.__toJS=ai.toObject,im.__toStringMapper=function(P,B){return JSON.stringify(B)+": "+PA(P)},bs(o,{toKeyedSeq:function(){return new no(this,!1)},filter:function(P,B){return Sn(this,oA(this,P,B,!1))},findIndex:function(P,B){var Y=this.findEntry(P,B);return Y?Y[0]:-1},indexOf:function(P){var B=this.keyOf(P);return B===void 0?-1:B},lastIndexOf:function(P){var B=this.lastKeyOf(P);return B===void 0?-1:B},reverse:function(){return Sn(this,j1(this,!1))},slice:function(P,B){return Sn(this,W1(this,P,B,!1))},splice:function(P,B){var Y=arguments.length;if(B=Math.max(B|0,0),Y===0||Y===2&&!B)return this;P=z(P,P<0?this.count():this.size);var re=this.slice(0,P);return Sn(this,Y===1?re:re.concat(O(arguments,2),this.slice(P+B)))},findLastIndex:function(P,B){var Y=this.findLastEntry(P,B);return Y?Y[0]:-1},first:function(){return this.get(0)},flatten:function(P){return Sn(this,uA(this,P,!1))},get:function(P,B){return P=F(this,P),P<0||this.size===1/0||this.size!==void 0&&P>this.size?B:this.find(function(Y,re){return re===P},void 0,B)},has:function(P){return P=F(this,P),P>=0&&(this.size!==void 0?this.size===1/0||P<this.size:this.indexOf(P)!==-1)},interpose:function(P){return Sn(this,v7(this,P))},interleave:function(){var P=[this].concat(O(arguments)),B=X1(this.toSeq(),xe.of,P),Y=B.flatten(!0);return B.size&&(Y.size=B.size*P.length),Sn(this,Y)},keySeq:function(){return me(0,this.size)},last:function(){return this.get(-1)},skipWhile:function(P,B){return Sn(this,sA(this,P,B,!1))},zip:function(){var P=[this].concat(O(arguments));return Sn(this,X1(this,S7,P))},zipWith:function(P){var B=O(arguments);return B[0]=this,Sn(this,X1(this,P,B))}}),o.prototype[v]=!0,o.prototype[m]=!0,bs(s,{get:function(P,B){return this.has(P)?P:B},includes:function(P){return this.has(P)},keySeq:function(){return this.valueSeq()}}),s.prototype.has=ai.includes,s.prototype.contains=s.prototype.includes,bs(Ae,i.prototype),bs(xe,o.prototype),bs(ae,s.prototype),bs(gt,i.prototype),bs(Tt,o.prototype),bs(Wt,s.prototype);function y7(P,B){return B}function b7(P,B){return[B,P]}function om(P){return function(){return!P.apply(this,arguments)}}function AA(P){return function(){return-P.apply(this,arguments)}}function PA(P){return typeof P=="string"?JSON.stringify(P):String(P)}function S7(){return O(arguments)}function TA(P,B){return P<B?1:P>B?-1:0}function x7(P){if(P.size===1/0)return 0;var B=f(P),Y=l(P),re=B?1:0,ie=P.__iterate(Y?B?function(Se,Pe){re=31*re+EA(Yt(Se),Yt(Pe))|0}:function(Se,Pe){re=re+EA(Yt(Se),Yt(Pe))|0}:B?function(Se){re=31*re+Yt(Se)|0}:function(Se){re=re+Yt(Se)|0});return C7(ie,re)}function C7(P,B){return B=lr(B,3432918353),B=lr(B<<15|B>>>-15,461845907),B=lr(B<<13|B>>>-13,5),B=(B+3864292196|0)^P,B=lr(B^B>>>16,2246822507),B=lr(B^B>>>13,3266489909),B=wr(B^B>>>16),B}function EA(P,B){return P^B+2654435769+(P<<6)+(P>>2)|0}var _7={Iterable:a,Seq:be,Collection:$e,Map:Yr,OrderedMap:Qn,List:Tn,Stack:Jn,Set:Rn,OrderedSet:ys,Record:Oi,Range:me,Repeat:ht,is:tt,fromJS:dt};return _7})})(Nn);var Ry=Object.prototype.hasOwnProperty;function OW(e,t){for(var r=0,n=Object.keys(t);r<n.length;r++){var a=n[r];!Ry.call(t,a)||typeof e[a]=="undefined"&&(e[a]=t[a])}return e}function FW(e,t){for(var r=!1,n=0,a=Object.keys(t);n<a.length;n++){var i=a[n];if(!!Ry.call(t,i)&&t[i]!==e[i]){r=!0;break}}return r?Object.assign({},e,t):e}function R_(e,t){if(!e)return!t;if(!t)return!1;var r=Object.keys(e);if(Object.keys(t).length!==r.length)return!1;for(var n=0,a=r;n<a.length;n++){var i=a[n];if(!Ry.call(e,i)||e[i]!==t[i])return!1}return!0}function kW(e,t){for(var r=e,n=0;n<t.length;n++)if(!!t[n]&&(r=FW(e,t[n]),r!==e)){for(var a=n+1;a<t.length;a++)r=Object.assign(r,t[a]);break}return r}function hc(e){if(e===null||typeof e!="object")return e;if(e instanceof Array){for(var t=[],r=0,n=e.length;r<n;r++)t[r]=hc(e[r]);return t}if(typeof e=="object"&&!("prototype"in e)){var t={};for(var a in e)Ry.call(e,a)&&(t[a]=hc(e[a]));return t}throw new Error(`Can't clone, type "`+typeof e+'" unsupported')}function cs(e,t){if(!!e)for(var r=0,n=Object.keys(e);r<n.length;r++){var a=n[r];t(e[a],a)}}function BW(){var e=function(){var v=typeof window!="undefined"&&window,m=typeof self!="undefined"&&typeof WorkerGlobalScope!="undefined"&&self instanceof WorkerGlobalScope&&self,g=typeof e!="undefined"&&e;return v||g||m}(),t={},r=typeof document!="undefined"?document:void 0,n=1,a;function i(v){for(var m=[],g=1;g<arguments.length;g++)m[g-1]=arguments[g];typeof v!="function"&&(v=new Function(""+v));var y={callback:v,args:m};return t[n]=y,a(n),n++}function o(v){delete t[v]}function s(v){var m=v.callback,g=v.args;switch(g.length){case 0:m();break;case 1:m(g[0]);break;case 2:m(g[0],g[1]);break;case 3:m(g[0],g[1],g[2]);break;default:m.apply(void 0,g);break}}function u(v){var m=t[v];o(v),s(m)}function l(){a=function(v){process.nextTick(function(){u(v)})}}function c(){if(e&&e.postMessage&&!e.importScripts){var v=!0,m=e.onmessage;return e.onmessage=function(){v=!1},e.postMessage("","*"),e.onmessage=m,v}}function d(){var v="setImmediate$"+Math.random()+"$",m=function(g){g.source===e&&typeof g.data=="string"&&g.data.indexOf(v)===0&&u(+g.data.slice(v.length))};window.addEventListener?window.addEventListener("message",m,!1):window.attachEvent("onmessage",m),a=function(g){window.postMessage(v+g,"*")}}function f(){var v=new MessageChannel;v.port1.onmessage=function(m){var g=m.data;u(g)},a=function(m){v.port2.postMessage(m)}}function p(){var v=r.documentElement;a=function(m){var g=r.createElement("script");g.onreadystatechange=function(){u(m),g.onreadystatechange=null,v.removeChild(g),g=null},v.appendChild(g)}}function h(){a=function(v){setTimeout(u,0,v)}}return typeof process!="undefined"&&{}.toString.call(process)==="[object process]"?l():c()?d():typeof MessageChannel!="undefined"?f():r&&"onreadystatechange"in r.createElement("script")?p():h(),{setImmediate:i,clearImmediate:o}}var sx=function(){return typeof setImmediate!="undefined"?typeof window!="undefined"?{setImmediate:function(e){for(var t,r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];return(t=window).setImmediate.apply(t,Nt([e],r))},clearImmediate:function(e){return window.clearImmediate(e)}}:{setImmediate,clearImmediate}:BW()}();function LW(e){sx.setImmediate(e)}var O_={setImmediate:sx.setImmediate,clearImmediate:sx.clearImmediate,immediatePromise:function(){return new Promise(LW)},delay:function(e,t){return t===void 0&&(t=void 0),new Promise(function(r){return setTimeout(r,e,t)})}},Pp=function(){try{return!0}catch{return!1}}(),Ir=function(){try{var t={}.DEBUG;return t==="*"||t==="molstar"}catch{return!1}}(),NW=typeof performance!="undefined"&&performance.mark&&performance.measure,wb=NW&&!Pp,Uh;(function(e){function t(o){return"startTask"+o.id}function r(o){return"endTask"+o.id}function n(o){wb&&performance.mark(t(o))}e.markStart=n;function a(o){wb&&performance.mark(r(o))}e.markEnd=a;function i(o){wb&&performance.measure("\u2733\uFE0F "+o.name,t(o),r(o))}e.measure=i})(Uh||(Uh={}));function UW(e,t,r){r===void 0&&(r=250);var n=TR(e,t,r),a=new OR(n,n.root);return F_(e,a)}function zW(e,t,r){r===void 0&&(r=250);var n=TR(e,t,r);return new OR(n,n.root)}function AR(e,t){return F_(t,e)}function VW(e,t,r){return e.runChild(t,r)}function PR(e){return{taskId:e.id,taskName:e.name,message:"",startedTime:0,canAbort:!0,isIndeterminate:!0,current:0,max:0}}function TR(e,t,r){var n={abortRequested:!1,treeAborted:!1,reason:""};return{updateRateMs:r,lastNotified:xn(),observer:t,abortToken:n,taskId:e.id,root:{progress:PR(e),children:[]},tryAbort:HW(n)}}function HW(e){return function(t){e.abortRequested=!0,e.reason=t||e.reason}}function ER(e){return{progress:w({},e.progress),children:e.children.map(ER)}}function IR(e){return e.progress.canAbort&&e.children.every(IR)}function GW(e){return{root:ER(e.root),canAbort:IR(e.root),requestAbort:e.tryAbort}}function F_(e,t){return ce(this,void 0,void 0,function(){var r,n;return de(this,function(a){switch(a.label){case 0:Uh.markStart(e),t.node.progress.startedTime=xn(),a.label=1;case 1:return a.trys.push([1,3,,7]),[4,e.f(t)];case 2:return r=a.sent(),Uh.markEnd(e),Uh.measure(e),t.info.abortToken.abortRequested&&MR(t.info),[2,r];case 3:return n=a.sent(),We.isAbort(n)?(t.isAborted=!0,t.node.children.length>0?[4,new Promise(function(i){t.onChildrenFinished=i})]:[3,5]):[3,6];case 4:a.sent(),a.label=5;case 5:e.onAbort&&e.onAbort(),a.label=6;case 6:throw Ir&&console.error(n),n;case 7:return[2]}})})}function MR(e){throw e.abortToken.treeAborted||(e.abortToken.treeAborted=!0,DR(e.root),RR(e,xn())),We.Aborted(e.abortToken.reason)}function DR(e){var t=e.progress;t.isIndeterminate=!0,t.canAbort=!1,t.message="Aborting...";for(var r=0,n=e.children;r<n.length;r++){var a=n[r];DR(a)}}function RR(e,t){e.lastNotified=t;var r=GW(e);e.observer(r)}var OR=function(){function e(t,r){this.isSynchronous=!1,this.isExecuting=!0,this.lastUpdatedTime=0,this.onChildrenFinished=void 0,this.node=r,this.info=t}return e.prototype.checkAborted=function(){this.info.abortToken.abortRequested&&(this.isAborted=!0,MR(this.info))},Object.defineProperty(e.prototype,"shouldUpdate",{get:function(){return this.checkAborted(),xn()-this.lastUpdatedTime>this.info.updateRateMs},enumerable:!1,configurable:!0}),e.prototype.updateProgress=function(t){if(this.checkAborted(),!!t){var r=this.node.progress;typeof t=="string"?(r.message=t,r.isIndeterminate=!0):(typeof t.canAbort!="undefined"&&(r.canAbort=t.canAbort),typeof t.message!="undefined"&&(r.message=t.message),typeof t.current!="undefined"&&(r.current=t.current),typeof t.max!="undefined"&&(r.max=t.max),r.isIndeterminate=typeof r.current=="undefined"||typeof r.max=="undefined",typeof t.isIndeterminate!="undefined"&&(r.isIndeterminate=t.isIndeterminate))}},e.prototype.update=function(t,r){if(this.lastUpdatedTime=xn(),this.updateProgress(t),!r)return RR(this.info,this.lastUpdatedTime),this.checkAborted(),O_.immediatePromise()},e.prototype.runChild=function(t,r){return ce(this,void 0,void 0,function(){var n,a,i,o,s,u,l;return de(this,function(c){switch(c.label){case 0:this.updateProgress(r),n={progress:PR(t),children:[]},a=this.node.children,a.push(n),i=new e(this.info,n),c.label=1;case 1:return c.trys.push([1,3,4,5]),[4,F_(t,i)];case 2:return[2,c.sent()];case 3:if(o=c.sent(),We.isAbort(o)&&this.isAborted)return[2,void 0];throw o;case 4:if(s=a.indexOf(n),s>=0){for(u=s,l=a.length-1;u<l;u++)a[u]=a[u+1];a.pop()}return a.length===0&&this.onChildrenFinished&&this.onChildrenFinished(),[7];case 5:return[2]}})})},e}(),qW=function(){function e(){this.shouldUpdate=!1,this.isSynchronous=!0}return e.prototype.update=function(t,r){},e}(),w0=new qW,We;(function(e){var t=function(){function d(f,p,h){this.name=f,this.f=p,this.onAbort=h,this.id=c()}return d.prototype.run=function(f,p){return p===void 0&&(p=250),f?UW(this,f,p):this.f(w0)},d.prototype.runAsChild=function(f,p){return f.isSynchronous?this.f(w0):VW(f,this,p)},d.prototype.runInContext=function(f){return f.isSynchronous?this.f(w0):AR(f,this)},d}();function r(d){var f=d;return!!d&&typeof f.id=="number"&&typeof f.name=="string"&&!!f.run}e.is=r;function n(d){return!!d&&!!d.isAborted}e.isAbort=n;function a(d){return{isAborted:!0,reason:d,toString:function(){return"Aborted"+(d?": "+d:"")}}}e.Aborted=a;function i(d,f,p){return new t(d,f,p)}e.create=i;function o(d,f){var p=this;return i(d,function(h){return ce(p,void 0,void 0,function(){return de(this,function(v){return[2,f]})})})}e.constant=o;function s(){var d=this;return i("",function(f){return ce(d,void 0,void 0,function(){return de(this,function(p){return[2]})})})}e.empty=s;function u(d,f){var p=this;return i(d,function(h){return ce(p,void 0,void 0,function(){return de(this,function(v){throw new Error(f)})})})}e.fail=u;function l(d,f){return r(d)?f?d.runInContext(f):d.run():d}e.resolveInContext=l;var c=ti(0,1073741823)})(We||(We={}));var X4;(function(e){e.Synchronous=w0})(X4||(X4={}));var Y4;(function(e){function t(n,a){a===void 0&&(a="");var i=n.progress;if(!n.children.length)return i.isIndeterminate?""+a+i.taskName+": "+i.message:""+a+i.taskName+": ["+i.current+"/"+i.max+"] "+i.message;var o=a+"  |_ ",s=n.children.map(function(u){return t(u,o)});return i.isIndeterminate?""+a+i.taskName+": "+i.message+`
`+s.join(`
`):""+a+i.taskName+": ["+i.current+"/"+i.max+"] "+i.message+`
`+s.join(`
`)}function r(n){return t(n.root)}e.format=r})(Y4||(Y4={}));function Uu(e,t,r,n,a){return ce(this,void 0,void 0,function(){var i,o,s,u,l,c,d;return de(this,function(f){switch(f.label){case 0:if(i=Math.max(t,0),o=0,s=0,e.isSynchronous)return n(Number.MAX_SAFE_INTEGER,r),[2,r];u=xn(),l=0,c=0,f.label=1;case 1:return(l=n(i,r))>0?(o+=l,d=xn()-u,c+=d,s+=d,e.shouldUpdate?[4,a(e,r,o)]:[3,3]):[3,4];case 2:f.sent(),i=Math.round(c*o/s)+1,u=xn(),c=0,f.label=3;case 3:return[3,1];case 4:return e.shouldUpdate?[4,a(e,r,o)]:[3,6];case 5:f.sent(),f.label=6;case 6:return[2,r]}})})}function jW(e){return e>>0}function Jl(e,t){return e[t]|e[t+1]<<8}function ad(e,t,r){e[t]=r&255,e[t+1]=r>>8&255}function id(e,t){return e[t+3]*(256*256*256)+(e[t+2]<<16|e[t+1]<<8|e[t])}function Su(e,t,r){e[t]=r&255,e[t+1]=r>>8&255,e[t+2]=r>>16&255,e[t+3]=r>>24&255}function WW(e,t,r){for(var n="",a=0;a<r;a++)n+=String.fromCharCode(e[t+a]);return n}function XW(e){return e.length<2?"0"+e:e}function YW(e,t,r){for(var n="",a,i=0;i<r;i++)n+="%"+XW(e[t+i].toString(16));try{a=decodeURIComponent(n)}catch{return WW(e,t,r)}return a}function KW(e,t,r){for(var n=r.length,a=0,i=0;i<n;i++){var o=r.charCodeAt(i);if((o&4294967295-(1<<7)+1)===0)e[t+a]=o,a++;else if((o&4294967295-(1<<11)+1)===0)e[t+a]=192|o>>6,e[t+a+1]=128|o>>0&63,a+=2;else if((o&4294967295-(1<<16)+1)===0)e[t+a]=224|o>>12,e[t+a+1]=128|o>>6&63,e[t+a+2]=128|o>>0&63,a+=3;else if((o&4294967295-(1<<21)+1)===0)e[t+a]=240|o>>18,e[t+a+1]=128|o>>12&63,e[t+a+2]=128|o>>6&63,e[t+a+3]=128|o>>0&63,a+=4;else throw"e"}return a}function FR(e){for(var t=e.length,r=0,n=0;n<t;n++){var a=e.charCodeAt(n);if((a&4294967295-(1<<7)+1)===0)r++;else if((a&4294967295-(1<<11)+1)===0)r+=2;else if((a&4294967295-(1<<16)+1)===0)r+=3;else if((a&4294967295-(1<<21)+1)===0)r+=4;else throw"e"}return r}var $W=function(){for(var e=new Uint32Array(256),t=0;t<256;t++){for(var r=t,n=0;n<8;n++)r&1?r=3988292384^r>>>1:r=r>>>1;e[t]=r}return e}();function QW(e,t,r,n){for(var a=0;a<n;a++)e=$W[(e^t[r+a])&255]^e>>>8;return e}function kR(e,t,r){return QW(4294967295,e,t,r)^4294967295}var bt=function(){var e=Uint16Array,t=Uint32Array;return{next_code:new e(16),bl_count:new e(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new e(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new t(32),flmap:new e(512),fltree:[],fdmap:new e(32),fdtree:[],lmap:new e(32768),ltree:[],ttree:[],dmap:new e(32768),dtree:[],imap:new e(512),itree:[],rev15:new e(1<<15),lhst:new t(286),dhst:new t(30),ihst:new t(19),lits:new t(15e3),strt:new e(1<<16),prev:new e(1<<15)}}();(function(){for(var e=32768,t=0;t<e;t++){var r=t;r=(r&2863311530)>>>1|(r&1431655765)<<1,r=(r&3435973836)>>>2|(r&858993459)<<2,r=(r&4042322160)>>>4|(r&252645135)<<4,r=(r&4278255360)>>>8|(r&16711935)<<8,bt.rev15[t]=(r>>>16|r<<16)>>>17}function n(a,i,o){for(;i--!==0;)a.push(0,o)}for(var t=0;t<32;t++)bt.ldef[t]=bt.of0[t]<<3|bt.exb[t],bt.ddef[t]=bt.df0[t]<<4|bt.dxb[t];n(bt.fltree,144,8),n(bt.fltree,255-143,9),n(bt.fltree,279-255,7),n(bt.fltree,287-279,8),uc(bt.fltree,9),zh(bt.fltree,9,bt.flmap),Vh(bt.fltree,9),n(bt.fdtree,32,5),uc(bt.fdtree,5),zh(bt.fdtree,5,bt.fdmap),Vh(bt.fdtree,5),n(bt.itree,19,0),n(bt.ltree,286,0),n(bt.dtree,30,0),n(bt.ttree,320,0)})();function zh(e,t,r){for(var n=e.length,a=bt.rev15,i=0;i<n;i+=2)if(e[i+1]!==0)for(var o=i>>1,s=e[i+1],u=o<<4|s,l=t-s,c=e[i]<<l,d=c+(1<<l);c!==d;){var f=a[c]>>>15-t;r[f]=u,c++}}function uc(e,t){for(var r=e.length,n=bt.bl_count,a=0;a<=t;a++)n[a]=0;for(var a=1;a<r;a+=2)n[e[a]]++;var i=bt.next_code,o=0;n[0]=0;for(var s=1;s<=t;s++)o=o+n[s-1]<<1,i[s]=o;for(var u=0;u<r;u+=2){var l=e[u+1];l!==0&&(e[u]=i[l],i[l]++)}}function Vh(e,t){for(var r=bt.rev15,n=15-t,a=0;a<e.length;a+=2){var i=e[a]<<t-e[a+1];e[a]=r[i]>>>n}}function ZW(e,t){var r=t===void 0;return t===void 0&&(t=new Uint8Array(e.length>>>2<<3)),{data:e,buf:t,noBuf:r,BFINAL:0,off:0,pos:0}}function JW(e,t){for(var r=e.data,n=e.noBuf,a=e.buf,i=e.BFINAL,o=e.off,s=e.pos,u=0;i===0&&u<t;){var l=void 0,c=void 0,d=0,f=0;i=Pb(r,s,1),u+=1;var p=Pb(r,s+1,2);if(s+=3,p===0){(s&7)!==0&&(s+=8-(s&7));var h=(s>>>3)+4,v=r[h-4]|r[h-3]<<8;n&&(a=Ab(a,o+v)),a.set(new Uint8Array(r.buffer,r.byteOffset+h,v),o),s=h+v<<3,o+=v;continue}if(n&&(a=Ab(a,o+(1<<17))),p===1)l=bt.flmap,c=bt.fdmap,d=(1<<9)-1,f=(1<<5)-1;else if(p===2){var m=jl(r,s,5)+257,g=jl(r,s+5,5)+1,y=jl(r,s+10,4)+4;s+=14;for(var b=0;b<38;b+=2)bt.itree[b]=0,bt.itree[b+1]=0;for(var x=1,b=0;b<y;b++){var S=jl(r,s+b*3,3);bt.itree[(bt.ordr[b]<<1)+1]=S,S>x&&(x=S)}s+=3*y,uc(bt.itree,x),zh(bt.itree,x,bt.imap),l=bt.lmap,c=bt.dmap,s=tX(bt.imap,(1<<x)-1,m+g,r,s,bt.ttree);var _=K4(bt.ttree,0,m,bt.ltree);d=(1<<_)-1;var A=K4(bt.ttree,m,g,bt.dtree);f=(1<<A)-1,uc(bt.ltree,_),zh(bt.ltree,_,l),uc(bt.dtree,A),zh(bt.dtree,A,c)}else throw new Error("unknown BTYPE "+p);for(;;){var T=l[ux(r,s)&d];s+=T&15;var I=T>>>4;if(I>>>8===0)a[o++]=I;else{if(I===256)break;var M=o+I-254;if(I>264){var O=bt.ldef[I-257];M=o+(O>>>3)+jl(r,s,O&7),s+=O&7}var D=c[ux(r,s)&f];s+=D&15;var F=D>>>4,G=bt.ddef[F],N=(G>>>4)+Pb(r,s,G&15);for(s+=G&15,n&&(a=Ab(a,o+(1<<17)));o<M;)a[o]=a[o++-N],a[o]=a[o++-N],a[o]=a[o++-N],a[o]=a[o++-N];o=M}}}e.buf=a,e.BFINAL=i,e.off=o,e.pos=s}function eX(e,t,r){return ce(this,void 0,void 0,function(){var n;return de(this,function(a){switch(a.label){case 0:if(t[0]===3&&t[1]===0)return[2,r||new Uint8Array(0)];n=ZW(t,r),a.label=1;case 1:return n.BFINAL!==0?[3,4]:e.shouldUpdate?[4,e.update({message:"Inflating blocks...",current:n.pos,max:t.length})]:[3,3];case 2:a.sent(),a.label=3;case 3:return JW(n,100),[3,1];case 4:return[2,n.buf.length===n.off?n.buf:n.buf.slice(0,n.off)]}})})}function Ab(e,t){var r=e.length;if(t<=r)return e;var n=new Uint8Array(Math.max(r<<1,t));return n.set(e,0),n}function tX(e,t,r,n,a,i){for(var o=0;o<r;){var s=e[ux(n,a)&t];a+=s&15;var u=s>>>4;if(u<=15)i[o]=u,o++;else{var l=0,c=0;u===16?(c=3+jl(n,a,2),a+=2,l=i[o-1]):u===17?(c=3+jl(n,a,3),a+=3):u===18&&(c=11+jl(n,a,7),a+=7);for(var d=o+c;o<d;)i[o]=l,o++}}return a}function K4(e,t,r,n){for(var a=0,i=0,o=n.length>>>1;i<r;){var s=e[i+t];n[i<<1]=0,n[(i<<1)+1]=s,s>a&&(a=s),i++}for(;i<o;)n[i<<1]=0,n[(i<<1)+1]=0,i++;return a}function jl(e,t,r){return(e[t>>>3]|e[(t>>>3)+1]<<8)>>>(t&7)&(1<<r)-1}function Pb(e,t,r){return(e[t>>>3]|e[(t>>>3)+1]<<8|e[(t>>>3)+2]<<16)>>>(t&7)&(1<<r)-1}function ux(e,t){return(e[t>>>3]|e[(t>>>3)+1]<<8|e[(t>>>3)+2]<<16)>>>(t&7)}function Tb(e,t,r){for(var n=[],a=e.length,i=t.length,o=0;o<i;o+=2)t[o]=0,t[o+1]=0;for(var o=0;o<a;o++)e[o]!==0&&n.push({lit:o,f:e[o],d:void 0});var s=n.length,u=n.slice(0);if(s===0)return 0;if(s===1){var l=n[0].lit,c=l===0?1:0;return t[(l<<1)+1]=1,t[(c<<1)+1]=1,1}n.sort(function(g,y){return g.f-y.f});var d=n[0],f=n[1],p=0,h=1,v=2;for(n[0]={lit:-1,f:d.f+f.f,l:d,r:f,d:0};h!==s-1;)p!==h&&(v===s||n[p].f<n[v].f)?d=n[p++]:d=n[v++],p!==h&&(v===s||n[p].f<n[v].f)?f=n[p++]:f=n[v++],n[h++]={lit:-1,f:d.f+f.f,l:d,r:f,d:void 0};var m=lx(n[h-1],0);m>r&&(rX(u,r,m),m=r);for(var o=0;o<s;o++)t[(u[o].lit<<1)+1]=u[o].d;return m}function lx(e,t){return e.lit!==-1?(e.d=t,t):Math.max(lx(e.l,t+1),lx(e.r,t+1))}function rX(e,t,r){var n=0,a=1<<r-t,i=0;for(e.sort(function(s,u){return u.d===s.d?s.f-u.f:u.d-s.d}),n=0;n<e.length&&e[n].d>t;n++){var o=e[n].d;e[n].d=t,i+=a-(1<<r-o)}for(i=i>>>r-t;i>0;){var o=e[n].d;o<t?(e[n].d++,i-=1<<t-o-1):n++}for(;n>=0;n--)e[n].d===t&&i<0&&(e[n].d--,i++);i!==0&&console.log("debt left")}function nX(e,t,r,n){var a=bt.lits,i=bt.strt,o=bt.prev;return{data:e,out:t,opt:iX[n],i:0,pos:r<<3,cvrd:0,dlen:e.length,li:0,lc:0,bs:0,ebits:0,c:0,nc:0,lits:a,strt:i,prev:o}}function aX(e,t){for(var r=e.data,n=e.dlen,a=e.out,i=e.opt,o=e.i,s=e.pos,u=e.cvrd,l=e.li,c=e.lc,d=e.bs,f=e.ebits,p=e.c,h=e.nc,v=bt.lits,m=bt.strt,g=bt.prev,y=Math.min(o+t,n);o<y;o++){if(p=h,o+1<n-2){h=k_(r,o+1);var b=o+1&32767;g[b]=m[h],m[h]=b}if(u<=o){(l>14e3||c>26697)&&n-o>100&&(u<o&&(v[l]=o-u,l+=2,u=o),s=BR(o===n-1||u===n?1:0,v,l,f,r,d,o-d,a,s),l=c=f=0,d=o);var x=0;if(o<n-2&&(x=sX(r,o,g,p,Math.min(i[2],n-o),i[3])),x!==0){var S=x>>>16,_=x&65535,A=Z4(S,bt.of0);bt.lhst[257+A]++;var T=Z4(_,bt.df0);bt.dhst[T]++,f+=bt.exb[A]+bt.dxb[T],v[l]=S<<23|o-u,v[l+1]=_<<16|A<<8|T,l+=2,u=o+S}else bt.lhst[r[o]]++;c++}}e.i=o,e.pos=s,e.cvrd=u,e.li=l,e.lc=c,e.bs=d,e.ebits=f,e.c=p,e.nc=h}var iX=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]];function oX(e,t,r,n,a){return ce(this,void 0,void 0,function(){var i,o,s,u,l,c,d,f,p,h,v,m;return de(this,function(g){switch(g.label){case 0:if(i=nX(t,r,n,a),o=i.dlen,a===0){for(s=i.i,u=i.pos;s<o;)l=Math.min(65535,o-s),od(r,u,s+l===o?1:0),u=LR(t,s,l,r,u+8),s+=l;return[2,u>>>3]}o>2&&(i.nc=k_(t,0),i.strt[i.nc]=0),g.label=1;case 1:return i.i<o?e.shouldUpdate?[4,e.update({message:"Deflating...",current:i.i,max:o})]:[3,3]:[3,4];case 2:g.sent(),g.label=3;case 3:return aX(i,1024*1024),[3,1];case 4:for(c=i.li,d=i.cvrd,f=i.pos,p=i.i,h=i.lits,v=i.bs,m=i.ebits,(v!==p||t.length===0)&&(d<p&&(h[c]=p-d,c+=2,d=p),f=BR(1,h,c,m,t,v,p-v,r,f));(f&7)!==0;)f++;return[2,f>>>3]}})})}function sX(e,t,r,n,a,i){var o=t&32767,s=r[o],u=o-s+(1<<15)&32767;if(s===o||n!==k_(e,t-u))return 0;for(var l=0,c=0,d=Math.min(32767,t);u<=d&&--i!==0&&s!==o;){if(l===0||e[t+l]===e[t+l-u]){var f=uX(e,t,u);if(f>l){if(l=f,c=u,l>=a)break;u+2<f&&(f=u+2);for(var p=0,h=0;h<f-2;h++){var v=t-u+h+32768&32767,m=r[v],g=v-m+(1<<15)&32767;g>p&&(p=g,s=v)}}}o=s,s=r[o],u+=o-s+(1<<15)&32767}return l<<16|c}function uX(e,t,r){if(e[t]!==e[t-r]||e[t+1]!==e[t+1-r]||e[t+2]!==e[t+2-r])return 0;var n=t,a=Math.min(e.length,t+258);for(t+=3;t<a&&e[t]===e[t-r];)t++;return t-n}function k_(e,t){return(e[t]<<8|e[t+1])+(e[t+2]<<4)&65535}function BR(e,t,r,n,a,i,o,s,u){bt.lhst[256]++;var l=lX(),c=l[0],d=l[1],f=l[2],p=l[3],h=l[4],v=l[5],m=l[6],g=l[7],y=((u+3&7)===0?0:8-(u+3&7))+32+(o<<3),b=n+Qp(bt.fltree,bt.lhst)+Qp(bt.fdtree,bt.dhst),x=n+Qp(bt.ltree,bt.lhst)+Qp(bt.dtree,bt.dhst);x+=14+3*v+Qp(bt.itree,bt.ihst)+(bt.ihst[16]*2+bt.ihst[17]*3+bt.ihst[18]*7);for(var S=0;S<286;S++)bt.lhst[S]=0;for(var S=0;S<30;S++)bt.dhst[S]=0;for(var S=0;S<19;S++)bt.ihst[S]=0;var _=y<b&&y<x?0:b<x?1:2;if(A0(s,u,e),A0(s,u+1,_),u+=3,_===0){for(;(u&7)!==0;)u++;u=LR(a,i,o,s,u)}else{var A=void 0,T=void 0;if(_===1)A=bt.fltree,T=bt.fdtree;else if(_===2){uc(bt.ltree,c),Vh(bt.ltree,c),uc(bt.dtree,d),Vh(bt.dtree,d),uc(bt.itree,f),Vh(bt.itree,f),A=bt.ltree,T=bt.dtree,od(s,u,p-257),u+=5,od(s,u,h-1),u+=5,od(s,u,v-4),u+=4;for(var I=0;I<v;I++)od(s,u+I*3,bt.itree[(bt.ordr[I]<<1)+1]);u+=3*v,u=$4(m,bt.itree,s,u),u=$4(g,bt.itree,s,u)}else throw new Error("unknown BTYPE "+_);for(var M=i,O=0;O<r;O+=2){for(var D=t[O],F=D>>>23,G=M+(D&(1<<23)-1);M<G;)u=_h(a[M++],A,s,u);if(F!==0){var N=t[O+1],z=N>>16,$=N>>8&255,j=N&255;u=_h(257+$,A,s,u),od(s,u,F-bt.of0[$]),u+=bt.exb[$],u=_h(j,T,s,u),A0(s,u,z-bt.df0[j]),u+=bt.dxb[j],M+=F}}u=_h(256,A,s,u)}return u}function LR(e,t,r,n,a){var i=a>>>3;return n[i]=r,n[i+1]=r>>>8,n[i+2]=255-n[i],n[i+3]=255-n[i+1],i+=4,n.set(new Uint8Array(e.buffer,t,r),i),a+(r+4<<3)}function lX(){for(var e=Tb(bt.lhst,bt.ltree,15),t=Tb(bt.dhst,bt.dtree,15),r=[],n=Q4(bt.ltree,r),a=[],i=Q4(bt.dtree,a),o=0;o<r.length;o+=2)bt.ihst[r[o]]++;for(var o=0;o<a.length;o+=2)bt.ihst[a[o]]++;for(var s=Tb(bt.ihst,bt.itree,7),u=19;u>4&&bt.itree[(bt.ordr[u-1]<<1)+1]===0;)u--;return[e,t,s,n,i,u,r,a]}function Qp(e,t){for(var r=0,n=0;n<t.length;n++)r+=t[n]*e[(n<<1)+1];return r}function $4(e,t,r,n){for(var a=0;a<e.length;a+=2){var i=e[a],o=e[a+1];n=_h(i,t,r,n);var s=i===16?2:i===17?3:7;i>15&&(od(r,n,o),n+=s)}return n}function Q4(e,t){for(var r=e.length;r!==2&&e[r-1]===0;)r-=2;for(var n=0;n<r;n+=2){var a=e[n+1],i=n+3<r?e[n+3]:-1,o=n+5<r?e[n+5]:-1,s=n===0?-1:e[n-1];if(a===0&&i===a&&o===a){for(var u=n+5;u+2<r&&e[u+2]===a;)u+=2;var l=Math.min(u+1-n>>>1,138);l<11?t.push(17,l-3):t.push(18,l-11),n+=l*2-2}else if(a===s&&i===a&&o===a){for(var u=n+5;u+2<r&&e[u+2]===a;)u+=2;var l=Math.min(u+1-n>>>1,6);t.push(16,l-3),n+=l*2-2}else t.push(a,0)}return r>>>1}function Z4(e,t){var r=0;return t[r|16]<=e&&(r|=16),t[r|8]<=e&&(r|=8),t[r|4]<=e&&(r|=4),t[r|2]<=e&&(r|=2),t[r|1]<=e&&(r|=1),r}function _h(e,t,r,n){return A0(r,n,t[e<<1]),n+t[(e<<1)+1]}function od(e,t,r){r=r<<(t&7);var n=t>>>3;e[n]|=r,e[n+1]|=r>>>8}function A0(e,t,r){r=r<<(t&7);var n=t>>>3;e[n]|=r,e[n+1]|=r>>>8,e[n+2]|=r>>>16}function NR(e,t,r){return r===void 0&&(r=!1),ce(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d,f,p,h,v;return de(this,function(m){switch(m.label){case 0:for(n=Object.create(null),a=new Uint8Array(t),i=a.length-4;id(a,i)!==101010256;)i--;o=i,o+=4,o+=4,s=Jl(a,o),o+=2,o+=2,o+=4,u=id(a,o),o+=4,o=u,l=0,m.label=1;case 1:return l<s?(o+=4,o+=4,o+=4,o+=4,o+=4,c=id(a,o),o+=4,d=id(a,o),o+=4,f=Jl(a,o),p=Jl(a,o+2),h=Jl(a,o+4),o+=6,o+=8,v=id(a,o),o+=4,o+=f+p+h,[4,cX(e,a,v,n,c,d,r)]):[3,4];case 2:m.sent(),m.label=3;case 3:return l++,[3,1];case 4:return[2,n]}})})}function cX(e,t,r,n,a,i,o){return ce(this,void 0,void 0,function(){var s,u,l,c,d,f;return de(this,function(p){switch(p.label){case 0:return r+=4,r+=2,r+=2,s=Jl(t,r),r+=2,r+=4,r+=4,r+=8,u=Jl(t,r),r+=2,l=Jl(t,r),r+=2,c=YW(t,r,u),r+=u,r+=l,o?(n[c]={size:i,csize:a},[2]):(d=new Uint8Array(t.buffer,r),s!==0?[3,1]:(n[c]=new Uint8Array(d.buffer.slice(r,r+a)),[3,4]));case 1:return s!==8?[3,3]:(f=new Uint8Array(i),[4,UR(e,d,f)]);case 2:return p.sent(),n[c]=f,[3,4];case 3:throw"unknown compression method: "+s;case 4:return[2]}})})}function UR(e,t,r){return ce(this,void 0,void 0,function(){return de(this,function(n){return[2,eX(e,t,r)]})})}function dX(e,t,r){return ce(this,void 0,void 0,function(){var n,a,i,o,o,s,u,l,c,d;return de(this,function(f){switch(f.label){case 0:if(n=t[3],a=10,n&4&&(i=Jl(t,a),a+=i),n&8){for(o=a;t[o]!==0;)++o;a=o+1}if(n&16){for(o=a;t[o]!==0;)++o;a=o+1}return n&1&&(a+=2),s=jW(id(t,t.length-8)),u=id(t,t.length-4),r===void 0&&(r=new Uint8Array(u)),l=new Uint8Array(t.buffer,t.byteOffset+a,t.length-a-8),[4,UR(e,l,r)];case 1:return c=f.sent(),d=kR(c,0,c.length),s!==d&&console.error("ungzip: checksums don't match"),[2,c]}})})}function fX(e,t,r){return ce(this,void 0,void 0,function(){var n,a;return de(this,function(i){switch(i.label){case 0:return r===void 0&&(r={level:6}),n=new Uint8Array(50+Math.floor(t.length*1.1)),[4,oX(e,t,n,0,r.level)];case 1:return a=i.sent(),[2,new Uint8Array(n.buffer,0,a)]}})})}function pX(e,t){return t===void 0&&(t=!1),We.create("Zip",function(r){return hX(r,e,t)})}function hX(e,t,r){return r===void 0&&(r=!1),ce(this,void 0,void 0,function(){var n,a,i,o,s,b,u,l,c,d,f,p,b,h,v,m,b,x,g,y,b,x,S,_;return de(this,function(A){switch(A.label){case 0:n=0,a={},i=[];for(o in t)i.push(o);s=0,A.label=1;case 1:return s<i.length?(b=i[s],u=!vX(b)&&!r,l=t[b],c=kR(l,0,l.length),d=a,f=b,_={cpr:u,usize:l.length,crc:c},u?[4,fX(e,l)]:[3,3]):[3,6];case 2:return p=A.sent(),[3,4];case 3:p=l,A.label=4;case 4:d[f]=(_.file=p,_),A.label=5;case 5:return s++,[3,1];case 6:for(b in a)n+=a[b].file.length+30+46+2*FR(b);n+=22,h=new Uint8Array(n),v=0,m=[];for(b in a)x=a[b],m.push(v),v=J4(h,v,b,x,0);g=0,y=v;for(b in a)x=a[b],m.push(v),v=J4(h,v,b,x,1,m[g++]);return S=v-y,Su(h,v,101010256),v+=4,v+=4,ad(h,v,g),v+=2,ad(h,v,g),v+=2,Su(h,v,S),v+=4,Su(h,v,y),v+=4,v+=2,[2,h.buffer]}})})}function vX(e){var t=e.split(".").pop().toLowerCase();return"png,jpg,jpeg,zip".indexOf(t)!==-1}function J4(e,t,r,n,a,i){i===void 0&&(i=0);var o=n.file;Su(e,t,a===0?67324752:33639248),t+=4,a===1&&(t+=2),ad(e,t,20),t+=2,ad(e,t,0),t+=2,ad(e,t,n.cpr?8:0),t+=2,Su(e,t,0),t+=4,Su(e,t,n.crc),t+=4,Su(e,t,o.length),t+=4,Su(e,t,n.usize),t+=4,ad(e,t,FR(r)),t+=2,ad(e,t,0),t+=2,a===1&&(t+=2,t+=2,t+=6,Su(e,t,i),t+=4);var s=KW(e,t,r);return t+=s,a===0&&(e.set(o,t),t+=o.length),t}function qf(e,t,r){for(var n=0,a=r.length;n<a;n++){var i=r.charCodeAt(n);if(i<128){e[t++]=i>>>0&127|0;continue}if(i<2048){e[t++]=i>>>6&31|192,e[t++]=i>>>0&63|128;continue}if(i<65536){e[t++]=i>>>12&15|224,e[t++]=i>>>6&63|128,e[t++]=i>>>0&63|128;continue}if(i<1114112){e[t++]=i>>>18&7|240,e[t++]=i>>>12&63|128,e[t++]=i>>>6&63|128,e[t++]=i>>>0&63|128;continue}throw new Error("bad codepoint "+i)}}var mX=function(){for(var e=[],t=0;t<1024;t++)e[t]=String.fromCharCode(t);return e}();function zR(e){throw new Error(e)}function gX(e,t,r){for(var n=mX,a=void 0,i=[],o=512,s=0,u=t,l=t+r;u<l;u++){var c=e[u];(c&128)===0?i[s++]=n[c]:(c&224)===192?i[s++]=n[(c&15)<<6|e[++u]&63]:(c&240)===224?i[s++]=String.fromCharCode((c&15)<<12|(e[++u]&63)<<6|(e[++u]&63)<<0):(c&248)===240?i[s++]=String.fromCharCode((c&7)<<18|(e[++u]&63)<<12|(e[++u]&63)<<6|(e[++u]&63)<<0):zR("Invalid byte "+c.toString(16)),s===o&&(a=a||[],a[a.length]=i.join(""),s=0)}return a?(s>0&&(a[a.length]=i.slice(0,s).join("")),a.join("")):i.slice(0,s).join("")}var eP=typeof TextDecoder!="undefined"?new TextDecoder:void 0;function B_(e,t,r){if(eP){var n=t||r!==e.length?e.subarray(t,t+r):e;return eP.decode(n)}else return gX(e,t,r)}function ng(e){for(var t=0,r=0,n=e.length;r<n;r++){var a=e.charCodeAt(r);if(a<128){t+=1;continue}if(a<2048){t+=2;continue}if(a<65536){t+=3;continue}if(a<1114112){t+=4;continue}zR("bad codepoint "+a)}return t}var yX=typeof document=="undefined"?require("xhr2"):XMLHttpRequest,ts;(function(e){e[e.None=0]="None",e[e.Gzip=1]="Gzip",e[e.Zip=2]="Zip"})(ts||(ts={}));function ec(e,t){return _X(e,t)}function cx(e){return typeof e=="string"?rP(e,e,"string"):rP(e.title,e.url,e.type||"string",e.body,e.headers)}function bX(e){if(e instanceof FileReader)return e.readyState===FileReader.DONE;if(e instanceof XMLHttpRequest)return e.readyState===XMLHttpRequest.DONE;throw new Error("unknown data type")}function tP(e){return e?"Failed to download data. Possible reasons: Resource is not available, or CORS is not allowed on the server.":"Failed to open file."}function VR(e,t,r){return new Promise(function(n,a){if(bX(r)){var i=r.error;i!=null?a(i!=null?i:tP(r instanceof XMLHttpRequest)):n(r);return}var o=!1;r.onerror=function(s){if(!o){var u=s.target.error;a(u!=null?u:tP(r instanceof XMLHttpRequest))}},r.onprogress=function(s){if(!(!e.shouldUpdate||o))try{s.lengthComputable?e.update({message:t,isIndeterminate:!1,current:s.loaded,max:s.total}):e.update({message:t+" "+(s.loaded/1024/1024).toFixed(2)+" MB",isIndeterminate:!0})}catch(u){o=!0,a(u)}},r.onload=function(s){n(r)}})}function SX(e){return/\.gz$/i.test(e)?ts.Gzip:/\.zip$/i.test(e)?ts.Zip:ts.None}function xX(e,t,r){return ce(this,void 0,void 0,function(){var n,a,i;return de(this,function(o){switch(o.label){case 0:switch(n=r,n){case ts.None:return[3,1];case ts.Gzip:return[3,2];case ts.Zip:return[3,3]}return[3,5];case 1:return[2,t];case 2:return[2,dX(e,t)];case 3:return[4,NR(e,t.buffer)];case 4:if(a=o.sent(),i=Object.keys(a),i.length!==1)throw new Error("can only decompress zip files with a single entry");return[2,a[i[0]]];case 5:return[2]}})})}function CX(e,t,r,n){return ce(this,void 0,void 0,function(){var a,i,o,s;return de(this,function(u){switch(u.label){case 0:if(a=t.result,i=a instanceof ArrayBuffer?new Uint8Array(a):a,i===null)throw new Error("no data given");if(n===ts.None)return[3,4];if(!(i instanceof Uint8Array))throw new Error("need Uint8Array for decompression");return[4,xX(e,i,n)];case 1:return o=u.sent(),r!=="string"?[3,3]:[4,e.update({message:"Decoding text..."})];case 2:return u.sent(),i=B_(o,0,o.length),[3,4];case 3:i=o,u.label=4;case 4:return r==="binary"&&i instanceof Uint8Array?[2,i]:[3,5];case 5:return r==="zip"&&i instanceof Uint8Array?[4,NR(e,i.buffer)]:[3,7];case 6:return[2,u.sent()];case 7:if(r==="string"&&typeof i=="string")return[2,i];if(r==="xml"&&typeof i=="string")return s=new DOMParser,[2,s.parseFromString(i,"application/xml")];if(r==="json"&&typeof i=="string")return[2,JSON.parse(i)];u.label=8;case 8:throw new Error("could not get requested response data '"+r+"'")}})})}function _X(e,t){var r=this,n=void 0;return We.create("Read File",function(a){return ce(r,void 0,void 0,function(){var i,o;return de(this,function(s){switch(s.label){case 0:return s.trys.push([0,,5,6]),n=new FileReader,i=t==="zip"?ts.None:SX(e.name),t==="binary"||t==="zip"||i!==ts.None?n.readAsArrayBuffer(e):n.readAsText(e),[4,a.update({message:"Opening file...",canAbort:!0})];case 1:return s.sent(),[4,VR(a,"Reading...",n)];case 2:return o=s.sent(),[4,a.update({message:"Processing file...",canAbort:!1})];case 3:return s.sent(),[4,CX(a,o,t,i)];case 4:return[2,s.sent()];case 5:return n=void 0,[7];case 6:return[2]}})})},function(){n&&n.abort()})}var dx=function(){function e(){}return e.get=function(){return this.pool.length?this.pool.pop():new yX},e.emptyFunc=function(){},e.deposit=function(t){this.pool.length<this.poolSize&&(t.onabort=e.emptyFunc,t.onerror=e.emptyFunc,t.onload=e.emptyFunc,t.onprogress=e.emptyFunc,this.pool.push(t))},e.pool=[],e.poolSize=15,e}();function wX(e,t){if(e.status>=200&&e.status<400){var r=e.response;if(dx.deposit(e),(t==="binary"||t==="zip")&&r instanceof ArrayBuffer)return new Uint8Array(r);if(t==="string"&&typeof r=="string")return r;if(t==="xml"&&r instanceof XMLDocument)return r;if(t==="json"&&typeof r=="object")return r;throw new Error("could not get requested response data '"+t+"'")}else throw dx.deposit(e),new Error("Download failed with status code "+e.status)}function AX(e){switch(e){case"json":return"json";case"xml":return"document";case"string":return"text";case"binary":return"arraybuffer";case"zip":return"arraybuffer"}}function rP(e,t,r,n,a){var i=this,o=void 0;return We.create(e||"Download",function(s){return ce(i,void 0,void 0,function(){var u,l,c,d,f,p,h;return de(this,function(v){switch(v.label){case 0:if(o=dx.get(),o.open(n?"post":"get",t,!0),a)for(u=0,l=a;u<l.length;u++)c=l[u],d=c[0],f=c[1],o.setRequestHeader(d,f);return o.responseType=AX(r),o.send(n),[4,s.update({message:"Waiting for server...",canAbort:!0})];case 1:return v.sent(),[4,VR(s,"Downloading...",o)];case 2:return p=v.sent(),o=void 0,[4,s.update({message:"Parsing response...",canAbort:!1})];case 3:return v.sent(),h=wX(p,r),[2,h]}})})},function(){o&&(o.abort(),o=void 0)})}function PX(e,t,r,n){return ce(this,void 0,void 0,function(){var a,i,o,s,u,l,h,c,d,f,p,h,v;return de(this,function(m){switch(m.label){case 0:return a=r.length,i=new Array(r.length),[4,e.update({message:"Downloading...",current:0,max:a})];case 1:for(m.sent(),o=[],s=[],u=0,l=Math.min(a,n);u<l;u++)h=r[u],o.push(aP(u,h.id,t.resolve(gn.getUrlAsset(t,h.url),h.isBinary?"binary":"string").runAsChild(e))),s.push(u);c=0,m.label=2;case 2:return o.length>0?[4,Promise.race(o)]:[3,6];case 3:if(d=m.sent(),f=r[d.index],p=s.indexOf(d.index),c++,d.kind==="error"&&!f.canFail)throw new Error(f.url+": "+d.error);return e.shouldUpdate?[4,e.update({message:"Downloading...",current:c,max:a})]:[3,5];case 4:m.sent(),m.label=5;case 5:return i[d.index]=d,o=o.filter(nP,p),s=s.filter(nP,p),u<a&&(h=r[u],v=t.resolve(gn.getUrlAsset(t,h.url),h.isBinary?"binary":"string").runAsChild(e),o.push(aP(u,h.id,v)),s.push(u),u++),[3,2];case 6:return[2,i]}})})}function nP(e,t){return this!==t}function aP(e,t,r){return ce(this,void 0,void 0,function(){var n,a;return de(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,r];case 1:return n=i.sent(),[2,{kind:"ok",result:n,index:e,id:t}];case 2:return a=i.sent(),[2,{kind:"error",error:a,index:e,id:t}];case 3:return[2]}})})}var gn;(function(e){function t(u,l){return w({kind:"url",id:un.create22(),url:u},l)}e.Url=t;function r(u){return{kind:"file",id:un.create22(),name:u.name,file:u}}e.File=r;function n(u){return(u==null?void 0:u.kind)==="url"}e.isUrl=n;function a(u){return(u==null?void 0:u.kind)==="file"}e.isFile=a;function i(u,l,c){return{data:u,dispose:function(){c.release(l)}}}e.Wrapper=i;function o(u){return typeof u=="string"?u:u.url}e.getUrl=o;function s(u,l,c){if(typeof l=="string"){var d=u.tryFindUrl(l,c);return d||t(l,{body:c})}return l}e.getUrlAsset=s})(gn||(gn={}));var TX=function(){function e(){this._assets=new Map}return Object.defineProperty(e.prototype,"assets",{get:function(){return E_(this._assets.values())},enumerable:!1,configurable:!0}),e.prototype.tryFindUrl=function(t,r){for(var n=this.assets.values();;){var a=n.next();if(a.done)return;var i=a.value.asset;if(gn.isUrl(i)&&i.url===t&&(i.body||"")===(r||""))return i}},e.prototype.set=function(t,r){this._assets.set(t.id,{asset:t,file:r,refCount:0})},e.prototype.resolve=function(t,r,n){var a=this;return n===void 0&&(n=!0),gn.isUrl(t)?We.create("Download "+(t.title||t.url),function(i){return ce(a,void 0,void 0,function(){var o,s,u,l,c,d,f,p,h;return de(this,function(v){switch(v.label){case 0:return this._assets.has(t.id)?(o=this._assets.get(t.id),o.refCount++,u=(s=gn).Wrapper,[4,ec(o.file,r).runInContext(i)]):[3,2];case 1:return[2,u.apply(s,[v.sent(),t,this])];case 2:return n?[3,4]:(c=(l=gn).Wrapper,[4,cx(w(w({},t),{type:r})).runInContext(i)]);case 3:return[2,c.apply(l,[v.sent(),t,this])];case 4:return[4,cx(w(w({},t),{type:"binary"})).runInContext(i)];case 5:return d=v.sent(),f=new File([d],"raw-data"),this._assets.set(t.id,{asset:t,file:f,refCount:1}),h=(p=gn).Wrapper,[4,ec(f,r).runInContext(i)];case 6:return[2,h.apply(p,[v.sent(),t,this])]}})})}):We.create("Read "+t.name,function(i){return ce(a,void 0,void 0,function(){var o,s,u,l,c;return de(this,function(d){switch(d.label){case 0:return this._assets.has(t.id)?(o=this._assets.get(t.id),o.refCount++,u=(s=gn).Wrapper,[4,ec(o.file,r).runInContext(i)]):[3,2];case 1:return[2,u.apply(s,[d.sent(),t,this])];case 2:if(!(t.file instanceof File))throw new Error("Cannot resolve file asset '"+t.name+"' ("+t.id+")");return n&&this._assets.set(t.id,{asset:t,file:t.file,refCount:1}),c=(l=gn).Wrapper,[4,ec(t.file,r).runInContext(i)];case 3:return[2,c.apply(l,[d.sent(),t,this])]}})})})},e.prototype.release=function(t){var r=this._assets.get(t.id);!r||(r.refCount--,r.refCount<=0&&this._assets.delete(t.id))},e}(),E;(function(e){e.Essential={isEssential:!0};function t(ae,oe){return oe&&(oe.label&&(ae.label=oe.label),oe.description&&(ae.description=oe.description),oe.legend&&(ae.legend=oe.legend),oe.fieldLabels&&(ae.fieldLabels=oe.fieldLabels),oe.isHidden&&(ae.isHidden=oe.isHidden),oe.shortLabel&&(ae.shortLabel=oe.shortLabel),oe.twoColumns&&(ae.twoColumns=oe.twoColumns),oe.isEssential&&(ae.isEssential=oe.isEssential),oe.category&&(ae.category=oe.category),oe.hideIf&&(ae.hideIf=oe.hideIf),oe.help&&(ae.help=oe.help)),ae}function r(ae){var oe=w({},ae);return oe.isOptional=!0,oe}e.Optional=r;function n(ae,oe){return t({type:"value",defaultValue:ae},oe)}e.Value=n;function a(ae,oe,R){return t({type:"select",defaultValue:xe(ae,oe),options:oe,cycle:R==null?void 0:R.cycle},R)}e.Select=a;function i(ae,oe,R){var V=t({type:"multi-select",defaultValue:ae,options:oe},R);return R!=null&&R.emptyValue&&(V.emptyValue=R.emptyValue),V}e.MultiSelect=i;function o(ae,oe){return t({type:"boolean",defaultValue:ae},oe)}e.Boolean=o;function s(ae,oe){return ae===void 0&&(ae=""),t({type:"text",defaultValue:ae},oe)}e.Text=s;function u(ae,oe){var R=t({type:"color",defaultValue:ae},oe);return oe!=null&&oe.isExpanded&&(R.isExpanded=oe.isExpanded),R}e.Color=u;function l(ae,oe){var R;if(typeof ae=="string"){var V=To(ae);R={kind:V.type!=="qualitative"?"interpolate":"set",colors:V.list}}else R=ae;return t({type:"color-list",presetKind:(oe==null?void 0:oe.presetKind)||"all",defaultValue:R,offsets:!!(oe!=null&&oe.offsets)},oe)}e.ColorList=l;function c(ae,oe,R){return t(v({type:"vec3",defaultValue:ae},oe),R)}e.Vec3=c;function d(ae,oe){return t({type:"mat4",defaultValue:ae},oe)}e.Mat4=d;function f(ae,oe){var R=typeof ae=="string"?gn.Url(ae):gn.Url(ae.url,{body:ae.body}),V=t({type:"url",defaultValue:R},oe);return V}e.Url=f;function p(ae){var oe=t({type:"file",defaultValue:null},ae);return ae!=null&&ae.accept&&(oe.accept=ae.accept),oe}e.File=p;function h(ae){var oe=t({type:"file-list",defaultValue:null},ae);return ae!=null&&ae.accept&&(oe.accept=ae.accept),oe}e.FileList=h;function v(ae,oe){return oe&&(typeof oe.min!="undefined"&&(ae.min=oe.min),typeof oe.max!="undefined"&&(ae.max=oe.max),typeof oe.step!="undefined"&&(ae.step=oe.step)),ae}function m(ae,oe,R){var V=t(v({type:"number",defaultValue:ae},oe),R);return R!=null&&R.immediateUpdate&&(V.immediateUpdate=!0),V}e.Numeric=m;function g(ae,oe,R){return t(v({type:"interval",defaultValue:ae},oe),R)}e.Interval=g;function y(ae,oe){return t({type:"line-graph",defaultValue:ae},oe)}e.LineGraph=y;function b(ae,oe){var R=t({type:"group",defaultValue:(oe==null?void 0:oe.customDefault)||z(ae),params:ae},oe);return oe!=null&&oe.isExpanded&&(R.isExpanded=oe.isExpanded),oe!=null&&oe.isFlat&&(R.isFlat=oe.isFlat),oe!=null&&oe.pivot&&(R.pivot=oe.pivot),R}e.Group=b;function x(ae){return b({},ae)}e.EmptyGroup=x;function S(ae,oe,R,V){var pe=xe(ae,oe);return t({type:"mapped",defaultValue:{name:pe,params:R(pe).defaultValue},select:a(pe,oe,V),map:R},V)}e.Mapped=S;function _(ae,oe,R){var V=R!=null&&R.options?R.options:Object.keys(oe).map(function(_e){return[_e,oe[_e].label||ji(_e)]}),pe=xe(ae,V);return t({type:"mapped",defaultValue:{name:pe,params:oe[pe].defaultValue},select:a(pe,V,R),map:function(_e){return oe[_e]}},R)}e.MappedStatic=_;function A(ae,oe,R){return t({type:"object-list",element:ae,getLabel:oe,ctor:T,defaultValue:(R==null?void 0:R.defaultValue)||[]},R)}e.ObjectList=A;function T(){return z(this.element)}function I(){throw new Error("getValue not set. Fix runtime.")}function M(ae,oe,R){var V;return t({type:"value-ref",defaultValue:{ref:(V=R==null?void 0:R.defaultRef)!==null&&V!==void 0?V:"",getValue:I},getOptions:ae,resolveRef:oe},R)}e.ValueRef=M;function O(ae){var oe;return t({type:"data-ref",defaultValue:{ref:(oe=ae==null?void 0:ae.defaultRef)!==null&&oe!==void 0?oe:"",getValue:I}},ae)}e.DataRef=O;function D(ae,oe,R){return{type:"converted",defaultValue:oe(R.defaultValue),converted:R,fromValue:ae,toValue:oe}}e.Converted=D;function F(ae,oe,R,V,pe){var _e=Object.keys(oe).map(function(Ee){return[Ee,Ee]});return t({type:"conditioned",select:a(R(ae),_e,pe),defaultValue:ae,conditionParams:oe,conditionForValue:R,conditionedValue:V},pe)}e.Conditioned=F;function G(ae,oe){return t({type:"script",defaultValue:ae},oe)}e.Script=G;function N(ae){return 0}e.For=N;function z(ae){for(var oe={},R=0,V=Object.keys(ae);R<V.length;R++){var pe=V[R];ae[pe].isOptional||(oe[pe]=ae[pe].defaultValue)}return oe}e.getDefaultValues=z;function $(ae,oe){return function(){return ae(oe)}}function j(ae,oe,R){if(!!oe){if(ae.type==="value-ref"){var V=oe;V.ref?V.getValue=$(ae.resolveRef,V.ref):V.getValue=function(){throw new Error("Unset ref in ValueRef value.")}}else if(ae.type==="data-ref"){var V=oe;V.ref?V.getValue=$(R,V.ref):V.getValue=function(){throw new Error("Unset ref in ValueRef value.")}}else if(ae.type==="group")te(ae.params,oe,R);else if(ae.type==="mapped"){var V=oe,pe=ae.map(V.name);j(pe,V.params,R)}else if(ae.type==="object-list"){if(!q(ae.element))return;for(var _e=0,Ee=oe;_e<Ee.length;_e++){var Ve=Ee[_e];te(ae.element,Ve,R)}}}}function Z(ae){if(ae.type==="value-ref"||ae.type==="data-ref")return!0;if(ae.type==="group"){if(q(ae.params))return!0}else if(ae.type==="mapped")for(var oe=0,R=ae.select.options;oe<R.length;oe++){var V=R[oe][0];if(Z(ae.map(V)))return!0}else if(ae.type==="object-list")return q(ae.element);return!1}function q(ae){for(var oe=0,R=Object.keys(ae);oe<R.length;oe++){var V=R[oe];if(Z(ae[V]))return!0}return!1}function te(ae,oe,R){for(var V=0,pe=Object.keys(ae);V<pe.length;V++){var _e=pe[V];j(ae[_e],oe==null?void 0:oe[_e],R)}}e.resolveRefs=te;function he(ae,oe){for(var R=0,V=Object.keys(ae);R<V.length;R++){var pe=V[R];ae[pe].isOptional||(ae[pe].defaultValue=oe[pe])}}e.setDefaultValues=he;function W(ae){return hc(ae)}e.clone=W;function K(ae,oe){}e.validate=K;function U(ae,oe,R){if(oe===R)return!0;if(typeof oe!="object"||typeof R!="object")return!1;for(var V=0,pe=Object.keys(ae);V<pe.length;V++){var _e=pe[V];if(!H(ae[_e],oe[_e],R[_e]))return!1}return!0}e.areEqual=U;function H(ae,oe,R){if(oe===R)return!0;if(ae.type==="group")return U(ae.params,oe,R);if(ae.type==="mapped"){var V=oe,pe=R;if(V.name!==pe.name)return!1;var _e=ae.map(V.name);return H(_e,V.params,pe.params)}else if(ae.type==="multi-select"){var V=oe,pe=R;if(V.length!==pe.length)return!1;if(V.length<10){for(var Ee=0,Ve=V.length;Ee<Ve;Ee++)if(V[Ee]!==pe[Ee]&&pe.indexOf(V[Ee])<0)return!1}else for(var He=new Set(pe),Ee=0,Ve=V.length;Ee<Ve;Ee++)if(V[Ee]!==pe[Ee]&&!He.has(V[Ee]))return!1;return!0}else{if(ae.type==="interval")return oe[0]===R[0]&&oe[1]===R[1];if(ae.type==="line-graph"){var V=oe,pe=R;if(V.length!==pe.length)return!1;for(var Ee=0,Ve=V.length;Ee<Ve;Ee++)if(!Ge.areEqual(V[Ee],pe[Ee]))return!1;return!0}else{if(ae.type==="vec3")return C.equals(oe,R);if(ae.type==="mat4")return ue.areEqual(oe,R,fn);if(ae.type==="script"){var V=oe,pe=R;return V.language===pe.language&&V.expression===pe.expression}else if(ae.type==="object-list"){var V=oe,pe=R,Ye=V.length;if(Ye!==pe.length)return!1;for(var Ee=0;Ee<Ye;Ee++)if(!U(ae.element,V[Ee],pe[Ee]))return!1;return!0}else if(typeof oe=="object"&&typeof R=="object")return lp(oe,R)}}return!1}e.isParamEqual=H;function J(ae,oe,R){if(oe===void 0)return w({},R);if(R===void 0)return w({},oe);for(var V=Object.create(null),pe=0,_e=Object.keys(ae);pe<_e.length;pe++){var Ee=_e[pe];V[Ee]=X(ae[Ee],oe[Ee],R[Ee])}return V}e.merge=J;function X(ae,oe,R){if(oe===void 0)return typeof R=="object"&&!Array.isArray(R)?w({},R):R;if(R===void 0)return typeof oe=="object"&&!Array.isArray(oe)?w({},oe):oe;if(ae.type==="group")return J(ae.params,oe,R);if(ae.type==="mapped"){var V=oe,pe=R;if(V.name!==pe.name)return w({},pe);var _e=ae.map(pe.name);return{name:pe.name,params:X(_e,V.params,pe.params)}}else return ae.type==="value"?R:typeof oe=="object"&&typeof R=="object"?Array.isArray(R)?R:w(w({},oe),R):R}e.mergeParam=X;function Q(ae,oe){for(var R=0,V=ae.options;R<V.length;R++){var pe=V[R];if(pe[0]===oe)return!0}return!1}function ee(ae,oe,R){if(oe==null)return R?ae.defaultValue:void 0;if(ae.type==="value")return oe;if(ae.type==="group"){for(var V=Object.create(null),pe=0,_e=Object.keys(ae.params);pe<_e.length;pe++){var Ee=_e[pe],Ve=ae.params[Ee];oe[Ee]===void 0?R&&(V[Ee]=Ve.defaultValue):V[Ee]=ee(Ve,oe[Ee],R)}return V}else if(ae.type==="mapped"){var He=oe;if(typeof He.name!="string")return ae.defaultValue;if(typeof He.params=="undefined")return R?ae.defaultValue:void 0;if(!Q(ae.select,He.name))return ae.defaultValue;var Ve=ae.map(He.name);return{name:He.name,params:ee(Ve,He.params,R)}}else{if(ae.type==="select")return Q(ae,oe)?oe:ae.defaultValue;if(ae.type==="multi-select"){if(!Array.isArray(oe))return ae.defaultValue;var V=oe.filter(function(lt){return Q(this,lt)},ae);return oe.length>0&&V.length===0?ae.defaultValue:V}else if(ae.type==="object-list")return Array.isArray(oe)?oe.map(function(Ye){return le(ae.element,Ye,R?"all":"skip")}):ae.defaultValue}return oe}function le(ae,oe,R){if(typeof oe!="object"||oe===null)return R?z(ae):oe;for(var V=Object.create(null),pe=0,_e=Object.keys(ae);pe<_e.length;pe++){var Ee=_e[pe],Ve=ae[Ee];oe[Ee]===void 0?R==="all"&&(V[Ee]=Ve.defaultValue):V[Ee]=ee(Ve,oe[Ee],R!=="skip")}return V}e.normalizeParams=le;function ye(ae,oe){for(var R=[],V=0,pe=Object.keys(ae);V<pe.length;V++){var _e=pe[V];if(!oe)typeof ae[_e]=="string"?R.push([_e,ae[_e]]):R.push([_e,oe===null?_e:ji(_e)]);else{var Ee=oe(_e,ae[_e]);R.push(typeof Ee=="string"?[_e,Ee]:[_e,Ee[0],Ee[1]])}}return R}e.objectToOptions=ye;function be(ae,oe){for(var R=[],V=0,pe=ae;V<pe.length;V++){var _e=pe[V];oe?R.push([_e,oe(_e)]):R.push([_e,oe===null?_e:ji(_e)])}return R}e.arrayToOptions=be;function Ae(ae,oe){for(var R=0,V=ae.options;R<V.length;R++){var pe=V[R];if(pe[0]===oe)return pe[1]}return""}e.optionLabel=Ae;function xe(ae,oe){for(var R=0,V=oe;R<V.length;R++){var pe=V[R];if(pe[0]===ae)return ae}return oe.length>0?oe[0][0]:void 0}})(E||(E={}));var Ai;(function(e){function t(a){var i={create:function(o){return{action:i,params:o}},id:un.create22(),definition:a,createDefaultParams:function(o,s){return a.params?E.getDefaultValues(a.params(o,s)):{}}};return i}e.create=t;function r(a){var i=a.definition;return t({from:i.from,display:i.display,params:i.params,isApplicable:a.definition.isApplicable?function(o,s,u){return a.definition.isApplicable(o,u)}:void 0,run:function(o){var s=o.cell,u=o.state,l=o.params,c=u.build().to(s.transform.ref).apply(a,l);return u.updateTree(c)}})}e.fromTransformer=r;var n;(function(a){function i(o){return function(s){return t(w({from:o.from instanceof Array?o.from:o.from?[o.from]:[],display:typeof o.display=="string"?{name:o.display}:o.display?o.display:{name:"Unnamed State Action"},params:typeof o.params=="object"?function(){return o.params}:o.params?o.params:void 0,isApplicable:o.isApplicable},typeof s=="function"?{run:s}:s))}}a.build=function(o){return i(o)}})(n=e.Builder||(e.Builder={})),e.build=n.build})(Ai||(Ai={}));var ft;(function(e){function t(v,m,g){return v.definition.params?v.definition.params(m,g):{}}e.getParamDefinition=t;function r(v){return!!v&&typeof v.toAction=="function"&&typeof v.apply=="function"}e.is=r;var n;(function(v){v[v.Unchanged=0]="Unchanged",v[v.Updated=1]="Updated",v[v.Recreate=2]="Recreate",v[v.Null=3]="Null"})(n=e.UpdateResult||(e.UpdateResult={}));var a=new Map,i=new Map;function o(v){for(var m=0,g=v.definition.from;m<g.length;m++){var y=g[m];i.has(y.type)?i.get(y.type).push(v):i.set(y.type,[v])}}function s(){return Array.from(a.values())}e.getAll=s;function u(v){var m=a.get(v);if(!m)throw new Error("A transformer with signature '"+v+"' is not registered.");return m}e.get=u;function l(v){return i.get(v)||[]}e.fromType=l;function c(v,m){var g=m.name,y=v+"."+g;if(a.has(y))throw new Error("A transform with id '"+g+"' is already registered. Please pick a unique identifier for your transforms and/or register them only once. This is to ensure that transforms can be serialized and replayed.");var b={apply:function(x,S,_){return cr.create(x,b,S,_)},toAction:function(){return Ai.fromTransformer(b)},namespace:v,id:y,definition:m,createDefaultParams:function(x,S){return m.params?E.getDefaultValues(m.params(x,S)):{}}};return a.set(y,b),o(b),b}e.create=c;function d(v){return function(m){return c(v,m)}}e.factory=d;function f(v){return p.build(v)}e.builderFactory=f;var p;(function(v){function m(y,b){return function(x){return c(y,w({name:b.name,from:b.from instanceof Array?b.from:[b.from],to:b.to instanceof Array?b.to:[b.to],display:typeof b.display=="string"?{name:b.display}:b.display?b.display:{name:Cp(b.name.replace(/[-]/g," "))},params:typeof b.params=="object"?function(){return b.params}:b.params?b.params:void 0,isDecorator:b.isDecorator},x))}}function g(y){return function(b){return m(y,b)}}v.build=g})(p=e.Builder||(e.Builder={}));function h(v){return p.build(v)}e.build=h,e.ROOT=c("build-in",{name:"root",from:[],to:[],display:{name:"Root",description:"For internal use."},apply:function(){throw new Error("should never be applied")},update:function(){return n.Unchanged}})})(ft||(ft={}));var cr;(function(e){e.RootRef="-=root=-";function t(m,g){return!!m.isHidden!=!!g.isHidden||!!m.isCollapsed!=!!g.isCollapsed||!!m.isGhost!=!!g.isGhost||!!m.isLocked!=!!g.isLocked}e.areStatesEqual=t;function r(m,g){return g?typeof g.isCollapsed!="undefined"&&m.isCollapsed!==g.isCollapsed||typeof g.isHidden!="undefined"&&m.isHidden!==g.isHidden||typeof g.isGhost!="undefined"&&m.isGhost!==g.isGhost||typeof g.isLocked!="undefined"&&m.isLocked!==g.isLocked:!1}e.isStateChange=r;function n(m,g){if(!g)return!1;for(var y=!1,b=0,x=Object.keys(g);b<x.length;b++){var S=x[b],_=g[S],A=m[S];!!_!=!!A&&(y=!0,m[S]=_)}return y}e.assignState=n;function a(m,g){if(!g)return!1;for(var y=!1,b=0,x=Object.keys(g);b<x.length;b++){var S=x[b],_=g[S],A=m[S];!!_!=!!A&&(y=!0,m[S]=_)}for(var T=0,I=Object.keys(m);T<I.length;T++){var S=I[T],_=g[S],A=m[S];!!_!=!!A&&(y=!0,m[S]=_)}return y}e.syncState=a;function i(m,g,y,b){var x=b&&b.ref?b.ref:un.create22(),S=void 0;return b&&b.tags&&(S=typeof b.tags=="string"?[b.tags]:b.tags,S.length===0?S=void 0:S.sort()),{parent:m,transformer:g,state:(b==null?void 0:b.state)||{},tags:S,ref:x,dependsOn:b&&b.dependsOn,params:y,version:un.create22()}}e.create=i;function o(m,g){return w(w({},m),{params:g,version:un.create22()})}e.withParams=o;function s(m,g){return g?w(w({},m),{state:w(w({},m.state),g)}):m}e.withState=s;function u(m,g){var y=void 0;return g&&(y=typeof g=="string"?[g]:g,y.length===0?y=void 0:y.sort()),w(w({},m),{tags:y,version:un.create22()})}e.withTags=u;function l(m,g){return w(w({},m),{parent:g,version:un.create22()})}e.withParent=l;function c(m){return i(e.RootRef,ft.ROOT,{},{ref:e.RootRef,state:m})}e.createRoot=c;function d(m,g){return m.tags?m.tags.indexOf(g)>=0:!1}e.hasTag=d;function f(m,g){if(!m.tags)return typeof g!="string"&&g.length===0;if(typeof g=="string")return d(m,g);for(var y=0,b=g;y<b.length;y++){var x=b[y];if(m.tags.indexOf(x)<0)return!1}return!0}e.hasTags=f;function p(m){return m}function h(m){for(var g=m.transformer.definition.customSerialization?m.transformer.definition.customSerialization.toJSON:p,y=void 0,b=0,x=Object.keys(m.state);b<x.length;b++){var S=x[b],_=m.state[S];!_||(y||(y={}),y[S]=!0)}return{parent:m.parent,transformer:m.transformer.id,params:m.params?g(m.params):void 0,state:y,tags:m.tags,ref:m.ref,dependsOn:m.dependsOn,version:m.version}}e.toJSON=h;function v(m){var g=ft.get(m.transformer),y=g.definition.customSerialization?g.definition.customSerialization.fromJSON:p;return{parent:m.parent,transformer:g,params:m.params?y(m.params):void 0,state:m.state||{},tags:m.tags,ref:m.ref,dependsOn:m.dependsOn,version:m.version}}e.fromJSON=v})(cr||(cr={}));function Gs(e){for(var t=-1/0,r=0,n=e.length;r<n;++r)e[r]>t&&(t=e[r]);return t}function Oy(e){for(var t=1/0,r=0,n=e.length;r<n;++r)e[r]<t&&(t=e[r]);return t}function Ui(e){for(var t=1/0,r=-1/0,n=0,a=e.length;n<a;++n)e[n]<t&&(t=e[n]),e[n]>r&&(r=e[n]);return[t,r]}function Hh(e,t,r){t===void 0&&(t=1),r===void 0&&(r=0);for(var n=e.length,a=0,i=r;i<n;i+=t)a+=e[i];return a}function Fy(e,t,r){return t===void 0&&(t=1),r===void 0&&(r=0),Hh(e,t,r)/(e.length/t)}function ky(e){for(var t=e.length,r=0,n=0;n<t;++n){var a=e[n];r+=a*a}return Math.sqrt(r/t)}function Mo(e,t){for(var r=0,n=t?Math.min(t,e.length):e.length;r<n;++r)e[r]=r;return e}function sv(e,t){for(var r=0,n=e.length,a=!1;r<n;r++)if(e[r]===t){a=!0;break}return a?(uv(e,r),!0):!1}function uv(e,t){for(var r=t,n=e.length-1;r<n;r++)e[r]=e[r+1];e.pop()}function Xa(e,t){return e.indexOf(t)>=0?!1:(e.push(t),!0)}function yd(e,t){var r=e.indexOf(t);if(r<0)return!1;for(var n=r,a=e.length-1;n<a;n++)e[n]=e[n+1];return e.pop(),!0}function ag(e,t){for(var r=0,n=0,a=e.length;n<a;++n)t.includes(e[n])&&(r+=1);return r}function L_(e,t){if(!e||e.length===0)return!t||t.length===0;if(!t)return!1;var r=e.length;if(r!==t.length)return!1;for(var n=0;n<r;n++)if(e[n]!==t[n])return!1;return!0}function EX(e){for(var t=0,r=e.length;t<r;t++)if(e[t]!==t)return!1;return!0}function IX(e,t,r){for(var n=0,a=e.length;n<a;++n)if(e[n][0]===t){e[n][1]=r;return}e.push([t,r])}var MX=function(){function e(t){this.tree=t,this.transforms=this.tree.transforms,this.children=this.tree.children,this.dependencies=this.tree.dependencies,this.changedNodes=!1,this.changedChildren=!1,this.changedDependencies=!1,this._childMutations=void 0,this._dependencyMutations=void 0,this._stateUpdates=void 0}return Object.defineProperty(e.prototype,"childMutations",{get:function(){return this._childMutations?this._childMutations:(this._childMutations=new Map,this._childMutations)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dependencyMutations",{get:function(){return this._dependencyMutations?this._dependencyMutations:(this._dependencyMutations=new Map,this._dependencyMutations)},enumerable:!1,configurable:!0}),e.prototype.changeNodes=function(){this.changedNodes||(this.changedNodes=!0,this.transforms=this.transforms.asMutable())},e.prototype.changeChildren=function(){this.changedChildren||(this.changedChildren=!0,this.children=this.children.asMutable())},e.prototype.changeDependencies=function(){this.changedDependencies||(this.changedDependencies=!0,this.dependencies=this.dependencies.asMutable())},Object.defineProperty(e.prototype,"root",{get:function(){return this.transforms.get(cr.RootRef)},enumerable:!1,configurable:!0}),e.prototype.asTransient=function(){return this.asImmutable().asTransient()},e.prototype.addChild=function(t,r){if(this.changeChildren(),this.childMutations.has(t))this.childMutations.get(t).add(r);else{var n=this.children.get(t).asMutable();n.add(r),this.children.set(t,n),this.childMutations.set(t,n)}},e.prototype.removeChild=function(t,r){if(this.changeChildren(),this.childMutations.has(t))this.childMutations.get(t).remove(r);else{var n=this.children.get(t).asMutable();n.remove(r),this.children.set(t,n),this.childMutations.set(t,n)}},e.prototype.clearRoot=function(){var t=cr.RootRef;if(this.children.get(t).size!==0){this.changeChildren();var r=Nn.exports.OrderedSet();this.children.set(t,r),this.childMutations.set(t,r)}},e.prototype.mutateDependency=function(t,r,n){var a=this.dependencyMutations.get(t);if(!a){var i=this.dependencies.get(t);if(!i&&n==="remove")return;this.changeDependencies(),a=i?i.asMutable():Nn.exports.OrderedSet().asMutable(),this.dependencyMutations.set(t,a),this.dependencies.set(t,a)}n==="add"?a.add(r):a.remove(r)},e.prototype.changeParent=function(t,r){bm(this.transforms,t);var n=this.transforms.get(t);this.removeChild(n.parent,t),this.addChild(r,t),this.changeNodes(),this.transforms.set(t,cr.withParent(n,r))},e.prototype.add=function(t){var r=t.ref;if(this.transforms.has(t.ref)){var n=this.transforms.get(t.ref);n.parent!==t.parent&&OX(t.ref)}var a=this.children.get(t.parent);if(a||FX(t.parent),a.has(t.ref)||this.addChild(t.parent,t.ref),this.children.has(t.ref)||(this.changedChildren||(this.changedChildren=!0,this.children=this.children.asMutable()),this.children.set(t.ref,Nn.exports.OrderedSet())),this.changeNodes(),this.transforms.set(r,t),t.dependsOn)for(var i=0,o=t.dependsOn;i<o.length;i++){var s=o[i];this.mutateDependency(s,r,"add")}return this},e.prototype.setParams=function(t,r){bm(this.transforms,t);var n=this.transforms.get(t);return R_(n.params,r)?!1:(this.changedNodes||(this.changedNodes=!0,this.transforms=this.transforms.asMutable()),this.transforms.set(n.ref,cr.withParams(n,r)),!0)},e.prototype.setTags=function(t,r){bm(this.transforms,t);var n=this.transforms.get(t),a=cr.withParams(n,r);return L_(n.tags,a.tags)?!1:(this.changedNodes||(this.changedNodes=!0,this.transforms=this.transforms.asMutable()),this.transforms.set(n.ref,a),!0)},e.prototype.assignState=function(t,r){bm(this.transforms,t);var n=this.transforms.get(t);if(this._stateUpdates&&this._stateUpdates.has(t))return cr.assignState(n.state,r),n;this._stateUpdates||(this._stateUpdates=new Set),this._stateUpdates.add(n.ref),this.changeNodes();var a=cr.withState(n,r);return this.transforms.set(t,a),a},e.prototype.remove=function(t){var r=this.transforms.get(t);if(!r)return[];var n=Hn.subtreePostOrder(this,r);if(t===cr.RootRef){if(n.pop(),n.length===0)return n;this.clearRoot()}else{if(n.length===0)return n;this.removeChild(r.parent,r.ref)}this.changeNodes(),this.changeChildren();for(var a=0,i=n;a<i.length;a++){var o=i[a];this.transforms.delete(o.ref),this.children.delete(o.ref),this._childMutations&&this._childMutations.delete(o.ref)}for(var s=[],u=0,l=n;u<l.length;u++){var o=l[u];if(o.dependsOn)for(var c=0,d=o.dependsOn;c<d.length;c++){var f=d[c];!this.transforms.has(f)||this.mutateDependency(f,o.ref,"remove")}if(this.dependencies.has(o.ref)){var p=this.dependencies.get(o.ref).toArray();this.changeDependencies(),this.dependencies.delete(o.ref),this._dependencyMutations&&this._dependencyMutations.delete(o.ref);for(var h=0,v=p;h<v.length;h++){var m=v[h];if(!!this.transforms.has(m))for(var g=0,y=this.remove(m);g<y.length;g++){var b=y[g];s[s.length]=b}}}}for(var x=0,S=s;x<S.length;x++){var m=S[x];n[n.length]=m}return n},e.prototype.asImmutable=function(){return!this.changedNodes&&!this.changedChildren&&!this._childMutations?this.tree:(this._childMutations&&this._childMutations.forEach(DX,this.children),this._dependencyMutations&&this._dependencyMutations.forEach(RX,this.dependencies),Hn.create(this.changedNodes?this.transforms.asImmutable():this.transforms,this.changedChildren?this.children.asImmutable():this.children,this.changedDependencies?this.dependencies.asImmutable():this.dependencies))},e}();function DX(e,t){this.set(t,e.asImmutable())}function RX(e,t){e.size===0?this.delete(t):this.set(t,e.asImmutable())}function OX(e){throw new Error("Transform '"+e+"' is already present in the tree.")}function FX(e){throw new Error("Parent '"+e+"' must be present in the tree.")}function bm(e,t){if(!e.has(t))throw new Error("Node '"+t+"' is not present in the tree.")}var Hn;(function(e){var t=function(){function b(x,S,_){this.transforms=x,this.children=S,this.dependencies=_}return Object.defineProperty(b.prototype,"root",{get:function(){return this.transforms.get(cr.RootRef)},enumerable:!1,configurable:!0}),b.prototype.asTransient=function(){return new MX(this)},b}();function r(b){var x=b||cr.createRoot();return n(Nn.exports.Map([[x.ref,x]]),Nn.exports.Map([[x.ref,Nn.exports.OrderedSet()]]),Nn.exports.Map())}e.createEmpty=r;function n(b,x,S){return new t(b,x,S)}e.create=n;function a(b){i(this,this.tree.transforms.get(b))}function i(b,x){var S=b.tree.children.get(x.ref);S&&S.size&&S.forEach(a,b),b.f(x,b.tree,b.state)}function o(b,x,S,_){var A={tree:b,state:S,f:_};return i(A,x),A.state}e.doPostOrder=o;function s(b){u(this,this.tree.transforms.get(b))}function u(b,x){var S=b.f(x,b.tree,b.state);if(!(typeof S=="boolean"&&!S)){var _=b.tree.children.get(x.ref);_&&_.size&&_.forEach(s,b)}}function l(b,x,S,_){var A={tree:b,state:S,f:_};return u(A,x),A.state}e.doPreOrder=l;function c(b,x,S){S.push(b)}function d(b,x){return o(b,x,[],c)}e.subtreePostOrder=d;function f(b,x,S){S.push(cr.toJSON(b))}function p(b){var x=[];return l(b,b.root,x,f),{transforms:x}}e.toJSON=p;function h(b){for(var x=Nn.exports.Map().asMutable(),S=Nn.exports.Map().asMutable(),_=Nn.exports.Map().asMutable(),A=0,T=b.transforms;A<T.length;A++){var I=T[A],M=cr.fromJSON(I);x.set(M.ref,M),S.has(M.ref)||S.set(M.ref,Nn.exports.OrderedSet().asMutable()),M.ref!==M.parent&&S.get(M.parent).add(M.ref)}for(var O=new Set,D=0,F=b.transforms;D<F.length;D++){var I=F[D],G=I.ref;if(S.set(G,S.get(G).asImmutable()),!!I.dependsOn)for(var N=0,z=I.dependsOn;N<z.length;N++){var $=z[N];O.add($),_.has($)?_.get($).add(G):_.set($,Nn.exports.OrderedSet([G]).asMutable())}}return O.forEach(function(j){_.set(j,_.get(j).asImmutable())}),n(x.asImmutable(),S.asImmutable(),_.asImmutable())}e.fromJSON=h;function v(b){console.log({tr:b.transforms.keySeq().toArray(),tr1:b.transforms.valueSeq().toArray().map(function(x){return x.ref}),ch:b.children.keySeq().toArray()})}e.dump=v;function m(b,x,S){if(x===S)return!0;for(var _=b.children.get(x),A=_.values();;){var T=A.next();if(T.done)return!1;if(m(b,T.value,S))return!0}}function g(b,x,S){return!b.transforms.has(x)||!b.transforms.has(S)?!1:m(b,x,S)}e.subtreeHasRef=g;function y(b,x){var S=b.children.get(x);if(S.size!==1)return x;var _=b.transforms.get(S.first());return _.transformer.definition.isDecorator?y(b,_.ref):x}e.getDecoratorRoot=y})(Hn||(Hn={}));var ar;(function(e){function t(U,H){return r(U)(H)}e.select=t;function r(U){var H=U||l.root,J;return a(H)?J=H.compile():n(H)?J=l.byValue(H).compile():i(H)?J=H:J=l.byRef(H).compile(),J}e.compile=r;function n(U){return U.transform!==void 0&&U.status!==void 0}function a(U){return U.compile!==void 0}function i(U){return typeof U=="function"}var o={select:function(U){return t(this,U||this.state)}};function s(U,H){o[U]=function(){for(var J=[],X=0;X<arguments.length;X++)J[X]=arguments[X];return H.call.apply(H,Nt([void 0,this],J))}}function u(U){return Object.create(o,{compile:{writable:!1,configurable:!1,value:U}})}var l;(function(U){U.root=u(function(){return function(ae){return[ae.cells.get(ae.tree.root.ref)]}});function H(){for(var ae=[],oe=0;oe<arguments.length;oe++)ae[oe]=arguments[oe];return u(function(){return function(R){for(var V=[],pe=0,_e=ae;pe<_e.length;pe++){var Ee=_e[pe],Ve=R.cells.get(Ee);!Ve||V.push(Ve)}return V}})}U.byRef=H;function J(){for(var ae=[],oe=0;oe<arguments.length;oe++)ae[oe]=arguments[oe];return u(function(){return function(R){return ae}})}U.byValue=J;function X(ae,oe){return oe===void 0&&(oe=cr.RootRef),u(function(){return function(R){var V={roots:[],cells:R.cells,type:ae.type};return Hn.doPreOrder(R.tree,R.tree.transforms.get(oe),V,ye),V.roots}})}U.rootsOfType=X;function Q(ae,oe){return oe===void 0&&(oe=cr.RootRef),u(function(){return function(R){var V={ret:[],cells:R.cells,type:ae.type};return Hn.doPreOrder(R.tree,R.tree.transforms.get(oe),V,be),V.ret}})}U.ofType=Q;function ee(ae,oe){return oe===void 0&&(oe=cr.RootRef),u(function(){return function(R){var V={ret:[],cells:R.cells,t:ae};return Hn.doPreOrder(R.tree,R.tree.transforms.get(oe),V,Ae),V.ret}})}U.ofTransformer=ee;function le(ae,oe){return oe===void 0&&(oe=cr.RootRef),u(function(){return function(R){var V={ret:[],cells:R.cells,t:ae};return Hn.doPreOrder(R.tree,R.tree.transforms.get(oe),V,xe),V.ret}})}U.ofTransformerWithError=le;function ye(ae,oe,R){var V=R.cells.get(ae.ref);return V&&V.obj&&V.obj.type===R.type?(R.roots.push(V),!1):!0}function be(ae,oe,R){var V=R.cells.get(ae.ref);return V&&V.obj&&V.obj.type===R.type&&R.ret.push(V),!0}function Ae(ae,oe,R){var V=R.cells.get(ae.ref);return V&&V.obj&&V.transform.transformer===R.t&&R.ret.push(V),!0}function xe(ae,oe,R){var V=R.cells.get(ae.ref);return V&&V.status==="error"&&V.transform.transformer===R.t&&R.ret.push(V),!0}})(l=e.Generators||(e.Generators={})),s("flatMap",c);function c(U,H){var J=r(U);return u(function(){return function(X){for(var Q=[],ee=0,le=J(X);ee<le.length;ee++)for(var ye=le[ee],be=0,Ae=H(ye,X);be<Ae.length;be++){var xe=Ae[be];Q.push(xe)}return Q}})}e.flatMap=c,s("mapObject",d);function d(U,H){var J=r(U);return u(function(){return function(X){for(var Q=[],ee=0,le=J(X);ee<le.length;ee++){var ye=le[ee],be=H(ye,X);be&&Q.push(be)}return Q}})}e.mapObject=d,s("unique",f);function f(U){var H=r(U);return u(function(){return function(J){for(var X=new Set,Q=[],ee=0,le=H(J);ee<le.length;ee++){var ye=le[ee];!ye||X.has(ye.transform.ref)||(X.add(ye.transform.ref),Q.push(ye))}return Q}})}e.unique=f,s("first",p);function p(U){var H=r(U);return u(function(){return function(J){var X=H(J);return X.length?[X[0]]:[]}})}e.first=p,s("filter",h);function h(U,H){return c(U,function(J){return H(J)?[J]:[]})}e.filter=h,s("withStatus",v);function v(U,H){return h(U,function(J){return J.status===H})}e.withStatus=v,s("withTag",m);function m(U,H){return h(U,function(J){return!!J.transform.tags&&J.transform.tags.indexOf(H)>=0})}e.withTag=m,s("subtree",g);function g(U){return c(U,function(H,J){var X=[];return Hn.doPreOrder(J.tree,J.tree.transforms.get(H.transform.ref),X,function(Q,ee,le){le.push(Q.ref)}),X.map(function(Q){return J.cells.get(Q)})})}e.subtree=g,s("children",y);function y(U){return c(U,function(H,J){var X=[];return J.tree.children.get(H.transform.ref).forEach(function(Q){return X.push(J.cells.get(Q))}),X})}e.children=y,s("ofType",b);function b(U,H){return h(U,function(J){return J.obj?J.obj.type===H.type:!1})}e.ofType=b,s("ancestor",x);function x(U,H){return f(d(U,function(J,X){return D(X.tree,X.cells,J.transform.ref,H)}))}e.ancestor=x,s("ancestorOfType",S);function S(U,H){return f(d(U,function(J,X){return N(X.tree,X.cells,J.transform.ref,H)}))}e.ancestorOfType=S,s("ancestorWithTransformer",_);function _(U,H){return f(d(U,function(J,X){return G(X.tree,X.cells,J.transform.ref,H)}))}e.ancestorWithTransformer=_,s("withTransformer",A);function A(U,H){return h(U,function(J){return J.transform.transformer===H})}e.withTransformer=A,s("root",T);function T(U,H){return f(d(U,function(J,X){return F(X.tree,X.cells,J.transform.ref,H)}))}e.root=T,s("rootOfType",I);function I(U,H){return f(d(U,function(J,X){return z(X.tree,X.cells,J.transform.ref,H)}))}e.rootOfType=I,s("parent",M);function M(U){return f(d(U,function(H,J){return J.cells.get(J.tree.transforms.get(H.transform.ref).parent)}))}e.parent=M;function O(U,H,J,X,Q){for(var ee=U.transforms.get(J),le=void 0;;){ee=U.transforms.get(ee.parent);var ye=H.get(ee.ref);if(ye.obj&&X(ye)&&(le=ye,Q)||ee.ref===cr.RootRef)return le}}function D(U,H,J,X){return O(U,H,J,X,!0)}e.findAncestor=D;function F(U,H,J,X){return O(U,H,J,X,!1)}e.findRoot=F;function G(U,H,J,X){return D(U,H,J,Array.isArray(X)?function(Q){return X.indexOf(Q.transform.transformer)>=0}:function(Q){return Q.transform.transformer===X})}e.findAncestorWithTransformer=G;function N(U,H,J,X){return D(U,H,J,$(X))}e.findAncestorOfType=N;function z(U,H,J,X){return F(U,H,J,$(X))}e.findRootOfType=z;function $(U){return Array.isArray(U)?function(H){for(var J=0,X=U;J<X.length;J++){var Q=X[J];if(Q.type===H.obj.type)return!0}}:function(H){return H.obj.type===U.type}}function j(U,H,J){return Hn.doPreOrder(U,U.transforms.get(H),{refs:{},tags:J},Z).refs}e.findUniqueTagsInSubtree=j;function Z(U,H,J){if(U.tags)for(var X=0,Q=U.tags;X<Q.length;X++){var ee=Q[X];if(!!J.tags.has(ee)){J.refs[ee]=U.ref;break}}return!0}function q(U,H,J){return Hn.doPreOrder(U,U.transforms.get(H),{ref:void 0,tag:J},te).ref}e.findTagInSubtree=q;function te(U,H,J){return U.tags&&U.tags.indexOf(J.tag)>=0?(J.ref=U.ref,!1):!0}function he(U,H,J){return Hn.doPreOrder(U,U.transforms.get(H),{refs:[],tags:J},W).refs}e.findWithAllTags=he;function W(U,H,J){if(U.tags)for(var X=J.tags.size,Q=0,ee=0,le=U.tags;ee<le.length;ee++){var ye=le[ee];if(!!J.tags.has(ye)&&(Q++,Q===X)){J.refs.push(U);break}}else J.tags.size===0&&J.refs.push(U)}function K(U,H,J){var X=U.transforms.get(H);if(X.transformer===J)return U.cells.get(H);var Q=U.tree.children.get(H);if(Q.size===1){var ee=Q.first();if(U.transforms.get(ee).transformer.definition.isDecorator)return K(U,ee,J)}}e.tryFindDecorator=K})(ar||(ar={}));/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var fx=function(e,t){return fx=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)n.hasOwnProperty(a)&&(r[a]=n[a])},fx(e,t)};function La(e,t){fx(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}function px(e){return typeof e=="function"}var iP=!1,jo={Promise:void 0,set useDeprecatedSynchronousErrorHandling(e){if(e){var t=new Error;""+t.stack}iP=e},get useDeprecatedSynchronousErrorHandling(){return iP}};function jf(e){setTimeout(function(){throw e},0)}var ig={closed:!0,next:function(e){},error:function(e){if(jo.useDeprecatedSynchronousErrorHandling)throw e;jf(e)},complete:function(){}},kX=function(){return Array.isArray||function(e){return e&&typeof e.length=="number"}}();function HR(e){return e!==null&&typeof e=="object"}var BX=function(){function e(t){return Error.call(this),this.message=t?t.length+` errors occurred during unsubscription:
`+t.map(function(r,n){return n+1+") "+r.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=t,this}return e.prototype=Object.create(Error.prototype),e}(),P0=BX,qs=function(){function e(t){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,t&&(this._ctorUnsubscribe=!0,this._unsubscribe=t)}return e.prototype.unsubscribe=function(){var t;if(!this.closed){var r=this,n=r._parentOrParents,a=r._ctorUnsubscribe,i=r._unsubscribe,o=r._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,n instanceof e)n.remove(this);else if(n!==null)for(var s=0;s<n.length;++s){var u=n[s];u.remove(this)}if(px(i)){a&&(this._unsubscribe=void 0);try{i.call(this)}catch(d){t=d instanceof P0?oP(d.errors):[d]}}if(kX(o))for(var s=-1,l=o.length;++s<l;){var c=o[s];if(HR(c))try{c.unsubscribe()}catch(f){t=t||[],f instanceof P0?t=t.concat(oP(f.errors)):t.push(f)}}if(t)throw new P0(t)}},e.prototype.add=function(t){var r=t;if(!t)return e.EMPTY;switch(typeof t){case"function":r=new e(t);case"object":if(r===this||r.closed||typeof r.unsubscribe!="function")return r;if(this.closed)return r.unsubscribe(),r;if(!(r instanceof e)){var n=r;r=new e,r._subscriptions=[n]}break;default:throw new Error("unrecognized teardown "+t+" added to Subscription.")}var a=r._parentOrParents;if(a===null)r._parentOrParents=this;else if(a instanceof e){if(a===this)return r;r._parentOrParents=[a,this]}else if(a.indexOf(this)===-1)a.push(this);else return r;var i=this._subscriptions;return i===null?this._subscriptions=[r]:i.push(r),r},e.prototype.remove=function(t){var r=this._subscriptions;if(r){var n=r.indexOf(t);n!==-1&&r.splice(n,1)}},e.EMPTY=function(t){return t.closed=!0,t}(new e),e}();function oP(e){return e.reduce(function(t,r){return t.concat(r instanceof P0?r.errors:r)},[])}var og=function(){return typeof Symbol=="function"?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random()}(),wo=function(e){La(t,e);function t(r,n,a){var i=e.call(this)||this;switch(i.syncErrorValue=null,i.syncErrorThrown=!1,i.syncErrorThrowable=!1,i.isStopped=!1,arguments.length){case 0:i.destination=ig;break;case 1:if(!r){i.destination=ig;break}if(typeof r=="object"){r instanceof t?(i.syncErrorThrowable=r.syncErrorThrowable,i.destination=r,r.add(i)):(i.syncErrorThrowable=!0,i.destination=new sP(i,r));break}default:i.syncErrorThrowable=!0,i.destination=new sP(i,r,n,a);break}return i}return t.prototype[og]=function(){return this},t.create=function(r,n,a){var i=new t(r,n,a);return i.syncErrorThrowable=!1,i},t.prototype.next=function(r){this.isStopped||this._next(r)},t.prototype.error=function(r){this.isStopped||(this.isStopped=!0,this._error(r))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this))},t.prototype._next=function(r){this.destination.next(r)},t.prototype._error=function(r){this.destination.error(r),this.unsubscribe()},t.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},t.prototype._unsubscribeAndRecycle=function(){var r=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=r,this},t}(qs),sP=function(e){La(t,e);function t(r,n,a,i){var o=e.call(this)||this;o._parentSubscriber=r;var s,u=o;return px(n)?s=n:n&&(s=n.next,a=n.error,i=n.complete,n!==ig&&(u=Object.create(n),px(u.unsubscribe)&&o.add(u.unsubscribe.bind(u)),u.unsubscribe=o.unsubscribe.bind(o))),o._context=u,o._next=s,o._error=a,o._complete=i,o}return t.prototype.next=function(r){if(!this.isStopped&&this._next){var n=this._parentSubscriber;!jo.useDeprecatedSynchronousErrorHandling||!n.syncErrorThrowable?this.__tryOrUnsub(this._next,r):this.__tryOrSetError(n,this._next,r)&&this.unsubscribe()}},t.prototype.error=function(r){if(!this.isStopped){var n=this._parentSubscriber,a=jo.useDeprecatedSynchronousErrorHandling;if(this._error)!a||!n.syncErrorThrowable?(this.__tryOrUnsub(this._error,r),this.unsubscribe()):(this.__tryOrSetError(n,this._error,r),this.unsubscribe());else if(n.syncErrorThrowable)a?(n.syncErrorValue=r,n.syncErrorThrown=!0):jf(r),this.unsubscribe();else{if(this.unsubscribe(),a)throw r;jf(r)}}},t.prototype.complete=function(){var r=this;if(!this.isStopped){var n=this._parentSubscriber;if(this._complete){var a=function(){return r._complete.call(r._context)};!jo.useDeprecatedSynchronousErrorHandling||!n.syncErrorThrowable?(this.__tryOrUnsub(a),this.unsubscribe()):(this.__tryOrSetError(n,a),this.unsubscribe())}else this.unsubscribe()}},t.prototype.__tryOrUnsub=function(r,n){try{r.call(this._context,n)}catch(a){if(this.unsubscribe(),jo.useDeprecatedSynchronousErrorHandling)throw a;jf(a)}},t.prototype.__tryOrSetError=function(r,n,a){if(!jo.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{n.call(this._context,a)}catch(i){return jo.useDeprecatedSynchronousErrorHandling?(r.syncErrorValue=i,r.syncErrorThrown=!0,!0):(jf(i),!0)}return!1},t.prototype._unsubscribe=function(){var r=this._parentSubscriber;this._context=null,this._parentSubscriber=null,r.unsubscribe()},t}(wo);function LX(e){for(;e;){var t=e,r=t.closed,n=t.destination,a=t.isStopped;if(r||a)return!1;n&&n instanceof wo?e=n:e=null}return!0}function NX(e,t,r){if(e){if(e instanceof wo)return e;if(e[og])return e[og]()}return!e&&!t&&!r?new wo(ig):new wo(e,t,r)}var Iv=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function GR(e){return e}function UX(e){return e.length===0?GR:e.length===1?e[0]:function(r){return e.reduce(function(n,a){return a(n)},r)}}var Xi=function(){function e(t){this._isScalar=!1,t&&(this._subscribe=t)}return e.prototype.lift=function(t){var r=new e;return r.source=this,r.operator=t,r},e.prototype.subscribe=function(t,r,n){var a=this.operator,i=NX(t,r,n);if(a?i.add(a.call(i,this.source)):i.add(this.source||jo.useDeprecatedSynchronousErrorHandling&&!i.syncErrorThrowable?this._subscribe(i):this._trySubscribe(i)),jo.useDeprecatedSynchronousErrorHandling&&i.syncErrorThrowable&&(i.syncErrorThrowable=!1,i.syncErrorThrown))throw i.syncErrorValue;return i},e.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(r){jo.useDeprecatedSynchronousErrorHandling&&(t.syncErrorThrown=!0,t.syncErrorValue=r),LX(t)?t.error(r):console.warn(r)}},e.prototype.forEach=function(t,r){var n=this;return r=uP(r),new r(function(a,i){var o;o=n.subscribe(function(s){try{t(s)}catch(u){i(u),o&&o.unsubscribe()}},i,a)})},e.prototype._subscribe=function(t){var r=this.source;return r&&r.subscribe(t)},e.prototype[Iv]=function(){return this},e.prototype.pipe=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return t.length===0?this:UX(t)(this)},e.prototype.toPromise=function(t){var r=this;return t=uP(t),new t(function(n,a){var i;r.subscribe(function(o){return i=o},function(o){return a(o)},function(){return n(i)})})},e.create=function(t){return new e(t)},e}();function uP(e){if(e||(e=jo.Promise||Promise),!e)throw new Error("no Promise impl found");return e}var zX=function(){function e(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return e.prototype=Object.create(Error.prototype),e}(),zf=zX,VX=function(e){La(t,e);function t(r,n){var a=e.call(this)||this;return a.subject=r,a.subscriber=n,a.closed=!1,a}return t.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var r=this.subject,n=r.observers;if(this.subject=null,!(!n||n.length===0||r.isStopped||r.closed)){var a=n.indexOf(this.subscriber);a!==-1&&n.splice(a,1)}}},t}(qs),HX=function(e){La(t,e);function t(r){var n=e.call(this,r)||this;return n.destination=r,n}return t}(wo),Ln=function(e){La(t,e);function t(){var r=e.call(this)||this;return r.observers=[],r.closed=!1,r.isStopped=!1,r.hasError=!1,r.thrownError=null,r}return t.prototype[og]=function(){return new HX(this)},t.prototype.lift=function(r){var n=new lP(this,this);return n.operator=r,n},t.prototype.next=function(r){if(this.closed)throw new zf;if(!this.isStopped)for(var n=this.observers,a=n.length,i=n.slice(),o=0;o<a;o++)i[o].next(r)},t.prototype.error=function(r){if(this.closed)throw new zf;this.hasError=!0,this.thrownError=r,this.isStopped=!0;for(var n=this.observers,a=n.length,i=n.slice(),o=0;o<a;o++)i[o].error(r);this.observers.length=0},t.prototype.complete=function(){if(this.closed)throw new zf;this.isStopped=!0;for(var r=this.observers,n=r.length,a=r.slice(),i=0;i<n;i++)a[i].complete();this.observers.length=0},t.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},t.prototype._trySubscribe=function(r){if(this.closed)throw new zf;return e.prototype._trySubscribe.call(this,r)},t.prototype._subscribe=function(r){if(this.closed)throw new zf;return this.hasError?(r.error(this.thrownError),qs.EMPTY):this.isStopped?(r.complete(),qs.EMPTY):(this.observers.push(r),new VX(this,r))},t.prototype.asObservable=function(){var r=new Xi;return r.source=this,r},t.create=function(r,n){return new lP(r,n)},t}(Xi),lP=function(e){La(t,e);function t(r,n){var a=e.call(this)||this;return a.destination=r,a.source=n,a}return t.prototype.next=function(r){var n=this.destination;n&&n.next&&n.next(r)},t.prototype.error=function(r){var n=this.destination;n&&n.error&&this.destination.error(r)},t.prototype.complete=function(){var r=this.destination;r&&r.complete&&this.destination.complete()},t.prototype._subscribe=function(r){var n=this.source;return n?this.source.subscribe(r):qs.EMPTY},t}(Ln),tc=function(e){La(t,e);function t(r){var n=e.call(this)||this;return n._value=r,n}return Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),t.prototype._subscribe=function(r){var n=e.prototype._subscribe.call(this,r);return n&&!n.closed&&r.next(this._value),n},t.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new zf;return this._value},t.prototype.next=function(r){e.prototype.next.call(this,this._value=r)},t}(Ln),GX=function(e){La(t,e);function t(r,n){return e.call(this)||this}return t.prototype.schedule=function(r,n){return this},t}(qs),qX=function(e){La(t,e);function t(r,n){var a=e.call(this,r,n)||this;return a.scheduler=r,a.work=n,a.pending=!1,a}return t.prototype.schedule=function(r,n){if(n===void 0&&(n=0),this.closed)return this;this.state=r;var a=this.id,i=this.scheduler;return a!=null&&(this.id=this.recycleAsyncId(i,a,n)),this.pending=!0,this.delay=n,this.id=this.id||this.requestAsyncId(i,this.id,n),this},t.prototype.requestAsyncId=function(r,n,a){return a===void 0&&(a=0),setInterval(r.flush.bind(r,this),a)},t.prototype.recycleAsyncId=function(r,n,a){if(a===void 0&&(a=0),a!==null&&this.delay===a&&this.pending===!1)return n;clearInterval(n)},t.prototype.execute=function(r,n){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var a=this._execute(r,n);if(a)return a;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(r,n){var a=!1,i=void 0;try{this.work(r)}catch(o){a=!0,i=!!o&&o||new Error(o)}if(a)return this.unsubscribe(),i},t.prototype._unsubscribe=function(){var r=this.id,n=this.scheduler,a=n.actions,i=a.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,i!==-1&&a.splice(i,1),r!=null&&(this.id=this.recycleAsyncId(n,r,null)),this.delay=null},t}(GX),cP=function(){function e(t,r){r===void 0&&(r=e.now),this.SchedulerAction=t,this.now=r}return e.prototype.schedule=function(t,r,n){return r===void 0&&(r=0),new this.SchedulerAction(this,t).schedule(n,r)},e.now=function(){return Date.now()},e}(),jX=function(e){La(t,e);function t(r,n){n===void 0&&(n=cP.now);var a=e.call(this,r,function(){return t.delegate&&t.delegate!==a?t.delegate.now():n()})||this;return a.actions=[],a.active=!1,a.scheduled=void 0,a}return t.prototype.schedule=function(r,n,a){return n===void 0&&(n=0),t.delegate&&t.delegate!==this?t.delegate.schedule(r,n,a):e.prototype.schedule.call(this,r,n,a)},t.prototype.flush=function(r){var n=this.actions;if(this.active){n.push(r);return}var a;this.active=!0;do if(a=r.execute(r.state,r.delay))break;while(r=n.shift());if(this.active=!1,a){for(;r=n.shift();)r.unsubscribe();throw a}},t}(cP),WX=new Xi(function(e){return e.complete()});function XX(e){return e?YX(e):WX}function YX(e){return new Xi(function(t){return e.schedule(function(){return t.complete()})})}function KX(e){return e&&typeof e.schedule=="function"}var qR=function(e){return function(t){for(var r=0,n=e.length;r<n&&!t.closed;r++)t.next(e[r]);t.complete()}};function jR(e,t){return new Xi(function(r){var n=new qs,a=0;return n.add(t.schedule(function(){if(a===e.length){r.complete();return}r.next(e[a++]),r.closed||n.add(this.schedule())})),n})}function $X(e,t){return t?jR(e,t):new Xi(qR(e))}var QX=new jX(qX),ZX=QX,JX=function(){function e(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return e.prototype=Object.create(Error.prototype),e}(),eY=JX;function tY(e,t){return function(n){if(typeof e!="function")throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return n.lift(new rY(e,t))}}var rY=function(){function e(t,r){this.project=t,this.thisArg=r}return e.prototype.call=function(t,r){return r.subscribe(new nY(t,this.project,this.thisArg))},e}(),nY=function(e){La(t,e);function t(r,n,a){var i=e.call(this,r)||this;return i.project=n,i.count=0,i.thisArg=a||i,i}return t.prototype._next=function(r){var n;try{n=this.project.call(this.thisArg,r,this.count++)}catch(a){this.destination.error(a);return}this.destination.next(n)},t}(wo),aY=function(e){return function(t){return e.then(function(r){t.closed||(t.next(r),t.complete())},function(r){return t.error(r)}).then(null,jf),t}};function iY(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var By=iY(),oY=function(e){return function(t){var r=e[By]();do{var n=void 0;try{n=r.next()}catch(a){return t.error(a),t}if(n.done){t.complete();break}if(t.next(n.value),t.closed)break}while(!0);return typeof r.return=="function"&&t.add(function(){r.return&&r.return()}),t}},sY=function(e){return function(t){var r=e[Iv]();if(typeof r.subscribe!="function")throw new TypeError("Provided object does not correctly implement Symbol.observable");return r.subscribe(t)}},WR=function(e){return e&&typeof e.length=="number"&&typeof e!="function"};function XR(e){return!!e&&typeof e.subscribe!="function"&&typeof e.then=="function"}var YR=function(e){if(!!e&&typeof e[Iv]=="function")return sY(e);if(WR(e))return qR(e);if(XR(e))return aY(e);if(!!e&&typeof e[By]=="function")return oY(e);var t=HR(e)?"an invalid object":"'"+e+"'",r="You provided "+t+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.";throw new TypeError(r)};function uY(e,t){return new Xi(function(r){var n=new qs;return n.add(t.schedule(function(){var a=e[Iv]();n.add(a.subscribe({next:function(i){n.add(t.schedule(function(){return r.next(i)}))},error:function(i){n.add(t.schedule(function(){return r.error(i)}))},complete:function(){n.add(t.schedule(function(){return r.complete()}))}}))})),n})}function lY(e,t){return new Xi(function(r){var n=new qs;return n.add(t.schedule(function(){return e.then(function(a){n.add(t.schedule(function(){r.next(a),n.add(t.schedule(function(){return r.complete()}))}))},function(a){n.add(t.schedule(function(){return r.error(a)}))})})),n})}function cY(e,t){if(!e)throw new Error("Iterable cannot be null");return new Xi(function(r){var n=new qs,a;return n.add(function(){a&&typeof a.return=="function"&&a.return()}),n.add(t.schedule(function(){a=e[By](),n.add(t.schedule(function(){if(!r.closed){var i,o;try{var s=a.next();i=s.value,o=s.done}catch(u){r.error(u);return}o?r.complete():(r.next(i),this.schedule())}}))})),n})}function dY(e){return e&&typeof e[Iv]=="function"}function fY(e){return e&&typeof e[By]=="function"}function pY(e,t){if(e!=null){if(dY(e))return uY(e,t);if(XR(e))return lY(e,t);if(WR(e))return jR(e,t);if(fY(e)||typeof e=="string")return cY(e,t)}throw new TypeError((e!==null&&typeof e||e)+" is not observable")}function hY(e,t){return t?pY(e,t):e instanceof Xi?e:new Xi(YR(e))}var vY=function(e){La(t,e);function t(r){var n=e.call(this)||this;return n.parent=r,n}return t.prototype._next=function(r){this.parent.notifyNext(r)},t.prototype._error=function(r){this.parent.notifyError(r),this.unsubscribe()},t.prototype._complete=function(){this.parent.notifyComplete(),this.unsubscribe()},t}(wo),mY=function(e){La(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.notifyNext=function(r){this.destination.next(r)},t.prototype.notifyError=function(r){this.destination.error(r)},t.prototype.notifyComplete=function(){this.destination.complete()},t}(wo);function gY(e,t){if(!t.closed){if(e instanceof Xi)return e.subscribe(t);var r;try{r=YR(e)(t)}catch(n){t.error(n)}return r}}function KR(e,t,r){return r===void 0&&(r=Number.POSITIVE_INFINITY),typeof t=="function"?function(n){return n.pipe(KR(function(a,i){return hY(e(a,i)).pipe(tY(function(o,s){return t(a,o,i,s)}))},r))}:(typeof t=="number"&&(r=t),function(n){return n.lift(new yY(e,r))})}var yY=function(){function e(t,r){r===void 0&&(r=Number.POSITIVE_INFINITY),this.project=t,this.concurrent=r}return e.prototype.call=function(t,r){return r.subscribe(new bY(t,this.project,this.concurrent))},e}(),bY=function(e){La(t,e);function t(r,n,a){a===void 0&&(a=Number.POSITIVE_INFINITY);var i=e.call(this,r)||this;return i.project=n,i.concurrent=a,i.hasCompleted=!1,i.buffer=[],i.active=0,i.index=0,i}return t.prototype._next=function(r){this.active<this.concurrent?this._tryNext(r):this.buffer.push(r)},t.prototype._tryNext=function(r){var n,a=this.index++;try{n=this.project(r,a)}catch(i){this.destination.error(i);return}this.active++,this._innerSub(n)},t.prototype._innerSub=function(r){var n=new vY(this),a=this.destination;a.add(n);var i=gY(r,n);i!==n&&a.add(i)},t.prototype._complete=function(){this.hasCompleted=!0,this.active===0&&this.buffer.length===0&&this.destination.complete(),this.unsubscribe()},t.prototype.notifyNext=function(r){this.destination.next(r)},t.prototype.notifyComplete=function(){var r=this.buffer;this.active--,r.length>0?this._next(r.shift()):this.active===0&&this.hasCompleted&&this.destination.complete()},t}(mY);function SY(e){return e===void 0&&(e=Number.POSITIVE_INFINITY),KR(GR,e)}function xu(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=Number.POSITIVE_INFINITY,n=null,a=e[e.length-1];return KX(a)?(n=e.pop(),e.length>1&&typeof e[e.length-1]=="number"&&(r=e.pop())):typeof a=="number"&&(r=e.pop()),n===null&&e.length===1&&e[0]instanceof Xi?e[0]:SY(r)($X(e,n))}function Ly(e,t){return function(n){return n.lift(new xY(e,t))}}var xY=function(){function e(t,r){this.predicate=t,this.thisArg=r}return e.prototype.call=function(t,r){return r.subscribe(new CY(t,this.predicate,this.thisArg))},e}(),CY=function(e){La(t,e);function t(r,n,a){var i=e.call(this,r)||this;return i.predicate=n,i.thisArg=a,i.count=0,i}return t.prototype._next=function(r){var n;try{n=this.predicate.call(this.thisArg,r,this.count++)}catch(a){this.destination.error(a);return}n&&this.destination.next(r)},t}(wo),zu;(function(e){function t(){var r=new _Y,n=function(){return r.create()};return n.dispose=function(){return r.dispose()},n.behavior=function(a){return r.behavior(a)},n}e.create=t})(zu||(zu={}));var _Y=function(){function e(){this._eventList=[],this._disposed=!1}return e.prototype.create=function(){var t=new Ln;return this._eventList.push(t),t},e.prototype.behavior=function(t){var r=new tc(t);return this._eventList.push(r),r},e.prototype.dispose=function(){if(!this._disposed){for(var t=0,r=this._eventList;t<r.length;t++){var n=r[t];n.complete()}this._disposed=!0}},e}();function Ko(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];throw Error("[Immer] minified error nr: "+e+(r.length?" "+r.map(function(a){return"'"+a+"'"}).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function fp(e){return!!e&&!!e[Yi]}function Md(e){return!!e&&(function(t){if(!t||typeof t!="object")return!1;var r=Object.getPrototypeOf(t);if(r===null)return!0;var n=Object.hasOwnProperty.call(r,"constructor")&&r.constructor;return typeof n=="function"&&Function.toString.call(n)===DY}(e)||Array.isArray(e)||!!e[yP]||!!e.constructor[yP]||N_(e)||U_(e))}function lv(e,t,r){r===void 0&&(r=!1),Tp(e)===0?(r?Object.keys:q_)(e).forEach(function(n){r&&typeof n=="symbol"||t(n,e[n],e)}):e.forEach(function(n,a){return t(a,n,e)})}function Tp(e){var t=e[Yi];return t?t.i>3?t.i-4:t.i:Array.isArray(e)?1:N_(e)?2:U_(e)?3:0}function hx(e,t){return Tp(e)===2?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function wY(e,t){return Tp(e)===2?e.get(t):e[t]}function $R(e,t,r){var n=Tp(e);n===2?e.set(t,r):n===3?(e.delete(t),e.add(r)):e[t]=r}function AY(e,t){return e===t?e!==0||1/e==1/t:e!=e&&t!=t}function N_(e){return IY&&e instanceof Map}function U_(e){return MY&&e instanceof Set}function rd(e){return e.o||e.t}function z_(e){if(Array.isArray(e))return Array.prototype.slice.call(e);var t=RY(e);delete t[Yi];for(var r=q_(t),n=0;n<r.length;n++){var a=r[n],i=t[a];i.writable===!1&&(i.writable=!0,i.configurable=!0),(i.get||i.set)&&(t[a]={configurable:!0,writable:!0,enumerable:i.enumerable,value:e[a]})}return Object.create(Object.getPrototypeOf(e),t)}function V_(e,t){return t===void 0&&(t=!1),H_(e)||fp(e)||!Md(e)||(Tp(e)>1&&(e.set=e.add=e.clear=e.delete=PY),Object.freeze(e),t&&lv(e,function(r,n){return V_(n,!0)},!0)),e}function PY(){Ko(2)}function H_(e){return e==null||typeof e!="object"||Object.isFrozen(e)}function Ru(e){var t=OY[e];return t||Ko(18,e),t}function dP(){return cv}function Eb(e,t){t&&(Ru("Patches"),e.u=[],e.s=[],e.v=t)}function sg(e){vx(e),e.p.forEach(TY),e.p=null}function vx(e){e===cv&&(cv=e.l)}function fP(e){return cv={p:[],l:cv,h:e,m:!0,_:0}}function TY(e){var t=e[Yi];t.i===0||t.i===1?t.j():t.g=!0}function Ib(e,t){t._=t.p.length;var r=t.p[0],n=e!==void 0&&e!==r;return t.h.O||Ru("ES5").S(t,e,n),n?(r[Yi].P&&(sg(t),Ko(4)),Md(e)&&(e=ug(t,e),t.l||lg(t,e)),t.u&&Ru("Patches").M(r[Yi],e,t.u,t.s)):e=ug(t,r,[]),sg(t),t.u&&t.v(t.u,t.s),e!==QR?e:void 0}function ug(e,t,r){if(H_(t))return t;var n=t[Yi];if(!n)return lv(t,function(i,o){return pP(e,n,t,i,o,r)},!0),t;if(n.A!==e)return t;if(!n.P)return lg(e,n.t,!0),n.t;if(!n.I){n.I=!0,n.A._--;var a=n.i===4||n.i===5?n.o=z_(n.k):n.o;lv(n.i===3?new Set(a):a,function(i,o){return pP(e,n,a,i,o,r)}),lg(e,a,!1),r&&e.u&&Ru("Patches").R(n,r,e.u,e.s)}return n.o}function pP(e,t,r,n,a,i){if(fp(a)){var o=ug(e,a,i&&t&&t.i!==3&&!hx(t.D,n)?i.concat(n):void 0);if($R(r,n,o),!fp(o))return;e.m=!1}if(Md(a)&&!H_(a)){if(!e.h.F&&e._<1)return;ug(e,a),t&&t.A.l||lg(e,a)}}function lg(e,t,r){r===void 0&&(r=!1),e.h.F&&e.m&&V_(t,r)}function Mb(e,t){var r=e[Yi];return(r?rd(r):e)[t]}function hP(e,t){if(t in e)for(var r=Object.getPrototypeOf(e);r;){var n=Object.getOwnPropertyDescriptor(r,t);if(n)return n;r=Object.getPrototypeOf(r)}}function mx(e){e.P||(e.P=!0,e.l&&mx(e.l))}function Db(e){e.o||(e.o=z_(e.t))}function gx(e,t,r){var n=N_(t)?Ru("MapSet").N(t,r):U_(t)?Ru("MapSet").T(t,r):e.O?function(a,i){var o=Array.isArray(a),s={i:o?1:0,A:i?i.A:dP(),P:!1,I:!1,D:{},l:i,t:a,k:null,o:null,j:null,C:!1},u=s,l=T0;o&&(u=[s],l=E0);var c=Proxy.revocable(u,l),d=c.revoke,f=c.proxy;return s.k=f,s.j=d,f}(t,r):Ru("ES5").J(t,r);return(r?r.A:dP()).p.push(n),n}function EY(e){return fp(e)||Ko(22,e),function t(r){if(!Md(r))return r;var n,a=r[Yi],i=Tp(r);if(a){if(!a.P&&(a.i<4||!Ru("ES5").K(a)))return a.t;a.I=!0,n=vP(r,i),a.I=!1}else n=vP(r,i);return lv(n,function(o,s){a&&wY(a.t,o)===s||$R(n,o,t(s))}),i===3?new Set(n):n}(e)}function vP(e,t){switch(t){case 2:return new Map(e);case 3:return Array.from(e)}return z_(e)}var mP,cv,G_=typeof Symbol!="undefined"&&typeof Symbol("x")=="symbol",IY=typeof Map!="undefined",MY=typeof Set!="undefined",gP=typeof Proxy!="undefined"&&Proxy.revocable!==void 0&&typeof Reflect!="undefined",QR=G_?Symbol.for("immer-nothing"):((mP={})["immer-nothing"]=!0,mP),yP=G_?Symbol.for("immer-draftable"):"__$immer_draftable",Yi=G_?Symbol.for("immer-state"):"__$immer_state",DY=""+Object.prototype.constructor,q_=typeof Reflect!="undefined"&&Reflect.ownKeys?Reflect.ownKeys:Object.getOwnPropertySymbols!==void 0?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Object.getOwnPropertyNames,RY=Object.getOwnPropertyDescriptors||function(e){var t={};return q_(e).forEach(function(r){t[r]=Object.getOwnPropertyDescriptor(e,r)}),t},OY={},T0={get:function(e,t){if(t===Yi)return e;var r=rd(e);if(!hx(r,t))return function(a,i,o){var s,u=hP(i,o);return u?"value"in u?u.value:(s=u.get)===null||s===void 0?void 0:s.call(a.k):void 0}(e,r,t);var n=r[t];return e.I||!Md(n)?n:n===Mb(e.t,t)?(Db(e),e.o[t]=gx(e.A.h,n,e)):n},has:function(e,t){return t in rd(e)},ownKeys:function(e){return Reflect.ownKeys(rd(e))},set:function(e,t,r){var n=hP(rd(e),t);if(n!=null&&n.set)return n.set.call(e.k,r),!0;if(!e.P){var a=Mb(rd(e),t),i=a==null?void 0:a[Yi];if(i&&i.t===r)return e.o[t]=r,e.D[t]=!1,!0;if(AY(r,a)&&(r!==void 0||hx(e.t,t)))return!0;Db(e),mx(e)}return e.o[t]===r&&typeof r!="number"||(e.o[t]=r,e.D[t]=!0,!0)},deleteProperty:function(e,t){return Mb(e.t,t)!==void 0||t in e.t?(e.D[t]=!1,Db(e),mx(e)):delete e.D[t],e.o&&delete e.o[t],!0},getOwnPropertyDescriptor:function(e,t){var r=rd(e),n=Reflect.getOwnPropertyDescriptor(r,t);return n&&{writable:!0,configurable:e.i!==1||t!=="length",enumerable:n.enumerable,value:r[t]}},defineProperty:function(){Ko(11)},getPrototypeOf:function(e){return Object.getPrototypeOf(e.t)},setPrototypeOf:function(){Ko(12)}},E0={};lv(T0,function(e,t){E0[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}}),E0.deleteProperty=function(e,t){return T0.deleteProperty.call(this,e[0],t)},E0.set=function(e,t,r){return T0.set.call(this,e[0],t,r,e[0])};var FY=function(){function e(r){var n=this;this.O=gP,this.F=!0,this.produce=function(a,i,o){if(typeof a=="function"&&typeof i!="function"){var s=i;i=a;var u=n;return function(p){var h=this;p===void 0&&(p=s);for(var v=arguments.length,m=Array(v>1?v-1:0),g=1;g<v;g++)m[g-1]=arguments[g];return u.produce(p,function(y){var b;return(b=i).call.apply(b,[h,y].concat(m))})}}var l;if(typeof i!="function"&&Ko(6),o!==void 0&&typeof o!="function"&&Ko(7),Md(a)){var c=fP(n),d=gx(n,a,void 0),f=!0;try{l=i(d),f=!1}finally{f?sg(c):vx(c)}return typeof Promise!="undefined"&&l instanceof Promise?l.then(function(p){return Eb(c,o),Ib(p,c)},function(p){throw sg(c),p}):(Eb(c,o),Ib(l,c))}if(!a||typeof a!="object")return(l=i(a))===QR?void 0:(l===void 0&&(l=a),n.F&&V_(l,!0),l);Ko(21,a)},this.produceWithPatches=function(a,i){return typeof a=="function"?function(u){for(var l=arguments.length,c=Array(l>1?l-1:0),d=1;d<l;d++)c[d-1]=arguments[d];return n.produceWithPatches(u,function(f){return a.apply(void 0,[f].concat(c))})}:[n.produce(a,i,function(u,l){o=u,s=l}),o,s];var o,s},typeof(r==null?void 0:r.useProxies)=="boolean"&&this.setUseProxies(r.useProxies),typeof(r==null?void 0:r.autoFreeze)=="boolean"&&this.setAutoFreeze(r.autoFreeze)}var t=e.prototype;return t.createDraft=function(r){Md(r)||Ko(8),fp(r)&&(r=EY(r));var n=fP(this),a=gx(this,r,void 0);return a[Yi].C=!0,vx(n),a},t.finishDraft=function(r,n){var a=r&&r[Yi],i=a.A;return Eb(i,n),Ib(void 0,i)},t.setAutoFreeze=function(r){this.F=r},t.setUseProxies=function(r){r&&!gP&&Ko(20),this.O=r},t.applyPatches=function(r,n){var a;for(a=n.length-1;a>=0;a--){var i=n[a];if(i.path.length===0&&i.op==="replace"){r=i.value;break}}var o=Ru("Patches").$;return fp(r)?o(r,n):this.produce(r,function(s){return o(s,n.slice(a+1))})},e}(),Ki=new FY,Vu=Ki.produce;Ki.produceWithPatches.bind(Ki);var kY=Ki.setAutoFreeze.bind(Ki);Ki.setUseProxies.bind(Ki);Ki.applyPatches.bind(Ki);Ki.createDraft.bind(Ki);Ki.finishDraft.bind(Ki);var sd;(function(e){function t(o){if(!o.state||o.state.tree===o.editInfo.sourceTree)return o.tree.asImmutable();for(var s=o.state.tree.asTransient(),u=0,l=o.actions;u<l.length;u++){var c=l[u];switch(c.kind){case"add":s.add(c.transform);break;case"update":s.setParams(c.ref,c.params);break;case"delete":s.remove(c.ref);break;case"insert":{var d=s.children.get(c.ref).toArray();s.add(c.transform);for(var f=0,p=d;f<p.length;f++){var h=p[f];s.changeParent(h,c.transform.ref)}break}}}return o.editInfo.sourceTree=o.tree,s.asImmutable()}function r(o){return!!o&&typeof o.getTree=="function"}e.is=r;function n(o){return!!o&&typeof o.getTree=="function"&&typeof o.ref=="string"}e.isTo=n;var a=function(){function o(s,u){this.state={state:u,tree:s.asTransient(),actions:[],editInfo:{applied:!1,sourceTree:s,count:0,lastUpdate:void 0}}}return Object.defineProperty(o.prototype,"editInfo",{get:function(){return this.state.editInfo},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"currentTree",{get:function(){return this.state.tree},enumerable:!1,configurable:!0}),o.prototype.to=function(s){var u=typeof s=="string"?s:ov.is(s)?s.transform.ref:s.ref;return new i(this.state,u,this)},o.prototype.toRoot=function(){return new i(this.state,this.state.tree.root.ref,this)},o.prototype.delete=function(s){var u=ua.resolveRef(s);return!u||!this.state.tree.transforms.has(u)?this:(this.editInfo.count++,this.state.tree.remove(u),this.state.actions.push({kind:"delete",ref:u}),this)},o.prototype.getTree=function(){return t(this.state)},o.prototype.commit=function(s){if(!this.state.state)throw new Error("Cannot commit template tree");return this.state.state.runTask(this.state.state.updateTree(this,s))},o}();e.Root=a;var i=function(){function o(s,u,l){if(this.state=s,this.root=l,this.ref=u,!this.state.tree.transforms.has(u))throw new Error("Could not find node '"+u+"'.")}return Object.defineProperty(o.prototype,"editInfo",{get:function(){return this.state.editInfo},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"selector",{get:function(){return new wR(this.ref,this.state.state)},enumerable:!1,configurable:!0}),o.prototype.getApplyRoot=function(){return Hn.getDecoratorRoot(this.state.tree,this.ref)},o.prototype.apply=function(s,u,l){if(s.definition.isDecorator)return this.insert(s,u,l);var c=this.getApplyRoot(),d=s.apply(c,u,l);return this.state.tree.add(d),this.editInfo.count++,this.editInfo.lastUpdate=d.ref,this.state.actions.push({kind:"add",transform:d}),new o(this.state,d.ref,this.root)},o.prototype.applyOrUpdate=function(s,u,l,c){if(this.state.tree.transforms.has(s)){var d=this.to(s);return l&&d.update(l),d}else return this.apply(u,l,w(w({},c),{ref:s}))},o.prototype.applyOrUpdateTagged=function(s,u,l,c){if(u.definition.isDecorator)throw new Error("Can't use applyOrUpdateTagged on decorator transformers.");for(var d=this.getApplyRoot(),f=this.state.tree.children.get(d).values();;){var p=f.next();if(p.done)break;var h=this.state.tree.transforms.get(p.value);if(h&&cr.hasTags(h,s)){var v=this.to(p.value);return v.updateTagged(l,bP(h.tags,s,c&&c.tags)),v}}var m=u.apply(d,l,w(w({},c),{tags:bP(s,c&&c.tags)}));return this.state.tree.add(m),this.editInfo.count++,this.editInfo.lastUpdate=m.ref,this.state.actions.push({kind:"add",transform:m}),new o(this.state,m.ref,this.root)},o.prototype.group=function(s,u,l){return this.apply(s,u,l)},o.prototype.insert=function(s,u,l){var c=this.state.tree.children.get(this.ref).toArray(),d=s.apply(this.ref,u,l);this.state.tree.add(d);for(var f=0,p=c;f<p.length;f++){var h=p[f];this.state.tree.changeParent(h,d.ref)}return this.editInfo.count++,this.editInfo.lastUpdate=d.ref,this.state.actions.push({kind:"insert",ref:this.ref,transform:d}),new o(this.state,d.ref,this.root)},o.prototype.updateTagged=function(s,u){(this.state.tree.setParams(this.ref,s)||this.state.tree.setTags(this.ref,u))&&(this.editInfo.count++,this.editInfo.lastUpdate=this.ref,this.state.actions.push({kind:"update",ref:this.ref,params:s}))},o.prototype.update=function(s,u){var l;if(u){var c=this.state.tree.transforms.get(this.ref);l=Vu(c.params,u)}else l=typeof s=="function"?Vu(this.state.tree.transforms.get(this.ref).params,s):s;return this.state.tree.setParams(this.ref,l)&&(this.editInfo.count++,this.editInfo.lastUpdate=this.ref,this.state.actions.push({kind:"update",ref:this.ref,params:l})),this.root},o.prototype.to=function(s){return this.root.to(s)},o.prototype.toRoot=function(){return this.root.toRoot()},o.prototype.delete=function(s){return this.root.delete(s)},o.prototype.getTree=function(){return t(this.state)},o.prototype.commit=function(s){if(!this.state.state)throw new Error("Cannot commit template tree");return this.state.state.runTask(this.state.state.updateTree(this,s))},o}();e.To=i})(sd||(sd={}));function bP(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r=void 0,n=[],a=0,i=e;a<i.length;a++){var o=i[a];if(!!o)if(r||(r=new Set),typeof o=="string"){if(r.has(o))continue;r.add(o),n.push(o)}else for(var s=0,u=o;s<u.length;s++){var l=u[s];r.has(l)||(r.add(l),n.push(l))}}return n}var BY=function(){function e(){this.ev=zu.create(),this.actions=new Map,this.fromTypeIndex=new Map,this.events={added:this.ev(),removed:this.ev()}}return e.prototype.add=function(t){var r=ft.is(t)?t.toAction():t;if(this.actions.has(r.id))return this;this.actions.set(r.id,r);for(var n=0,a=r.definition.from;n<a.length;n++){var i=a[n];this.fromTypeIndex.has(i.type)?this.fromTypeIndex.get(i.type).push(r):this.fromTypeIndex.set(i.type,[r])}return this.events.added.next(),this},e.prototype.remove=function(t){var r=ft.is(t)?t.toAction().id:un.is(t)?t:t.id,n=this.actions.get(r);if(!n)return this;this.actions.delete(r);for(var a=0,i=n.definition.from;a<i.length;a++){var o=i[a],s=this.fromTypeIndex.get(o.type);!s||(yd(s,n),s.length===0&&this.fromTypeIndex.delete(o.type))}return this.events.removed.next(),this},e.prototype.fromCell=function(t,r){var n=t.obj;if(!n)return[];var a=this.fromTypeIndex.get(n.type);if(!a)return[];for(var i=!1,o=0,s=a;o<s.length;o++){var u=s[o];if(u.definition.isApplicable){i=!0;break}}if(!i)return a;for(var l=[],c=0,d=a;c<d.length;c++){var u=d[c];u.definition.isApplicable?u.definition.isApplicable(n,t.transform,r)&&l.push(u):l.push(u)}return l},e.prototype.dispose=function(){this.ev.dispose()},e}(),Ns;(function(e){function t(i){return{type:"message",timestamp:new Date,message:i}}e.message=t;function r(i){return{type:"error",timestamp:new Date,message:i}}e.error=r;function n(i){return{type:"warning",timestamp:new Date,message:i}}e.warning=n;function a(i){return{type:"info",timestamp:new Date,message:i}}e.info=a})(Ns||(Ns={}));var dv;(function(e){var t=function(){function a(i){this.cells=i,this._current=void 0}return Object.defineProperty(a.prototype,"current",{get:function(){return this._current},set:function(i){this._current=i},enumerable:!1,configurable:!0}),a.prototype.getAncestorOfType=function(i){if(!!this._current)for(var o=this._current;;){if(o=this.cells.get(o.transform.parent),!o.obj)return;if(o.obj.type===i.type)return o.obj;if(o.transform.ref===cr.RootRef)return}},a.prototype.getRootOfType=function(i){if(!!this._current)for(var o=this._current,s=void 0;;){if(!o.obj)return;if(o.obj.type===i.type&&(s=o),o.transform.ref===cr.RootRef)return s?s.obj:void 0;o=this.cells.get(o.transform.parent)}},a}();e.Impl=t;function r(a,i){for(var o=a.cells,s=o.get(i),u=[s];s!=null&&s.transform.transformer.definition.isDecorator;)s=o.get(s.transform.parent),u.push(s);return u}e.getDecoratorChain=r;function n(a,i,o){var s=void 0,u=a.cells.get(o);if(!!u)for(;;){if(!u.obj)return;if(u.obj.type===i.type&&(s=u),u.transform.ref===cr.RootRef)return s?s.obj:void 0;u=a.cells.get(u.transform.parent)}}e.getRootOfType=n})(dv||(dv={}));var LY=function(){function e(){this.queue=[],this.signal=new Ln}return Object.defineProperty(e.prototype,"length",{get:function(){return this.queue.length},enumerable:!1,configurable:!0}),e.prototype.enqueue=function(t){return this.queue.push(t),this.queue.length===1?!0:this.waitFor(t)},e.prototype.handled=function(t){sv(this.queue,t),this.queue.length>0&&this.signal.next({v:this.queue[0],stillPresent:!0})},e.prototype.remove=function(t){var r=sv(this.queue,t);return r&&this.signal.next({v:t,stillPresent:!1}),r},e.prototype.waitFor=function(t){var r=this;return new Promise(function(n){var a=r.signal.subscribe(function(i){var o=i.v,s=i.stillPresent;o===t&&(a.unsubscribe(),n(s))})})},e}(),NY=function(){function e(t,r){this.getHash=t,this.areEqual=r,this.size=0,this.byHash=new Map}return e.prototype.add=function(t){var r=this.getHash(t);if(this.byHash.has(r)){for(var n=this.byHash.get(r),a=0,i=n.length;a<i;a++)if(this.areEqual(t,n[a]))return!1;return n[n.length]=t,this.size++,!0}else return this.byHash.set(r,[t]),this.size++,!0},e.prototype.has=function(t){var r=this.getHash(t);if(!this.byHash.has(r))return!1;for(var n=this.byHash.get(r),a=0,i=n.length;a<i;a++)if(this.areEqual(t,n[a]))return!0;return!1},e}();function j_(e,t){return new NY(e,t)}function yx(){return new UY}function SP(e){return{previous:null,next:null,inList:!0,value:e}}var UY=function(){function e(){this.count=0,this.first=null,this.last=null}return e.prototype.addFirst=function(t){var r=SP(t);return r.inList=!0,this.first&&(this.first.previous=r),r.next=this.first,this.first=r,this.count++,this.last||(this.last=r),r},e.prototype.addLast=function(t){var r=SP(t);return this.last!==null&&(this.last.next=r),r.previous=this.last,this.last=r,this.first===null&&(this.first=r),r.inList=!0,this.count++,r},e.prototype.removeFirst=function(){var t=this.first;if(t)return this.remove(t),t.value},e.prototype.removeLast=function(){var t=this.last;if(t)return this.remove(t),t.value},e.prototype.remove=function(t){!t.inList||(t.inList=!1,t.previous!==null?t.previous.next=t.next:t.previous===null&&(this.first=t.next),t.next!==null?t.next.previous=t.previous:t.next===null&&(this.last=t.previous),t.next=null,t.previous=null,this.count--)},e.prototype.find=function(t){for(var r=this.first;r!==null;){if(r.value===t)return r;r=r.next}},e}(),$r;(function(e){function t(){return{keys:new Set,array:[]}}e.create=t;function r(a,i,o){var s=a.keys,u=a.array;return s.has(i)?!1:(s.add(i),u[u.length]=o,!0)}e.add=r;function n(a,i){var o=a.keys;return o.has(i)}e.has=n})($r||($r={}));var vc=function(){function e(t,r){var n=this;this.errorFree=!0,this.ev=zu.create(),this.globalContext=void 0,this.events={cell:{stateUpdated:this.ev(),created:this.ev(),removed:this.ev()},object:{updated:this.ev(),created:this.ev(),removed:this.ev()},log:this.ev(),changed:this.ev(),historyUpdated:this.ev()},this.behaviors={currentObject:this.ev.behavior({state:this,ref:cr.RootRef}),isUpdating:this.ev.behavior(!1)},this.actions=new BY,this.cells=new Map,this.spine=new dv.Impl(this.cells),this.tryGetCellData=function(o){var s,u,l=(u=(s=n.cells.get(o))===null||s===void 0?void 0:s.obj)===null||u===void 0?void 0:u.data;if(!o)throw new Error("Cell '"+o+"' data undefined.");return l},this.historyCapacity=5,this.history=[],this.undoingHistory=!1,this.inTransaction=!1,this.inTransactionError=!1,this._inUpdate=!1,this.reverted=!1,this.updateQueue=new LY,this._tree=Hn.createEmpty(cr.createRoot(r&&r.rootState)).asTransient();var a=this._tree,i=a.root;this.runTask=r.runTask,(r==null?void 0:r.historyCapacity)!==void 0&&(this.historyCapacity=r.historyCapacity),this.cells.set(i.ref,{parent:this,transform:i,sourceRef:void 0,obj:t,status:"ok",state:w({},i.state),errorText:void 0,params:{definition:{},values:{}},paramsNormalizedVersion:i.version,dependencies:{dependentBy:[],dependsOn:[]},cache:{}}),this.globalContext=r&&r.globalContext}return Object.defineProperty(e.prototype,"tree",{get:function(){return this._tree},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"transforms",{get:function(){return this._tree.transforms},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"current",{get:function(){return this.behaviors.currentObject.value.ref},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return this.cells.get(this._tree.root.ref)},enumerable:!1,configurable:!0}),e.prototype.build=function(){return new sd.Root(this.tree,this)},e.prototype.addHistory=function(t,r){this.historyCapacity!==0&&(this.history.unshift([t,r||"Update"]),this.history.length>this.historyCapacity&&this.history.pop(),this.events.historyUpdated.next({state:this}))},e.prototype.clearHistory=function(){this.history.length!==0&&(this.history=[],this.events.historyUpdated.next({state:this}))},Object.defineProperty(e.prototype,"latestUndoLabel",{get:function(){return this.history.length>0?this.history[0][1]:void 0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"canUndo",{get:function(){return this.history.length>0},enumerable:!1,configurable:!0}),e.prototype.undo=function(){var t=this;return We.create("Undo",function(r){return ce(t,void 0,void 0,function(){var n;return de(this,function(a){switch(a.label){case 0:if(n=this.history.shift(),!n)return[2];this.events.historyUpdated.next({state:this}),this.undoingHistory=!0,a.label=1;case 1:return a.trys.push([1,,3,4]),[4,this.updateTree(n[0],{canUndo:!1}).runInContext(r)];case 2:return a.sent(),[3,4];case 3:return this.undoingHistory=!1,[7];case 4:return[2]}})})})},e.prototype.getSnapshot=function(){return{tree:Hn.toJSON(this._tree)}},e.prototype.setSnapshot=function(t){var r=Hn.fromJSON(t.tree);return this.updateTree(r)},e.prototype.setCurrent=function(t){this.behaviors.currentObject.next({state:this,ref:t})},e.prototype.updateCellState=function(t,r){var n=this.cells.get(t);if(!!n){var a=typeof r=="function"?r(n.state):r;cr.assignState(n.state,a)&&(n.transform=this._tree.assignState(n.transform.ref,a),this.events.cell.stateUpdated.next({state:this,ref:t,cell:n}))}},e.prototype.dispose=function(){this.ev.dispose(),this.actions.dispose()},e.prototype.select=function(t){return ar.select(t,this)},e.prototype.selectQ=function(t){return typeof t=="string"?ar.select(t,this):ar.select(t(ar.Generators),this)},e.prototype.applyAction=function(t,r,n){var a=this;return n===void 0&&(n=cr.RootRef),We.create("Apply Action",function(i){var o=a.cells.get(n);if(!o)throw new Error("'"+n+"' does not exist.");if(o.status!=="ok")throw new Error("Action cannot be applied to a cell with status '"+o.status+"'");return W_(t.definition.run({ref:n,cell:o,a:o.obj,params:r,state:a},a.globalContext),i)})},e.prototype.transaction=function(t,r){var n=this;return We.create("State Transaction",function(a){return ce(n,void 0,void 0,function(){var i,o,s,u;return de(this,function(l){switch(l.label){case 0:i=this.inTransaction,o=this._tree.asImmutable(),s=!1,l.label=1;case 1:return l.trys.push([1,5,8,9]),i||this.behaviors.isUpdating.next(!0),this.inTransaction=!0,this.inTransactionError=!1,[4,t(a)];case 2:return l.sent(),this.inTransactionError?(s=!0,[4,this.updateTree(o).runInContext(a)]):[3,4];case 3:l.sent(),l.label=4;case 4:return[3,9];case 5:return u=l.sent(),s?[3,7]:(s=!0,[4,this.updateTree(o).runInContext(a)]);case 6:l.sent(),this.events.log.next(Ns.error(""+u)),l.label=7;case 7:if(i)throw this.inTransactionError=!0,u;if(r!=null&&r.rethrowErrors)throw u;return[3,9];case 8:return i||(this.inTransaction=!1,this.events.changed.next({state:this,inTransaction:!1}),this.behaviors.isUpdating.next(!1),s||(r!=null&&r.canUndo?this.addHistory(o,typeof r.canUndo=="string"?r.canUndo:void 0):this.clearHistory())),[7];case 9:return[2]}})})})},Object.defineProperty(e.prototype,"inUpdate",{get:function(){return this._inUpdate},enumerable:!1,configurable:!0}),e.prototype.updateTree=function(t,r){var n=this,a={tree:t,options:r};return We.create("Update Tree",function(i){return ce(n,void 0,void 0,function(){var o,s,u,l,c;return de(this,function(d){switch(d.label){case 0:return[4,this.updateQueue.enqueue(a)];case 1:if(o=d.sent(),!o)return[2];this._inUpdate=!0,s=r!=null&&r.canUndo?this._tree.asImmutable():void 0,u=!1,this.inTransaction||this.behaviors.isUpdating.next(!0),d.label=2;case 2:if(d.trys.push([2,,7,8]),sd.is(t)){if(t.editInfo.applied)throw new Error("This builder has already been applied. Create a new builder for further state updates");t.editInfo.applied=!0}return this.reverted=!1,r&&(r.revertIfAborted||r.revertOnError)?[4,this._revertibleTreeUpdate(i,a,r)]:[3,4];case 3:return c=d.sent(),[3,6];case 4:return[4,this._updateTree(i,a)];case 5:c=d.sent(),d.label=6;case 6:return l=c,u=this.reverted,l.ctx.hadError&&(this.inTransactionError=!0),l.cell?[2,new wR(l.cell.transform.ref,this)]:[2];case 7:return this._inUpdate=!1,this.updateQueue.handled(a),this.inTransaction||(this.behaviors.isUpdating.next(!1),r!=null&&r.canUndo?u||this.addHistory(s,typeof r.canUndo=="string"?r.canUndo:void 0):this.undoingHistory||this.clearHistory()),[7];case 8:return[2]}})})},function(){n.updateQueue.remove(a)})},e.prototype._revertibleTreeUpdate=function(t,r,n){return ce(this,void 0,void 0,function(){var a,i,o;return de(this,function(s){switch(s.label){case 0:return a=this.tree,[4,this._updateTree(t,r)];case 1:return i=s.sent(),o=(i.ctx.hadError||i.ctx.wasAborted)&&n.revertOnError||i.ctx.wasAborted&&n.revertIfAborted,o?(this.reverted=!0,[4,this._updateTree(t,{tree:a,options:r.options})]):[3,3];case 2:return[2,s.sent()];case 3:return[2,i]}})})},e.prototype._updateTree=function(t,r){return ce(this,void 0,void 0,function(){var n,a,i;return de(this,function(o){switch(o.label){case 0:n=!1,a=this.updateTreeAndCreateCtx(r.tree,t,r.options),o.label=1;case 1:return o.trys.push([1,,3,4]),[4,VY(a)];case 2:return n=o.sent(),sd.isTo(r.tree)?(i=this.select(r.tree.ref)[0],[2,{ctx:a,cell:i}]):[2,{ctx:a}];case 3:return this.spine.current=void 0,n&&this.events.changed.next({state:this,inTransaction:this.inTransaction}),[7];case 4:return[2]}})})},e.prototype.updateTreeAndCreateCtx=function(t,r,n){var a=(sd.is(t)?t.getTree():t).asTransient(),i=this._tree;this._tree=a;var o=this.cells,s={parent:this,editInfo:sd.is(t)?t.editInfo:void 0,errorFree:this.errorFree,taskCtx:r,oldTree:i,tree:a,cells:this.cells,spine:this.spine,results:[],options:w(w({},zY),n),changed:!1,hadError:!1,wasAborted:!1,newCurrent:void 0,getCellData:function(u){var l;return(l=o.get(u).obj)===null||l===void 0?void 0:l.data}};return this.errorFree=!0,s},e}();(function(e){function t(r,n){return new e(r,n)}e.create=t,function(r){function n(a,i){return!!i&&a.ref===i.transform.ref&&a.state===i.parent}r.isCell=n}(e.ObjectEvent||(e.ObjectEvent={}))})(vc||(vc={}));var zY={doNotLogTiming:!1,doNotUpdateCurrent:!0,revertIfAborted:!1,revertOnError:!1,canUndo:!1};function VY(e){return ce(this,void 0,void 0,function(){var t,r,n,a,F,i,o,s,m,u,v,x,l,c,m,x,d,f,p,h,x,v,m,g,y,b,x,S,_,A,T,I,M,O,D,F,G;return de(this,function(N){switch(N.label){case 0:if(t=!!(e.editInfo&&e.editInfo.count===1&&e.editInfo.lastUpdate&&e.editInfo.sourceTree===e.oldTree),n=[],t)r=[],a=[e.editInfo.lastUpdate];else{for(r=jY(e),F=e.parent.current,i=!1,o=0,s=r;o<s.length;o++)if(m=s[o],m===F){i=!0;break}for(i&&(u=xP(e.oldTree,F,r,e.cells),e.parent.setCurrent(u)),v=r.length-1;v>=0;v--)x=e.cells.get(r[v]),x&&Sx(x.transform,x.obj,x==null?void 0:x.transform.params,x.cache,e.parent.globalContext);for(l=0,c=r;l<c.length;l++)m=c[l],x=e.cells.get(m),x&&(x.parent=void 0,$Y(x)),d=x&&x.obj,e.cells.delete(m),n.push(d);a=HY(e.cells,e.tree)}for(f=JY(e,a),p=0,h=f.added;p<h.length;p++)x=h[p],e.parent.events.cell.created.next({state:e.parent,ref:x.transform.ref,cell:x});for(v=0;v<r.length;v++)m=r[v],g=e.oldTree.transforms.get(m).parent,e.parent.events.object.removed.next({state:e.parent,ref:m,obj:n[v]}),e.parent.events.cell.removed.next({state:e.parent,ref:m,parent:g});if(n.length&&(n=[]),f.dependent)for(y=0,b=f.dependent;y<b.length;y++)x=b[y],a.push(x.transform.ref);KY(e,a),S=0,_=a,N.label=1;case 1:return S<_.length?(A=_[S],[4,JR(e,A)]):[3,4];case 2:N.sent(),N.label=3;case 3:return S++,[3,1];case 4:for(e.editInfo||XY(e),T=e.newCurrent,I=0,M=e.results;I<M.length;I++)O=M[I],O.action==="created"?(e.parent.events.object.created.next({state:e.parent,ref:O.ref,obj:O.obj}),e.newCurrent||(D=e.tree.transforms.get(O.ref),!D.state.isGhost&&O.obj!==Cn.Null&&(T=O.ref))):O.action==="updated"?e.parent.events.object.updated.next({state:e.parent,ref:O.ref,action:"in-place",obj:O.obj,oldData:O.oldData}):O.action==="replaced"&&e.parent.events.object.updated.next({state:e.parent,ref:O.ref,action:"recreate",obj:O.obj,oldObj:O.oldObj});return T?e.options.doNotUpdateCurrent||e.parent.setCurrent(T):(F=e.parent.current,G=e.cells.get(F),G&&(G.obj===Cn.Null||G.status==="error"&&G.errorText===eK)&&(T=xP(e.oldTree,F,[],e.cells),e.parent.setCurrent(T))),[2,r.length>0||a.length>0||e.changed]}})})}function HY(e,t){var r={roots:[],cells:e};return Hn.doPreOrder(t,t.root,r,GY),r.roots}function GY(e,t,r){var n=r.cells.get(e.ref);return!n||n.transform.version!==e.version?(r.roots.push(e.ref),!1):!(n.status==="error"||n&&n.obj===Cn.Null)}function qY(e,t,r){!r.newTree.transforms.has(e.ref)&&r.cells.has(e.ref)&&r.deletes.push(e.ref)}function jY(e){var t={newTree:e.tree,cells:e.cells,deletes:[]};return Hn.doPostOrder(e.oldTree,e.oldTree.root,t,qY),t.deletes}function WY(e,t,r){var n=r.cells.get(e.ref);!n||!cr.syncState(n.state,e.state)||r.parent.events.cell.stateUpdated.next({state:r.parent,ref:e.ref,cell:n})}function XY(e){Hn.doPreOrder(e.tree,e.tree.root,e,WY)}function cg(e,t,r,n){var a=e.cells.get(t),i=a.status!==r;a.status=r,a.errorText=n,i&&e.parent.events.cell.stateUpdated.next({state:e.parent,ref:t,cell:a})}function YY(e,t,r){r.cells.get(e.ref).transform=e,cg(r,e.ref,"pending")}function KY(e,t){for(var r=0,n=t;r<n.length;r++){var a=n[r];Hn.doPreOrder(e.tree,e.tree.transforms.get(a),e,YY)}}function $Y(e){for(var t=0,r=e.dependencies.dependsOn;t<r.length;t++){var n=r[t];yd(n.dependencies.dependentBy,e)}}function QY(e,t,r){var n=r.ctx,a=r.added,i=r.visited;if(i.add(e.ref),!n.cells.has(e.ref)){var o={parent:n.parent,transform:e,sourceRef:void 0,status:"pending",state:w({},e.state),errorText:void 0,params:void 0,paramsNormalizedVersion:"",dependencies:{dependentBy:[],dependsOn:[]},cache:void 0};n.cells.set(e.ref,o),a.push(o)}}function ZY(e,t){if(!!e.transform.dependsOn)for(var r=0,n=e.transform.dependsOn;r<n.length;r++){var a=n[r],i=t.tree.transforms.get(a);if(!i)throw new Error("Cannot depend on a non-existent transform.");var o=t.cells.get(a);Xa(e.dependencies.dependsOn,o),Xa(o.dependencies.dependentBy,e)}}function JY(e,t){for(var r={ctx:e,visited:new Set,added:[]},n=0,a=t;n<a.length;n++){var i=a[n];Hn.doPreOrder(e.tree,e.tree.transforms.get(i),r,QY)}for(var o=0,s=r.added;o<s.length;o++){var u=s[o];ZY(u,e)}var l;return r.visited.forEach(function(c){for(var d=e.cells.get(c),f=0,p=d.dependencies.dependentBy;f<p.length;f++){var h=p[f];r.visited.has(h.transform.ref)||(l||(l=$r.create()),$r.add(l,h.transform.ref,h))}}),{added:r.added,dependent:l?l.array:void 0}}function xP(e,t,r,n){var a=new Set(r);return ZR(e,t,a,n)}function ZR(e,t,r,n){if(t===cr.RootRef)return t;for(var a=e.transforms.get(t),i=e.children.get(a.parent).values(),o=void 0,s=!1;;){var u=i.next();if(u.done)break;if(!r.has(u.value)){var l=n.get(u.value);if(!(!l||l.status==="error"||l.obj===Cn.Null)){var c=e.transforms.get(u.value);if(!c.state.isGhost){if(u.value===t){s=!0,r.has(t)||(o=t);continue}if(s)return c.ref;o=c.ref}}}}return o||ZR(e,a.parent,r,n)}function bx(e,t,r,n){n||(e.hadError=!0,e.parent.errorFree=!1);var a=e.cells.get(t);if(r){e.wasAborted=e.wasAborted||We.isAbort(r);var i=""+r;cg(e,t,"error",i),n||e.parent.events.log.next({type:"error",timestamp:new Date,message:i})}else a.params=void 0;if(a.obj){var o=a.obj;a.obj=void 0,a.cache=void 0,e.parent.events.object.removed.next({state:e.parent,ref:t,obj:o})}for(var s=e.tree.children.get(t).values();;){var u=s.next();if(u.done)return;bx(e,u.value,void 0,n)}}var eK="Parent is null";function JR(e,t){return ce(this,void 0,void 0,function(){var r,n,a,i,o,s,u;return de(this,function(l){switch(l.label){case 0:cg(e,t,"processing"),r=!1,l.label=1;case 1:return l.trys.push([1,3,,4]),n=xn(),[4,rK(e,t)];case 2:return a=l.sent(),i=xn()-n,a.action!=="none"&&(e.changed=!0),cg(e,t,"ok"),e.results.push(a),a.action==="created"?(r=a.obj===Cn.Null,!r&&!e.options.doNotLogTiming&&e.parent.events.log.next(Ns.info("Created "+a.obj.label+" in "+C0(i)+"."))):(a.action==="updated"||a.action==="replaced")&&(r=a.obj===Cn.Null,!r&&!e.options.doNotLogTiming&&e.parent.events.log.next(Ns.info("Updated "+a.obj.label+" in "+C0(i)+"."))),[3,4];case 3:return o=l.sent(),e.changed=!0,e.hadError||(e.newCurrent=t),bx(e,t,o,!1),Pp||console.error(o),[2];case 4:s=e.tree.children.get(t).values(),l.label=5;case 5:return u=s.next(),u.done?[2]:r?(bx(e,u.value,void 0,!0),[3,8]):[3,6];case 6:return[4,JR(e,u.value)];case 7:l.sent(),l.label=8;case 8:return[3,5];case 9:return[2]}})})}function tK(e,t,r,n){var a=t.transformer.definition.params,i=a?a(r,e.parent.globalContext):{};if(n.paramsNormalizedVersion!==t.version)t.params=E.normalizeParams(i,t.params,"all"),n.paramsNormalizedVersion=t.version;else{var o=E.getDefaultValues(i);t.params=t.params?OW(t.params,o):o}return E.resolveRefs(i,t.params,e.getCellData),{definition:i,values:t.params}}function rK(e,t){var r;return ce(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d,f,p,h,v,m,g,y,b;return de(this,function(x){switch(x.label){case 0:if(n=e.oldTree,a=e.tree,i=e.cells.get(t),o=i.transform,i.transform.ref===cr.RootRef)return[2,{action:"none"}];if(s=o.transformer.definition.from.length===0?e.cells.get(i.transform.parent):ar.findAncestorOfType(a,e.cells,t,o.transformer.definition.from),!s)throw new Error("No suitable parent found for '"+t+"'");return e.spine.current=i,u=s.obj,i.sourceRef=s.transform.ref,l=tK(e,o,u,i),!n.transforms.has(t)||!i.params?(i.params=l,[4,CP(e,i,o.transformer,u,l.values)]):[3,2];case 1:return c=x.sent(),Rb(c,o),i.obj=c,[2,{ref:t,action:"created",obj:c}];case 2:return d=i.params.values,f=i.cache,p=(r=i.obj)===null||r===void 0?void 0:r.data,h=l.values,i.params=l,!!i.obj&&i.obj!==Cn.Null?[4,nK(e,i,o.transformer,u,i.obj,d,h)]:[3,4];case 3:return m=x.sent(),[3,5];case 4:m=ft.UpdateResult.Recreate,x.label=5;case 5:switch(v=m,g=v,g){case ft.UpdateResult.Recreate:return[3,6];case ft.UpdateResult.Updated:return[3,8];case ft.UpdateResult.Null:return[3,9]}return[3,10];case 6:return y=i.obj,Sx(o,y,d,f,e.parent.globalContext),[4,CP(e,i,o.transformer,u,h)];case 7:return b=x.sent(),Rb(b,o),i.obj=b,[2,{ref:t,action:"replaced",oldObj:y,obj:b}];case 8:return Rb(i.obj,o),[2,{ref:t,action:"updated",oldData:p,obj:i.obj}];case 9:return Sx(o,i.obj,d,f,e.parent.globalContext),i.obj=Cn.Null,[2,{ref:t,action:"updated",obj:i.obj}];case 10:return[2,{action:"none"}]}})})}function Sx(e,t,r,n,a){var i,o;(o=(i=e.transformer.definition).dispose)===null||o===void 0||o.call(i,{b:t!==Cn.Null?t:void 0,params:r,cache:n},a)}function Rb(e,t){!e||e===Cn.Null||(e.tags=t.tags)}function W_(e,t){return typeof e.runInContext=="function"?e.runInContext(t):e}function e6(e){if(e.dependencies.dependsOn.length!==0){for(var t=Object.create(null),r=0,n=e.dependencies.dependsOn;r<n.length;r++){var a=n[r];if(!a.obj)throw new Error("Unresolved dependency.");t[a.transform.ref]=a.obj}return t}}function CP(e,t,r,n,a){return t.cache||(t.cache=Object.create(null)),W_(r.definition.apply({a:n,params:a,cache:t.cache,spine:e.spine,dependencies:e6(t)},e.parent.globalContext),e.taskCtx)}function nK(e,t,r,n,a,i,o){return ce(this,void 0,void 0,function(){return de(this,function(s){return r.definition.update?(t.cache||(t.cache=Object.create(null)),[2,W_(r.definition.update({a:n,oldParams:i,b:a,newParams:o,cache:t.cache,spine:e.spine,dependencies:e6(t)},e.parent.globalContext),e.taskCtx)]):[2,ft.UpdateResult.Recreate]})})}var $i={kind:"null-location"};function t6(e,t,r){return{kind:"data-location",tag:e,data:t,element:r}}function pn(e,t,r,n,a,i){if(a===void 0&&(a=!1),i===void 0&&(i=function(){return!1}),e%r!==0)throw new Error("incompatible groupCount and stride");var o={location:$i,index:0,groupIndex:0,instanceIndex:0,isSecondary:!1},s=o.groupIndex<e,u=!1,l=0,c=0,d=!1;return{get hasNext(){return s},get isNextNewInstance(){return u},groupCount:e,instanceCount:t,count:e*t,stride:r,nonInstanceable:a,move:function(){return s&&(o.groupIndex=l,o.instanceIndex=c,o.index=c*e+l,o.location=n(l,d?-1:c),o.isSecondary=i(l,d?-1:c),l+=r,l===e?(++c,u=!0,c<t&&(l=0)):u=!1,s=l<e),o},reset:function(){o.location=$i,o.index=0,o.groupIndex=0,o.instanceIndex=0,o.isSecondary=!1,s=o.groupIndex<e,u=!1,l=0,c=0,d=!1},skipInstance:function(){s&&o.instanceIndex===c&&(++c,l=0,s=c<t)},voidInstances:function(){d=!0}}}function Kd(e){return{kind:"position-location",position:e?C.clone(e):C()}}var _P=Mn(),aK=ue();function iK(e,t){for(var r=0;r<t;r++)if(Mn.fromMat4(_P,ue.fromArray(aK,e,r*16)),Mn.determinant(_P)<0)return!0;return!1}function X_(e,t,r){var n=iK(e,t);if(r){k.update(r.matrix,r.matrix.ref.value),k.update(r.transform,e),k.updateIfChanged(r.uInstanceCount,t),k.updateIfChanged(r.instanceCount,t);var a=r.aTransform.ref.value.length>=t*16?r.aTransform.ref.value:new Float32Array(t*16);a.set(e),k.update(r.aTransform,a);var i=r.extraTransform.ref.value.length>=t*16?r.extraTransform.ref.value:new Float32Array(t*16);k.update(r.extraTransform,dg(i,t));var o=r.aInstance.ref.value.length>=t?r.aInstance.ref.value:new Float32Array(t);return k.update(r.aInstance,Mo(o,t)),k.update(r.hasReflection,n),r6(r),r}else return{aTransform:k.create(new Float32Array(e)),matrix:k.create(ue.identity()),transform:k.create(e),extraTransform:k.create(dg(new Float32Array(t*16),t)),uInstanceCount:k.create(t),instanceCount:k.create(t),aInstance:k.create(Mo(new Float32Array(t))),hasReflection:k.create(n)}}var Y_=new Float32Array(16);ue.toArray(ue.identity(),Y_,0);function K_(e){return X_(new Float32Array(Y_),1,e)}function dg(e,t){for(var r=0;r<t;r++)e.set(Y_,r*16);return e}function r6(e){for(var t=e.aTransform.ref.value,r=e.instanceCount.ref.value,n=e.matrix.ref.value,a=e.transform.ref.value,i=e.extraTransform.ref.value,o=0;o<r;o++){var s=o*16;ue.mulOffset(t,i,a,s,s,s),ue.mulOffset(t,n,t,s,0,s)}k.update(e.aTransform,t)}var dr={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflower:6591981,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,laserlemon:16777044,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrod:16448210,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,maroon2:8323072,maroon3:11546720,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,purple2:8323199,purple3:10494192,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};(function(){var e=new Map;return Object.keys(dr).forEach(function(t){e.set(dr[t],t)}),e})();var n6=it(13421772),oK="Gives everything the same, uniform color.",a6={value:E.Color(n6)};function sK(e){return a6}function $_(e,t){var r=ia(t.value,n6);return{factory:$_,granularity:"uniform",color:function(){return r},props:t,description:oK,legend:Pc([["uniform",r]])}}var uK={name:"uniform",label:"Uniform",category:"Miscellaneous",factory:$_,getParams:sK,defaultValues:E.getDefaultValues(a6),isApplicable:function(e){return!0}},lK="Gives everything the same, uniform size.",i6={value:E.Numeric(1,{min:0,max:20,step:.1})};function cK(e){return i6}function Q_(e,t){var r=t.value;return{factory:Q_,granularity:"uniform",size:function(){return r},props:t,description:lK}}var dK={name:"uniform",label:"Uniform",category:"",factory:Q_,getParams:cK,defaultValues:E.getDefaultValues(i6),isApplicable:function(e){return!0}},fK={custom:{},auto:{},highest:{},higher:{},high:{},medium:{},low:{},lower:{},lowest:{}},pK=Object.keys(fK),Z_=E.arrayToOptions(pK),At;(function(e){e.Params={alpha:E.Numeric(1,{min:0,max:1,step:.01},{label:"Opacity",isEssential:!0,description:"How opaque/transparent the representation is rendered."}),quality:E.Select("auto",Z_,{isEssential:!0,description:"Visual/rendering quality of the representation."})},e.ShadingCategory={category:"Shading"},e.CustomQualityParamInfo={category:"Custom Quality",hideIf:function(o){return typeof o.quality!="undefined"&&o.quality!=="custom"}};function t(o,s,u){o===void 0&&(o=dr.grey),s===void 0&&(s=1),u||(u=K_());var l=pn(1,u.instanceCount.ref.value,1,function(){return $i},!1,function(){return!1}),c={color:$_({},{value:o}),size:Q_({},{value:s})};return{transform:u,locationIterator:l,theme:c}}e.createSimple=t;function r(o,s){return{alpha:k.create(o.alpha),uAlpha:k.create(o.alpha),uVertexCount:k.create(s.vertexCount),uGroupCount:k.create(s.groupCount),drawCount:k.create(s.drawCount)}}e.createValues=r;function n(o,s){k.updateIfChanged(o.alpha,s.alpha)}e.updateValues=n;function a(o){o===void 0&&(o={});var s=o.alpha===void 0?!0:o.alpha===1;return{disposed:!1,visible:!0,alphaFactor:1,pickable:!0,colorOnly:!1,opaque:s,writeDepth:s,noClip:!1}}e.createRenderableState=a;function i(o,s){o.opaque=s.alpha*o.alphaFactor>=1,o.writeDepth=o.opaque}e.updateRenderableState=i})(At||(At={}));function Wl(e,t){return{value:e,unit:t}}var fv;(function(e){function t(u,l,c){var d=!!u[0].cell,f=!!u[0].velocities,p=!!u[0].forces;return{id:un.create22(),frames:u,hasCell:d,hasVelocities:f,hasForces:p,deltaTime:l,timeOffset:c}}e.create=t;function r(u,l,c){var d=u.x,f=u.y,p=u.z;return u.xyzOrdering.frozen?c?u.xyzOrdering.isIdentity?(d=o(d,c),f=o(f,c),p=o(p,c)):ci(u.xyzOrdering.index,c)||(d=i(d,u.xyzOrdering.index,c),f=i(f,u.xyzOrdering.index,c),p=i(p,u.xyzOrdering.index,c)):u.xyzOrdering.isIdentity||(d=s(d,u.xyzOrdering.index),f=s(f,u.xyzOrdering.index),p=s(p,u.xyzOrdering.index)):c&&(u.xyzOrdering.isIdentity?(u.xyzOrdering.isIdentity=!1,u.xyzOrdering.index=c,a(d,c),a(f,c),a(p,c)):ci(u.xyzOrdering.index,c)||(d=i(d,u.xyzOrdering.index,c),f=i(f,u.xyzOrdering.index,c),p=i(p,u.xyzOrdering.index,c))),u.xyzOrdering.frozen=!0,{id:un.create22(),atomId:l,occupancy:ve.ofConst(1,u.elementCount,ve.Schema.int),B_iso_or_equiv:ve.ofConst(0,u.elementCount,ve.Schema.float),xyzDefined:!0,x:d,y:f,z:p}}e.getAtomicConformation=r;var n=[.123];function a(u,l){for(var c=n,d=0,f=u.length;d<f;d++)c[d]=u[l[d]];for(var d=0,f=u.length;d<f;d++)u[d]=c[d]}function i(u,l,c){for(var d=new Float32Array(u.length),f=0,p=u.length;f<p;f++)d[f]=u[l[c[f]]];return d}function o(u,l){for(var c=new Float32Array(u.length),d=0,f=u.length;d<f;d++)c[d]=u[l[d]];return c}function s(u,l){for(var c=new Float32Array(u.length),d=0,f=u.length;d<f;d++)c[l[d]]=u[d];return c}})(fv||(fv={}));var xx;(function(e){function t(r,n,a,i){return{id:un.create22(),label:r,basic:n,sourceData:i,bonds:a}}e.create=t})(xx||(xx={}));function Pi(e){return e}(function(e){function t(r){return r.__key||(r.__key=un.create22()),r.__key}e.getUUID=t})(Pi||(Pi={}));var Ks=function(){function e(){this._list=[],this._set=new Set,this._refs=new Map,this._assets=new Map}return Object.defineProperty(e.prototype,"all",{get:function(){return this._list},enumerable:!1,configurable:!0}),e.prototype.add=function(t){this._set.has(t)||(this._list.push(t),this._set.add(t))},e.prototype.reference=function(t,r){var n=this._refs.get(t)||0;n+=r?1:-1,this._refs.set(t,Math.max(n,0))},e.prototype.hasReference=function(t){return(this._refs.get(t)||0)>0},e.prototype.has=function(t){return this._set.has(t)},e.prototype.assets=function(t,r){var n=this._assets.get(t);if(n)for(var a=0,i=n;a<i.length;a++){var o=i[a];o.dispose()}r?this._assets.set(t,r):this._assets.delete(t)},e.prototype.dispose=function(){this._assets.forEach(function(t){for(var r=0,n=t;r<n.length;r++){var a=n[r];a.dispose()}})},e}();function hK(e,t){var r=[],n=[],a=[];e.x.length&&(r.push.apply(r,Ui(e.x)),n.push.apply(n,Ui(e.y)),a.push.apply(a,Ui(e.z))),t&&(t.spheres.x.length&&(r.push.apply(r,Ui(t.spheres.x)),n.push.apply(n,Ui(t.spheres.y)),a.push.apply(a,Ui(t.spheres.z))),t.gaussians.x.length&&(r.push.apply(r,Ui(t.gaussians.x)),n.push.apply(n,Ui(t.gaussians.y)),a.push.apply(a,Ui(t.gaussians.z))));var i=Ui(r),o=i[0],s=i[1],u=Ui(n),l=u[0],c=u[1],d=Ui(a),f=d[0],p=d[1],h=o+(s-o)/2,v=l+(c-l)/2,m=f+(p-f)/2;return C.create(h,v,m)}function vK(e){var t=new Set,r=new Set;return e.properties.structAsymMap.forEach(function(n,a){var i=n.auth_id;t.add(i),r.add(a)}),{auth:t.size,label:r.size}}var Ti;(function(e){function t(d,f){if(d===f)return!0;if(d.vertexCount!==f.vertexCount||d.edgeCount!==f.edgeCount)return!1;for(var p=d.a,h=d.b,v=d.offset,m=f.a,g=f.b,y=f.offset,b=0,x=d.a.length;b<x;b++)if(p[b]!==m[b])return!1;for(var b=0,x=d.b.length;b<x;b++)if(h[b]!==g[b])return!1;for(var b=0,x=d.offset.length;b<x;b++)if(v[b]!==y[b])return!1;for(var S=0,_=Object.keys(d.edgeProps);S<_.length;S++){var A=_[S],T=d.edgeProps[A],I=f.edgeProps[A];if(!I)return!1;for(var b=0,x=T.length;b<x;b++)if(T[b]!==I[b])return!1}return!0}e.areEqual=t;var r=function(){function d(f,p,h,v,m,g){this.offset=f,this.a=p,this.b=h,this.edgeCount=v,this.props=g,this.vertexCount=f.length-1,this.edgeProps=m||{}}return d.prototype.getEdgeIndex=function(f,p){var h,v;f<p?(h=f,v=p):(h=p,v=f);for(var m=this.offset[h],g=this.offset[h+1];m<g;m++)if(this.b[m]===v)return m;return-1},d.prototype.getDirectedEdgeIndex=function(f,p){for(var h=this.offset[f],v=this.offset[f+1];h<v;h++)if(this.b[h]===p)return h;return-1},d.prototype.getVertexEdgeCount=function(f){return this.offset[f+1]-this.offset[f]},d}();function n(d,f,p,h,v,m){return new r(d,f,p,h,v,m)}e.create=n;var a=function(){function d(f,p,h){this.vertexCount=f,this.xs=p,this.ys=h,this.current=0,this.curA=0,this.curB=0,this.edgeCount=p.length,this.offsets=new Int32Array(this.vertexCount+1),this.bucketFill=new Int32Array(this.vertexCount);for(var v=new Int32Array(this.vertexCount),m=0,g=this.xs.length;m<g;m++)v[this.xs[m]]++;for(var m=0,g=this.ys.length;m<g;m++)v[this.ys[m]]++;for(var y=0,m=0;m<this.vertexCount;m++)this.offsets[m]=y,y+=v[m];this.offsets[this.vertexCount]=y,this.slotCount=y,this.a=new Int32Array(y),this.b=new Int32Array(y)}return d.prototype.createGraph=function(f,p){return n(this.offsets,this.a,this.b,this.edgeCount,f,p)},d.prototype.addNextEdge=function(){var f=this.xs[this.current],p=this.ys[this.current],h=this.offsets[f]+this.bucketFill[f],v=this.offsets[p]+this.bucketFill[p];this.a[h]=f,this.b[h]=p,this.bucketFill[f]++,this.a[v]=p,this.b[v]=f,this.bucketFill[p]++,this.current++,this.curA=h,this.curB=v},d.prototype.addAllEdges=function(){for(var f=0;f<this.edgeCount;f++)this.addNextEdge()},d.prototype.assignProperty=function(f,p){f[this.curA]=p,f[this.curB]=p},d}();e.EdgeBuilder=a;var i=function(){function d(f,p,h){this.vertexCount=f,this.xs=p,this.ys=h,this.current=0,this.curA=0,this.edgeCount=p.length,this.offsets=new Int32Array(this.vertexCount+1),this.bucketFill=new Int32Array(this.vertexCount);for(var v=new Int32Array(this.vertexCount),m=0,g=this.xs.length;m<g;m++)v[this.xs[m]]++;for(var y=0,m=0;m<this.vertexCount;m++)this.offsets[m]=y,y+=v[m];this.offsets[this.vertexCount]=y,this.slotCount=y,this.a=new Int32Array(y),this.b=new Int32Array(y)}return d.prototype.createGraph=function(f){return n(this.offsets,this.a,this.b,this.edgeCount,f)},d.prototype.addNextEdge=function(){var f=this.xs[this.current],p=this.ys[this.current],h=this.offsets[f]+this.bucketFill[f];this.a[h]=f,this.b[h]=p,this.bucketFill[f]++,this.current++,this.curA=h},d.prototype.addAllEdges=function(){for(var f=0;f<this.edgeCount;f++)this.addNextEdge()},d.prototype.assignProperty=function(f,p){f[this.curA]=p},d}();e.DirectedEdgeBuilder=i;var o=function(){function d(f){this.vertexCount=f,this.xs=[],this.ys=[],this.included=new Set}return d.prototype.addEdge=function(f,p){var h=f,v=p;f>p&&(h=p,v=f);var m=oc(h,v);return this.included.has(m)?!1:(this.included.add(m),this.xs[this.xs.length]=h,this.ys[this.ys.length]=v,!0)},d.prototype.getGraph=function(){return s(this.vertexCount,this.xs,this.ys)},d.prototype.getEdgeBuiler=function(){return new a(this.vertexCount,this.xs,this.ys)},d}();e.UniqueEdgeBuilder=o;function s(d,f,p){var h=new e.EdgeBuilder(d,f,p);return h.addAllEdges(),h.createGraph({})}e.fromVertexPairs=s;function u(d,f){for(var p=d.b,h=d.offset,v=d.vertexCount,m=d.edgeProps,g=new Int32Array(v),y=0,b=f.length;y<b;y++)g[f[y]]=y+1;for(var x=0,y=0;y<v;y++)if(g[y]!==0)for(var S=h[y],_=h[y+1];S<_;S++)p[S]>y&&g[p[S]]!==0&&x++;for(var A=new Int32Array(f.length+1),T=new Int32Array(2*x),I=new Int32Array(2*x),M=new Int32Array(2*x),O=0,D=0,y=0;y<v;y++)if(g[y]!==0){for(var F=g[y]-1,S=h[y],_=h[y+1];S<_;S++){var G=g[p[S]];G!==0&&(I[O]=F,M[O]=G-1,T[O]=S,O++)}A[++D]=O}for(var N={},z=0,$=Object.keys(m);z<$.length;z++){var j=$[z];N[j]=IG(m[j],T)}return n(A,I,M,x,N)}e.induceByVertices=u;function l(d){var f=d.vertexCount;if(f===0)return{componentCount:0,componentIndex:new Int32Array(0)};if(d.edgeCount===0){for(var p=new Int32Array(f),h=0,v=f;h<v;h++)p[h]=h;return{componentCount:f,componentIndex:p}}for(var m=new Int32Array(f),h=0,v=f;h<v;h++)m[h]=-1;var g=0;m[0]=g;var y=d.offset,b=d.b,x=[0],S=Wq(f);for(S.remove(0);x.length>0;){for(var _=x.pop(),A=m[_],T=y[_],I=y[_+1];T<I;T++){var M=b[T];!S.has(M)||(S.remove(M),x.push(M),m[M]=A)}x.length===0&&S.head>=0&&(x.push(S.head),m[S.head]=++g,S.remove(S.head))}return{componentCount:f,componentIndex:m}}e.connectedComponents=l;function c(d,f,p,h){if(Je.areIntersecting(f,p))return!0;if(h<1)return!1;for(var v=new Set,m=0,g=f.length;m<g;++m)v.add(f[m]);return o6(d,f,p,h,v)}e.areVertexSetsConnected=c})(Ti||(Ti={}));function o6(e,t,r,n,a){for(var i=e.b,o=e.offset,s=[],u=0,l=t.length;u<l;++u)for(var c=t[u],d=o[c],f=o[c+1];d<f;++d){var p=i[d];if(!a.has(p)){if(Je.has(r,p))return!0;a.add(p),s[s.length]=p}}return n>1?o6(e,s,r,n-1,a):!1}var mK=function(){function e(){this.map=new Map,this.applicable=new Map}return e.prototype.add=function(t,r,n){this.map.set(t,r),n&&this.applicable.set(t,n)},e.prototype.remove=function(t){this.map.delete(t),this.applicable.delete(t)},e.prototype.get=function(t){return this.map.get(t)},e.prototype.isApplicable=function(t){var r=this.applicable.get(t.sourceData.kind);return r?r(t):!0},e}(),ds;(function(e){function t(r){var n=r.name,a=new mK;return{descriptor:r,formatRegistry:a,isApplicable:function(i){return a.isApplicable(i)},get:function(i){if(i._staticPropertyData[n])return i._staticPropertyData[n];if(!i.customProperties.has(r)){var o=a.get(i.sourceData.kind);if(!!o)return i._staticPropertyData[n]=o(i),i.customProperties.add(r),i._staticPropertyData[n]}},set:function(i,o){i._staticPropertyData[n]=o},delete:function(i){delete i._staticPropertyData[n]}}}e.create=t})(ds||(ds={}));function gK(e,t,r,n){for(var a=new Ti.EdgeBuilder(n,e,t),i=new Int8Array(a.slotCount),o=new Array(a.slotCount),s=new Array(a.slotCount),u=0,l=a.edgeCount;u<l;u++)a.addNextEdge(),a.assignProperty(i,r.order?r.order[u]:1),a.assignProperty(o,r.distance?r.distance[u]:-1),a.assignProperty(s,r.flag?r.flag[u]:1);return a.createGraph({order:i,distance:o,flag:s})}var Ba;(function(e){e.Descriptor={name:"index_pair_bonds"},e.Provider=ds.create(e.Descriptor);function t(r){var n=r.pairs,a=r.count,i=n.indexA.toArray(),o=n.indexB.toArray(),s=n.order&&n.order.toArray(),u=n.distance&&n.distance.toArray(),l=n.flag&&n.flag.toArray();return gK(i,o,{order:s,distance:u,flag:l},a)}e.fromData=t})(Ba||(Ba={}));var Tc=ve.Schema,ne=Tc.str,Fe=Tc.int,sr=Tc.float,Ob=Tc.coord,It=Tc.Aliased,_l=Tc.Matrix,Sm=Tc.Vector,Fc=Tc.List,vr={atom_site:{auth_asym_id:ne,auth_atom_id:ne,auth_comp_id:ne,auth_seq_id:Fe,B_iso_or_equiv:sr,Cartn_x:Ob,Cartn_y:Ob,Cartn_z:Ob,group_PDB:It(ne),id:Fe,label_alt_id:ne,label_asym_id:ne,label_atom_id:ne,label_comp_id:ne,label_entity_id:ne,label_seq_id:Fe,occupancy:sr,type_symbol:ne,pdbx_PDB_ins_code:ne,pdbx_PDB_model_num:Fe,pdbx_formal_charge:Fe,ihm_model_id:Fe},atom_site_anisotrop:{id:Fe,type_symbol:ne,U:_l(3,3),U_esd:_l(3,3),pdbx_auth_seq_id:ne,pdbx_auth_asym_id:ne,pdbx_auth_atom_id:ne,pdbx_auth_comp_id:ne,pdbx_label_seq_id:Fe,pdbx_label_alt_id:ne,pdbx_label_asym_id:ne,pdbx_label_atom_id:ne,pdbx_label_comp_id:ne,pdbx_PDB_ins_code:ne},atom_sites:{entry_id:ne,fract_transf_matrix:_l(3,3),fract_transf_vector:Sm(3)},audit_author:{name:ne,pdbx_ordinal:Fe,identifier_ORCID:ne},audit_conform:{dict_location:ne,dict_name:ne,dict_version:ne},cell:{angle_alpha:sr,angle_beta:sr,angle_gamma:sr,entry_id:ne,length_a:sr,length_b:sr,length_c:sr,Z_PDB:Fe,pdbx_unique_axis:ne},chem_comp:{formula:ne,formula_weight:sr,id:ne,mon_nstd_flag:It(ne),name:ne,type:It(ne),pdbx_synonyms:Fc(";",function(e){return e})},chem_comp_bond:{atom_id_1:ne,atom_id_2:ne,comp_id:ne,value_order:It(ne),pdbx_ordinal:Fe,pdbx_stereo_config:It(ne),pdbx_aromatic_flag:It(ne)},citation:{book_publisher:ne,country:ne,id:ne,journal_abbrev:ne,journal_id_ASTM:ne,journal_id_CSD:ne,journal_id_ISSN:ne,journal_volume:ne,page_first:ne,page_last:ne,title:ne,year:Fe,pdbx_database_id_DOI:ne,pdbx_database_id_PubMed:Fe},citation_author:{citation_id:ne,name:ne,ordinal:Fe},database_2:{database_id:It(ne),database_code:ne},entity:{details:ne,formula_weight:sr,id:ne,src_method:It(ne),type:It(ne),pdbx_description:Fc(",",function(e){return e}),pdbx_number_of_molecules:Fe,pdbx_mutation:ne,pdbx_fragment:ne,pdbx_ec:Fc(",",function(e){return e})},entity_poly:{entity_id:ne,nstd_linkage:It(ne),nstd_monomer:It(ne),type:It(ne),pdbx_strand_id:Fc(",",function(e){return e}),pdbx_seq_one_letter_code:ne,pdbx_seq_one_letter_code_can:ne,pdbx_target_identifier:ne},entity_poly_seq:{entity_id:ne,hetero:It(ne),mon_id:ne,num:Fe},entry:{id:ne},exptl:{entry_id:ne,method:It(ne)},struct:{entry_id:ne,title:ne,pdbx_descriptor:ne},struct_asym:{details:ne,entity_id:ne,id:ne,pdbx_modified:ne,pdbx_blank_PDB_chainid_flag:It(ne)},struct_conf:{beg_label_asym_id:ne,beg_label_comp_id:ne,beg_label_seq_id:Fe,beg_auth_asym_id:ne,beg_auth_comp_id:ne,beg_auth_seq_id:Fe,conf_type_id:It(ne),details:ne,end_label_asym_id:ne,end_label_comp_id:ne,end_label_seq_id:Fe,end_auth_asym_id:ne,end_auth_comp_id:ne,end_auth_seq_id:Fe,id:ne,pdbx_beg_PDB_ins_code:ne,pdbx_end_PDB_ins_code:ne,pdbx_PDB_helix_class:ne,pdbx_PDB_helix_length:Fe,pdbx_PDB_helix_id:ne},struct_conn:{conn_type_id:It(ne),details:ne,id:ne,ptnr1_label_asym_id:ne,ptnr1_label_atom_id:ne,ptnr1_label_comp_id:ne,ptnr1_label_seq_id:Fe,ptnr1_auth_asym_id:ne,ptnr1_auth_comp_id:ne,ptnr1_auth_seq_id:Fe,ptnr1_symmetry:ne,ptnr2_label_asym_id:ne,ptnr2_label_atom_id:ne,ptnr2_label_comp_id:ne,ptnr2_label_seq_id:Fe,ptnr2_auth_asym_id:ne,ptnr2_auth_comp_id:ne,ptnr2_auth_seq_id:Fe,ptnr2_symmetry:ne,pdbx_ptnr1_PDB_ins_code:ne,pdbx_ptnr1_label_alt_id:ne,pdbx_ptnr1_standard_comp_id:ne,pdbx_ptnr2_PDB_ins_code:ne,pdbx_ptnr2_label_alt_id:ne,pdbx_ptnr3_PDB_ins_code:ne,pdbx_ptnr3_label_alt_id:ne,pdbx_ptnr3_label_asym_id:ne,pdbx_ptnr3_label_atom_id:ne,pdbx_ptnr3_label_comp_id:ne,pdbx_ptnr3_label_seq_id:Fe,pdbx_PDB_id:ne,pdbx_dist_value:sr,pdbx_value_order:It(ne)},struct_conn_type:{criteria:ne,id:It(ne),reference:ne},struct_keywords:{entry_id:ne,text:Fc(",",function(e){return e}),pdbx_keywords:ne},struct_ncs_oper:{code:It(ne),details:ne,id:Fe,matrix:_l(3,3),vector:Sm(3)},struct_sheet_range:{beg_label_asym_id:ne,beg_label_comp_id:ne,beg_label_seq_id:Fe,end_label_asym_id:ne,end_label_comp_id:ne,end_label_seq_id:Fe,beg_auth_asym_id:ne,beg_auth_comp_id:ne,beg_auth_seq_id:Fe,end_auth_asym_id:ne,end_auth_comp_id:ne,end_auth_seq_id:Fe,id:ne,sheet_id:ne,pdbx_beg_PDB_ins_code:ne,pdbx_end_PDB_ins_code:ne},struct_site:{details:ne,id:ne,pdbx_num_residues:Fe,pdbx_evidence_code:ne,pdbx_auth_asym_id:ne,pdbx_auth_comp_id:ne,pdbx_auth_seq_id:ne,pdbx_auth_ins_code:ne},struct_site_gen:{details:ne,id:ne,label_alt_id:ne,label_asym_id:ne,label_atom_id:ne,label_comp_id:ne,label_seq_id:Fe,auth_asym_id:ne,auth_comp_id:ne,auth_seq_id:ne,site_id:ne,symmetry:ne,pdbx_auth_ins_code:ne,pdbx_num_res:Fe},symmetry:{entry_id:ne,cell_setting:It(ne),Int_Tables_number:Fe,space_group_name_Hall:ne,"space_group_name_H-M":ne},pdbx_database_status:{status_code:It(ne),status_code_sf:It(ne),status_code_mr:It(ne),entry_id:ne,recvd_initial_deposition_date:ne,SG_entry:It(ne),deposit_site:It(ne),process_site:It(ne),status_code_cs:It(ne),methods_development_category:It(ne),pdb_format_compatible:It(ne)},pdbx_nonpoly_scheme:{asym_id:ne,entity_id:ne,mon_id:ne,pdb_strand_id:ne,ndb_seq_num:ne,pdb_seq_num:ne,auth_seq_num:ne,pdb_mon_id:ne,auth_mon_id:ne,pdb_ins_code:ne},pdbx_database_related:{db_name:ne,details:ne,db_id:ne,content_type:It(ne)},pdbx_entity_nonpoly:{entity_id:ne,comp_id:ne,name:ne},pdbx_chem_comp_synonyms:{name:ne,comp_id:ne,provenance:It(ne)},pdbx_chem_comp_identifier:{comp_id:ne,identifier:ne,type:It(ne),program:ne,program_version:ne},pdbx_unobs_or_zero_occ_residues:{id:Fe,polymer_flag:It(ne),occupancy_flag:It(Fe),PDB_model_num:Fe,auth_asym_id:ne,auth_comp_id:ne,auth_seq_id:ne,PDB_ins_code:ne,label_asym_id:ne,label_comp_id:ne,label_seq_id:Fe},pdbx_struct_mod_residue:{id:Fe,auth_asym_id:ne,auth_comp_id:ne,auth_seq_id:Fe,PDB_ins_code:ne,label_asym_id:ne,label_comp_id:ne,label_seq_id:Fe,parent_comp_id:ne,details:ne},pdbx_struct_oper_list:{id:ne,type:It(ne),name:ne,symmetry_operation:ne,matrix:_l(3,3),vector:Sm(3)},pdbx_struct_assembly:{method_details:ne,oligomeric_details:ne,oligomeric_count:Fe,details:ne,id:ne},pdbx_struct_assembly_gen:{asym_id_list:Fc(",",function(e){return e}),assembly_id:ne,oper_expression:ne},pdbx_reference_entity_list:{prd_id:ne,ref_entity_id:ne,type:It(ne),details:ne,component_id:Fe},pdbx_reference_entity_link:{link_id:Fe,prd_id:ne,details:ne,ref_entity_id_1:ne,ref_entity_id_2:ne,entity_seq_num_1:Fe,entity_seq_num_2:Fe,comp_id_1:ne,comp_id_2:ne,atom_id_1:ne,atom_id_2:ne,value_order:It(ne),component_1:Fe,component_2:Fe,link_class:It(ne)},pdbx_reference_entity_poly_link:{link_id:Fe,prd_id:ne,ref_entity_id:ne,component_id:Fe,entity_seq_num_1:Fe,entity_seq_num_2:Fe,comp_id_1:ne,comp_id_2:ne,atom_id_1:ne,atom_id_2:ne,value_order:It(ne)},pdbx_molecule:{prd_id:ne,instance_id:Fe,asym_id:ne},pdbx_molecule_features:{prd_id:ne,class:It(ne),type:It(ne),name:ne,details:ne},entity_src_nat:{entity_id:ne,pdbx_organism_scientific:ne,pdbx_plasmid_name:ne,pdbx_src_id:Fe,pdbx_beg_seq_num:Fe,pdbx_end_seq_num:Fe},entity_src_gen:{entity_id:ne,pdbx_gene_src_gene:Fc(",",function(e){return e}),pdbx_gene_src_scientific_name:ne,plasmid_name:ne,pdbx_src_id:Fe,pdbx_beg_seq_num:Fe,pdbx_end_seq_num:Fe},pdbx_entity_src_syn:{organism_scientific:ne,entity_id:ne,pdbx_src_id:Fe,pdbx_beg_seq_num:Fe,pdbx_end_seq_num:Fe},pdbx_entity_branch_descriptor:{entity_id:ne,descriptor:ne,type:It(ne),program:ne,program_version:ne,ordinal:Fe},pdbx_entity_instance_feature:{details:ne,feature_type:It(ne),auth_asym_id:ne,asym_id:ne,auth_seq_num:ne,seq_num:Fe,comp_id:ne,auth_comp_id:ne,ordinal:Fe},pdbx_entity_branch_list:{entity_id:ne,hetero:It(ne),comp_id:ne,num:Fe},pdbx_entity_branch_link:{link_id:Fe,details:ne,entity_id:ne,entity_branch_list_num_1:Fe,entity_branch_list_num_2:Fe,comp_id_1:ne,comp_id_2:ne,atom_id_1:ne,leaving_atom_id_1:ne,atom_stereo_config_1:It(ne),atom_id_2:ne,leaving_atom_id_2:ne,atom_stereo_config_2:It(ne),value_order:It(ne)},pdbx_entity_branch:{entity_id:ne,type:It(ne)},pdbx_branch_scheme:{entity_id:ne,hetero:It(ne),asym_id:ne,mon_id:ne,num:Fe,pdb_asym_id:ne,pdb_seq_num:ne,pdb_mon_id:ne,auth_asym_id:ne,auth_seq_num:ne,auth_mon_id:ne},pdbx_chem_comp_related:{comp_id:ne,related_comp_id:ne,relationship_type:It(ne),details:ne},ihm_starting_model_details:{starting_model_id:ne,entity_id:ne,entity_description:ne,asym_id:ne,entity_poly_segment_id:Fe,starting_model_source:It(ne),starting_model_auth_asym_id:ne,starting_model_sequence_offset:Fe,dataset_list_id:Fe},ihm_starting_comparative_models:{id:Fe,starting_model_id:ne,starting_model_auth_asym_id:ne,starting_model_seq_id_begin:Fe,starting_model_seq_id_end:Fe,template_auth_asym_id:ne,template_seq_id_begin:Fe,template_seq_id_end:Fe,template_sequence_identity:sr,template_sequence_identity_denominator:It(Fe),template_dataset_list_id:Fe,alignment_file_id:Fe},ihm_starting_model_seq_dif:{id:Fe,entity_id:ne,asym_id:ne,seq_id:Fe,comp_id:ne,starting_model_id:ne,db_asym_id:ne,db_seq_id:Fe,db_comp_id:ne,details:ne},ihm_model_representation:{id:Fe,name:ne,details:ne},ihm_model_representation_details:{id:Fe,representation_id:Fe,entity_poly_segment_id:Fe,entity_id:ne,entity_description:ne,entity_asym_id:ne,model_object_primitive:It(ne),starting_model_id:ne,model_mode:It(ne),model_granularity:It(ne),model_object_count:Fe},ihm_struct_assembly_details:{id:Fe,assembly_id:Fe,parent_assembly_id:Fe,entity_description:ne,entity_id:ne,asym_id:ne,entity_poly_segment_id:Fe},ihm_struct_assembly:{id:Fe,name:ne,description:ne},ihm_modeling_protocol:{id:Fe,num_steps:Fe,protocol_name:ne},ihm_modeling_protocol_details:{id:Fe,protocol_id:Fe,step_id:Fe,struct_assembly_id:Fe,dataset_group_id:Fe,struct_assembly_description:ne,step_name:ne,step_method:ne,num_models_begin:Fe,num_models_end:Fe,multi_scale_flag:It(ne),multi_state_flag:It(ne),ordered_flag:It(ne),script_file_id:Fe,software_id:Fe},ihm_multi_state_modeling:{state_id:Fe,state_group_id:Fe,population_fraction:sr,population_fraction_sd:sr,state_type:ne,state_name:ne,experiment_type:It(ne),details:ne},ihm_modeling_post_process:{id:Fe,protocol_id:Fe,analysis_id:Fe,step_id:Fe,type:It(ne),feature:It(ne),num_models_begin:Fe,num_models_end:Fe},ihm_ensemble_info:{ensemble_id:Fe,ensemble_name:ne,post_process_id:Fe,model_group_id:Fe,ensemble_clustering_method:It(ne),ensemble_clustering_feature:It(ne),num_ensemble_models:Fe,num_ensemble_models_deposited:Fe,ensemble_precision_value:sr,ensemble_file_id:Fe},ihm_model_list:{model_id:Fe,model_name:ne,assembly_id:Fe,protocol_id:Fe,representation_id:Fe},ihm_model_group:{id:Fe,name:ne,details:ne},ihm_model_group_link:{model_id:Fe,group_id:Fe},ihm_model_representative:{id:Fe,model_group_id:Fe,model_id:Fe,selection_criteria:It(ne)},ihm_dataset_list:{id:Fe,data_type:It(ne),database_hosted:It(ne)},ihm_dataset_group:{id:Fe,name:ne,application:It(ne),details:ne},ihm_dataset_group_link:{dataset_list_id:Fe,group_id:Fe},ihm_related_datasets:{dataset_list_id_derived:Fe,dataset_list_id_primary:Fe},ihm_dataset_related_db_reference:{id:Fe,dataset_list_id:Fe,db_name:It(ne),accession_code:ne,version:ne,details:ne},ihm_external_reference_info:{reference_id:Fe,reference_provider:ne,reference_type:It(ne),reference:ne,refers_to:It(ne),associated_url:ne},ihm_external_files:{id:Fe,reference_id:Fe,file_path:ne,content_type:It(ne),file_size_bytes:sr,details:ne},ihm_dataset_external_reference:{id:Fe,dataset_list_id:Fe,file_id:Fe},ihm_localization_density_files:{id:Fe,file_id:Fe,ensemble_id:Fe,entity_id:ne,entity_poly_segment_id:Fe,asym_id:ne},ihm_predicted_contact_restraint:{id:Fe,group_id:Fe,entity_id_1:ne,entity_id_2:ne,asym_id_1:ne,asym_id_2:ne,comp_id_1:ne,comp_id_2:ne,seq_id_1:Fe,seq_id_2:Fe,rep_atom_1:It(ne),rep_atom_2:It(ne),distance_lower_limit:sr,distance_upper_limit:sr,probability:sr,restraint_type:It(ne),model_granularity:It(ne),dataset_list_id:Fe,software_id:Fe},ihm_cross_link_list:{id:Fe,group_id:Fe,entity_description_1:ne,entity_description_2:ne,entity_id_1:ne,entity_id_2:ne,comp_id_1:ne,comp_id_2:ne,seq_id_1:Fe,seq_id_2:Fe,linker_type:It(ne),dataset_list_id:Fe},ihm_cross_link_restraint:{id:Fe,group_id:Fe,entity_id_1:ne,entity_id_2:ne,asym_id_1:ne,asym_id_2:ne,comp_id_1:ne,comp_id_2:ne,seq_id_1:Fe,seq_id_2:Fe,atom_id_1:ne,atom_id_2:ne,restraint_type:It(ne),conditional_crosslink_flag:It(ne),model_granularity:It(ne),distance_threshold:sr,psi:sr,sigma_1:sr,sigma_2:sr},ihm_cross_link_result_parameters:{id:Fe,restraint_id:Fe,model_id:Fe,psi:sr,sigma_1:sr,sigma_2:sr},ihm_2dem_class_average_restraint:{id:Fe,dataset_list_id:Fe,number_raw_micrographs:Fe,pixel_size_width:sr,pixel_size_height:sr,image_resolution:sr,image_segment_flag:It(ne),number_of_projections:Fe,struct_assembly_id:Fe,details:ne},ihm_2dem_class_average_fitting:{id:Fe,restraint_id:Fe,model_id:Fe,cross_correlation_coefficient:sr,rot_matrix:_l(3,3),tr_vector:Sm(3)},ihm_3dem_restraint:{id:Fe,dataset_list_id:Fe,model_id:Fe,struct_assembly_id:Fe,fitting_method:ne,number_of_gaussians:Fe,cross_correlation_coefficient:sr},ihm_sas_restraint:{id:Fe,dataset_list_id:Fe,model_id:Fe,struct_assembly_id:Fe,profile_segment_flag:It(ne),fitting_atom_type:ne,fitting_method:ne,fitting_state:It(ne),radius_of_gyration:sr,chi_value:sr,details:ne},ihm_starting_model_coord:{ordinal_id:Fe,starting_model_id:ne,group_PDB:It(ne),id:Fe,type_symbol:ne,entity_id:ne,atom_id:ne,comp_id:ne,seq_id:Fe,asym_id:ne,Cartn_x:sr,Cartn_y:sr,Cartn_z:sr,B_iso_or_equiv:sr},ihm_sphere_obj_site:{id:Fe,entity_id:ne,seq_id_begin:Fe,seq_id_end:Fe,asym_id:ne,Cartn_x:sr,Cartn_y:sr,Cartn_z:sr,object_radius:sr,rmsf:sr,model_id:Fe},ihm_gaussian_obj_site:{id:Fe,entity_id:ne,seq_id_begin:Fe,seq_id_end:Fe,asym_id:ne,mean_Cartn_x:sr,mean_Cartn_y:sr,mean_Cartn_z:sr,weight:sr,covariance_matrix:_l(3,3),model_id:Fe},ihm_gaussian_obj_ensemble:{id:Fe,entity_id:ne,seq_id_begin:Fe,seq_id_end:Fe,asym_id:ne,mean_Cartn_x:sr,mean_Cartn_y:sr,mean_Cartn_z:sr,weight:sr,covariance_matrix:_l(3,3),ensemble_id:Fe},ihm_feature_list:{feature_id:Fe,feature_type:It(ne),entity_type:It(ne)},ihm_poly_residue_feature:{ordinal_id:Fe,feature_id:Fe,entity_id:ne,asym_id:ne,comp_id_begin:ne,comp_id_end:ne,seq_id_begin:Fe,seq_id_end:Fe},ihm_derived_distance_restraint:{id:Fe,group_id:Fe,feature_id_1:Fe,feature_id_2:Fe,group_conditionality:It(ne),random_exclusion_fraction:sr,distance_upper_limit:sr,restraint_type:It(ne),dataset_list_id:Fe}},yK={type_symbol:ve.Schema.Aliased(vr.atom_site.type_symbol),label_atom_id:vr.atom_site.label_atom_id,auth_atom_id:vr.atom_site.auth_atom_id,label_alt_id:vr.atom_site.label_alt_id,label_comp_id:vr.atom_site.label_comp_id,auth_comp_id:vr.atom_site.auth_comp_id,pdbx_formal_charge:vr.atom_site.pdbx_formal_charge},bK={group_PDB:vr.atom_site.group_PDB,label_seq_id:vr.atom_site.label_seq_id,auth_seq_id:vr.atom_site.auth_seq_id,pdbx_PDB_ins_code:vr.atom_site.pdbx_PDB_ins_code},SK={label_asym_id:vr.atom_site.label_asym_id,auth_asym_id:vr.atom_site.auth_asym_id,label_entity_id:vr.atom_site.label_entity_id},Cx;(function(e){function t(){return{label_entity_id:"",label_asym_id:"",auth_seq_id:0,pdbx_PDB_ins_code:void 0}}e.EmptyResidueKey=t})(Cx||(Cx={}));var Dd;(function(e){function t(a,i){return a.residueAtomSegments.index[a.chainAtomSegments.offsets[i]]}e.chainStartResidueIndex=t;function r(a,i){return a.residueAtomSegments.index[a.chainAtomSegments.offsets[i+1]-1]+1}e.chainEndResidueIndexExcl=r;function n(a,i){return r(a,i)-t(a,i)}e.chainResidueCount=n})(Dd||(Dd={}));var Ny={H:1,D:1,T:1,HE:2,LI:3,BE:4,B:5,C:6,N:7,O:8,F:9,NE:10,NA:11,MG:12,AL:13,SI:14,P:15,S:16,CL:17,AR:18,K:19,CA:20,SC:21,TI:22,V:23,CR:24,MN:25,FE:26,CO:27,NI:28,CU:29,ZN:30,GA:31,GE:32,AS:33,SE:34,BR:35,KR:36,RB:37,SR:38,Y:39,ZR:40,NB:41,MO:42,TC:43,RU:44,RH:45,PD:46,AG:47,CD:48,IN:49,SN:50,SB:51,TE:52,I:53,XE:54,CS:55,BA:56,LA:57,CE:58,PR:59,ND:60,PM:61,SM:62,EU:63,GD:64,TB:65,DY:66,HO:67,ER:68,TM:69,YB:70,LU:71,HF:72,TA:73,W:74,RE:75,OS:76,IR:77,PT:78,AU:79,HG:80,TL:81,PB:82,BI:83,PO:84,AT:85,RN:86,FR:87,RA:88,AC:89,TH:90,PA:91,U:92,NP:93,PU:94,AM:95,CM:96,BK:97,CF:98,ES:99,FM:100,MD:101,NO:102,LR:103,RF:104,DB:105,SG:106,BH:107,HS:108,MT:109},xK={1:1.1,2:1.4,3:1.81,4:1.53,5:1.92,6:1.7,7:1.55,8:1.52,9:1.47,10:1.54,11:2.27,12:1.73,13:1.84,14:2.1,15:1.8,16:1.8,17:1.75,18:1.88,19:2.75,20:2.31,21:2.3,22:2.15,23:2.05,24:2.05,25:2.05,26:2.05,27:2,28:2,29:2,30:2.1,31:1.87,32:2.11,33:1.85,34:1.9,35:1.83,36:2.02,37:3.03,38:2.49,39:2.4,40:2.3,41:2.15,42:2.1,43:2.05,44:2.05,45:2,46:2.05,47:2.1,48:2.2,49:2.2,50:1.93,51:2.17,52:2.06,53:1.98,54:2.16,55:3.43,56:2.68,57:2.5,58:2.48,59:2.47,60:2.45,61:2.43,62:2.42,63:2.4,64:2.38,65:2.37,66:2.35,67:2.33,68:2.32,69:2.3,70:2.28,71:2.27,72:2.25,73:2.2,74:2.1,75:2.05,76:2,77:2,78:2.05,79:2.1,80:2.05,81:1.96,82:2.02,83:2.07,84:1.97,85:2.02,86:2.2,87:3.48,88:2.83,89:2,90:2.4,91:2,92:2.3,93:2,94:2,95:2,96:2,97:2,98:2,99:2,100:2,101:2,102:2,103:2,104:2,105:2,106:2,107:2,108:2,109:2},CK={1:1.008,2:4.0026,3:6.94,4:9.0122,5:10.81,6:10.81,7:14.007,8:15.999,9:18.998,10:20.18,11:22.99,12:24.305,13:26.982,14:28.085,15:30.974,16:32.06,17:35.45,18:39.948,19:39.098,20:40.078,21:44.956,22:47.867,23:50.942,24:51.996,25:54.938,26:55.845,27:58.933,28:58.693,29:63.546,30:65.38,31:69.723,32:72.63,33:74.922,34:78.971,35:79.904,36:83.798,37:85.468,38:87.62,39:88.906,40:91.224,41:92.906,42:95.95,43:96.906,44:101.07,45:102.91,46:106.42,47:107.87,48:112.41,49:114.82,50:118.71,51:121.76,52:127.6,53:127.6,54:131.29,55:132.91,56:137.33,57:138.91,58:140.12,59:140.91,60:144.24,61:144.912,62:150.36,63:151.96,64:157.25,65:158.93,66:162.5,67:164.93,68:167.26,69:168.93,70:173.05,71:174.97,72:178.49,73:180.95,74:183.84,75:186.21,76:190.23,77:192.22,78:195.08,79:196.97,80:200.59,81:204.38,82:207.2,83:208.98,84:1.97,85:2.02,86:2.2,87:3.48,88:2.83,89:2,90:232.04,91:231.04,92:238.03,93:237.048,94:244.064,95:243.061,96:247.07,97:247.07,98:251.079,99:252.083,100:257.095,101:258.098,102:259.101,103:262.11,104:267.122,105:270.131,106:271.134,107:270.133,108:270.134,109:278.156},_K=1.7,wK=10.81,AK=0;function Mv(e){var t=Ny[e];return t===void 0?_K:xK[t]}function PK(e){var t=Ny[e];return t===void 0?wK:CK[t]}function Dv(e){var t=Ny[e];return t===void 0?AK:t}function Gh(e,t){return t?t.length===1?oc(t.charCodeAt(0),e):t.length===2?oc(t.charCodeAt(0),oc(t.charCodeAt(1),e)):e+" "+t:e}function TK(e,t,r,n){if(e.has(t)){var a=e.get(t);a.has(r)||a.set(r,n)}else{var a=new Map;e.set(t,a),a.set(r,n)}}function EK(e){throw new Error("Missing entity entry for entity id '"+e+"'.")}function IK(e,t,r){return{entities:e,segments:r,label_seq_id:Je.ofSortedArray(t.residues.label_seq_id.toArray({array:Int32Array})),label_atom_id:t.atoms.label_atom_id,auth_atom_id:t.atoms.auth_atom_id,label_alt_id:t.atoms.label_alt_id,chain_index_entity_index:new Int32Array(t.chains._rowCount),entity_index_label_asym_id:new Map,chain_index_label_seq_id:new Map,auth_asym_id_auth_seq_id:new Map,chain_index_auth_seq_id:new Map,label_asym_id:new Map}}var Zp=Cx.EmptyResidueKey(),MK=function(){function e(t){this.map=t,this.entityIndex=t.entities.getEntityIndex,this.residueOffsets=this.map.segments.residueAtomSegments.offsets}return e.prototype.getEntityFromChain=function(t){return this.map.chain_index_entity_index[t]},e.prototype.findEntity=function(t){var r=this.map.label_asym_id.get(t);return r!==void 0?r:-1},e.prototype.findChainLabel=function(t){var r=this.entityIndex(t.label_entity_id);if(r<0||!this.map.entity_index_label_asym_id.has(r))return-1;var n=this.map.entity_index_label_asym_id.get(r);return n&&n.has(t.label_asym_id)?n.get(t.label_asym_id):-1},e.prototype.findChainAuth=function(t){if(!this.map.auth_asym_id_auth_seq_id.has(t.auth_asym_id))return-1;var r=this.map.auth_asym_id_auth_seq_id.get(t.auth_asym_id);return r.has(t.auth_seq_id)?r.get(t.auth_seq_id):-1},e.prototype.findResidue=function(t,r,n,a){var i;arguments.length===1?i=t:(Zp.label_entity_id=t,Zp.label_asym_id=r,Zp.auth_seq_id=n,Zp.pdbx_PDB_ins_code=a,i=Zp);var o=this.findChainLabel(i);if(o<0)return-1;var s=this.map.chain_index_auth_seq_id.get(o),u=Gh(i.auth_seq_id,i.pdbx_PDB_ins_code||"");return s.has(u)?s.get(u):-1},e.prototype.findResidueAuth=function(t){var r=this.findChainAuth(t);if(r<0)return-1;var n=this.map.chain_index_auth_seq_id.get(r),a=Gh(t.auth_seq_id,t.pdbx_PDB_ins_code||"");return n.has(a)?n.get(a):-1},e.prototype.findResidueInsertion=function(t){var r=this.findChainLabel(t);if(r<0)return-1;var n=this.map.chain_index_label_seq_id.get(r),a=Gh(t.label_seq_id,t.pdbx_PDB_ins_code||"");if(n.has(a))return n.get(a);var i=Je.findPredecessorIndex(this.map.label_seq_id,t.label_seq_id),o=Dd.chainStartResidueIndex(this.map.segments,r);if(i<o)return o;var s=Dd.chainEndResidueIndexExcl(this.map.segments,r)-1;return i>=s?s:i},e.prototype.findAtom=function(t){var r=this.findResidue(t);return r<0?-1:typeof t.label_alt_id=="undefined"?Fb(this.residueOffsets[r],this.residueOffsets[r+1],this.map.label_atom_id,t.label_atom_id):kb(this.residueOffsets[r],this.residueOffsets[r+1],this.map.label_atom_id,this.map.label_alt_id,t.label_atom_id,t.label_alt_id)},e.prototype.findAtomAuth=function(t){var r=this.findResidueAuth(t);return r<0?-1:typeof t.label_alt_id=="undefined"?Fb(this.residueOffsets[r],this.residueOffsets[r+1],this.map.auth_atom_id,t.auth_atom_id):kb(this.residueOffsets[r],this.residueOffsets[r+1],this.map.auth_atom_id,this.map.label_alt_id,t.auth_atom_id,t.label_alt_id)},e.prototype.findAtomOnResidue=function(t,r,n){return typeof n=="undefined"?Fb(this.residueOffsets[t],this.residueOffsets[t+1],this.map.label_atom_id,r):kb(this.residueOffsets[t],this.residueOffsets[t+1],this.map.label_atom_id,this.map.label_alt_id,r,n)},e.prototype.findAtomsOnResidue=function(t,r){return DK(this.residueOffsets[t],this.residueOffsets[t+1],this.map.label_atom_id,r)},e}();function Fb(e,t,r,n){for(var a=e;a<t;a++)if(r.value(a)===n)return a;return-1}function DK(e,t,r,n){for(var a=e;a<t;a++)if(n.has(r.value(a)))return a;return-1}function kb(e,t,r,n,a,i){for(var o=e;o<t;o++)if(r.value(o)===a&&n.value(o)===i)return o;return-1}function RK(e,t,r){for(var n=IK(t,e,r),a=e.residues,i=a.label_seq_id,o=a.auth_seq_id,s=a.pdbx_PDB_ins_code,u=e.chains,l=u.label_entity_id,c=u.label_asym_id,d=u.auth_asym_id,f=Ie.ofBounds(0,e.atoms._rowCount),p=nr.transientSegments(r.chainAtomSegments,f);p.hasNext;){var h=p.move(),v=h.index,m=t.getEntityIndex(l.value(v));m<0&&EK(l.value(v)),n.chain_index_entity_index[v]=m;var g=d.value(v),y=n.auth_asym_id_auth_seq_id.get(g);y||(y=new Map,n.auth_asym_id_auth_seq_id.set(g,y));var b=c.value(v);n.label_asym_id.has(b)||n.label_asym_id.set(b,m),TK(n.entity_index_label_asym_id,m,b,v);var x=new Map,S=new Map;n.chain_index_label_seq_id.set(v,x),n.chain_index_auth_seq_id.set(v,S);for(var _=nr.transientSegments(r.residueAtomSegments,f,h);_.hasNext;){var A=_.move(),T=A.index,I=o.value(T),M=s.value(T);x.set(Gh(i.value(T),M),T),S.set(Gh(I,M),T),y.set(I,v)}}return new MK(n)}var vi,mi,Mt={Blue:37052,Green:42577,Yellow:16765952,Orange:16021792,Pink:16162465,Purple:10830745,LightBlue:9424105,Brown:10582605,Red:15539236,Secondary:15854817};vi={},vi[0]="Hexose",vi[1]="HexNAc",vi[2]="Hexosamine",vi[3]="Hexuronate",vi[4]="Deoxyhexose",vi[5]="DeoxyhexNAc",vi[6]="Di-deoxyhexose",vi[7]="Pentose",vi[8]="Deoxynonulosonate",vi[9]="Di-deoxynonulosonate",vi[10]="Unknown",vi[11]="Assigned";var OK=(mi={},mi[0]=0,mi[1]=1,mi[2]=2,mi[3]=3,mi[4]=4,mi[5]=5,mi[6]=6,mi[7]=7,mi[8]=8,mi[9]=9,mi[10]=10,mi[11]=11,mi);function FK(e,t){return e===10?t===4?12:t===5?13:t===6?14:t===7?15:10:OK[e]}var s6={abbr:"Unk",name:"Unknown",color:Mt.Secondary,type:10},fg=[{abbr:"Glc",name:"Glucose",color:Mt.Blue,type:0},{abbr:"Man",name:"Mannose",color:Mt.Green,type:0},{abbr:"Gal",name:"Galactose",color:Mt.Yellow,type:0},{abbr:"Gul",name:"Gulose",color:Mt.Orange,type:0},{abbr:"Alt",name:"Altrose",color:Mt.Pink,type:0},{abbr:"All",name:"Allose",color:Mt.Purple,type:0},{abbr:"Tal",name:"Talose",color:Mt.LightBlue,type:0},{abbr:"Ido",name:"Idose",color:Mt.Brown,type:0},{abbr:"GlcNAc",name:"N-Acetyl Glucosamine",color:Mt.Blue,type:1},{abbr:"ManNAc",name:"N-Acetyl Mannosamine",color:Mt.Green,type:1},{abbr:"GalNAc",name:"N-Acetyl Galactosamine",color:Mt.Yellow,type:1},{abbr:"GulNAc",name:"N-Acetyl Gulosamine",color:Mt.Orange,type:1},{abbr:"AltNAc",name:"N-Acetyl Altrosamine",color:Mt.Pink,type:1},{abbr:"AllNAc",name:"N-Acetyl Allosamine",color:Mt.Purple,type:1},{abbr:"TalNAc",name:"N-Acetyl Talosamine",color:Mt.LightBlue,type:1},{abbr:"IdoNAc",name:"N-Acetyl Idosamine",color:Mt.Brown,type:1},{abbr:"GlcN",name:"Glucosamine",color:Mt.Blue,type:2},{abbr:"ManN",name:"Mannosamine",color:Mt.Green,type:2},{abbr:"GalN",name:"Galactosamine",color:Mt.Yellow,type:2},{abbr:"GulN",name:"Gulosamine",color:Mt.Orange,type:2},{abbr:"AltN",name:"Altrosamine",color:Mt.Pink,type:2},{abbr:"AllN",name:"Allosamine",color:Mt.Purple,type:2},{abbr:"TalN",name:"Talosamine",color:Mt.LightBlue,type:2},{abbr:"IdoN",name:"Idosamine",color:Mt.Brown,type:2},{abbr:"GlcA",name:"Glucuronic Acid",color:Mt.Blue,type:3},{abbr:"ManA",name:"Mannuronic Acid",color:Mt.Green,type:3},{abbr:"GalA",name:"Galacturonic Acid",color:Mt.Yellow,type:3},{abbr:"GulA",name:"Guluronic Acid",color:Mt.Orange,type:3},{abbr:"AltA",name:"Altruronic Acid",color:Mt.Pink,type:3},{abbr:"AllA",name:"Alluronic Acid",color:Mt.Purple,type:3},{abbr:"TalA",name:"Taluronic Acid",color:Mt.LightBlue,type:3},{abbr:"IdoA",name:"Iduronic Acid",color:Mt.Brown,type:3},{abbr:"Qui",name:"Quinovose",color:Mt.Blue,type:4},{abbr:"Rha",name:"Rhamnose",color:Mt.Green,type:4},{abbr:"6dGul",name:"6-Deoxy Gulose",color:Mt.Orange,type:4},{abbr:"6dAlt",name:"6-Deoxy Altrose",color:Mt.Pink,type:4},{abbr:"6dTal",name:"6-Deoxy Talose",color:Mt.LightBlue,type:4},{abbr:"Fuc",name:"Fucose",color:Mt.Red,type:4},{abbr:"QuiNAc",name:"N-Acetyl Quinovosamine",color:Mt.Blue,type:5},{abbr:"RhaNAc",name:"N-Acetyl Rhamnosamine",color:Mt.Green,type:5},{abbr:"6dAltNAc",name:"N-Acetyl 6-Deoxy Altrosamine",color:Mt.Pink,type:5},{abbr:"6dTalNAc",name:"N-Acetyl 6-Deoxy Talosamine",color:Mt.LightBlue,type:5},{abbr:"FucNAc",name:"N-Acetyl Fucosamine",color:Mt.Red,type:5},{abbr:"Oli",name:"Olivose",color:Mt.Blue,type:6},{abbr:"Tyv",name:"Tyvelose",color:Mt.Green,type:6},{abbr:"Abe",name:"Abequose",color:Mt.Orange,type:6},{abbr:"Par",name:"Paratose",color:Mt.Pink,type:6},{abbr:"Dig",name:"Digitoxose",color:Mt.Purple,type:6},{abbr:"Col",name:"Colitose",color:Mt.LightBlue,type:6},{abbr:"Ara",name:"Arabinose",color:Mt.Green,type:7},{abbr:"Lyx",name:"Lyxose",color:Mt.Yellow,type:7},{abbr:"Xyl",name:"Xylose",color:Mt.Orange,type:7},{abbr:"Rib",name:"Ribose",color:Mt.Pink,type:7},{abbr:"Kdn",name:"Keto-Deoxy Nonulonic Acid",color:Mt.Green,type:8},{abbr:"Neu5Ac",name:"N-Acetyl Neuraminic Acid",color:Mt.Purple,type:8},{abbr:"Neu5Gc",name:"N-Glycolyl Neuraminic Acid",color:Mt.LightBlue,type:8},{abbr:"Neu",name:"Neuraminic Acid",color:Mt.Brown,type:8},{abbr:"Sia",name:"Sialic acid",color:Mt.Red,type:8},{abbr:"Pse",name:"Pseudaminic Acid",color:Mt.Green,type:9},{abbr:"Leg",name:"Legionaminic Acid",color:Mt.Yellow,type:9},{abbr:"Aci",name:"Acinetaminic Acid",color:Mt.Pink,type:9},{abbr:"4eLeg",name:"4-Epilegionaminic Acid",color:Mt.LightBlue,type:9},{abbr:"Bac",name:"Bacillosamine",color:Mt.Blue,type:10},{abbr:"LDmanHep",name:"L-Glycero-D-Manno Heptose",color:Mt.Green,type:10},{abbr:"Kdo",name:"Keto-Deoxy Octulonic Acid",color:Mt.Yellow,type:10},{abbr:"Dha",name:"3-Deoxy Lyxo-Heptulosaric Acid",color:Mt.Orange,type:10},{abbr:"DDmanHep",name:"D-Glycero-D-Manno-Heptose",color:Mt.Pink,type:10},{abbr:"MurNAc",name:"N-Acetyl Muramic Acid",color:Mt.Purple,type:10},{abbr:"MurNGc",name:"N-Glycolyl Muramic Acid",color:Mt.LightBlue,type:10},{abbr:"Mur",name:"Muramic Acid",color:Mt.Brown,type:10},{abbr:"Api",name:"Apicose",color:Mt.Green,type:11},{abbr:"Fru",name:"Fructose",color:Mt.Green,type:11},{abbr:"Tag",name:"Tagatose",color:Mt.Yellow,type:11},{abbr:"Sor",name:"Sorbose",color:Mt.Orange,type:11},{abbr:"Psi",name:"Psicose",color:Mt.Pink,type:11}],kK=function(){for(var e=new Map,t=0,r=fg.length;t<r;++t){var n=fg[t];e.set(n.abbr,n)}return e}(),BK=[["Glc-family",Mt.Blue],["Man-family",Mt.Green],["Gal-family",Mt.Yellow],["Gul-family",Mt.Orange],["Alt-family",Mt.Pink],["All-family",Mt.Purple],["Tal-family",Mt.LightBlue],["Ido-family",Mt.Brown],["Fuc-family",Mt.Red],["Generic/Unknown/Secondary",Mt.Secondary]],LK={Glc:["GLC","BGC","Z8T","TRE","MLR"],Man:["MAN","BMA"],Gal:["GLA","GAL","GZL","GXL","GIV"],Gul:["4GL","GL0","GUP","Z8H"],Alt:["Z6H","3MK","SHD"],All:["AFD","ALL","WOO","Z2D"],Tal:["ZEE","A5C","SDY"],Ido:["ZCD","Z0F","4N2"],GlcNAc:["NDG","NAG","NGZ"],ManNAc:["BM3","BM7"],GalNAc:["A2G","NGA","YYQ"],GulNAc:["LXB"],AltNAc:[],AllNAc:["NAA"],TalNAc:[],IdoNAc:["LXZ","HSQ"],GlcN:["PA1","GCS"],ManN:["95Z"],GalN:["X6X","1GN"],GulN:[],AltN:[],AllN:[],TalN:[],IdoN:[],GlcA:["GCU","BDP"],ManA:["MAV","BEM"],GalA:["ADA","GTR","GTK"],GulA:["LGU"],AltA:[],AllA:[],TalA:["X1X","X0X"],IdoA:["IDR"],Qui:["G6D","YYK"],Rha:["RAM","RM4","XXR"],"6dGul":["66O"],"6dAlt":[],"6dTal":[],Fuc:["FUC","FUL","FCA","FCB","GYE"],QuiNAc:["Z9W"],RhaNAc:[],"6dAltNAc":[],"6dTalNAc":[],FucNAc:["49T"],Oli:["DDA","RAE","Z5J"],Tyv:["TYV"],Abe:["ABE"],Par:["PZU"],Dig:["Z3U"],Col:[],Ara:["64K","ARA","ARB","AHR","FUB","BXY","BXX","SEJ"],Lyx:["LDY","Z4W"],Xyl:["XYS","XYP","XYZ","HSY","LXC"],Rib:["YYM","RIP","RIB","BDR","0MK","Z6J","32O"],Kdn:["KDM","KDN"],Neu5Ac:["SIA","SLB"],Neu5Gc:["NGC","NGE"],Neu:[],Sia:[],Pse:[],Leg:[],Aci:[],"4eLeg":[],Bac:[],LDmanHep:["GMH"],Kdo:["KDO"],Dha:[],DDmanHep:["289"],MurNAc:["MUB","AMU"],MurNGc:[],Mur:["1S4","MUR"],Api:["XXM"],Fru:["BDF","Z9N","FRU","LFR"],Tag:["T6T"],Sor:["SOE","UEA"],Psi:["PSV","SF6","SF9","TTV"]},wP=["NGZ","LAT","PUF","GDA","9WJ"],bd=function(){for(var e=new Map,t=0,r=fg.length;t<r;++t){var n=fg[t],a=LK[n.abbr];if(a)for(var i=0,o=a.length;i<o;++i)e.set(a[i],n)}for(var t=0,r=wP.length;t<r;++t)e.set(wP[t],s6);return e}(),jn;(function(e){function t(p){return E_(p.values())}e.toArray=t;function r(p,h){var v=!0;return h.forEach(function(m){p.has(m)||(v=!1)}),v}e.isSuperset=r;function n(p){for(var h=[],v=1;v<arguments.length;v++)h[v-1]=arguments[v];for(var m=0;m<h.length;m++)h[m].forEach(function(g){return p.add(g)});return p}e.add=n;function a(p,h){var v=new Set(p);return h.forEach(function(m){return v.add(m)}),v}e.union=a;function i(){for(var p=[],h=0;h<arguments.length;h++)p[h]=arguments[h];if(p.length===0)return new Set;p.length===1&&new Set(p[0]);for(var v=new Set(p[0]),m=1,g=p.length;m<g;m++)p[m].forEach(function(y){return v.add(y)});return v}e.unionMany=i;function o(p){if(p.length===0)return new Set;for(var h=new Set(p[0]),v=1;v<p.length;v++)for(var m=0,g=p[v];m<g.length;m++){var y=g[m];h.add(y)}return h}e.unionManyArrays=o;function s(p,h){var v=new Set;return h.forEach(function(m){p.has(m)&&v.add(m)}),v}e.intersection=s;function u(p,h){var v=!1;return h.forEach(function(m){p.has(m)&&(v=!0)}),v}e.areIntersecting=u;function l(p,h){var v=0;return h.forEach(function(m){p.has(m)&&(v+=1)}),v}e.intersectionSize=l;function c(p,h){var v=new Set(p);return h.forEach(function(m){return v.delete(m)}),v}e.difference=c;function d(p,h){var v=p.size;return p.forEach(function(m){h.has(m)&&(v-=1)}),v}e.differenceSize=d;function f(p,h){if(p.size!==h.size)return!1;var v=!0;return h.forEach(function(m){p.has(m)||(v=!1)}),v}e.areEqual=f})(jn||(jn={}));var u6=new Set(["DAPC","DBPC","DFPC","DGPC","DIPC","DLPC","DNPC","DOPC","DPPC","DRPC","DTPC","DVPC","DXPC","DYPC","LPPC","PAPC","PEPC","PGPC","PIPC","POPC","PRPC","PUPC","DAPE","DBPE","DFPE","DGPE","DIPE","DLPE","DNPE","DOPE","DPPE","DRPE","DTPE","DUPE","DVPE","DXPE","DYPE","LPPE","PAPE","PGPE","PIPE","POPE","PQPE","PRPE","PUPE","DAPS","DBPS","DFPS","DGPS","DIPS","DLPS","DNPS","DOPS","DPPS","DRPS","DTPS","DUPS","DVPS","DXPS","DYPS","LPPS","PAPS","PGPS","PIPS","POPS","PQPS","PRPS","PUPS","DAPG","DBPG","DFPG","DGPG","DIPG","DLPG","DNPG","DOPG","DPPG","DRPG","DTPG","DVPG","DXPG","DYPG","LPPG","PAPG","PGPG","PIPG","POPG","PRPG","DAPA","DBPA","DFPA","DGPA","DIPA","DLPA","DNPA","DOPA","DPPA","DRPA","DTPA","DVPA","DXPA","DYPA","LPPA","PAPA","PGPA","PIPA","POPA","PRPA","PUPA","DPP","DPPI","PAPI","PIPI","POP","POPI","PUPI","PVP","PVPI","PADG","PIDG","PODG","PUDG","PVDG","APC","CPC","IPC","LPC","OPC","PPC","TPC","UPC","VPC","BNSM","DBSM","DPSM","DXSM","PGSM","PNSM","POSM","PVSM","XNSM","DPCE","DXCE","PNCE","XNCE","DMPC"]),l6=new Set(["118","119","543","1AL","1CU","2FK","2HP","2OF","3CO","3MT","3NI","3OF","3P8","4MO","4PU","4TI","6MO","ACT","AG","AL","ALF","AM","ATH","AU","AU3","AUC","AZI","BA","BCT","BEF","BF4","BO4","BR","BS3","BSY","CA","CAC","CD","CD1","CD3","CD5","CE","CF","CHT","CL","CO","CO3","CO5","CON","CR","CS","CSB","CU","CU1","CU3","CUA","CUZ","CYN","DME","DMI","DSC","DTI","DY","E4N","EDR","EMC","ER3","EU","EU3","F","FE","FE2","FPO","GA","GD3","GEP","HAI","HG","HGC","IN","IOD","IR","IR3","IRI","IUM","K","KO4","LA","LCO","LCP","LI","LU","MAC","MG","MH2","MH3","MLI","MMC","MN","MN3","MN5","MN6","MO1","MO2","MO3","MO4","MO5","MO6","MOO","MOS","MOW","MW1","MW2","MW3","NA","NA2","NA5","NA6","NAO","NAW","NET","NH4","NI","NI1","NI2","NI3","NO2","NO3","NRU","O4M","OAA","OC1","OC2","OC3","OC4","OC5","OC6","OC7","OC8","OCL","OCM","OCN","OCO","OF1","OF2","OF3","OH","OS","OS4","OXL","PB","PBM","PD","PDV","PER","PI","PO3","PO4","PR","PT","PT4","PTN","RB","RH3","RHD","RU","SB","SCN","SE4","SEK","SM","SMO","SO3","SO4","SR","T1A","TB","TBA","TCN","TEA","TH","THE","TL","TMA","TRA","UNX","V","VN3","VO4","W","WO5","Y1","YB","YB2","YH","YT3","ZCM","ZN","ZN2","ZN3","ZNO","ZO3","ZR","NCO","OHX"]),au,NK=function(){for(var e=Object.create(null),t=[],r="A".charCodeAt(0);r<="Z".charCodeAt(0);r++)t[t.length]=String.fromCharCode(r);for(var r="a".charCodeAt(0);r<="z".charCodeAt(0);r++)t[t.length]=String.fromCharCode(r);for(var r="0".charCodeAt(0);r<="9".charCodeAt(0);r++)t[t.length]=String.fromCharCode(r);for(var n=0,a=t;n<a.length;n++){var i=a[n];e[i]=i.toUpperCase();for(var o=0,s=t;o<s.length;o++){var u=s[o];e[i+u]=(i+u).toUpperCase();for(var l=0,c=t;l<c.length;l++){var d=c[l];e[i+u+d]=(i+u+d).toUpperCase()}}}return e}();function Ep(e){return NK[e]||e.toUpperCase()}var AP=new Map([[1,"H"],[2,"He"],[3,"Li"],[4,"Be"],[5,"B"],[6,"C"],[7,"N"],[8,"O"],[9,"F"],[10,"Ne"],[11,"Na"],[12,"Mg"],[13,"Al"],[14,"Si"],[15,"P"],[16,"S"],[17,"Cl"],[18,"Ar"],[19,"K"],[20,"Ca"],[21,"Sc"],[22,"Ti"],[23,"V"],[24,"Cr"],[25,"Mn"],[26,"Fe"],[27,"Co"],[28,"Ni"],[29,"Cu"],[30,"Zn"],[31,"Ga"],[32,"Ge"],[33,"As"],[34,"Se"],[35,"Br"],[36,"Kr"],[37,"Rb"],[38,"Sr"],[39,"Y"],[40,"Zr"],[41,"Nb"],[42,"Mo"],[43,"Tc"],[44,"Ru"],[45,"Rh"],[46,"Pd"],[47,"Ag"],[48,"Cd"],[49,"In"],[50,"Sn"],[51,"Sb"],[52,"Te"],[53,"I"],[54,"Xe"],[55,"Cs"],[56,"Ba"],[57,"La"],[58,"Ce"],[59,"Pr"],[60,"Nd"],[61,"Pm"],[62,"Sm"],[63,"Eu"],[64,"Gd"],[65,"Tb"],[66,"Dy"],[67,"Ho"],[68,"Er"],[69,"Tm"],[70,"Yb"],[71,"Lu"],[72,"Hf"],[73,"Ta"],[74,"W"],[75,"Re"],[76,"Os"],[77,"Ir"],[78,"Pt"],[79,"Au"],[80,"Hg"],[81,"Tl"],[82,"Pb"],[83,"Bi"],[84,"Po"],[85,"At"],[86,"Rn"],[87,"Fr"],[88,"Ra"],[89,"Ac"],[90,"Th"],[91,"Pa"],[92,"U"],[93,"Np"],[94,"Pu"],[95,"Am"],[96,"Cm"],[97,"Bk"],[98,"Cf"],[99,"Es"],[100,"Fm"],[101,"Md"],[102,"No"],[103,"Lr"],[104,"Rf"],[105,"Db"],[106,"Sg"],[107,"Bh"],[108,"Hs"],[109,"Mt"],[110,"Ds"],[111,"Rg"],[112,"Cn"],[113,"Uut"],[114,"Fl"],[115,"Uup"],[116,"Lv"],[117,"Uus"],[118,"Uuo"]].map(function(e){return[e[0],Ep(e[1])]}));function UK(e){return AP.has(e)?AP.get(e):Ep("H")}var zK=(au={},au[0]={trace:new Set,directionFrom:new Set,directionTo:new Set,backboneStart:new Set,backboneEnd:new Set,coarseBackbone:new Set},au[1]={trace:new Set(["CA"]),directionFrom:new Set(["C"]),directionTo:new Set(["O","OC1","O1","OX1","OXT","OT1"]),backboneStart:new Set(["N"]),backboneEnd:new Set(["C"]),coarseBackbone:new Set(["CA","BB","CA1"])},au[2]={trace:new Set(["CA"]),directionFrom:new Set(["C"]),directionTo:new Set(["O"]),backboneStart:new Set(["N"]),backboneEnd:new Set(["CD"]),coarseBackbone:new Set(["CA"])},au[3]={trace:new Set(["CA"]),directionFrom:new Set(["C"]),directionTo:new Set(["O"]),backboneStart:new Set(["N"]),backboneEnd:new Set(["CG"]),coarseBackbone:new Set(["CA"])},au[4]={trace:new Set(["O3'","O3*"]),directionFrom:new Set(["C4'","C4*"]),directionTo:new Set(["C3'","C3*"]),backboneStart:new Set(["P"]),backboneEnd:new Set(["O3'","O3*"]),coarseBackbone:new Set(["P"])},au[5]={trace:new Set(["O3'","O3*"]),directionFrom:new Set(["C3'","C3*"]),directionTo:new Set(["C1'","C1*"]),backboneStart:new Set(["P"]),backboneEnd:new Set(["O3'","O3*"]),coarseBackbone:new Set(["P"])},au[6]={trace:new Set(["N4'","N4*"]),directionFrom:new Set(["N4'","N4*"]),directionTo:new Set(["C7'","C7*"]),backboneStart:new Set(["N1'","N1*"]),backboneEnd:new Set(["C'","C*"]),coarseBackbone:new Set(["P"])},au),Hu=new Set(["CA","C","N","O","O1","O2","OC1","OC2","OT1","OT2","OX1","OXT","H","H1","H2","H3","HA","HN","HXT","BB"]),Uy=new Set(["P","OP1","OP2","HOP2","HOP3","O2'","O3'","O4'","O5'","C1'","C2'","C3'","C4'","C5'","H1'","H2'","H2''","HO2'","H3'","H4'","H5'","H5''","HO3'","HO5'","O2*","O3*","O4*","O5*","C1*","C2*","C3*","C4*","C5*"]),c6=new Set(["D-PEPTIDE LINKING","D-PEPTIDE NH3 AMINO TERMINUS","D-PEPTIDE COOH CARBOXY TERMINUS","D-GAMMA-PEPTIDE, C-DELTA LINKING","D-BETA-PEPTIDE, C-GAMMA LINKING"]),d6=new Set(["L-PEPTIDE LINKING","L-PEPTIDE NH3 AMINO TERMINUS","L-PEPTIDE COOH CARBOXY TERMINUS","L-GAMMA-PEPTIDE, C-DELTA LINKING","L-BETA-PEPTIDE, C-GAMMA LINKING"]),VK=new Set(["D-GAMMA-PEPTIDE, C-DELTA LINKING","L-GAMMA-PEPTIDE, C-DELTA LINKING"]),HK=new Set(["D-BETA-PEPTIDE, C-GAMMA LINKING","L-BETA-PEPTIDE, C-GAMMA LINKING"]),GK=new Set(["D-PEPTIDE NH3 AMINO TERMINUS","D-PEPTIDE COOH CARBOXY TERMINUS","L-PEPTIDE NH3 AMINO TERMINUS","L-PEPTIDE COOH CARBOXY TERMINUS"]),f6=new Set(["PEPTIDE LINKING","PEPTIDE-LIKE"]),qK=jn.unionMany(c6,d6,f6),p6=new Set(["DNA LINKING","L-DNA LINKING","DNA OH 5 PRIME TERMINUS","DNA OH 3 PRIME TERMINUS"]),h6=new Set(["RNA LINKING","L-RNA LINKING","RNA OH 5 PRIME TERMINUS","RNA OH 3 PRIME TERMINUS"]),v6=new Set(["D-SACCHARIDE, BETA LINKING","L-SACCHARIDE, BETA LINKING","D-SACCHARIDE, ALPHA LINKING","L-SACCHARIDE, ALPHA LINKING","L-SACCHARIDE","D-SACCHARIDE","SACCHARIDE","D-SACCHARIDE 1,4 AND 1,4 LINKING","L-SACCHARIDE 1,4 AND 1,4 LINKING","D-SACCHARIDE 1,4 AND 1,6 LINKING","L-SACCHARIDE 1,4 AND 1,6 LINKING"]),jK=new Set(["NON-POLYMER","OTHER"]),WK=new Set(["ION"]),XK=new Set(["LIPID"]),zy=new Set(["SOL","WAT","HOH","H2O","W","DOD","D3O","TIP","TIP3","TIP4","SPC"]),J_=new Set(["HIS","ARG","LYS","ILE","PHE","LEU","TRP","ALA","MET","PRO","CYS","ASN","VAL","GLY","SER","GLN","TYR","ASP","GLU","THR","SEC","PYL","UNK","MSE","SEP","TPO","PTR","PCA","HSD","HSE","HSP","LSN","ASPP","GLUP","HID","HIE","HIP","LYN","ASH","GLH"]),m6=new Set(["DAL","DAR","DSG","DAS","DCY","DGL","DGN","DHI","DIL","DLE","DLY","MED","DPN","DPR","DSN","DTH","DTR","DTY","DVA","DNE"]),Vy=jn.unionMany(J_,m6),Hy=new Set(["A","C","T","G","I","U","N"]),Gy=new Set(["DA","DC","DT","DG","DI","DU","DN"]),e3=new Set(["APN","CPN","TPN","GPN"]),YK=new Set(["A","G","I","DA","DG","DI","APN","GPN"]),KK=new Set(["C","T","U","DC","DT","DU","CPN","TPN"]),qy=jn.unionMany(Hy,Gy,e3),g6=function(e){return YK.has(e.toUpperCase())},y6=function(e){return KK.has(e.toUpperCase())},Rv=jn.unionMany(Vy,qy);function Ip(e,t){return e=e.toUpperCase(),t=t.toUpperCase(),e3.has(t)?8:qK.has(e)?5:h6.has(e)?6:p6.has(e)?7:v6.has(e)?9:zy.has(t)?2:l6.has(t)?3:u6.has(t)?4:jK.has(e)?bd.has(t)?9:1:0}function $K(e,t){return e=e.toUpperCase(),t===5?VK.has(e)?2:HK.has(e)?3:GK.has(e)?0:1:t===6?4:t===7?5:t===8?6:0}function b6(e){return e=e.toUpperCase(),Vy.has(e)?"peptide linking":Hy.has(e)?"RNA linking":Gy.has(e)?"DNA linking":bd.has(e)?"saccharide":"other"}function QK(e){return{formula:"",formula_weight:0,id:e,name:e,mon_nstd_flag:Rv.has(e)?"y":"n",pdbx_synonyms:[],type:b6(e)}}function ZK(e){return e=e.toUpperCase(),zy.has(e)?"water":Rv.has(e)?"polymer":bd.has(e)?"branched":"non-polymer"}function JK(e,t){return e=e.toUpperCase(),t=t.toUpperCase(),d6.has(t)?"polypeptide(L)":c6.has(t)?"polypeptide(D)":h6.has(t)?"polyribonucleotide":p6.has(t)?"polydeoxyribonucleotide":v6.has(t)||bd.has(e)?"oligosaccharide":e3.has(e)?"peptide nucleic acid":J_.has(e)?"polypeptide(L)":m6.has(e)?"polypeptide(D)":Hy.has(e)?"polyribonucleotide":Gy.has(e)?"polydeoxyribonucleotide":WK.has(t)||l6.has(e)?"ion":XK.has(t)||u6.has(e)?"lipid":f6.has(t)?"peptide-like":"other"}function t3(e){return $s(e)||S6(e)}function $s(e){return e===7||e===6||e===8}function S6(e){return e===5}var Fr;(function(e){e.is=ka.has,e.create=ka.create,e.SecondaryStructureMmcif={HELX_LH_27_P:1058,HELX_LH_3T_P:2082,HELX_LH_AL_P:4130,HELX_LH_A_N:524321,HELX_LH_B_N:1048609,HELX_LH_GA_P:8226,HELX_LH_N:33,HELX_LH_OM_P:16418,HELX_LH_OT_N:131105,HELX_LH_OT_P:546,HELX_LH_P:34,HELX_LH_PI_P:32802,HELX_LH_PP_P:65570,HELX_LH_Z_N:262177,HELX_N:1,HELX_OT_N:1,HELX_OT_P:2,HELX_P:2,HELX_RH_27_P:1090,HELX_RH_3T_P:2114,HELX_RH_AL_P:4162,HELX_RH_A_N:524353,HELX_RH_B_N:1048641,HELX_RH_GA_P:8258,HELX_RH_N:65,HELX_RH_OM_P:16450,HELX_RH_OT_N:131137,HELX_RH_OT_P:578,HELX_RH_P:66,HELX_RH_PI_P:32834,HELX_RH_PP_P:65602,HELX_RH_Z_N:262209,STRN:4194308,TURN_OT_P:33554448,TURN_P:16,TURN_TY1P_P:67109136,TURN_TY1_P:67109008,TURN_TY2P_P:134218e3,TURN_TY2_P:134217872,TURN_TY3P_P:268435728,TURN_TY3_P:268435600},e.SecondaryStructurePdb={1:4162,2:16450,3:32834,4:8258,5:2114,6:4130,7:16418,8:8226,9:1026,10:65538},e.SecondaryStructureStride={H:4098,G:2050,I:32770,E:8388612,B:4194308,T:16,C:536870912},e.SecondaryStructureDssp={H:4098,B:4194308,E:8388612,G:2050,I:32770,T:16,S:8}})(Fr||(Fr={}));var kr;(function(e){e.is=ka.has;function t(s){return ka.create(s)}e.create=t;function r(s){return(s&1)!==0}e.isCovalent=r;function n(s){return s===Math.pow(2,6)-1}e.isAll=n,e.Names={covalent:1,"metal-coordination":2,"hydrogen-bond":4,disulfide:8,aromatic:16,computed:32};function a(s){return s in e.Names}e.isName=a;function i(s){switch(s){case"covalent":return 1;case"metal-coordination":return 2;case"hydrogen-bond":return 4;case"disulfide":return 8;case"aromatic":return 16;case"computed":return 32}}e.fromName=i;function o(s){for(var u=0,l=0,c=s.length;l<c;++l)u|=i(s[l]);return u}e.fromNames=o})(kr||(kr={}));var _x={ALA:[.17,.5,.33],ARG:[.81,1.81,1],ASN:[.42,.85,.43],ASP:[1.23,3.64,2.41],ASH:[-.07,.43,.5],CYS:[-.24,-.02,.22],GLN:[.58,.77,.19],GLU:[2.02,3.63,1.61],GLH:[-.01,.11,.12],GLY:[.01,1.15,1.14],HIS:[.17,.11,-.06],ILE:[-.31,-1.12,-.81],LEU:[-.56,-1.25,-.69],LYS:[.99,2.8,1.81],MET:[-.23,-.67,-.44],PHE:[-1.13,-1.71,-.58],PRO:[.45,.14,-.31],SER:[.13,.46,.33],THR:[.14,.25,.11],TRP:[-1.85,-2.09,-.24],TYR:[-.94,-.71,.23],VAL:[.07,-.46,-.53],HSD:[.17,.11,-.06],HSE:[.17,.11,-.06],HSP:[.96,2.33,1.37],HID:[.17,.11,-.06],HIE:[.17,.11,-.06],HIP:[.96,2.33,1.37]};function e$(e,t){var r=e.coarseElements.entityKey[t],n=e.model.sequence.byEntityKey[r].sequence,a=e.coarseElements.seq_id_begin.value(t);return n.compId.value(a-1)}function r3(e,t){switch(e.kind){case 0:return e.model.atomicHierarchy.derived.residue.moleculeType[e.residueIndex[t]];case 1:case 2:var r=e$(e,t),n=e.model.properties.chemicalComponentMap.get(r);if(n)return Ip(n.type,r)}return 0}var t$=new Set;function rc(e,t){var r=zK[e];if(r!==void 0){var n=r[t];if(n!==void 0)return n}return t$}var PP=C.zero();function x6(e,t){for(var r=e.conformation.position,n=new Float32Array(t.length*3),a=e.elements,i=0,o=t.length;i<o;++i)r(a[t[i]],PP),C.toArray(PP,n,i*3);return n}function r$(e,t,r,n){for(var a=e.atoms,i=a.label_comp_id,o=a.type_symbol,s=a._rowCount,u=e.residues._rowCount,l=t.residueAtomSegments.offsets,c=new Uint8Array(s),d=0;d<s;++d)c[d]=Dv(o.value(d));for(var f=new Int32Array(u),p=new Int32Array(u),h=new Int32Array(u),v=new Uint8Array(u),m=new Uint8Array(u),g=new Map,y=new Map,d=0;d<u;++d){var b=i.value(l[d]),x=n,S=void 0,_=void 0;if(g.has(b))S=g.get(b),_=y.get(b);else{var A=void 0;x.has(b)?A=x.get(b).type:(Pp||console.info("chemComp not found",b),A=b6(b)),S=Ip(A,b),_=$K(A,S),g.set(b,S),y.set(b,_)}v[d]=S,m[d]=_;var T=rc(_,"trace"),I=r.findAtomsOnResidue(d,T);if(I===-1){var M=rc(_,"coarseBackbone");I=r.findAtomsOnResidue(d,M)}f[d]=I;var O=rc(_,"directionFrom");p[d]=r.findAtomsOnResidue(d,O);var D=rc(_,"directionTo");h[d]=r.findAtomsOnResidue(d,D)}return{atom:{atomicNumber:c},residue:{traceElementIndex:f,directionFromElementIndex:p,directionToElementIndex:h,moleculeType:v,polymerType:m}}}function Jf(e,t,r){for(var n=new Float32Array(e),a=0;a<n.length;a++)n[a]=t+r*a;return n}var dn;(function(e){e.DefaultName="1_555",e.Default=t(e.DefaultName,ue.identity()),e.RotationTranslationEpsilon=.005;function t(h,v,m){var g=m||{},y=g.assembly,b=g.ncsId,x=g.hkl,S=g.spgrOp,_=x?C.clone(x):C();S=ia(S,-1),b=b||-1;var A=r(m);if(ue.isIdentity(v))return{name:h,assembly:y,matrix:v,inverse:ue.identity(),isIdentity:!0,hkl:_,spgrOp:S,ncsId:b,suffix:A};if(!ue.isRotationAndTranslation(v,e.RotationTranslationEpsilon))throw new Error("Symmetry operator ("+h+") must be a composition of rotation and translation.");return{name:h,assembly:y,matrix:v,inverse:ue.invert(ue(),v),isIdentity:!1,hkl:_,spgrOp:S,ncsId:b,suffix:A}}e.create=t;function r(h){if(!h)return"";if(h.assembly)return"_"+h.assembly.operId;if(typeof h.spgrOp!="undefined"&&typeof h.hkl!="undefined"&&h.spgrOp!==-1){var v=h.hkl,m=v[0],g=v[1],y=v[2];return"-"+(h.spgrOp+1)+"_"+(5+m)+(5+g)+(5+y)}return h.ncsId!==-1?"_"+h.ncsId:""}function n(h,v){for(var m=ue.identity(),g=0;g<3;g++)for(var y=0;y<3;y++)ue.setValue(m,g,y,Mn.getValue(h,g,y));return ue.setTranslation(m,v),ue.isRotationAndTranslation(m,e.RotationTranslationEpsilon)}e.checkIfRotationAndTranslation=n;function a(h,v,m,g){for(var y=ue.identity(),b=0;b<3;b++)for(var x=0;x<3;x++)ue.setValue(y,b,x,Mn.getValue(v,b,x));return ue.setTranslation(y,m),t(h,y,{ncsId:g})}e.ofRotationAndOffset=a;var i=In.identity(),o=In(),s=In(),u=C();function l(h,v,m){var g=v.inverse;if(v.isIdentity)return ue.copy(h,g);var y=1-m;ue.getRotation(o,g),In.slerp(o,i,o,y);var b=In.getAxisAngle(u,o);return ue.fromRotation(h,b,u),ue.setValue(h,0,3,y*ue.getValue(g,0,3)),ue.setValue(h,1,3,y*ue.getValue(g,1,3)),ue.setValue(h,2,3,y*ue.getValue(g,2,3)),h}e.lerpFromIdentity=l;function c(h,v,m,g){if(Math.abs(g)<=1e-5)return ue.copy(h,v);if(Math.abs(g-1)<=1e-5)return ue.copy(h,m);ue.getRotation(o,v),ue.getRotation(s,m),In.slerp(s,o,s,g);var y=In.getAxisAngle(u,s);return ue.fromRotation(h,y,u),ue.setValue(h,0,3,Gi(ue.getValue(v,0,3),ue.getValue(m,0,3),g)),ue.setValue(h,1,3,Gi(ue.getValue(v,1,3),ue.getValue(m,1,3),g)),ue.setValue(h,2,3,Gi(ue.getValue(v,2,3),ue.getValue(m,2,3),g)),h}e.slerp=c;function d(h,v){var m=ue.mul(ue(),v.matrix,h.matrix);return t(v.name,m,v)}e.compose=d;function f(h,v,m){var g=e.createCoordinateMapper(e.Default,v),y=h.isIdentity?g:e.createCoordinateMapper(h,v),b=a$(h,v),x=b.x,S=b.y,_=b.z;return{operator:h,coordinates:v,invariantPosition:g,position:y,x,y:S,z:_,r:m||n$}}e.createMapping=f;function p(h,v){return h.isIdentity?u$(v):l$(h,v)}e.createCoordinateMapper=p})(dn||(dn={}));function n$(e){return 0}function a$(e,t){return e.isIdentity?{x:Bb(t.x),y:Bb(t.y),z:Bb(t.z)}:{x:i$(e,t),y:o$(e,t),z:s$(e,t)}}function Bb(e){return function(r){return e[r]}}function jy(e){return e[3]===0&&e[7]===0&&e[11]===0&&e[15]===1}function i$(e,t){var r=e.matrix,n=t.x,a=t.y,i=t.z,o=r[0],s=r[4],u=r[8],l=r[12];return jy(r)?function(d){return o*n[d]+s*a[d]+u*i[d]+l}:function(d){var f=n[d],p=a[d],h=i[d],v=r[3]*f+r[7]*p+r[11]*h+r[15]||1;return(o*f+s*p+u*h+l)/v}}function o$(e,t){var r=e.matrix,n=t.x,a=t.y,i=t.z,o=r[1],s=r[5],u=r[9],l=r[13];return jy(r)?function(d){return o*n[d]+s*a[d]+u*i[d]+l}:function(d){var f=n[d],p=a[d],h=i[d],v=r[3]*f+r[7]*p+r[11]*h+r[15]||1;return(o*f+s*p+u*h+l)/v}}function s$(e,t){var r=e.matrix,n=t.x,a=t.y,i=t.z,o=r[2],s=r[6],u=r[10],l=r[14];return jy(r)?function(d){return o*n[d]+s*a[d]+u*i[d]+l}:function(d){var f=n[d],p=a[d],h=i[d],v=r[3]*f+r[7]*p+r[11]*h+r[15]||1;return(o*f+s*p+u*h+l)/v}}function u$(e){var t=e.x,r=e.y,n=e.z;return function(i,o){return o[0]=t[i],o[1]=r[i],o[2]=n[i],o}}function l$(e,t){var r=e.matrix,n=t.x,a=t.y,i=t.z;return jy(r)?function(s,u){var l=n[s],c=a[s],d=i[s];return u[0]=r[0]*l+r[4]*c+r[8]*d+r[12],u[1]=r[1]*l+r[5]*c+r[9]*d+r[13],u[2]=r[2]*l+r[6]*c+r[10]*d+r[14],u}:function(s,u){return u[0]=n[s],u[1]=a[s],u[2]=i[s],C.transformMat4(u,u,r),u}}var Lb=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[-1,0,0,0],[0,-1,0,0],[0,0,-1,0],[0,1,0,.5],[1,0,0,.5],[-1,0,0,.5],[0,0,1,.5],[0,-1,0,.5],[0,0,-1,.5],[1,0,0,.25],[0,-1,0,.25],[0,0,1,.25],[-1,0,0,.25],[0,1,0,.25],[0,-1,0,.75],[0,0,1,.75],[0,1,0,.75],[1,0,0,.75],[-1,0,0,.75],[0,0,-1,.25],[0,0,-1,.75],[1,-1,0,0],[-1,1,0,0],[0,0,1,1/3],[0,0,1,2/3],[1,0,0,2/3],[0,1,0,1/3],[0,-1,0,2/3],[1,-1,0,1/3],[-1,1,0,2/3],[-1,0,0,1/3],[1,0,0,1/3],[0,1,0,2/3],[0,-1,0,1/3],[1,-1,0,2/3],[-1,1,0,1/3],[-1,0,0,2/3],[0,0,-1,1/3],[0,0,-1,2/3],[0,0,1,5/6],[0,0,1,1/6],[0,0,-1,5/6],[0,0,-1,1/6]],c$=[[0,1,2],[3,4,5],[3,1,5],[3,6,5],[7,6,2],[8,6,5],[0,4,2],[0,4,9],[7,10,2],[7,10,9],[0,10,2],[8,10,5],[3,1,11],[3,6,11],[0,10,9],[8,6,11],[3,4,2],[0,4,5],[3,4,9],[7,10,5],[8,4,9],[8,10,9],[8,10,2],[0,6,9],[3,10,9],[0,10,11],[7,1,9],[8,1,11],[7,4,11],[7,6,9],[7,10,11],[3,10,2],[8,1,5],[0,4,11],[3,1,2],[3,1,9],[7,4,2],[8,1,2],[8,1,9],[3,6,9],[7,4,9],[8,6,2],[8,6,9],[3,6,2],[12,13,14],[15,16,14],[12,17,18],[15,19,18],[20,13,18],[21,16,18],[20,17,14],[21,19,14],[0,1,5],[8,10,11],[7,6,11],[7,6,5],[8,4,2],[7,4,5],[7,1,5],[7,1,11],[0,10,5],[0,1,11],[0,6,11],[0,6,5],[3,10,11],[8,4,11],[15,13,22],[12,16,22],[15,17,23],[12,19,23],[21,13,23],[20,16,23],[21,17,22],[20,19,22],[4,0,2],[1,3,2],[4,0,14],[1,3,18],[4,0,9],[1,3,9],[4,0,18],[1,3,14],[10,7,9],[6,8,9],[4,7,14],[6,3,18],[10,0,18],[1,8,14],[1,3,5],[4,0,5],[6,8,11],[10,7,11],[1,3,11],[4,0,11],[10,7,2],[6,8,2],[3,10,22],[7,1,23],[8,4,23],[0,6,22],[1,0,5],[4,3,5],[1,0,23],[4,3,22],[10,7,14],[6,8,18],[8,6,22],[7,10,23],[4,3,11],[1,0,11],[1,0,22],[4,3,23],[10,7,18],[6,8,14],[8,6,23],[7,10,22],[6,7,11],[10,8,11],[8,1,23],[0,10,22],[3,6,22],[7,4,23],[4,3,2],[1,0,2],[10,8,2],[6,7,2],[4,3,9],[1,0,9],[10,8,9],[6,7,9],[4,8,14],[6,0,18],[10,3,18],[1,7,14],[4,8,18],[6,0,14],[10,3,14],[1,7,18],[6,7,5],[10,8,5],[6,8,5],[10,7,5],[8,1,22],[0,10,23],[3,6,23],[7,4,22],[4,24,2],[25,3,2],[4,24,26],[25,3,27],[4,24,27],[25,3,26],[28,29,26],[30,31,26],[32,33,26],[34,35,27],[36,37,27],[38,39,27],[2,0,1],[1,2,0],[1,25,5],[24,0,5],[39,36,40],[35,38,40],[37,34,40],[33,30,41],[29,32,41],[31,28,41],[5,3,4],[4,5,3],[25,1,5],[0,24,5],[24,4,5],[3,25,5],[4,3,41],[25,1,40],[24,4,41],[3,25,40],[4,3,40],[25,1,41],[24,4,40],[3,25,41],[35,34,40],[37,36,40],[39,38,40],[29,28,41],[31,30,41],[33,32,41],[3,5,4],[5,4,3],[25,1,2],[0,24,2],[24,4,2],[3,25,2],[25,1,9],[0,24,9],[24,4,9],[3,25,9],[30,33,26],[32,29,26],[28,31,26],[36,39,27],[38,35,27],[34,37,27],[0,2,1],[2,1,0],[30,33,42],[32,29,42],[28,31,42],[36,39,43],[38,35,43],[34,37,43],[7,9,6],[9,6,7],[25,1,11],[0,24,11],[24,4,11],[3,25,11],[35,34,44],[37,36,44],[39,38,44],[29,28,45],[31,30,45],[33,32,45],[8,11,10],[11,10,8],[1,25,2],[24,0,2],[1,25,42],[24,0,43],[1,25,43],[24,0,42],[1,25,27],[24,0,26],[1,25,26],[24,0,27],[1,25,9],[24,0,9],[4,24,5],[25,3,5],[4,24,11],[25,3,11],[1,0,40],[4,3,44],[0,24,45],[1,0,41],[4,3,45],[0,24,44],[0,24,40],[0,24,41],[2,3,4],[5,3,1],[5,0,4],[4,2,3],[1,5,3],[4,5,0],[2,7,6],[2,8,10],[5,8,6],[5,7,10],[1,9,7],[4,9,8],[1,11,8],[4,11,7],[9,0,6],[9,3,10],[11,3,6],[11,0,10],[6,2,7],[10,2,8],[6,5,8],[10,5,7],[9,7,1],[9,8,4],[11,8,1],[11,7,4],[6,9,0],[10,9,3],[6,11,3],[10,11,0],[9,7,6],[9,8,10],[11,8,6],[11,7,10],[6,9,7],[10,9,8],[6,11,8],[10,11,7],[2,3,10],[5,8,1],[11,0,4],[10,2,3],[1,5,8],[4,11,0],[5,0,1],[2,0,4],[2,3,1],[1,5,0],[4,2,0],[1,2,3],[11,8,10],[11,7,6],[9,7,10],[9,8,6],[10,11,8],[6,11,7],[10,9,7],[6,9,8],[5,8,10],[5,7,6],[2,7,10],[2,8,6],[4,11,8],[1,11,7],[4,9,7],[1,9,8],[11,3,10],[11,0,6],[9,0,10],[9,3,6],[10,5,8],[6,5,7],[10,2,7],[6,2,8],[11,8,4],[11,7,1],[9,7,4],[9,8,1],[10,11,3],[6,11,0],[10,9,0],[6,9,3],[22,15,13],[22,12,16],[14,12,13],[14,15,16],[13,22,15],[16,22,12],[13,14,12],[16,14,15],[22,21,17],[22,20,19],[14,20,17],[14,21,19],[13,23,21],[16,23,20],[13,18,20],[16,18,21],[23,15,17],[23,12,19],[18,12,17],[18,15,19],[17,22,21],[19,22,20],[17,14,20],[19,14,21],[23,21,13],[23,20,16],[18,20,13],[18,21,16],[17,23,15],[19,23,12],[17,18,12],[19,18,15],[5,0,6],[2,7,4],[9,3,1],[6,5,0],[4,2,7],[1,9,3],[0,2,4],[3,2,1],[0,5,1],[2,1,3],[2,4,0],[5,1,0],[7,9,10],[8,9,6],[7,11,6],[9,6,8],[9,10,7],[11,6,7],[1,7,11],[4,8,11],[1,8,9],[4,7,9],[0,9,10],[3,9,6],[3,11,10],[0,11,6],[2,6,8],[2,10,7],[5,6,7],[5,10,8],[6,0,11],[10,3,11],[6,3,9],[10,0,9],[7,2,10],[8,2,6],[8,5,10],[7,5,6],[9,1,8],[9,4,7],[11,1,7],[11,4,8],[7,9,4],[8,9,1],[8,11,4],[7,11,1],[9,6,3],[9,10,0],[11,6,0],[11,10,3],[19,12,23],[13,15,22],[16,21,18],[17,20,14],[20,14,17],[21,18,16],[15,22,13],[12,23,19],[18,16,21],[14,17,20],[23,19,12],[22,13,15],[19,20,22],[13,21,23],[16,15,14],[17,12,18],[20,18,13],[21,14,19],[15,23,17],[12,22,16],[18,19,15],[14,13,12],[23,16,20],[22,17,21],[16,12,22],[17,15,23],[19,21,14],[13,20,18],[12,14,13],[15,18,19],[21,22,17],[20,23,16],[14,16,15],[18,17,12],[22,19,20],[23,13,21],[16,20,23],[17,21,22],[19,15,18],[13,12,14],[12,18,17],[15,14,16],[21,23,13],[20,22,19],[14,19,21],[18,13,20],[22,16,12],[23,17,15],[19,12,22],[17,21,23],[16,15,18],[13,20,14],[20,14,13],[15,18,16],[21,23,17],[12,22,19],[18,16,15],[14,13,20],[22,19,12],[23,17,21],[3,2,4],[3,5,1],[0,5,4],[2,4,3],[5,1,3],[5,4,0],[1,7,9],[4,8,9],[1,8,11],[4,7,11],[0,9,6],[3,9,10],[3,11,6],[0,11,10],[2,6,7],[2,10,8],[5,6,8],[5,10,7],[6,0,9],[10,3,9],[6,3,11],[10,0,11],[7,2,6],[8,2,10],[8,5,6],[7,5,10],[9,1,7],[9,4,8],[11,1,8],[11,4,7],[7,9,1],[8,9,4],[8,11,1],[7,11,4],[9,6,0],[9,10,3],[11,6,3],[11,10,0],[8,9,10],[8,11,6],[7,11,10],[9,10,8],[11,6,8],[11,10,7],[6,0,2],[10,3,2],[6,3,5],[10,0,5],[7,2,1],[8,2,4],[8,5,1],[7,5,4],[9,1,0],[9,4,3],[11,1,3],[11,4,0],[1,7,2],[4,8,2],[1,8,5],[4,7,5],[0,9,1],[3,9,4],[3,11,1],[0,11,4],[2,6,0],[2,10,3],[5,6,3],[5,10,0],[0,2,6],[3,2,10],[3,5,6],[0,5,10],[2,1,7],[2,4,8],[5,1,8],[5,4,7],[16,12,14],[13,21,18],[19,15,23],[17,20,22],[12,14,16],[21,18,13],[15,23,19],[20,22,17],[14,16,12],[18,13,21],[23,19,15],[22,17,20],[19,20,18],[17,15,14],[16,21,22],[13,12,23],[20,18,19],[15,14,17],[21,22,16],[12,23,13],[18,19,20],[14,17,15],[22,16,21],[23,13,12],[6,0,5],[10,3,5],[6,3,2],[10,0,2],[7,2,4],[8,2,1],[8,5,4],[7,5,1],[9,1,3],[9,4,0],[11,1,0],[11,4,3],[1,7,5],[4,8,5],[1,8,2],[4,7,2],[0,9,4],[3,9,1],[3,11,4],[0,11,1],[2,6,3],[2,10,0],[5,6,0],[5,10,3],[0,2,10],[3,2,6],[3,5,10],[0,5,6],[2,1,8],[2,4,7],[5,1,7],[5,4,8],[21,17,23],[20,16,22],[12,13,18],[15,19,14],[23,21,17],[22,20,16],[18,12,13],[14,15,19],[17,23,21],[16,22,20],[13,18,12],[19,14,15],[21,13,22],[20,19,23],[12,17,14],[15,16,18],[23,15,13],[22,12,19],[18,20,17],[14,21,16],[17,22,15],[16,23,12],[13,14,20],[19,18,21],[15,17,22],[12,16,23],[20,13,14],[21,19,18],[22,21,13],[23,20,19],[14,12,17],[18,15,16],[13,23,15],[19,22,12],[17,18,20],[16,14,21],[15,13,23],[12,19,22],[20,17,18],[21,16,14],[22,15,17],[23,12,16],[14,20,13],[18,21,19],[13,22,21],[19,23,20],[17,14,12],[16,18,15],[6,5,3],[4,9,3],[9,3,4],[5,7,4],[4,5,7],[5,3,6]],d$=[[0],[0,1],[0,2],[0,3],[0,2,4,5],[0,6],[0,7],[0,6,4,8],[0,7,4,9],[0,6,2,1],[0,3,1,10],[0,6,2,1,4,8,5,11],[0,12,1,7],[0,1,13,14],[0,12,1,7,4,15,11,9],[0,16,2,17],[0,18,12,17],[0,16,5,19],[0,20,13,19],[0,18,12,17,4,21,15,19],[0,16,2,17,4,22,5,19],[0,16,2,17,23,24,13,25,26,20,27,28,4,22,5,19],[0,16,17,2,29,21,30,15],[0,20,13,19,29,31,32,33],[0,16,6,34],[0,18,7,34],[0,16,7,35],[0,16,36,37],[0,18,36,38],[0,16,14,39],[0,20,40,34],[0,16,8,41],[0,18,8,42],[0,16,9,42],[0,16,6,34,4,22,8,41],[0,18,7,34,4,21,9,41],[0,16,7,35,4,22,9,42],[0,16,6,34,23,24,14,39],[0,16,10,43,23,24,7,35],[0,16,36,37,23,24,9,42],[0,16,8,41,23,24,40,38],[0,16,6,34,23,24,14,39,26,20,40,38,4,22,8,41],[0,16,44,45,23,24,46,47,26,20,48,49,4,22,50,51],[0,16,6,34,29,21,9,42],[0,16,8,41,29,21,7,35],[0,16,36,37,29,21,14,39],[0,16,2,17,1,52,6,34],[0,16,2,17,53,54,9,42],[0,16,12,33,1,52,7,35],[0,16,2,17,11,55,8,41],[0,56,2,57,1,58,6,37],[0,56,15,25,1,58,9,39],[0,20,27,17,1,59,40,34],[0,56,12,28,1,58,7,38],[0,16,5,19,1,52,8,41],[0,22,13,28,1,55,14,38],[0,18,13,60,1,61,14,43],[0,16,15,30,1,52,9,42],[0,16,5,19,11,55,6,34],[0,21,12,19,1,54,7,41],[0,20,13,19,1,59,14,41],[0,20,3,30,1,59,10,42],[0,18,12,17,1,61,7,34,4,21,15,19,11,54,9,41],[0,24,13,17,1,62,14,34,4,20,27,19,11,59,40,41],[0,16,2,17,1,52,6,34,4,22,5,19,11,55,8,41],[0,16,12,33,1,52,7,35,4,22,15,30,11,55,9,42],[0,31,3,17,1,63,10,34,4,56,32,19,11,58,36,41],[0,22,2,19,64,59,14,38,4,16,5,17,65,62,40,39],[0,16,2,17,1,52,6,34,23,24,13,25,64,62,14,39,26,20,27,28,65,59,40,38,4,22,5,19,11,55,8,41],[0,16,2,17,66,67,44,45,23,24,13,25,68,69,46,47,26,20,27,28,70,71,48,49,4,22,5,19,72,73,50,51],[0,16,2,17,1,52,6,34,29,21,15,30,53,54,9,42],[0,16,5,19,1,52,8,41,29,21,12,33,53,54,7,35],[0,20,13,19,1,59,14,41,29,31,32,33,53,63,36,35],[0,31,3,17,1,63,10,34,29,20,27,30,53,59,40,42],[0,16,74,75],[0,18,76,77],[0,16,78,79],[0,18,80,81],[0,16,74,75,29,21,82,83],[0,21,84,85,29,16,86,87],[0,16,88,89],[0,16,88,89,29,21,90,91],[0,16,74,75,1,52,88,89],[0,16,78,79,1,52,92,93],[0,16,94,95,11,55,88,89],[0,16,82,83,53,54,88,89],[0,16,74,75,1,52,88,89,29,21,82,83,53,54,90,91],[0,21,84,85,96,97,88,91,29,16,86,87,98,99,90,89],[0,16,74,75,2,17,100,101],[0,16,94,95,5,19,100,101],[0,18,76,77,2,33,102,103],[0,18,104,105,106,107,100,108],[0,16,78,79,2,17,109,108],[0,16,82,83,15,30,100,101],[0,18,80,81,2,33,110,111],[0,18,112,113,114,115,100,108],[0,16,74,75,2,17,100,101,29,21,82,83,15,30,116,117],[0,21,84,85,118,119,116,101,29,16,86,87,120,121,100,117],[0,16,74,75,6,34,122,123],[0,16,74,75,8,41,124,125],[0,16,78,79,7,35,122,123],[0,16,82,83,9,42,122,123],[0,16,74,75,7,35,126,127],[0,16,74,75,9,42,128,129],[0,16,78,79,6,34,126,127],[0,16,78,79,8,41,128,129],[0,16,74,75,6,34,122,123,29,21,82,83,9,42,128,129],[0,16,74,75,7,35,126,127,29,21,82,83,8,41,124,125],[0,21,84,85,6,42,130,131,29,16,86,87,9,34,132,133],[0,21,84,85,7,41,134,135,29,16,86,87,8,35,136,137],[0,16,89,88,2,17,122,123],[0,16,89,88,12,33,126,127],[0,16,89,88,5,19,124,125],[0,16,89,88,15,30,128,129],[0,16,88,89,6,34,100,101],[0,16,89,88,7,35,109,108],[0,16,89,88,8,41,138,139],[0,16,89,88,9,42,116,117],[0,16,89,88,6,34,100,101,29,21,91,90,9,42,116,117],[0,16,89,88,7,35,109,108,29,21,91,90,8,41,138,139],[0,16,89,88,2,17,122,123,29,21,91,90,15,30,128,129],[0,16,89,88,118,121,132,131,29,21,91,90,120,119,130,133],[0,16,74,75,2,17,100,101,1,52,88,89,6,34,122,123],[0,16,74,75,12,33,109,108,1,52,88,89,7,35,126,127],[0,16,74,75,2,17,100,101,11,55,140,141,8,41,124,125],[0,16,74,75,2,17,100,101,53,54,90,91,9,42,128,129],[0,16,74,75,5,19,138,139,1,52,88,89,8,41,124,125],[0,16,74,75,15,30,116,117,1,52,88,89,9,42,128,129],[0,16,94,95,5,19,100,101,11,55,88,89,6,34,124,125],[0,16,94,95,15,30,109,108,11,55,88,89,7,35,128,129],[0,16,78,79,2,17,109,108,1,52,92,93,6,34,126,127],[0,16,78,79,12,33,100,101,1,52,92,93,7,35,122,123],[0,16,82,83,12,33,138,139,53,54,88,89,8,41,126,127],[0,16,82,83,2,17,116,117,53,54,88,89,9,42,122,123],[0,16,78,79,5,19,116,117,1,52,92,93,8,41,128,129],[0,16,82,83,15,30,100,101,1,52,90,91,9,42,122,123],[0,16,82,83,15,30,100,101,53,54,88,89,6,34,128,129],[0,16,82,83,5,19,109,108,53,54,88,89,7,35,124,125],[0,16,74,75,2,17,100,101,1,52,88,89,6,34,122,123,29,21,82,83,15,30,116,117,53,54,90,91,9,42,128,129],[0,16,74,75,12,33,109,108,1,52,88,89,7,35,126,127,29,21,82,83,5,19,138,139,53,54,90,91,8,41,124,125],[0,21,84,85,118,119,116,101,96,97,88,91,9,34,132,133,29,16,86,87,120,121,100,117,98,99,90,89,6,42,130,131],[0,21,84,85,142,143,138,108,96,97,88,91,8,35,136,137,29,16,86,87,144,145,109,139,98,99,90,89,7,41,134,135],[0,146,147],[0,148,149],[0,150,151],[0,146,147,152,153,154,155,156,157],[0,158,159],[0,146,147,1,160,161],[0,146,147,1,160,161,152,153,154,162,163,164,155,156,157,165,166,167],[0,158,159,1,168,169],[0,146,147,101,170,171],[0,146,147,100,172,173],[0,148,149,174,175,171],[0,148,149,100,176,177],[0,150,151,178,179,171],[0,150,151,100,180,181],[0,146,147,100,172,173,152,153,154,182,183,184,155,156,157,185,186,187],[0,158,159,101,188,189],[0,146,147,122,190,191],[0,146,147,123,192,193],[0,146,147,126,194,195],[0,146,147,127,196,197],[0,146,147,122,190,191,152,153,154,198,199,200,155,156,157,201,202,203],[0,158,159,123,204,205],[0,146,147,126,194,195,152,153,154,206,207,208,155,156,157,209,210,211],[0,158,159,129,212,213],[0,146,147,101,170,171,1,160,161,123,192,193],[0,146,147,108,214,215,1,160,161,127,196,197],[0,146,147,100,172,173,1,160,161,122,190,191],[0,146,147,109,216,217,1,160,161,126,194,195],[0,146,147,100,172,173,1,160,161,122,190,191,152,153,154,182,183,184,162,163,164,198,199,200,155,156,157,185,186,187,165,166,167,201,202,203],[0,158,159,101,188,189,1,168,169,123,204,205],[0,146,147,109,216,217,1,160,161,126,194,195,152,153,154,218,219,220,162,163,164,206,207,208,155,156,157,221,222,223,165,166,167,209,210,211],[0,158,159,117,224,225,1,168,169,129,212,213],[0,146,147,16,226,227],[0,148,149,18,228,229],[0,150,151,18,230,231],[0,150,151,16,232,233],[0,148,149,16,234,235],[0,146,147,18,236,237],[0,146,147,52,238,239],[0,146,147,16,226,227,1,160,161,52,238,239],[0,146,147,18,236,237,1,160,161,61,240,241],[0,146,147,16,226,227,100,172,173,101,170,171],[0,148,149,18,228,229,242,172,181,243,214,244],[0,150,151,18,230,231,245,172,177,246,214,247],[0,150,151,16,232,233,245,172,177,174,170,248],[0,148,149,16,234,235,242,172,181,178,170,249],[0,146,147,18,236,237,100,172,173,108,214,215],[0,146,147,16,226,227,122,190,191,123,192,193],[0,146,147,16,226,227,126,194,195,127,196,197],[0,146,147,18,236,237,126,194,195,123,192,193],[0,146,147,18,236,237,122,190,191,127,196,197],[0,146,147,52,238,239,122,190,191,101,170,171],[0,146,147,61,240,241,126,194,195,101,170,171],[0,146,147,52,238,239,100,172,173,123,192,193],[0,146,147,61,240,241,100,172,173,127,196,197],[0,146,147,16,226,227,100,172,173,101,170,171,1,160,161,52,239,238,122,190,191,123,192,193],[0,146,147,16,226,227,109,216,217,108,214,215,1,160,161,52,239,238,126,194,195,127,196,197],[0,146,147,18,236,237,109,216,217,101,170,171,1,160,161,61,241,240,126,194,195,123,192,193],[0,146,147,18,236,237,100,172,173,108,214,215,1,160,161,61,241,240,122,190,191,127,196,197],[0,16,2,17,158,250,251,252,159,253,254,255],[0,16,2,17,158,250,251,252,159,253,254,255,23,24,13,25,256,257,258,259,260,261,262,263,26,20,27,28,264,265,266,267,268,269,270,271,4,22,5,19,272,273,274,275,276,277,278,279],[0,16,2,17,158,250,251,252,159,253,254,255,29,21,15,30,280,281,282,283,284,285,286,287],[0,20,13,19,158,273,266,259,159,261,278,271],[0,20,13,19,158,273,266,259,159,261,278,271,29,31,32,33,280,288,289,290,284,291,292,293],[0,16,2,17,158,250,251,252,159,253,254,255,1,52,6,34,168,294,295,296,169,297,298,299],[0,16,2,17,158,250,251,252,159,253,254,255,53,54,9,42,300,301,302,303,304,305,306,307],[0,16,2,17,158,250,251,252,159,253,254,255,1,52,6,34,168,294,295,296,169,297,298,299,23,24,13,25,256,257,258,259,260,261,262,263,64,62,14,39,308,309,310,311,312,313,314,315,26,20,27,28,264,265,266,267,268,269,270,271,65,59,40,38,316,317,318,319,320,321,322,323,4,22,5,19,272,273,274,275,276,277,278,279,11,55,8,41,324,325,326,327,328,329,330,331],[0,16,2,17,158,250,251,252,159,253,254,255,66,67,44,45,332,333,334,335,336,337,338,339,23,24,13,25,256,257,258,259,260,261,262,263,68,69,46,47,340,341,342,343,344,345,346,347,26,20,27,28,264,265,266,267,268,269,270,271,70,71,48,49,348,349,350,351,352,353,354,355,4,22,5,19,272,273,274,275,276,277,278,279,72,73,50,51,356,357,358,359,360,361,362,363],[0,16,2,17,158,250,251,252,159,253,254,255,1,52,6,34,168,294,295,296,169,297,298,299,29,21,15,30,280,281,282,283,284,285,286,287,53,54,9,42,300,301,302,303,304,305,306,307],[0,20,13,19,158,273,266,259,159,261,278,271,1,59,14,41,168,325,318,311,169,313,330,323],[0,20,13,19,158,273,266,259,159,261,278,271,1,59,14,41,168,325,318,311,169,313,330,323,29,31,32,33,280,288,289,290,284,291,292,293,53,63,36,35,300,364,365,366,304,367,368,369],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189],[0,16,2,17,158,250,251,252,159,253,254,255,116,117,83,82,376,377,224,378,379,380,381,225],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,23,24,13,25,256,257,258,259,260,261,262,263,382,383,384,385,386,387,388,389,390,391,392,393,26,20,27,28,264,265,266,267,268,269,270,271,394,395,396,397,398,399,400,401,402,403,404,405,4,22,5,19,272,273,274,275,276,277,278,279,138,139,95,94,406,407,408,409,410,411,412,413],[0,24,5,28,158,265,258,275,159,277,270,263,414,415,416,417,418,419,420,421,422,423,424,425,23,16,27,19,256,273,251,267,260,269,278,255,426,427,428,429,430,431,432,433,434,435,436,437,26,22,13,17,264,250,274,259,268,261,254,279,438,439,440,441,442,443,444,445,446,447,448,449,4,20,2,25,272,257,266,252,276,253,262,271,450,451,452,453,454,455,456,457,458,459,460,461],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,29,21,15,30,280,281,282,283,284,285,286,287,116,117,83,82,376,377,224,378,379,380,381,225],[0,20,13,19,158,273,266,259,159,261,278,271,450,415,440,429,454,431,420,445,458,447,436,425],[0,20,13,19,158,273,266,259,159,261,278,271,462,463,464,465,466,467,468,469,470,471,472,473],[0,20,13,19,158,273,266,259,159,261,278,271,462,463,464,465,466,467,468,469,470,471,472,473,29,31,32,33,280,288,289,290,284,291,292,293,450,415,440,429,454,431,420,445,458,447,436,425],[0,16,2,17,158,250,251,252,159,253,254,255,123,122,88,89,204,474,475,476,205,477,478,479],[0,16,2,17,158,250,251,252,159,253,254,255,123,122,88,89,204,474,475,476,205,477,478,479,23,24,13,25,256,257,258,259,260,261,262,263,480,481,482,483,484,485,486,487,488,489,490,491,26,20,27,28,264,265,266,267,268,269,270,271,492,493,494,495,496,497,498,499,500,501,502,503,4,22,5,19,272,273,274,275,276,277,278,279,125,124,140,141,504,505,506,507,508,509,510,511],[0,16,2,17,158,250,251,252,159,253,254,255,123,122,88,89,204,474,475,476,205,477,478,479,29,21,15,30,280,281,282,283,284,285,286,287,129,128,90,91,212,512,513,514,213,515,516,517],[0,16,2,17,158,250,251,252,159,253,254,255,129,128,90,91,212,512,513,514,213,515,516,517],[0,16,2,17,158,250,251,252,159,253,254,255,129,128,90,91,212,512,513,514,213,515,516,517,23,24,13,25,256,257,258,259,260,261,262,263,518,519,520,521,522,523,524,525,526,527,528,529,26,20,27,28,264,265,266,267,268,269,270,271,530,531,532,533,534,535,536,537,538,539,540,541,4,22,5,19,272,273,274,275,276,277,278,279,127,126,92,93,542,543,544,545,546,547,548,549],[0,20,13,19,158,273,266,259,159,261,278,271,550,551,552,553,554,555,556,557,558,559,560,561,29,31,32,33,280,288,289,290,284,291,292,293,562,563,564,565,566,567,568,569,570,571,572,573],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,1,52,6,34,168,294,295,296,169,297,298,299,122,123,89,88,475,476,204,474,479,478,477,205],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,53,54,9,42,300,301,302,303,304,305,306,307,128,129,91,90,513,514,212,512,517,516,515,213],[0,16,2,17,158,250,251,252,159,253,254,255,116,117,83,82,376,377,224,378,379,380,381,225,1,52,6,34,168,294,295,296,169,297,298,299,128,129,91,90,513,514,212,512,517,516,515,213],[0,16,2,17,158,250,251,252,159,253,254,255,116,117,83,82,376,377,224,378,379,380,381,225,53,54,9,42,300,301,302,303,304,305,306,307,122,123,89,88,475,476,204,474,479,478,477,205],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,1,52,6,34,168,294,295,296,169,297,298,299,122,123,89,88,475,476,204,474,479,478,477,205,23,24,13,25,256,257,258,259,260,261,262,263,382,383,384,385,386,387,388,389,390,391,392,393,64,62,14,39,308,309,310,311,312,313,314,315,481,480,483,482,486,487,484,485,491,490,489,488,26,20,27,28,264,265,266,267,268,269,270,271,394,395,396,397,398,399,400,401,402,403,404,405,65,59,40,38,316,317,318,319,320,321,322,323,493,492,495,494,498,499,496,497,503,502,501,500,4,22,5,19,272,273,274,275,276,277,278,279,138,139,95,94,406,407,408,409,410,411,412,413,11,55,8,41,324,325,326,327,328,329,330,331,124,125,141,140,506,507,504,505,511,510,509,508],[0,16,2,17,158,250,251,252,159,253,254,255,116,117,83,82,376,377,224,378,379,380,381,225,1,52,6,34,168,294,295,296,169,297,298,299,128,129,91,90,513,514,212,512,517,516,515,213,23,24,13,25,256,257,258,259,260,261,262,263,574,575,576,577,578,579,580,581,582,583,584,585,64,62,14,39,308,309,310,311,312,313,314,315,519,518,521,520,524,525,522,523,529,528,527,526,26,20,27,28,264,265,266,267,268,269,270,271,586,587,588,589,590,591,592,593,594,595,596,597,65,59,40,38,316,317,318,319,320,321,322,323,531,530,533,532,536,537,534,535,541,540,539,538,4,22,5,19,272,273,274,275,276,277,278,279,109,108,79,78,598,599,600,601,602,603,604,605,11,55,8,41,324,325,326,327,328,329,330,331,126,127,93,92,544,545,542,543,549,548,547,546],[0,24,5,28,158,265,258,275,159,277,270,263,414,415,416,417,418,419,420,421,422,423,424,425,66,69,50,49,332,349,342,359,336,361,354,347,493,123,483,140,498,507,204,485,503,490,509,205,23,16,27,19,256,273,251,267,260,269,278,255,426,427,428,429,430,431,432,433,434,435,436,437,68,67,48,51,340,357,334,351,344,353,362,339,124,480,89,494,506,499,484,474,511,478,501,488,26,22,13,17,264,250,274,259,268,261,254,279,438,439,440,441,442,443,444,445,446,447,448,449,70,73,46,45,348,333,358,343,352,345,338,363,122,492,141,482,475,487,496,505,479,510,489,500,4,20,2,25,272,257,266,252,276,253,262,271,450,451,452,453,454,455,456,457,458,459,460,461,72,71,44,47,356,341,350,335,360,337,346,355,481,125,495,88,486,476,504,497,491,502,477,508],[0,24,5,28,158,265,258,275,159,277,270,263,414,415,416,417,418,419,420,421,422,423,424,425,606,607,608,609,610,611,612,613,614,615,616,617,531,129,521,92,536,545,212,523,541,528,547,213,23,16,27,19,256,273,251,267,260,269,278,255,426,427,428,429,430,431,432,433,434,435,436,437,618,619,620,621,622,623,624,625,626,627,628,629,126,518,91,532,544,537,522,512,549,516,539,526,26,22,13,17,264,250,274,259,268,261,254,279,438,439,440,441,442,443,444,445,446,447,448,449,630,631,632,633,634,635,636,637,638,639,640,641,128,530,93,520,513,525,534,543,517,548,527,538,4,20,2,25,272,257,266,252,276,253,262,271,450,451,452,453,454,455,456,457,458,459,460,461,642,643,644,645,646,647,648,649,650,651,652,653,519,127,533,90,524,514,542,535,529,540,515,546],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,1,52,6,34,168,294,295,296,169,297,298,299,122,123,89,88,475,476,204,474,479,478,477,205,29,21,15,30,280,281,282,283,284,285,286,287,116,117,83,82,376,377,224,378,379,380,381,225,53,54,9,42,300,301,302,303,304,305,306,307,128,129,91,90,513,514,212,512,517,516,515,213],[0,20,13,19,158,273,266,259,159,261,278,271,462,463,464,465,466,467,468,469,470,471,472,473,1,59,14,41,168,325,318,311,169,313,330,323,551,550,553,552,556,557,554,555,561,560,559,558,29,31,32,33,280,288,289,290,284,291,292,293,450,415,440,429,454,431,420,445,458,447,436,425,53,63,36,35,300,364,365,366,304,367,368,369,563,562,565,564,568,569,566,567,573,572,571,570],[0,16],[0,18],[0,16,26,20],[0,2,23,13],[0,3,4,32],[0,2,29,15],[0,3,29,27],[0,52],[0,63],[0,52,26,59],[0,63,26,54],[0,52,16,1],[0,18,1,61],[0,52,16,1,26,59,20,65],[0,31,1,63],[0,1,24,62],[0,15,1,9],[0,5,1,8],[0,31,1,63,26,21,65,54],[0,2,57,56],[0,60,3,16],[0,22,57,3],[0,2,28,20],[0,17,13,24],[0,20,19,13,4,24,17,27],[0,22,57,3,4,16,60,32],[0,22,57,3,23,20,30,12,26,24,33,15,4,16,60,32],[0,22,57,3,29,18,27,25],[0,22,3,57,1,55,10,37],[0,22,385,396,3,57,109,117],[0,22,57,3,159,279,654,655,158,274,656,657,29,18,25,27,284,658,262,269,280,659,257,267]],pv={"P 1":0,"P -1":1,"P 1 2 1":2,"P 1 21 1":3,"C 1 2 1":4,"P 1 m 1":5,"P 1 c 1":6,"C 1 m 1":7,"C 1 c 1":8,"P 1 2/m 1":9,"P 1 21/m 1":10,"C 1 2/m 1":11,"P 1 2/c 1":12,"P 1 21/c 1":13,"C 1 2/c 1":14,"P 2 2 2":15,"P 2 2 21":16,"P 21 21 2":17,"P 21 21 21":18,"C 2 2 21":19,"C 2 2 2":20,"F 2 2 2":21,"I 2 2 2":22,"I 21 21 21":23,"P m m 2":24,"P m c 21":25,"P c c 2":26,"P m a 2":27,"P c a 21":28,"P n c 2":29,"P m n 21":30,"P b a 2":31,"P n a 21":32,"P n n 2":33,"C m m 2":34,"C m c 21":35,"C c c 2":36,"A m m 2":37,"A b m 2":38,"A m a 2":39,"A b a 2":40,"F m m 2":41,"F d d 2":42,"I m m 2":43,"I b a 2":44,"I m a 2":45,"P 2/m 2/m 2/m":46,"P m m m":46,"P 2/n 2/n 2/n":47,"P n n n":47,"P 2/c 2/c 2/m":48,"P c c m":48,"P 2/b 2/a 2/n":49,"P b a n":49,"P 21/m 2/m 2/a":50,"P m m a":50,"P 2/n 21/n 2/a":51,"P n n a":51,"P 2/m 2/n 21/a":52,"P m n a":52,"P 21/c 2/c 2/a":53,"P c c a":53,"P 21/b 21/a 2/m":54,"P b a m":54,"P 21/c 21/c 2/n":55,"P c c n":55,"P 2/b 21/c 21/m":56,"P b c m":56,"P 21/n 21/n 2/m":57,"P n n m":57,"P 21/m 21/m 2/n":58,"P m m n":58,"P 21/b 2/c 21/n":59,"P b c n":59,"P 21/b 21/c 21/a":60,"P b c a":60,"P 21/n 21/m 21/a":61,"P n m a":61,"C 2/m 2/c 21/m":62,"C m c m":62,"C 2/m 2/c 21/a":63,"C m c a":63,"C 2/m 2/m 2/m":64,"C m m m":64,"C 2/c 2/c 2/m":65,"C c c m":65,"C 2/m 2/m 2/a":66,"C m m a":66,"C 2/c 2/c 2/a":67,"C c c a":67,"F 2/m 2/m 2/m":68,"F m m m":68,"F 2/d 2/d 2/d":69,"F d d d":69,"I 2/m 2/m 2/m":70,"I m m m":70,"I 2/b 2/a 2/m":71,"I b a m":71,"I 21/b 21/c 21/a":72,"I b c a":72,"I 21/m 21/m 21/a":73,"I m m a":73,"P 4":74,"P 41":75,"P 42":76,"P 43":77,"I 4":78,"I 41":79,"P -4":80,"I -4":81,"P 4/m":82,"P 42/m":83,"P 4/n":84,"P 42/n":85,"I 4/m":86,"I 41/a":87,"P 4 2 2":88,"P 4 21 2":89,"P 41 2 2":90,"P 41 21 2":91,"P 42 2 2":92,"P 42 21 2":93,"P 43 2 2":94,"P 43 21 2":95,"I 4 2 2":96,"I 41 2 2":97,"P 4 m m":98,"P 4 b m":99,"P 42 c m":100,"P 42 n m":101,"P 4 c c":102,"P 4 n c":103,"P 42 m c":104,"P 42 b c":105,"I 4 m m":106,"I 4 c m":107,"I 41 m d":108,"I 41 c d":109,"P -4 2 m":110,"P -4 2 c":111,"P -4 21 m":112,"P -4 21 c":113,"P -4 m 2":114,"P -4 c 2":115,"P -4 b 2":116,"P -4 n 2":117,"I -4 m 2":118,"I -4 c 2":119,"I -4 2 m":120,"I -4 2 d":121,"P 4/m 2/m 2/m":122,"P4/m m m":122,"P 4/m 2/c 2/c":123,"P4/m c c":123,"P 4/n 2/b 2/m":124,"P4/n b m":124,"P 4/n 2/n 2/c":125,"P4/n n c":125,"P 4/m 21/b 2/m":126,"P4/m b m":126,"P 4/m 21/n 2/c":127,"P4/m n c":127,"P 4/n 21/m 2/m":128,"P4/n m m":128,"P 4/n 2/c 2/c":129,"P4/n c c":129,"P 42/m 2/m 2/c":130,"P42/m m c":130,"P 42/m 2/c 2/m":131,"P42/m c m":131,"P 42/n 2/b 2/c":132,"P42/n b c":132,"P 42/n 2/n 2/m":133,"P42/n n m":133,"P 42/m 21/b 2/c":134,"P42/m b c":134,"P 42/m 21/n 2/m":135,"P42/m n m":135,"P 42/n 21/m 2/c":136,"P42/n m c":136,"P 42/n 21/c 2/m":137,"P42/n c m":137,"I 4/m 2/m 2/m":138,"I4/m m m":138,"I 4/m 2/c 2/m":139,"I4/m c m":139,"I 41/a 2/m 2/d":140,"I41/a m d":140,"I 41/a 2/c 2/d":141,"I41/a c d":141,"P 3":142,"P 31":143,"P 32":144,"H 3":145,"R 3":146,"P -3":147,"H -3":148,"R -3":149,"P 3 1 2":150,"P 3 2 1":151,"P 31 1 2":152,"P 31 2 1":153,"P 32 1 2":154,"P 32 2 1":155,"H 3 2":156,"R 3 2":157,"P 3 m 1":158,"P 3 1 m":159,"P 3 c 1":160,"P 3 1 c":161,"H 3 m":162,"R 3 m":163,"H 3 c":164,"R 3 c":165,"P -3 1 2/m":166,"P -3 1 m":166,"P -3 1 2/c":167,"P -3 1 c":167,"P -3 2/m 1":168,"P -3 m 1":168,"P -3 2/c 1":169,"P -3 c 1":169,"H -3 2/m":170,"H -3 m":170,"R -3 2/m":171,"R -3 m":171,"H -3 2/c":172,"H -3 c":172,"R -3 2/c":173,"R -3 c":173,"P 6":174,"P 61":175,"P 65":176,"P 62":177,"P 64":178,"P 63":179,"P -6":180,"P 6/m":181,"P 63/m":182,"P 6 2 2":183,"P 61 2 2":184,"P 65 2 2":185,"P 62 2 2":186,"P 64 2 2":187,"P 63 2 2":188,"P 6 m m":189,"P 6 c c":190,"P 63 c m":191,"P 63 m c":192,"P -6 m 2":193,"P -6 c 2":194,"P -6 2 m":195,"P -6 2 c":196,"P 6/m 2/m 2/m":197,"P 6/m m m":197,"P 6/m 2/c 2/c":198,"P 6/m c c":198,"P 63/m 2/c 2/m":199,"P 63/m c m":199,"P 63/m 2/m 2/c":200,"P 63/m m c":200,"P 2 3":201,"F 2 3":202,"I 2 3":203,"P 21 3":204,"I 21 3":205,"P 2/m -3":206,"P m -3":206,"P 2/n -3":207,"P n -3":207,"F 2/m -3":208,"F m -3":208,"F 2/d -3":209,"F d -3":209,"I 2/m -3":210,"I m -3":210,"P 21/a -3":211,"P a -3":211,"I 21/a -3":212,"I a -3":212,"P 4 3 2":213,"P 42 3 2":214,"F 4 3 2":215,"F 41 3 2":216,"I 4 3 2":217,"P 43 3 2":218,"P 41 3 2":219,"I 41 3 2":220,"P -4 3 m":221,"F -4 3 m":222,"I -4 3 m":223,"P -4 3 n":224,"F -4 3 c":225,"I -4 3 d":226,"P 4/m -3 2/m":227,"P m -3 m":227,"P 4/n -3 2/n":228,"P n -3 n":228,"P 42/m -3 2/n":229,"P m -3 n":229,"P 42/n -3 2/m":230,"P n -3 m":230,"F 4/m -3 2/m":231,"F m -3 m":231,"F 4/m -3 2/c":232,"F m -3 c":232,"F 41/d -3 2/m":233,"F d -3 m":233,"F 41/d -3 2/c":234,"F d -3 c":234,"I 4/m -3 2/m":235,"I m -3 m":235,"I 41/a -3 2/d":236,"I a -3 d":236,"P 1 1 2":237,"P 1 1 21":238,"B 1 1 2":239,"B 2":239,"A 1 2 1":240,"C 1 21 1":241,"I 1 2 1":242,"I 2":242,"I 1 21 1":243,"P 1 1 m":244,"P 1 1 b":245,"B 1 1 m":246,"B 1 1 b":247,"P 1 1 2/m":248,"P 1 1 21/m":249,"B 1 1 2/m":250,"P 1 1 2/b":251,"P 1 1 21/b":252,"P 1 21/n 1":253,"P 1 21/a 1":254,"B 1 1 2/b":255,"P 21 2 2":256,"P 2 21 2":257,"P 21 21 2 (a)":258,"P 21 2 21":259,"P 2 21 21":260,"C 2 2 21a)":261,"C 2 2 2a":262,"F 2 2 2a":263,"I 2 2 2a":264,"P 21/m 21/m 2/n a":265,"P 42 21 2a":266,"I 2 3a":267};function f$(e){switch(e){case 1146:return 146;case 1148:return 149;case 1155:return 157;case 1160:return 163;case 1161:return 165;case 1166:return 171;case 1167:return 173;case 1003:return 237;case 1004:return 238;case 1005:return 239;case 2005:return 240;case 3005:return 241;case 4005:return 242;case 5005:return 243;case 1006:return 244;case 1007:return 245;case 1008:return 246;case 1009:return 247;case 1010:return 248;case 1011:return 249;case 1012:return 250;case 1013:return 251;case 1014:return 252;case 2014:return 253;case 3014:return 254;case 1015:return 255;case 1017:return 256;case 2017:return 257;case 1018:return 258;case 2018:return 259;case 3018:return 260;case 1020:return 261;case 1021:return 262;case 1022:return 263;case 1023:return 264;case 1059:return 265;case 1094:return 266;case 1197:return 267}var t=0;return e>146&&++t,e>148&&++t,e>155&&++t,e>160&&++t,e>161&&++t,e>166&&++t,e>167&&++t,e-1+t}function p$(e){if(e<146)return e+1;if(e===146)return 1146;if(e<149)return e+1-1;if(e===149)return 1148;if(e<157)return e+1-2;if(e===157)return 1155;if(e<163)return e+1-3;if(e===163)return 1160;if(e<165)return e+1-4;if(e===165)return 1161;if(e<171)return e+1-5;if(e===171)return 1166;if(e<173)return e+1-6;if(e===173)return 1167;if(e<237)return e+1-7;if(e===237)return 1003;if(e===238)return 1004;if(e===239)return 1005;if(e===240)return 2005;if(e===241)return 3005;if(e===242)return 4005;if(e===243)return 5005;if(e===244)return 1006;if(e===245)return 1007;if(e===246)return 1008;if(e===247)return 1009;if(e===248)return 1010;if(e===249)return 1011;if(e===250)return 1012;if(e===251)return 1013;if(e===252)return 1014;if(e===253)return 2014;if(e===254)return 3014;if(e===255)return 1015;if(e===256)return 1017;if(e===257)return 2017;if(e===258)return 1018;if(e===259)return 2018;if(e===260)return 3018;if(e===261)return 1020;if(e===262)return 1021;if(e===263)return 1022;if(e===264)return 1023;if(e===265)return 1059;if(e===266)return 1094;if(e===267)return 1197;throw new Error("unknown spacegroup index '"+e+"'")}var C6=function(){for(var e=Object.create(null),t=0,r=Object.keys(pv);t<r.length;t++){var n=r[t];e[pv[n]]=n}return e}(),h$=function(){for(var e=Object.create(null),t=0,r=Object.keys(pv);t<r.length;t++){var n=r[t],a=pv[n];e[a]=p$(a)}return e}();function v$(e){var t=typeof e=="number"?f$(e):pv[e];return typeof t=="undefined"||typeof C6[t]=="undefined"?-1:t}var Ei;(function(e){e.Zero=r("P 1",C.create(1,1,1),C.create(Math.PI/2,Math.PI/2,Math.PI/2));function t(n){return n?n.index===0&&n.size[0]===1&&n.size[1]===1&&n.size[1]===1:!0}e.isZero=t;function r(n,a,i){var o=v$(n);if(o<0)return console.warn("Unknown spacegroup '"+n+"', returning a 'P 1' with cellsize [1, 1, 1]"),e.Zero;var s=a[0]*a[1]*a[2],u=i[0],l=i[1],c=i[2],d=a[0],f=a[1],p=a[2],h=Math.cos(l),v=(Math.cos(u)-Math.cos(l)*Math.cos(c))/Math.sin(c),m=Math.sqrt(1-h*h-v*v),g=[d,0,0],y=[Math.cos(c)*f,Math.sin(c)*f,0],b=[h*p,v*p,m*p],x=ue.ofRows([[g[0],y[0],b[0],0],[0,y[1],b[1],0],[0,0,b[2],0],[0,0,0,1]]),S=ue.invert(ue.zero(),x);return{index:o,size:a,volume:s,anglesInRadians:i,toFractional:S,fromFractional:x}}e.create=r})(Ei||(Ei={}));var fs;(function(e){e.ZeroP1=t(Ei.Zero);function t(m){var g=d$[m.index].map(function(x){return d(c$[x])}),y=C6[m.index],b=h$[m.index];return{name:y,num:b,cell:m,operators:g}}e.create=t;var r=C(),n=ue();function a(m,g,y,b,x,S){return C.set(r,y,b,x),ue.fromTranslation(n,r),ue.mul(S,ue.mul(S,ue.mul(S,m.cell.fromFractional,n),m.operators[g]),m.cell.toFractional)}e.setOperatorMatrix=a;function i(m,g,y,b,x){var S=a(m,g,y,b,x,ue.zero());return dn.create(g+1+"_"+(5+y)+(5+b)+(5+x),S,{hkl:C.create(y,b,x),spgrOp:g})}e.getSymmetryOperator=i;var o=C(),s=C(),u=C(),l=C();function c(m,g,y,b,x,S){var _=ue.zero();C.set(r,y,b,x),C.floor(o,S),ue.copy(_,m.operators[g]),C.floor(s,C.transformMat4(s,S,_)),ue.getTranslation(l,_),C.sub(l,l,s),C.add(l,l,o),C.add(l,l,r),ue.setTranslation(_,l),ue.mul(_,m.cell.fromFractional,_),ue.mul(_,_,m.cell.toFractional),C.sub(u,s,o);var A=y-u[0],T=b-u[1],I=x-u[2];return dn.create(g+1+"_"+(5+A)+(5+T)+(5+I),_,{hkl:C.create(A,T,I),spgrOp:g})}e.getSymmetryOperatorRef=c;function d(m){var g=Lb[m[0]],y=Lb[m[1]],b=Lb[m[2]];return ue.ofRows([g,y,b,[0,0,0,1]])}function f(m){return[v(p(m[0],m[4],m[8]),h(m[12])),v(p(m[1],m[5],m[9]),h(m[13])),v(p(m[2],m[6],m[10]),h(m[14]))].join(",")}e.getOperatorXyz=f;function p(m,g,y){var b=[];if(m>0?b.push("+X"):m<0&&b.push("-X"),g>0?b.push("+Y"):g<0&&b.push("-Y"),y>0?b.push("+Z"):y<0&&b.push("-Z"),b.length===1)return b[0].charAt(0)==="+"?b[0].substr(1):b[0];if(b.length===2){var x=b[0].charAt(0),S=b[1].charAt(0);if(x==="+")return""+b[0].substr(1)+b[1];if(S==="+")return""+b[1].substr(1)+b[0]}throw new Error("unknown rotation '"+b+"', "+m+" "+g+" "+y)}function h(m){switch(m){case 1/2:return"1/2";case 1/4:return"1/4";case 3/4:return"3/4";case 1/3:return"1/3";case 2/3:return"2/3";case 1/6:return"1/6";case 5/6:return"5/6"}return""}function v(m,g){return g===""?m:m.length>2?m+"+"+g:m.charAt(0)==="-"?""+g+m:g+"+"+m}})(fs||(fs={}));var mc;(function(e){function t(i,o,s){i.squaredDistances[i.count]=s,i.indices[i.count++]=o}e.add=t;function r(i){i.count=0}e.reset=r;function n(){return{count:0,indices:[],squaredDistances:[]}}e.create=n;function a(i,o){for(var s=0;s<o.count;++s)i.indices[s]=o.indices[s],i.squaredDistances[s]=o.squaredDistances[s];return i.count=o.count,i}e.copy=a})(mc||(mc={}));function Ne(){return Ne.zero()}(function(e){function t(O){return O.extrema!==void 0}e.hasExtrema=t;function r(O,D){return{center:O,radius:D}}e.create=r;function n(){return{center:C(),radius:0}}e.zero=n;function a(O){var D=r(C.clone(O.center),O.radius);return t(O)&&(D.extrema=O.extrema.map(function(F){return C.clone(F)})),D}e.clone=a;function i(O,D,F){return C.copy(O.center,D),O.radius=F,O}e.set=i;function o(O,D){return C.copy(O.center,D.center),O.radius=D.radius,t(D)&&s(O,D.extrema.map(function(F){return C.clone(F)})),O}e.copy=o;function s(O,D){var F;return O.extrema!==void 0?(O.extrema.length=0,(F=O.extrema).push.apply(F,D)):O.extrema=D,O}e.setExtrema=s;function u(O){for(var D=O.x,F=O.y,G=O.z,N=O.indices,z=0,$=0,j=0,Z=0,q=ke.size(N),te=0;te<q;te++){var he=ke.getAt(N,te);z+=D[he],$+=F[he],j+=G[he]}q>0&&(z/=q,$/=q,j/=q);for(var te=0;te<q;te++){var he=ke.getAt(N,te),W=D[he]-z,K=F[he]-$,U=G[he]-j,H=W*W+K*K+U*U;H>Z&&(Z=H)}return{center:C.create(z,$,j),radius:Math.sqrt(Z)}}e.computeBounding=u;function l(O,D,F){return C.transformMat4(O.center,D.center,F),O.radius=D.radius*ue.getMaxScaleOnAxis(F),t(D)&&s(O,D.extrema.map(function(G){return C.transformMat4(C(),G,F)})),O}e.transform=l;function c(O,D,F){return C.add(O.center,D.center,F),t(D)&&s(O,D.extrema.map(function(G){return C.add(C(),G,F)})),O}e.translate=c;function d(O,D,F){C.toArray(O.center,D,F),D[F+3]=O.radius}e.toArray=d;function f(O,D,F){return C.fromArray(O.center,D,F),O.radius=D[F+3],O}e.fromArray=f;function p(O,D){return C.scale(O.center,C.add(O.center,D.max,D.min),.5),O.radius=C.distance(O.center,D.max),e.setExtrema(O,[C.create(D.min[0],D.min[1],D.min[2]),C.create(D.max[0],D.max[1],D.max[2]),C.create(D.max[0],D.min[1],D.min[2]),C.create(D.min[0],D.max[1],D.max[2]),C.create(D.min[0],D.min[1],D.max[2]),C.create(D.max[0],D.min[1],D.max[2]),C.create(D.max[0],D.max[1],D.min[2]),C.create(D.min[0],D.max[1],D.min[2])]),O}e.fromBox3D=p;function h(O,D){return C.copy(O.center,D.origin),O.radius=Math.max(C.magnitude(D.dirA),C.magnitude(D.dirB),C.magnitude(D.dirC)),O}e.fromAxes3D=h;var v=C();function m(O,D,F){var G=D[0],N=D[1],z=D[2],$=C.create(0,0,0);C.transformMat4($,$,F);var j=C.create(G,N,z);C.transformMat4(j,j,F);var Z=C.create(G,0,0);C.transformMat4(Z,Z,F);var q=C.create(0,N,z);C.transformMat4(q,q,F);var te=C.create(0,0,z);C.transformMat4(te,te,F);var he=C.create(G,0,z);C.transformMat4(he,he,F);var W=C.create(G,N,0);C.transformMat4(W,W,F);var K=C.create(0,N,0);C.transformMat4(K,K,F),C.add(v,$,j),C.scale(v,v,.5);var U=Math.max(C.distance($,j),C.distance(Z,q));return e.set(O,v,U/2),e.setExtrema(O,[$,j,Z,q,te,he,W,K]),O}e.fromDimensionsAndTransform=m;var g=C();function y(O,D,F){var G=C.distance(D.center,F);return G<D.radius?e.copy(O,D):(C.sub(g,D.center,F),C.sub(g,D.center,g),C.setMagnitude(g,g,D.radius),C.scale(O.center,C.add(g,g,F),.5),O.radius=C.distance(O.center,F),O)}e.addVec3=y;function b(O,D,F){return C.copy(O.center,D.center),O.radius=Math.max(D.radius,C.distance(D.center,F.center)+F.radius),t(D)&&t(F)&&s(O,Nt(Nt([],D.extrema.map(function(G){return C.clone(G)})),F.extrema.map(function(G){return C.clone(G)}))),O}e.expandBySphere=b;var x=C();function S(O,D,F){var G,N;return C.copy(O.center,D.center),O.radius=D.radius+F,D.radius<1e-12||((N=(G=D.extrema)===null||G===void 0?void 0:G.length)!==null&&N!==void 0?N:0)<=1?(O.extrema=void 0,O):(t(D)&&s(O,D.extrema.map(function(z){C.sub(x,z,D.center);var $=C.distance(D.center,z);return C.normalize(x,x),C.scaleAndAdd(C(),D.center,x,$+F)})),O)}e.expand=S;function _(O,D){return O.radius===D.radius&&C.exactEquals(O.center,D.center)}e.exactEquals=_;function A(O,D){var F=O.radius,G=D.radius;return Math.abs(F-G)<=fn*Math.max(1,Math.abs(F),Math.abs(G))&&C.equals(O.center,D.center)}e.equals=A;function T(O,D){if(t(D)){for(var F=0,G=D.extrema;F<G.length;F++){var N=G[F];if(C.distance(O.center,N)>O.radius)return!1}return!0}else return C.distance(O.center,D.center)+D.radius<=O.radius}e.includes=T;function I(O,D){return C.distance(O.center,D.center)<=O.radius+D.radius}e.overlaps=I;function M(O,D){return C.distance(O.center,D.center)-O.radius+D.radius}e.distance=M})(Ne||(Ne={}));function Xt(){return Xt.zero()}(function(e){function t(y,b){return{min:y,max:b}}e.create=t;function r(){return{min:C(),max:C()}}e.zero=r;function n(y,b){return C.copy(y.min,b.min),C.copy(y.max,b.max),y}e.copy=n;function a(y){return n(r(),y)}e.clone=a;function i(y,b){if(Ne.hasExtrema(b))return o(y,b.extrema);var x=C.create(b.radius,b.radius,b.radius);return C.sub(y.min,b.center,x),C.add(y.max,b.center,x),y}e.fromSphere3D=i;function o(y,b){e.setEmpty(y);for(var x=0,S=b.length;x<S;x++)e.add(y,b[x]);return y}e.fromVec3Array=o;function s(y){for(var b=C.create(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),x=C.create(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),S=y.x,_=y.y,A=y.z,T=y.indices,I=0,M=ke.size(T);I<M;I++){var O=ke.getAt(T,I);b[0]=Math.min(S[O],b[0]),b[1]=Math.min(_[O],b[1]),b[2]=Math.min(A[O],b[2]),x[0]=Math.max(S[O],x[0]),x[1]=Math.max(_[O],x[1]),x[2]=Math.max(A[O],x[2])}return{min:b,max:x}}e.computeBounding=s;function u(y,b){return C.sub(y,b.max,b.min)}e.size=u;var l=C();function c(y){return u(l,y),l[0]*l[1]*l[2]}e.volume=c;function d(y){return C.set(y.min,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),C.set(y.max,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),y}e.setEmpty=d;function f(y,b){return C.min(y.min,y.min,b),C.max(y.max,y.max,b),y}e.add=f;function p(y,b,x){return C.sub(y.min,b.min,x),C.add(y.max,b.max,x),y}e.expand=p;function h(y,b,x){return C.scale(y.min,b.min,x),C.scale(y.max,b.max,x),y}e.scale=h;var v=C();function m(y,b,x){var S=b.min,_=S[0],A=S[1],T=S[2],I=b.max,M=I[0],O=I[1],D=I[2];return d(y),f(y,C.transformMat4(v,C.set(v,_,A,T),x)),f(y,C.transformMat4(v,C.set(v,_,A,D),x)),f(y,C.transformMat4(v,C.set(v,_,O,T),x)),f(y,C.transformMat4(v,C.set(v,_,O,D),x)),f(y,C.transformMat4(v,C.set(v,M,A,T),x)),f(y,C.transformMat4(v,C.set(v,M,A,D),x)),f(y,C.transformMat4(v,C.set(v,M,O,T),x)),f(y,C.transformMat4(v,C.set(v,M,O,D),x)),y}e.transform=m;function g(y,b){return!(b[0]<y.min[0]||b[0]>y.max[0]||b[1]<y.min[1]||b[1]>y.max[1]||b[2]<y.min[2]||b[2]>y.max[2])}e.containsVec3=g})(Xt||(Xt={}));function Rd(e,t,r){return new m$(e,t,r)}var m$=function(){function e(t,r,n){var a=y$(t,r,n);this.ctx=b$(a),this.boundary={box:a.boundingBox,sphere:a.boundingSphere},this.buckets={offset:a.bucketOffset,count:a.bucketCounts,array:a.bucketArray},this.result=mc.create()}return e.prototype.find=function(t,r,n,a,i){this.ctx.x=t,this.ctx.y=r,this.ctx.z=n,this.ctx.radius=a,this.ctx.isCheck=!1;var o=i!=null?i:this.result;return TP(this.ctx,o),o},e.prototype.check=function(t,r,n,a){return this.ctx.x=t,this.ctx.y=r,this.ctx.z=n,this.ctx.radius=a,this.ctx.isCheck=!0,TP(this.ctx,this.result)},e}();function g$(e){for(var t=e.expandedBox,r=e.size,n=r[0],a=r[1],i=r[2],o=e.data,s=o.x,u=o.y,l=o.z,c=o.radius,d=o.indices,f=e.elementCount,p=e.delta,h=n*a*i,v=t.min,m=v[0],g=v[1],y=v[2],b=0,x=0,S=new Uint32Array(h),_=new Int32Array(f),A=0;A<f;A++){var T=ke.getAt(d,A),I=Math.floor((s[T]-m)/p[0]),M=Math.floor((u[T]-g)/p[1]),O=Math.floor((l[T]-y)/p[2]),D=(I*a+M)*i+O;(S[D]+=1)===1&&(x+=1),_[A]=D}if(c)for(var A=0;A<f;A++){var T=ke.getAt(d,A);c[T]>b&&(b=c[T])}for(var F=new Int32Array(x),T=0,G=0;T<h;T++){var N=S[T];N>0&&(S[T]=G+1,F[G]=N,G+=1)}for(var z=new Uint32Array(x),T=1;T<x;++T)z[T]+=z[T-1]+F[T-1];for(var $=new Int32Array(x),j=new Int32Array(f),T=0;T<f;T++){var Z=S[_[T]];if(Z>0){var q=Z-1;j[z[q]+$[q]]=T,$[q]+=1}}return{size:e.size,bucketArray:j,bucketCounts:F,bucketOffset:z,grid:S,delta:p,min:e.expandedBox.min,data:e.data,maxRadius:b,expandedBox:e.expandedBox,boundingBox:e.boundingBox,boundingSphere:e.boundingSphere}}function y$(e,t,r){var n=Xt.expand(Xt(),t.box,C.create(.5,.5,.5)),a=e.indices,i=Xt.size(C.zero(),n),o,s,u=ke.size(a),l=typeof r=="number"?r:32,c=Array.isArray(r)&&r;if(c)s=[Math.ceil(i[0]/c[0]),Math.ceil(i[1]/c[1]),Math.ceil(i[2]/c[2])],o=c;else if(u>0){var d=Math.ceil(u/l),f=Math.pow(d/(i[0]*i[1]*i[2]),1/3);s=[Math.ceil(i[0]*f),Math.ceil(i[1]*f),Math.ceil(i[2]*f)],o=[i[0]/s[0],i[1]/s[1],i[2]/s[2]]}else o=i,s=[1,1,1];var p={x:e.x,y:e.y,z:e.z,indices:a,radius:e.radius},h={size:s,data:p,expandedBox:n,boundingBox:t.box,boundingSphere:t.sphere,elementCount:u,delta:o};return g$(h)}function b$(e){return{grid:e,x:.1,y:.1,z:.1,radius:.1,isCheck:!1}}function TP(e,t){var r=e.grid,n=r.min,a=r.size,i=a[0],o=a[1],s=a[2],u=r.bucketOffset,l=r.bucketCounts,c=r.bucketArray,d=r.grid,f=r.data,p=f.x,h=f.y,v=f.z,m=f.indices,g=f.radius,y=r.delta,b=r.maxRadius,x=e.radius,S=e.isCheck,_=e.x,A=e.y,T=e.z,I=x+b,M=I*I;mc.reset(t);var O=Math.max(0,Math.floor((_-I-n[0])/y[0])),D=Math.max(0,Math.floor((A-I-n[1])/y[1])),F=Math.max(0,Math.floor((T-I-n[2])/y[2])),G=Math.min(i-1,Math.floor((_+I-n[0])/y[0])),N=Math.min(o-1,Math.floor((A+I-n[1])/y[1])),z=Math.min(s-1,Math.floor((T+I-n[2])/y[2]));if(O>G||D>N||F>z)return!1;for(var $=O;$<=G;$++)for(var j=D;j<=N;j++)for(var Z=F;Z<=z;Z++){var q=d[($*o+j)*s+Z];if(q!==0)for(var te=q-1,he=u[te],W=l[te],K=he+W,U=he;U<K;U++){var H=ke.getAt(m,c[U]),J=p[H]-_,X=h[H]-A,Q=v[H]-T,ee=J*J+X*X+Q*Q;if(ee<=M){if(b>0&&Math.sqrt(ee)-g[H]>x)continue;if(S)return!0;mc.add(t,c[U],ee)}}}return t.count>0}function Qo(){return Qo.empty()}(function(e){function t(d,f,p,h){return{origin:d,dirA:f,dirB:p,dirC:h}}e.create=t;function r(){return{origin:C(),dirA:C(),dirB:C(),dirC:C()}}e.empty=r;function n(d,f){return C.copy(d.origin,f.origin),C.copy(d.dirA,f.dirA),C.copy(d.dirB,f.dirB),C.copy(d.dirC,f.dirC),d}e.copy=n;function a(d){return n(r(),d)}e.clone=a;function i(d,f){return C.set(d,C.magnitude(f.dirA)*2,C.magnitude(f.dirB)*2,C.magnitude(f.dirC)*2)}e.size=i;var o=C();function s(d){return i(o,d),o[0]*o[1]*o[2]}e.volume=s;function u(d,f){return C.copy(d.origin,f.origin),C.normalize(d.dirA,f.dirA),C.normalize(d.dirB,f.dirB),C.normalize(d.dirC,f.dirC),d}e.normalize=u;var l=Mn.zero();function c(d,f,p){C.transformMat4(d.origin,f.origin,p);var h=Mn.directionTransform(l,p);return C.transformMat3(d.dirA,f.dirA,h),C.transformMat3(d.dirB,f.dirB,h),C.transformMat3(d.dirC,f.dirC,h),d}e.transform=c})(Qo||(Qo={}));function qr(e){return function(t){return n3(e,t)}}function n3(e,t){var r=e.data,n=e.indices,a=e.count,i=t.valueType,o=i==="str"?function(s){return r.substring(n[2*s],n[2*s+1])}:i==="int"?function(s){return sc(r,n[2*s],n[2*s+1])||0}:function(s){return Mu(r,n[2*s],n[2*s+1])||0};return{schema:t,__array:void 0,isDefined:!0,rowCount:a,value:o,valueKind:function(s){return 0},toArray:function(s){return Ta(a,o,s)},areValuesEqual:_6(e)}}function _6(e){var t=e.data,r=e.indices;return function(n,a){var i=r[2*n],o=r[2*a],s=r[2*n+1]-i;if(s!==r[2*a+1]-o)return!1;for(var u=0;u<s;u++)if(t.charCodeAt(u+i)!==t.charCodeAt(u+o))return!1;return!0}}function w6(e,t){return{name:t,blocks:e}}function a3(e,t,r,n){return n===void 0&&(n=[]),{categoryNames:e,header:r,categories:t,saveFrames:n,getField:function(a){var i=a.split("."),o=i[0],s=i[1];return t[o].getField(s||"")}}}function S$(e,t,r){return{categoryNames:e,header:r,categories:t}}function Oa(e,t,r,n){return{rowCount:t,name:e,fieldNames:Nt([],r),getField:function(a){return n[a]}}}(function(e){function t(a){return{rowCount:0,name:a,fieldNames:[],getField:function(i){}}}e.empty=t;function r(a,i){var o=Object.keys(i);return{rowCount:o.length>0?i[o[0]].rowCount:0,name:a,fieldNames:o,getField:function(s){return i[s]}}}e.ofFields=r;function n(a,i){for(var o={},s=0,u=i._columns;s<u.length;s++){var l=u[s];o[l]=xt.ofColumn(i[l])}return r(a,o)}e.ofTable=n})(Oa||(Oa={}));var xt;(function(e){function t(s){return r([s])}e.ofString=t;function r(s){var u=s.length,l=function(p){var h=s[p];return!h||h==="."||h==="?"?"":h},c=function(p){var h=s[p];return sc(h,0,h.length)||0},d=function(p){var h=s[p];return Mu(h,0,h.length)||0},f=function(p){var h=s[p],v=h.length;if(v>1)return 0;if(v===0)return 1;var m=h.charCodeAt(0);return m===46?1:m===63?2:0};return{__array:void 0,binaryEncoding:void 0,isDefined:!0,rowCount:u,str:l,int:c,float:d,valueKind:f,areValuesEqual:function(p,h){return s[p]===s[h]},toStringArray:function(p){return p?Ta(u,l,p):s},toIntArray:function(p){return Ta(u,c,p)},toFloatArray:function(p){return Ta(u,d,p)}}}e.ofStrings=r;function n(s){var u=s.length,l=function(p){return""+s[p]},c=function(p){return s[p]},d=function(p){return 0},f=function(p){return!p||p.array&&s instanceof p.array?s:Ta(u,c,p)};return{__array:void 0,binaryEncoding:void 0,isDefined:!0,rowCount:u,str:l,int:c,float:c,valueKind:d,areValuesEqual:function(p,h){return s[p]===s[h]},toStringArray:function(p){return Ta(u,l,p)},toIntArray:f,toFloatArray:f}}e.ofNumbers=n;function a(s){var u=s.data,l=s.indices,c=s.count,d=function(v){var m=u.substring(l[2*v],l[2*v+1]);return m==="."||m==="?"?"":m},f=function(v){return sc(u,l[2*v],l[2*v+1])||0},p=function(v){return Mu(u,l[2*v],l[2*v+1])||0},h=function(v){var m=l[2*v],g=l[2*v+1]-m;if(g>1)return 0;if(g===0)return 1;var y=u.charCodeAt(m);return y===46?1:y===63?2:0};return{__array:void 0,binaryEncoding:void 0,isDefined:!0,rowCount:c,str:d,int:f,float:p,valueKind:h,areValuesEqual:_6(s),toStringArray:function(v){return Ta(c,d,v)},toIntArray:function(v){return Ta(c,f,v)},toFloatArray:function(v){return Ta(c,p,v)}}}e.ofTokens=a;function i(s){var u=s.rowCount,l=s.valueKind,c=s.areValuesEqual,d=s.isDefined,f,p,h;switch(s.schema.valueType){case"float":case"int":f=function(m){return""+s.value(m)},p=s.value,h=s.value;break;case"str":f=s.value,p=function(m){var g=s.value(m);return sc(g,0,g.length)||0},h=function(m){var g=s.value(m);return Mu(g,0,g.length)||0};break;case"list":var v=s.schema.separator;f=function(m){return s.value(m).join(v)},p=function(m){return NaN},h=function(m){return NaN};break;default:throw new Error("unsupported valueType '"+s.schema.valueType+"'")}return{__array:void 0,binaryEncoding:void 0,isDefined:d,rowCount:u,str:f,int:p,float:h,valueKind:l,areValuesEqual:c,toStringArray:function(m){return Ta(u,f,m)},toIntArray:function(m){return Ta(u,p,m)},toFloatArray:function(m){return Ta(u,h,m)}}}e.ofColumn=i;function o(s,u){return i(ve.Undefined(s,u))}e.ofUndefined=o})(xt||(xt={}));function x$(e,t,r,n){var a=r?0:1;switch(t){case 1:return n==="brackets"?function(i){return e+"["+(i+a)+"]"}:function(i){return e+"_"+(i+a)};case 2:return n==="brackets"?function(i,o){return e+"["+(i+a)+"]["+(o+a)+"]"}:function(i,o){return e+"_"+(i+a)+(o+a)};case 3:return n==="brackets"?function(i,o,s){return e+"["+(i+a)+"]["+(o+a)+"]["+(s+a)+"]"}:function(i,o,s){return e+"_"+(i+a)+(o+a)+(s+a)};default:throw new Error("Tensors with rank > 3 or rank 0 are currently not supported.")}}function C$(e,t,r,n){var a=t.create();if(t.rank===1)for(var i=t.dimensions[0],o=0;o<i;o++){var s=e.getField(n(o));t.set(a,o,s?s.float(r):0)}else if(t.rank===2)for(var i=t.dimensions[0],u=t.dimensions[1],o=0;o<i;o++)for(var l=0;l<u;l++){var s=e.getField(n(o,l));t.set(a,o,l,s?s.float(r):0)}else if(t.rank===3)for(var c=t.dimensions[0],d=t.dimensions[1],f=t.dimensions[2],o=0;o<c;o++)for(var l=0;l<d;l++)for(var p=0;p<f;p++){var s=e.getField(n(o,l,p));t.set(a,o,l,p,s?s.float(r):0)}else throw new Error("Tensors with rank > 3 or rank 0 are currently not supported.");return a}function Et(e){return{data:e,position:0,length:e.length,lineNumber:1,tokenStart:0,tokenEnd:0}}(function(e){function t(y){return y.data.substring(y.tokenStart,y.tokenEnd)}e.getTokenString=t;function r(y){y.position=0,y.lineNumber=1,y.tokenStart=0,y.tokenEnd=0}e.reset=r;function n(y){for(var b=y.data;y.position<y.length;)switch(b.charCodeAt(y.position)){case 10:return y.tokenEnd=y.position,++y.position,++y.lineNumber,!0;case 13:return y.tokenEnd=y.position,++y.position,++y.lineNumber,b.charCodeAt(y.position)===10&&++y.position,!0;default:++y.position;break}return y.tokenEnd=y.position,y.tokenStart!==y.tokenEnd}e.eatLine=n;function a(y){y.tokenStart=y.position}e.markStart=a;function i(y){return y.tokenStart=y.position,n(y)}e.markLine=i;function o(y){return i(y),t(y)}e.readLine=o;function s(y){i(y);var b=y.position;return g(y,y.tokenStart,y.tokenEnd),y.position=b,t(y)}e.readLineTrim=s;function u(y,b,x){for(var S=0,_=0;_<b;_++){if(!i(y))return S;pt.addUnchecked(x,y.tokenStart,y.tokenEnd),S++}return S}function l(y,b){var x=pt.create(y.data,b*2);return u(y,b,x),x}e.markLines=l;function c(y,b){for(var x=[],S=0;S<b;S++)x.push(e.readLine(y));return x}e.readLines=c;function d(y,b,x,S){return S===void 0&&(S=1e5),ce(this,void 0,void 0,function(){var _,A,T;return de(this,function(I){switch(I.label){case 0:return _=y.length,A=pt.create(y.data,b*2),T=0,[4,Uu(x,S,y,function(M,O){var D=Math.min(b-T,M);return u(O,D,A),T+=D,D},function(M,O){return M.update({message:"Parsing...",current:O.position,max:_})})];case 1:return I.sent(),[2,A]}})})}e.readLinesAsync=d;function f(y){for(var b=e(y),x=pt.create(b.data,Math.max(y.length/80,2));i(b);)pt.add(x,b.tokenStart,b.tokenEnd);return x}e.readAllLines=f;function p(y,b,x){for(var S=0,_=0;_<b;_++){if(!i(y))return S;pt.add(x,y.tokenStart,y.tokenEnd),S++}return S}function h(y,b,x){return x===void 0&&(x=1e5),ce(this,void 0,void 0,function(){var S,_;return de(this,function(A){switch(A.label){case 0:return S=e(y),_=pt.create(S.data,Math.max(y.length/80,2)),[4,Uu(b,x,S,function(T,I){return p(I,T,_),I.position<I.length?T:0},function(T,I){return T.update({message:"Parsing...",current:I.position,max:length})})];case 1:return A.sent(),[2,_]}})})}e.readAllLinesAsync=h;function v(y){for(;y.position<y.length;)switch(y.data.charCodeAt(y.position)){case 9:case 10:case 13:case 32:y.tokenEnd=y.position;return;default:++y.position;break}y.tokenEnd=y.position}e.eatValue=v;function m(y){for(var b=-1;y.position<y.length;){var x=y.data.charCodeAt(y.position);switch(x){case 9:case 32:b=x,++y.position;break;case 10:b!==13&&++y.lineNumber,b=x,++y.position;break;case 13:b=x,++y.position,++y.lineNumber;break;default:return b}}return b}e.skipWhitespace=m;function g(y,b,x){for(var S=y.data,_=b,A=x-1,T=S.charCodeAt(_);(T===9||T===32)&&_<=A;)T=S.charCodeAt(++_);for(T=S.charCodeAt(A);(T===9||T===32)&&A>=_;)T=S.charCodeAt(--A);return y.tokenStart=_,y.tokenEnd=A+1,y.position=x,y}e.trim=g})(Et||(Et={}));function _$(e,t,r){for(var n=t,a=r-1,i=e.charCodeAt(n);(i===9||i===32)&&n<=a;)i=e.charCodeAt(++n);for(i=e.charCodeAt(a);(i===9||i===32)&&a>=n;)i=e.charCodeAt(--a);return e.substring(n,a+1)}var pt;(function(e){function t(o){var s=new Uint32Array(1.61*o.indices.length|0);s.set(o.indices),o.indices=s,o.indicesLenMinus2=s.length-2|0}function r(o,s,u){var l=o;l.offset>l.indicesLenMinus2&&t(l),l.indices[l.offset++]=s,l.indices[l.offset++]=u,o.count++}e.add=r;function n(o,s){r(o,s.tokenStart,s.tokenEnd)}e.addToken=n;function a(o,s,u){o.indices[o.offset++]=s,o.indices[o.offset++]=u,o.count++}e.addUnchecked=a;function i(o,s){return s=Math.max(10,s),{data:o,indicesLenMinus2:s-2|0,count:0,offset:0,indices:new Uint32Array(s)}}e.create=i})(pt||(pt={}));var bn;(function(e){function t(i,o){return o===void 0&&(o=-1),new n(i,o)}e.error=t;function r(i,o){return o===void 0&&(o=[]),new a(i,o)}e.success=r;var n=function(){function i(o,s){this.message=o,this.line=s,this.isError=!0}return i.prototype.toString=function(){return this.line>=0?"[Line "+this.line+"] "+this.message:this.message},i}();e.Error=n;var a=function(){function i(o,s){this.result=o,this.warnings=s,this.isError=!1}return i}();e.Success=a})(bn||(bn={}));function EP(e){for(;e.position<e.length;)switch(e.data.charCodeAt(e.position)){case 9:case 10:case 13:case 32:e.tokenEnd=e.position;return;default:++e.position;break}e.tokenEnd=e.position}function w$(e,t){var r,n;for(++e.position;e.position<e.length;)if(n=e.data.charCodeAt(e.position),n===t)switch(r=e.data.charCodeAt(e.position+1),r){case 9:case 10:case 13:case 32:e.tokenStart++,e.tokenEnd=e.position,e.isEscaped=!0,++e.position;return;default:if(r===void 0){e.tokenStart++,e.tokenEnd=e.position,e.isEscaped=!0,++e.position;return}++e.position;break}else{if(n===10||n===13){e.tokenEnd=e.position;return}++e.position}e.tokenEnd=e.position}function A$(e){for(e.position+=3;e.position<e.length;){if(e.data.charCodeAt(e.position)===39&&A6(e)){e.tokenStart+=3,e.tokenEnd=e.position,e.isEscaped=!0,e.position+=3;return}++e.position}e.tokenEnd=e.position}function P$(e){for(var t=59,r=e.position+1,n;r<e.length;)if(n=e.data.charCodeAt(r),n===59&&(t===10||t===13)){for(e.position=r+1,e.tokenStart++,r--,n=e.data.charCodeAt(r);n===10||n===13;)r--,n=e.data.charCodeAt(r);e.tokenEnd=r+1,e.isEscaped=!0;return}else(n===13||n===10&&t!==13)&&e.lineNumber++,t=n,++r;return e.position=r,t}function T$(e){for(;e.position<e.length;)switch(e.data.charCodeAt(e.position)){case 93:++e.position,e.tokenEnd=e.position,e.isImportGet=!1;return;default:++e.position;break}}function E$(e){for(;e.position<e.length;){var t=e.data.charCodeAt(e.position);if(t===10||t===13)return;++e.position}}function I$(e){for(var t=10;e.position<e.length;){var r=e.data.charCodeAt(e.position);switch(r){case 9:case 32:t=r,++e.position;break;case 10:t!==13&&++e.lineNumber,t=r,++e.position;break;case 13:t=r,++e.position,++e.lineNumber;break;default:return t}}return t}function A6(e){return!(e.length-e.position<2||e.data.charCodeAt(e.position+1)!==39||e.data.charCodeAt(e.position+2)!==39)}function M$(e){var t=e.data.charCodeAt(e.tokenStart);return!(t!==68&&t!==100||(t=e.data.charCodeAt(e.tokenStart+1),t!==65&&t!==97)||(t=e.data.charCodeAt(e.tokenStart+2),t!==84&&t!==116)||(t=e.data.charCodeAt(e.tokenStart+3),t!==65&&t!==97))}function D$(e){var t=e.data.charCodeAt(e.tokenStart);return!(t!==83&&t!==115||(t=e.data.charCodeAt(e.tokenStart+1),t!==65&&t!==97)||(t=e.data.charCodeAt(e.tokenStart+2),t!==86&&t!==118)||(t=e.data.charCodeAt(e.tokenStart+3),t!==69&&t!==101))}function R$(e){if(e.tokenEnd-e.tokenStart!==5)return!1;var t=e.data.charCodeAt(e.tokenStart);return!(t!==76&&t!==108||(t=e.data.charCodeAt(e.tokenStart+1),t!==79&&t!==111)||(t=e.data.charCodeAt(e.tokenStart+2),t!==79&&t!==111)||(t=e.data.charCodeAt(e.tokenStart+3),t!==80&&t!==112))}function O$(e){return!(e.tokenEnd-e.tokenStart!==11||e.data.charCodeAt(e.tokenStart+1)!==105||e.data.charCodeAt(e.tokenStart+2)!==109||e.data.charCodeAt(e.tokenStart+3)!==112||e.data.charCodeAt(e.tokenStart+4)!==111||e.data.charCodeAt(e.tokenStart+5)!==114||e.data.charCodeAt(e.tokenStart+6)!==116||e.data.charCodeAt(e.tokenStart+7)!==46||e.data.charCodeAt(e.tokenStart+8)!==103||e.data.charCodeAt(e.tokenStart+9)!==101||e.data.charCodeAt(e.tokenStart+10)!==116)}function F$(e,t,r){var n,a=r-t,i=e.tokenStart-t,o=e.tokenEnd-e.tokenStart;if(o<a)return!1;for(n=t;n<r;++n)if(e.data.charCodeAt(n)!==e.data.charCodeAt(n+i))return!1;return a===o||e.data.charCodeAt(n+i)===46}function P6(e){var t;for(t=e.tokenStart;t<e.tokenEnd;++t)if(e.data.charCodeAt(t)===46)return t;return t}function T6(e,t){return e.data.substring(e.tokenStart,t)}function k$(e){var t;for(t=e.tokenStart;t<e.tokenEnd;++t)if(e.data.charCodeAt(t)===46)return!1;return!0}function wx(e){return e.data.substring(e.tokenStart,e.tokenEnd)}function IP(e){var t=I$(e);if(e.position>=e.length){e.tokenType=6;return}e.tokenStart=e.position,e.tokenEnd=e.position,e.isEscaped=!1;var r=e.data.charCodeAt(e.position);switch(r){case 35:E$(e),e.tokenType=5;break;case 39:if(A6(e)){A$(e),e.tokenType=3;break}case 34:w$(e,r),e.tokenType=3;break;case 59:t===10||t===13?P$(e):EP(e),e.tokenType=3;break;default:e.isImportGet?T$(e):EP(e),e.isEscaped?e.tokenType=3:e.data.charCodeAt(e.tokenStart)===95?(e.inSaveFrame&&O$(e)&&(e.isImportGet=!0),e.tokenType=4):e.tokenEnd-e.tokenStart>=5&&e.data.charCodeAt(e.tokenStart+4)===95?M$(e)?e.tokenType=0:D$(e)?e.tokenType=1:R$(e)?e.tokenType=2:e.tokenType=3:e.tokenType=3;break}}function lc(e){for(IP(e);e.tokenType===5;)IP(e)}function B$(e,t){return{data:e,length:e.length,position:0,tokenStart:0,tokenEnd:0,tokenType:6,lineNumber:1,isEscaped:!1,isImportGet:!1,inSaveFrame:!1,runtimeCtx:t}}function xm(){return{categoryNames:[],categoryData:Object.create(null)}}function i3(e,t){for(var r=Object.create(null),n=0,a=e;n<a.length;n++){var i=a[n],o=t[i];r[i]=Oa(o.name,o.rowCount,o.fieldNames,o.fields)}return r}function MP(e,t,r){return a3(e.categoryNames,i3(e.categoryNames,e.categoryData),t,r)}function L$(e,t){return a3(e.categoryNames,i3(e.categoryNames,e.categoryData),t)}function Ax(e,t,r,n,a){var i;if(t in e.categoryData){var o=e.categoryData[t];(i=o.fieldNames).push.apply(i,n),Object.assign(o.fields,a)}else e.categoryData[t]={name:t,rowCount:r,fieldNames:n,fields:a},e.categoryNames.push(t)}function N$(e,t){for(var r=e.tokenStart,n=P6(e),a=T6(e,n),i=Object.create(null),o=[],s=!0;s;){if(e.tokenType!==4||!F$(e,r,n)){s=!1;break}var u=wx(e).substring(a.length+1);if(lc(e),e.tokenType!==3)return{hasError:!0,errorLine:e.lineNumber,errorMessage:"Expected value."};i[u]=xt.ofTokens({data:e.data,indices:[e.tokenStart,e.tokenEnd],count:1}),o[o.length]=u,lc(e)}return Ax(t,a.substr(1),1,o,i),{hasError:!1,errorLine:0,errorMessage:""}}function U$(e,t){for(var r=t.tokenizer,n=t.tokens,a=t.fieldCount,i=t.tokenCount,o=0;r.tokenType===3&&o<e;)pt.add(n[i++%a],r.tokenStart,r.tokenEnd),lc(r),o++;return t.tokenCount=i,o}function z$(e,t){return e.update({message:"Parsing...",current:t.tokenizer.position,max:t.tokenizer.data.length})}function V$(e,t){return ce(this,void 0,void 0,function(){var r,n,a,i,o,s,u,f,l,c,f,d,d,f;return de(this,function(p){switch(p.label){case 0:for(r=e.lineNumber,lc(e),n=T6(e,P6(e)),a=k$(e),i=[];e.tokenType===4;)i[i.length]=a?wx(e):wx(e).substring(n.length+1),lc(e);for(o=n==="_atom_site"?e.data.length/100|0:32,s=[],u=i.length,f=0;f<u;f++)s[f]=pt.create(e.data,o);return l={fieldCount:u,tokenCount:0,tokenizer:e,tokens:s},[4,Uu(e.runtimeCtx,1e6,l,U$,z$)];case 1:if(p.sent(),l.tokenCount%u!==0)return[2,{hasError:!0,errorLine:e.lineNumber,errorMessage:"The number of values for loop starting at line "+r+" is not a multiple of the number of columns."}];if(c=l.tokenCount/u|0,a)for(f=0;f<u;f++)d={"":xt.ofTokens(s[f])},Ax(t,i[f].substr(1),c,[""],d);else{for(d=Object.create(null),f=0;f<u;f++)d[i[f]]=xt.ofTokens(s[f]);Ax(t,n.substr(1),c,i,d)}return[2,{hasError:!1,errorLine:0,errorMessage:""}]}})})}function xf(e,t){return bn.error(t,e)}function H$(e){return bn.success(e)}function G$(e,t){return ce(this,void 0,void 0,function(){var r,n,a,i,o,s,u,l,c,d,d;return de(this,function(f){switch(f.label){case 0:r=[],n=B$(e,t),a="",i=xm(),o=[],s=xm(),u=S$(s.categoryNames,i3(s.categoryNames,s.categoryData),""),l="",t.update({message:"Parsing...",current:0,max:e.length}),lc(n),f.label=1;case 1:return n.tokenType===6?[3,7]:(c=n.tokenType,c!==0?[3,2]:n.inSaveFrame?[2,xf(n.lineNumber,"Unexpected data block inside a save frame.")]:(i.categoryNames.length>0&&r.push(MP(i,a,o)),a=e.substring(n.tokenStart+5,n.tokenEnd),i=xm(),o=[],lc(n),[3,6]));case 2:if(c!==1)return[3,3];if(n.tokenEnd-n.tokenStart===5)s.categoryNames.length>0&&(o[o.length]=L$(s,l)),n.inSaveFrame=!1;else{if(n.inSaveFrame)return[2,xf(n.lineNumber,"Save frames cannot be nested.")];n.inSaveFrame=!0,l=e.substring(n.tokenStart+5,n.tokenEnd),s=xm()}return lc(n),[3,6];case 3:return c!==2?[3,5]:[4,V$(n,n.inSaveFrame?s:i)];case 4:return d=f.sent(),d.hasError?[2,xf(d.errorLine,d.errorMessage)]:[3,6];case 5:if(c===4){if(d=N$(n,n.inSaveFrame?s:i),d.hasError)return[2,xf(d.errorLine,d.errorMessage)]}else return console.log(n.tokenType,Et.getTokenString(n)),[2,xf(n.lineNumber,"Unexpected token. Expected data_, loop_, or data name.")];f.label=6;case 6:return[3,1];case 7:return n.inSaveFrame?[2,xf(n.lineNumber,"Unfinished save frame ("+u.header+").")]:((i.categoryNames.length>0||o.length>0)&&r.push(MP(i,a,o)),[2,H$(w6(r))])}})})}function DP(e){var t=this;return We.create("Parse CIF",function(r){return ce(t,void 0,void 0,function(){return de(this,function(n){switch(n.label){case 0:return[4,G$(e,r)];case 1:return[2,n.sent()]}})})})}var q$=new Uint16Array(new Uint8Array([18,52]).buffer)[0]===13330;function j$(e,t){for(var r=new ArrayBuffer(e.length),n=new Uint8Array(r),a=0,i=e.length;a<i;a+=t)for(var o=0;o<t;o++)n[a+t-o-1]=e[a+o];return r}var Nb=28672;function W$(e){if(e.length>Nb){for(var t=[],r=0;r<e.length;r+=Nb)t.push(String.fromCharCode.apply(null,e.subarray(r,r+Nb)));return t.join("")}else return String.fromCharCode.apply(null,e)}function pg(e){for(var t=e.data,r=e.encoding.length-1;r>=0;r--)t=X$(t,e.encoding[r]);return t}function X$(e,t){switch(t.kind){case"ByteArray":switch(t.type){case 4:return e;case 1:return Y$(e);case 2:return K$(e);case 5:return $$(e);case 3:return Q$(e);case 6:return Z$(e);case 32:return J$(e);case 33:return eQ(e);default:throw new Error("Unsupported ByteArray type.")}case"FixedPoint":return tQ(e,t);case"IntervalQuantization":return rQ(e,t);case"RunLength":return nQ(e,t);case"Delta":return aQ(e,t);case"IntegerPacking":return sQ(e,t);case"StringArray":return uQ(e,t)}}function E6(e,t){switch(e){case 1:return new Int8Array(t);case 2:return new Int16Array(t);case 3:return new Int32Array(t);case 4:return new Uint8Array(t);case 5:return new Uint16Array(t);case 6:return new Uint32Array(t);default:throw new Error("Unsupported integer data type.")}}function I6(e,t){switch(e){case 32:return new Float32Array(t);case 33:return new Float64Array(t);default:throw new Error("Unsupported floating data type.")}}function Y$(e){return new Int8Array(e.buffer,e.byteOffset)}function Mp(e,t,r){return q$?new r(e.buffer):new r(j$(e,t))}function K$(e){return Mp(e,2,Int16Array)}function $$(e){return Mp(e,2,Uint16Array)}function Q$(e){return Mp(e,4,Int32Array)}function Z$(e){return Mp(e,4,Uint32Array)}function J$(e){return Mp(e,4,Float32Array)}function eQ(e){return Mp(e,8,Float64Array)}function tQ(e,t){for(var r=e.length,n=I6(t.srcType,r),a=1/t.factor,i=0;i<r;i++)n[i]=a*e[i];return n}function rQ(e,t){for(var r=e.length,n=I6(t.srcType,r),a=(t.max-t.min)/(t.numSteps-1),i=t.min,o=0;o<r;o++)n[o]=i+a*e[o];return n}function nQ(e,t){for(var r=E6(t.srcType,t.srcSize),n=0,a=0,i=e.length;a<i;a+=2)for(var o=e[a],s=e[a+1],u=0;u<s;++u)r[n++]=o;return r}function aQ(e,t){var r=e.length,n=E6(t.srcType,r);if(!r)return e;n[0]=e[0]+(t.origin|0);for(var a=1;a<r;++a)n[a]=e[a]+n[a-1];return n}function iQ(e,t){for(var r=t.byteCount===1?127:32767,n=-r-1,a=e.length,i=new Int32Array(t.srcSize),o=0,s=0;o<a;){for(var u=0,l=e[o];l===r||l===n;)u+=l,o++,l=e[o];u+=l,i[s]=u,o++,s++}return i}function oQ(e,t){for(var r=t.byteCount===1?255:65535,n=e.length,a=new Int32Array(t.srcSize),i=0,o=0;i<n;){for(var s=0,u=e[i];u===r;)s+=u,i++,u=e[i];s+=u,a[o]=s,i++,o++}return a}function sQ(e,t){return e.length===t.srcSize?e:t.isUnsigned?oQ(e,t):iQ(e,t)}function uQ(e,t){var r=pg({encoding:t.offsetEncoding,data:t.offsets}),n=pg({encoding:t.dataEncoding,data:e}),a=t.stringData,i=new Array(r.length);i[0]="";for(var o=1,s=r.length;o<s;o++)i[o]=a.substring(r[o-1],r[o]);for(var u=0,l=new Array(n.length),o=0,s=n.length;o<s;o++)l[u++]=i[n[o]+1];return l}var lQ="0.3.0",Vl;(function(e){function t(n){var a;return n instanceof Int8Array?a=1:n instanceof Int16Array?a=2:n instanceof Int32Array?a=3:n instanceof Uint8Array?a=4:n instanceof Uint16Array?a=5:n instanceof Uint32Array?a=6:n instanceof Float32Array?a=32:n instanceof Float64Array?a=33:a=3,a}e.getDataType=t;function r(n){if(n instanceof Int8Array||n instanceof Int16Array||n instanceof Int32Array)return!0;for(var a=0,i=n.length;a<i;a++)if(a<0)return!1;return!0}e.isSignedIntegerDataType=r})(Vl||(Vl={}));function cQ(e,t,r){var n=1,a;for(a=0;a<t;a++){var i=n*e;if(Math.abs(Math.round(i)-i)<=r)return a;n*=10}return-1}function dQ(e,t){var r=Math.abs(e);return r<t?0:Math.floor(Math.log10(Math.abs(e)))+1}function fQ(e,t,r){for(var n=1,a=0,i=0,o=e.length;i<o;i++){if(n>=0){var s=cQ(e[i],t,r);s<0?n=-1:s>n&&(n=s)}var u=Math.abs(e[i]);if(u>r){var l=Math.floor(Math.log10(Math.abs(u)))+1;l>a&&(a=l)}}return{mantissaDigits:n,integerDigits:a}}function pQ(e){e=e.trim();var t=parseInt(e,10);return isNaN(t)?!1:t.toString()===e}function hg(e){if(!isFinite(e))return 0;for(var t=1,r=0;Math.round(e*t)/t!==e;)t*=10,++r;return r}function Px(e,t){return parseFloat(e.toPrecision(t))}function Tx(e){return hv.classify(e)}function hQ(e){return Ex.classify(e)}var hv;(function(e){function t(p,h){return p>=0?Math.ceil((p+1)/h):Math.ceil((p+1)/(-h-1))}function r(p){for(var h=!1,v=0,m=p.length;v<m;v++)if(p[v]<0){h=!0;break}return h?{signed:h,limit8:127,limit16:32767}:{signed:h,limit8:255,limit16:65535}}function n(){return{pack8:0,pack16:0,count:0}}function a(p,h,v){var m=p.limit8,g=p.limit16;h.pack8+=t(v,m),h.pack16+=t(v,g),h.count+=1}function i(p,h){p.pack8+=t(h,127),p.pack16+=t(h,32767),p.count+=1}function o(p){return p.count*4<p.pack16*2?{length:p.count*4,elem:4}:p.pack16*2<p.pack8?{length:p.pack16*2,elem:2}:{length:p.pack8,elem:1}}function s(p,h){for(var v=n(),m=0,g=p.length;m<g;m++)a(h,v,p[m]);return w(w({},o(v)),{kind:"pack"})}function u(p,h){for(var v=n(),m=p[0],g=1,y=p.length;g<y;g++)i(v,p[g]-m),m=p[g];return w(w({},o(v)),{kind:"delta"})}function l(p,h){for(var v=n(),m=1,g=1,y=p.length;g<y;g++)p[g-1]!==p[g]?(a(h,v,p[g-1]),a(h,v,m),m=1):m++;return a(h,v,p[p.length-1]),a(h,v,m),w(w({},o(v)),{kind:"rle"})}function c(p,h){for(var v=n(),m=1,g=0,y=0,b=1,x=p.length;b<x;b++){var S=p[b]-g;y!==S?(i(v,y),i(v,m),m=1):m++,y=S,g=p[b]}return i(v,y),i(v,m),w(w({},o(v)),{kind:"delta-rle"})}function d(p){var h=r(p),v=[s(p,h),l(p,h),u(p),c(p)];return v.sort(function(m,g){return m.length-g.length}),v}e.getSize=d;function f(p){if(p.length<2)return mr.by(mr.byteArray);var h=d(p),v=h[0];switch(v.kind){case"pack":return mr.by(mr.integerPacking);case"rle":return mr.by(mr.runLength).and(mr.integerPacking);case"delta":return mr.by(mr.delta).and(mr.integerPacking);case"delta-rle":return mr.by(mr.delta).and(mr.runLength).and(mr.integerPacking)}throw new Error("should not happen :)")}e.classify=f})(hv||(hv={}));var Ex;(function(e){var t=1e-6;function r(a){var i=4,o=fQ(a,i,t),s=o.mantissaDigits,u=o.integerDigits;if(s<0||s+u>10)return mr.by(mr.byteArray);if(s===0)return hv.classify(a);for(var l=n(s),c=new Int32Array(a.length),d=0,f=a.length;d<f;d++)c[d]=Math.round(l*a[d]);var p=hv.getSize(c),h=p[0],v=mr.by(mr.fixedPoint(l));switch(h.kind){case"pack":return v.and(mr.integerPacking);case"rle":return v.and(mr.runLength).and(mr.integerPacking);case"delta":return v.and(mr.delta).and(mr.integerPacking);case"delta-rle":return v.and(mr.delta).and(mr.runLength).and(mr.integerPacking)}throw new Error("should not happen :)")}e.classify=r;function n(a){for(var i=1,o=0;o<a;o++)i*=10;return i}})(Ex||(Ex={}));var M6=function(){function e(t){this.providers=t}return e.prototype.and=function(t){return new e(this.providers.concat([t]))},e.prototype.encode=function(t){for(var r=[],n=0,a=this.providers;n<a.length;n++){var i=a[n],o=i(t);if(!o.encodings.length)throw new Error("Encodings must be non-empty.");t=o.data;for(var s=0,u=o.encodings;s<u.length;s++){var l=u[s];r.push(l)}}if(!(t instanceof Uint8Array))throw new Error("The encoding must result in a Uint8Array. Fix your encoding chain.");return{encoding:r,data:t}},e}(),gc;(function(e){function t(a){return new M6([a])}e.by=t;function r(a){for(var i=t(n(a[0])),o=1;o<a.length;o++)i=i.and(n(a[o]));return i}e.fromEncoding=r;function n(a){switch(a.kind){case"ByteArray":return mr.byteArray;case"FixedPoint":return mr.fixedPoint(a.factor);case"IntervalQuantization":return mr.intervalQuantizaiton(a.min,a.max,a.numSteps);case"RunLength":return mr.runLength;case"Delta":return mr.delta;case"IntegerPacking":return mr.integerPacking;case"StringArray":return mr.stringArray}}})(gc||(gc={}));var mr;(function(e){var t,r;function n(S){return new M6([S])}e.by=n;function a(S){return{encodings:[{kind:"ByteArray",type:4}],data:S}}function i(S){return{encodings:[{kind:"ByteArray",type:1}],data:new Uint8Array(S.buffer,S.byteOffset)}}var o=(t={},t[2]=function(S,_,A){S.setInt16(2*_,A,!0)},t[5]=function(S,_,A){S.setUint16(2*_,A,!0)},t[3]=function(S,_,A){S.setInt32(4*_,A,!0)},t[6]=function(S,_,A){S.setUint32(4*_,A,!0)},t[32]=function(S,_,A){S.setFloat32(4*_,A,!0)},t[33]=function(S,_,A){S.setFloat64(8*_,A,!0)},t),s=(r={},r[2]=2,r[5]=2,r[3]=4,r[6]=4,r[32]=4,r[33]=8,r);function u(S){var _=Vl.getDataType(S);if(_===1)return i(S);if(_===4)return a(S);for(var A=new Uint8Array(S.length*s[_]),T=o[_],I=new DataView(A.buffer),M=0,O=S.length;M<O;M++)T(I,M,S[M]);return{encodings:[{kind:"ByteArray",type:_}],data:A}}e.byteArray=u;function l(S,_){for(var A=Vl.getDataType(S),T=new Int32Array(S.length),I=0,M=S.length;I<M;I++)T[I]=Math.round(S[I]*_);return{encodings:[{kind:"FixedPoint",factor:_,srcType:A}],data:T}}function c(S){return function(_){return l(_,S)}}e.fixedPoint=c;function d(S,_,A,T,I){var M=Vl.getDataType(S);if(!S.length)return{encodings:[{kind:"IntervalQuantization",min:_,max:A,numSteps:T,srcType:M}],data:new Int32Array(0)};if(A<_){var O=_;_=A,A=O}for(var D=(A-_)/(T-1),F=new I(S.length),G=0,N=S.length;G<N;G++){var z=S[G];z<=_?F[G]=0:z>=A?F[G]=T-1:F[G]=Math.round((z-_)/D)|0}return{encodings:[{kind:"IntervalQuantization",min:_,max:A,numSteps:T,srcType:M}],data:F}}function f(S,_,A,T){return T===void 0&&(T=Int32Array),function(I){return d(I,S,_,A,T)}}e.intervalQuantizaiton=f;function p(S){var _=Vl.getDataType(S);if(_===void 0&&(S=new Int32Array(S),_=3),!S.length)return{encodings:[{kind:"RunLength",srcType:_,srcSize:0}],data:new Int32Array(0)};for(var A=2,T=1,I=S.length;T<I;T++)S[T-1]!==S[T]&&(A+=2);for(var M=new Int32Array(A),O=0,D=1,T=1,I=S.length;T<I;T++)S[T-1]!==S[T]?(M[O]=S[T-1],M[O+1]=D,D=1,O+=2):++D;return M[O]=S[S.length-1],M[O+1]=D,{encodings:[{kind:"RunLength",srcType:_,srcSize:S.length}],data:M}}e.runLength=p;function h(S){if(!Vl.isSignedIntegerDataType(S))throw new Error("Only signed integer types can be encoded using delta encoding.");var _=Vl.getDataType(S);if(_===void 0&&(S=new Int32Array(S),_=3),!S.length)return{encodings:[{kind:"Delta",origin:0,srcType:_}],data:new S.constructor(0)};var A=new S.constructor(S.length),T=S[0];A[0]=S[0];for(var I=1,M=S.length;I<M;I++)A[I]=S[I]-S[I-1];return A[0]=0,{encodings:[{kind:"Delta",origin:T,srcType:_}],data:A}}e.delta=h;function v(S){for(var _=0,A=S.length;_<A;_++)if(S[_]<0)return!0;return!1}function m(S,_){for(var A=-_-1,T=0,I=0,M=S.length;I<M;I++){var O=S[I];O===0?T+=1:O>0?(T+=Math.ceil(O/_),O%_===0&&(T+=1)):(T+=Math.ceil(O/A),O%A===0&&(T+=1))}return T}function g(S){var _=v(S),A=_?m(S,127):m(S,255),T=_?m(S,32767):m(S,65535);return S.length*4<T*2?{isSigned:_,size:S.length,bytesPerElement:4}:T*2<A?{isSigned:_,size:T,bytesPerElement:2}:{isSigned:_,size:A,bytesPerElement:1}}function y(S,_){for(var A=_.isSigned?_.bytesPerElement===1?127:32767:_.bytesPerElement===1?255:65535,T=-A-1,I=S.length,M=_.isSigned?_.bytesPerElement===1?new Int8Array(_.size):new Int16Array(_.size):_.bytesPerElement===1?new Uint8Array(_.size):new Uint16Array(_.size),O=0,D=0;D<I;D++){var F=S[D];if(F>=0)for(;F>=A;)M[O]=A,++O,F-=A;else for(;F<=T;)M[O]=T,++O,F-=T;M[O]=F,++O}var G=u(M);return{encodings:[{kind:"IntegerPacking",byteCount:_.bytesPerElement,isUnsigned:!_.isSigned,srcSize:I},G.encodings[0]],data:G.data}}function b(S){var _=g(S);return _.bytesPerElement===4?u(S):y(S,_)}e.integerPacking=b;function x(S){var _=Object.create(null),A=[],T=new Int32Array(S.length),I=je.create(Int32Array,1,Math.min(1024,S.length<32?S.length+1:Math.round(S.length/8)+1));je.add(I,0);for(var M=0,O=0,D=0,F=S;D<F.length;D++){var G=F[D];if(G==null){T[O++]=-1;continue}var N=_[G];N===void 0&&(M+=G.length,N=A.length,A[N]=G,_[G]=N,je.add(I,M)),T[O++]=N}var z=je.compact(I),$=Tx(z),j=$.encode(z),Z=Tx(T),q=Z.encode(T);return{encodings:[{kind:"StringArray",dataEncoding:q.encoding,stringData:A.join(""),offsetEncoding:j.encoding,offsets:j.data}],data:q.data}}e.stringArray=x})(mr||(mr={}));function vQ(e){var t=e.mask?pg(e.mask):void 0,r=pg(e.data),n=P_(r),a=n?t?function(l){return t[l]===0?""+r[l]:""}:function(l){return""+r[l]}:t?function(l){return t[l]===0?r[l]:""}:function(l){return r[l]},i=n?function(l){return r[l]}:function(l){var c=r[l];return sc(c,0,c.length)},o=n?function(l){return r[l]}:function(l){var c=r[l];return Mu(c,0,c.length)},s=t?function(l){return t[l]}:function(l){return 0},u=r.length;return{__array:r,binaryEncoding:e.data.encoding,isDefined:!0,rowCount:u,str:a,int:i,float:o,valueKind:s,areValuesEqual:function(l,c){return r[l]===r[c]},toStringArray:function(l){return Ta(u,a,l)},toIntArray:n?function(l){return Z0(r,l)}:function(l){return Ta(u,i,l)},toFloatArray:n?function(l){return Z0(r,l)}:function(l){return Ta(u,o,l)}}}function D6(e){return vg({buffer:e,offset:0,dataView:new DataView(e.buffer)})}function Ub(e,t){for(var r={},n=0;n<t;n++){var a=vg(e);r[a]=vg(e)}return r}function zb(e,t){for(var r=new Uint8Array(t),n=e.offset,a=0;a<t;a++)r[a]=e.buffer[a+n];return e.offset+=t,r}function Cm(e,t){var r=B_(e.buffer,e.offset,t);return e.offset+=t,r}function Vb(e,t){for(var r=new Array(t),n=0;n<t;n++)r[n]=vg(e);return r}function vg(e){var t=e.buffer[e.offset],r,n;if((t&128)===0)return e.offset++,t;if((t&240)===128)return n=t&15,e.offset++,Ub(e,n);if((t&240)===144)return n=t&15,e.offset++,Vb(e,n);if((t&224)===160)return n=t&31,e.offset++,Cm(e,n);if((t&224)===224)return r=e.dataView.getInt8(e.offset),e.offset++,r;switch(t){case 192:return e.offset++,null;case 194:return e.offset++,!1;case 195:return e.offset++,!0;case 196:return n=e.dataView.getUint8(e.offset+1),e.offset+=2,zb(e,n);case 197:return n=e.dataView.getUint16(e.offset+1),e.offset+=3,zb(e,n);case 198:return n=e.dataView.getUint32(e.offset+1),e.offset+=5,zb(e,n);case 202:return r=e.dataView.getFloat32(e.offset+1),e.offset+=5,r;case 203:return r=e.dataView.getFloat64(e.offset+1),e.offset+=9,r;case 204:return r=e.buffer[e.offset+1],e.offset+=2,r;case 205:return r=e.dataView.getUint16(e.offset+1),e.offset+=3,r;case 206:return r=e.dataView.getUint32(e.offset+1),e.offset+=5,r;case 208:return r=e.dataView.getInt8(e.offset+1),e.offset+=2,r;case 209:return r=e.dataView.getInt16(e.offset+1),e.offset+=3,r;case 210:return r=e.dataView.getInt32(e.offset+1),e.offset+=5,r;case 217:return n=e.dataView.getUint8(e.offset+1),e.offset+=2,Cm(e,n);case 218:return n=e.dataView.getUint16(e.offset+1),e.offset+=3,Cm(e,n);case 219:return n=e.dataView.getUint32(e.offset+1),e.offset+=5,Cm(e,n);case 220:return n=e.dataView.getUint16(e.offset+1),e.offset+=3,Vb(e,n);case 221:return n=e.dataView.getUint32(e.offset+1),e.offset+=5,Vb(e,n);case 222:return n=e.dataView.getUint16(e.offset+1),e.offset+=3,Ub(e,n);case 223:return n=e.dataView.getUint32(e.offset+1),e.offset+=5,Ub(e,n)}throw new Error("Unknown type 0x"+t.toString(16))}function mQ(e,t){for(var r=0;r<2;r++)if(e[r]>t[r])return!1;return!0}function gQ(e){for(var t=Object.create(null),r=Object.create(null),n=0,a=e.columns;n<a.length;n++){var i=a[n];t[i.name]=i}return{rowCount:e.rowCount,name:e.name.substr(1),fieldNames:e.columns.map(function(o){return o.name}),getField:function(o){var s=t[o];if(!!s)return r[o]||(r[o]=vQ(s)),r[o]}}}function RP(e){var t=this;return We.create("Parse BinaryCIF",function(r){return ce(t,void 0,void 0,function(){var n,a,i;return de(this,function(o){n=[0,3];try{return a=D6(e),mQ(n,a.version.match(/(\d)\.(\d)\.\d/).slice(1).map(function(s){return+s}))?(i=w6(a.dataBlocks.map(function(s){for(var u=Object.create(null),l=0,c=s.categories;l<c.length;l++){var d=c[l];u[d.name.substr(1)]=gQ(d)}return a3(s.categories.map(function(f){return f.name.substr(1)}),u,s.header)})),[2,bn.success(i)]):[2,bn.error("Unsupported format version. Current "+a.version+", required "+n.join(".")+".")]}catch(s){return[2,bn.error(""+s)]}return[2]})})})}var ep;(function(e){function t(a){return a.replace(".","_").replace(/\[/,"_").replace(/(\[|\])/g,"")}e.canonical=t;function r(a,i){return t(a)===t(i)}e.equal=r;function n(a,i,o){o===void 0&&(o=!1);var s=""+a+(i?"."+i:"");return o?t(s):s}e.create=n})(ep||(ep={}));function yQ(e,t,r){for(var n={},a=0,i=t.blocks;a<i.length;a++){var o=i[a];n[o.header]=yu(e,o,r)}return n}function yu(e,t,r){return CQ(e,t,r)}function R6(e,t){return new O6(t,e,!0)}function bQ(e){switch(e.valueType){case"str":return function(t,r,n){return Hb(e,t,t.str,t.toStringArray)};case"int":return function(t,r,n){return Hb(e,t,t.int,t.toIntArray)};case"float":return function(t,r,n){return Hb(e,t,t.float,t.toFloatArray)};case"list":throw new Error("Use createListColumn instead.");case"tensor":throw new Error("Use createTensorColumn instead.")}}function Hb(e,t,r,n){return{schema:e,__array:t.__array,isDefined:t.isDefined,rowCount:t.rowCount,value:r,valueKind:t.valueKind,areValuesEqual:t.areValuesEqual,toArray:n}}function SQ(e,t,r){var n=e.separator,a=e.itemParse,i=t.getField(r),o=i?function(u){return i.str(u).split(n).map(function(l){return a(l.trim())}).filter(function(l){return!!l})}:function(u){return[]},s=function(u){return Ta(t.rowCount,o,u)};return{schema:e,__array:void 0,isDefined:!!i,rowCount:t.rowCount,value:o,valueKind:i?i.valueKind:function(){return 1},areValuesEqual:function(u,l){return ci(o(u),o(l))},toArray:s}}function xQ(e,t,r){var n=e.space,a=t.fieldNames.includes(r+"[0]")||t.fieldNames.includes(r+"[0][0]")||t.fieldNames.includes(r+"[0][0][0]"),i=a?0:1,o=t.fieldNames.includes(r+"_1")||t.fieldNames.includes(r+"_11")||t.fieldNames.includes(r+"_111")?"underscore":"brackets",s=x$(r,n.rank,a,o),u=t.getField(s(i,i,i))||ve.Undefined(t.rowCount,e),l=function(d){return C$(t,n,d,s)},c=function(d){return Ta(t.rowCount,l,d)};return{schema:e,__array:void 0,isDefined:u.isDefined,rowCount:t.rowCount,value:l,valueKind:u.valueKind,areValuesEqual:function(d,f){return Pr.areEqualExact(l(d),l(f))},toArray:c}}var O6=function(){function e(t,r,n){this._isDefined=n;var a=Object.keys(r);this._rowCount=t.rowCount,this._columns=a,this._schema=r;for(var i=Object.create(null),o=function(d){Object.defineProperty(s,d,{get:function(){if(i[d])return i[d];var f=r[d];if(f.valueType==="list")i[d]=SQ(f,t,d);else if(f.valueType==="tensor")i[d]=xQ(f,t,d);else{var p=bQ(f),h=t.getField(d);i[d]=h?p(h,t,d):ve.Undefined(t.rowCount,f)}return i[d]},enumerable:!0,configurable:!1})},s=this,u=0,l=a;u<l.length;u++){var c=l[u];o(c)}}return e}();function CQ(e,t,r){for(var n=Object.create(null),a=0,i=Object.keys(e);a<i.length;a++){var o=i[a];n[o]=AQ(o,e[o],t,r)}return jS.ofTables(t.header,e,n)}function _Q(e){for(var t=Object.create(null),r=0,n=Object.keys(e.categories);r<n.length;r++)for(var a=n[r],i=0,o=e.categories[a].fieldNames;i<o.length;i++){var s=o[i],u=ep.create(a,s,!0);t[u]=e.categories[a].getField(s)}return t}function wQ(e,t,r,n){var a=ep.create(t,e),i=ep.canonical(a);if(i in r)return r[i];if(n&&a in n)for(var o=0,s=n[a];o<s.length;o++){var u=s[o],l=ep.canonical(u);if(l in r)return r[l]}}function AQ(e,t,r,n){var a=r.categories[e];if(n){for(var i=_Q(r),o=Object.create(null),s=[],u=0,l=0,c=Object.keys(t);l<c.length;l++){var d=c[l],f=wQ(d,e,i,n);f&&(o[d]=f,s.push(d),u=f.rowCount)}a={rowCount:u,name:e,fieldNames:Nt([],s),getField:function(p){return o[p]}}}return new O6(a||Oa.empty(e),t,!!a)}var Dp=ve.Schema,Tr=Dp.str,PQ=Dp.float,OP=Dp.List,Bi=Dp.Aliased,Jp=Dp.int,Cf=Dp.coord,TQ={chem_comp:{formula:Tr,formula_weight:PQ,id:Tr,mon_nstd_parent_comp_id:OP(",",function(e){return e}),name:Tr,one_letter_code:Tr,three_letter_code:Tr,type:Bi(Tr),pdbx_synonyms:OP(";",function(e){return e}),pdbx_type:Tr,pdbx_ambiguous_flag:Tr,pdbx_replaced_by:Tr,pdbx_replaces:Tr,pdbx_formal_charge:Jp,pdbx_model_coordinates_details:Tr,pdbx_model_coordinates_db_code:Tr,pdbx_ideal_coordinates_details:Tr,pdbx_ideal_coordinates_missing_flag:Bi(Tr),pdbx_model_coordinates_missing_flag:Bi(Tr),pdbx_initial_date:Tr,pdbx_modified_date:Tr,pdbx_release_status:Bi(Tr),pdbx_processing_site:Bi(Tr)},chem_comp_atom:{alt_atom_id:Tr,atom_id:Tr,charge:Jp,model_Cartn_x:Cf,model_Cartn_y:Cf,model_Cartn_z:Cf,comp_id:Tr,type_symbol:Tr,pdbx_align:Jp,pdbx_ordinal:Jp,pdbx_model_Cartn_x_ideal:Cf,pdbx_model_Cartn_y_ideal:Cf,pdbx_model_Cartn_z_ideal:Cf,pdbx_stereo_config:Bi(Tr),pdbx_aromatic_flag:Bi(Tr),pdbx_leaving_atom_flag:Bi(Tr)},chem_comp_bond:{atom_id_1:Tr,atom_id_2:Tr,comp_id:Tr,value_order:Bi(Tr),pdbx_ordinal:Jp,pdbx_stereo_config:Bi(Tr),pdbx_aromatic_flag:Bi(Tr)},pdbx_chem_comp_descriptor:{comp_id:Tr,descriptor:Tr,type:Bi(Tr),program:Tr,program_version:Tr},pdbx_chem_comp_identifier:{comp_id:Tr,identifier:Tr,type:Bi(Tr),program:Tr,program_version:Tr}},Wy=ve.Schema,Vt=Wy.str,EQ=Wy.float,ii=Wy.Aliased,ao=Wy.int,IQ={pdbx_reference_molecule:{prd_id:Vt,formula_weight:EQ,formula:Vt,type:ii(Vt),type_evidence_code:Vt,class:ii(Vt),class_evidence_code:Vt,name:Vt,represent_as:ii(Vt),chem_comp_id:Vt,compound_details:Vt,description:Vt,representative_PDB_id_code:Vt,release_status:ii(Vt),replaces:Vt,replaced_by:Vt},pdbx_reference_entity_list:{prd_id:Vt,ref_entity_id:Vt,type:ii(Vt),details:Vt,component_id:ao},pdbx_reference_entity_nonpoly:{prd_id:Vt,ref_entity_id:Vt,name:Vt,chem_comp_id:Vt},pdbx_reference_entity_link:{link_id:ao,prd_id:Vt,details:Vt,ref_entity_id_1:Vt,ref_entity_id_2:Vt,entity_seq_num_1:ao,entity_seq_num_2:ao,comp_id_1:Vt,comp_id_2:Vt,atom_id_1:Vt,atom_id_2:Vt,value_order:ii(Vt),component_1:ao,component_2:ao,link_class:ii(Vt)},pdbx_reference_entity_poly_link:{link_id:ao,prd_id:Vt,ref_entity_id:Vt,component_id:ao,entity_seq_num_1:ao,entity_seq_num_2:ao,comp_id_1:Vt,comp_id_2:Vt,atom_id_1:Vt,atom_id_2:Vt,value_order:ii(Vt)},pdbx_reference_entity_poly:{prd_id:Vt,ref_entity_id:Vt,type:ii(Vt),db_code:Vt,db_name:Vt},pdbx_reference_entity_poly_seq:{prd_id:Vt,ref_entity_id:Vt,mon_id:Vt,parent_mon_id:Vt,num:ao,observed:ii(Vt),hetero:ii(Vt)},pdbx_reference_entity_sequence:{prd_id:Vt,ref_entity_id:Vt,type:ii(Vt),NRP_flag:ii(Vt),one_letter_codes:Vt},pdbx_reference_entity_src_nat:{prd_id:Vt,ref_entity_id:Vt,ordinal:ao,organism_scientific:Vt,taxid:Vt,db_code:Vt,db_name:Vt},pdbx_prd_audit:{prd_id:Vt,date:Vt,processing_site:ii(Vt),action_type:ii(Vt)}},F6=ve.Schema,Kn=F6.str,MQ=F6.float,DQ={id:Kn,description:Kn},RQ={title:Kn,datablock_id:Kn,version:Kn},OQ={version:Kn,update:Kn,revision:Kn},FQ={id:Kn,description:Kn},kQ={id:Kn,parent_id:Kn,description:Kn},BQ={code:Kn,primitive_code:Kn,construct:Kn,detail:Kn},LQ={code:Kn,detail:Kn},NQ={from_code:Kn,to_code:Kn,operator:Kn,factor:MQ},UQ={datablock:DQ,dictionary:RQ,dictionary_history:OQ,sub_category:FQ,category_group_list:kQ,item_type_list:BQ,item_units_list:LQ,item_units_conversion:NQ},Ov=ve.Schema,Es=Ov.str,_m=Ov.int,iu=Ov.float,wm=Ov.Aliased,Hl=Ov.Vector;wm(Es),wm(Es),wm(Es),wm(Es),Hl(3),Hl(3);var zQ={volume_data_3d_info:{name:Es,axis_order:Hl(3,_m),origin:Hl(3),dimensions:Hl(3),sample_rate:_m,sample_count:Hl(3,_m),spacegroup_number:_m,spacegroup_cell_size:Hl(3),spacegroup_cell_angles:Hl(3),mean_source:iu,mean_sampled:iu,sigma_source:iu,sigma_sampled:iu,min_source:iu,min_sampled:iu,max_source:iu,max_sampled:iu},volume_data_3d:{values:iu}},Xy=ve.Schema,Gb=Xy.int,ln=Xy.float,on=Xy.str,FP=Xy.Matrix,VQ={cell:{formula_units_Z:Gb,volume:ln,angle_alpha:ln,angle_beta:ln,angle_gamma:ln,length_a:ln,length_b:ln,length_c:ln},chemical:{melting_point:ln,name_common:on,name_systematic:on},chemical_formula:{moiety:on,sum:on,weight:ln},space_group:{crystal_system:on,IT_number:Gb,"name_H-M_full":on},space_group_symop:{operation_xyz:on},geom_bond:{atom_site_label_1:on,atom_site_label_2:on,distance:ln,publ_flag:on,site_symmetry_1:on,site_symmetry_2:on,valence:ln},audit:{block_doi:on},database_code:{COD:on,CSD:on,depnum_ccdc_archive:on,depnum_ccdc_fiz:on,ICSD:on,MDF:on,NBS:on},atom_site:{adp_type:on,calc_flag:on,disorder_assembly:on,disorder_group:on,fract_x:ln,fract_y:ln,fract_z:ln,label:on,occupancy:ln,refinement_flags:on,site_symmetry_multiplicity:Gb,type_symbol:on,U_iso_or_equiv:ln},atom_site_aniso:{label:on,U_11:ln,U:FP(3,3),U_11_su:ln,U_su:FP(3,3),U_12:ln,U_12_su:ln,U_13:ln,U_13_su:ln,U_22:ln,U_22_su:ln,U_23:ln,U_23_su:ln,U_33:ln,U_33_su:ln},atom_type:{description:on,symbol:on},atom_type_scat:{dispersion_imag:ln,dispersion_real:ln,source:on}},HQ={"atom_site_aniso.U":["atom_site_anisotrop_U"],"atom_site_aniso.U_su":["atom_site_aniso_U_esd","atom_site_anisotrop_U_esd"],"space_group.IT_number":["symmetry_Int_Tables_number"],"space_group.name_H-M_full":["symmetry_space_group_name_H-M"],"space_group_symop.operation_xyz":["symmetry_equiv_pos_as_xyz"],"geom_bond.atom_site_label_1":["geom_bond_atom_site_id_1"],"geom_bond.atom_site_label_2":["geom_bond_atom_site_id_2"],"geom_bond.distance":["geom_bond_dist"],"atom_site.adp_type":["atom_site_thermal_displace_type"],"atom_site.label":["atom_site_id"],"atom_site.site_symmetry_multiplicity":["atom_site_symmetry_multiplicity"],"atom_site_aniso.label":["atom_site_anisotrop_id"],"atom_site_aniso.U_11":["atom_site_anisotrop_U_11"],"atom_site_aniso.U_11_su":["atom_site_aniso_U_11_esd","atom_site_anisotrop_U_11_esd"],"atom_site_aniso.U_12":["atom_site_anisotrop_U_12"],"atom_site_aniso.U_12_su":["atom_site_aniso_U_12_esd","atom_site_anisotrop_U_12_esd"],"atom_site_aniso.U_13":["atom_site_anisotrop_U_13"],"atom_site_aniso.U_13_su":["atom_site_aniso_U_13_esd","atom_site_anisotrop_U_13_esd"],"atom_site_aniso.U_22":["atom_site_anisotrop_U_22"],"atom_site_aniso.U_22_su":["atom_site_aniso_U_22_esd","atom_site_anisotrop_U_22_esd"],"atom_site_aniso.U_23":["atom_site_anisotrop_U_23"],"atom_site_aniso.U_23_su":["atom_site_aniso_U_23_esd","atom_site_anisotrop_U_23_esd"],"atom_site_aniso.U_33":["atom_site_anisotrop_U_33"],"atom_site_aniso.U_33_su":["atom_site_aniso_U_33_esd","atom_site_anisotrop_U_33_esd"]},Gu={parse:function(e){return typeof e=="string"?DP(e):RP(e)},parseText:DP,parseBinary:RP,toDatabaseCollection:yQ,toDatabase:yu,schema:{mmCIF:function(e){return yu(vr,e)},CCD:function(e){return yu(TQ,e)},BIRD:function(e){return yu(IQ,e)},dic:function(e){return yu(UQ,e)},cifCore:function(e){return yu(VQ,e,HQ)},densityServer:function(e){return yu(zQ,e)}}},Ix=function(){function e(t,r,n){this.operatorsProvider=n,this.id=t,this.details=r}return Object.defineProperty(e.prototype,"operatorGroups",{get:function(){return this._operators?this._operators:(this._operators=this.operatorsProvider(),this._operators)},enumerable:!1,configurable:!0}),e}();(function(e){function t(r,n,a){return new e(r,n,a)}e.create=t})(Ix||(Ix={}));var vv;(function(e){e.Default={assemblies:[],spacegroup:fs.ZeroP1,isNonStandardCrystalFrame:!1};function t(n,a){var i=a.toLocaleLowerCase(),o=qn.Provider.get(n);return o?T_(o.assemblies,function(s){return s.id.toLowerCase()===i}):void 0}e.findAssembly=t;function r(n){var a=n.spacegroup,i=a.cell,o=a.name,s=a.num,u=i.size,l=i.anglesInRadians,c=u[0].toFixed(2),d=u[1].toFixed(2),f=u[2].toFixed(2),p=Jo(l[0]).toFixed(2),h=Jo(l[1]).toFixed(2),v=Jo(l[2]).toFixed(2),m=[];return m.push("Unit Cell <b>"+o+"</b> #"+s),m.push(c+"\xD7"+d+"\xD7"+f+" \u212B"),m.push("\u03B1="+p+"\xB0 \u03B2="+h+"\xB0 \u03B3="+v+"\xB0"),m.join(" | ")}e.getUnitcellLabel=r})(vv||(vv={}));function GQ(e,t,r){if(!e._rowCount)return[];for(var n=WQ(r),a=[],i=0;i<e._rowCount;i++)a[a.length]=qQ(e,t,i,n);return a}function qQ(e,t,r,n){for(var a=e.id.value(r),i=e.details.value(r),o=[],s=t.assembly_id,u=t.oper_expression,l=t.asym_id_list,c=0,d=t._rowCount;c<d;c++)s.value(c)===a&&(o[o.length]={assemblyId:a,expression:u.value(c),asymIds:l.value(c)});return Ix.create(a,i,jQ(o,n))}function jQ(e,t){return function(){for(var r=[],n=0,a=0;a<e.length;a++){var i=e[a],o=KQ(i.expression),s=XQ(o),u=YQ(t,s,n,i.assemblyId),l=Zr.generators.atoms({chainTest:Zr.pred.and(Zr.pred.eq(function(c){return ct.unit.operator_name(c.element)},dn.DefaultName),Zr.pred.inSet(function(c){return ct.chain.label_asym_id(c.element)},i.asymIds))});r[r.length]={selector:l,operators:u},n+=u.length}return r}}function WQ(e){for(var t=e.id,r=e.matrix,n=e.vector,a=e._schema,i=new Map,o=0,s=e._rowCount;o<s;o++){var u=Pr.toMat4(ue(),a.matrix.space,r.value(o)),l=Pr.toVec3(C(),a.vector.space,n.value(o));ue.setTranslation(u,l),ue.setValue(u,3,3,1),i.set(t.value(o),u)}return i}function XQ(e){for(var t=[],r=[],n=0;n<e.length;n++)r[n]="";return k6(e,t,e.length-1,r),t}function k6(e,t,r,n){if(r<0){t[t.length]=n.slice(0);return}for(var a=e[r],i=a.length,o=0;o<i;o++)n[r]=a[o],k6(e,t,r-1,n)}function YQ(e,t,r,n){for(var a=[],i=r,o=0,s=t;o<s.length;o++){for(var u=s[o],l=ue.identity(),c=0;c<u.length;c++)ue.mul(l,l,e.get(u[c]));i++,a[a.length]=dn.create("ASM_"+i,l,{assembly:{id:n,operId:i,operList:u}})}return a}function KQ(e){for(var t=/\(?([^\(\)]+)\)?]*/g,r=[],n=[],a;a=t.exec(e);)r[r.length]=a[1];return r.forEach(function(i){var o=[];i.split(",").forEach(function(s){var u=s.indexOf("-");if(u>0)for(var l=parseInt(s.substring(0,u)),c=parseInt(s.substr(u+1)),d=l;d<=c;d++)o[o.length]=d.toString();else o[o.length]=s.trim()}),n[n.length]=o}),n}var qn;(function(e){e.Descriptor={name:"model_symmetry"},e.Provider=ds.create(e.Descriptor);function t(n){var a=GQ(n.pdbx_struct_assembly,n.pdbx_struct_assembly_gen,n.pdbx_struct_oper_list),i=ZQ(n.symmetry,n.cell),o=$Q(n.atom_sites);return{assemblies:a,spacegroup:i,isNonStandardCrystalFrame:o,ncsOperators:JQ(n.struct_ncs_oper)}}e.fromData=t;function r(n,a){var i=Ei.create("P 1",n,a),o=fs.create(i);return{assemblies:[],spacegroup:o,isNonStandardCrystalFrame:!1}}e.fromCell=r})(qn||(qn={}));function $Q(e,t){return e._rowCount===0,!1}function QQ(e){var t=e.Int_Tables_number.value(0),r=e["space_group_name_H-M"].value(0);return e.Int_Tables_number.isDefined?e["space_group_name_H-M"].isDefined?r:t:r}function ZQ(e,t){if(e._rowCount===0||t._rowCount===0)return fs.ZeroP1;var r=QQ(e),n=Ei.create(r,C.create(t.length_a.value(0),t.length_b.value(0),t.length_c.value(0)),C.scale(C.zero(),C.create(t.angle_alpha.value(0),t.angle_beta.value(0),t.angle_gamma.value(0)),Math.PI/180));return fs.create(n)}function JQ(e){if(e._rowCount!==0){for(var t=e.id,r=e.matrix,n=e.vector,a=vr.struct_ncs_oper.matrix.space,i=vr.struct_ncs_oper.vector.space,o=[],s=0;s<e._rowCount;s++){var u=Pr.toMat3(Mn(),a,r.value(s)),l=Pr.toVec3(C(),i,n.value(s));if(!!dn.checkIfRotationAndTranslation(u,l)&&!(e.code.value(s)==="given"&&!Mn.isIdentity(u)&&!C.isZero(l))){var c=t.value(s);o[o.length]=dn.ofRotationAndOffset("ncs_"+c,u,l,c)}}return o}}function B6(e,t,r,n){return{type:e,key:t,elements:r,getIndex:n}}var mv;(function(e){e.Descriptor={name:"model_secondary_structure"},e.Provider=ds.create(e.Descriptor);function t(r,n,a){var i=new Map,o=[{kind:"none"}],s=eZ(r,n);tZ(r,s,i,o),rZ(n,s,i,r._rowCount,o);var u=a.residues._rowCount,l=function(d){return d},c={type:new Int32Array(u),key:new Int32Array(u),elements:o};return i.size>0&&aZ(a,s,i,c),B6(c.type,c.key,c.elements,l)}e.fromStruct=t})(mv||(mv={}));function eZ(e,t){if(e._rowCount>0){if(e.beg_label_seq_id.valueKind(0)!==0||e.end_label_seq_id.valueKind(0)!==0)return"auth"}else if(t&&(t.beg_label_seq_id.valueKind(0)!==0||t.end_label_seq_id.valueKind(0)!==0))return"auth";return"label"}function tZ(e,t,r,n){if(!!e._rowCount)for(var a=e.beg_label_asym_id,i=e.beg_label_seq_id,o=e.beg_auth_seq_id,s=e.pdbx_beg_PDB_ins_code,u=e.end_label_seq_id,l=e.end_auth_seq_id,c=e.pdbx_end_PDB_ins_code,d=e.pdbx_PDB_helix_class,f=e.conf_type_id,p=e.details,h=t==="label"?i:o,v=t==="label"?u:l,m=0,g=e._rowCount;m<g;m++){var y=Fr.create(d.valueKind(m)===0?Fr.SecondaryStructurePdb[d.value(m)]:f.valueKind(m)===0?Fr.SecondaryStructureMmcif[f.value(m)]:536870912),b={kind:"helix",flags:y,type_id:f.valueKind(m)===0?f.value(m):"HELIX_P",helix_class:d.value(m),details:p.valueKind(m)===0?p.value(m):void 0},x={startSeqId:h.value(m),startInsCode:s.value(m),endSeqId:v.value(m),endInsCode:c.value(m),type:y,key:n.length};n[n.length]=b;var S=a.value(m);if(r.has(S)){var _=r.get(S);_.has(x.startSeqId)?_.get(x.startSeqId).push(x):_.set(x.startSeqId,[x])}else r.set(S,new Map([[x.startSeqId,[x]]]))}}function rZ(e,t,r,n,a){if(!!e._rowCount)for(var i=e.beg_label_asym_id,o=e.beg_label_seq_id,s=e.beg_auth_seq_id,u=e.pdbx_beg_PDB_ins_code,l=e.end_label_seq_id,c=e.end_auth_seq_id,d=e.pdbx_end_PDB_ins_code,f=e.sheet_id,p=t==="label"?o:s,h=t==="label"?l:c,v=new Map,m=n+1,g=0,y=e._rowCount;g<y;g++){var b=f.value(g),x=void 0;v.has(b)?x=v.get(b):(x=m++,v.set(b,x));var S=Fr.create(8388612),_={kind:"sheet",flags:S,sheet_id:b,symmetry:void 0},A={startSeqId:p.value(g),startInsCode:u.value(g),endSeqId:h.value(g),endInsCode:d.value(g),type:S,key:a.length};a[a.length]=_;var T=i.value(g);if(r.has(T)){var I=r.get(T);I.has(A.startSeqId)?I.get(A.startSeqId).push(A):I.set(A.startSeqId,[A])}else r.set(T,new Map([[A.startSeqId,[A]]]))}}function nZ(e,t,r,n,a,i){for(var o=e.residues,s=o.auth_seq_id,u=o.label_seq_id,l=o.pdbx_PDB_ins_code,c=r.endSeqId,d=r.endInsCode,f=r.key,p=r.type,h=t==="label"?u:s,v=n;v<a;){var m=h.value(v);if(i.type[v]=p,i.key[v]=f,m>c||m===c&&l.value(v)===d)break;v++}}function aZ(e,t,r,n){for(var a=e.chainAtomSegments.count,i=e.chains.label_asym_id,o=e.residues,s=o.auth_seq_id,u=o.label_seq_id,l=o.pdbx_PDB_ins_code,c=t==="label"?u:s,d=0;d<a;d++){var f=Dd.chainStartResidueIndex(e,d),p=Dd.chainEndResidueIndexExcl(e,d),h=i.value(d);if(r.has(h))for(var v=r.get(h),m=f;m<p;m++){var g=c.value(m);if(v.has(g))for(var y=v.get(g),b=0,x=y;b<x.length;b++){var S=x[b],_=l.value(m);S.startInsCode===_&&nZ(e,t,S,m,p,n)}}}}var Mx;(function(e){function t(s,u,l){return{name:s,type:0,value:u,valueKind:l&&l.valueKind,defaultFormat:l&&l.encoder?{encoder:l.encoder}:void 0,shouldInclude:l&&l.shouldInclude}}e.str=t;function r(s,u,l){return{name:s,type:1,value:u,valueKind:l&&l.valueKind,defaultFormat:l?{encoder:l.encoder,typedArray:l.typedArray}:void 0,shouldInclude:l&&l.shouldInclude}}e.int=r;function n(s,u,l){return{name:s,type:2,value:u,valueKind:l&&l.valueKind,defaultFormat:l?{encoder:l.encoder,typedArray:l.typedArray,digitCount:typeof l.digitCount!="undefined"?l.digitCount:void 0}:void 0,shouldInclude:l&&l.shouldInclude}}e.float=n;function a(s){return r(s,function(u,l,c){return c+1},{typedArray:Int32Array,encoder:mr.by(mr.delta).and(mr.runLength).and(mr.integerPacking)})}e.index=a;var i=function(){function s(){this.fields=[]}return s.prototype.index=function(u){return this.fields.push(e.index(u)),this},s.prototype.str=function(u,l,c){return this.fields.push(e.str(u,l,c)),this},s.prototype.int=function(u,l,c){return this.fields.push(e.int(u,l,c)),this},s.prototype.vec=function(u,l,c){for(var d=0;d<l.length;d++)this.fields.push(e.int(u+"["+(d+1)+"]",l[d],c));return this},s.prototype.float=function(u,l,c){return this.fields.push(e.float(u,l,c)),this},s.prototype.many=function(u){for(var l=0;l<u.length;l++)this.fields.push(u[l]);return this},s.prototype.add=function(u){return this.fields.push(u),this},s.prototype.getFields=function(){return this.fields},s}();e.Builder=i;function o(){return new i}e.build=o})(Mx||(Mx={}));var qi;(function(e){e.Empty={fields:[],source:[]};function t(n){for(var a=[],i=[],o=[],s=[],u=0,l=n.split(/[\r\n]+/);u<l.length;u++){var c=l[u];if(c=c.trim(),c.length!==0){var d=/^!/.test(c);d&&(c=c.substr(1));var f=c.split(/\./),p=f[1],h=d?p?s:i:p?o:a;h[h.length]=c,p&&!a.includes(f[0])&&(a[a.length]=f[0])}}var v=o.map(function(m){return m.split(".")[0]});return{includeCategory:function(m){return i.includes(m)?!1:a.length<=0||a.indexOf(m)!==-1},includeField:function(m,g){var y=m+"."+g;return s.includes(y)?!1:!v.includes(m)||o.includes(y)}}}e.filterOf=t,e.DefaultFilter={includeCategory:function(n){return!0},includeField:function(n,a){return!0}},e.DefaultFormatter={getFormat:function(n,a){}};function r(n,a){return a?{fields:kP(n._schema),source:[{data:n,rowCount:a.length,keys:function(){return tg.Array(a)}}]}:{fields:kP(n._schema),source:[{data:n,rowCount:n._rowCount}]}}e.ofTable=r})(qi||(qi={}));var Dx;(function(e){function t(n,a,i){n.startDataBlock(a);for(var o=function(c){n.writeCategory({name:c,instance:function(){return qi.ofTable(i[c])}})},s=0,u=i._tableNames;s<u.length;s++){var l=u[s];o(l)}}e.writeDatabase=t;function r(n,a){for(var i=0,o=Object.keys(a);i<o.length;i++){var s=o[i];t(n,s,a[s])}}e.writeDatabaseCollection=r})(Dx||(Dx={}));function qb(e){return function(t,r){return r[e].value(t)}}function iZ(e){return function(t,r){return r[e].value(t).join(r[e].schema.separator)}}function jb(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return function(n,a){var i;return(i=a[e].schema.space).get.apply(i,Nt([a[e].value(n)],t))}}function wh(e){return function(t,r){return r[e].valueKind(t)}}function oZ(e,t){var r=[],n=2,a=wh(e);if(t.rank===1)for(var i=t.dimensions[0],o=0;o<i;o++){var s=e+"["+(o+1)+"]";r.push({name:s,type:n,value:jb(e,o),valueKind:a})}else if(t.rank===2)for(var i=t.dimensions[0],u=t.dimensions[1],o=0;o<i;o++)for(var l=0;l<u;l++){var c=e+"["+(o+1)+"]["+(l+1)+"]";r.push({name:c,type:n,value:jb(e,o,l),valueKind:a})}else if(t.rank===3)for(var d=t.dimensions[0],f=t.dimensions[1],p=t.dimensions[2],o=0;o<d;o++)for(var l=0;l<f;l++)for(var h=0;h<p;h++){var v=e+"["+(o+1)+"]["+(l+1)+"]["+(h+1)+"]";r.push({name:v,type:n,value:jb(e,o,l,h),valueKind:a})}else throw new Error("Tensors with rank > 3 or rank 0 are currently not supported.");return r}function kP(e){for(var t=[],r=0,n=Object.keys(e);r<n.length;r++){var a=n[r],i=e[a];if(i.valueType==="int")t.push({name:a,type:1,value:qb(a),valueKind:wh(a)});else if(i.valueType==="float")t.push({name:a,type:2,value:qb(a),valueKind:wh(a)});else if(i.valueType==="str")t.push({name:a,type:0,value:qb(a),valueKind:wh(a)});else if(i.valueType==="list")t.push({name:a,type:0,value:iZ(a),valueKind:wh(a)});else if(i.valueType==="tensor")t.push.apply(t,oZ(a,i.space));else throw new Error("Unknown valueType "+i.valueType)}return t}function sZ(e){return e.defaultFormat&&typeof e.defaultFormat.digitCount!="undefined"?Math.max(0,Math.min(e.defaultFormat.digitCount,16)):6}function o3(e){return e.fields.some(function(t){return!!t.shouldInclude})?e.fields.filter(function(t){return!t.shouldInclude||e.source.some(function(r){return t.shouldInclude(r.data)})}):e.fields}function L6(e,t){var r=e.instance(t),n=r.source.filter(function(o){return o.rowCount>0});if(!n.length)return{instance:r,rowCount:0,source:[]};var a=n.reduce(function(o,s){return o+s.rowCount},0),i=n.map(function(o){return{data:o.data,keys:function(){return o.keys?o.keys():tg.Range(0,o.rowCount-1)},rowCount:o.rowCount}});return{instance:r,rowCount:a,source:i}}var uZ=function(){function e(){this.builder=Dr.create(),this.encoded=!1,this.dataBlockCreated=!1,this.filter=qi.DefaultFilter,this.formatter=qi.DefaultFormatter,this.isBinary=!1,this.binaryEncodingProvider=void 0}return e.prototype.setFilter=function(t){this.filter=t||qi.DefaultFilter},e.prototype.isCategoryIncluded=function(t){return this.filter.includeCategory(t)},e.prototype.setFormatter=function(t){this.formatter=t||qi.DefaultFormatter},e.prototype.startDataBlock=function(t){this.dataBlockCreated=!0,Dr.write(this.builder,"data_"+(t||"").replace(/[ \n\t]/g,"").toUpperCase()+`
#
`)},e.prototype.writeCategory=function(t,r,n){if(this.encoded)throw new Error("The writer contents have already been encoded, no more writing.");if(!this.dataBlockCreated)throw new Error("No data block created.");if(!(!(n!=null&&n.ignoreFilter)&&!this.filter.includeCategory(t.name))){var a=L6(t,r),i=a.instance,o=a.rowCount,s=a.source;!o||(o===1?lZ(t,i,s,this.builder,this.filter,this.formatter):cZ(t,i,s,this.builder,this.filter,this.formatter))}},e.prototype.encode=function(){this.encoded=!0},e.prototype.writeTo=function(t){for(var r=Dr.getChunks(this.builder),n=0,a=r.length;n<a;n++)t.writeString(r[n])},e.prototype.getSize=function(){return Dr.getSize(this.builder)},e.prototype.getData=function(){return Dr.getString(this.builder)},e}();function N6(e,t,r,n,a,i){var o=n.valueKind,s=o?o(r,t):0;if(s!==0)s===1?hZ(e):vZ(e);else{var u=n.value(r,t,i),l=n.type;if(l===0)return dZ(u)?(I0(e,u),!0):mZ(e,u);l===1?fZ(e,u):pZ(e,u,a)}return!1}function U6(e,t,r){for(var n=[],a=0,i=t;a<i.length;a++){var o=i[a],s=r.getFormat(e,o.name);s&&typeof s.digitCount!="undefined"?n[n.length]=o.type===2?Math.pow(10,Math.max(0,Math.min(s.digitCount,15))):0:n[n.length]=o.type===2?Math.pow(10,sZ(o)):0}return n}function lZ(e,t,r,n,a,i){var o=o3(t),s=r[0],u=s.data,l=o.reduce(function(m,g){return a.includeField(e.name,g.name)?Math.max(m,g.name.length):0},0);if(l!==0){l+=e.name.length+6;for(var c=s.keys(),d=c.move(),f=U6(e.name,t.fields,i),p=0;p<o.length;p++){var h=o[p];if(!!a.includeField(e.name,h.name)){Dr.writePadRight(n,"_"+e.name+"."+h.name,l);var v=N6(n,u,d,h,f[p],0);v||Dr.newline(n)}}Dr.write(n,`#
`)}}function cZ(e,t,r,n,a,i){var o=o3(t),s=a===qi.DefaultFilter?o:o.filter(function(b){return a.includeField(e.name,b.name)}),u=s.length;if(u!==0){var l=U6(e.name,s,i);BP(n,"loop_");for(var c=0;c<u;c++)BP(n,"_"+e.name+"."+s[c].name);for(var d=0,f=0;f<r.length;f++){var p=r[f],h=p.data;if(p.rowCount!==0)for(var v=p.keys();v.hasNext;){for(var m=v.move(),g=!1,y=0;y<u;y++)g=N6(n,h,m,s[y],l[y],d);g||Dr.newline(n),d++}}Dr.write(n,`#
`)}}function dZ(e){return typeof e=="string"&&e.indexOf(`
`)>=0}function BP(e,t){Dr.write(e,t),Dr.newline(e)}function fZ(e,t){Dr.writeInteger(e,t),Dr.whitespace1(e)}function pZ(e,t,r){Dr.writeFloat(e,t,r),Dr.whitespace1(e)}function hZ(e){Dr.writeSafe(e,". ")}function vZ(e){Dr.writeSafe(e,"? ")}function mZ(e,t){if(!t)return Dr.writeSafe(e,". "),!1;for(var r=t.charCodeAt(0),n=!1,a=0,i=!1,o=!1,s=0,u=t.length-1;s<=u;s++){var l=t.charCodeAt(s);switch(l){case 9:n=!0;break;case 10:return I0(e,t),!0;case 32:n=!0;break;case 34:if(s&&s===u)break;if(i)return I0(e,t),!0;o=!0,n=!0,a=0;break;case 39:if(s&&s===u)break;if(o)return I0(e,t),!0;i=!0,n=!0,a=1;break}}return!n&&(r===35||r===36||r===59||r===91||r===93||r===95)&&(n=!0),n?(Dr.writeSafe(e,a?'"':"'"),Dr.writeSafe(e,t),Dr.writeSafe(e,a?'" ':"' ")):(Dr.writeSafe(e,t),Dr.writeSafe(e," ")),!1}function I0(e,t){Dr.writeSafe(e,`
;`+t),Dr.writeSafe(e,`
;
`)}function gZ(e){var t=new ArrayBuffer(M0(e)),r=new DataView(t),n=new Uint8Array(t);return D0(e,r,n,0),n}function M0(e){var t=typeof e;if(t==="string"){var r=ng(e);if(r<32)return 1+r;if(r<256)return 2+r;if(r<65536)return 3+r;if(r<4294967296)return 5+r}if(e instanceof Uint8Array){var n=e.byteLength;if(n<256)return 2+n;if(n<65536)return 3+n;if(n<4294967296)return 5+n}if(t==="number"){if(Math.floor(e)!==e)return 9;if(e>=0){if(e<128)return 1;if(e<256)return 2;if(e<65536)return 3;if(e<4294967296)return 5;throw new Error("Number too big 0x"+e.toString(16))}if(e>=-32)return 1;if(e>=-128)return 2;if(e>=-32768)return 3;if(e>=-2147483648)return 5;throw new Error("Number too small -0x"+e.toString(16).substr(1))}if(t==="boolean"||e===null||e===void 0)return 1;if(t==="object"){var a,i=0;if(Array.isArray(e)){a=e.length;for(var o=0;o<a;o++)i+=M0(e[o])}else{var s=Object.keys(e);a=s.length;for(var o=0;o<a;o++){var u=s[o];i+=M0(u)+M0(e[u])}}if(a<16)return 1+i;if(a<65536)return 3+i;if(a<4294967296)return 5+i;throw new Error("Array or object too long 0x"+a.toString(16))}throw new Error("Unknown type "+t)}function D0(e,t,r,n){var a=typeof e;if(a==="string"){var i=ng(e);if(i<32)return t.setUint8(n,i|160),qf(r,n+1,e),1+i;if(i<256)return t.setUint8(n,217),t.setUint8(n+1,i),qf(r,n+2,e),2+i;if(i<65536)return t.setUint8(n,218),t.setUint16(n+1,i),qf(r,n+3,e),3+i;if(i<4294967296)return t.setUint8(n,219),t.setUint32(n+1,i),qf(r,n+5,e),5+i}if(e instanceof Uint8Array){var o=e.byteLength,s=new Uint8Array(t.buffer);if(o<256)return t.setUint8(n,196),t.setUint8(n+1,o),s.set(e,n+2),2+o;if(o<65536)return t.setUint8(n,197),t.setUint16(n+1,o),s.set(e,n+3),3+o;if(o<4294967296)return t.setUint8(n,198),t.setUint32(n+1,o),s.set(e,n+5),5+o}if(a==="number"){if(!isFinite(e))throw new Error("Number not finite: "+e);if(Math.floor(e)!==e)return t.setUint8(n,203),t.setFloat64(n+1,e),9;if(e>=0){if(e<128)return t.setUint8(n,e),1;if(e<256)return t.setUint8(n,204),t.setUint8(n+1,e),2;if(e<65536)return t.setUint8(n,205),t.setUint16(n+1,e),3;if(e<4294967296)return t.setUint8(n,206),t.setUint32(n+1,e),5;throw new Error("Number too big 0x"+e.toString(16))}if(e>=-32)return t.setInt8(n,e),1;if(e>=-128)return t.setUint8(n,208),t.setInt8(n+1,e),2;if(e>=-32768)return t.setUint8(n,209),t.setInt16(n+1,e),3;if(e>=-2147483648)return t.setUint8(n,210),t.setInt32(n+1,e),5;throw new Error("Number too small -0x"+(-e).toString(16).substr(1))}if(e==null)return t.setUint8(n,192),1;if(a==="boolean")return t.setUint8(n,e?195:194),1;if(a==="object"){var u,l=0,c=Array.isArray(e),d=void 0;if(c?u=e.length:(d=Object.keys(e),u=d.length),u<16?(t.setUint8(n,u|(c?144:128)),l=1):u<65536?(t.setUint8(n,c?220:222),t.setUint16(n+1,u),l=3):u<4294967296&&(t.setUint8(n,c?221:223),t.setUint32(n+1,u),l=5),c)for(var f=0;f<u;f++)l+=D0(e[f],t,r,n+l);else for(var f=0,p=d.length;f<p;f++){var h=d[f];l+=D0(h,t,r,n+l),l+=D0(e[h],t,r,n+l)}return l}throw new Error("Unknown type "+a)}var yZ=function(){function e(t,r,n){this.autoClassify=n,this.dataBlocks=[],this.filter=qi.DefaultFilter,this.formatter=qi.DefaultFormatter,this.isBinary=!0,this.binaryEncodingProvider=void 0,this.binaryEncodingProvider=r,this.data={encoder:t,version:lQ,dataBlocks:this.dataBlocks}}return e.prototype.setFilter=function(t){this.filter=t||qi.DefaultFilter},e.prototype.isCategoryIncluded=function(t){return this.filter.includeCategory(t)},e.prototype.setFormatter=function(t){this.formatter=t||qi.DefaultFormatter},e.prototype.startDataBlock=function(t){this.dataBlocks.push({header:(t||"").replace(/[ \n\t]/g,"").toUpperCase(),categories:[]})},e.prototype.writeCategory=function(t,r,n){if(!this.data)throw new Error("The writer contents have already been encoded, no more writing.");if(!this.dataBlocks.length)throw new Error("No data block created.");if(!(!(n!=null&&n.ignoreFilter)&&!this.filter.includeCategory(t.name))){var a=L6(t,r),i=a.instance,o=a.rowCount,s=a.source;if(!!o){for(var u={name:"_"+t.name,columns:[],rowCount:o},l=o3(i),c=0,d=l;c<d.length;c++){var f=d[c];if(!!this.filter.includeField(t.name,f.name)){var p=this.formatter.getFormat(t.name,f.name);u.columns.push(_Z(t.name,f,s,o,p,this.binaryEncodingProvider,this.autoClassify))}}!u.columns.length||this.dataBlocks[this.dataBlocks.length-1].categories.push(u)}}},e.prototype.encode=function(){this.encodedData||(this.encodedData=gZ(this.data),this.data=null,this.dataBlocks=null)},e.prototype.writeTo=function(t){t.writeBinary(this.encodedData)},e.prototype.getData=function(){return this.encode(),this.encodedData},e.prototype.getSize=function(){return this.encodedData.length},e}();function bZ(e,t){return t&&t.typedArray?t.typedArray:e.defaultFormat&&e.defaultFormat.typedArray?e.defaultFormat.typedArray:e.type===0?Array:e.type===1?Int32Array:Float64Array}function SZ(e){return e===0?gc.by(mr.stringArray):gc.by(mr.byteArray)}function xZ(e,t,r,n){return r&&r.encoder?r.encoder:t.defaultFormat&&t.defaultFormat.encoder?t.defaultFormat.encoder:n?n.get(e,t.name):void 0}function CZ(e,t){return e===0?gc.by(mr.stringArray):e===1?Tx(t):hQ(t)}function _Z(e,t,r,n,a,i,o){var s=wZ(t,bZ(t,a),n,r),u=s.array,l=s.allPresent,c=s.mask,d=xZ(e,t,a,i);d||(o?d=CZ(t.type,u):d=SZ(t.type));var f=d.encode(u),p=void 0;if(!l){var h=gc.by(mr.runLength).and(mr.byteArray).encode(c);h.data.length<c.length?p=h:p=gc.by(mr.byteArray).encode(c)}return{name:t.name,data:f,mask:p}}function wZ(e,t,r,n){for(var a=e.type===0,i=new t(r),o=new Uint8Array(r),s=e.valueKind,u=e.value,l=!0,c=0,d=0;d<n.length;d++)for(var f=n[d].data,p=n[d].keys();p.hasNext;){var h=p.move(),v=s?s(h,f):0;v!==0?(o[c]=v,a&&(i[c]=""),l=!1):(o[c]=0,i[c]=u(h,f,c)),c++}return{array:i,allPresent:l,mask:o}}var ca;(function(e){e.Encoder=Dx,e.Category=qi,e.Field=Mx,e.Encoding=mr;function t(u){var l=u||{},c=l.binary,d=c===void 0?!1:c,f=l.encoderName,p=f===void 0?"mol*":f;return d?new yZ(p,u?u.binaryEncodingPovider:void 0,u?!!u.binaryAutoClassifyEncoding:!1):new uZ}e.createEncoder=t;function r(){return e.Field.build()}e.fields=r;var n=e.Encoding;e.Encodings={deltaRLE:n.by(n.delta).and(n.runLength).and(n.integerPacking),fixedPoint2:n.by(n.fixedPoint(100)).and(n.delta).and(n.integerPacking),fixedPoint3:n.by(n.fixedPoint(1e3)).and(n.delta).and(n.integerPacking)};function a(u,l){return{fields:u,source:[l]}}e.categoryInstance=a;function i(u){return{get:function(l,c){var d=u.categories[l];if(!!d){var f=d.getField(c);return f&&f.binaryEncoding?gc.fromEncoding(f.binaryEncoding):void 0}}}}e.createEncodingProviderFromCifFrame=i;function o(u){return{get:function(l,c){for(var d=0;d<u.length;d++){var f=u[d];if(f.categoryName===l&&f.columnName===c)return s(f)}}}}e.createEncodingProviderFromJsonConfig=o;function s(u){var l=u.precision;if(l!==void 0){var c=Math.pow(10,l),d=n.by(n.fixedPoint(c));switch(u.encoding){case"pack":return d.and(n.integerPacking);case"rle":return d.and(n.runLength).and(n.integerPacking);case"delta":return d.and(n.delta).and(n.integerPacking);case"delta-rle":return d.and(n.delta).and(n.runLength).and(n.integerPacking)}}else switch(u.encoding){case"pack":return n.by(n.integerPacking);case"rle":return n.by(n.runLength).and(n.integerPacking);case"delta":return n.by(n.delta).and(n.integerPacking);case"delta-rle":return n.by(n.delta).and(n.runLength).and(n.integerPacking)}throw new Error("cannot be reached")}})(ca||(ca={}));var AZ={U:vr.atom_site_anisotrop.U,U_esd:vr.atom_site_anisotrop.U_esd},js;(function(e){e.Schema=AZ,e.Descriptor={name:"atom_site_anisotrop",cifExport:{prefix:"",categories:[{name:"atom_site_anisotrop",instance:function(n){var a=e.Provider.get(n.firstModel);return!a||!Jr.is(n.firstModel.sourceData)?ca.Category.Empty:ca.Category.ofTable(n.firstModel.sourceData.data.db.atom_site_anisotrop)}}]}},e.Provider=ds.create(e.Descriptor);function t(n,a){var i=new Int32Array(n.rowCount);i.fill(-1);for(var o=0,s=n.rowCount;o<s;o++)i[n.value(o)]=o;var u=new Int32Array(n.rowCount);u.fill(-1);for(var o=0,s=a.rowCount;o<s;++o){var l=i[a.value(o)];l!==-1&&(u[l]=o)}return u}e.getElementToAnsiotrop=t;function r(n,a){for(var i={},o=0,s=n.rowCount;o<s;o++)i[n.value(o)]=o;var u=new Int32Array(n.rowCount);u.fill(-1);for(var o=0,s=a.rowCount;o<s;++o){var l=i[a.value(o)];l!==void 0&&(u[l]=o)}return u}e.getElementToAnsiotropFromLabel=r})(js||(js={}));var gv;(function(e){e.Descriptor={name:"chem_comp_bond",cifExport:{prefix:"",categories:[{name:"chem_comp_bond",instance:function(a){var i=e.Provider.get(a.firstModel);if(!i)return ca.Category.Empty;var o=i.data;if(!o)return ca.Category.Empty;for(var s=a.structures[0].uniqueResidueNames,u=o.comp_id,l=o._rowCount,c=[],d=0;d<l;d++)s.has(u.value(d))&&(c[c.length]=d);return ca.Category.ofTable(o,c)}}]}},e.Provider=ds.create(e.Descriptor);function t(a,i){return Xr.pick(i,vr.chem_comp_bond,function(o){return a.properties.chemicalComponentMap.has(i.comp_id.value(o))})}e.chemCompBondFromTable=t;function r(a){var i=new Map;function o(_){if(i.has(_))return i.get(_);var A=new n(_);return i.set(_,A),A}for(var s=a.comp_id,u=a.atom_id_1,l=a.atom_id_2,c=a.value_order,d=a.pdbx_aromatic_flag,f=a._rowCount,p=o(s.value(0)),h=0;h<f;h++){var v=s.value(h),m=u.value(h),g=l.value(h),y=c.value(h),b=d.value(h)==="Y";p.id!==v&&(p=o(v));var x=1,S=1;switch(b&&(x|=16),y.toLowerCase()){case"doub":case"delo":S=2;break;case"trip":S=3;break;case"quad":S=4;break}p.add(m,g,S,x)}return i}e.getEntriesFromChemCompBond=r;var n=function(){function a(i){this.id=i,this.map=new Map}return a.prototype.add=function(i,o,s,u,l){l===void 0&&(l=!0);var c=this.map.get(i);if(c!==void 0){var d=c.get(o);d===void 0&&c.set(o,{order:s,flags:u})}else{var f=new Map;f.set(o,{order:s,flags:u}),this.map.set(i,f)}l&&this.add(o,i,s,u,!1)},a}();e.Entry=n})(gv||(gv={}));var PZ=new Map([["HIS|CD2|CG",2],["HIS|CE1|ND1",2],["ARG|CZ|NH2",2],["PHE|CE1|CZ",2],["PHE|CD2|CE2",2],["PHE|CD1|CG",2],["TRP|CD1|CG",2],["TRP|CD2|CE2",2],["TRP|CE3|CZ3",2],["TRP|CH2|CZ2",2],["ASN|CG|OD1",2],["GLN|CD|OE1",2],["TYR|CD1|CG",2],["TYR|CD2|CE2",2],["TYR|CE1|CZ",2],["ASP|CG|OD1",2],["GLU|CD|OE1",2],["G|C8|N7",2],["G|C4|C5",2],["G|C2|N3",2],["G|C6|O6",2],["C|C4|N3",2],["C|C5|C6",2],["C|C2|O2",2],["A|C2|N3",2],["A|C6|N1",2],["A|C4|C5",2],["A|C8|N7",2],["U|C5|C6",2],["U|C2|O2",2],["U|C4|O4",2],["DG|C8|N7",2],["DG|C4|C5",2],["DG|C2|N3",2],["DG|C6|O6",2],["DC|C4|N3",2],["DC|C5|C6",2],["DC|C2|O2",2],["DA|C2|N3",2],["DA|C6|N1",2],["DA|C4|C5",2],["DA|C8|N7",2],["DT|C5|C6",2],["DT|C2|O2",2],["DT|C4|O4",2]]);function TZ(e,t,r){var n;return n=t<r?[t,r]:[r,t],t=n[0],r=n[1],Vy.has(e)&&t==="C"&&r==="O"||qy.has(e)&&t==="OP1"&&r==="P"?2:PZ.get(e+"|"+t+"|"+r)||1}var EZ=new Map([["LYS|NZ|RET|C15",2]]);function z6(e,t,r,n){var a,i;return e>r&&(a=[r,e],e=a[0],r=a[1],i=[n,t],t=i[0],n=i[1]),EZ.get(e+"|"+t+"|"+r+"|"+n)||1}var Ws;(function(e){e.Descriptor={name:"struct_conn",cifExport:{prefix:"",categories:[{name:"struct_conn",instance:function(i){var o=e.Provider.get(i.firstModel);if(!o||o.entries.length===0)return ca.Category.Empty;for(var s=i.structures[0],u=[],l=0,c=o.entries;l<c.length;l++){var d=c[l];r(s,d.partnerA.atomIndex)&&r(s,d.partnerB.atomIndex)&&(u[u.length]=d.rowIndex)}return ca.Category.ofTable(o.data,u)}}]}},e.Provider=ds.create(e.Descriptor);function t(i){var o=e.Provider.get(i);return!!o&&o.data.id.rowCount/i.atomicConformation.atomId.rowCount>.95}e.isExhaustive=t;function r(i,o){for(var s=i.units,u=0,l=s.length;u<l;u++)if(Je.indexOf(s[u].elements,o)>=0)return!0;return!1}function n(i){for(var o=new Map,s=0,u=i;s<u.length;s++){var l=u[s],c=l.partnerA.atomIndex,d=l.partnerB.atomIndex;o.has(c)?o.get(c).push(l):o.set(c,[l]),o.has(d)?o.get(d).push(l):o.set(d,[l])}return o}e.getAtomIndexFromEntries=n;function a(i,o){for(var s=i.conn_type_id,u=i.pdbx_dist_value,l=i.pdbx_value_order,c={label_asym_id:i.ptnr1_label_asym_id,label_seq_id:i.ptnr1_label_seq_id,auth_seq_id:i.ptnr1_auth_seq_id,label_atom_id:i.ptnr1_label_atom_id,label_alt_id:i.pdbx_ptnr1_label_alt_id,ins_code:i.pdbx_ptnr1_PDB_ins_code,symmetry:i.ptnr1_symmetry},d={label_asym_id:i.ptnr2_label_asym_id,label_seq_id:i.ptnr2_label_seq_id,auth_seq_id:i.ptnr2_auth_seq_id,label_atom_id:i.ptnr2_label_atom_id,label_alt_id:i.pdbx_ptnr2_label_alt_id,ins_code:i.pdbx_ptnr2_PDB_ins_code,symmetry:i.ptnr2_symmetry},f=function(S,_){if(_.label_asym_id.valueKind(S)===0){var A=_.label_asym_id.value(S),T=o.atomicHierarchy.index.findEntity(A);if(!(T<0)){var I=o.atomicHierarchy.index.findResidue(o.entities.data.id.value(T),A,_.auth_seq_id.value(S),_.ins_code.value(S));if(!(I<0)){var M=_.label_atom_id.value(S);if(!!M){var O=o.atomicHierarchy.index.findAtomOnResidue(I,M,_.label_alt_id.value(S));if(!(O<0))return{residueIndex:I,atomIndex:O,symmetry:_.symmetry.value(S)}}}}}},p=[],h=0;h<i._rowCount;h++){var v=f(h,c),m=f(h,d);if(!(v===void 0||m===void 0)){var g=s.value(h),y=(l.value(h)||"").toLowerCase(),b=0,x=1;switch(y){case"sing":x=1;break;case"doub":x=2;break;case"trip":x=3;break;case"quad":x=4;break;default:x=z6(i.ptnr1_label_comp_id.value(h),i.ptnr1_label_atom_id.value(h),i.ptnr2_label_comp_id.value(h),i.ptnr2_label_atom_id.value(h))}switch(g){case"covale":b=1;break;case"disulf":b=9;break;case"hydrog":b=4;break;case"metalc":b=2;break}p.push({rowIndex:h,flags:b,order:x,distance:u.value(h),partnerA:v,partnerB:m})}}return p}e.getEntriesFromStructConn=a})(Ws||(Ws={}));var Sd;(function(e){var t,r="molstar_global_model_transform_info";e.Schema=(t={},t[r]={matrix:ve.Schema.Matrix(4,4,ve.Schema.float)},t),e.Descriptor=Pi({name:r,cifExport:{categories:[{name:r,instance:function(u){var l=a(u.firstModel);if(!l)return ca.Category.Empty;var c=Xr.ofRows(e.Schema.molstar_global_model_transform_info,[{matrix:l}]);return ca.Category.ofTable(c)}}],prefix:"molstar"}}),e.Provider=ds.create(e.Descriptor);function n(u,l){u.customProperties.has(e.Descriptor)||u.customProperties.add(e.Descriptor),e.Provider.set(u,l)}e.attach=n;function a(u){return e.Provider.get(u)}e.get=a;function i(u){if(!!Jr.is(u.sourceData)){var l=u.sourceData.data.frame.categories[r];if(!!l){var c=R6(e.Schema[r],l);if(c._rowCount!==0)return c.matrix.value(0)}}}e.fromMmCif=i;function o(u){if(!Jr.is(u.sourceData))return!1;var l=u.sourceData.data.frame.categories[r];return!!l&&l.rowCount>0}e.hasData=o;function s(u,l){u.writeCategory({name:r,instance:function(){var c=Xr.ofRows(e.Schema.molstar_global_model_transform_info,[{matrix:l}]);return ca.Category.ofTable(c)}})}e.writeMmCif=s})(Sd||(Sd={}));function IZ(e){if(!!Jr.is(e.sourceData))return qn.fromData(e.sourceData.data.db)}qn.Provider.formatRegistry.add("mmCIF",IZ);function MZ(e){if(!!Jr.is(e.sourceData)){var t=e.sourceData.data.db,r=t.struct_conf,n=t.struct_sheet_range;return mv.fromStruct(r,n,e.atomicHierarchy)}}mv.Provider.formatRegistry.add("mmCIF",MZ);function DZ(e){if(!!Jr.is(e.sourceData)){var t=e.sourceData.data.db.atom_site_anisotrop,r=Xr.ofColumns(js.Schema,t),n=js.getElementToAnsiotrop(e.atomicConformation.atomId,t.id);return{data:r,elementToAnsiotrop:n}}}function RZ(e){return Jr.is(e.sourceData)?e.sourceData.data.db.atom_site_anisotrop.U.isDefined:!1}js.Provider.formatRegistry.add("mmCIF",DZ,RZ);function OZ(e){if(!!Jr.is(e.sourceData)){var t=e.sourceData.data.db.chem_comp_bond;if(t._rowCount!==0)return{data:t,entries:gv.getEntriesFromChemCompBond(t)}}}gv.Provider.formatRegistry.add("mmCIF",OZ);function FZ(e){if(!!Jr.is(e.sourceData)){var t=e.sourceData.data.db.struct_conn;if(t._rowCount!==0){var r=Ws.getEntriesFromStructConn(t,e);return{data:t,byAtomIndex:Ws.getAtomIndexFromEntries(r),entries:r}}}}Ws.Provider.formatRegistry.add("mmCIF",FZ);Sd.Provider.formatRegistry.add("mmCIF",Sd.fromMmCif,Sd.hasData);var Jr;(function(e){function t(n){return(n==null?void 0:n.kind)==="mmCIF"}e.is=t;function r(n,a,i){return a||(a=Gu.schema.mmCIF(n)),{kind:"mmCIF",name:a._name,data:{db:a,frame:n,source:i}}}e.fromFrame=r})(Jr||(Jr={}));function V6(e){var t=Jr.fromFrame(e);return We.create("Create mmCIF Model",function(r){return al(t.data.db,t,r)})}var Ze;(function(e){function t(f,p,h){return{kind:"element-location",structure:f,unit:p,element:h||0}}e.create=t;function r(f){return t(f.structure,f.unit,f.element)}e.clone=r;function n(f,p,h,v){return p&&(f.structure=p),h&&(f.unit=h),v!==void 0&&(f.element=v),f}e.set=n;function a(f,p){return f.unit=p.unit,f.element=p.element,f}e.copy=a;function i(f){return!!f&&f.kind==="element-location"}e.is=i;function o(f,p){return f.unit===p.unit&&f.element===p.element}e.areEqual=o;var s=C.zero(),u=C.zero();function l(f,p){return f.unit.conformation.position(f.element,s),p.unit.conformation.position(p.element,u),C.distance(s,u)}e.distance=l;function c(f){return f.unit.model.atomicHierarchy.residueAtomSegments.index[f.element]}e.residueIndex=c;function d(f){return f.unit.model.atomicHierarchy.chainAtomSegments.index[f.element]}e.chainIndex=d})(Ze||(Ze={}));var De;(function(e){function t(s,u,l){return{kind:"variable",name:s,type:u,isConstraint:l}}e.Variable=t;function r(s,u,l){return{kind:"value",namespace:s,name:u,parent:l}}e.Value=r;function n(s,u,l,c){return{kind:"container",namespace:s,name:u,child:l,alias:c}}e.Container=n;function a(s){return{kind:"union",types:s}}e.Union=a;function i(s,u,l,c){for(var d=Object.create(null),f=0,p=c;f<p.length;f++){var h=p[f];d[h]=!0}return{kind:"oneof",namespace:s,name:u,type:l,values:d}}e.OneOf=i,e.Any={kind:"any"},e.AnyValue={kind:"any-value"},e.Num=r("","Number"),e.Str=r("","String"),e.Bool=i("","Bool",e.Str,["true","false"]);function o(s){var u=s.values;return Object.keys(u).sort()}e.oneOfValues=o})(De||(De={}));var na;(function(e){function t(u){return{name:u}}e.Symbol=t;function r(u,l){return l?{head:u,args:l}:{head:u}}e.Apply=r;function n(u){return!!u&&Array.isArray(u)}e.isArgumentsArray=n;function a(u){return!!u&&!Array.isArray(u)}e.isArgumentsMap=a;function i(u){return!o(u)&&!s(u)}e.isLiteral=i;function o(u){return!!u&&!!u.head&&typeof u=="object"}e.isApply=o;function s(u){return!!u&&typeof u.name=="string"}e.isSymbol=s})(na||(na={}));function vt(e,t){var r=t||{},n=r.description,a=n===void 0?void 0:n,i=r.isOptional,o=i===void 0?!1:i,s=r.isRest,u=s===void 0?!1:s,l=r.defaultValue,c=l===void 0?void 0:l;return{type:e,isOptional:o,isRest:u,defaultValue:c,description:a}}var Dt;(function(e){e.None=t({});function t(n){return{kind:"dictionary",map:n,"@type":0}}e.Dictionary=t;function r(n,a){var i=(a||{}).nonEmpty,o=i===void 0?!1:i;return{kind:"list",type:n,nonEmpty:o,"@type":0}}e.List=r})(Dt||(Dt={}));function Ah(e,t,r,n){var a=function(i){return na.Apply(na.Symbol(a.id),i)};return a.info={namespace:"",name:e,description:n},a.id="",a.args=t,a.type=r,a}function LP(e,t,r,n){var a=function(i){return na.Apply(na.Symbol(a.id),i)};return a.info={namespace:e,name:t,description:n},a.id=e+"."+t,a.args=Dt.None,a.type=r,a}function mg(e){var t=e;return typeof t=="function"&&!!t.info&&!!t.args&&typeof t.info.namespace=="string"&&!!t.type}function Ut(e,t,r){return Ah("",e,t,r)}function H6(e){q6("","",e)}function G6(e){var t=[];return j6(e,t),t}function NP(e){var t=/([a-z])([A-Z])([a-z]|$)/g;return e.replace(t,function(r,n,a,i){return n+"-"+a.toLocaleLowerCase()+i}).replace(t,function(r,n,a,i){return n+"-"+a.toLocaleLowerCase()+i})}function q6(e,t,r){if(mg(r)){r.info.namespace=e,r.info.name=r.info.name||NP(t),r.id=r.info.namespace+"."+r.info.name;return}for(var n=""+(r["@namespace"]||NP(t)),a=e?e+"."+n:n,i=0,o=Object.keys(r);i<o.length;i++){var s=o[i];typeof r[s]!="object"&&!mg(r[s])||q6(a,s,r[s])}}function j6(e,t){if(mg(e)){t.push(e);return}for(var r=0,n=Object.keys(e);r<n.length;r++){var a=n[r];typeof e[a]!="object"&&!mg(e[a])||j6(e[a],t)}}var xr;(function(e){e.AnyVar=De.Variable("a",De.Any),e.AnyValueVar=De.Variable("a",De.Any),e.ConstrainedVar=De.Variable("a",De.Any,!0),e.Regex=De.Value("Core","Regex"),e.Set=function(t){return De.Container("Core","Set",t||e.AnyValueVar)},e.List=function(t){return De.Container("Core","List",t||e.AnyVar)},e.Fn=function(t,r){return De.Container("Core","Fn",t||e.AnyVar,r)},e.Flags=function(t,r){return De.Container("Core","Flags",t,r)},e.BitFlags=e.Flags(De.Num,"BitFlags")})(xr||(xr={}));function fa(e,t){return Ut(Dt.Dictionary({0:vt(e)}),e,t)}function Xl(e,t){return Ut(Dt.List(e,{nonEmpty:!0}),e,t)}function Fs(e,t,r){return Ut(Dt.Dictionary({0:vt(e),1:vt(e)}),t,r)}Dt.Dictionary({0:vt(De.Num),1:vt(De.Num)});vt(De.Str);var kZ={"@header":"Types",bool:Ut(Dt.Dictionary({0:vt(De.AnyValue)}),De.Bool,"Convert a value to boolean."),num:Ut(Dt.Dictionary({0:vt(De.AnyValue)}),De.Num,"Convert a value to number."),str:Ut(Dt.Dictionary({0:vt(De.AnyValue)}),De.Str,"Convert a value to string."),regex:Ut(Dt.Dictionary({0:vt(De.Str,{description:"Expression"}),1:vt(De.Str,{isOptional:!0,description:"Flags, e.g. 'i' for ignore case"})}),xr.Regex,"Creates a regular expression from a string using the ECMAscript syntax."),list:Ut(Dt.List(xr.AnyVar),xr.List()),set:Ut(Dt.List(xr.AnyValueVar),xr.Set()),bitflags:Ut(Dt.Dictionary({0:vt(De.Num)}),xr.BitFlags,"Interpret a number as bitflags."),compositeKey:Ut(Dt.List(De.AnyValue),De.AnyValue)},BZ={"@header":"Logic",not:fa(De.Bool),and:Xl(De.Bool),or:Xl(De.Bool)},LZ={"@header":"Control",eval:Ut(Dt.Dictionary({0:vt(xr.Fn(xr.AnyVar))}),xr.AnyVar,"Evaluate a function."),fn:Ut(Dt.Dictionary({0:vt(xr.AnyVar)}),xr.Fn(xr.AnyVar),'Wrap an expression to a "lazy" function.'),if:Ut(Dt.Dictionary({0:vt(De.Bool,{description:"Condition"}),1:vt(De.Variable("a",De.Any),{description:"If true"}),2:vt(De.Variable("b",De.Any),{description:"If false"})}),De.Union([De.Variable("a",De.Any),De.Variable("b",De.Any)])),assoc:Ut(Dt.Dictionary({0:vt(De.Str,{description:"Name"}),1:vt(De.Variable("a",De.Any),{description:"Value to assign"})}),De.Variable("a",De.Any))},NZ={"@header":"Relational",eq:Fs(De.Variable("a",De.AnyValue,!0),De.Bool),neq:Fs(De.Variable("a",De.AnyValue,!0),De.Bool),lt:Fs(De.Num,De.Bool),lte:Fs(De.Num,De.Bool),gr:Fs(De.Num,De.Bool),gre:Fs(De.Num,De.Bool),inRange:Ut(Dt.Dictionary({0:vt(De.Num,{description:"Value to test"}),1:vt(De.Num,{description:"Minimum value"}),2:vt(De.Num,{description:"Maximum value"})}),De.Bool,"Check if the value of the 1st argument is >= 2nd and <= 3rd.")},UZ={"@header":"Math",add:Xl(De.Num),sub:Xl(De.Num),mult:Xl(De.Num),div:Fs(De.Num,De.Num),pow:Fs(De.Num,De.Num),mod:Fs(De.Num,De.Num),min:Xl(De.Num),max:Xl(De.Num),floor:fa(De.Num),ceil:fa(De.Num),roundInt:fa(De.Num),abs:fa(De.Num),sqrt:fa(De.Num),cbrt:fa(De.Num),sin:fa(De.Num),cos:fa(De.Num),tan:fa(De.Num),asin:fa(De.Num),acos:fa(De.Num),atan:fa(De.Num),sinh:fa(De.Num),cosh:fa(De.Num),tanh:fa(De.Num),exp:fa(De.Num),log:fa(De.Num),log10:fa(De.Num),atan2:Fs(De.Num,De.Num)},zZ={"@header":"Strings",concat:Xl(De.Str),match:Ut(Dt.Dictionary({0:vt(xr.Regex),1:vt(De.Str)}),De.Bool)},VZ={"@header":"Lists",getAt:Ut(Dt.Dictionary({0:vt(xr.List()),1:vt(De.Num)}),xr.AnyVar),equal:Ut(Dt.Dictionary({0:vt(xr.List()),1:vt(xr.List())}),De.Bool)},HZ={"@header":"Sets",has:Ut(Dt.Dictionary({0:vt(xr.Set(xr.ConstrainedVar)),1:vt(xr.ConstrainedVar)}),De.Bool,"Check if the the 1st argument includes the value of the 2nd."),isSubset:Ut(Dt.Dictionary({0:vt(xr.Set(xr.ConstrainedVar)),1:vt(xr.Set(xr.ConstrainedVar))}),De.Bool,"Check if the the 1st argument is a subset of the 2nd.")},GZ={"@header":"Flags",hasAny:Ut(Dt.Dictionary({0:vt(xr.Flags(xr.ConstrainedVar)),1:vt(xr.Flags(xr.ConstrainedVar))}),De.Bool,"Check if the the 1st argument has at least one of the 2nd one's flags."),hasAll:Ut(Dt.Dictionary({0:vt(xr.Flags(xr.ConstrainedVar)),1:vt(xr.Flags(xr.ConstrainedVar))}),De.Bool,"Check if the the 1st argument has all 2nd one's flags.")},s3={"@header":"Language Primitives",type:kZ,logic:BZ,ctrl:LZ,rel:NZ,math:UZ,str:zZ,list:VZ,set:HZ,flags:GZ};H6(s3);var qZ=G6(s3);(function(){for(var e=Object.create(null),t=0,r=qZ;t<r.length;t++){var n=r[t];e[n.id]=n}return e})();var Pt;(function(e){e.ElementSymbol=De.Value("Structure","ElementSymbol"),e.AtomName=De.Value("Structure","AtomName"),e.BondFlag=De.OneOf("Structure","BondFlag",De.Str,["covalent","metallic","ion","hydrogen","sulfide","computed","aromatic"]),e.BondFlags=xr.Flags(e.BondFlag,"BondFlags"),e.SecondaryStructureFlag=De.OneOf("Structure","SecondaryStructureFlag",De.Str,["alpha","beta","3-10","pi","sheet","strand","helix","turn","none"]),e.SecondaryStructureFlags=xr.Flags(e.SecondaryStructureFlag,"SecondaryStructureFlag"),e.RingFingerprint=De.Value("Structure","RingFingerprint"),e.EntityType=De.OneOf("Structure","EntityType",De.Str,["polymer","non-polymer","water","branched"]),e.EntitySubtype=De.OneOf("Structure","EntitySubtype",De.Str,["other","polypeptide(D)","polypeptide(L)","polydeoxyribonucleotide","polyribonucleotide","polydeoxyribonucleotide/polyribonucleotide hybrid","cyclic-pseudo-peptide","peptide nucleic acid","oligosaccharide"]),e.ObjectPrimitive=De.OneOf("Structure","ObjectPrimitive",De.Str,["atomistic","sphere","gaussian","other"]),e.ResidueId=De.Value("Structure","ResidueId"),e.ElementSet=De.Value("Structure","ElementSet"),e.ElementSelection=De.Value("Structure","ElementSelection"),e.ElementReference=De.Value("Structure","ElementReference"),e.ElementSelectionQuery=xr.Fn(e.ElementSelection,"ElementSelectionQuery")})(Pt||(Pt={}));var jZ={"@header":"Types",elementSymbol:Ut(Dt.Dictionary({0:vt(De.Str)}),Pt.ElementSymbol,"Create element symbol representation from a string value."),atomName:Ut(Dt.Dictionary({0:vt(De.AnyValue)}),Pt.AtomName,"Convert a value to an atom name."),entityType:Ut(Dt.Dictionary({0:vt(Pt.EntityType)}),Pt.EntityType,"Create normalized representation of entity type: "+De.oneOfValues(Pt.EntityType).join(", ")+"."),bondFlags:Ut(Dt.List(Pt.BondFlag),Pt.BondFlags,"Create bond flags representation from a list of strings. Allowed flags: "+De.oneOfValues(Pt.BondFlag).join(", ")+"."),ringFingerprint:Ut(Dt.List(Pt.ElementSymbol,{nonEmpty:!0}),Pt.RingFingerprint,"Create ring fingerprint from the supplied atom element list."),secondaryStructureFlags:Ut(Dt.List(Pt.SecondaryStructureFlag),Pt.SecondaryStructureFlags,"Create secondary structure flags representation from a list of strings. Allowed flags: "+De.oneOfValues(Pt.SecondaryStructureFlag).join(", ")+"."),authResidueId:Ut(Dt.Dictionary({0:vt(De.Str,{description:"auth_asym_id"}),1:vt(De.Num,{description:"auth_seq_id"}),2:vt(De.Str,{description:"pdbx_PDB_ins_code",isOptional:!0})}),Pt.ResidueId,'Residue identifier based on "auth_" annotation.'),labelResidueId:Ut(Dt.Dictionary({0:vt(De.Str,{description:"label_entity_id"}),1:vt(De.Str,{description:"label_asym_id"}),2:vt(De.Num,{description:"label_seq_id"}),3:vt(De.Str,{description:"pdbx_PDB_ins_code",isOptional:!0})}),Pt.ResidueId,`Residue identifier based on mmCIF's "label_" annotation.`)},WZ={"@header":"Iteration Slots",element:Ut(Dt.None,Pt.ElementReference,"A reference to the current element."),elementSetReduce:Ut(Dt.None,De.Variable("a",De.AnyValue,!0),"Current value of the element set reducer.")},XZ={"@header":"Generators",all:Ut(Dt.None,Pt.ElementSelectionQuery,"The entire structure."),atomGroups:Ut(Dt.Dictionary({"entity-test":vt(De.Bool,{isOptional:!0,defaultValue:!0,description:"Test for the 1st atom of every entity"}),"chain-test":vt(De.Bool,{isOptional:!0,defaultValue:!0,description:"Test for the 1st atom of every chain"}),"residue-test":vt(De.Bool,{isOptional:!0,defaultValue:!0,description:"Test for the 1st atom every residue"}),"atom-test":vt(De.Bool,{isOptional:!0,defaultValue:!0}),"group-by":vt(De.Any,{isOptional:!0,defaultValue:"atom-key",description:"Group atoms to sets based on this property. Default: each atom has its own set"})}),Pt.ElementSelectionQuery,"Return all atoms for which the tests are satisfied, grouped into sets."),bondedAtomicPairs:Ut(Dt.Dictionary({0:vt(De.Bool,{isOptional:!0,defaultValue:"true for covalent bonds",description:"Test each bond with this predicate. Each bond is visited twice with swapped atom order."})}),Pt.ElementSelectionQuery,"Return all pairs of atoms for which the test is satisfied."),rings:Ut(Dt.Dictionary({fingerprint:vt(Pt.RingFingerprint,{isOptional:!0}),"only-aromatic":vt(De.Bool,{isOptional:!0,defaultValue:!1})}),Pt.ElementSelectionQuery,"Return all rings or those with the specified fingerprint and/or only aromatic rings."),queryInSelection:Ut(Dt.Dictionary({0:vt(Pt.ElementSelectionQuery),query:vt(Pt.ElementSelectionQuery),"in-complement":vt(De.Bool,{isOptional:!0,defaultValue:!1})}),Pt.ElementSelectionQuery,"Executes query only on atoms that are in the source selection."),empty:Ut(Dt.None,Pt.ElementSelectionQuery,"Nada.")},YZ={"@header":"Selection Modifications",queryEach:Ut(Dt.Dictionary({0:vt(Pt.ElementSelectionQuery),query:vt(Pt.ElementSelectionQuery)}),Pt.ElementSelectionQuery,"Query every atom set in the input selection separately."),intersectBy:Ut(Dt.Dictionary({0:vt(Pt.ElementSelectionQuery),by:vt(Pt.ElementSelectionQuery)}),Pt.ElementSelectionQuery,"Intersect each atom set from the first sequence from atoms in the second one."),exceptBy:Ut(Dt.Dictionary({0:vt(Pt.ElementSelectionQuery),by:vt(Pt.ElementSelectionQuery)}),Pt.ElementSelectionQuery,"Remove all atoms from 'selection' that occur in 'by'."),unionBy:Ut(Dt.Dictionary({0:vt(Pt.ElementSelectionQuery),by:vt(Pt.ElementSelectionQuery)}),Pt.ElementSelectionQuery,"For each atom set A in the orginal sequence, combine all atoms sets in the target selection that intersect with A."),union:Ut(Dt.Dictionary({0:vt(Pt.ElementSelectionQuery)}),Pt.ElementSelectionQuery,"Collects all atom sets in the sequence into a single atom set."),cluster:Ut(Dt.Dictionary({0:vt(Pt.ElementSelectionQuery),"min-distance":vt(De.Num,{isOptional:!0,defaultValue:0}),"max-distance":vt(De.Num),"min-size":vt(De.Num,{description:"Minimal number of sets to merge, must be at least 2",isOptional:!0,defaultValue:2}),"max-size":vt(De.Num,{description:"Maximal number of sets to merge, if not set, no limit",isOptional:!0})}),Pt.ElementSelectionQuery,"Combines atom sets that have mutual distance in the interval [min-radius, max-radius]. Minimum/maximum size determines how many atom sets can be combined."),includeSurroundings:Ut(Dt.Dictionary({0:vt(Pt.ElementSelectionQuery),radius:vt(De.Num),"atom-radius":vt(De.Num,{isOptional:!0,defaultValue:0,description:"Value added to each atom before the distance check, for example VDW radius. Using this argument is computationally demanding."}),"as-whole-residues":vt(De.Bool,{isOptional:!0})}),Pt.ElementSelectionQuery,"For each atom set in the selection, include all surrouding atoms/residues that are within the specified radius."),surroundingLigands:Ut(Dt.Dictionary({0:vt(Pt.ElementSelectionQuery),radius:vt(De.Num),"include-water":vt(De.Bool,{isOptional:!0,defaultValue:!0})}),Pt.ElementSelectionQuery,"Find all ligands components around the source query."),includeConnected:Ut(Dt.Dictionary({0:vt(Pt.ElementSelectionQuery),"bond-test":vt(De.Bool,{isOptional:!0,defaultValue:"true for covalent bonds"}),"layer-count":vt(De.Num,{isOptional:!0,defaultValue:1,description:"Number of bonded layers to include."}),"fixed-point":vt(De.Bool,{isOptional:!0,defaultValue:!1,description:"Continue adding layers as long as new connections exist."}),"as-whole-residues":vt(De.Bool,{isOptional:!0})}),Pt.ElementSelectionQuery,"Pick all atom sets that are connected to the target."),wholeResidues:Ut(Dt.Dictionary({0:vt(Pt.ElementSelectionQuery)}),Pt.ElementSelectionQuery,"Expand the selection to whole residues."),expandProperty:Ut(Dt.Dictionary({0:vt(Pt.ElementSelectionQuery),property:vt(De.AnyValue)}),Pt.ElementSelectionQuery,"To each atom set in the selection, add all atoms that have the same property value that was already present in the set.")},KZ={"@header":"Selection Filters",pick:Ut(Dt.Dictionary({0:vt(Pt.ElementSelectionQuery),test:vt(De.Bool)}),Pt.ElementSelectionQuery,"Pick all atom sets that satisfy the test."),first:Ut(Dt.Dictionary({0:vt(Pt.ElementSelectionQuery)}),Pt.ElementSelectionQuery,"Take the 1st atom set in the sequence."),withSameAtomProperties:Ut(Dt.Dictionary({0:vt(Pt.ElementSelectionQuery),source:vt(Pt.ElementSelectionQuery),property:vt(De.Any)}),Pt.ElementSelectionQuery,"Pick all atom sets for which the set of given atom properties is a subset of the source properties."),intersectedBy:Ut(Dt.Dictionary({0:vt(Pt.ElementSelectionQuery),by:vt(Pt.ElementSelectionQuery)}),Pt.ElementSelectionQuery,"Pick all atom sets that have non-zero intersection with the target."),within:Ut(Dt.Dictionary({0:vt(Pt.ElementSelectionQuery),target:vt(Pt.ElementSelectionQuery),"min-radius":vt(De.Num,{isOptional:!0,defaultValue:0}),"max-radius":vt(De.Num),"atom-radius":vt(De.Num,{isOptional:!0,defaultValue:0,description:"Value added to each atom before the distance check, for example VDW radius. Using this argument is computationally demanding."}),invert:vt(De.Bool,{isOptional:!0,defaultValue:!1,description:"If true, pick only atom sets that are further than the specified radius."})}),Pt.ElementSelectionQuery,"Pick all atom sets from selection that have any atom within the radius of any atom from target."),isConnectedTo:Ut(Dt.Dictionary({0:vt(Pt.ElementSelectionQuery),target:vt(Pt.ElementSelectionQuery),"bond-test":vt(De.Bool,{isOptional:!0,defaultValue:"true for covalent bonds"}),disjunct:vt(De.Bool,{isOptional:!0,defaultValue:!0,description:"If true, there must exist a bond to an atom that lies outside the given atom set to pass test."}),invert:vt(De.Bool,{isOptional:!0,defaultValue:!1,description:"If true, return atom sets that are not connected."})}),Pt.ElementSelectionQuery,"Pick all atom sets that are connected to the target.")},$Z={"@header":"Selection Combinators",intersect:Ut(Dt.List(Pt.ElementSelectionQuery),Pt.ElementSelectionQuery,"Return all unique atom sets that appear in all of the source selections."),merge:Ut(Dt.List(Pt.ElementSelectionQuery),Pt.ElementSelectionQuery,"Merges multiple selections into a single one. Only unique atom sets are kept."),distanceCluster:Ut(Dt.Dictionary({matrix:vt(xr.List(xr.List(De.Num)),{description:"Distance matrix, represented as list of rows (num[][])). Lower triangle is min distance, upper triangle is max distance."}),selections:vt(xr.List(Pt.ElementSelectionQuery),{description:"A list of held selections."})}),Pt.ElementSelectionQuery,"Pick combinations of atom sets from the source sequences that are mutually within distances specified by a matrix.")},QZ={"@header":"Atom Sets",atomCount:Ut(Dt.None,De.Num),countQuery:Ut(Dt.Dictionary({0:vt(Pt.ElementSelectionQuery)}),De.Num,"Counts the number of occurences of a specific query inside the current atom set."),reduce:Ut(Dt.Dictionary({initial:vt(De.Variable("a",De.AnyValue,!0),{description:"Initial value assigned to slot.atom-set-reduce. Current atom is set to the 1st atom of the current set for this."}),value:vt(De.Variable("a",De.AnyValue,!0),{description:"Expression executed for each atom in the set"})}),De.Variable("a",De.AnyValue,!0),"Execute the value expression for each atom in the current atom set and return the result. Works the same way as Array.reduce in JavaScript (``result = value(value(...value(initial)))``)"),propertySet:Ut(Dt.Dictionary({0:vt(xr.ConstrainedVar)}),xr.Set(xr.ConstrainedVar),"Returns a set with all values of the given property in the current atom set.")},ZZ={"@header":"Atom Properties",core:{"@header":"Core Properties",elementSymbol:yr(Pt.ElementSymbol),vdw:yr(De.Num,"Van der Waals radius"),mass:yr(De.Num,"Atomic weight"),atomicNumber:yr(De.Num,"Atomic number"),x:yr(De.Num,"Cartesian X coordinate"),y:yr(De.Num,"Cartesian Y coordinate"),z:yr(De.Num,"Cartesian Z coordinate"),atomKey:yr(De.AnyValue,"Unique value for each atom. Main use case is grouping of atoms."),bondCount:Ut(Dt.Dictionary({0:vt(Pt.ElementReference,{isOptional:!0,defaultValue:"slot.current-atom"}),flags:vt(Pt.BondFlags,{isOptional:!0,defaultValue:"covalent"})}),De.Num,"Number of bonds (by default only covalent bonds are counted)."),sourceIndex:yr(De.Num,"Index of the atom/element in the input file."),operatorName:yr(De.Str,"Name of the symmetry operator applied to this element."),modelIndex:yr(De.Num,"Index of the model in the input file."),modelLabel:yr(De.Str,"Label/header of the model in the input file.")},topology:{connectedComponentKey:yr(De.AnyValue,"Unique value for each connected component.")},macromolecular:{"@header":"Macromolecular Properties (derived from the mmCIF format)",authResidueId:yr(Pt.ResidueId,"type.auth-residue-id symbol executed on current atom's residue"),labelResidueId:yr(Pt.ResidueId,"type.label-residue-id symbol executed on current atom's residue"),residueKey:yr(De.AnyValue,"Unique value for each tuple ``(label_entity_id,auth_asym_id, auth_seq_id, pdbx_PDB_ins_code)``, main use case is grouping of atoms"),chainKey:yr(De.AnyValue,"Unique value for each tuple ``(label_entity_id, auth_asym_id)``, main use case is grouping of atoms"),entityKey:yr(De.AnyValue,"Unique value for each tuple ``label_entity_id``, main use case is grouping of atoms"),isHet:yr(De.Bool,"Equivalent to atom_site.group_PDB !== ATOM"),id:yr(De.Num,"_atom_site.id"),label_atom_id:yr(Pt.AtomName),label_alt_id:yr(De.Str),label_comp_id:yr(De.Str),label_asym_id:yr(De.Str),label_entity_id:yr(De.Str),label_seq_id:yr(De.Num),auth_atom_id:yr(Pt.AtomName),auth_comp_id:yr(De.Str),auth_asym_id:yr(De.Str),auth_seq_id:yr(De.Num),pdbx_PDB_ins_code:yr(De.Str),pdbx_formal_charge:yr(De.Num),occupancy:yr(De.Num),B_iso_or_equiv:yr(De.Num),entityType:yr(Pt.EntityType,"Type of the entity as defined in mmCIF (polymer, non-polymer, branched, water)"),entitySubtype:yr(Pt.EntitySubtype,"Subtype of the entity as defined in mmCIF _entity_poly.type and _pdbx_entity_branch.type (other, polypeptide(D), polypeptide(L), polydeoxyribonucleotide, polyribonucleotide, polydeoxyribonucleotide/polyribonucleotide hybrid, cyclic-pseudo-peptide, peptide nucleic acid, oligosaccharide)"),entityPrdId:yr(De.Str,"The PRD ID of the entity."),entityDescription:yr(xr.List(De.Str)),objectPrimitive:yr(Pt.ObjectPrimitive,"Type of the primitive object used to model this segment as defined in mmCIF/IHM (atomistic, sphere, gaussian, other)"),secondaryStructureKey:yr(De.AnyValue,"Unique value for each secondary structure element."),secondaryStructureFlags:yr(Pt.SecondaryStructureFlags),isModified:yr(De.Bool,"True if the atom belongs to modification of a standard residue."),modifiedParentName:yr(De.Str,"'3-letter' code of the modifed parent residue."),isNonStandard:yr(De.Bool,"True if this is a non-standard residue."),chemCompType:yr(De.Str,"Type of the chemical component as defined in mmCIF.")}},JZ={"@header":"Bond Properties",flags:eh(Pt.BondFlags),order:eh(De.Num),length:eh(De.Num),atomA:eh(Pt.ElementReference),atomB:eh(Pt.ElementReference)};function yr(e,t){return Ut(Dt.Dictionary({0:vt(Pt.ElementReference,{isOptional:!0,defaultValue:"slot.current-atom"})}),e,t)}function eh(e,t){return Ut(Dt.None,e,t)}var eJ={"@header":"Structure Queries",type:jZ,slot:WZ,generator:XZ,modifier:YZ,filter:KZ,combinator:$Z,atomSet:QZ,atomProperty:ZZ,bondProperty:JZ},tJ={"@header":"Generators",bundleElement:Ut(Dt.Dictionary({groupedUnits:vt(De.Any),set:vt(De.Any),ranges:vt(De.Any)}),De.Any),bundle:Ut(Dt.Dictionary({elements:vt(De.Any)}),Pt.ElementSelectionQuery,"A selection with single structure containing represented by the bundle."),current:Ut(Dt.None,Pt.ElementSelectionQuery,"Current selection provided by the query context. Avoid using this in State Transforms.")},rJ={"@header":"Internal Queries",generator:tJ},Ce={core:s3,structureQuery:eJ,internal:rJ};H6(Ce);var nJ=G6(Ce);(function(){for(var e=Object.create(null),t=0,r=nJ;t<r.length;t++){var n=r[t];e[n.id]=n}return e})();var se;(function(e){e.core=Ce.core,e.struct=Ce.structureQuery,e.internal=Ce.internal;function t(y){return e.struct.type.atomName([y])}e.atomName=t;function r(y){return e.struct.type.elementSymbol([y])}e.es=r;function n(){for(var y=[],b=0;b<arguments.length;b++)y[b]=arguments[b];return e.core.type.list(y)}e.list=n;function a(){for(var y=[],b=0;b<arguments.length;b++)y[b]=arguments[b];return e.core.type.set(y)}e.set=a;function i(y,b){return e.core.type.regex([y,b])}e.re=i;function o(y){return e.core.ctrl.fn([y])}e.fn=o;function s(y){return e.core.ctrl.eval([y])}e.evaluate=s;var u=e.struct.atomProperty.core,l=e.struct.atomProperty.macromolecular,c=e.struct.atomProperty.topology;function d(y){return u[y]()}e.acp=d;function f(y){return c[y]()}e.atp=f;function p(y){return l[y]()}e.ammp=p;var h=e.struct.atomSet.propertySet;function v(y){return h([d(y)])}e.acpSet=v;function m(y){return h([f(y)])}e.atpSet=m;function g(y){return h([p(y)])}e.ammpSet=g})(se||(se={}));var qu=function(){function e(){this.count=0,this.center=C(),this.radiusSq=0}return e.prototype.reset=function(){C.set(this.center,0,0,0),this.radiusSq=0,this.count=0},e.prototype.includeStep=function(t){C.add(this.center,this.center,t),this.count++},e.prototype.finishedIncludeStep=function(){this.count!==0&&C.scale(this.center,this.center,1/this.count)},e.prototype.radiusStep=function(t){var r=C.squaredDistance(t,this.center);r>this.radiusSq&&(this.radiusSq=r)},e.prototype.radiusSphereStep=function(t,r){var n=C.distance(t,this.center)+r,a=n*n;a>this.radiusSq&&(this.radiusSq=a)},e.prototype.getSphere=function(t){return t||(t=Ne()),C.copy(t.center,this.center),t.radius=Math.sqrt(this.radiusSq),t},e.prototype.getCount=function(){return this.count},e}();(function(e){var t=new e,r=C(),n=C();function a(s,u){var l=s.x,c=s.y,d=s.z;t.reset();for(var f=l.length,p=0;p<f;p++)C.set(r,l[p],c[p],d[p]),t.includeStep(r);t.finishedIncludeStep();for(var p=0;p<f;p++)C.set(r,l[p],c[p],d[p]),t.radiusStep(r);return C.copy(u.center,t.center),u.radius=Math.sqrt(t.radiusSq),u}e.fromArrays=a;function i(s,u,l){t.reset();for(var c=0;c<s;c++)u(c,r),t.includeStep(r);t.finishedIncludeStep();for(var c=0;c<s;c++)u(c,r),t.radiusStep(r);return C.copy(l.center,t.center),l.radius=Math.sqrt(t.radiusSq),l}e.fromProvider=i;function o(s,u,l){t.reset();for(var c=0;c<s;c++)u(c,r,n),t.includeStep(r),t.includeStep(n);t.finishedIncludeStep();for(var c=0;c<s;c++)u(c,r,n),t.radiusStep(r),t.radiusStep(n);return C.copy(l.center,t.center),l.radius=Math.sqrt(t.radiusSq),l}e.fromPairProvider=o})(qu||(qu={}));var Od=function(){function e(t){this.map=t;var r=0,n=[],a=new Map,i=new Map;this.map.forEach(function(o){o.forEach(function(s){r+=s.edgeCount,s.connectedIndices.forEach(function(u){s.getEdges(u).forEach(function(l){var c=s.unitA,d=s.unitB,f=e.getEdgeKey(u,c,l.indexB,d);a.set(f,n.length);var p=e.getVertexKey(u,c),h=i.get(p);h===void 0?i.set(p,[n.length]):h.push(n.length),n.push(w(w({},l),{indexA:u,unitA:c,unitB:d}))})})})}),this.edgeCount=r,this.edges=n,this.edgeKeyIndex=a,this.vertexKeyIndex=i}return e.prototype.getConnectedUnits=function(t){return this.map.has(t)?this.map.get(t):W6},e.prototype.getEdgeIndex=function(t,r,n,a){var i=e.getEdgeKey(t,r,n,a),o=this.edgeKeyIndex.get(i);return o!==void 0?o:-1},e.prototype.hasEdge=function(t,r,n,a){return this.getEdgeIndex(t,r,n,a)!==-1},e.prototype.getEdge=function(t,r,n,a){var i=this.getEdgeIndex(t,r,n,a);return i!==-1?this.edges[i]:void 0},e.prototype.getEdgeIndices=function(t,r){return this.vertexKeyIndex.get(e.getVertexKey(t,r))||[]},e}();(function(e){var t=function(){function o(s,u,l,c,d){this.unitA=s,this.unitB=u,this.edgeCount=l,this.connectedIndices=c,this.edgeMap=d}return o.prototype.hasEdges=function(s){return this.edgeMap.has(s)},o.prototype.getEdges=function(s){return this.edgeMap.has(s)?this.edgeMap.get(s):W6},Object.defineProperty(o.prototype,"areUnitsOrdered",{get:function(){return this.unitA<this.unitB},enumerable:!1,configurable:!0}),o}();e.UnitPairEdges=t;function r(o,s,u,l){return o+"|"+s+"|"+u+"|"+l}e.getEdgeKey=r;function n(o,s){return o+"|"+s}e.getVertexKey=n;function a(o,s,u){o.has(s)?o.get(s).push(u):o.set(s,[u])}var i=function(){function o(){this.map=new Map}return o.prototype.startUnitPair=function(s,u){this.uA=s,this.uB=u,this.mapAB=new Map,this.mapBA=new Map,this.linkedA=$r.create(),this.linkedB=$r.create(),this.linkCount=0},o.prototype.finishUnitPair=function(){this.linkCount!==0&&(a(this.map,this.uA,new t(this.uA,this.uB,this.linkCount,this.linkedA.array,this.mapAB)),a(this.map,this.uB,new t(this.uB,this.uA,this.linkCount,this.linkedB.array,this.mapBA)))},o.prototype.add=function(s,u,l){a(this.mapAB,s,{indexB:u,props:l}),a(this.mapBA,u,{indexB:s,props:l}),$r.add(this.linkedA,s,s),$r.add(this.linkedB,u,u),this.linkCount+=1},o.prototype.getMap=function(){return this.map},o}();e.Builder=i})(Od||(Od={}));var W6=[],Rx;(function(e){e.Empty=Ti.create([],[],[],0,{flags:[],order:[]})})(Rx||(Rx={}));var qh=function(e){Be(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getBondFromLocation=function(r){return ze.isAtomic(r.aUnit)&&ze.isAtomic(r.bUnit)?this.getEdge(r.aIndex,r.aUnit.id,r.bIndex,r.bUnit.id):void 0},t.prototype.getBondIndexFromLocation=function(r){return ze.isAtomic(r.aUnit)&&ze.isAtomic(r.bUnit)?this.getEdgeIndex(r.aIndex,r.aUnit.id,r.bIndex,r.bUnit.id):-1},t}(Od);(function(e){var t=function(r){Be(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n}(Od.UnitPairEdges);e.UnitPairBonds=t})(qh||(qh={}));var X6={forceCompute:!1,noCompute:!1},u3={H:0,h:0,D:0,d:0,T:0,t:0,He:2,HE:2,he:2,Li:3,LI:3,li:3,Be:4,BE:4,be:4,B:5,b:5,C:6,c:6,N:7,n:7,O:8,o:8,F:9,f:9,Ne:10,NE:10,ne:10,Na:11,NA:11,na:11,Mg:12,MG:12,mg:12,Al:13,AL:13,al:13,Si:14,SI:14,si:14,P:15,p:15,S:16,s:16,Cl:17,CL:17,cl:17,Ar:18,AR:18,ar:18,K:19,k:19,Ca:20,CA:20,ca:20,Sc:21,SC:21,sc:21,Ti:22,TI:22,ti:22,V:23,v:23,Cr:24,CR:24,cr:24,Mn:25,MN:25,mn:25,Fe:26,FE:26,fe:26,Co:27,CO:27,co:27,Ni:28,NI:28,ni:28,Cu:29,CU:29,cu:29,Zn:30,ZN:30,zn:30,Ga:31,GA:31,ga:31,Ge:32,GE:32,ge:32,As:33,AS:33,as:33,Se:34,SE:34,se:34,Br:35,BR:35,br:35,Kr:36,KR:36,kr:36,Rb:37,RB:37,rb:37,Sr:38,SR:38,sr:38,Y:39,y:39,Zr:40,ZR:40,zr:40,Nb:41,NB:41,nb:41,Mo:42,MO:42,mo:42,Tc:43,TC:43,tc:43,Ru:44,RU:44,ru:44,Rh:45,RH:45,rh:45,Pd:46,PD:46,pd:46,Ag:47,AG:47,ag:47,Cd:48,CD:48,cd:48,In:49,IN:49,in:49,Sn:50,SN:50,sn:50,Sb:51,SB:51,sb:51,Te:52,TE:52,te:52,I:53,i:53,Xe:54,XE:54,xe:54,Cs:55,CS:55,cs:55,Ba:56,BA:56,ba:56,La:57,LA:57,la:57,Ce:58,CE:58,ce:58,Pr:59,PR:59,pr:59,Nd:60,ND:60,nd:60,Pm:61,PM:61,pm:61,Sm:62,SM:62,sm:62,Eu:63,EU:63,eu:63,Gd:64,GD:64,gd:64,Tb:65,TB:65,tb:65,Dy:66,DY:66,dy:66,Ho:67,HO:67,ho:67,Er:68,ER:68,er:68,Tm:69,TM:69,tm:69,Yb:70,YB:70,yb:70,Lu:71,LU:71,lu:71,Hf:72,HF:72,hf:72,Ta:73,TA:73,ta:73,W:74,w:74,Re:75,RE:75,re:75,Os:76,OS:76,os:76,Ir:77,IR:77,ir:77,Pt:78,PT:78,pt:78,Au:79,AU:79,au:79,Hg:80,HG:80,hg:80,Tl:81,TL:81,tl:81,Pb:82,PB:82,pb:82,Bi:83,BI:83,bi:83,Po:84,PO:84,po:84,At:85,AT:85,at:85,Rn:86,RN:86,rn:86,Fr:87,FR:87,fr:87,Ra:88,RA:88,ra:88,Ac:89,AC:89,ac:89,Th:90,TH:90,th:90,Pa:91,PA:91,pa:91,U:92,u:92,Np:93,NP:93,np:93,Pu:94,PU:94,pu:94,Am:95,AM:95,am:95,Cm:96,CM:96,cm:96,Bk:97,BK:97,bk:97,Cf:98,CF:98,cf:98,Es:99,ES:99,es:99,Fm:100,FM:100,fm:100,Md:101,MD:101,md:101,No:102,NO:102,no:102,Lr:103,LR:103,lr:103,Rf:104,RF:104,rf:104,Db:105,DB:105,db:105,Sg:106,SG:106,sg:106,Bh:107,BH:107,bh:107,Hs:108,HS:108,hs:108,Mt:109,MT:109,mt:109},aJ={0:1.42,1:1.42,3:2.7,4:2.7,6:1.75,7:1.6,8:1.52,11:2.7,12:2.7,13:2.7,14:1.9,15:2,16:1.9,17:1.8,19:2.7,20:2.7,21:2.7,22:2.7,23:2.7,24:2.7,25:2.7,26:2.7,27:2.7,28:2.7,29:2.7,30:2.7,31:2.7,33:2.68,37:2.7,38:2.7,39:2.7,40:2.7,41:2.7,42:2.7,43:2.7,44:2.7,45:2.7,46:2.7,47:2.7,48:2.7,49:2.7,50:2.7,55:2.7,56:2.7,57:2.7,58:2.7,59:2.7,60:2.7,61:2.7,62:2.7,63:2.7,64:2.7,65:2.7,66:2.7,67:2.7,68:2.7,69:2.7,70:2.7,71:2.7,72:2.7,73:2.7,74:2.7,75:2.7,76:2.7,77:2.7,78:2.7,79:2.7,80:2.7,81:2.7,82:2.7,83:2.7,87:2.7,88:2.7,89:2.7,90:2.7,91:2.7,92:2.7,93:2.7,94:2.7,95:2.7,96:2.7,97:2.7,98:2.7,99:2.7,100:2.7,101:2.7,102:2.7,103:2.7,104:2.7,105:2.7,106:2.7,107:2.7,108:2.7,109:2.88},iJ={0:.8,20:1.31,27:1.2,35:1.15,44:1.1,54:1,60:1.84,72:1.88,84:1.75,85:1.56,86:1.76,98:1.6,99:1.68,100:1.63,112:1.6,113:1.59,114:1.36,129:1.45,135:1.47,144:1.6,152:1.45,170:1.4,180:1.55,202:2.4,222:2.24,224:1.91,225:1.98,243:2.02,269:2,293:1.9,316:1.8,420:2.37,480:2.3,512:2.3,544:2.3,612:2.1,629:1.54,665:1,813:2.6,854:2.27,894:1.93,896:2.1,937:2.05,938:2.06,981:1.62,1258:2.68,1309:2.33,1484:1,1763:2.14,1823:2.48,1882:2.1,1944:1.72,2380:2.34,3367:2.44,3733:2.11,3819:2.6,3821:2.36,4736:2.75,5724:2.73,5959:2.63,6519:2.84,6750:2.87,8991:2.81},UP=2.001,yv=function(){for(var e=["LI","NA","K","RB","CS","FR","BE","MG","CA","SR","BA","RA","AL","GA","IN","SN","TL","PB","BI","SC","TI","V","CR","MN","FE","CO","NI","CU","ZN","Y","ZR","NB","MO","TC","RU","RH","PD","AG","CD","LA","HF","TA","W","RE","OS","IR","PT","AU","HG","AC","RF","DB","SG","BH","HS","MT","CE","PR","ND","PM","SM","EU","GD","TB","DY","HO","ER","TM","YB","LU","TH","PA","U","NP","PU","AM","CM","BK","CF","ES","FM","MD","NO","LR"],t=new Set,r=0,n=e;r<n.length;r++){var a=n[r];t.add(u3[a])}return t}();function oJ(e,t){return e<t?(e+t)*(e+t+1)/2+t:(e+t)*(e+t+1)/2+e}function pp(e){var t=u3[e];return t===void 0?-1:t}function Y6(e,t){if(e<0||t<0)return-1;var r=iJ[oJ(e,t)];return r===void 0?-1:r}function gg(e){if(e<0)return UP;var t=aJ[e];return t===void 0?UP:t}var sJ=u3.H;function bv(e){return e===sJ}function K6(e,t,r,n,a,i){for(var o=new Ti.EdgeBuilder(a,e,t),s=new Uint16Array(o.slotCount),u=new Int8Array(o.slotCount),l=0,c=o.edgeCount;l<c;l++)o.addNextEdge(),o.assignProperty(s,n[l]),o.assignProperty(u,r[l]);return o.createGraph({flags:s,order:u},{canRemap:i})}var zP=C(),VP=C();function uJ(e,t,r){return e.conformation.position(t,zP),e.conformation.position(r,VP),C.distance(zP,VP)}var lJ=new Set;function cJ(e){for(var t=Ba.Provider.get(e.model),r=e.elements,n=e.model.atomicHierarchy.atoms.type_symbol,a=e.elements.length,i=t.edgeProps,o=e.model.atomicHierarchy.atomSourceIndex,s=jt.getInvertedAtomSourceIndex(e.model).invertedIndex,u=[],l=[],c=[],d=[],f=0;f<a;f++)for(var p=r[f],h=n.value(p)==="H",v=o.value(p),m=t.offset[v],g=t.offset[v+1];m<g;++m){var y=s[t.b[m]];if(!(p>=y)){var b=Je.indexOf(e.elements,y);if(!(b<0)&&!(h&&n.value(y)==="H")){var x=i.distance[m];(x===-1||x===void 0||cn(uJ(e,p,y),x,.5))&&(u[u.length]=f,l[l.length]=b,d[d.length]=i.order[m],c[c.length]=i.flag[m])}}}return K6(u,l,d,c,a,!1)}function dJ(e,t){for(var r=4,n=e.model.atomicConformation,a=n.x,i=n.y,o=n.z,s=e.elements.length,u=e.elements,l=e.residueIndex,c=e.chainIndex,d=e.model.atomicHierarchy.atoms,f=d.type_symbol,p=d.label_atom_id,h=d.label_alt_id,v=d.label_comp_id,m=e.model.atomicHierarchy.residues.label_seq_id,g=e.model.atomicHierarchy.index,y=e.model.sequence.byEntityKey,b=e.lookup3d,x=Ws.Provider.get(e.model),S=gv.Provider.get(e.model),_=Ws.isExhaustive(e.model),A=[],T=[],I=[],M=[],O=-1,D=void 0,F=!0,G=!0,N=!0,z=lJ,$=0;$<s;$++){var j=u[$],Z=f.value(j);F&&(Z!=="H"||Z!=="O")&&(F=!1);var q=t.forceCompute?void 0:x&&x.byAtomIndex.get(j),te=!1;if(q)for(var he=0,W=q;he<W.length;he++){var K=W[he],U=K.partnerA,H=K.partnerB;if(U.symmetry===H.symmetry){var J=U.atomIndex===j?H:U,X=Je.indexOf(e.elements,J.atomIndex);X<0||(A[A.length]=$,T[T.length]=X,I[I.length]=K.flags,M[M.length]=K.order,te||z.clear(),te=!0,z.add(X))}}if(!_){var Q=l[j],ee=m.value(Q),le=v.value(j);if(!t.forceCompute&&Q!==O)if(!!S&&S.entries.has(le)){var ye=y[g.getEntityFromChain(c[j])];ye&&ye.sequence.microHet.has(ee)?D=void 0:D=S.entries.get(le).map}else D=void 0;O=Q;for(var be=pp(Z),Ae=p.value(j),xe=D?D.get(Ae):void 0,ae=b.find(a[j],i[j],o[j],r),oe=ae.indices,R=ae.count,V=ae.squaredDistances,pe=bv(be),_e=gg(be),Ee=h.value(j),Ve=yv.has(be),He=0;He<R;He++){var X=oe[He];if(!(te&&z.has(X))){var Ye=u[X];if(!(Ye<=j)){var lt=h.value(Ye);if(!(Ee&&lt&&Ee!==lt)){var Le=pp(f.value(Ye)),Qe=bv(Le);if(!(pe&&Qe)){var at=(Ve||yv.has(Le))&&!(pe||Qe),ot=l[Ye];if(Q===ot&&xe){var dt=xe.get(p.value(Ye));if(dt){A[A.length]=$,T[T.length]=X,M[M.length]=dt.order;var Oe=dt.flags;at&&(Oe|1&&(Oe^=1),Oe|=2),I[I.length]=Oe}continue}var Me=Math.sqrt(V[He]);if(Me!==0){var Ke=Y6(be,Le),tt=Ke>0?Ke:Le<0?_e:(_e+gg(Le))/1.95;if(Me<=tt){A[A.length]=$,T[T.length]=X,M[M.length]=TZ(le,Ae,p.value(Ye)),I[I.length]=(at?2:1)|32;var St=m.value(ot);ee===St&&(G=!1),Math.abs(ee-St)>1&&(N=!1)}}}}}}}}}var ht=F||G&&N;return K6(A,T,M,I,s,ht)}function fJ(e,t){var r=w(w({},X6),t);return r.noCompute||jt.isCoarseGrained(e.model)?Rx.Empty:!r.forceCompute&&Ba.Provider.get(e.model)?cJ(e):dJ(e,r)}var Ph=4,HP=C(),GP=C();function qP(e,t,r,n){return e.conformation.position(t,HP),r.conformation.position(n,GP),C.distance(HP,GP)}var pJ=ue(),kc=C();function hJ(e,t,r,n){var a=e.elements,i=e.residueIndex,o=e.model.atomicConformation,s=o.x,u=o.y,l=o.z,c=t.elements,d=t.residueIndex,f=e.elements.length,p=e.model.atomicHierarchy.atoms,h=p.type_symbol,v=p.label_alt_id,m=p.label_atom_id,g=p.label_comp_id,y=t.model.atomicHierarchy.atoms,b=y.type_symbol,x=y.label_alt_id,S=y.label_atom_id,_=y.label_comp_id,A=e.model.atomicHierarchy.residues.auth_seq_id,T=t.model.atomicHierarchy.residues.auth_seq_id,I=e.model.atomicConformation.occupancy,M=t.model.atomicConformation.occupancy,O=I.isDefined&&M.isDefined,D=e.model===t.model&&Ws.Provider.get(e.model),F=!r.forceCompute&&e.model===t.model&&Ba.Provider.get(e.model),G=e.model.atomicHierarchy.atomSourceIndex,N=(F?jt.getInvertedAtomSourceIndex(t.model):{invertedIndex:void 0}).invertedIndex,z=e.model===t.model&&Ws.isExhaustive(e.model),$=ue.mul(pJ,t.conformation.operator.inverse,e.conformation.operator.matrix),j=!ue.isIdentity($),Z=t.boundary.sphere,q=Z.center,te=Z.radius,he=(te+Ph)*(te+Ph);n.startUnitPair(e.id,t.id);for(var W=0;W<f;W++){var K=a[W];if(C.set(kc,s[K],u[K],l[K]),j&&C.transformMat4(kc,kc,$),!(C.squaredDistance(kc,q)>he)){if(!r.forceCompute&&F){for(var U=F.edgeProps,H=U.order,J=U.distance,X=U.flag,Q=G.value(K),ee=F.offset[Q],le=F.offset[Q+1];ee<le;++ee){var ye=N[F.b[ee]],be=Je.indexOf(t.elements,ye);if(!(be<0)&&!(h.value(K)==="H"&&b.value(ye)==="H")){var Ae=J[ee];Ae!==-1&&cn(qP(e,K,t,ye),Ae,.5)&&n.add(W,be,{order:H[ee],flag:X[ee]})}}continue}var xe=r.forceCompute?void 0:D&&D.byAtomIndex.get(K);if(xe&&xe.length){for(var ae=!1,oe=0,R=xe;oe<R.length;oe++){var V=R[oe],pe=V.partnerA,_e=V.partnerB,Ee=pe.atomIndex===K?_e:pe,be=Je.indexOf(t.elements,Ee.atomIndex);be<0||qP(e,K,t,Ee.atomIndex)>Ph||(n.add(W,be,{order:V.order,flag:V.flags}),ae=!0)}if(ae)continue}if(!z){var Ve=I.value(K),He=t.lookup3d,Ye=He.find(kc[0],kc[1],kc[2],Ph),lt=Ye.indices,Le=Ye.count,Qe=Ye.squaredDistances;if(Le!==0)for(var at=pp(h.value(K)),ot=bv(at),dt=gg(at),Oe=v.value(K),Me=yv.has(at),Ke=m.value(K),tt=g.value(i[K]),St=0;St<Le;St++){var be=lt[St],ye=c[be],ht=x.value(ye);if(!(Oe&&ht&&Oe!==ht)&&!(O&&M.value(ye)<1&&Ve<1&&A.value(K)===T.value(ye))){var ut=pp(b.value(ye)),fe=bv(ut);if(!(ot&&fe)){var me=(Me||yv.has(ut))&&!(ot||fe),we=Math.sqrt(Qe[St]);if(we!==0){var $e=Y6(at,ut),gt=$e>0?$e:ut<0?dt:(dt+gg(ut))/1.95;if(we<=gt){var Tt=S.value(ye),Wt=_.value(d[ye]);n.add(W,be,{order:z6(tt,Wt,Ke,Tt),flag:(me?2:1)|32})}}}}}}}}n.finishUnitPair()}function vJ(e,t){var r=new Od.Builder;if(t.noCompute||e.isCoarseGrained)return new qh(r.getMap());var n=e.models.length===1&&Ba.Provider.get(e.model);if(n){for(var a=n.edgeProps.distance,i=!1,o=0,s=a.length;o<s;++o)if(a[o]!==-1){i=!0;break}if(!i)return new qh(r.getMap())}return Xe.eachUnitPair(e,function(u,l){hJ(u,l,t,r)},{maxRadius:Ph,validUnit:function(u){return ze.isAtomic(u)},validUnitPair:function(u,l){return t.validUnitPair(e,u,l)}}),new qh(r.getMap())}function mJ(e,t){return vJ(e,w(w({},X6),{validUnitPair:t&&t.validUnitPair||function(r,n,a){var i=n.model.atomicHierarchy.derived.residue.moleculeType,o=a.model.atomicHierarchy.derived.residue.moleculeType,s=(!ze.isAtomic(n)||i[n.residueIndex[n.elements[0]]]!==2)&&(!ze.isAtomic(a)||o[a.residueIndex[a.elements[0]]]!==2);return Xe.validUnitPair(r,n,a)&&s}}))}var Ht;(function(e){function t(v,m,g,y,b,x){return{kind:"bond-location",aStructure:v,aUnit:m,aIndex:g,bStructure:y,bUnit:b,bIndex:x}}e.Location=t;function r(v){return!!v&&v.kind==="bond-location"}e.isLocation=r;function n(v,m){return v.aStructure.label===m.aStructure.label&&v.bStructure.label===m.bStructure.label&&v.aIndex===m.aIndex&&v.bIndex===m.bIndex&&v.aUnit.id===m.aUnit.id&&v.bUnit.id===m.bUnit.id}e.areLocationsEqual=n;function a(v,m){return{kind:"bond-loci",structure:v,bonds:m}}e.Loci=a;function i(v){return!!v&&v.kind==="bond-loci"}e.isLoci=i;function o(v,m){if(v.structure!==m.structure||v.bonds.length!==m.bonds.length)return!1;for(var g=0,y=v.bonds.length;g<y;++g)if(!n(v.bonds[g],m.bonds[g]))return!1;return!0}e.areLociEqual=o;function s(v){return v.bonds.length===0}e.isLociEmpty=s;function u(v,m){if(m===v.structure)return v;var g=[];return v.bonds.forEach(function(y){var b=m.unitMap.get(y.aUnit.id);if(!!b){var x=m.unitMap.get(y.bUnit.id);if(!!x){var S=y.aUnit.elements[y.aIndex],_=Je.indexOf(b.elements,S);if(_!==-1){var A=y.bUnit.elements[y.bIndex],T=Je.indexOf(x.elements,A);T!==-1&&g.push(t(v.structure,b,_,v.structure,x,T))}}}}),a(m,g)}e.remapLoci=u;function l(v){for(var m=[],g=new Map,y=0,b=v.bonds;y<b.length;y++){var x=b[y],S=x.aIndex,_=x.aUnit,A=x.bIndex,T=x.bUnit;_===T?g.has(_.id)?g.get(_.id).push(S,A):g.set(_.id,[S,A]):(g.has(_.id)?g.get(_.id).push(S):g.set(_.id,[S]),g.has(T.id)?g.get(T.id).push(A):g.set(T.id,[A]))}return g.forEach(function(I,M){m.push({unit:v.structure.unitMap.get(M),indices:Je.deduplicate(Je.ofUnsortedArray(I))})}),Re(v.structure,m)}e.toStructureElementLoci=l;function c(v,m){if(m.aUnit===m.bUnit){var g=m.aUnit.bonds,y=g.getEdgeIndex(m.aIndex,m.bIndex);return y<0?kr.create(0):kr.create(g.edgeProps.flags[y])}else{var b=v.interUnitBonds.getBondFromLocation(m);return b?kr.create(b.props.flag):kr.create(0)}}e.getType=c;function d(v,m){if(m.aUnit===m.bUnit){var g=m.aUnit.bonds,y=g.getEdgeIndex(m.aIndex,m.bIndex);return y<0?0:g.edgeProps.order[y]}else{var b=v.interUnitBonds.getBondFromLocation(m);return b?b.props.order:0}}e.getOrder=d;function f(v){for(var m=0,g=0,y=v.units.length;g<y;++g){var b=v.units[g];ze.isAtomic(b)&&(m+=b.bonds.edgeCount)}return m}e.getIntraUnitBondCount=f;var p=function(){function v(){this.current={},this.hasNext=!1}return v.prototype.move=function(){return this.advance(),this.current},v.prototype.setElement=function(m,g,y){this.structure=m,this.unit=g,this.index=y,this.interBondIndices=m.interUnitBonds.getEdgeIndices(y,g.id),this.interBondCount=this.interBondIndices.length,this.interBondIndex=0,this.intraBondEnd=g.bonds.offset[y+1],this.intraBondIndex=g.bonds.offset[y],this.hasNext=this.interBondIndex<this.interBondCount||this.intraBondIndex<this.intraBondEnd},v.prototype.advance=function(){if(this.intraBondIndex<this.intraBondEnd)this.current.otherUnit=this.unit,this.current.otherIndex=this.unit.bonds.b[this.intraBondIndex],this.current.type=this.unit.bonds.edgeProps.flags[this.intraBondIndex],this.current.order=this.unit.bonds.edgeProps.order[this.intraBondIndex],this.intraBondIndex+=1;else if(this.interBondIndex<this.interBondCount){var m=this.structure.interUnitBonds.edges[this.interBondIndex];this.current.otherUnit=this.structure.unitMap.get(m.unitA!==this.unit.id?m.unitA:m.unitB),this.current.otherIndex=m.indexA!==this.index?m.indexA:m.indexB,this.current.type=m.props.flag,this.current.order=m.props.order,this.interBondIndex+=1}else{this.hasNext=!1;return}this.hasNext=this.interBondIndex<this.interBondCount||this.intraBondIndex<this.intraBondEnd},v}();e.ElementBondIterator=p;function h(v,m){return qu.fromPairProvider(v.bonds.length,function(g,y,b){var x=v.bonds[g],S=x.aUnit,_=x.aIndex,A=x.bUnit,T=x.bIndex;S.conformation.position(S.elements[_],y),A.conformation.position(A.elements[T],b)},m)}e.getBoundingSphere=h})(Ht||(Ht={}));function gJ(e){for(var t=bJ(e),r=yJ(e,t),n=nr.transientSegments(e.model.atomicHierarchy.residueAtomSegments,e.elements);n.hasNext;){var a=n.move();SJ(r,a.start,a.end)}return r.rings}function yJ(e,t){return{startVertex:0,endVertex:0,count:0,visited:new Int32Array(t),queue:new Int32Array(t),pred:new Int32Array(t),left:new Int32Array(4),right:new Int32Array(4),color:new Int32Array(t),currentColor:0,currentAltLoc:"",hasAltLoc:!1,rings:[],currentRings:[],unit:e,bonds:e.bonds,altLoc:e.model.atomicHierarchy.atoms.label_alt_id}}function jP(e){e.count=e.endVertex-e.startVertex;for(var t=e.visited,r=e.pred,n=e.color,a=0;a<e.count;a++)t[a]=-1,r[a]=-1,n[a]=0;e.currentColor=0,e.currentAltLoc="",e.hasAltLoc=!1}function bJ(e){for(var t=nr.transientSegments(e.model.atomicHierarchy.residueAtomSegments,e.elements),r=0;t.hasNext;){var n=t.move();r=Math.max(r,n.end-n.start)}return r}function SJ(e,t,r){var n=e.visited;if(e.startVertex=t,e.endVertex=r,!(e.endVertex-e.startVertex<3)){e.currentRings=[];for(var a=e.unit.elements,i=[],o=e.startVertex;o<e.endVertex;o++){var s=e.altLoc.value(a[o]);Xa(i,s)}if(yd(i,""),i.length===0){jP(e);for(var o=0;o<e.count;o++)n[o]>=0||WP(e,o)}else for(var u=0;u<i.length;u++){jP(e),e.hasAltLoc=!0,e.currentAltLoc=i[u];for(var o=0;o<e.count;o++)if(!(n[o]>=0)){var s=e.altLoc.value(a[e.startVertex+o]);s&&s!==e.currentAltLoc||WP(e,o)}}for(var o=0,l=e.currentRings.length;o<l;o++)e.rings.push(e.currentRings[o])}}function xJ(e,t,r){if(!(r<t)){for(var n=e.pred,a=e.color,i=e.left,o=e.right,s=++e.currentColor,u=t,l=0;l<4&&(a[u]=s,u=n[u],!(u<0));l++);var c=0,d=0,f=!1,p=0;u=r;for(var l=0;l<4;l++){if(a[u]===s){p=u,f=!0;break}if(o[d++]=u,u=n[u],u<0)break}if(!!f){u=t;for(var l=0;l<4&&(i[c++]=u,!(p===u||(u=n[u],u<0)));l++);var h=c+d;if(!(h<3)){for(var v=new Int32Array(h),m=0,l=0;l<c;l++)v[m++]=e.startVertex+i[l];for(var l=d-1;l>=0;l--)v[m++]=e.startVertex+o[l];if(es(v),e.hasAltLoc)for(var g=0,y=e.currentRings.length;g<y;g++){var b=e.currentRings[g];if(v[0]===b[0]&&v.length===b.length){for(var x=!0,S=0,_=v.length;S<_;S++)if(v[S]!==b[S]){x=!1;break}if(x)return}}e.currentRings.push(Je.ofSortedArray(v))}}}}function WP(e,t){var r=e.bonds,n=e.startVertex,a=e.endVertex,i=e.visited,o=e.queue,s=e.pred,u=e.unit.elements,l=r.b,c=r.edgeProps.flags,d=r.offset;i[t]=1,o[0]=t;for(var f=0,p=1;f<p;)for(var h=o[f++],v=n+h,m=d[v],g=d[v+1],y=m;y<g;y++){var b=l[y];if(!(b<n||b>=a||!kr.isCovalent(c[y]))){if(e.hasAltLoc){var x=e.altLoc.value(u[b]);if(x&&e.currentAltLoc!==x)continue}var S=b-n;if(i[S]>0){s[S]!==h&&s[h]!==S&&xJ(e,h,S);continue}i[S]=1,o[p++]=S,s[S]=h}}}function CJ(e){for(var t=e.length,r=new Array(t),n=0;n<t;n++)r[n]=e[t-n-1];for(var a=XP(e),i=XP(r),o=!1,n=0;n<t;n++){var s=e[(n+a)%t],u=r[(n+i)%t];if(s!==u){o=s<u;break}}return o?YP(e,a):YP(r,i)}function XP(e){for(var t=e.length,r=new Int32Array(t*2),n=0;n<r.length;n++)r[n]=-1;for(var a="",i="",o=0,s=1;s<r.length;s++){for(var n=r[s-o-1];n!==-1&&(a=e[s%t],i=e[(o+n+1)%t],a!==i);)a<i&&(o=s-n-1),n=r[n];n===-1?(a=e[s%t],i=e[(o+n+1)%t],a!==i?(a<i&&(o=s),r[s-o]=-1):r[s-o]=n+1):r[s-o]=n+1}return o}function YP(e,t){var r=e.length,n=[],a;for(a=0;a<r-1;a++)n.push(e[(a+t)%r]),n.push("-");return n.push(e[(a+t)%r]),n.join("")}function _J(e,t){for(var r=new Map,n=new Map,a=0,i=e.length;a<i;a++)for(var o=e[a],s=0,u=o.length;s<u;s++){var l=o[s];r.has(l)?r.get(l).push(a):r.set(l,[a])}for(var c=0,d=t.length;c<d;c++)for(var a=t[c],o=e[a],s=0,u=o.length;s<u;s++){var l=o[s];n.has(l)?n.get(l).push(a):n.set(l,[a])}for(var f=new Ti.UniqueEdgeBuilder(e.length),a=0,i=e.length;a<i;a++)for(var o=e[a],s=0,u=o.length;s<u;s++){var l=o[s],p=r.get(l);if(p.length!==1)for(var h=0,v=p.length;h<v;h++){var m=p[h];a>=m||f.addEdge(a,m)}}for(var g=Ti.connectedComponents(f.getGraph()),y=g.componentIndex,b=[],s=0;s<g.componentCount;s++)b[s]=[];for(var a=0,i=e.length;a<i;a++)b[y[a]].push(a);return{elementRingIndices:r,elementAromaticRingIndices:n,ringComponentIndex:y,ringComponents:b}}var Ar;(function(e){function t(f,p,h){h===void 0&&(h=Float32Array);var v=f*p;return{data:new h(v),size:v,cols:f,rows:p}}e.create=t;function r(f,p,h){return f.data[f.rows*h+p]}e.get=r;function n(f,p,h,v){return f.data[f.rows*h+p]=v,f}e.set=n;function a(f,p,h,v){return f.data[f.rows*h+p]+=v,f}e.add=a;function i(f){return f.data.fill(0),f}e.makeZero=i;function o(f){return{data:f.data.slice(),size:f.size,cols:f.cols,rows:f.rows}}e.clone=o;function s(f,p,h){return{data:f,size:p*h,cols:p,rows:h}}e.fromArray=s;function u(f,p){if(f.cols!==p.rows||f.rows!==p.cols)throw new Error("transpose: matrix dimensions incompatible");if(f.data===p.data)throw new Error("transpose: matrices share memory");for(var h=p.rows,v=p.cols,m=p.data,g=f.data,y=0,b=0,x=0;y<h;x+=1,b+=v,++y)for(var S=x,_=0;_<v;S+=h,_++)g[S]=m[b+_];return f}e.transpose=u;function l(f,p,h){for(var v=p.cols,m=p.rows,g=h.rows,y=p.data,b=h.data,x=f.data,S=0,_=0,A=0;S<m;_+=v,S++)for(var T=0,I=0;I<g;A++,I++){for(var M=0,O=_,D=0;D<v;O++,T++,D++)M+=y[O]*b[T];x[A]=M}return f}e.multiplyABt=l;function c(f){for(var p=f.rows,h=f.cols,v=f.data,m=new Array(h),g=0;g<h;++g)m[g]=0;for(var y=0,b=0;y<p;++y)for(var g=0;g<h;++g,++b)m[g]+=v[b];for(var g=0;g<h;++g)m[g]/=p;return m}e.meanRows=c;function d(f,p){for(var h=f.rows,v=f.cols,m=f.data,g=0,y=0;g<h;++g)for(var b=0;b<v;++b,++y)m[y]-=p[b];return f}e.subRows=d})(Ar||(Ar={}));function Wb(e,t,r,n){n=e[t],e[t]=e[r],e[r]=n}function wJ(e,t){return e=Math.abs(e),t=Math.abs(t),e>t?(t/=e,e*Math.sqrt(1+t*t)):t>0?(e/=t,t*Math.sqrt(1+e*e)):0}var AJ=1192092896e-16,PJ=1e-37;function TJ(e,t,r,n,a,i,o,s){for(var u=AJ*2,l=PJ,c=0,d=0,f=0,p=0,h=Math.max(i,30),v=0,m=0,g=0,y=0,b=0,x=0,S=0,_=0,A=0,T=0,I=0,M=0,O=0,D=0,F=0,G=0,N=0,z=4660,$=0,j=0,Z=0,q=new Float64Array(o<<3);c<o;c++){for(f=0,I=0;f<i;f++)_=e[c*t+f],I+=_*_;if(q[c]=I,n){for(f=0;f<o;f++)n[c*a+f]=0;n[c*a+c]=1}}for(;p<h;p++){for(b=0,c=0;c<o-1;c++)for(d=c+1;d<o;d++){for(v=c*t|0,m=d*t|0,F=q[c],G=0,N=q[d],f=2,G+=e[v]*e[m],G+=e[v+1]*e[m+1];f<i;f++)G+=e[v+f]*e[m+f];if(!(Math.abs(G)<=u*Math.sqrt(F*N))){for(G*=2,M=F-N,O=wJ(G,M),M<0?(D=(O-M)*.5,S=Math.sqrt(D/O),x=G/(O*S*2)):(x=Math.sqrt((O+M)/(O*2)),S=G/(O*x*2)),F=0,N=0,f=2,A=x*e[v]+S*e[m],T=-S*e[v]+x*e[m],e[v]=A,e[m]=T,F+=A*A,N+=T*T,A=x*e[v+1]+S*e[m+1],T=-S*e[v+1]+x*e[m+1],e[v+1]=A,e[m+1]=T,F+=A*A,N+=T*T;f<i;f++)A=x*e[v+f]+S*e[m+f],T=-S*e[v+f]+x*e[m+f],e[v+f]=A,e[m+f]=T,F+=A*A,N+=T*T;if(q[c]=F,q[d]=N,b=1,n)for(g=c*a|0,y=d*a|0,f=2,A=x*n[g]+S*n[y],T=-S*n[g]+x*n[y],n[g]=A,n[y]=T,A=x*n[g+1]+S*n[y+1],T=-S*n[g+1]+x*n[y+1],n[g+1]=A,n[y+1]=T;f<o;f++)A=x*n[g+f]+S*n[y+f],T=-S*n[g+f]+x*n[y+f],n[g+f]=A,n[y+f]=T}}if(b===0)break}for(c=0;c<o;c++){for(f=0,I=0;f<i;f++)_=e[c*t+f],I+=_*_;q[c]=Math.sqrt(I)}for(c=0;c<o-1;c++){for(d=c,f=c+1;f<o;f++)q[d]<q[f]&&(d=f);if(c!==d&&(Wb(q,c,d,I),n)){for(f=0;f<i;f++)Wb(e,c*t+f,d*t+f,_);for(f=0;f<o;f++)Wb(n,c*a+f,d*a+f,_)}}for(c=0;c<o;c++)r[c]=q[c];if(!!n)for(c=0;c<s;c++){for(I=c<o?q[c]:0;I<=l;){for(j=1/i,f=0;f<i;f++)z=z*214013+2531011,$=(z>>16&32767&256)!==0?j:-j,e[c*t+f]=$;for(p=0;p<2;p++)for(d=0;d<c;d++){for(I=0,f=0;f<i;f++)I+=e[c*t+f]*e[d*t+f];for(Z=0,f=0;f<i;f++)_=e[c*t+f]-I*e[d*t+f],e[c*t+f]=_,Z+=Math.abs(_);for(Z=Z?1/Z:0,f=0;f<i;f++)e[c*t+f]*=Z}for(I=0,f=0;f<i;f++)_=e[c*t+f],I+=_*_;I=Math.sqrt(I)}for(S=1/I,f=0;f<i;f++)e[c*t+f]*=S}}function EJ(e,t,r,n){var a=0,i=0,o=e.rows,s=e.cols,u=o,l=s;u<l&&(a=1,i=u,u=l,l=i);var c=Ar.create(u,u),d=Ar.create(1,l),f=Ar.create(l,l);if(a===0)Ar.transpose(c,e);else{for(i=0;i<s*o;i++)c.data[i]=e.data[i];for(;i<l*u;i++)c.data[i]=0}if(TJ(c.data,u,d.data,f.data,l,u,l,u),t){for(i=0;i<l;i++)t.data[i]=d.data[i];for(;i<s;i++)t.data[i]=0}a===0?(r&&Ar.transpose(r,c),n&&Ar.transpose(n,f)):(r&&Ar.transpose(r,f),n&&Ar.transpose(n,c))}var Fd;(function(e){function t(u){var l=r(u),c=s(u,l);return{momentsAxes:l,boxAxes:c}}e.ofPositions=t;function r(u){if(u.length===3)return Qo.create(C.fromArray(C(),u,0),C.create(1,0,0),C.create(0,1,0),C.create(0,1,0));var l=Ar.fromArray(u,3,u.length/3),c=l.rows,d=c/3,f=Ar.create(3,3),p=Ar.create(1,3),h=Ar.create(3,3),v=Ar.create(3,3),m=Ar.meanRows(l),g=Ar.subRows(Ar.clone(l),m),y=Ar.transpose(Ar.create(c,3),g);Ar.multiplyABt(f,y,y),EJ(f,p,h,v);var b=C.create(m[0],m[1],m[2]),x=C.create(h.data[0],h.data[3],h.data[6]),S=C.create(h.data[1],h.data[4],h.data[7]),_=C.create(h.data[2],h.data[5],h.data[8]);return C.scale(x,x,Math.sqrt(p.data[0]/d)),C.scale(S,S,Math.sqrt(p.data[1]/d)),C.scale(_,_,Math.sqrt(p.data[2]/d)),Qo.create(b,x,S,_)}e.calculateMomentsAxes=r;var n=C(),a=C(),i=C(),o=C();function s(u,l){if(u.length===3)return Qo.clone(l);for(var c=-1/0,d=-1/0,f=-1/0,p=-1/0,h=-1/0,v=-1/0,m=C(),g=C(),y=l.origin,b=C.normalize(a,l.dirA),x=C.normalize(i,l.dirB),S=C.normalize(o,l.dirC),_=0,A=u.length;_<A;_+=3){C.projectPointOnVector(m,C.fromArray(m,u,_),b,y);var T=C.dot(b,C.normalize(g,C.sub(g,m,y))),I=C.distance(m,y);T>0?I>c&&(c=I):I>d&&(d=I),C.projectPointOnVector(m,C.fromArray(m,u,_),x,y);var M=C.dot(x,C.normalize(g,C.sub(g,m,y))),O=C.distance(m,y);M>0?O>f&&(f=O):O>p&&(p=O),C.projectPointOnVector(m,C.fromArray(m,u,_),S,y);var D=C.dot(S,C.normalize(g,C.sub(g,m,y))),F=C.distance(m,y);D>0?F>h&&(h=F):F>v&&(v=F)}var G=C.setMagnitude(C(),b,(c+d)/2),N=C.setMagnitude(C(),x,(f+p)/2),z=C.setMagnitude(C(),S,(h+v)/2),$=C(),j=function(Z,q,te){C.copy(n,y),C.scaleAndAdd(n,n,b,Z),C.scaleAndAdd(n,n,x,q),C.scaleAndAdd(n,n,S,te),C.add($,$,n)};return j(c,f,h),j(c,f,-v),j(c,-p,-v),j(c,-p,h),j(-d,-p,-v),j(-d,-p,h),j(-d,f,h),j(-d,f,-v),C.scale($,$,1/8),Qo.create($,G,N,z)}e.calculateBoxAxes=s})(Fd||(Fd={}));var yg=function(){function e(t,r){this.unit=r,this.all=t}return Object.defineProperty(e.prototype,"index",{get:function(){return this._index?this._index:(this._index=_J(this.all,this.aromaticRings),this._index)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"byFingerprint",{get:function(){return this._byFingerprint?this._byFingerprint:(this._byFingerprint=IJ(this.unit,this.all),this._byFingerprint)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"elementRingIndices",{get:function(){return this.index.elementRingIndices},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"elementAromaticRingIndices",{get:function(){return this.index.elementAromaticRingIndices},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ringComponentIndex",{get:function(){return this.index.ringComponentIndex},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ringComponents",{get:function(){return this.index.ringComponents},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"aromaticRings",{get:function(){return this._aromaticRings?this._aromaticRings:(this._aromaticRings=RJ(this.unit,this.all),this._aromaticRings)},enumerable:!1,configurable:!0}),e}(),xo;(function(e){function t(s,u){for(var l=s.elements,c=s.model.atomicHierarchy.atoms.type_symbol,d=[],f=0,p=u.length;f<p;f++)d[d.length]=c.value(l[u[f]]);return r(d)}e.fingerprint=t;function r(s){return CJ(s)}e.elementFingerprint=r;var n=new Set(["B","C","N","O","SI","P","S","GE","AS","SN","SB","BI"]),a=.05;function i(s,u){var l=s.elements,c=s.bonds,d=c.b,f=c.offset,p=c.edgeProps.flags,h=s.model.atomicHierarchy.atoms,v=h.type_symbol,m=h.label_comp_id;if(m.value(s.elements[u[0]])==="PRO")return!1;for(var g=0,y=!1,b=0,x=u.length;b<x;++b){var S=u[b];!y&&n.has(v.value(l[S]))&&(y=!0);for(var _=f[S],A=f[S+1];_<A;++_)kr.is(16,p[_])&&Je.has(u,d[_])&&(g+=1)}if(g===2*u.length)return!0;if(!y)return!1;var T=Fd.calculateMomentsAxes(x6(s,u));return C.magnitude(T.dirC)<a}e.isAromatic=i;function o(s,u){for(var l=s.model.atomicHierarchy.atoms.label_alt_id,c=s.elements,d=0,f=u.length;d<f;++d){var p=c[u[d]],h=l.value(p);if(h)return h}return""}e.getAltId=o})(xo||(xo={}));(function(e){function t(n){var a=gJ(n);return new e(a,n)}e.create=t;function r(n,a){for(var i=new Map,o=0,s=a.length;o<s;o++){var u=a[o];DJ(n,u,i)}return i}e.byFingerprintAndResidue=r})(yg||(yg={}));function IJ(e,t){for(var r=new Map,n=0,a=0,i=t.length;a<i;a++){var o=t[a],s=xo.fingerprint(e,o);r.has(s)?r.get(s).push(n):r.set(s,[n]),n++}return r}function MJ(e,t){for(var r=e.elements,n=e.model.atomicHierarchy.residueAtomSegments.index,a=n[r[t[0]]],i=1,o=t.length;i<o;i++)if(a!==n[r[t[i]]])return-1;return a}function DJ(e,t,r){var n=e.byFingerprint.get(t);if(!!n)for(var a=0,i=n.length;a<i;a++){var o=n[a],s=MJ(e.unit,e.all[o]);s>=0&&(r.has(s)?r.get(s).push(o):r.set(s,[o]))}}function RJ(e,t){for(var r=[],n=0,a=t.length;n<a;++n)xo.isAromatic(e,t[n])&&r.push(n);return r}var Kr;(function(e){function t(x){return Je.ofSortedArray(x)}e.ofSortedRanges=t;function r(x){return x[0]}e.start=r;function n(x){return x[x.length-1]+1}e.end=n;function a(x){return x[0]}e.min=a;function i(x){return x[x.length-1]}e.max=i;function o(x){for(var S=0,_=0,A=x.length;_<A;_+=2)S+=x[_+1]-x[_]+1;return S}e.size=o;function s(x){return x.length/2}e.count=s;function u(x,S){return x[S*2]}e.startAt=u;function l(x,S){return x[S*2+1]+1}e.endAt=l;function c(x,S){return x[S*2]}e.minAt=c;function d(x,S){return x[S*2+1]}e.maxAt=d;function f(x,S){if(x.length!==S.length)return!1;for(var _=0,A=x.length;_<A;++_)if(x[_]!==S[_])return!1;return!0}e.areEqual=f;function p(x,S){for(var _=0,A=0,T=x.length;A<T;A+=2)for(var I=x[A],M=x[A+1];I<=M;++I)S(I,_),++_}e.forEach=p;function h(x,S){return m(x,S)!==-1}e.has=h;function v(x,S,_){return g(x,S,_)!==-1}e.hasFrom=v;function m(x,S){return g(x,S,0)}e.firstIntersectionIndex=m;function g(x,S,_){if(c(x,_)>ke.max(S)||i(x)<ke.min(S))return-1;for(var A=_,T=s(x);A<T;++A){var I=Ie.ofRange(c(x,A),d(x,A));if(ke.areIntersecting(I,S))return A}return-1}e.firstIntersectionIndexFrom=g;function y(x,S){return new b(x,S)}e.transientSegments=y;var b=function(){function x(S,_){this.ranges=S,this.set=_,this.value={index:0,start:0,end:0},this.curIndex=0,this.hasNext=!1,this.curIndex=m(S,_),this.hasNext=this.curIndex!==-1}return x.prototype.updateValue=function(){this.value.index=this.curIndex,this.value.start=ke.findPredecessorIndex(this.set,u(this.ranges,this.curIndex)),this.value.end=ke.findPredecessorIndex(this.set,l(this.ranges,this.curIndex))},x.prototype.move=function(){return this.hasNext&&(this.updateValue(),this.curIndex=g(this.ranges,this.set,this.curIndex+1),this.hasNext=this.curIndex!==-1),this.value},x}();e.Iterator=b})(Kr||(Kr={}));function OJ(e){for(var t=[],r=e.elements,n=e.model,a=e.model.atomicHierarchy.residueAtomSegments,i=n.atomicHierarchy.derived.residue.traceElementIndex,o=Kr.transientSegments(e.model.atomicRanges.polymerRanges,r),s=nr.transientSegments(a,r);o.hasNext;){var u=o.move();for(s.setSegment(u);s.hasNext;){var l=s.move(),c=l.start,d=l.end,f=l.index;if(ke.areIntersecting(Ie.ofRange(r[c],r[d-1]),r)){var p=i[f];t.push(p===-1?a.offsets[f]:p)}}}return Je.ofSortedArray(t)}function FJ(e){for(var t=[],r=e.elements,n=e.model,a=n.coarseHierarchy,i=a.spheres,o=a.gaussians,s=ze.isSpheres(e)?i.polymerRanges:o.polymerRanges,u=Kr.transientSegments(s,r);u.hasNext;)for(var l=u.move(),c=l.start,d=l.end,f=c;f<d;++f)t.push(r[f]);return Je.ofSortedArray(t)}function kJ(e){for(var t=[],r=e.elements,n=e.model,a=e.residueIndex,i=e.model.atomicHierarchy.residueAtomSegments,o=n.atomicHierarchy.derived.residue.traceElementIndex,s=Kr.transientSegments(e.model.atomicRanges.gapRanges,e.elements);s.hasNext;){var u=s.move(),l=a[r[u.start]],c=a[r[u.end-1]],d=o[l],f=o[c];t.push(d===-1?i.offsets[l]:d),t.push(f===-1?i.offsets[c]:f)}return Je.ofSortedArray(t)}function BJ(e){for(var t=[],r=e.elements,n=e.model,a=n.coarseHierarchy,i=a.spheres,o=a.gaussians,s=ze.isSpheres(e)?i.gapRanges:o.gapRanges,u=Kr.transientSegments(s,r);u.hasNext;){var l=u.move(),c=l.start,d=l.end;t.push(r[c],r[d-1])}return Je.ofSortedArray(t)}function LJ(e){for(var t=[],r=e.elements,n=e.model,a=n.atomicHierarchy,i=a.chainAtomSegments,o=a.residueAtomSegments,s=n.atomicHierarchy.derived.residue,u=s.moleculeType,l=s.traceElementIndex,c=nr.transientSegments(i,r),d=nr.transientSegments(o,r);c.hasNext;)for(d.setSegment(c.move());d.hasNext;){var f=d.move().index;if($s(u[f])){var p=l[f];t.push(p===-1?o.offsets[f]:p)}}return Je.ofSortedArray(t)}function NJ(e){for(var t=[],r=e.elements,n=e.model,a=n.atomicHierarchy,i=a.chainAtomSegments,o=a.residueAtomSegments,s=n.atomicHierarchy.derived.residue,u=s.moleculeType,l=s.traceElementIndex,c=nr.transientSegments(i,r),d=nr.transientSegments(o,r);c.hasNext;)for(d.setSegment(c.move());d.hasNext;){var f=d.move().index;if(S6(u[f])){var p=l[f];t.push(p===-1?o.offsets[f]:p)}}return Je.ofSortedArray(t)}var KP=C.zero();function UJ(e){for(var t=e.conformation.invariantPosition,r=e.elements,n=new Float32Array(r.length*3),a=0,i=r.length;a<i;a++)t(r[a],KP),C.toArray(KP,n,a*3);return n}function $P(e){var t=UJ(e);return Fd.ofPositions(t)}var eo=function(){function e(t){this.minDist=[],this.maxDist=[],this.extrema=[],this.centroidHelper=new qu,this.dir=zJ(t),this.reset()}return e.prototype.computeExtrema=function(t,r){var n=C.dot(this.dir[t],r);n<this.minDist[t]&&(this.minDist[t]=n,C.copy(this.extrema[t*2],r)),n>this.maxDist[t]&&(this.maxDist[t]=n,C.copy(this.extrema[t*2+1],r))},e.prototype.computeSphereExtrema=function(t,r,n){var a=C.dot(this.dir[t],r);a-n<this.minDist[t]&&(this.minDist[t]=a-n,C.scaleAndSub(this.extrema[t*2],r,this.dir[t],n)),a+n>this.maxDist[t]&&(this.maxDist[t]=a+n,C.scaleAndAdd(this.extrema[t*2+1],r,this.dir[t],n))},e.prototype.includeSphere=function(t){if(Ne.hasExtrema(t)&&t.extrema.length>1)for(var r=0,n=t.extrema;r<n.length;r++){var a=n[r];this.includePosition(a)}else this.includePositionRadius(t.center,t.radius)},e.prototype.includePosition=function(t){for(var r=0,n=this.dir.length;r<n;++r)this.computeExtrema(r,t)},e.prototype.includePositionRadius=function(t,r){for(var n=0,a=this.dir.length;n<a;++n)this.computeSphereExtrema(n,t,r)},e.prototype.finishedIncludeStep=function(){for(var t=0;t<this.extrema.length;t++)this.centroidHelper.includeStep(this.extrema[t]);this.centroidHelper.finishedIncludeStep()},e.prototype.radiusSphere=function(t){if(Ne.hasExtrema(t)&&t.extrema.length>1)for(var r=0,n=t.extrema;r<n.length;r++){var a=n[r];this.radiusPosition(a)}else this.radiusPositionRadius(t.center,t.radius)},e.prototype.radiusPosition=function(t){this.centroidHelper.radiusStep(t)},e.prototype.radiusPositionRadius=function(t,r){this.centroidHelper.radiusSphereStep(t,r)},e.prototype.getSphere=function(t){return Ne.setExtrema(this.centroidHelper.getSphere(t),Nt([],this.extrema))},e.prototype.getBox=function(t){return Xt.fromVec3Array(t||Xt(),this.extrema)},e.prototype.reset=function(){for(var t=0,r=this.dir.length;t<r;++t)this.minDist[t]=1/0,this.maxDist[t]=-1/0,this.extrema[t*2]=C(),this.extrema[t*2+1]=C();this.centroidHelper.reset()},e}();function zJ(e){var t;switch(e){case"6":t=Nt([],Am);break;case"14":t=Nt(Nt([],Am),Xb);break;case"26":t=Nt(Nt(Nt([],Am),Xb),QP);break;case"98":t=Nt(Nt(Nt(Nt(Nt(Nt([],Am),Xb),QP),VJ),HJ),GJ);break}return t.map(function(r){var n=C.create(r[0],r[1],r[2]);return C.normalize(n,n)})}var Am=[[1,0,0],[0,1,0],[0,0,1]],Xb=[[1,1,1],[-1,1,1],[-1,-1,1],[1,-1,1]],QP=[[1,1,0],[1,-1,0],[1,0,1],[1,0,-1],[0,1,1],[0,1,-1]],VJ=[[0,1,2],[0,2,1],[1,0,2],[2,0,1],[1,2,0],[2,1,0],[0,1,-2],[0,2,-1],[1,0,-2],[2,0,-1],[1,-2,0],[2,-1,0]],HJ=[[1,1,2],[2,1,1],[1,2,1],[1,-1,2],[1,1,-2],[1,-1,-2],[2,-1,1],[2,1,-1],[2,-1,-1],[1,-2,1],[1,2,-1],[1,-2,-1]],GJ=[[2,2,1],[1,2,2],[2,1,2],[2,-2,1],[2,2,-1],[2,-2,-1],[1,-2,2],[1,2,-2],[1,-2,-2],[2,-1,2],[2,1,-2],[2,-1,-2]],ZP=C.set,qJ=new eo("14"),jJ=new eo("98");function WJ(e){return e>1e4?qJ:jJ}var Pm=C();function hp(e){var t=e.x,r=e.y,n=e.z,a=e.radius,i=e.indices,o=ke.size(i);if(o>25e4){var s=Xt.computeBounding(e);return{box:s,sphere:Ne.fromBox3D(Ne(),s)}}var u=WJ(o);u.reset();for(var l=0;l<o;l++){var c=ke.getAt(i,l);ZP(Pm,t[c],r[c],n[c]),u.includePositionRadius(Pm,a&&a[c]||0)}u.finishedIncludeStep();for(var l=0;l<o;l++){var c=ke.getAt(i,l);ZP(Pm,t[c],r[c],n[c]),u.radiusPositionRadius(Pm,a&&a[c]||0)}var d=u.getSphere();if(!a&&Ne.hasExtrema(d)&&o<=d.extrema.length){for(var f=[],l=0;l<o;l++){var c=ke.getAt(i,l);f.push(C.create(t[c],r[c],n[c]))}Ne.setExtrema(d,f)}return{box:u.getBox(),sphere:d}}var XJ=function(){function e(){this.data=new Map}return e.prototype.get=function(t){var r=Je.hashCode(t);if(!!this.data.has(r))for(var n=0,a=this.data.get(r);n<a.length;n++){var i=a[n],o=i[0],s=i[1];if(Je.areEqual(t,o))return s}},e.prototype.set=function(t,r){var n=Je.hashCode(t);if(this.data.has(n)){for(var a=this.data.get(n),i=0,o=a;i<o.length;i++){var s=o[i];if(Je.areEqual(t,s[0])){s[1]=r;return}}a.push([t,r])}else this.data.set(n,[[t,r]])},e.get=function(t){return t._dynamicPropertyData.ElementSetIntraBondCache||(t._dynamicPropertyData.ElementSetIntraBondCache=new e),t._dynamicPropertyData.ElementSetIntraBondCache},e}(),ze;(function(e){function t(N){return N.kind===0}e.isAtomic=t;function r(N){return N.kind===1||N.kind===2}e.isCoarse=r;function n(N){return N.kind===1}e.isSpheres=n;function a(N){return N.kind===2}e.isGaussians=a;function i(N,z,$,j,Z,q,te,he,W){switch(Z){case 0:return new h(N,z,$,j,q,he,dn.createMapping(te,q.atomicConformation,void 0),W!=null?W:v());case 1:return S(N,z,$,j,q,1,he,dn.createMapping(te,q.coarseConformation.spheres,f(q)),W!=null?W:y());case 2:return S(N,z,$,j,q,2,he,dn.createMapping(te,q.coarseConformation.gaussians,p()),W!=null?W:y())}}e.create=i;function o(N){for(var z=Eo.Mutable(),$=0,j=N.length;$<j;$++)z.set(N[$].id,$);return z}function s(N){for(var z=[],$=0,j=N.length;$<j;$++)z.push(N[$].id);return Ja(z)}function u(N){var z={};return{elements:N[0].elements,units:N,get unitIndexMap(){return z.unitIndexMap||(z.unitIndexMap=o(N)),z.unitIndexMap},hashCode:c(N[0]),transformHash:s(N)}}e.SymmetryGroup=u,function(N){function z(j,Z){return j.hashCode!==Z.hashCode?!1:Je.areEqual(j.elements,Z.elements)}N.areInvariantElementsEqual=z;function $(j){for(var Z=Eo.Mutable(),q=0,te=j.length;q<te;++q)for(var he=j[q],W=0,K=he.units.length;W<K;++W)Z.set(he.units[W].id,q);return Z}N.getUnitSymmetryGroupsIndexMap=$}(u=e.SymmetryGroup||(e.SymmetryGroup={}));function l(N){return e.isAtomic(N)?N.model.atomicConformation.id:N.model.coarseConformation.id}e.conformationId=l;function c(N){return jd(N.invariantId,Je.hashCode(N.elements))}e.hashUnit=c,function(N){N.is=ka.has,N.create=ka.create}(e.Traits||(e.Traits={}));function d(){return{}}function f(N){var z=N.coarseConformation.spheres.radius;return function($){return z[$]}}function p(N){return function(z){return 0}}var h=function(){function N(z,$,j,Z,q,te,he,W){this.kind=0,this.objectPrimitive="atomistic",this.id=z,this.invariantId=$,this.chainGroupId=j,this.traits=Z,this.model=q,this.elements=te,this.conformation=he,this.residueIndex=q.atomicHierarchy.residueAtomSegments.index,this.chainIndex=q.atomicHierarchy.chainAtomSegments.index,this.props=W}return N.prototype.getChild=function(z){return z.length===this.elements.length?this:new N(this.id,this.invariantId,this.chainGroupId,this.traits,this.model,z,this.conformation,v())},N.prototype.applyOperator=function(z,$,j){j===void 0&&(j=!1);var Z=j?$:dn.compose(this.conformation.operator,$);return new N(z,this.invariantId,this.chainGroupId,this.traits,this.model,this.elements,dn.createMapping(Z,this.model.atomicConformation,this.conformation.r),this.props)},N.prototype.remapModel=function(z,$){$||($=w(w({},this.props),{bonds:I(this,this.props.bonds,z)}),e.isSameConformation(this,z)||($.boundary=void 0,$.lookup3d=void 0,$.principalAxes=void 0));var j=this.conformation.operator,Z=qn.Provider.get(z);if(j.spgrOp!==-1&&Z&&Z!==qn.Provider.get(this.model)){var q=j.hkl,te=q[0],he=q[1],W=q[2],K=Z.spacegroup.cell.toFractional,U=C.transformMat4(C(),jt.getCenter(z),K);j=fs.getSymmetryOperatorRef(Z.spacegroup,j.spgrOp,te,he,W,U)}var H=this.model.atomicConformation!==z.atomicConformation||j!==this.conformation.operator?dn.createMapping(j,z.atomicConformation):this.conformation;return new N(this.id,this.invariantId,this.chainGroupId,this.traits,z,this.elements,H,$)},Object.defineProperty(N.prototype,"boundary",{get:function(){if(this.props.boundary)return this.props.boundary;var z=this.model.atomicConformation,$=z.x,j=z.y,Z=z.z;return this.props.boundary=hp({x:$,y:j,z:Z,indices:this.elements}),this.props.boundary},enumerable:!1,configurable:!0}),Object.defineProperty(N.prototype,"lookup3d",{get:function(){if(this.props.lookup3d)return this.props.lookup3d;var z=this.model.atomicConformation,$=z.x,j=z.y,Z=z.z;return this.props.lookup3d=Rd({x:$,y:j,z:Z,indices:this.elements},this.boundary),this.props.lookup3d},enumerable:!1,configurable:!0}),Object.defineProperty(N.prototype,"principalAxes",{get:function(){return this.props.principalAxes?this.props.principalAxes:(this.props.principalAxes=$P(this),this.props.principalAxes)},enumerable:!1,configurable:!0}),Object.defineProperty(N.prototype,"bonds",{get:function(){if(this.props.bonds)return this.props.bonds;var z=XJ.get(this.model),$=z.get(this.elements);return $||($=fJ(this),z.set(this.elements,$)),this.props.bonds=$,this.props.bonds},enumerable:!1,configurable:!0}),Object.defineProperty(N.prototype,"rings",{get:function(){return this.props.rings?this.props.rings:(this.props.rings=yg.create(this),this.props.rings)},enumerable:!1,configurable:!0}),Object.defineProperty(N.prototype,"polymerElements",{get:function(){return this.props.polymerElements?this.props.polymerElements:(this.props.polymerElements=OJ(this),this.props.polymerElements)},enumerable:!1,configurable:!0}),Object.defineProperty(N.prototype,"gapElements",{get:function(){return this.props.gapElements?this.props.gapElements:(this.props.gapElements=kJ(this),this.props.gapElements)},enumerable:!1,configurable:!0}),Object.defineProperty(N.prototype,"nucleotideElements",{get:function(){return this.props.nucleotideElements?this.props.nucleotideElements:(this.props.nucleotideElements=LJ(this),this.props.nucleotideElements)},enumerable:!1,configurable:!0}),Object.defineProperty(N.prototype,"proteinElements",{get:function(){return this.props.proteinElements?this.props.proteinElements:(this.props.proteinElements=NJ(this),this.props.proteinElements)},enumerable:!1,configurable:!0}),Object.defineProperty(N.prototype,"residueCount",{get:function(){if(this.props.residueCount!==void 0)return this.props.residueCount;for(var z=0,$=nr.transientSegments(this.model.atomicHierarchy.residueAtomSegments,this.elements);$.hasNext;)$.move(),z+=1;return this.props.residueCount=z,this.props.residueCount},enumerable:!1,configurable:!0}),N.prototype.getResidueIndex=function(z){return this.residueIndex[this.elements[z]]},N}();e.Atomic=h;function v(){return d()}var m=function(){function N(z,$,j,Z,q,te,he,W,K){this.kind=te,this.objectPrimitive=te===1?"sphere":"gaussian",this.id=z,this.invariantId=$,this.chainGroupId=j,this.traits=Z,this.model=q,this.elements=he,this.conformation=W,this.coarseElements=te===1?q.coarseHierarchy.spheres:q.coarseHierarchy.gaussians,this.coarseConformation=te===1?q.coarseConformation.spheres:q.coarseConformation.gaussians,this.props=K}return N.prototype.getChild=function(z){return z.length===this.elements.length?this:S(this.id,this.invariantId,this.chainGroupId,this.traits,this.model,this.kind,z,this.conformation,y())},N.prototype.applyOperator=function(z,$,j){j===void 0&&(j=!1);var Z=j?$:dn.compose(this.conformation.operator,$);return S(z,this.invariantId,this.chainGroupId,this.traits,this.model,this.kind,this.elements,dn.createMapping(Z,this.getCoarseConformation(),this.conformation.r),this.props)},N.prototype.remapModel=function(z,$){var j=this.getCoarseConformation(),Z=g(this.kind,z);$||($=w({},this.props),e.isSameConformation(this,z)||($.boundary=void 0,$.lookup3d=void 0,$.principalAxes=void 0));var q=j!==Z?dn.createMapping(this.conformation.operator,Z):this.conformation;return new N(this.id,this.invariantId,this.chainGroupId,this.traits,z,this.kind,this.elements,q,$)},Object.defineProperty(N.prototype,"boundary",{get:function(){if(this.props.boundary)return this.props.boundary;var z=this.getCoarseConformation(),$=z.x,j=z.y,Z=z.z;return this.props.boundary=hp({x:$,y:j,z:Z,indices:this.elements}),this.props.boundary},enumerable:!1,configurable:!0}),Object.defineProperty(N.prototype,"lookup3d",{get:function(){if(this.props.lookup3d)return this.props.lookup3d;var z=this.getCoarseConformation(),$=z.x,j=z.y,Z=z.z;return this.props.lookup3d=Rd({x:$,y:j,z:Z,indices:this.elements},this.boundary),this.props.lookup3d},enumerable:!1,configurable:!0}),Object.defineProperty(N.prototype,"principalAxes",{get:function(){return this.props.principalAxes?this.props.principalAxes:(this.props.principalAxes=$P(this),this.props.principalAxes)},enumerable:!1,configurable:!0}),Object.defineProperty(N.prototype,"polymerElements",{get:function(){return this.props.polymerElements?this.props.polymerElements:(this.props.polymerElements=FJ(this),this.props.polymerElements)},enumerable:!1,configurable:!0}),Object.defineProperty(N.prototype,"gapElements",{get:function(){return this.props.gapElements?this.props.gapElements:(this.props.gapElements=BJ(this),this.props.gapElements)},enumerable:!1,configurable:!0}),N.prototype.getCoarseConformation=function(){return g(this.kind,this.model)},N}();function g(N,z){return N===1?z.coarseConformation.spheres:z.coarseConformation.gaussians}function y(){return d()}var b=function(N){Be(z,N);function z(){return N!==null&&N.apply(this,arguments)||this}return z}(m);e.Spheres=b;var x=function(N){Be(z,N);function z(){return N!==null&&N.apply(this,arguments)||this}return z}(m);e.Gaussians=x;function S(N,z,$,j,Z,q,te,he,W){return new m(N,z,$,j,Z,q,te,he,W)}function _(N,z){return N.chainGroupId===z.chainGroupId&&N.conformation.operator.name===z.conformation.operator.name}e.areSameChainOperatorGroup=_;function A(N,z){return ue.areEqual(N.conformation.operator.matrix,z.conformation.operator.matrix,1e-6)}e.areOperatorsEqual=A;function T(N,z){return Je.areEqual(N.elements,z.elements)?M(N,z.model):!1}e.areConformationsEqual=T;function I(N,z,$){var j;if(!!z){if(N.model.atomicConformation.id===$.atomicConformation.id)return z;var Z=Ba.Provider.get(N.model);if(Z){var q=Ba.Provider.get($);return!q||Z===q?z:void 0}return!((j=z.props)===null||j===void 0)&&j.canRemap||M(N,$)?z:void 0}}function M(N,z){var $=jt.CoordinatesHistory.get(jt.getRoot(z));if($)return $.areEqual(N.elements,N.kind,z);for(var j=N.elements,Z=N.conformation.coordinates,q=Z.x,te=Z.y,he=Z.z,W=O(N.kind,z),K=W.x,U=W.y,H=W.z,J=0,X=j.length;J<X;J++){var Q=j[J];if(q[Q]!==K[Q]||te[Q]!==U[Q]||he[Q]!==H[Q])return!1}return!0}e.isSameConformation=M;function O(N,z){return N===0?z.atomicConformation:N===1?z.coarseConformation.spheres:z.coarseConformation.gaussians}e.getModelConformationOfKind=O;function D(N){return O(N.kind,N.model)}e.getConformation=D;function F(N,z){return N===0?z.atomicHierarchy:N===1?z.coarseHierarchy.spheres:z.coarseHierarchy.gaussians}e.getModelHierarchyOfKind=F;function G(N){return F(N.kind,N.model)}e.getHierarchy=G})(ze||(ze={}));var bg;(function(e){function t(a,i,o,s){a.indices[a.count]=o,a.units[a.count]=i,a.squaredDistances[a.count]=s,a.count++}e.add=t;function r(){return{count:0,indices:[],units:[],squaredDistances:[]}}e.create=r;function n(a,i){for(var o=0;o<i.count;++o)a.indices[o]=i.indices[o],a.units[o]=i.units[o],a.squaredDistances[o]=i.squaredDistances[o];return a.count=i.count,a}e.copy=n})(bg||(bg={}));function $6(){return{result:bg.create(),closeUnitsResult:mc.create(),unitGroupResult:mc.create()}}var YJ=function(){function e(t){this.structure=t,this.pivot=C(),this.findContext=$6();for(var r=t.units,n=t.boundary,a=r.length,i=new Float32Array(a),o=new Float32Array(a),s=new Float32Array(a),u=new Float32Array(a),l=C(),c=0;c<a;c++){var d=r[c],f=d.boundary.sphere;C.transformMat4(l,f.center,d.conformation.operator.matrix),i[c]=l[0],o[c]=l[1],s[c]=l[2],u[c]=f.radius}var p={x:i,y:o,z:s,radius:u,indices:ke.ofBounds(0,a)};this.unitLookup=Rd(p,n)}return e.prototype.findUnitIndices=function(t,r,n,a){return this.unitLookup.find(t,r,n,a)},e.prototype.find=function(t,r,n,a,i){return this._find(t,r,n,a,i!=null?i:this.findContext)},e.prototype._find=function(t,r,n,a,i){mc.reset(i.result);var o=this.structure.units,s=this.unitLookup.find(t,r,n,a,i.closeUnitsResult);if(s.count===0)return i.result;for(var u=0,l=s.count;u<l;u++){var c=o[s.indices[u]];C.set(this.pivot,t,r,n),c.conformation.operator.isIdentity||C.transformMat4(this.pivot,this.pivot,c.conformation.operator.inverse);for(var d=c.lookup3d,f=d.find(this.pivot[0],this.pivot[1],this.pivot[2],a,i.unitGroupResult),p=0,h=f.count;p<h;p++)bg.add(i.result,c,f.indices[p],f.squaredDistances[p])}return i.result},e.prototype.findIntoBuilder=function(t,r,n,a,i){var o=this.structure.units,s=this.unitLookup.find(t,r,n,a);if(s.count!==0)for(var u=0,l=s.count;u<l;u++){var c=o[s.indices[u]];C.set(this.pivot,t,r,n),c.conformation.operator.isIdentity||C.transformMat4(this.pivot,this.pivot,c.conformation.operator.inverse);var d=c.lookup3d,f=d.find(this.pivot[0],this.pivot[1],this.pivot[2],a);if(f.count!==0){var p=c.elements;i.beginUnit(c.id);for(var h=0,v=f.count;h<v;h++)i.addElement(p[f.indices[h]]);i.commitUnit()}}},e.prototype.findIntoBuilderIf=function(t,r,n,a,i,o){var s=this.structure.units,u=this.unitLookup.find(t,r,n,a);if(u.count!==0)for(var l=Ze.create(this.structure),c=0,d=u.count;c<d;c++){var f=s[u.indices[c]];C.set(this.pivot,t,r,n),f.conformation.operator.isIdentity||C.transformMat4(this.pivot,this.pivot,f.conformation.operator.inverse);var p=f.lookup3d,h=p.find(this.pivot[0],this.pivot[1],this.pivot[2],a);if(h.count!==0){var v=f.elements;l.unit=f,i.beginUnit(f.id);for(var m=0,g=h.count;m<g;m++)l.element=v[h.indices[m]],o(l)&&i.addElement(l.element);i.commitUnit()}}},e.prototype.findIntoBuilderWithRadius=function(t,r,n,a,i,o,s,u){var l=this.structure.units,c=this.unitLookup.find(t,r,n,o);if(c.count!==0)for(var d=Ze.create(this.structure),f=a+i+o,p=0,h=c.count;p<h;p++){var v=l[c.indices[p]];C.set(this.pivot,t,r,n),v.conformation.operator.isIdentity||C.transformMat4(this.pivot,this.pivot,v.conformation.operator.inverse);var m=v.lookup3d,g=m.find(this.pivot[0],this.pivot[1],this.pivot[2],f);if(g.count!==0){var y=v.elements;d.unit=v,u.beginUnit(v.id);for(var b=0,x=g.count;b<x;b++){d.element=y[g.indices[b]];var S=s(d);Math.sqrt(g.squaredDistances[b])-a-S>o||u.addElement(y[g.indices[b]])}u.commitUnit()}}},e.prototype.check=function(t,r,n,a){var i=this.structure.units,o=this.unitLookup.find(t,r,n,a);if(o.count===0)return!1;for(var s=0,u=o.count;s<u;s++){var l=i[o.indices[s]];C.set(this.pivot,t,r,n),l.conformation.operator.isIdentity||C.transformMat4(this.pivot,this.pivot,l.conformation.operator.inverse);var c=l.lookup3d;if(c.check(this.pivot[0],this.pivot[1],this.pivot[2],a))return!0}return!1},Object.defineProperty(e.prototype,"boundary",{get:function(){return this.structure.boundary},enumerable:!1,configurable:!0}),e}();function Sv(e,t){if(t.length===0)return Xe.Empty;if(t.length===1)return t[0];for(var r=new Map,n=new Set,a=0,i=t;a<i.length;a++)for(var o=i[a].units,s=0,u=o.length;s<u;s++){var l=o[s];if(r.has(l.id)){if(n.has(l.id))continue;var c=Je.union(r.get(l.id),l.elements);r.set(l.id,c),c.length===e.unitMap.get(l.id).elements.length&&n.add(l.id)}else r.set(l.id,l.elements),l.elements.length===e.unitMap.get(l.id).elements.length&&n.add(l.id)}var d=e.subsetBuilder(!0);return r.forEach(KJ,d),d.getStructure()}function KJ(e,t){this.setUnit(t,e)}function $J(e,t){if(e===t)return!0;if(e.units.length!==t.units.length)return!1;for(var r=e.units,n=t.unitMap,a=0,i=r.length;a<i;a++){var o=r[a];if(!n.has(o.id))return!1;var s=n.get(o.id);if(!Je.areEqual(o.elements,s.elements))return!1}return!0}function Yy(e,t){if(e===t)return!0;var r,n;e.units.length<t.units.length?(r=e,n=t):(r=t,n=e);for(var a=r.units,i=n.unitMap,o=0,s=a.length;o<s;o++){var u=a[o];if(!!i.has(u.id)){var l=i.get(u.id);if(Je.areIntersecting(u.elements,l.elements))return!0}}return!1}function Q6(e,t){if(e===t)return e;if(!Yy(e,t))return Xe.Empty;var r,n;e.units.length<t.units.length?(r=e,n=t):(r=t,n=e);for(var a=r.units,i=n.unitMap,o=[],s=0,u=a.length;s<u;s++){var l=a[s];if(!!i.has(l.id)){var c=i.get(l.id);if(Je.areIntersecting(l.elements,c.elements)){var d=Je.intersect(l.elements,c.elements);o[o.length]=l.getChild(d)}}}return Xe.create(o,{parent:e.parent||t.parent})}function l3(e,t){if(e===t)return Xe.Empty;if(!Yy(e,t))return e;for(var r=e.units,n=t.unitMap,a=[],i=0,o=r.length;i<o;i++){var s=r[i];if(!n.has(s.id)){a[a.length]=s;continue}var u=n.get(s.id),l=Je.subtract(s.elements,u.elements);l.length>0&&(a[a.length]=s.getChild(l))}return Xe.create(a,{parent:e.parent||t.parent})}var mt;(function(e){function t(g,y){return{kind:"singletons",source:g,structure:y}}e.Singletons=t;function r(g,y){return{kind:"sequence",source:g,structures:y}}e.Sequence=r;function n(g){return t(g,Xe.Empty)}e.Empty=n;function a(g){return g.kind==="singletons"}e.isSingleton=a;function i(g){return a(g)?g.structure.units.length===0:g.structures.length===0}e.isEmpty=i;function o(g){return a(g)?g.structure.elementCount:g.structures.length}e.structureCount=o;function s(g){return i(g)?Xe.Empty:a(g)?g.structure:Sv(g.source,g.structures)}e.unionStructure=s;function u(g){for(var y=[],b=g.source.unitMap,x=0,S=s(g).units;x<S.length;x++){var _=S[x];_===b.get(_.id)?y[y.length]={unit:_,indices:ke.ofBounds(0,_.elements.length)}:y[y.length]={unit:_,indices:ke.ofSortedArray(Je.indicesOf(b.get(_.id).elements,_.elements))}}return Re(g.source,y)}e.toLociWithCurrentUnits=u;function l(g){for(var y=[],b=g.source.unitMap,x=0,S=s(g).units;x<S.length;x++){var _=S[x],A=b.get(_.id);A===_?y[y.length]={unit:A,indices:ke.ofBounds(0,A.elements.length)}:y[y.length]={unit:A,indices:ke.ofSortedArray(Je.indicesOf(A.elements,_.elements))}}return Re(g.source,y)}e.toLociWithSourceUnits=l;function c(g,y,b){var x=y.length;return x===0?n(g):b?t(g,Sv(g,y)):r(g,y)}var d=function(){function g(y){this.source=y,this.structures=[],this.allSingletons=!0}return g.prototype.add=function(y){var b=y.elementCount;b!==0&&(this.structures[this.structures.length]=y,b!==1&&(this.allSingletons=!1))},g.prototype.getSelection=function(){return c(this.source,this.structures,this.allSingletons)},g}(),f=function(){function g(y){this.structure=y,this.structures=[],this.allSingletons=!0,this.uniqueSets=j_(Xe.hashCode,Xe.areUnitIdsAndIndicesEqual)}return g.prototype.add=function(y){var b=y.elementCount;b===0||!this.uniqueSets.add(y)||(this.structures[this.structures.length]=y,b!==1&&(this.allSingletons=!1))},g.prototype.getSelection=function(){return c(this.structure,this.structures,this.allSingletons)},g}();function p(g){return new d(g)}e.LinearBuilder=p;function h(g){return new f(g)}e.UniqueBuilder=h;function v(g,y){var b=0;if(e.isSingleton(g))for(var x=0,S=g.structure.units;x<S.length;x++)for(var _=S[x],A=_.elements,T=0,I=A.length;T<I;T++){var M=Xe.create([_.getChild(Je.ofSingleton(A[T]))],{parent:g.source});y(M,b++)}else for(var O=0,D=g.structures;O<D.length;O++){var M=D[O];y(M,b++)}}e.forEach=v;function m(g,y){return a(g)?t(y,g.structure):r(y,g.structures)}e.withInputStructure=m})(mt||(mt={}));var Qr;(function(e){e.Empty={hash:-1,elements:[]};function t(c,d){return n(mt.toLociWithSourceUnits(mt.Singletons(c,d)))}e.fromSubStructure=t;function r(c){return n(mt.toLociWithSourceUnits(c))}e.fromSelection=r;function n(c){for(var d=[],f=0,p=c.elements;f<p.length;f++){var h=p[f],v=h.unit,m=h.indices;if(ke.size(m)!==0){var g=[],y=[];if(ke.isInterval(m))ke.size(m)===1?y.push(Ie.min(m)):g.push(Ie.min(m),Ie.max(m));else for(var b=0,x=m.length;b<x;){var S=b;for(b++;b<x&&m[b-1]+1===m[b];)b++;var _=b;if(_-S>2)g.push(m[S],m[_-1]);else for(var A=S;A<_;A++)y[y.length]=m[A]}d.push({unit:v,set:Je.ofSortedArray(y),ranges:Kr.ofSortedRanges(g)})}}for(var T=new Map,b=0,I=d.length;b<I;++b){var h=d[b],M=jd(Ja(h.ranges),Ja(h.set));if(T.has(M)){var O=T.get(M).groupedUnits;O.has(h.unit.invariantId)?O.get(h.unit.invariantId).push(h.unit.id):O.set(h.unit.invariantId,[h.unit.id])}else{var O=new Map;O.set(h.unit.invariantId,[h.unit.id]),T.set(M,{groupedUnits:O,set:h.set,ranges:h.ranges})}}var D=[];return T.forEach(function(F){var G=[];F.groupedUnits.forEach(function(N){return G.push(Je.ofUnsortedArray(N))}),G.sort(function(N,z){return N[0]-z[0]}),D.push({groupedUnits:G,set:F.set,ranges:F.ranges})}),{hash:c.structure.hashCode,elements:D}}e.fromLoci=n;function a(c,d){for(var f=[],p=0,h=c.length;p<h;++p){var v=c[p];d.unitMap.has(v)&&f.push(d.unitMap.get(v))}return f}function i(c,d){c.hash!==-1&&(c.hash,d.hashCode);for(var f=[],p=0,h=c.elements;p<h.length;p++)for(var v=h[p],m=function(x){var S=a(x,d);if(S.length===0)return"continue";var _=void 0;if(v.ranges.length===0)_=v.set;else if(v.set.length===0)if(v.ranges.length===2)_=Ie.ofRange(v.ranges[0],v.ranges[1]);else{var A=new Int32Array(Kr.size(v.ranges));Kr.forEach(v.ranges,function(F,G){return A[G]=F}),_=Je.ofSortedArray(A)}else{var T=Kr.size(v.ranges),I=new Int32Array(v.set.length+T);Kr.forEach(v.ranges,function(F,G){return I[G]=F}),I.set(v.set,T),_=Je.ofUnsortedArray(I)}for(var M=0,O=S;M<O.length;M++){var D=O[M];f.push({unit:D,indices:_})}},g=0,y=v.groupedUnits;g<y.length;g++){var b=y[g];m(b)}return Re(d,f)}e.toLoci=i;function o(c,d){c.hash!==-1&&(c.hash,d.hashCode);for(var f=[],p=0,h=c.elements;p<h.length;p++)for(var v=h[p],m=function(x){var S=a(x,d);if(S.length===0)return"continue";var _=S[0].elements,A=Kr.size(v.ranges),T=v.set.length,I=new Int32Array(T+A),M=void 0;if(A===0){for(var O=0,D=T;O<D;++O)I[O]=_[v.set[O]];M=Je.ofSortedArray(I)}else if(T===0)Kr.forEach(v.ranges,function(z,$){return I[$]=_[z]}),M=Je.ofSortedArray(I);else if(Je.min(v.set)>Kr.max(v.ranges)){Kr.forEach(v.ranges,function(z,$){return I[$]=_[z]});for(var O=0,D=T;O<D;++O)I[O+A]=_[v.set[O]];M=Je.ofSortedArray(I)}else if(Kr.min(v.ranges)>Je.max(v.set)){for(var O=0,D=T;O<D;++O)I[O]=_[v.set[O]];Kr.forEach(v.ranges,function(z,$){return I[$+T]=_[z]}),M=Je.ofSortedArray(I)}else{Kr.forEach(v.ranges,function(z,$){return I[$]=_[z]});for(var O=0,D=T;O<D;++O)I[O+A]=_[v.set[O]];M=Je.ofUnsortedArray(I)}for(var F=0,G=S;F<G.length;F++){var N=G[F];f.push(N.getChild(M))}},g=0,y=v.groupedUnits;g<y.length;g++){var b=y[g];m(b)}return Xe.create(f,{parent:d})}e.toStructure=o;function s(c){return se.internal.generator.bundleElement({groupedUnits:se.core.type.list(c.groupedUnits.map(function(d){return se.core.type.list(d)})),ranges:se.core.type.list(c.ranges),set:se.core.type.list(c.set)})}function u(c){return se.internal.generator.bundle({elements:se.core.type.list(c.elements.map(s))})}e.toExpression=u;function l(c,d){if(c.elements.length!==d.elements.length)return!1;for(var f=0,p=c.elements.length;f<p;++f){var h=c.elements[f],v=d.elements[f];if(h.groupedUnits.length!==v.groupedUnits.length)return!1;for(var m=0,g=v.groupedUnits.length;m<g;++m)if(!Je.areEqual(h.groupedUnits[m],v.groupedUnits[m]))return!1;if(!Je.areEqual(h.set,v.set)||!Kr.areEqual(h.ranges,v.ranges))return!1}return!0}e.areEqual=l})(Qr||(Qr={}));function Ox(e){return kr.isCovalent(e.atomicBond.type)}function QJ(){return function(t){for(var r=t.inputStructure,n=Ze.create(r),a=[],i=0,o=r.units;i<o.length;i++){var s=o[i];if(s.kind===0){n.unit=s;var u=s.elements;if(n.element=u[0],ct.entity.type(n)==="polymer"){for(var l=nr.transientSegments(s.model.atomicHierarchy.residueAtomSegments,u),c=0;l.hasNext;)c++,l.move();c<8||a.push(s)}}}return mt.Singletons(r,Xe.create(a,{parent:r}))}}function ZJ(){return function(t){for(var r=t.inputStructure,n=Ze.create(r),a=[],i=0,o=r.units;i<o.length;i++){var s=o[i];if(s.kind===0){n.unit=s;var u=s.elements;n.element=u[0],ct.entity.type(n)==="water"&&a.push(s)}}return mt.Singletons(r,Xe.create(a,{parent:r}))}}function JJ(){return function(t){for(var r=t.inputStructure,n=Ze.create(r),a=[],i=0,o=r.units;i<o.length;i++){var s=o[i];if(s.kind===0){n.unit=s;var u=s.elements;if(n.element=u[0],ct.entity.type(n)!=="water"){if(ct.entity.type(n)==="polymer"){for(var l=nr.transientSegments(s.model.atomicHierarchy.residueAtomSegments,u),c=0;l.hasNext;)c++,l.move();if(c>=8)continue}a.push(s)}}}return mt.Singletons(r,Xe.create(a,{parent:r}))}}function eee(){return function(t){for(var r=t.inputStructure,n=[],a=0,i=r.units;a<i.length;a++){var o=i[a];o.kind===1&&n.push(o)}return mt.Singletons(r,Xe.create(n,{parent:r}))}}function Z6(e,t,r){return{groupedUnits:e,ranges:t,set:r}}function J6(e){return function(r){var n={hash:r.inputStructure.hashCode,elements:e};return mt.Sequence(r.inputStructure,[Qr.toStructure(n,r.inputStructure)])}}var tee=Object.freeze(Object.defineProperty({__proto__:null,defaultBondTest:Ox,atomicSequence:QJ,water:ZJ,atomicHet:JJ,spheres:eee,bundleElementImpl:Z6,bundleGenerator:J6},Symbol.toStringTag,{value:"Module"})),Qi=function(){function e(t,r){this.currentElementStack=[],this.currentAtomicBondStack=[],this.currentStructureStack=[],this.inputStructureStack=[],this.timeCreated=xn(),this.element=Ze.create(void 0),this.currentStructure=void 0,this.atomicBond=new JP,this.currentSelection=void 0,this.inputStructure=t,this.timeoutMs=r&&r.timeoutMs||0,this.currentSelection=r&&r.currentSelection}return e.prototype.pushCurrentElement=function(){return this.currentElementStack[this.currentElementStack.length]=this.element,this.element=Ze.create(void 0),this.element},e.prototype.popCurrentElement=function(){this.element=this.currentElementStack.pop()},e.prototype.pushCurrentBond=function(){return this.atomicBond&&this.currentAtomicBondStack.push(this.atomicBond),this.atomicBond=new JP,this.atomicBond},e.prototype.popCurrentBond=function(){this.currentAtomicBondStack.length>0?this.atomicBond=this.currentAtomicBondStack.pop():this.atomicBond=void 0},e.prototype.pushCurrentStructure=function(){this.currentStructure&&this.currentStructureStack.push(this.currentStructure)},e.prototype.popCurrentStructure=function(){this.currentStructureStack.length?this.currentStructure=this.currentStructureStack.pop():this.currentStructure=void 0},e.prototype.pushInputStructure=function(t){this.inputStructureStack.push(this.inputStructure),this.inputStructure=t},e.prototype.popInputStructure=function(){if(this.inputStructureStack.length===0)throw new Error("Must push before pop.");this.inputStructure=this.inputStructureStack.pop()},e.prototype.throwIfTimedOut=function(){if(this.timeoutMs!==0&&xn()-this.timeCreated>this.timeoutMs)throw new Error("The query took too long to execute (> "+this.timeoutMs/1e3+"s).")},e.prototype.tryGetCurrentSelection=function(){if(!this.currentSelection)throw new Error("The current selection is not assigned.");return this.currentSelection},e}(),JP=function(){function e(){this.a=Ze.create(void 0),this.aIndex=0,this.b=Ze.create(void 0),this.bIndex=0,this.type=0,this.order=0,this.testFn=Ox}return e.prototype.setStructure=function(t){this.a.structure=t,this.b.structure=t},e.prototype.setTestFn=function(t){this.testFn=t||Ox},e.prototype.test=function(t,r){return this.testFn(t)?!0:r?(this.swap(),this.testFn(t)):!1},e.prototype.swap=function(){var t=this.aIndex;this.aIndex=this.bIndex,this.bIndex=t;var r=this.a.unit;this.a.unit=this.b.unit,this.b.unit=r;var n=this.a.element;this.a.element=this.b.element,this.b.element=n},Object.defineProperty(e.prototype,"length",{get:function(){return Ze.distance(this.a,this.b)},enumerable:!1,configurable:!0}),e}(),Fx;(function(e){function t(r,n,a){return r(new Qi(n,a))}e.run=t})(Fx||(Fx={}));var kx=function(){function e(t){this.source=t,this.set=j_(Xe.hashCode,Xe.areUnitIdsAndIndicesEqual),this.structures=[],this.allSingletons=!0}return e.prototype.add=function(t){!t.elementCount||(t.elementCount!==1&&(this.allSingletons=!1),this.set.add(t)&&(this.structures[this.structures.length]=t))},e.prototype.getSelection=function(){return this.allSingletons?mt.Singletons(this.source,Sv(this.source,this.structures)):mt.Sequence(this.source,this.structures)},e}(),ree=function(){function e(t){this.source=t,this.builders=[],this.builderMap=new Map}return e.prototype.add=function(t,r,n){var a=this.builderMap.get(t);a||(a=this.source.subsetBuilder(!0),this.builders[this.builders.length]=a,this.builderMap.set(t,a)),a.addToUnit(r,n)},e.prototype.allSingletons=function(){for(var t=0,r=this.builders.length;t<r;t++)if(this.builders[t].elementCount>1)return!1;return!0},e.prototype.singletonSelection=function(){for(var t=this.source.subsetBuilder(!0),r=Ze.create(this.source),n=0,a=this.builders.length;n<a;n++)this.builders[n].setSingletonLocation(r),t.addToUnit(r.unit.id,r.element);return mt.Singletons(this.source,t.getStructure())},e.prototype.fullSelection=function(){for(var t=new Array(this.builders.length),r=0,n=this.builders.length;r<n;r++)t[r]=this.builders[r].getStructure();return mt.Sequence(this.source,t)},e.prototype.getSelection=function(){var t=this.builders.length;return t===0?mt.Empty(this.source):this.allSingletons()?this.singletonSelection():this.fullSelection()},e}(),c3=function(e){return mt.Sequence(e.inputStructure,[])},eO=function(e){return mt.Singletons(e.inputStructure,e.inputStructure)};function nee(e){return d3(w(w({},e),{groupBy:function(t){return ct.residue.key(t.element)}}))}function aee(e){return d3(w(w({},e),{groupBy:function(t){return ct.chain.key(t.element)}}))}function Yl(e){return!0}function iee(e){return 0}function d3(e){if(!e||!e.atomTest&&!e.residueTest&&!e.chainTest&&!e.entityTest&&!e.unitTest&&!e.groupBy)return eO;if(!!e.atomTest&&!e.residueTest&&!e.chainTest&&!e.entityTest&&!e.unitTest&&!e.groupBy)return oee(e.atomTest);var t={unitTest:e.unitTest||Yl,entityTest:e.entityTest||Yl,chainTest:e.chainTest||Yl,residueTest:e.residueTest||Yl,atomTest:e.atomTest||Yl,groupBy:e.groupBy||iee};return e.groupBy?uee(t):see(t)}function oee(e){return function(r){var n=r.inputStructure,a=n.units,i=r.pushCurrentElement(),o=n.subsetBuilder(!0);i.structure=n;for(var s=0,u=a;s<u.length;s++){var l=u[s];i.unit=l;var c=l.elements;o.beginUnit(l.id);for(var d=0,f=c.length;d<f;d++)i.element=c[d],e(r)&&o.addElement(i.element);o.commitUnit(),r.throwIfTimedOut()}return r.popCurrentElement(),mt.Singletons(n,o.getStructure())}}function see(e){var t=e.unitTest,r=e.entityTest,n=e.chainTest,a=e.residueTest,i=e.atomTest;return function(s){var u=s.inputStructure,l=u.units,c=s.pushCurrentElement(),d=u.subsetBuilder(!0),f=a===Yl&&i===Yl,p=i===Yl;c.structure=u;for(var h=0,v=l;h<v.length;h++){var m=v[h];if(c.unit=m,!!t(s)){var g=m.elements,y=m.model;if(d.beginUnit(m.id),m.kind===0)for(var b=nr.transientSegments(m.model.atomicHierarchy.chainAtomSegments,g),x=nr.transientSegments(m.model.atomicHierarchy.residueAtomSegments,g);b.hasNext;){var S=b.move();if(c.element=g[S.start],!(!r(s)||!n(s))){if(f){d.addElementRange(g,S.start,S.end);continue}for(x.setSegment(S);x.hasNext;){var _=x.move();if(c.element=g[_.start],!!a(s)){if(p){d.addElementRange(g,_.start,_.end);continue}for(var A=_.start,T=_.end;A<T;A++)c.element=g[A],i(s)&&d.addElement(c.element)}}}}else for(var I=y.coarseHierarchy.spheres.chainElementSegments,b=nr.transientSegments(I,g);b.hasNext;){var S=b.move();if(c.element=g[S.start],!(!r(s)||!n(s))){if(f){d.addElementRange(g,S.start,S.end);continue}for(var A=S.start,T=S.end;A<T;A++)c.element=g[A],a(s)&&d.addElement(c.element)}}d.commitUnit(),s.throwIfTimedOut()}}return s.popCurrentElement(),mt.Singletons(u,d.getStructure())}}function uee(e){var t=e.unitTest,r=e.entityTest,n=e.chainTest,a=e.residueTest,i=e.atomTest,o=e.groupBy;return function(u){var l=u.inputStructure,c=l.units,d=u.pushCurrentElement(),f=new ree(l);d.structure=l;for(var p=0,h=c;p<h.length;p++){var v=h[p];if(d.unit=v,!!t(u)){var m=v.elements,g=v.model;if(v.kind===0)for(var y=nr.transientSegments(g.atomicHierarchy.chainAtomSegments,m),b=nr.transientSegments(g.atomicHierarchy.residueAtomSegments,m);y.hasNext;){var x=y.move();if(d.element=m[x.start],!(!r(u)||!n(u)))for(b.setSegment(x);b.hasNext;){var S=b.move();if(d.element=m[S.start],!!a(u))for(var _=S.start,A=S.end;_<A;_++)d.element=m[_],i(u)&&f.add(o(u),v.id,d.element)}}else for(var T=g.coarseHierarchy.spheres.chainElementSegments,y=nr.transientSegments(T,m);y.hasNext;){var x=y.move();if(d.element=m[x.start],!(!r(u)||!n(u)))for(var _=x.start,A=x.end;_<A;_++)d.element=m[_],a(u)&&f.add(o(u),v.id,d.element)}u.throwIfTimedOut()}}return u.popCurrentElement(),f.getSelection()}}function Yb(e,t,r){for(var n=new Int32Array(t.length),a=0,i=t.length;a<i;a++)n[a]=e.elements[t[a]];return Xe.create([e.getChild(Je.ofSortedArray(n))],{parent:r})}function lee(e,t){return function(n){var a=n.inputStructure.units,i=mt.LinearBuilder(n.inputStructure);if(!e||e.length===0)for(var o=0,s=a;o<s.length;o++){var u=s[o];if(!!ze.isAtomic(u))if(t)for(var l=0,c=u.rings.aromaticRings;l<c.length;l++){var d=c[l];i.add(Yb(u,u.rings.all[d],n.inputStructure))}else for(var f=0,p=u.rings.all;f<p.length;f++){var d=p[f];i.add(Yb(u,d,n.inputStructure))}}else{for(var h=$r.create(),v=0;v<e.length;v++)$r.add(h,e[v],e[v]);for(var m=0,g=a;m<g.length;m++){var u=g[m];if(!!ze.isAtomic(u))for(var y=u.rings,b=0,x=h.array;b<x.length;b++){var S=x[b];if(!!y.byFingerprint.has(S))for(var _=0,A=y.byFingerprint.get(S);_<A.length;_++){var d=A[_];t&&!y.aromaticRings.includes(d)||i.add(Yb(u,y.all[d],n.inputStructure))}}}}return i.getSelection()}}function cee(e,t,r){return r===void 0&&(r=!1),function(a){var i=e(a);if(mt.structureCount(i)===0)return i;var o=r?l3(a.inputStructure,mt.unionStructure(i)):mt.unionStructure(i);if(o.elementCount===0)return mt.Empty(a.inputStructure);a.throwIfTimedOut(),a.pushInputStructure(o);var s=t(a);return a.popInputStructure(),mt.withInputStructure(s,a.inputStructure)}}function dee(e){return function(r){var n=r.inputStructure,a=n.interUnitBonds,i=mt.UniqueBuilder(r.inputStructure);r.pushCurrentBond();var o=r.atomicBond;o.setTestFn(e),o.setStructure(n);for(var s=0,u=n.units;s<u.length;s++){var l=u[s];if(l.kind===0){var c=l.bonds,d=c.offset,f=c.b,p=c.edgeProps,h=p.flags,v=p.order;o.a.unit=l,o.b.unit=l;for(var m=0,g=l.elements.length;m<g;m++){o.aIndex=m,o.a.element=l.elements[m];for(var y=d[m],b=d[m+1];y<b;y++)if(o.bIndex=f[y],o.b.element=l.elements[f[y]],o.type=h[y],o.order=v[y],o.test(r,!1)){var x=n.subsetBuilder(!1);x.beginUnit(l.id),x.addElement(o.a.element),x.addElement(o.b.element),x.commitUnit(),i.add(x.getStructure())}}}}for(var S=0,_=a.edges;S<_.length;S++){var A=_[S];if(o.a.unit=n.unitMap.get(A.unitA),o.a.element=o.a.unit.elements[A.indexA],o.aIndex=A.indexA,o.b.unit=n.unitMap.get(A.unitA),o.b.element=o.b.unit.elements[A.indexB],o.bIndex=A.indexB,o.order=A.props.order,o.type=A.props.flag,o.test(r,!1)){var x=n.subsetBuilder(!1);x.addToUnit(o.a.unit.id,o.a.element),x.addToUnit(o.b.unit.id,o.b.element),i.add(x.getStructure())}}return r.popCurrentBond(),i.getSelection()}}var fee=Object.freeze(Object.defineProperty({__proto__:null,none:c3,all:eO,residues:nee,chains:aee,atoms:d3,rings:lee,querySelection:cee,bondedAtomicPairs:dee},Symbol.toStringTag,{value:"Module"})),Ky=function(){function e(t){this.parent=t,this.ids=[],this.unitMap=Eo.Mutable(),this.parentId=-1,this.currentUnit=$r.create(),this.elementCount=0}return e.prototype.addToUnit=function(t,r){var n=this.unitMap.get(t);if(n)$r.add(n,r,r)&&this.elementCount++;else{var a=$r.create();$r.add(a,r,r),this.unitMap.set(t,a),this.ids[this.ids.length]=t,this.elementCount++}},e.prototype.has=function(t,r){var n=this.unitMap.get(t);return n?$r.has(n,r):!1},e.prototype.beginUnit=function(t){this.parentId=t,this.unitMap.has(t)?this.currentUnit=this.unitMap.get(t):this.currentUnit=this.currentUnit.array.length>0?$r.create():this.currentUnit},e.prototype.addElement=function(t){$r.add(this.currentUnit,t,t)&&this.elementCount++},e.prototype.commitUnit=function(){this.currentUnit.array.length===0||this.unitMap.has(this.parentId)||(this.ids[this.ids.length]=this.parentId,this.unitMap.set(this.parentId,this.currentUnit),this.parentId=-1)},e.prototype.getStructure=function(){if(this.isEmpty)return Xe.Empty;var t=[];es(this.ids);for(var r=Us.UnitEquivalenceBuilder(),n=0,a=this.ids.length;n<a;n++){var i=this.ids[n],o=this.parent.unitMap.get(i),s=this.unitMap.get(i).array,u=s.length;if(s.length===o.elements.length){t[t.length]=o,r.add(o.id,o);continue}u>1&&es(s);var l=o.getChild(Je.ofSortedArray(s)),c=r.add(l.id,l);l!==c&&(l=c.applyOperator(l.id,l.conformation.operator,!0)),t[t.length]=l}return Xe.create(t,{parent:this.parent})},Object.defineProperty(e.prototype,"isEmpty",{get:function(){return this.elementCount===0},enumerable:!1,configurable:!0}),e}();function pee(e){var t=e.unit,r=e.flags,n=e.proteinInfo,a=t.conformation.position,i=t.model.atomicHierarchy.derived.residue.traceElementIndex,o=n.residueIndices,s=n.nIndices,u=o.length,l=function(O,D){return O===-1?C.setNaN(D):a(O,D)},c=C(),d=C(),f=C(),p=C(),h=C(),v=C(),m=C();e:for(var g=2;g<u-2;g++){for(var y=0;y<4;y++){var b=g+y-2;if(l(i[b],p),l(s[b+1],h),C.squaredDistance(p,h)>6.25)continue e}var x=o[g-2],S=o[g],_=o[g+2],A=i[x],T=i[S],I=i[_];l(A,c),l(T,d),l(I,f),C.sub(v,c,d),C.sub(m,d,f);var M=Jo(C.angle(v,m));M&&M>70&&(r[g]|=32)}}var hee=9,Tm=-27.888,vee=-.5,eT=-9.9;function mee(e,t,r,n){var a=C.distance(e,n),i=C.distance(t,n),o=C.distance(t,r),s=C.distance(e,r),u=Tm/a-Tm/i,l=Tm/o-Tm/s,c=u+l;return c<eT?eT:c}function gee(e,t,r){for(var n=t.residueIndices,a=t.cIndices,i=t.hIndices,o=t.nIndices,s=t.oIndices,u=e.model.atomicHierarchy.index,l=e.conformation.invariantPosition,c=e.model.atomicHierarchy.derived.residue.traceElementIndex,d=n.length,f=[],p=[],h=[],v=C(),m=C(),g=C(),y=C(),b=C(),x=C(),S=C(),_=0,A=n.length;_<A;++_){var T=_,I=n[_],M=s[T],O=a[T],D=c[I];if(!(M===-1||O===-1)&&u.findAtomOnResidue(I,"OXT")===-1){l(M,v),l(O,m),l(D,g);for(var F=r.find(g[0],g[1],g[2],hee),G=F.indices,N=F.count,z=0;z<N;++z){var $=G[z];if(!($===T||$-1===T||$+1===T)){var j=o[$];if(j!==-1){l(j,y);var Z=i[$];if(Z===-1){if($===0)continue;var q=$-1,te=s[q],he=a[q];if(te===-1||he===-1)continue;l(te,S),l(he,x),C.sub(b,x,S);var W=C.distance(S,x);C.scaleAndAdd(b,y,b,1/W)}else l(Z,b);var K=mee(v,m,y,b);K>vee||(f[f.length]=T,p[p.length]=$,h[h.length]=K)}}}}}return yee(d,f,p,h)}function yee(e,t,r,n){for(var a=new Ti.DirectedEdgeBuilder(e,t,r),i=new Float32Array(a.slotCount),o=0,s=a.edgeCount;o<s;o++)a.addNextEdge(),a.assignProperty(i,n[o]);return a.createGraph({energies:n})}var rr;(function(e){e.is=ka.has,e.create=ka.create})(rr||(rr={}));var Em=function(){function e(t,r,n){this.partner1=Math.min(t,r),this.partner2=Math.max(t,r),this.type=n}return e}();function bee(e){for(var t=e.proteinInfo,r=e.hbonds,n=e.flags,a=[1024,2048,4096,128,256,512],i=0;i<3;i++)for(var o=0,s=t.residueIndices.length-1;o<s;++o)if(r.getDirectedEdgeIndex(o,o+i+3)!==-1)if(n[o]|=a[i+3]|a[i],e.params.oldDefinition)for(var u=1;u<i+3;++u)n[o+u]|=a[i+3]|64;else for(var u=0;u<=i+3;++u)n[o+u]|=a[i+3]|64}function See(e){for(var t=e.proteinInfo,r=e.flags,n=t.residueIndices.length,a=[1024,2048,4096,128,256,512],i=[0,0,0,8,1,16],o=e.params.oldOrdering?[4,3,5]:[3,4,5],s=0;s<o.length;s++)for(var u=o[s],l=1,c=n-u;l<c;l++){var d=rr.create(r[l]),f=rr.create(r[l-1]),p=rr.create(r[l+1]);if(e.params.oldOrdering){if(u===3&&(rr.is(d,1)||rr.is(p,1))||u===5&&(rr.is(d,1)||rr.is(d,8)||rr.is(p,1)||rr.is(p,8)))continue}else if(u===4&&(rr.is(d,8)||rr.is(p,8))||u===5&&(rr.is(d,1)||rr.is(d,8)||rr.is(p,1)||rr.is(p,8)))continue;if(rr.is(d,a[u])&&rr.is(d,a[u-3])&&rr.is(f,a[u])&&rr.is(f,a[u-3]))if(e.params.oldDefinition)for(var h=0;h<u;h++)r[l+h]|=i[u];else for(var h=-1;h<=u;h++)r[l+h]|=i[u]}}function xee(e,t){if(t.type!==e.type||t.partner1!==e.firstEnd+1)return!1;if(t.type===0){if(t.partner2===e.secondEnd+1)return!0}else if(t.partner2===e.secondStart-1)return!0;return!1}function Cee(e,t){return e.type===t.type&&t.firstStart-e.firstEnd<6&&e.firstStart<t.firstStart&&t.nextLadder===0?e.type===0?tT(e,t):tT(t,e):!1}function tT(e,t){return t.secondStart-e.secondEnd>0&&(t.secondStart-e.secondEnd<6&&t.firstStart-e.firstEnd<3||t.secondStart-e.secondEnd<3)}function _ee(e){for(var t=e.bridges,r=e.ladders,n=0;n<t.length;n++){for(var a=t[n],i=!1,o=0;o<r.length;o++){var s=r[o];xee(s,a)&&(i=!0,s.firstEnd++,a.type===0?s.secondEnd++:s.secondStart--)}i||(r[r.length]={previousLadder:0,nextLadder:0,firstStart:a.partner1,firstEnd:a.partner1,secondStart:a.partner2,secondEnd:a.partner2,type:a.type})}for(var u=0;u<r.length;u++)for(var l=r[u],c=u;c<r.length;c++){var d=r[c];Cee(l,d)&&(l.nextLadder=c,d.previousLadder=u)}}function wee(e){for(var t=e.proteinInfo,r=e.hbonds,n=e.flags,a=e.bridges,i=r.offset,o=r.b,s,u,l=0,c=t.residueIndices.length;l<c;++l)for(var d=i[l],f=i[l+1];d<f;d++){var p=o[d];l>p||(s=l+1,u=p,s!==u&&r.getDirectedEdgeIndex(u,s+1)!==-1&&(n[s]|=2,n[u]|=2,a[a.length]=new Em(s,u,0)),s=l,u=p-1,s!==u&&r.getDirectedEdgeIndex(u-1,s)!==-1&&(n[s]|=2,n[u]|=2,a[a.length]=new Em(u,s,0)),s=l,u=p,s!==u&&r.getDirectedEdgeIndex(u,s)!==-1&&(n[s]|=2,n[u]|=2,a[a.length]=new Em(u,s,1)),s=l+1,u=p-1,s!==u&&r.getDirectedEdgeIndex(u-1,s+1)!==-1&&(n[s]|=2,n[u]|=2,a[a.length]=new Em(u,s,1)))}a.sort(function(h,v){return h.partner1>v.partner1?1:h.partner1<v.partner1?-1:0})}function rT(e){return rr.is(e,8)||rr.is(e,1)||rr.is(e,16)}function Aee(e){for(var t=e.ladders,r=e.flags,n=0;n<t.length;n++){for(var a=t[n],i=a.firstStart;i<=a.firstEnd;i++){var o=a.firstStart-i,s=a.secondStart-o;a.firstStart!==a.firstEnd?(r[i]|=4,r[s]|=4):(!rT(r[i])&&rr.is(r[i],4)&&(r[i]|=2),!rT(r[s])&&rr.is(r[s],4)&&(r[s]|=2))}if(a.nextLadder!==0){for(var u=t[a.nextLadder],i=a.firstStart;i<=u.firstEnd;i++)r[i]|=4;if(a.type===0)for(var i=a.secondStart;i<=u.secondEnd;i++)r[i]|=4;else for(var i=u.secondEnd;i<=a.secondStart;i++)r[i]|=4}}}function Pee(e,t){var r=t.cIndices,n=t.nIndices,a=t.residueIndices,i=e.conformation.position,o=e.model.atomicHierarchy.index,s=e.model.atomicHierarchy.derived.residue.traceElementIndex,u=a.length,l=function(_,A){return _===-1?C.setNaN(A):i(_,A)},c=C(),d=C(),f=C(),p=C(),h=C(),v=C(),m=C(),g=C(),y=C();if(u===0)return{phi:new Float32Array(0),psi:new Float32Array(0)};var b=new Float32Array(u-1),x=new Float32Array(u-1);l(-1,c),l(-1,d),l(-1,f),l(r[0],p),l(s[a[0]],h),l(n[0],v),l(r[1],m),l(s[a[1]],g),l(n[1],y);for(var S=0;S<u-1;++S)o.findAtomOnResidue(a[S],"OXT")===-1&&(b[S]=Jo(C.dihedralAngle(c,v,h,p)),x[S]=Jo(C.dihedralAngle(v,h,p,y)),c=p,d=h,f=v,p=m,h=g,v=y,l(r[S+1],m),l(s[a[S+1]],g),l(n[S+1],y));return{phi:b,psi:x}}function Tee(e,t){for(var r=e.model.atomicConformation,n=r.x,a=r.y,i=r.z,o=e.model.atomicHierarchy.derived.residue.traceElementIndex,s=new Uint32Array(t.length),u=0,l=t.length;u<l;++u)s[u]=o[t[u]];var c={x:n,y:a,z:i,indices:Je.ofSortedArray(s)};return Rd(c,hp(c))}function Eee(e){for(var t=e.model.atomicHierarchy.index,r=e.proteinElements,n=e.residueIndex,a=r.length,i=new Uint32Array(a),o=new Int32Array(a),s=new Int32Array(a),u=new Int32Array(a),l=new Int32Array(a),c=0;c<a;++c){var d=n[r[c]];i[c]=d,o[c]=t.findAtomOnResidue(d,"C"),s[c]=t.findAtomOnResidue(d,"H"),u[c]=t.findAtomOnResidue(d,"O"),l[c]=t.findAtomOnResidue(d,"N")}return{residueIndices:Je.ofSortedArray(i),cIndices:o,hIndices:s,oIndices:u,nIndices:l}}var Iee={oldDefinition:E.Boolean(!0,{description:"Whether to use the old DSSP convention for the annotation of turns and helices, causes them to be two residues shorter"}),oldOrdering:E.Boolean(!0,{description:"Alpha-helices are preferred over 3-10 helices"})};function Mee(e,t){return ce(this,void 0,void 0,function(){var r,n,a,i,o,s,u,l,c,d,f,p,h,v,m,g,y,b,x,S,_;return de(this,function(A){for(r=Eee(e),n=r.residueIndices,a=Tee(e,n),i=gee(e,r,a),o=n.length,s=new Uint32Array(o),u=Pee(e,r),l=[],c=[],d=t.oldDefinition?Oee:kee,f=t.oldOrdering?Fee:Bee,p={params:t,getResidueFlag:d,getFlagName:f,unit:e,proteinInfo:r,flags:s,hbonds:i,torsionAngles:u,ladders:l,bridges:c},bee(p),See(p),pee(p),wee(p),_ee(p),Aee(p),h=Lee(s,d),v=new Uint32Array(o),m=[],g=[],y=function(T){return Je.indexOf(n,T)},b=0,x=n.length;b<x;++b)S=h[b],v[b]=S,_=d(s[b]),(g.length===0||_!==g[g.length-1].flags)&&(g[g.length]=Dee(Ree(S),s[b],d)),m[b]=g.length-1;return[2,B6(v,m,g,y)]})})}function Dee(e,t,r){return e==="helix"?{kind:"helix",flags:r(t)}:e==="sheet"?{kind:"sheet",flags:r(t)}:e==="turn"||e==="bend"?{kind:"turn",flags:r(t)}:{kind:"none"}}function Ree(e){return e===Fr.SecondaryStructureDssp.H||e===Fr.SecondaryStructureDssp.G||e===Fr.SecondaryStructureDssp.I?"helix":e===Fr.SecondaryStructureDssp.B||e===Fr.SecondaryStructureDssp.E?"sheet":e===Fr.SecondaryStructureDssp.T?"turn":e===Fr.SecondaryStructureDssp.S?"bend":"none"}function Oee(e){return rr.is(e,1)?Fr.SecondaryStructureDssp.H:rr.is(e,4)?Fr.SecondaryStructureDssp.E:rr.is(e,2)?Fr.SecondaryStructureDssp.B:rr.is(e,8)?Fr.SecondaryStructureDssp.G:rr.is(e,16)?Fr.SecondaryStructureDssp.I:rr.is(e,64)?Fr.SecondaryStructureDssp.T:rr.is(e,32)?Fr.SecondaryStructureDssp.S:0}function Fee(e){return rr.is(e,1)?"H":rr.is(e,4)?"E":rr.is(e,2)?"B":rr.is(e,8)?"G":rr.is(e,16)?"I":rr.is(e,64)?"T":rr.is(e,32)?"S":"-"}function kee(e){return rr.is(e,16)?Fr.SecondaryStructureDssp.I:rr.is(e,1)?Fr.SecondaryStructureDssp.H:rr.is(e,4)?Fr.SecondaryStructureDssp.E:rr.is(e,2)?Fr.SecondaryStructureDssp.B:rr.is(e,8)?Fr.SecondaryStructureDssp.G:rr.is(e,64)?Fr.SecondaryStructureDssp.T:rr.is(e,32)?Fr.SecondaryStructureDssp.S:0}function Bee(e){return rr.is(e,16)?"I":rr.is(e,1)?"H":rr.is(e,4)?"E":rr.is(e,2)?"B":rr.is(e,8)?"G":rr.is(e,64)?"T":rr.is(e,32)?"S":"-"}function Lee(e,t){for(var r=new Uint32Array(e.length),n=0,a=e.length;n<a;++n){var i=rr.create(e[n]);r[n]=t(i)}return r}var yc;(function(e){function t(n){var a=this,i=n.descriptor.name,o=n.type==="root"?"inheritedPropertyData":"currentPropertyData",s=function(l){return i in l[o]||(l[o][i]={props:w({},E.getDefaultValues(n.getParams(l))),data:fc.create(void 0)}),l[o][i]},u=function(l,c,d){var f=s(l);l[o][i]={props:c,data:fc.withValue(f.data,d)}};return{label:n.label,descriptor:n.descriptor,isHidden:n.isHidden,getParams:function(l){var c=E.clone(n.getParams(l));return E.setDefaultValues(c,s(l).props),c},defaultParams:n.defaultParams,isApplicable:n.isApplicable,attach:function(l,c,d,f){return d===void 0&&(d={}),ce(a,void 0,void 0,function(){var p,h,v,m,g,y;return de(this,function(b){switch(b.label){case 0:return f&&c.customPropertyDescriptors.reference(n.descriptor,!0),n.type==="root"&&(c=c.root),p=s(c.root).props,h=s(c),v=E.merge(n.defaultParams,p,d),h.data.value&&E.areEqual(n.defaultParams,h.props,v)?[2]:[4,n.obtain(l,c,v)];case 1:return m=b.sent(),g=m.value,y=m.assets,c.customPropertyDescriptors.add(n.descriptor),c.customPropertyDescriptors.assets(n.descriptor,y),u(c,v,g),[2]}})})},ref:function(l,c){return l.customPropertyDescriptors.reference(n.descriptor,c)},get:function(l){return s(l).data},set:function(l,c,d){c===void 0&&(c={}),n.type==="root"&&(l=l.root);var f=s(l),p=E.merge(n.defaultParams,f.props,c);E.areEqual(n.defaultParams,f.props,p)||(u(l,p,d),l.customPropertyDescriptors.assets(n.descriptor))},props:function(l){return s(l).props}}}e.createProvider=t;function r(n,a,i){var o=this,s={value:E.Value(i,{isHidden:!0})};return t({label:ji(n),descriptor:Pi({name:n}),isHidden:!0,type:a,defaultParams:s,getParams:function(){return{value:E.Value(i,{isHidden:!0})}},isApplicable:function(){return!0},obtain:function(u,l,c){return ce(o,void 0,void 0,function(){return de(this,function(d){return[2,w(w({},E.getDefaultValues(s)),c)]})})}})}e.createSimple=r})(yc||(yc={}));function tO(e){var t="model";if(e){t="dssp";for(var r=0,n=e.models.length;r<n;++r){var a=e.models[r];if(jt.isFromPdbArchive(a)||jt.hasSecondaryStructure(a)){t="model";break}}}return{type:E.MappedStatic(t,{model:E.EmptyGroup({label:"Model"}),dssp:E.Group(Iee,{label:"DSSP",isFlat:!0})},{options:[["model","Model"],["dssp","DSSP"]]})}}var nT=tO(),Xs=yc.createProvider({label:"Secondary Structure",descriptor:Pi({name:"molstar_computed_secondary_structure"}),type:"root",defaultParams:nT,getParams:tO,isApplicable:function(e){return!0},obtain:function(e,t,r){return ce(void 0,void 0,void 0,function(){var n,a,i,o;return de(this,function(s){switch(s.label){case 0:switch(n=w(w({},E.getDefaultValues(nT)),r),a=n.type.name,a){case"dssp":return[3,1];case"model":return[3,3]}return[3,5];case 1:return i={},[4,Nee(t,n.type.params)];case 2:return[2,(i.value=s.sent(),i)];case 3:return o={},[4,Uee(t)];case 4:return[2,(o.value=s.sent(),o)];case 5:return[2]}})})}});function Nee(e,t){return ce(this,void 0,void 0,function(){var r,n,a,i,o;return de(this,function(s){switch(s.label){case 0:r=new Map,n=0,a=e.unitSymmetryGroups.length,s.label=1;case 1:return n<a?(i=e.unitSymmetryGroups[n].units[0],ze.isAtomic(i)&&!jt.isCoarseGrained(i.model)?[4,Mee(i,t)]:[3,3]):[3,4];case 2:o=s.sent(),r.set(i.invariantId,o),s.label=3;case 3:return++n,[3,1];case 4:return[2,r]}})})}function Uee(e){return ce(this,void 0,void 0,function(){var t,r,n,a,i;return de(this,function(o){for(t=new Map,r=0,n=e.unitSymmetryGroups.length;r<n;++r)a=e.unitSymmetryGroups[r].units[0],ze.isAtomic(a)&&(i=mv.Provider.get(a.model),i&&t.set(a.invariantId,i));return[2,t]})})}var zee={true:function(e){return!0},false:function(e){return!1},zero:function(e){return 0}};function wn(){throw"Property only available for atomic models."}function wl(e){throw e?"Property only available for coarse models ("+e+").":"Property only available for coarse models."}var Th={key:function(e){return e.element},x:function(e){return e.unit.conformation.x(e.element)},y:function(e){return e.unit.conformation.y(e.element)},z:function(e){return e.unit.conformation.z(e.element)},id:function(e){return ze.isAtomic(e.unit)?e.unit.model.atomicConformation.atomId.value(e.element):wn()},occupancy:function(e){return ze.isAtomic(e.unit)?e.unit.model.atomicConformation.occupancy.value(e.element):wn()},B_iso_or_equiv:function(e){return ze.isAtomic(e.unit)?e.unit.model.atomicConformation.B_iso_or_equiv.value(e.element):wn()},sourceIndex:function(e){return ze.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atomSourceIndex.value(e.element):e.element},type_symbol:function(e){return ze.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.type_symbol.value(e.element):wn()},label_atom_id:function(e){return ze.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.label_atom_id.value(e.element):wn()},auth_atom_id:function(e){return ze.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.auth_atom_id.value(e.element):wn()},label_alt_id:function(e){return ze.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.label_alt_id.value(e.element):wn()},label_comp_id:Sg,auth_comp_id:function(e){return ze.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.auth_comp_id.value(e.element):wn()},pdbx_formal_charge:function(e){return ze.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.pdbx_formal_charge.value(e.element):wn()},vdw_radius:function(e){return ze.isAtomic(e.unit)?Mv(e.unit.model.atomicHierarchy.atoms.type_symbol.value(e.element)):wn()}};function Sg(e){return ze.isAtomic(e.unit)||wn(),e.unit.model.atomicHierarchy.atoms.label_comp_id.value(e.element)}function f3(e){return ze.isAtomic(e.unit)?e.unit.model.atomicHierarchy.residues.label_seq_id.value(e.unit.residueIndex[e.element]):wn()}function Vee(e){ze.isAtomic(e.unit)||wn();var t=e.unit.model.sequence.byEntityKey[oi(e)];return t&&t.sequence.microHet.has(f3(e))}function aT(e){ze.isAtomic(e.unit)||wn();var t=e.unit.model.sequence.byEntityKey[oi(e)];return t?t.sequence.microHet.get(f3(e))||[Sg(e)]:[Sg(e)]}var Hee={key:function(e){return ze.isAtomic(e.unit)?e.unit.residueIndex[e.element]:wn()},group_PDB:function(e){return ze.isAtomic(e.unit)?e.unit.model.atomicHierarchy.residues.group_PDB.value(e.unit.residueIndex[e.element]):wn()},label_seq_id:f3,auth_seq_id:function(e){return ze.isAtomic(e.unit)?e.unit.model.atomicHierarchy.residues.auth_seq_id.value(e.unit.residueIndex[e.element]):wn()},pdbx_PDB_ins_code:function(e){return ze.isAtomic(e.unit)?e.unit.model.atomicHierarchy.residues.pdbx_PDB_ins_code.value(e.unit.residueIndex[e.element]):wn()},isNonStandard:function(e){return ze.isAtomic(e.unit)?aT(e).some(function(t){return e.unit.model.properties.chemicalComponentMap.get(t).mon_nstd_flag[0]==="n"}):wn()},hasMicroheterogeneity:Vee,microheterogeneityCompIds:aT,secondary_structure_type:function(e){var t,r;ze.isAtomic(e.unit)||wn();var n=(t=Xs.get(e.structure).value)===null||t===void 0?void 0:t.get(e.unit.invariantId);return(r=n==null?void 0:n.type[e.unit.residueIndex[e.element]])!==null&&r!==void 0?r:536870912},secondary_structure_key:function(e){var t,r;ze.isAtomic(e.unit)||wn();var n=(t=Xs.get(e.structure).value)===null||t===void 0?void 0:t.get(e.unit.invariantId);return(r=n==null?void 0:n.key[e.unit.residueIndex[e.element]])!==null&&r!==void 0?r:-1},chem_comp_type:function(e){return ze.isAtomic(e.unit)?e.unit.model.properties.chemicalComponentMap.get(Sg(e)).type:wn()}},Gee={key:function(e){return ze.isAtomic(e.unit)?e.unit.chainIndex[e.element]:wn()},label_asym_id:function(e){return ze.isAtomic(e.unit)?e.unit.model.atomicHierarchy.chains.label_asym_id.value(e.unit.chainIndex[e.element]):wn()},auth_asym_id:function(e){return ze.isAtomic(e.unit)?e.unit.model.atomicHierarchy.chains.auth_asym_id.value(e.unit.chainIndex[e.element]):wn()},label_entity_id:function(e){return ze.isAtomic(e.unit)?e.unit.model.atomicHierarchy.chains.label_entity_id.value(e.unit.chainIndex[e.element]):wn()}},qee={key:Th.key,entityKey:function(e){return ze.isCoarse(e.unit)?e.unit.coarseElements.entityKey[e.element]:wl()},x:Th.x,y:Th.y,z:Th.z,asym_id:function(e){return ze.isCoarse(e.unit)?e.unit.coarseElements.asym_id.value(e.element):wl()},seq_id_begin:function(e){return ze.isCoarse(e.unit)?e.unit.coarseElements.seq_id_begin.value(e.element):wl()},seq_id_end:function(e){return ze.isCoarse(e.unit)?e.unit.coarseElements.seq_id_end.value(e.element):wl()},sphere_radius:function(e){return ze.isSpheres(e.unit)?e.unit.coarseConformation.radius[e.element]:wl("spheres")},sphere_rmsf:function(e){return ze.isSpheres(e.unit)?e.unit.coarseConformation.rmsf[e.element]:wl("spheres")},gaussian_weight:function(e){return ze.isGaussians(e.unit)?e.unit.coarseConformation.weight[e.element]:wl("gaussians")},gaussian_covariance_matrix:function(e){return ze.isGaussians(e.unit)?e.unit.coarseConformation.covariance_matrix[e.element]:wl("gaussians")}};function oi(e){switch(e.unit.kind){case 0:return e.unit.model.atomicHierarchy.index.getEntityFromChain(e.unit.chainIndex[e.element]);case 1:return e.unit.model.coarseHierarchy.spheres.entityKey[e.element];case 2:return e.unit.model.coarseHierarchy.gaussians.entityKey[e.element]}}var jee={key:oi,id:function(e){return e.unit.model.entities.data.id.value(oi(e))},type:function(e){return e.unit.model.entities.data.type.value(oi(e))},src_method:function(e){return e.unit.model.entities.data.src_method.value(oi(e))},pdbx_description:function(e){return e.unit.model.entities.data.pdbx_description.value(oi(e))},formula_weight:function(e){return e.unit.model.entities.data.formula_weight.value(oi(e))},pdbx_number_of_molecules:function(e){return e.unit.model.entities.data.pdbx_number_of_molecules.value(oi(e))},details:function(e){return e.unit.model.entities.data.details.value(oi(e))},pdbx_mutation:function(e){return e.unit.model.entities.data.pdbx_mutation.value(oi(e))},pdbx_fragment:function(e){return e.unit.model.entities.data.pdbx_fragment.value(oi(e))},pdbx_ec:function(e){return e.unit.model.entities.data.pdbx_ec.value(oi(e))},subtype:function(e){return e.unit.model.entities.subtype.value(oi(e))},prd_id:function(e){return e.unit.model.entities.prd_id.value(oi(e))}},Wee=[],Xee={id:function(e){return e.unit.id},chainGroupId:function(e){return e.unit.chainGroupId},multiChain:function(e){return ze.Traits.is(e.unit.traits,1)},object_primitive:function(e){return e.unit.objectPrimitive},operator_name:function(e){return e.unit.conformation.operator.name},model_index:function(e){return e.unit.model.modelNum},model_label:function(e){return e.unit.model.label},model_entry_id:function(e){return e.unit.model.entryId},hkl:function(e){return e.unit.conformation.operator.hkl},spgrOp:function(e){return e.unit.conformation.operator.spgrOp},model_num:function(e){return e.unit.model.modelNum},pdbx_struct_assembly_id:function(e){var t;return((t=e.unit.conformation.operator.assembly)===null||t===void 0?void 0:t.id)||dn.DefaultName},pdbx_struct_oper_list_ids:function(e){var t;return((t=e.unit.conformation.operator.assembly)===null||t===void 0?void 0:t.operList)||Wee},struct_ncs_oper_id:function(e){return e.unit.conformation.operator.ncsId}},ct={constant:zee,atom:Th,residue:Hee,chain:Gee,entity:jee,unit:Xee,coarse:qee},jh=function(){function e(t){var r;this.index=new Map,this.checkOperator=!1,this.checkOperator=(r=t==null?void 0:t.checkOperator)!==null&&r!==void 0?r:!1}return e.prototype.add=function(t){var r=this.index.get(t.label_asym_id);r||(r=new Map,this.index.set(t.label_asym_id,r));var n=r.get(t.label_seq_id);n||(n=[],r.set(t.label_seq_id,n));var a=this._find(t,n);return a?!1:(n.push(t),!0)},e.prototype.hasLabelAsymId=function(t){return this.index.has(t)},e.prototype.has=function(t){var r,n,a=iT(t);if(!!this.index.has(a)){var i=this.index.get(a),o=oT(t);if(!!i.has(o))for(var s=i.get(o),u=sT(t),l=uT(t),c=lT(t),d=(r=cT(t))!==null&&r!==void 0?r:"1_555",f=0,p=s;f<p.length;f++){var h=p[f];if(!(h.label_comp_id!==u||h.label_alt_id!==l||h.ins_code!==c)&&!(this.checkOperator&&((n=h.operator_name)!==null&&n!==void 0?n:"1_555")!==d))return h}}},e.getLabel=function(t,r){var n;return r===void 0&&(r=!1),t.label_asym_id+" "+t.label_comp_id+" "+t.label_seq_id+":"+t.ins_code+":"+t.label_alt_id+(r?" "+((n=t.operator_name)!==null&&n!==void 0?n:"1_555"):"")},e.getEntryFromLocation=function(t){var r;return{label_asym_id:iT(t),label_comp_id:sT(t),label_seq_id:oT(t),label_alt_id:uT(t),ins_code:lT(t),operator_name:(r=cT(t))!==null&&r!==void 0?r:"1_555"}},e.prototype._find=function(t,r){for(var n,a,i=0,o=r;i<o.length;i++){var s=o[i];if(!(s.label_comp_id!==t.label_comp_id||s.label_alt_id!==t.label_alt_id||s.ins_code!==t.ins_code)&&!(this.checkOperator&&((n=s.operator_name)!==null&&n!==void 0?n:"1_555")!==((a=t.operator_name)!==null&&a!==void 0?a:"1_555")))return!0}return!1},e}(),iT=ct.chain.label_asym_id,oT=ct.residue.label_seq_id,sT=ct.atom.label_comp_id,uT=ct.atom.label_alt_id,lT=ct.residue.pdbx_PDB_ins_code,cT=ct.unit.operator_name;function vp(e,t,r){for(var n=t.subsetBuilder(!0),a=0,i=r.units;a<i.length;a++){var o=i[a];if(o.kind!==0){n.setUnit(o.id,o.elements);continue}var s=o.model.atomicHierarchy.residueAtomSegments,u=t.unitMap.get(o.id).elements,l=o.elements;n.beginUnit(o.id);for(var c=nr.transientSegments(s,l);c.hasNext;)for(var d=c.move().index,f=s.offsets[d],p=s.offsets[d+1];f<p;f++)Je.has(u,f)&&n.addElement(f);n.commitUnit(),e.throwIfTimedOut()}return n.getStructure()}function Yee(e){return function(r){var n=e(r);if(mt.isSingleton(n))return mt.Singletons(r.inputStructure,vp(r,r.inputStructure,n.structure));for(var a=new kx(r.inputStructure),i=0,o=n.structures;i<o.length;i++){var s=o[i];a.add(vp(r,r.inputStructure,s))}return a.getSelection()}}function Bx(e,t,r,n){for(var a=new Ky(t),i=t.lookup3d,o=n.radius,s=0,u=r.units;s<u.length;s++){for(var l=u[s],c=l.conformation,d=c.x,f=c.y,p=c.z,h=l.elements,v=0,m=h.length;v<m;v++){var g=h[v];i.findIntoBuilder(d(g),f(g),p(g),o,a)}e.throwIfTimedOut()}return n.wholeResidues?vp(e,t,a.getStructure()):a.getStructure()}function dT(e,t,r,n){var a=new Ky(t),i=t.lookup3d,o=n.elementRadius,s=n.elementRadiusClosure,u=n.sourceMaxRadius,l=n.radius;e.pushCurrentElement(),e.element.structure=r;for(var c=0,d=r.units;c<d.length;c++){var f=d[c];e.element.unit=f;for(var p=f.conformation,h=p.x,v=p.y,m=p.z,g=f.elements,y=0,b=g.length;y<b;y++){var x=g[y];e.element.element=x;var S=o(e);i.findIntoBuilderWithRadius(h(x),v(x),m(x),S,u,l,s,a)}e.throwIfTimedOut()}return e.popCurrentElement(),n.wholeResidues?vp(e,t,a.getStructure()):a.getStructure()}function Kee(e,t){return function(r){return e.element.structure=r.structure,e.element.unit=r.unit,e.element.element=r.element,t(e)}}function $ee(e,t){var r=0;e.element.structure=e.inputStructure;for(var n=0,a=e.inputStructure.units;n<a.length;n++){var i=a[n];e.element.unit=i;for(var o=i.elements,s=0,u=o.length;s<u;s++){var l=o[s];e.element.element=l;var c=t(e);c>r&&(r=c)}}return e.throwIfTimedOut(),r}function Qee(e,t){return function(n){var a=e(n);if(t.elementRadius){var i=w(w({},t),{elementRadius:t.elementRadius,elementRadiusClosure:Kee(n,t.elementRadius),sourceMaxRadius:$ee(n,t.elementRadius)});if(mt.isSingleton(a)){var o=dT(n,n.inputStructure,a.structure,i),s=mt.Singletons(n.inputStructure,o);return s}else{for(var u=new kx(n.inputStructure),l=0,c=a.structures;l<c.length;l++){var d=c[l];u.add(dT(n,n.inputStructure,d,i))}return u.getSelection()}}if(mt.isSingleton(a)){var o=Bx(n,n.inputStructure,a.structure,t),s=mt.Singletons(n.inputStructure,o);return s}else{for(var u=new kx(n.inputStructure),f=0,p=a.structures;f<p.length;f++){var d=p[f];u.add(Bx(n,n.inputStructure,d,t))}return u.getSelection()}}}function Zee(e,t){return function(n){var a=e(n);if(mt.structureCount(a)===0)return a;var i=mt.UniqueBuilder(n.inputStructure),o=function(s){return i.add(s)};return mt.forEach(a,function(s,u){n.pushInputStructure(s),mt.forEach(t(n),o),n.popInputStructure(),u%10===0&&n.throwIfTimedOut()}),i.getSelection()}}function Jee(e,t){return function(n){var a=e(n);if(mt.structureCount(a)===0)return a;var i=t(n);if(mt.structureCount(i)===0)return mt.Empty(n.inputStructure);var o=mt.unionStructure(i),s=mt.UniqueBuilder(n.inputStructure);return mt.forEach(a,function(u,l){var c=Q6(o,u);c.elementCount!==0&&s.add(c),l%50===0&&n.throwIfTimedOut()}),s.getSelection()}}function ete(e,t){return function(n){var a=e(n);if(mt.structureCount(a)===0)return a;var i=t(n);if(mt.structureCount(i)===0)return a;var o=mt.unionStructure(i),s=mt.UniqueBuilder(n.inputStructure);return mt.forEach(a,function(u,l){var c=l3(u,o);c.elementCount!==0&&s.add(c),l%50===0&&n.throwIfTimedOut()}),s.getSelection()}}function tte(e){return function(r){var n=mt.LinearBuilder(r.inputStructure);return n.add(mt.unionStructure(e(r))),n.getSelection()}}function rte(e,t){return function(n){var a=e(n),i=new Map,o=[];n.pushCurrentElement(),mt.forEach(a,function(S,_){n.element.structure=S;for(var A=0,T=S.units;A<T.length;A++){var I=T[A];n.element.unit=I;for(var M=I.elements,O=0,D=M.length;O<D;O++){n.element.element=M[O];var F=t(n),G=void 0;i.has(F)?G=i.get(F):(G=$r.create(),i.set(F,G)),$r.add(G,_,_)}}o[_]=n.inputStructure.subsetBuilder(!0),_%10===0&&n.throwIfTimedOut()}),n.element.structure=n.inputStructure;for(var s=0,u=n.inputStructure.units;s<u.length;s++){var l=u[s];n.element.unit=l;for(var c=l.elements,d=0,f=c.length;d<f;d++){n.element.element=c[d];var p=t(n);if(!!i.has(p))for(var h=i.get(p).array,v=0,m=h.length;v<m;v++)o[h[v]].addToUnit(l.id,c[d])}}n.popCurrentElement();for(var g=mt.UniqueBuilder(n.inputStructure),y=0,b=o;y<b.length;y++){var x=b[y];g.add(x.getStructure())}return g.getSelection()}}function nte(e){var t=e.query,r=e.layerCount,n=e.wholeResidues,a=e.bondTest,i=e.fixedPoint,o=Math.max(r,0);return function(u){var l=mt.UniqueBuilder(u.inputStructure),c=t(u);return u.pushCurrentBond(),u.atomicBond.setTestFn(a),mt.forEach(c,function(d,f){var p=d;if(i)for(;;){var h=p.elementCount;if(p=fT(u,n,p),p.elementCount===h)break}else for(var v=0;v<o;v++)p=fT(u,n,p);l.add(p),f%10===0&&u.throwIfTimedOut()}),u.popCurrentBond(),l.getSelection()}}function fT(e,t,r){var n=ate(e,r);return t?vp(e,e.inputStructure,n):n}function ate(e,t){for(var r=e.inputStructure,n=r.interUnitBonds,a=new Ky(r),i=e.atomicBond,o=0,s=t.units;o<s.length;o++){var u=s[o];if(u.kind!==0){a.beginUnit(u.id);for(var l=0,c=u.elements.length;l<c;l++)a.addElement(u.elements[l]);a.commitUnit();continue}var d=r.unitMap.get(u.id),f=d.bonds,p=f.offset,h=f.b,v=f.edgeProps,m=v.flags,g=v.order;i.setStructure(r),i.a.unit=d,i.b.unit=d;for(var l=0,c=u.elements.length;l<c;l++){a.addToUnit(u.id,u.elements[l]);for(var y=Je.indexOf(d.elements,u.elements[l]),b=p[y],x=p[y+1];b<x;b++){var S=h[b],_=d.elements[S];Je.has(u.elements,_)||a.has(u.id,_)||(i.aIndex=y,i.a.element=u.elements[l],i.bIndex=S,i.b.element=_,i.type=m[b],i.order=g[b],i.test(e,!0)&&a.addToUnit(u.id,_))}}for(var A=0,T=n.getConnectedUnits(d.id);A<T.length;A++)for(var I=T[A],M=t.unitMap.get(I.unitB),O=r.unitMap.get(I.unitB),D=0,F=I.connectedIndices;D<F.length;D++){var G=F[D];if(!!Je.has(u.elements,d.elements[G]))for(var N=0,z=I.getEdges(G);N<z.length;N++){var $=z[N],_=O.elements[$.indexB];M&&Je.has(M.elements,_)||a.has(I.unitB,_)||(i.a.unit=d,i.aIndex=G,i.a.element=d.elements[G],i.b.unit=O,i.bIndex=$.indexB,i.b.element=_,i.type=$.props.flag,i.order=$.props.order,i.test(e,!0)&&a.addToUnit(I.unitB,_))}}}return a.getStructure()}function ite(e){var t=e.query,r=e.radius,n=e.includeWater;return function(i){for(var o=mt.unionStructure(t(i)),s=vp(i,i.inputStructure,Bx(i,i.inputStructure,o,{radius:r})),u=ute(i.inputStructure),l=lte(i.inputStructure),c=Ze.create(s),d=new Map,f=new jh({checkOperator:!0}),p=0,h=s.units;p<h.length;p++){var v=h[p];if(v.kind===0){c.unit=v;for(var m=v.elements,g=nr.transientSegments(v.model.atomicHierarchy.chainAtomSegments,m),y=nr.transientSegments(v.model.atomicHierarchy.residueAtomSegments,m);g.hasNext;){var b=g.move();c.element=m[b.start];var x=ct.chain.label_asym_id(c),S=ct.unit.operator_name(c);if(u.has(x)){d.has(x)?Xa(d.get(x),S):d.set(x,[S]);continue}var _=ct.entity.type(c);if(!(_==="water"||_==="polymer"))for(y.setSegment(b);y.hasNext;){var A=y.move();c.element=m[A.start],l.addComponent(jh.getEntryFromLocation(c),f)}}i.throwIfTimedOut()}}for(var T=i.inputStructure.subsetBuilder(!0),I=0,M=i.inputStructure.units;I<M.length;I++){var v=M[I];if(v.kind===0){c.unit=v;var m=v.elements,g=nr.transientSegments(v.model.atomicHierarchy.chainAtomSegments,m),y=nr.transientSegments(v.model.atomicHierarchy.residueAtomSegments,m);for(T.beginUnit(v.id);g.hasNext;){var b=g.move();c.element=m[b.start];var x=ct.chain.label_asym_id(c),S=ct.unit.operator_name(c);if(d.has(x)&&d.get(x).indexOf(S)>=0){T.addElementRange(m,b.start,b.end);continue}if(!!f.hasLabelAsymId(x))for(y.setSegment(b);y.hasNext;){var A=y.move();c.element=m[A.start],f.has(c)&&T.addElementRange(m,A.start,A.end)}}T.commitUnit(),i.throwIfTimedOut()}}var O=Sv(i.inputStructure,[T.getStructure(),o]);if(n){for(var D=new Ky(i.inputStructure),F=i.inputStructure.lookup3d,G=0,N=O.units;G<N.length;G++){for(var v=N[G],z=v.conformation,$=z.x,j=z.y,Z=z.z,m=v.elements,q=0,te=m.length;q<te;q++){var he=m[q];F.findIntoBuilderIf($(he),j(he),Z(he),r,D,ste),D.addToUnit(v.id,he)}i.throwIfTimedOut()}return mt.Sequence(i.inputStructure,[D.getStructure()])}else return mt.Sequence(i.inputStructure,[O])}}var ote=ct.entity.type;function ste(e){return ote(e)==="water"}function ute(e){var t=e.models[0],r=new Set;if(!Jr.is(t.sourceData))return r;for(var n=t.sourceData.data.db.pdbx_molecule,a=n._rowCount,i=n.asym_id,o=0;o<a;o++)r.add(i.value(o));return r}function lte(e){var t,r,n=e.models[0],a=new cte;if(!Jr.is(n.sourceData))return a;for(var i=n.sourceData.data.db.struct_conn,o=i.conn_type_id,s=i.ptnr1_label_asym_id,u=i.ptnr1_label_comp_id,l=i.ptnr1_label_seq_id,c=i.ptnr1_symmetry,d=i.pdbx_ptnr1_label_alt_id,f=i.pdbx_ptnr1_PDB_ins_code,p=i.ptnr2_label_asym_id,h=i.ptnr2_label_comp_id,v=i.ptnr2_label_seq_id,m=i.ptnr2_symmetry,g=i.pdbx_ptnr2_label_alt_id,y=i.pdbx_ptnr2_PDB_ins_code,b=0;b<i._rowCount;b++){var x=o.value(b);if(!(x!=="covale"&&x!=="metalc")){var S={label_asym_id:s.value(b),label_comp_id:u.value(b),label_seq_id:l.value(b),label_alt_id:d.value(b),ins_code:f.value(b),operator_name:(t=c.value(b))!==null&&t!==void 0?t:"1_555"},_={label_asym_id:p.value(b),label_comp_id:h.value(b),label_seq_id:v.value(b),label_alt_id:g.value(b),ins_code:y.value(b),operator_name:(r=m.value(b))!==null&&r!==void 0?r:"1_555"};a.addEdge(S,_)}}return a}var cte=function(){function e(){this.vertices=new Map,this.edges=new Map}return e.prototype.addVertex=function(t,r){this.vertices.has(r)||(this.vertices.set(r,t),this.edges.set(r,[]))},e.prototype.addEdge=function(t,r){var n=jh.getLabel(t),a=jh.getLabel(r);this.addVertex(t,n),this.addVertex(r,a),Xa(this.edges.get(n),a),Xa(this.edges.get(a),n)},e.prototype.addComponent=function(t,r){var n=jh.getLabel(t);if(!this.vertices.has(n)){r.add(t);return}var a=new Set,i=new Set,o=[n];for(i.add(n),r.add(t);o.length>0;){var s=o.pop();a.add(s);for(var u=this.vertices.get(s),l=0,c=this.edges.get(s);l<c.length;l++){var d=c[l];if(!a.has(d)&&(o.push(d),!i.has(d))){i.add(d);var f=this.vertices.get(d);u.operator_name===f.operator_name?r.add(w(w({},f),{operator_name:t.operator_name})):r.add(f)}}}},e}(),dte=Object.freeze(Object.defineProperty({__proto__:null,wholeResidues:Yee,includeSurroundings:Qee,querySelection:Zee,intersectBy:Jee,exceptBy:ete,union:tte,expandProperty:rte,includeConnected:nte,surroundingLigands:ite},Symbol.toStringTag,{value:"Module"}));function fte(e,t,r,n,a,i){return t.elementCount===0||r.elementCount===0?!0:t.elementCount<=r.elementCount?xg.check(e,t,r,n,a,i):xg.check(e,r,t,n,a,i)}function pte(e,t,r,n,a){return t.elementCount===0||r.elementCount===0?!0:t.elementCount<=r.elementCount?Cg.check(e,t,r,n,a):Cg.check(e,r,t,n,a)}var xg;(function(e){var t=C.zero();function r(o,s,u,l,c,d,f){var p=s.elements,h=s.conformation.position,v=t;o.element.unit=s;for(var m=!1,g=0,y=p.length;g<y;g++){var b=p[g];o.element.element=b;var x=Math.max(0,C.distance(u,h(b,v))-l-f(o));if(x<c)return 0;x<d&&(m=!0)}return m?1:2}function n(o,s,u,l,c,d,f){for(var p=s.units,h=!1,v=0,m=p.length;v<m;v++){var g=r(o,p[v],u,l,c,d,f);if(g===0)return 0;g===1&&(h=!0)}return h?1:2}e.toPoint=n;var a=C.zero();function i(o,s,u,l,c,d){if(s.elementCount===0||u.elementCount===0)return 0;var f=s.units,p=!1;o.element.structure=s;for(var h=0,v=f.length;h<v;h++){var m=f[h],g=m.elements,y=m.conformation.position;o.element.unit=m;for(var b=0,x=g.length;b<x;b++){var S=g[b];o.element.element=S;var _=n(o,u,y(S,a),d(o),l,c,d);if(_===0)return 0;_===1&&(p=!0)}}return p}e.check=i})(xg||(xg={}));var Cg;(function(e){var t=C.zero();function r(o,s,u,l,c,d){var f=s.elements,p=s.conformation.position,h=t;o.element.unit=s;for(var v=0,m=f.length;v<m;v++){var g=f[v];if(o.element.element=g,Math.max(0,C.distance(u,p(g,h))-l-d(o))<=c)return!0}return!1}function n(o,s,u,l,c,d){for(var f=s.units,p=0,h=f.length;p<h;p++)if(r(o,f[p],u,l,c,d))return!0;return!1}e.toPoint=n;var a=C.zero();function i(o,s,u,l,c){if(s.elementCount===0||u.elementCount===0)return 0;var d=s.units;o.element.structure=s;for(var f=0,p=d.length;f<p;f++){var h=d[f];o.element.unit=h;for(var v=h.elements,m=h.conformation.position,g=0,y=v.length;g<y;g++){var b=v[g];if(o.element.element=b,n(o,u,m(b,a),c(o),l,c))return!0}}return!1}e.check=i})(Cg||(Cg={}));function hte(e,t){return function(r){var n=e(r),a=mt.LinearBuilder(r.inputStructure);return r.pushCurrentElement(),mt.forEach(n,function(i,o){r.currentStructure=i,t(r)&&a.add(i),o%100&&r.throwIfTimedOut()}),r.popCurrentStructure(),a.getSelection()}}function vte(e){return function(t){var r=e(t),n=mt.LinearBuilder(t.inputStructure);if(r.kind==="singletons"){if(r.structure.elementCount>0){var a=r.structure.units[0],i=Xe.create([a.getChild(Je.ofSingleton(a.elements[0]))],{parent:t.inputStructure});n.add(i)}}else r.structures.length>0&&n.add(r.structures[0]);return n.getSelection()}}function p3(e,t,r){var n=e.currentStructure.units,a=e.pushCurrentElement();a.structure=e.currentStructure;for(var i=0,o=n;i<o.length;i++){var s=o[i];a.unit=s;var u=s.elements,l=void 0;if(ze.isAtomic(s)?l=t.atomic:l=t.coarse,!!l){for(var c=0,d=u.length;c<d;c++)a.element=u[c],r.add(l(e));e.throwIfTimedOut()}}return e.popCurrentElement(),r}function mte(e,t,r){var n=new Set,a=t(e);return e.pushCurrentElement(),mt.forEach(a,function(i,o){e.currentStructure=i,p3(e,r,n),o%10&&e.throwIfTimedOut()}),e.popCurrentElement(),n}function gte(e,t,r){return function(n){var a=e(n),i=mte(n,t,r),o=mt.LinearBuilder(n.inputStructure);return n.pushCurrentStructure(),mt.forEach(a,function(s,u){n.currentStructure=s;var l=p3(n,r,new Set);jn.isSuperset(l,i)&&o.add(s),u%10&&n.throwIfTimedOut()}),n.popCurrentStructure(),o.getSelection()}}function yte(e,t){return function(r){var n=mt.unionStructure(t(r)),a=mt.LinearBuilder(r.inputStructure);return mt.forEach(e(r),function(i,o){Yy(n,i)&&a.add(i),o%10&&r.throwIfTimedOut()}),a.getSelection()}}function bte(e){return function(t){var r={queryCtx:t,selection:e.query(t),target:e.target(t),maxRadius:e.maxRadius,minRadius:e.minRadius?Math.max(0,e.minRadius):0,elementRadius:e.elementRadius,invert:!!e.invert};return r.minRadius===0&&typeof e.minRadius=="undefined"?Ste(r):r.minRadius===0?xte(r):Cte(r)}}function Ste(e){var t=e.queryCtx,r=e.selection,n=e.target,a=e.maxRadius,i=e.invert,o=mt.unionStructure(n).lookup3d,s=mt.LinearBuilder(t.inputStructure),u=C.zero();return mt.forEach(r,function(l,c){for(var d=l.units,f=!1,p=0,h=d.length;p<h;p++){for(var v=d[p],m=v.elements,g=v.conformation,y=g.position,b=g.r,x=0,S=m.length;x<S;x++){var _=m[x];if(y(_,u),o.check(u[0],u[1],u[2],a+b(_))){f=!0;break}}if(f)break}i&&(f=!f),f&&s.add(l),c%10===0&&t.throwIfTimedOut()}),s.getSelection()}function xte(e){var t=e.queryCtx,r=e.selection,n=e.target,a=e.maxRadius,i=e.invert,o=e.elementRadius,s=mt.unionStructure(n),u=mt.LinearBuilder(t.inputStructure);return t.pushCurrentElement(),mt.forEach(r,function(l,c){var d=pte(t,s,l,a,o);i&&(d=!d),d&&u.add(l),c%10===0&&t.throwIfTimedOut()}),t.popCurrentElement(),u.getSelection()}function Cte(e){var t=e.queryCtx,r=e.selection,n=e.target,a=e.minRadius,i=e.maxRadius,o=e.invert,s=e.elementRadius,u=mt.unionStructure(n),l=mt.LinearBuilder(t.inputStructure);return t.pushCurrentElement(),mt.forEach(r,function(c,d){var f=fte(t,u,c,a,i,s);o&&(f=!f),f&&l.add(c),d%10===0&&t.throwIfTimedOut()}),t.popCurrentElement(),l.getSelection()}function _te(e,t){var r=e.queryCtx,n=e.input,a=e.target,i=e.disjunct,o=r.atomicBond,s=n.interUnitBonds;o.setStructure(n);for(var u=0,l=t.units;u<l.length;u++){var c=l[u];if(!!ze.isAtomic(c))for(var d=n.unitMap.get(c.id),f=d.bonds,p=f.offset,h=f.b,v=f.edgeProps,m=v.flags,g=v.order,y=s.getConnectedUnits(c.id),b=y.length,x=c.elements,S=d.elements,_=0,A=x.length;_<A;_++){var T=Je.indexOf(S,x[_]);o.a.unit=d,o.b.unit=d;for(var I=p[T],M=p[T+1];I<M;I++)if(o.b.element=d.elements[h[I]],!(i&&Je.has(c.elements,o.b.element))&&!!a.hasElement(o.b)&&(o.aIndex=T,o.a.element=x[_],o.bIndex=h[I],o.type=m[I],o.order=g[I],o.test(r,!0)))return!0;for(var O=0;O<b;O++)for(var D=y[O],F=n.unitMap.get(D.unitB),G=F.elements,N=D.getEdges(T),z=0,$=N.length;z<$;z++){var j=N[z];if(o.b.unit=F,o.b.element=G[j.indexB],!!a.hasElement(o.b)&&!(i&&t.hasElement(o.b))&&(o.a.unit=d,o.aIndex=T,o.a.element=x[_],o.bIndex=j.indexB,o.type=j.props.flag,o.order=j.props.order,o.test(r,!0)))return!0}}}return!1}function wte(e){var t=e.query,r=e.target,n=e.disjunct,a=e.invert,i=e.bondTest;return function(o){var s=r(o);if(mt.isEmpty(s))return s;var u=t(o);if(mt.isEmpty(u))return u;var l={queryCtx:o,input:o.inputStructure,disjunct:n,target:mt.unionStructure(s)},c=mt.LinearBuilder(o.inputStructure);return o.pushCurrentBond(),o.atomicBond.setTestFn(i),mt.forEach(u,function(d,f){(_te(l,d)||a)&&c.add(d),f%5===0&&o.throwIfTimedOut()}),o.popCurrentBond(),c.getSelection()}}var Ate=Object.freeze(Object.defineProperty({__proto__:null,pick:hte,first:vte,getCurrentStructureProperties:p3,withSameAtomProperties:gte,areIntersectedBy:yte,within:bte,isConnectedTo:wte},Symbol.toStringTag,{value:"Module"}));function Pte(e){return e.length===0?c3:e.length===1?e[0]:function(t){for(var r=mt.UniqueBuilder(t.inputStructure),n=function(i){mt.forEach(e[i](t),function(o,s){r.add(o),i%100&&t.throwIfTimedOut()})},a=0;a<e.length;a++)n(a);return r.getSelection()}}function Tte(e){return e.length===0?c3:e.length===1?e[0]:function(t){for(var r=[],n=0;n<e.length;n++)r.push(e[n](t));for(var a=0,i=mt.structureCount(r[0]),n=1;n<r.length;n++){var o=mt.structureCount(r[n]);o<i&&(a=n,i=o)}t.throwIfTimedOut();var s=j_(function(c){return c.hashCode},Xe.areUnitIdsAndIndicesEqual);mt.forEach(r[a],function(c){return s.add(c)});for(var u=mt.UniqueBuilder(t.inputStructure),l=0;l<r.length;l++)l!==a&&(mt.forEach(r[l],function(c){s.has(c)&&u.add(c)}),t.throwIfTimedOut());return u.getSelection()}}var Ete=Object.freeze(Object.defineProperty({__proto__:null,merge:Pte,intersect:Tte},Symbol.toStringTag,{value:"Module"})),Lx;(function(e){function t(f){return!!f&&!!f.has}function r(f,p){return function(h){return f(h)===p}}e.eq=r;function n(f,p){return function(h){return f(h)<p}}e.lt=n;function a(f,p){return function(h){return f(h)<=p}}e.lte=a;function i(f,p){return function(h){return f(h)>p}}e.gt=i;function o(f,p){return function(h){return f(h)>=p}}e.gte=o;function s(f){return!0}function u(f){return!1}function l(f,p){if(t(p))return function(m){return p.has(f(m))};if(p.length===0)return u;for(var h=new Set,v=0;v<p.length;v++)h.add(p[v]);return function(m){return h.has(f(m))}}e.inSet=l;function c(){for(var f=[],p=0;p<arguments.length;p++)f[p]=arguments[p];switch(f.length){case 0:return s;case 1:return f[0];case 2:{var h=f[0],v=f[1];return function(Z){return h(Z)&&v(Z)}}case 3:{var m=f[0],g=f[1],y=f[2];return function(Z){return m(Z)&&g(Z)&&y(Z)}}case 4:{var b=f[0],x=f[1],S=f[2],_=f[3];return function(Z){return b(Z)&&x(Z)&&S(Z)&&_(Z)}}case 5:{var A=f[0],T=f[1],I=f[2],M=f[3],O=f[4];return function(Z){return A(Z)&&T(Z)&&I(Z)&&M(Z)&&O(Z)}}case 6:{var D=f[0],F=f[1],G=f[2],N=f[3],z=f[4],$=f[5];return function(Z){return D(Z)&&F(Z)&&G(Z)&&N(Z)&&z(Z)&&$(Z)}}default:{var j=f.length;return function(Z){for(var q=0;q<j;q++)if(!f[q])return!1;return!0}}}}e.and=c;function d(){for(var f=[],p=0;p<arguments.length;p++)f[p]=arguments[p];switch(f.length){case 0:return u;case 1:return f[0];case 2:{var h=f[0],v=f[1];return function(Z){return h(Z)||v(Z)}}case 3:{var m=f[0],g=f[1],y=f[2];return function(Z){return m(Z)||g(Z)||y(Z)}}case 4:{var b=f[0],x=f[1],S=f[2],_=f[3];return function(Z){return b(Z)||x(Z)||S(Z)||_(Z)}}case 5:{var A=f[0],T=f[1],I=f[2],M=f[3],O=f[4];return function(Z){return A(Z)||T(Z)||I(Z)||M(Z)||O(Z)}}case 6:{var D=f[0],F=f[1],G=f[2],N=f[3],z=f[4],$=f[5];return function(Z){return D(Z)||F(Z)||G(Z)||N(Z)||z(Z)||$(Z)}}default:{var j=f.length;return function(Z){for(var q=0;q<j;q++)if(f[q])return!0;return!1}}}}e.or=d})(Lx||(Lx={}));var Zr={generators:fee,filters:Ate,modifiers:dte,combinators:Ete,pred:Lx,internal:tee},Us;(function(e){function t(c,d){var f=this;return We.create("Build Assembly",function(p){return ce(f,void 0,void 0,function(){var h,v,m,g,y,b,x,S,_,A,T,I,M,O,D,F;return de(this,function(G){if(h=c.models,h.length!==1)throw new Error("Can only build assemblies from structures based on 1 model.");if(v=vv.findAssembly(h[0],d),!v)throw new Error("Assembly '"+d+"' is not defined.");for(m=dn.create(v.id,ue.identity(),{assembly:{id:v.id,operId:0,operList:[]}}),g=Xe.Builder({coordinateSystem:m,label:c.label}),y=new Qi(c),b=0,x=v.operatorGroups;b<x.length;b++)if(S=x[b],_=S.selector(y),mt.structureCount(_)!==0)for(A=mt.unionStructure(_).units,T=0,I=S.operators;T<I.length;T++)for(M=I[T],O=0,D=A;O<D.length;O++)F=D[O],g.addWithOperator(F,M);return[2,g.getStructure()]})})})}e.buildAssembly=t;function r(c,d,f){var p=this;return We.create("Build Symmetry Assembly",function(h){return ce(p,void 0,void 0,function(){var v,m,g,y,b,x,S,_,A,T,I,M,O,D,F,G,N,z,$,j,Z,q,te,he,W;return de(this,function(K){if(v=c.models,v.length!==1)throw new Error("Can only build symmetry assemblies from structures based on 1 model.");for(m=C(),g=Xe.Builder({label:c.label,representativeModel:v[0]}),y=new Qi(c),b=0,x=d;b<x.length;b++)if(S=x[b],_=Ite(S.asymIds),A=_(y),mt.structureCount(A)!==0)for(T=mt.unionStructure(A).units,I=0,M=S.operators;I<M.length;I++)for(O=M[I],D=O.index,F=O.shift,G=F[0],N=F[1],z=F[2],$=rO(f,D,G,N,z,m),j=0,Z=T;j<Z.length;j++)for(q=Z[j],te=0,he=$;te<he.length;te++)W=he[te],g.addWithOperator(q,W);return[2,g.getStructure()]})})})}e.buildSymmetryAssembly=r;function n(c,d){return We.create("Find Symmetry Mates",function(f){return Ote(f,c,d)})}e.builderSymmetryMates=n;function a(c,d,f){return We.create("Build Symmetry",function(p){return Rte(p,c,d,f)})}e.buildSymmetryRange=a;function i(c){return We.create("Build NCS",function(d){return Dte(d,c)})}e.buildNcs=i;function o(c,d){return c.invariantId===d.invariantId&&c.model.id===d.model.id&&Je.areEqual(c.elements,d.elements)}e.areUnitsEquivalent=o;function s(){return cG(ze.hashUnit,o)}e.UnitEquivalenceBuilder=s;function u(c){for(var d=s(),f=0,p=c.units;f<p.length;f++){var h=p[f];d.add(h.id,h)}for(var v=[],m=0,g=d.groups;m<g.length;m++){var y=g[m];v.push(ze.SymmetryGroup(y.map(function(b){return c.unitMap.get(b)})))}return v}e.computeTransformGroups=u;function l(c,d){if(c.length!==d.length)return!1;for(var f=0,p=c.length;f<p;++f){var h=c[f].units,v=d[f].units;if(h.length!==v.length||c[f].hashCode!==d[f].hashCode)return!1;for(var m=0,g=h.length;m<g;m++)if(h[m].conformation!==v[m].conformation)return!1}return!0}e.areTransformGroupsEquivalent=l})(Us||(Us={}));function Ite(e){return Zr.generators.atoms({chainTest:Zr.pred.and(Zr.pred.eq(function(t){return ct.unit.operator_name(t.element)},dn.DefaultName),Zr.pred.inSet(function(t){return ct.chain.label_asym_id(t.element)},e))})}function rO(e,t,r,n,a,i){var o=e.spacegroup,s=e.ncsOperators,u=[],l=o.cell.toFractional,c=C.transformMat4(C(),i,l),d=fs.getSymmetryOperatorRef(o,t,r,n,a,c);if(s&&s.length)for(var f=0,p=s.length;f<p;++f){var h=s[f],v=ue.mul(ue(),d.matrix,h.matrix),m=dn.create(d.name+" "+h.name,v,{assembly:d.assembly,ncsId:h.ncsId,hkl:d.hkl,spgrOp:d.spgrOp});u.push(m)}else u.push(d);return u}function nO(e,t,r,n){var a=e.spacegroup,i=e.ncsOperators,o=i&&i.length||0,s=[];!o&&t[0]<=0&&r[0]>=0&&t[1]<=0&&r[1]>=0&&t[2]<=0&&r[2]>=0&&(s[0]=fs.getSymmetryOperator(a,0,0,0,0));for(var u=a.cell.toFractional,l=C.transformMat4(C(),n,u),c=0;c<a.operators.length;c++)for(var d=t[0];d<=r[0];d++)for(var f=t[1];f<=r[1];f++)for(var p=t[2];p<=r[2];p++)!o&&c===0&&d===0&&f===0&&p===0||s.push.apply(s,rO(e,c,d,f,p,l));return s}function Mte(e,t){return e._operators_333&&C.equals(t,e._operators_333.ref)||(e._operators_333={ref:C.clone(t),operators:nO(e,C.create(-3,-3,-3),C.create(3,3,3),t)}),e._operators_333.operators}function aO(e,t){for(var r=Xe.Builder({label:e.label}),n=e.units,a=0,i=t;a<i.length;a++)for(var o=i[a],s=0,u=n;s<u.length;s++){var l=u[s];r.addWithOperator(l,o)}return r.getStructure()}function Dte(e,t){return ce(this,void 0,void 0,function(){var r,n,a;return de(this,function(i){if(r=t.models,r.length!==1)throw new Error("Can only build NCS from structures based on 1 model.");return n=qn.Provider.get(r[0]),n?(a=n.ncsOperators,!a||!a.length?[2,t]:[2,aO(t,a)]):[2,t]})})}function Rte(e,t,r,n){return ce(this,void 0,void 0,function(){var a,i,o,s,u;return de(this,function(l){if(a=t.models,a.length!==1)throw new Error("Can only build symmetries from structures based on 1 model.");return i=qn.Provider.get(a[0]),i?(o=i.spacegroup,Ei.isZero(o.cell)?[2,t]:(s=jt.getCenter(a[0]),u=nO(i,r,n,s),[2,aO(t,u)])):[2,t]})})}function Ote(e,t,r){return ce(this,void 0,void 0,function(){function n(M,O){return M.invariantId+"|"+O.name}var a,i,o,s,u,l,c,d,f,p,h,v,m,g,y,b,x,S,_,A,T,I;return de(this,function(M){switch(M.label){case 0:if(a=t.models,a.length!==1)throw new Error("Can only build symmetries from structures based on 1 model.");return i=qn.Provider.get(a[0]),i?(o=i.spacegroup,Ei.isZero(o.cell)?[2,t]:e.shouldUpdate?[4,e.update("Initialing...")]:[3,2]):[2,t];case 1:M.sent(),M.label=2;case 2:s=jt.getCenter(a[0]),u=Mte(i,s),l=t.lookup3d,c=new Set,d=Xe.Builder({label:t.label}),f=t.units,p=C.zero(),h=0,v=u,M.label=3;case 3:if(!(h<v.length))return[3,6];for(m=v[h],g=0,y=f;g<y.length;g++)for(b=y[g],x=b.lookup3d.boundary.sphere,C.transformMat4(p,x.center,m.matrix),S=l.findUnitIndices(p[0],p[1],p[2],x.radius+r),_=0,A=S.count;_<A;_++)T=f[S.indices[_]],T.lookup3d.check(p[0],p[1],p[2],x.radius+r)&&(I=n(b,m),c.has(I)||(d.addWithOperator(b,m),c.add(I)));return e.shouldUpdate?[4,e.update("Building symmetry...")]:[3,5];case 4:M.sent(),M.label=5;case 5:return h++,[3,3];case 6:return[2,d.getStructure()]}})})}var Fte=function(){function e(t,r){this.parent=t,this.isSorted=r,this.ids=[],this.unitMap=Eo.Mutable(),this.parentId=-1,this.currentUnit=[],this.elementCount=0}return e.prototype.addToUnit=function(t,r){var n=this.unitMap.get(t);n?n[n.length]=r:(this.unitMap.set(t,[r]),this.ids[this.ids.length]=t),this.elementCount++},e.prototype.beginUnit=function(t){this.parentId=t,this.currentUnit=this.currentUnit.length>0?[]:this.currentUnit},e.prototype.addElement=function(t){this.currentUnit[this.currentUnit.length]=t,this.elementCount++},e.prototype.addElementRange=function(t,r,n){for(var a=r;a<n;a++)this.currentUnit[this.currentUnit.length]=t[a],this.elementCount++},e.prototype.commitUnit=function(){this.currentUnit.length!==0&&(this.ids[this.ids.length]=this.parentId,this.unitMap.set(this.parentId,this.currentUnit),this.parentId=-1)},e.prototype.setUnit=function(t,r){this.ids[this.ids.length]=t,this.unitMap.set(t,r),this.elementCount+=r.length},e.prototype._getStructure=function(t){if(this.isEmpty)return Xe.Empty;var r=[];es(this.ids);for(var n=Us.UnitEquivalenceBuilder(),a=0,i=this.ids.length;a<i;a++){var o=this.ids[a],s=this.parent.unitMap.get(o),u=this.unitMap.get(o),l=!1;t&&(this.isSorted||es(u),u=Je.deduplicate(Je.ofSortedArray(this.currentUnit)),l=!0);var c=u.length;if(u.length===s.elements.length){r[r.length]=s,n.add(s.id,s);continue}!this.isSorted&&!l&&c>1&&es(u);var d=s.getChild(Je.ofSortedArray(u)),f=n.add(d.id,d);d!==f&&(d=f.applyOperator(d.id,d.conformation.operator,!0)),r[r.length]=d}return Xe.create(r,{parent:this.parent})},e.prototype.getStructure=function(){return this._getStructure(!1)},e.prototype.getStructureDeduplicate=function(){return this._getStructure(!0)},e.prototype.setSingletonLocation=function(t){var r=this.ids[0];t.unit=this.parent.unitMap.get(r),t.element=this.unitMap.get(r)[0]},Object.defineProperty(e.prototype,"isEmpty",{get:function(){return this.elementCount===0},enumerable:!1,configurable:!0}),e}();function pT(e,t){for(var r=1;t--;)r*=e--;return r}function kte(e,t){return t>e?0:pT(e,t)/pT(t,t)}function Bte(e){var t=e&-e,r=e+t,n=r&-r,a=(n/t>>1)-1;return r|a}var Lte=function(){function e(t,r){this.array=t,this.hasNext=!1,this.index=(1<<r)-1,this.size=kte(t.length,r),this.maxIndex=1<<t.length,this.value=new Array(r),this.hasNext=r>0&&r<=t.length}return e.prototype.move=function(){if(this.hasNext){for(var t=0,r=0,n=this.index;n;n>>>=1,t++)n&1&&(this.value[r++]=this.array[t]);this.index=Bte(this.index),this.hasNext=this.index<this.maxIndex}return this.value},e}();function iO(e,t){for(var r=[],n=new Lte(e,t);n.hasNext;)r.push(n.move().slice());return r}var Bc=[],Nte={links:Bc,terminalLinks:Bc,elements:Bc,partialElements:Bc,getElementIndices:function(){return Bc},getLinkIndices:function(){return Bc},getTerminalLinkIndices:function(){return Bc}},ra=Ep("C"),Eh=Ep("O"),Ute=[xo.elementFingerprint([ra,ra,ra,Eh]),xo.elementFingerprint([ra,ra,ra,ra,Eh]),xo.elementFingerprint([ra,ra,ra,ra,ra,Eh]),xo.elementFingerprint([ra,ra,ra,ra,ra,ra,Eh])];function zte(e,t){for(var r=-1,n=-1,a=-1,i=-1,o=e.elements,s=e.model.atomicHierarchy.atoms,u=s.type_symbol,l=s.label_atom_id,c=e.bonds,d=c.b,f=c.offset,p=0,h=t.length;p<h;++p){var v=o[t[p]];if(u.value(v)===ra){for(var m=0,g=0,y=f[t[p]],b=f[t[p]+1];y<b;++y){var x=o[d[y]],S=u.value(x);S===Eh?++m:S===ra&&++g}if(m===2){r=v;break}else m===1&&g===1?n=v:l.value(v).startsWith("C1")?a=v:i=v}}return r!==-1?r:n!==-1?n:a!==-1?a:i!==-1?i:o[t[0]]}function Vte(e,t){var r=e.elements,n=e.model.atomicHierarchy.atoms.label_alt_id;return n.value(r[t])}function Hte(e,t,r,n){var a=t.conformation.position;return C.normalize(e,C.sub(e,n,a(r,e))),e}function hT(e,t){var r=e.elements,n=e.model.atomicHierarchy.atoms.label_atom_id;return n.value(r[t])}function Gte(e,t){if(!(!t||!t.length)){for(var r=e.unit,n=e.all,a=new Set,i=iO(Mo(new Array(t.length)),2),o=0,s=i.length;o<s;++o){var u=i[o],l=n[t[u[0]]],c=n[t[u[1]]];Je.areIntersecting(l,c)&&xo.getAltId(r,l)===xo.getAltId(r,c)&&(a.add(t[u[0]]),a.add(t[u[1]]))}if(a.size){for(var d=[],o=0,s=t.length;o<s;++o)a.has(t[o])||d.push(t[o]);return d}else return t}}function qte(e,t){return t.properties.saccharideComponentMap.get(e)}function jte(e){if(e.models.reduce(function(be,Ae){return be+Ae.properties.saccharideComponentMap.size},0)===0)return Nte;var t=[],r=[],n=[],a=[],i=new Map;function o(be,Ae,xe){return be+"|"+Ae+"|"+xe}function s(be,Ae){i.has(be)?i.get(be).push(Ae):i.set(be,[Ae])}function u(be,Ae){C.sub(n[be].geometry.direction,n[Ae].geometry.center,n[be].geometry.center),C.normalize(n[be].geometry.direction,n[be].geometry.direction)}var l=C.zero();function c(be,Ae,xe){var ae=xe.conformation.position,oe=n[be].geometry;C.sub(oe.direction,ae(xe.elements[Ae],l),oe.center),C.normalize(oe.direction,oe.direction)}for(var d=0,f=e.units.length;d<f;++d){var p=e.units[d];if(!!ze.isAtomic(p))for(var h=p.model,v=p.rings,m=h.atomicHierarchy,g=m.chainAtomSegments,y=m.residueAtomSegments,b=m.atoms,x=b.label_comp_id,S=nr.transientSegments(g,p.elements),_=nr.transientSegments(y,p.elements),A=void 0;S.hasNext;)for(_.setSegment(S.move());_.hasNext;){var T=_.move().index,I=qte(x.value(y.offsets[T]),h);if(!!I){A||(A=yg.byFingerprintAndResidue(v,Ute));var M=Gte(v,A.get(T));if(!M||!M.length){a.push({unit:p,residueIndex:T,component:I});continue}for(var O=[],D=0,F=M.length;D<F;++D){var G=v.all[M[D]],N=zte(p,G),z=Fd.calculateMomentsAxes(x6(p,G)),$=C.copy(C.zero(),z.origin),j=C.copy(C.zero(),z.dirC),Z=Hte(C.zero(),p,N,$);C.orthogonalize(Z,j,Z);var q=xo.getAltId(p,G),te=n.length;O.push(te),s(o(T,p.id,q),te),q&&s(o(T,p.id,""),te),n.push({geometry:{center:$,normal:j,direction:Z},component:I,ringIndex:M[D],altId:q,unit:p,residueIndex:T})}for(var he=iO(Mo(new Array(M.length)),2),D=0,F=he.length;D<F;++D){var W=he[D],K=v.all[M[W[0]]],U=v.all[M[W[1]]];if(Ti.areVertexSetsConnected(p.bonds,K,U,3)){var H=O[W[0]],J=O[W[1]];n[H].altId===n[J].altId&&(u(H,J),u(J,H),t.push({carbohydrateIndexA:H,carbohydrateIndexB:J}),t.push({carbohydrateIndexA:J,carbohydrateIndexB:H}))}}}}}function X(be,Ae){return i.get(o(be.getResidueIndex(Ae),be.id,Vte(be,Ae)))||[]}for(var d=0,f=n.length;d<f;++d)for(var Q=n[d],p=Q.unit,D=d+1;D<f;++D){var ee=n[D];if(!(p!==ee.unit||Q.residueIndex===ee.residueIndex)){var le=p.rings.all[Q.ringIndex],ye=p.rings.all[ee.ringIndex];Ti.areVertexSetsConnected(p.bonds,le,ye,3)&&(u(d,D),u(D,d),t.push({carbohydrateIndexA:d,carbohydrateIndexB:D}),t.push({carbohydrateIndexA:D,carbohydrateIndexB:d}))}}for(var d=0,f=e.units.length;d<f;++d){var p=e.units[d];!ze.isAtomic(p)||e.interUnitBonds.getConnectedUnits(p.id).forEach(function(ae){ae.connectedIndices.forEach(function(oe){ae.getEdges(oe).forEach(function(R){var V=R.props,pe=R.indexB;if(!!kr.isCovalent(V.flag)){var _e=e.unitMap.get(ae.unitA),Ee=e.unitMap.get(ae.unitB),Ve=X(_e,oe),He=X(Ee,pe);if(Ve.length>0&&He.length>0)for(var Ye=Ve.length,lt=He.length,Le=0,Qe=Math.max(Ye,lt);Le<Qe;++Le){var at=Ve[Math.min(Le,Ye-1)],ot=He[Math.min(Le,lt-1)],dt=hT(_e,oe);(dt.startsWith("O1")||dt.startsWith("C1"))&&u(at,ot),t.push({carbohydrateIndexA:at,carbohydrateIndexB:ot})}else if(He.length===0)for(var Oe=0,Me=Ve;Oe<Me.length;Oe++){var at=Me[Oe],dt=hT(_e,oe);(dt.startsWith("O1")||dt.startsWith("C1"))&&c(at,pe,Ee),r.push({carbohydrateIndex:at,elementIndex:pe,elementUnit:Ee,fromCarbohydrate:!0})}else if(Ve.length===0)for(var Ke=0,tt=He;Ke<tt.length;Ke++){var ot=tt[Ke];r.push({carbohydrateIndex:ot,elementIndex:oe,elementUnit:_e,fromCarbohydrate:!1})}}})})})}return w({links:t,terminalLinks:r,elements:n,partialElements:a},Wte(n,t,r))}function Wte(e,t,r){function n(F,G){return oc(F.id,G)}function a(F,G,N){var z=[],$=F.get(n(G,N));if($!==void 0)for(var j=0,Z=$;j<Z.length;j++){var q=Z[j];Xa(z,q)}return z}for(var i=new Map,o=0,s=e.length;o<s;++o)for(var u=e[o],l=u.unit,c=u.ringIndex,d=l.rings.all[c],f=0,p=d.length;f<p;++f){var h=n(l,l.elements[d[f]]),v=i.get(h);v===void 0?i.set(h,[o]):v.push(o)}function m(F,G){return a(i,F,G)}for(var g=new Map,o=0,s=t.length;o<s;++o)for(var y=t[o],b=e[y.carbohydrateIndexA],l=b.unit,c=b.ringIndex,d=l.rings.all[c],f=0,p=d.length;f<p;++f){var h=n(l,l.elements[d[f]]),v=g.get(h);v===void 0?g.set(h,[o]):v.push(o)}function x(F,G){return a(g,F,G)}for(var S=new Map,o=0,s=r.length;o<s;++o){var _=r[o],A=_.fromCarbohydrate,T=_.carbohydrateIndex,I=_.elementUnit,M=_.elementIndex;if(A)for(var O=e[T],l=O.unit,c=O.ringIndex,d=l.rings.all[c],f=0,p=d.length;f<p;++f){var h=n(l,l.elements[d[f]]),v=S.get(h);v===void 0?S.set(h,[o]):v.push(o)}else{var h=n(I,I.elements[M]),v=S.get(h);v===void 0?S.set(h,[o]):v.push(o)}}function D(F,G){return a(S,F,G)}return{getElementIndices:m,getLinkIndices:x,getTerminalLinkIndices:D}}var Im=Ne(),Xte=new eo("14"),Yte=new eo("98");function Kte(e){return e>500?Xte:Yte}function $te(e){var t=e.units,r=Kte(t.length);r.reset();for(var n=0,a=t.length;n<a;n++){var i=t[n],o=i.boundary,s=i.conformation.operator;s.isIdentity?r.includeSphere(o.sphere):(Ne.transform(Im,o.sphere,s.matrix),r.includeSphere(Im))}r.finishedIncludeStep();for(var n=0,a=t.length;n<a;n++){var i=t[n],o=i.boundary,s=i.conformation.operator;s.isIdentity?r.radiusSphere(o.sphere):(Ne.transform(Im,o.sphere,s.matrix),r.radiusSphere(Im))}return{box:r.getBox(),sphere:r.getSphere()}}var Xe=function(){function e(t,r,n,a,i){this.units=t,this.unitMap=r,this.unitIndexMap=n,this.state=a,this._child=i==null?void 0:i.child,this._target=i==null?void 0:i.target}return e.prototype.subsetBuilder=function(t){return new Fte(this,t)},Object.defineProperty(e.prototype,"elementCount",{get:function(){return this.state.elementCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bondCount",{get:function(){return this.state.bondCount===-1&&(this.state.bondCount=this.interUnitBonds.edgeCount+Ht.getIntraUnitBondCount(this)),this.state.bondCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasCustomProperties",{get:function(){return!!this.state.customProps&&this.state.customProps.all.length>0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"customPropertyDescriptors",{get:function(){return this.state.customProps||(this.state.customProps=new Ks),this.state.customProps},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentPropertyData",{get:function(){return this.state.propertyData||(this.state.propertyData=Object.create(null)),this.state.propertyData},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"inheritedPropertyData",{get:function(){return this.parent?this.parent.currentPropertyData:this.currentPropertyData},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"polymerResidueCount",{get:function(){return this.state.polymerResidueCount===-1&&(this.state.polymerResidueCount=are(this)),this.state.polymerResidueCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"polymerGapCount",{get:function(){return this.state.polymerGapCount===-1&&(this.state.polymerGapCount=ire(this)),this.state.polymerGapCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"polymerUnitCount",{get:function(){return this.state.polymerUnitCount===-1&&(this.state.polymerUnitCount=ore(this)),this.state.polymerUnitCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"uniqueElementCount",{get:function(){return this.state.uniqueElementCount===-1&&(this.state.uniqueElementCount=nre(this)),this.state.uniqueElementCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"atomicResidueCount",{get:function(){return this.state.atomicResidueCount===-1&&(this.state.atomicResidueCount=sre(this)),this.state.atomicResidueCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isCoarseGrained",{get:function(){return this.models.some(function(t){return jt.isCoarseGrained(t)})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isEmpty",{get:function(){return this.units.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hashCode",{get:function(){return this.state.hashCode!==-1?this.state.hashCode:this.computeHash()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"transformHash",{get:function(){return this.state.transformHash!==-1?this.state.transformHash:(this.state.transformHash=Ja(this.units.map(function(t){return t.id})),this.state.transformHash)},enumerable:!1,configurable:!0}),e.prototype.computeHash=function(){for(var t=23,r=0,n=this.units.length;r<n;r++){var a=this.units[r];t=31*t+a.id|0,t=31*t+Je.hashCode(a.elements)|0}return t=31*t+this.elementCount|0,t=aR(t),t===-1&&(t=0),this.state.hashCode=t,t},e.prototype.elementLocations=function(){return new e.ElementLocationIterator(this)},Object.defineProperty(e.prototype,"root",{get:function(){return this.state.parent||this},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return this.state.parent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"coordinateSystem",{get:function(){return this.state.coordinateSystem},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"label",{get:function(){return this.state.label},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"boundary",{get:function(){return this.state.boundary?this.state.boundary:(this.state.boundary=$te(this),this.state.boundary)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lookup3d",{get:function(){return this.state.lookup3d?this.state.lookup3d:(this.state.lookup3d=new YJ(this),this.state.lookup3d)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"interUnitBonds",{get:function(){return this.state.interUnitBonds?this.state.interUnitBonds:(this.state.interUnitBonds=mJ(this),this.state.interUnitBonds)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"unitSymmetryGroups",{get:function(){return this.state.unitSymmetryGroups?this.state.unitSymmetryGroups:(this.state.unitSymmetryGroups=Us.computeTransformGroups(this),this.state.unitSymmetryGroups)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"unitSymmetryGroupsIndexMap",{get:function(){return this.state.unitSymmetryGroupsIndexMap?this.state.unitSymmetryGroupsIndexMap:(this.state.unitSymmetryGroupsIndexMap=ze.SymmetryGroup.getUnitSymmetryGroupsIndexMap(this.unitSymmetryGroups),this.state.unitSymmetryGroupsIndexMap)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"carbohydrates",{get:function(){return this.state.carbohydrates?this.state.carbohydrates:(this.state.carbohydrates=jte(this),this.state.carbohydrates)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"models",{get:function(){return this.state.models?this.state.models:(this.state.models=Zte(this),this.state.models)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"uniqueResidueNames",{get:function(){return this.state.uniqueResidueNames||(this.state.uniqueResidueNames=Jte(this))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"uniqueElementSymbols",{get:function(){return this.state.uniqueElementSymbols||(this.state.uniqueElementSymbols=ere(this))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"entityIndices",{get:function(){return this.state.entityIndices||(this.state.entityIndices=tre(this))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"uniqueAtomicResidueIndices",{get:function(){return this.state.uniqueAtomicResidueIndices||(this.state.uniqueAtomicResidueIndices=rre(this))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isAtomic",{get:function(){for(var t=0,r=this.units;t<r.length;t++){var n=r[t];if(!ze.isAtomic(n))return!1}return!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasAtomic",{get:function(){for(var t=0,r=this.units;t<r.length;t++){var n=r[t];if(ze.isAtomic(n))return!0}return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isCoarse",{get:function(){for(var t=0,r=this.units;t<r.length;t++){var n=r[t];if(!ze.isCoarse(n))return!1}return!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasCoarse",{get:function(){for(var t=0,r=this.units;t<r.length;t++){var n=r[t];if(ze.isCoarse(n))return!0}return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"serialMapping",{get:function(){return this.state.serialMapping||(this.state.serialMapping=ure(this))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"model",{get:function(){if(this.state.model)return this.state.model;if(this.state.representativeModel)return this.state.representativeModel;if(this.state.masterModel)return this.state.masterModel;var t=this.models;if(t.length>1)throw new Error("The structure is based on multiple models and has neither a master- nor a representative-model.");return this.state.model=t[0],this.state.model},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"masterModel",{get:function(){return this.state.masterModel},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"representativeModel",{get:function(){return this.state.representativeModel},enumerable:!1,configurable:!0}),e.prototype.hasElement=function(t){return this.unitMap.has(t.unit.id)?Je.has(this.unitMap.get(t.unit.id).elements,t.element):!1},e.prototype.getModelIndex=function(t){return this.models.indexOf(t)},e.prototype.remapModel=function(t){for(var r=[],n=0,a=this.unitSymmetryGroups;n<a.length;n++){var i=a[n],o=i.units[0].remapModel(t);r.push(o);for(var s=1,u=i.units.length;s<u;++s){var l=i.units[s];r.push(l.remapModel(t,o.props))}}return e.create(r,{label:this.label,interUnitBonds:this.state.interUnitBonds})},e.prototype.asParent=function(){return this._proxy?this._proxy:(this._proxy=this.parent?new e(this.parent.units,this.parent.unitMap,this.parent.unitIndexMap,this.parent.state,{child:this,target:this.parent}):this,this._proxy)},Object.defineProperty(e.prototype,"child",{get:function(){return this._child},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){var t;return(t=this._target)!==null&&t!==void 0?t:this},enumerable:!1,configurable:!0}),e}();function Qte(e,t,r){return e[t].id-e[r].id}function Zte(e){for(var t=e.units,r=$r.create(),n=0,a=t;n<a.length;n++){var i=a[n];$r.add(r,i.model.id,i.model)}return r.array}function Jte(e){for(var t=ct.residue.microheterogeneityCompIds,r=new Set,n=Ze.create(e),a=0,i=e.unitSymmetryGroups;a<i.length;a++){var o=i[a],s=o.units[0];if(!!ze.isAtomic(s)){var u=nr.transientSegments(s.model.atomicHierarchy.residueAtomSegments,s.elements);for(n.unit=s;u.hasNext;){var l=u.move();n.element=s.elements[l.start];for(var c=t(n),d=0,f=c;d<f.length;d++){var p=f[d];r.add(p)}}}}return r}function ere(e){for(var t=ct.atom.type_symbol,r=new Set,n=Ze.create(e),a=0,i=e.unitSymmetryGroups;a<i.length;a++){var o=i[a],s=o.units[0];if(!!ze.isAtomic(s)){n.unit=s;for(var u=0,l=s.elements.length;u<l;++u)n.element=s.elements[u],r.add(t(n))}}return r}function tre(e){for(var t=e.units,r=Ze.create(e),n=$r.create(),a=0,i=t;a<i.length;a++){var o=i[a],s=o.kind===0?ct.entity.key:ct.coarse.entityKey;r.unit=o;for(var u=o.elements,l=nr.transientSegments(o.model.atomicHierarchy.chainAtomSegments,u);l.hasNext;){var c=l.move();r.element=u[c.start];var d=s(r);$r.add(n,d,d)}}return es(n.array),n.array}function rre(e){for(var t=new Map,r=[],n=e.unitSymmetryGroups,a=0,i=n;a<i.length;a++){var o=i[a],s=o.units[0];if(!!ze.isAtomic(s)){var u=void 0;t.has(s.model.id)?u=t.get(s.model.id):(u=$r.create(),r.push(s.model.id),t.set(s.model.id,u));for(var l=nr.transientSegments(s.model.atomicHierarchy.residueAtomSegments,s.elements);l.hasNext;){var c=l.move();$r.add(u,c.index,c.index)}}}for(var d=new Map,f=0,p=r;f<p.length;f++){var h=p[f],v=t.get(h).array;es(v),d.set(h,v)}return d}function nre(e){for(var t=e.unitSymmetryGroups,r=0,n=0,a=t.length;n<a;n++)r+=t[n].elements.length;return r}function are(e){for(var t=e.units,r=0,n=0,a=t.length;n<a;n++)r+=t[n].polymerElements.length;return r}function ire(e){for(var t=e.units,r=0,n=0,a=t.length;n<a;n++)r+=t[n].gapElements.length/2;return r}function ore(e){for(var t=e.units,r=0,n=0,a=t.length;n<a;n++)t[n].polymerElements.length>0&&(r+=1);return r}function sre(e){for(var t=e.units,r=0,n=0,a=t.length;n<a;n++){var i=t[n];if(!!ze.isAtomic(i))for(var o=i.elements,s=i.residueIndex,u=-1,l=-1,c=0,d=o.length;c<d;++c)u=s[o[c]],u!==l&&(r+=1,l=u)}return r}function ure(e){for(var t=e.units,r=e.elementCount,n=e.unitIndexMap,a=new Uint32Array(t.length),i=new Uint32Array(r),o=new Uint32Array(r),s=0,u=0,l=t.length;s<l;++s){a[s]=u;for(var c=t[s].elements,d=0,f=c.length;d<f;++d){var p=u+d;i[p]=s,o[p]=c[d]}u+=c.length}return{cumulativeUnitElementCount:a,unitIndices:i,elementIndices:o,getSerialIndex:function(h,v){return a[n.get(h.id)]+ke.indexOf(h.elements,v)}}}(function(e){e.Empty=u([]);function t(U){return{kind:"structure-loci",structure:U}}e.Loci=t;function r(U){for(var H=[],J=0,X=U.units;J<X.length;J++){var Q=X[J];H.push({unit:Q,indices:Ie.ofBounds(0,Q.elements.length)})}return Re(U,H)}e.toStructureElementLoci=r;function n(U,H){return mt.toLociWithSourceUnits(mt.Singletons(U,H))}e.toSubStructureElementLoci=n;function a(U){return!!U&&U.kind==="structure-loci"}e.isLoci=a;function i(U,H){return U.structure===H.structure}e.areLociEqual=i;function o(U){return U.structure.isEmpty}e.isLociEmpty=o;function s(U,H){return H===U.structure?U:t(H)}e.remapLoci=s;function u(U,H){H===void 0&&(H={});for(var J=Eo.Mutable(),X=Eo.Mutable(),Q=0,ee=!0,le=U.length>0?U[0].id:0,ye=0,be=U.length;ye<be;ye++){var Ae=U[ye];J.set(Ae.id,Ae),Q+=Ae.elements.length,Ae.id<le&&(ee=!1),le=Ae.id}ee||nR(U,0,U.length,Qte,ld);for(var ye=0,be=U.length;ye<be;ye++)X.set(U[ye].id,ye);var xe={hashCode:-1,transformHash:-1,elementCount:Q,bondCount:-1,uniqueElementCount:-1,atomicResidueCount:-1,polymerResidueCount:-1,polymerGapCount:-1,polymerUnitCount:-1,coordinateSystem:dn.Default,label:""};return H.parent&&(xe.parent=H.parent.parent||H.parent),H.interUnitBonds&&(xe.interUnitBonds=H.interUnitBonds),H.coordinateSystem?xe.coordinateSystem=H.coordinateSystem:H.parent&&(xe.coordinateSystem=H.parent.coordinateSystem),H.label?xe.label=H.label:H.parent&&(xe.label=H.parent.label),H.masterModel?xe.masterModel=H.masterModel:H.parent&&(xe.masterModel=H.parent.masterModel),H.representativeModel?xe.representativeModel=H.representativeModel:H.parent&&(xe.representativeModel=H.parent.representativeModel),new e(U,J,X,xe)}e.create=u;function l(U,H){return ce(this,void 0,void 0,function(){var J,X,Q,ee,le,ye,be,Ae,xe,ae,oe,R,V;return de(this,function(pe){switch(pe.label){case 0:if(U.frameCount===0)return[2,e.Empty];J=[],X=void 0,Q=0,ee=0,le=U.frameCount,pe.label=1;case 1:return ee<le?[4,We.resolveInContext(U.getFrameAtIndex(ee),H)]:[3,4];case 2:for(ye=pe.sent(),X||(X=ye),be=c(ye),Ae=0,xe=be.units.length;Ae<xe;++Ae)ae=be.units[Ae],oe=ae.invariantId+Q,R=ae.chainGroupId+Q,V=ze.create(J.length,oe,R,ae.traits,ae.kind,ae.model,ae.conformation.operator,ae.elements),J.push(V);Q=J.length,pe.label=3;case 3:return++ee,[3,1];case 4:return[2,u(J,{representativeModel:X,label:X.label})]}})})}e.ofTrajectory=l;function c(U){for(var H=U.atomicHierarchy.chainAtomSegments,J=U.atomicHierarchy.index,X=U.atomicHierarchy.chains.auth_asym_id,Q=U.atomicChainOperatorMappinng,ee=new h({label:U.label}),le=0;le<H.count;le++){var ye=Q.get(le)||dn.Default,be=H.offsets[le];Dd.chainResidueCount(U.atomicHierarchy,le),H.offsets[le+1]-H.offsets[le];var Ae=!1;if(d(U,le))for(;le+1<H.count&&d(U,le+1);){var xe=Q.get(le),ae=Q.get(le+1);if(xe!==ae)break;Ae=!0,le++}else for(;le+1<H.count&&H.offsets[le+1]-H.offsets[le]===1&&H.offsets[le+2]-H.offsets[le+1]===1;){var oe=J.getEntityFromChain(le),R=J.getEntityFromChain(le+1);if(oe!==R)break;var V=X.value(le),pe=X.value(le+1);if(V!==pe)break;var xe=Q.get(le),ae=Q.get(le+1);if(xe!==ae)break;Ae=!0,le++}var _e=Je.ofBounds(be,H.offsets[le+1]);ee.addUnit(0,U,ye,_e,Ae?1:0)}var Ee=U.coarseHierarchy;return Ee.isDefined&&(Ee.spheres.count>0&&f(ee,U,U.coarseHierarchy.spheres,1),Ee.gaussians.count>0&&f(ee,U,U.coarseHierarchy.gaussians,2)),ee.getStructure()}e.ofModel=c;function d(U,H){var J=U.atomicHierarchy.index.getEntityFromChain(H);return U.entities.data.type.value(J)==="water"}function f(U,H,J,X){for(var Q=J.chainElementSegments,ee=0;ee<Q.count;ee++){var le=Je.ofBounds(Q.offsets[ee],Q.offsets[ee+1]);U.addUnit(X,H,dn.Default,le,0)}}function p(U,H){if(ue.isIdentity(H))return U;if(!ue.isRotationAndTranslation(H,dn.RotationTranslationEpsilon))throw new Error("Only rotation/translation combination can be applied.");for(var J=[],X=0,Q=U.units;X<Q.length;X++){var ee=Q[X],le=ee.conformation.operator,ye=dn.create(le.name,H,le);J.push(ee.applyOperator(ee.id,ye))}var be=U.coordinateSystem,Ae=dn.compose(dn.create(be.name,H,be),be);return u(J,{parent:U,coordinateSystem:Ae})}e.transform=p;var h=function(){function U(H){H===void 0&&(H={}),this.props=H,this.units=[],this.invariantId=ti(),this.chainGroupId=-1,this.inChainGroup=!1,this.p=C(),this.singleElementUnits=new Map}return U.prototype.beginChainGroup=function(){this.chainGroupId++,this.inChainGroup=!0},U.prototype.endChainGroup=function(){this.inChainGroup=!1},U.prototype.addUnit=function(H,J,X,Q,ee,le){le===void 0&&(le=this.invariantId());var ye=this.inChainGroup?this.chainGroupId:++this.chainGroupId,be=ze.create(this.units.length,le,ye,ee,H,J,X,Q);return this.add(be)},U.prototype.add=function(H){if(H.elements.length===1){H.conformation.position(H.elements[0],this.p);var J=[H.invariantId,this.p[0],this.p[1],this.p[2]].join("|");if(this.singleElementUnits.has(J))return this.singleElementUnits.get(J);this.singleElementUnits.set(J,H)}return this.units.push(H),H},U.prototype.addWithOperator=function(H,J,X){return X===void 0&&(X=!1),this.add(H.applyOperator(this.units.length,J,X))},U.prototype.getStructure=function(){return u(this.units,this.props)},Object.defineProperty(U.prototype,"isEmpty",{get:function(){return this.units.length===0},enumerable:!1,configurable:!0}),U}();e.StructureBuilder=h;function v(U){return U===void 0&&(U={}),new h(U)}e.Builder=v;function m(U){return U.hashCode}e.hashCode=m;function g(U){return A_(U.units.map(function(H){return ze.conformationId(H)}).join("|"))}e.conformationHash=g;function y(U,H){if(U===H)return!0;if(U.elementCount!==H.elementCount)return!1;var J=U.units.length;if(J!==H.units.length)return!1;for(var X=0;X<J;X++)if(U.units[X].id!==H.units[X].id)return!1;return!0}e.areUnitIdsEqual=y;function b(U,H){if(!y(U,H))return!1;for(var J=0,X=U.units.length;J<X;J++)if(!Je.areEqual(U.units[J].elements,H.units[J].elements))return!1;return!0}e.areUnitIdsAndIndicesEqual=b;function x(U,H){if(U.hashCode!==H.hashCode)return!1;var J=U.models.length;if(J!==H.models.length)return!1;for(var X=0;X<J;X++)if(!jt.areHierarchiesEqual(U.models[X],H.models[X]))return!1;return!0}e.areHierarchiesEqual=x;function S(U,H){return U===H||U.hashCode===H.hashCode&&Us.areTransformGroupsEquivalent(U.unitSymmetryGroups,H.unitSymmetryGroups)}e.areEquivalent=S;function _(U,H){return S(U.root,H.root)}e.areRootsEquivalent=_;function A(U,H){return U.root===H.root}e.areRootsEqual=A;var T=function(){function U(H){this.structure=H,this.unitIndex=0,this.maxIdx=0,this.idx=-1,this.current=Ze.create(H),this.hasNext=H.elementCount>0,this.hasNext&&(this.elements=H.units[0].elements,this.maxIdx=this.elements.length-1,this.current.unit=H.units[0])}return U.prototype.move=function(){return this.advance(),this.current.element=this.elements[this.idx],this.current},U.prototype.advance=function(){if(this.idx<this.maxIdx){this.idx++,this.idx===this.maxIdx&&(this.hasNext=this.unitIndex+1<this.structure.units.length);return}if(this.idx=0,this.unitIndex++,this.unitIndex>=this.structure.units.length){this.hasNext=!1;return}this.current.unit=this.structure.units[this.unitIndex],this.elements=this.current.unit.elements,this.maxIdx=this.elements.length-1,this.maxIdx===0&&(this.hasNext=this.unitIndex+1<this.structure.units.length)},U}();e.ElementLocationIterator=T;var I=C();function M(U,H,J){for(var X=U.elements,Q=U.conformation,ee=Q.position,le=Q.r,ye=I,be=Number.MAX_VALUE,Ae=0,xe=X.length;Ae<xe;Ae++){var ae=X[Ae],oe=C.distance(H,ee(ae,ye))-J-le(ae);oe<be&&(be=oe)}return be}function O(U,H,J){for(var X=U.units,Q=Number.MAX_VALUE,ee=0,le=X.length;ee<le;ee++){var ye=X[ee],be=M(ye,H,J);be<Q&&(Q=be)}return Q}e.minDistanceToPoint=O;var D=C();function F(U,H){if(U.elementCount===0||H.elementCount===0)return 0;for(var J=U.units,X=Number.MAX_VALUE,Q=0,ee=J.length;Q<ee;Q++)for(var le=J[Q],ye=le.elements,be=le.conformation,Ae=be.position,xe=be.r,ae=0,oe=ye.length;ae<oe;ae++){var R=ye[ae],V=O(H,Ae(R,D),xe(R));V<X&&(X=V)}return X}e.distance=F;function G(U){return U.elementCount===1?"1 element":U.elementCount+" elements"}e.elementDescription=G;function N(U,H,J){return U.masterModel?H.model===J.model||H.model===U.masterModel||J.model===U.masterModel:H.model===J.model}e.validUnitPair=N;function z(U,H,J){var X=J.maxRadius,Q=J.validUnit,ee=J.validUnitPair;if(!!U.units.some(function(pe){return Q(pe)}))for(var le=U.lookup3d,ye=C(),be=0,Ae=U.units;be<Ae.length;be++){var xe=Ae[be];if(!!Q(xe)){var ae=xe.boundary.sphere;C.transformMat4(ye,ae.center,xe.conformation.operator.matrix);for(var oe=le.findUnitIndices(ye[0],ye[1],ye[2],ae.radius+X),R=0;R<oe.count;R++){var V=U.units[oe.indices[R]];!Q(V)||xe.id>=V.id||!ee(xe,V)||(V.elements.length>=xe.elements.length?H(xe,V):H(V,xe))}}}}e.eachUnitPair=z;function $(U,H){for(var J=H.chain,X=H.residue,Q=H.atom,ee=Ze.create(U),le=0,ye=U.units;le<ye.length;le++){var be=ye[le];if(be.kind===0){ee.unit=be;for(var Ae=be.elements,xe=nr.transientSegments(be.model.atomicHierarchy.chainAtomSegments,Ae),ae=nr.transientSegments(be.model.atomicHierarchy.residueAtomSegments,Ae);xe.hasNext;){var oe=xe.move();if(J&&(ee.element=Ae[oe.start],J(ee)),!(!X&&!Q))for(ae.setSegment(oe);ae.hasNext;){var R=ae.move();if(X&&(ee.element=Ae[R.start],X(ee)),!!Q)for(var V=R.start,pe=R.end;V<pe;V++)ee.element=Ae[V],Q(ee)}}}}}e.eachAtomicHierarchyElement=$,e.DefaultSizeThresholds={smallResidueCount:10,mediumResidueCount:5e3,largeResidueCount:3e4,highSymmetryUnitCount:10,fiberResidueCount:15};function j(U){return U.unitSymmetryGroups.filter(function(H){return H.units[0].polymerElements.length>0})}function Z(U,H){var J=j(U);return J.length===1&&J[0].units.length>2&&J[0].units[0].polymerElements.length<H.fiberResidueCount}function q(U,H){var J=j(U);return J.length>=1&&J[0].units.length>H.highSymmetryUnitCount}var te;(function(U){U[U.Small=0]="Small",U[U.Medium=1]="Medium",U[U.Large=2]="Large",U[U.Huge=3]="Huge",U[U.Gigantic=4]="Gigantic"})(te=e.Size||(e.Size={}));function he(U,H,J){H===void 0&&(H={}),J===void 0&&(J=1);var X=w(w({},e.DefaultSizeThresholds),H);return U.polymerResidueCount>=X.largeResidueCount*J?q(U,X)?te.Huge:te.Gigantic:Z(U,X)||U.polymerResidueCount<X.smallResidueCount*J?te.Small:U.polymerResidueCount<X.mediumResidueCount*J?te.Medium:te.Large}e.getSize=he,e.Index=yc.createSimple("index","root");var W="__PrincipalAxes__";function K(U){if(U.currentPropertyData[W])return U.currentPropertyData[W];var H=Re.getPrincipalAxes(e.toStructureElementLoci(U));return U.currentPropertyData[W]=H,H}e.getPrincipalAxes=K})(Xe||(Xe={}));var lre=ke.size;function Re(e,t){return{kind:"element-loci",structure:e,elements:t}}(function(e){function t(H){return!!H&&H.kind==="element-loci"}e.is=t;function r(H,J){if(H.structure!==J.structure||H.elements.length!==J.elements.length)return!1;for(var X=0,Q=H.elements.length;X<Q;++X){var ee=H.elements[X],le=J.elements[X];if(ee.unit.id!==le.unit.id||!ke.areEqual(ee.indices,le.indices))return!1}return!0}e.areEqual=r;function n(H){return i(H)===0}e.isEmpty=n;function a(H){return i(H)===H.structure.elementCount}e.isWholeStructure=a;function i(H){for(var J=0,X=0,Q=H.elements;X<Q.length;X++){var ee=Q[X];J+=lre(ee.indices)}return J}e.size=i;function o(H){return e(H,H.units.map(function(J){return{unit:J,indices:ke.ofBounds(0,J.elements.length)}}))}e.all=o;function s(H){return e(H,[])}e.none=s;function u(H,J){if(!n(H)){var X=H.elements[0].unit,Q=X.elements[ke.getAt(H.elements[0].indices,0)];return J?(J.structure=H.structure,J.unit=H.elements[0].unit,J.element=Q,J):Ze.create(H.structure,X,Q)}}e.getFirstLocation=u;function l(H){return n(H)?H:e(H.structure,[{unit:H.elements[0].unit,indices:ke.ofSingleton(ke.start(H.elements[0].indices))}])}e.firstElement=l;function c(H){return n(H)?H:b(l(H))}e.firstResidue=c;function d(H){return n(H)?H:I(l(H))}e.firstChain=d;function f(H){for(var J=[],X=function(ye){var be=ye.unit,Ae=ye.indices,xe=new Int32Array(ke.size(Ae));ke.forEach(Ae,function(ae,oe){return xe[oe]=be.elements[ae]}),J.push(be.getChild(Je.ofSortedArray(xe)))},Q=0,ee=H.elements;Q<ee.length;Q++){var le=ee[Q];X(le)}return Xe.create(J,{parent:H.structure.parent})}e.toStructure=f;function p(H,J){if(J===H.structure)return H;var X=[];return H.elements.forEach(function(Q){if(!!J.unitMap.has(Q.unit.id)){var ee=J.unitMap.get(Q.unit.id),le=ke.indexedIntersect(Q.indices,Q.unit.elements,ee.elements);ke.size(le)>0&&X.push({unit:ee,indices:le})}}),e(J,X)}e.remap=p;function h(H,J){if(H.elements.length>J.elements.length)return h(J,H);if(e.isEmpty(H))return J;for(var X=new Map,Q=0,ee=H.elements;Q<ee.length;Q++){var le=ee[Q];X.set(le.unit.id,le.indices)}for(var ye=[],be=0,Ae=J.elements;be<Ae.length;be++){var le=Ae[be];X.has(le.unit.id)?(ye[ye.length]={unit:le.unit,indices:ke.union(X.get(le.unit.id),le.indices)},X.delete(le.unit.id)):ye[ye.length]=le}return X.forEach(function(xe,ae){ye[ye.length]={unit:H.structure.unitMap.get(ae),indices:xe}}),e(H.structure,ye)}e.union=h;function v(H,J){for(var X=new Map,Q=0,ee=J.elements;Q<ee.length;Q++){var le=ee[Q];X.set(le.unit.id,le.indices)}for(var ye=[],be=0,Ae=H.elements;be<Ae.length;be++){var le=Ae[be];if(X.has(le.unit.id)){var xe=ke.subtract(le.indices,X.get(le.unit.id));if(ke.size(xe)===0)continue;ye[ye.length]={unit:le.unit,indices:xe}}else ye[ye.length]=le}return e(H.structure,ye)}e.subtract=v;function m(H,J){for(var X=new Map,Q=0,ee=H.elements;Q<ee.length;Q++){var le=ee[Q];X.set(le.unit.id,le.indices)}for(var ye=[],be=0,Ae=J.elements;be<Ae.length;be++){var le=Ae[be];if(!!X.has(le.unit.id)){var xe=ke.intersect(X.get(le.unit.id),le.indices);ke.size(xe)!==0&&(ye[ye.length]={unit:le.unit,indices:xe})}}return e(H.structure,ye)}e.intersect=m;function g(H,J){if(H.elements.length>J.elements.length)return g(J,H);if(e.isEmpty(H))return e.isEmpty(J);for(var X=new Map,Q=0,ee=H.elements;Q<ee.length;Q++){var le=ee[Q];X.set(le.unit.id,le.indices)}for(var ye=0,be=J.elements;ye<be.length;ye++){var le=be[ye];if(!!X.has(le.unit.id)&&ke.areIntersecting(X.get(le.unit.id),le.indices))return!0}return!1}e.areIntersecting=g;function y(H,J){if(e.isEmpty(H))return e.isEmpty(J);for(var X=new Map,Q=0,ee=H.elements;Q<ee.length;Q++){var le=ee[Q];X.set(le.unit.id,le.indices)}for(var ye=!1,be=0,Ae=J.elements;be<Ae.length;be++){var le=Ae[be];if(!!X.has(le.unit.id))if(ke.isSubset(X.get(le.unit.id),le.indices))ye=!0;else return!1}return ye}e.isSubset=y;function b(H,J){for(var X=[],Q=new Set,ee=0,le=H.elements;ee<le.length;ee++){var ye=le[ee];if(S(ye)){X[X.length]=ye;continue}if(ye.unit.kind===0){for(var be=ye.unit.elements,Ae=ye.unit.model.atomicHierarchy,xe=ye.unit.model.atomicHierarchy.atoms.label_alt_id,ae=Ae.residueAtomSegments,oe=ae.index,R=ae.offsets,V=[],pe=ye.indices,_e=ke.size(pe),Ee=0;Ee<_e;){Q.clear();var Ve=be[ke.getAt(pe,Ee)],He=oe[Ve];for(Q.add(xe.value(Ve)),Ee++;Ee<_e;){var Ye=be[ke.getAt(pe,Ee)];if(oe[Ye]!==He)break;Q.add(xe.value(Ye)),Ee++}for(var lt=Q.has(""),Le=R[He],Qe=R[He+1];Le<Qe;Le++){var at=ke.indexOf(be,Le);if(at>=0){var ot=xe.value(Le);(!J||lt||!ot||Q.has(ot))&&(V[V.length]=at)}}}X[X.length]={unit:ye.unit,indices:Je.ofSortedArray(V)}}else X[X.length]=ye}return e(H.structure,X)}e.extendToWholeResidues=b;function x(H){switch(H.kind){case 0:return H.model.atomicHierarchy.chainAtomSegments;case 1:return H.model.coarseHierarchy.spheres.chainElementSegments;case 2:return H.model.coarseHierarchy.gaussians.chainElementSegments}}function S(H){return H.unit.elements.length===ke.size(H.indices)}function _(H){return H.length>12&&H[H.length-1]-H[0]===H.length-1?Ie.ofRange(H[0],H[H.length-1]):Je.ofSortedArray(H)}function A(H,J,X){for(var Q=x(H).index,ee=H.elements,le=0,ye=0,be=ee.length;ye<be;ye++){var Ae=ee[ye],xe=Q[Ae];!J.has(xe)||le++}if(le===H.elements.length){X[X.length]={unit:H,indices:Ie.ofBounds(0,le)};return}var ae=new Int32Array(le);le=0;for(var ye=0,be=ee.length;ye<be;ye++){var Ae=ee[ye],xe=Q[Ae];!J.has(xe)||(ae[le++]=ye)}ae.length>0&&(X[X.length]={unit:H,indices:_(ae)})}function T(H,J,X,Q,ee){for(var le=x(H.elements[0].unit).index,ye=new Set,be=J;be<X;be++)for(var Ae=H.elements[be],xe=Ae.indices,ae=Ae.unit.elements,oe=0,R=ke.size(xe);oe<R;oe++)ye.add(le[ae[ke.getAt(xe,oe)]]);if(Q)for(var V=H.elements[0].unit,pe=0,_e=H.structure.units;pe<_e.length;pe++){var Ee=_e[pe];!ze.areSameChainOperatorGroup(Ee,V)||A(Ee,ye,ee)}else for(var be=J;be<X;be++)A(H.elements[be].unit,ye,ee)}function I(H){for(var J=[],X=0,Q=H.elements.length;X<Q;X++){var ee=H.elements[X];if(ze.Traits.is(ee.unit.traits,2)){for(var le=X;X<Q&&ze.areSameChainOperatorGroup(H.elements[X].unit,ee.unit);)X++;var ye=X;X--,T(H,le,ye,!0,J)}else S(ee)?J[J.length]=ee:T(H,X,X+1,!1,J)}return e(H.structure,J)}e.extendToWholeChains=I;function M(H){return H.unit.model.id+"|"+ct.entity.id(H)}function O(H){for(var J=[],X=Ze.create(H.structure),Q=new Set,ee=H.structure.units,le=0,ye=H.elements.length;le<ye;le++){var be=H.elements[le];X.unit=be.unit,X.element=be.unit.elements[0],Q.add(M(X))}for(var le=0,Ae=ee.length;le<Ae;++le){var xe=ee[le];if(X.unit=xe,X.element=xe.elements[0],Q.has(M(X))){var ae=ke.ofBounds(0,xe.elements.length);J[J.length]={unit:xe,indices:ae}}}return e(H.structure,J)}e.extendToWholeEntities=O;function D(H){for(var J=[],X=new Set,Q=H.structure.units,ee=0,le=H.elements.length;ee<le;ee++){var ye=H.elements[ee];X.add(ye.unit.model.id)}for(var ee=0,be=Q.length;ee<be;++ee){var Ae=Q[ee];if(X.has(Ae.model.id)){var xe=ke.ofBounds(0,Ae.elements.length);J[J.length]={unit:Ae,indices:xe}}}return e(H.structure,J)}e.extendToWholeModels=D;function F(H,J){for(var X=[],Q=0,ee=ke.size(J);Q<ee;++Q)X.push(H[ke.getAt(J,Q)]);return Je.ofSortedArray(X)}function G(H,J){return Je.indicesOf(H,J)}function N(H){for(var J=[],X=new Map,Q=0,ee=H.elements.length;Q<ee;Q++){var le=H.elements[Q],ye=le.unit.model,be=F(le.unit.elements,le.indices);X.has(ye)?X.set(ye,Je.union(be,X.get(ye))):X.set(ye,be)}for(var Q=0,Ae=H.structure.units.length;Q<Ae;++Q){var xe=H.structure.units[Q],be=X.get(xe.model);if(!!be){var ae=G(xe.elements,be);J[J.length]={unit:xe,indices:ae}}}return e(H.structure,J)}e.extendToAllInstances=N;function z(H){for(var J=[],X=new Set,Q=H.structure.units,ee=0,le=H.elements.length;ee<le;ee++){var ye=H.elements[ee];X.add(ye.unit.conformation.operator.name)}for(var ee=0,be=Q.length;ee<be;++ee){var Ae=Q[ee];if(X.has(Ae.conformation.operator.name)){var xe=ke.ofBounds(0,Ae.elements.length);J[J.length]={unit:Ae,indices:xe}}}return e(H.structure,J)}e.extendToWholeOperators=z;var $=new eo("98"),j=C();function Z(H,J){$.reset();for(var X=0,Q=H.elements;X<Q.length;X++)for(var ee=Q[X],le=ee.indices,ye=ee.unit.conformation.position,be=ee.unit.conformation.r,Ae=ee.unit.elements,xe=0,ae=ke.size(le);xe<ae;xe++){var oe=Ae[ke.getAt(le,xe)];ye(oe,j),J&&C.transformMat4(j,j,J),$.includePositionRadius(j,be(oe))}$.finishedIncludeStep();for(var R=0,V=H.elements;R<V.length;R++)for(var ee=V[R],le=ee.indices,ye=ee.unit.conformation.position,be=ee.unit.conformation.r,Ae=ee.unit.elements,xe=0,ae=ke.size(le);xe<ae;xe++){var oe=Ae[ke.getAt(le,xe)];ye(oe,j),J&&C.transformMat4(j,j,J),$.radiusPositionRadius(j,be(oe))}return{box:$.getBox(),sphere:$.getSphere()}}e.getBoundary=Z;var q=C();function te(H,J,X){X===void 0&&(X=0);for(var Q=X,ee=0,le=H.elements;ee<le.length;ee++){for(var ye=le[ee],be=ye.indices,Ae=ye.unit.conformation.position,xe=ye.unit.elements,ae=ke.size(be),oe=0;oe<ae;oe++){var R=xe[ke.getAt(be,oe)];Ae(R,q),C.toArray(q,J,Q+oe*3)}Q+=ae*3}return J}e.toPositionsArray=te;function he(H){var J=i(H),X=te(H,new Float32Array(3*J));return Fd.ofPositions(X)}e.getPrincipalAxes=he;function W(H,J){return ze.isAtomic(H)?H.model.atomicHierarchy.atomSourceIndex.value(J):J}function K(H){var J;if(e.isEmpty(H))return se.struct.generator.empty();for(var X=H.structure.models,Q=new Map,ee=0,le=H.elements;ee<le.length;ee++){var ye=le[ee],be=ye.indices,Ae=ye.unit.elements,xe=ye.unit.conformation.operator.name,ae=void 0;Q.has(xe)?ae=Q.get(xe).xs:(ae=$r.create(),Q.set(xe,{modelLabel:ye.unit.model.label,modelIndex:ye.unit.model.modelNum,xs:ae}));for(var oe=0,R=ke.size(be);oe<R;oe++){var V=W(ye.unit,Ae[ke.getAt(be,oe)]);$r.add(ae,V,V)}}for(var pe=[],_e=Q.keys();;){var Ee=_e.next();if(Ee.done)break;var ye=Q.get(Ee.value);pe.push(U(Ee.value,ye.xs.array,X.length>1,ye.modelLabel,ye.modelIndex))}for(var Ve=new Map,oe=0,He=pe.length;oe<He;++oe){var Ye=pe[oe],lt=jd(Ja(Ye.atom.ranges),Ja(Ye.atom.set)),xe=lt+"|"+(Ye.entity?Ye.entity.modelLabel+Ye.entity.modelIndex:"");Ve.has(xe)?(J=Ve.get(xe).chain.opName).push.apply(J,Ye.chain.opName):Ve.set(xe,Ye)}var Le=[];return Ve.forEach(function(Qe){var at=Qe.atom,ot=at.ranges,dt=at.set,Oe=Qe.chain.opName,Me=se.struct.atomProperty.core.operatorName(),Ke=se.struct.atomProperty.core.sourceIndex(),tt=[];dt.length>0&&(tt[tt.length]=se.core.set.has([se.core.type.set(dt),Ke]));for(var St=0,ht=ot.length/2;St<ht;St++)tt[tt.length]=se.core.rel.inRange([Ke,ot[2*St],ot[2*St+1]]);if(Qe.entity){var ut=Qe.entity,fe=ut.modelLabel,me=ut.modelIndex;Le.push(se.struct.generator.atomGroups({"atom-test":tt.length>1?se.core.logic.or(tt):tt[0],"chain-test":Oe.length>1?se.core.set.has([se.core.type.set(Oe),Me]):se.core.rel.eq([Me,Oe[0]]),"entity-test":se.core.logic.and([se.core.rel.eq([se.struct.atomProperty.core.modelLabel(),fe]),se.core.rel.eq([se.struct.atomProperty.core.modelIndex(),me])])}))}else Le.push(se.struct.generator.atomGroups({"atom-test":tt.length>1?se.core.logic.or(tt):tt[0],"chain-test":Oe.length>1?se.core.set.has([se.core.type.set(Oe),Me]):se.core.rel.eq([Me,Oe[0]])}))}),se.struct.modifier.union([Le.length===1?Le[0]:se.struct.combinator.merge(Le.map(function(Qe){return se.struct.modifier.union([Qe])}))])}e.toExpression=K;function U(H,J,X,Q,ee){es(J);for(var le=[],ye=[],be=0,Ae=J.length;be<Ae;){var xe=be;for(be++;be<Ae&&J[be-1]+1===J[be];)be++;var ae=be;if(ae-xe>12)le[le.length]=J[xe],le[le.length]=J[ae-1];else for(var oe=xe;oe<ae;oe++)ye[ye.length]=J[oe]}return X?{atom:{set:ye,ranges:le},chain:{opName:[H]},entity:{modelLabel:Q,modelIndex:ee}}:{atom:{set:ye,ranges:le},chain:{opName:[H]}}}})(Re||(Re={}));var nc;(function(e){function t(){return{elementCount:0,conformationCount:0,residueCount:0,chainCount:0,unitCount:0,structureCount:0,firstElementLoc:Ze.create(void 0),firstConformationLoc:Ze.create(void 0),firstResidueLoc:Ze.create(void 0),firstChainLoc:Ze.create(void 0),firstUnitLoc:Ze.create(void 0),firstStructureLoc:Ze.create(void 0)}}e.create=t;function r(u,l,c){var d=u.get(l)||0;u.set(l,d+c)}function n(u,l,c){var d=c.indices,f=c.unit,p=f.elements,h=ke.size(d),v=new Map,m=new Map;if(h>0&&Ze.set(u.firstElementLoc,l,f,p[ke.start(d)]),h===p.length)u.unitCount+=1,u.unitCount===1&&Ze.set(u.firstUnitLoc,l,f,p[ke.start(d)]);else if(h===1){if(ze.Traits.is(f.traits,1))return;u.elementCount+=1,u.elementCount===1&&Ze.set(u.firstElementLoc,l,f,p[ke.start(d)])}else if(ze.isAtomic(f))for(var g=f.model.atomicHierarchy.residueAtomSegments,y=g.index,b=g.offsets,x=f.model.atomicHierarchy.atoms.label_alt_id,S=0,_=function(){v.clear();var A=0,T=p[ke.getAt(d,S)],I=y[T];for(r(v,x.value(T),1),++S,++A;S<h;){var M=p[ke.getAt(d,S)];if(y[M]!==I)break;r(v,x.value(M),1),++S,++A}if(b[I+1]-b[I]===A)u.residueCount+=1,u.residueCount===1&&Ze.set(u.firstResidueLoc,l,f,b[I]);else{m.clear();for(var O=b[I],D=b[I+1];O<D;++O)r(m,x.value(O),1);m.get("")===v.get("")&&v.forEach(function(F,G){if(m.get(G)===F){if(G!==""&&(u.conformationCount+=1,u.conformationCount===1)){for(var N=b[I],z=b[I+1];N<z;++N)if(G===x.value(N)){Ze.set(u.firstConformationLoc,l,f,N);break}}A-=F}}),u.elementCount+=A}};S<h;)_();else u.elementCount+=h,u.elementCount===1&&Ze.set(u.firstElementLoc,l,f,p[ke.start(d)])}function a(u,l,c){var d=c.indices,f=c.unit,p=ke.size(d);if(p!==0){var h=f.elements;if(!ze.Traits.is(f.traits,1)){p===h.length&&(u.chainCount+=1,u.chainCount===1&&Ze.set(u.firstChainLoc,l,f,h[ke.start(d)]));return}var v=ze.isAtomic(f)?f.model.atomicHierarchy.chainAtomSegments:ze.isSpheres(f)?f.model.coarseHierarchy.spheres.chainElementSegments:ze.isGaussians(f)?f.model.coarseHierarchy.gaussians.chainElementSegments:void 0;if(!v){console.warn("StructureElement loci stats: unknown unit type");return}for(var m=v.index,g=v.offsets,y=0;y<p;){var b=0,x=h[ke.getAt(d,y)],S=m[x];for(++y,++b;y<p;){var _=h[ke.getAt(d,y)];if(m[_]!==S)break;++y,++b}g[S+1]-g[S]===b&&(u.chainCount+=1,u.chainCount===1&&Ze.set(u.firstChainLoc,l,f,g[S]))}}}function i(u,l,c,d,f){var p=c[d],h=ze.isAtomic(p.unit)?p.unit.model.atomicHierarchy.chainAtomSegments:ze.isSpheres(p.unit)?p.unit.model.coarseHierarchy.spheres.chainElementSegments:ze.isGaussians(p.unit)?p.unit.model.coarseHierarchy.gaussians.chainElementSegments:void 0;if(!h){console.warn("StructureElement loci stats: unknown unit type");return}for(var v=h.index,m=h.offsets,g=new Map,y=d;y<f;y++){p=c[y];var b=p.indices,x=p.unit,S=ke.size(b);if(S!==0){var _=x.elements;if(!ze.Traits.is(x.traits,1)){var A=_[ke.start(b)];r(g,v[A],_.length);continue}for(var T=0;T<S;){var I=0,A=_[ke.getAt(b,T)],M=v[A];for(++T,++I;T<S;){var O=_[ke.getAt(b,T)];if(v[O]!==M)break;++T,++I}r(g,M,I)}}}var D=-1;if(g.forEach(function(F,G){m[G+1]-m[G]===F&&(u.chainCount+=1,u.chainCount===1&&(D=G))}),!(D<0))for(var y=d;y<f;y++){p=c[y];var b=p.indices,x=p.unit,S=ke.size(b);if(S!==0)for(var _=x.elements,T=0;T<S;){var A=_[ke.getAt(b,T)],M=v[A];if(M===D){Ze.set(u.firstChainLoc,l,x,A);return}}}}function o(u){var l=t();if(Re.isEmpty(u))return l;var c=!1;if(Re.isWholeStructure(u)){if(l.structureCount+=1,l.structureCount===1){var d=u.elements[0],f=d.unit,p=d.indices;Ze.set(l.firstStructureLoc,u.structure,f,f.elements[ke.min(p)])}}else for(var h=0,v=u.elements;h<v.length;h++){var m=v[h];n(l,u.structure,m),ze.Traits.is(m.unit.traits,2)?c=!0:a(l,u.structure,m)}if(c)for(var g=0,y=u.elements.length;g<y;g++){var m=u.elements[g];if(!!ze.Traits.is(m.unit.traits,2)){for(var b=g;g<y&&ze.areSameChainOperatorGroup(u.elements[g].unit,m.unit);)g++;var x=g;g--,x-b===1?a(l,u.structure,m):i(l,u.structure,u.elements,b,x)}}return l}e.ofLoci=o;function s(u,l,c){return l.elementCount===1&&c.elementCount===0?Ze.copy(u.firstElementLoc,l.firstElementLoc):l.elementCount===0&&c.elementCount===1&&Ze.copy(u.firstElementLoc,c.firstElementLoc),l.conformationCount===1&&c.conformationCount===0?Ze.copy(u.firstConformationLoc,l.firstConformationLoc):l.conformationCount===0&&c.conformationCount===1&&Ze.copy(u.firstConformationLoc,c.firstConformationLoc),l.residueCount===1&&c.residueCount===0?Ze.copy(u.firstResidueLoc,l.firstResidueLoc):l.residueCount===0&&c.residueCount===1&&Ze.copy(u.firstResidueLoc,c.firstResidueLoc),l.chainCount===1&&c.chainCount===0?Ze.copy(u.firstChainLoc,l.firstChainLoc):l.chainCount===0&&c.chainCount===1&&Ze.copy(u.firstChainLoc,c.firstChainLoc),l.unitCount===1&&c.unitCount===0?Ze.copy(u.firstUnitLoc,l.firstUnitLoc):l.unitCount===0&&c.unitCount===1&&Ze.copy(u.firstUnitLoc,c.firstUnitLoc),l.structureCount===1&&c.structureCount===0?Ze.copy(u.firstStructureLoc,l.firstStructureLoc):l.structureCount===0&&c.structureCount===1&&Ze.copy(u.firstStructureLoc,c.firstStructureLoc),u.elementCount=l.elementCount+c.elementCount,u.conformationCount=l.conformationCount+c.conformationCount,u.residueCount=l.residueCount+c.residueCount,u.chainCount=l.chainCount+c.chainCount,u.unitCount=l.unitCount+c.unitCount,u.structureCount=l.structureCount+c.structureCount,u}e.add=s})(nc||(nc={}));function cre(e){return ze.isAtomic(e.unit)?e.unit.residueIndex[e.element]:-1}function dre(e){return ze.isAtomic(e.unit)?e.unit.chainIndex[e.element]:-1}function fre(e){return ct.entity.key(e)}ca.Field;ca.Encodings;ca.Field;ca.Category;ca.Category;ca.Category;var vT;(function(e){function t(r){var n=Array.isArray(r)?r:[r];return{structures:n,firstModel:n[0].model,cache:Object.create(null)}}e.create=t})(vT||(vT={}));var mT;(function(e){e.AtomSitePositionsFieldNames=new Set(["id","Cartn_x","Cartn_y","Cartn_z"])})(mT||(mT={}));var pre={molstar_atom_site_operator_mapping:{label_asym_id:ve.Schema.Str(),auth_asym_id:ve.Schema.Str(),operator_name:ve.Schema.Str(),suffix:ve.Schema.Str(),assembly_id:ve.Schema.Str(),assembly_operator_id:ve.Schema.Int(),symmetry_operator_index:ve.Schema.Int(),symmetry_hkl:ve.Schema.Vector(3),ncs_id:ve.Schema.Int()}},gT=function(e,t){return typeof t[e].operator.assembly=="undefined"?1:0},Kb=function(e,t){return t[e].operator.spgrOp===-1?1:0};ca.fields().str("label_asym_id",function(e,t){return t[e].label_asym_id}).str("auth_asym_id",function(e,t){return t[e].auth_asym_id}).str("operator_name",function(e,t){return t[e].operator.name}).str("suffix",function(e,t){return t[e].operator.suffix}).str("assembly_id",function(e,t){var r;return((r=t[e].operator.assembly)===null||r===void 0?void 0:r.id)||""},{valueKind:gT}).int("assembly_operator_id",function(e,t){var r;return((r=t[e].operator.assembly)===null||r===void 0?void 0:r.operId)||0},{valueKind:gT}).int("symmetry_operator_index",function(e,t){return t[e].operator.spgrOp},{valueKind:Kb}).vec("symmetry_hkl",[function(e,t){return t[e].operator.hkl[0]},function(e,t){return t[e].operator.hkl[1]},function(e,t){return t[e].operator.hkl[2]}],{valueKind:Kb}).int("ncs_id",function(e,t){return t[e].operator.ncsId},{valueKind:Kb}).getFields();function hre(e){if(e._rowCount===0)return{residues:[],chains:[]};for(var t=0,r=e._rowCount,n=[t],a=[t],i=e.label_entity_id,o=e.label_asym_id,s=e.label_seq_id,u=e.auth_seq_id,l=e.pdbx_PDB_ins_code,c=t+1;c<r;c++){var d=!i.areValuesEqual(c-1,c)||!o.areValuesEqual(c-1,c),f=d||!s.areValuesEqual(c-1,c)||!u.areValuesEqual(c-1,c)||!l.areValuesEqual(c-1,c);f&&(n[n.length]=c),d&&(a[a.length]=c)}return{residues:n,chains:a}}function Mm(e,t,r){e[t].isDefined||(e[t]=e[r]),e[r].isDefined||(e[r]=e[t])}function vre(e,t,r){var n=Xr.ofColumns(yK,{type_symbol:ve.ofArray({array:ve.mapToArray(e.type_symbol,Ep),schema:ve.Schema.Aliased(ve.Schema.str)}),label_atom_id:e.label_atom_id,auth_atom_id:e.auth_atom_id,label_alt_id:e.label_alt_id,label_comp_id:e.label_comp_id,auth_comp_id:e.auth_comp_id,pdbx_formal_charge:e.pdbx_formal_charge}),a=Xr.view(e,bK,r.residues),i=Xr.view(e,SK,r.chains);if(!a.label_seq_id.isDefined){for(var o=new Int32Array(a.label_seq_id.rowCount),s=r.residues,u=r.chains,l=0,c=0,d=0,f=o.length;d<f;++d)s[d]>=u[l+1]&&(l+=1,c=0),o[d]=++c;a.label_seq_id=ve.ofIntArray(o)}return Xr.columnToArray(a,"label_seq_id",Int32Array),Xr.columnToArray(a,"auth_seq_id",Int32Array),Mm(n,"label_atom_id","auth_atom_id"),Mm(n,"label_comp_id","auth_comp_id"),Mm(a,"label_seq_id","auth_seq_id"),Mm(i,"label_asym_id","auth_asym_id"),{atoms:n,residues:a,chains:i,atomSourceIndex:t}}function mre(e){return{id:un.create22(),atomId:e.id,occupancy:e.occupancy,B_iso_or_equiv:e.B_iso_or_equiv,xyzDefined:e.Cartn_x.isDefined&&e.Cartn_y.isDefined&&e.Cartn_z.isDefined,x:e.Cartn_x.toArray({array:Float32Array}),y:e.Cartn_y.toArray({array:Float32Array}),z:e.Cartn_z.toArray({array:Float32Array})}}function gre(e,t){return Xr.areEqual(e.chains,t.chains)&&Xr.areEqual(e.residues,t.residues)&&Xr.areEqual(e.atoms,t.atoms)}function yre(e,t){var r=new Map;if(!Jr.is(t))return r;var n=yu(pre,t.data.frame).molstar_atom_site_operator_mapping;if(n._rowCount===0)return r;for(var a=new Map,i=new Map,o=0;o<n._rowCount;o++){var s=n.assembly_operator_id.valueKind(o)===0?{id:n.assembly_id.value(o),operList:[],operId:n.assembly_operator_id.value(o)}:void 0,u=dn.create(n.operator_name.value(o),ue.identity(),{assembly:s,spgrOp:n.symmetry_operator_index.valueKind(o)===0?n.symmetry_operator_index.value(o):void 0,hkl:C.ofArray(n.symmetry_hkl.value(o)),ncsId:n.ncs_id.value(o)}),l=n.suffix.value(o),c=n.label_asym_id.value(o);a.set(""+c+l,{name:c,operator:u});var d=n.auth_asym_id.value(o);i.set(""+d+l,d)}for(var f=e.chains,p=f.label_asym_id,h=f.auth_asym_id,v=new Array(p.rowCount),m=new Array(p.rowCount),o=0;o<p.rowCount;o++){var c=p.value(o),d=h.value(o);if(!a.has(c)){v[o]=c,m[o]=d;continue}var g=a.get(c),y=g.name,u=g.operator;r.set(o,u),v[o]=y,m[o]=i.get(d)||d}return e.chains.label_asym_id=ve.ofArray({array:v,valueKind:e.chains.label_asym_id.valueKind,schema:e.chains.label_asym_id.schema}),e.chains.auth_asym_id=ve.ofArray({array:m,valueKind:e.chains.auth_asym_id.valueKind,schema:e.chains.auth_asym_id.schema}),r}function bre(e,t,r,n,a,i){var o=hre(e),s=vre(e,t,o),u=yre(s,a);if(i&&gre(i.atomicHierarchy,s))return{sameAsPrevious:!0,hierarchy:i.atomicHierarchy,chainOperatorMapping:u};var l={residueAtomSegments:nr.ofOffsets(o.residues,Ie.ofBounds(0,e._rowCount)),chainAtomSegments:nr.ofOffsets(o.chains,Ie.ofBounds(0,e._rowCount))},c=RK(s,r,l),d=r$(s,l,c,n),f=w(w(w({},s),l),{index:c,derived:d});return{sameAsPrevious:!1,hierarchy:f,chainOperatorMapping:u}}function oO(e,t,r,n,a,i){var o=bre(e,t,r,n,a,i),s=o.sameAsPrevious,u=o.hierarchy,l=o.chainOperatorMapping,c=mre(e);return{sameAsPrevious:s,hierarchy:u,conformation:c,chainOperatorMapping:l}}var Nx;(function(e){e.Empty={isDefined:!1}})(Nx||(Nx={}));function Sre(e,t,r){if(e.has(t))return e.get(t);var n=r.index++;return e.set(t,n),n}function xre(e,t){if(e.has(t))return e.get(t);var r=new Map;return e.set(t,r),r}function Cre(e,t,r){var n=e.getEntityIndex,a=function(o,s){var u=n(o);if(u<0)return-1;var l=t.get(u);return l.has(s)?l.get(s):-1},i=function(o,s,u){var l=n(o);if(l<0)return-1;var c=t.get(l);if(c===void 0)return-1;var d=c.get(s);if(d===void 0)return-1;var f=r.get(d),p=f.elementIndices,h=f.seqRanges,v=Kr.firstIntersectionIndex(h,ke.ofSingleton(u));return v!==-1?p[v]:-1};return{findChainKey:a,findSequenceKey:i}}function _re(e){throw new Error("Missing entity entry for entity id '"+e+"'.")}function yT(e,t){for(var r=e.entity_id,n=e.asym_id,a=e.seq_id_begin,i=e.seq_id_end,o=e.count,s=e.chainElementSegments,u=new Map,l=new Map,c={index:0},d=new Int32Array(o),f=new Int32Array(o),p=new Int32Array(s.count),h=0;h<o;h++)f[h]=t.getEntityIndex(r.value(h)),f[h]<0&&_re(r.value(h));for(var v=0;v<s.count;v++){var m=s.offsets[v],g=s.offsets[v+1],y=f[m];p[v]=y;for(var b=xre(l,y),x=Sre(b,n.value(m),c),h=m;h<g;h++)d[h]=x;for(var S=[],_=[],h=m;h<g;h++){var A=a.value(h),T=i.value(h);S.push(h),_.push(A,T)}var I={elementIndices:S,seqRanges:Kr.ofSortedRanges(_)};u.set(x,I)}var M=Cre(t,l,u),O=M.findChainKey,D=M.findSequenceKey,F=function(G){return p[G]};return{chainKey:d,entityKey:f,findSequenceKey:D,findChainKey:O,getEntityFromChain:F}}function bT(e,t){for(var r=[],n=[],a=nr.transientSegments(e.chainElementSegments,Ie.ofBounds(0,e.count)),i=e.seq_id_begin,o=e.seq_id_end;a.hasNext;)for(var s=a.move(),u=s.start,l=s.end,c=-1,d=-1,f=u;f<l;++f){var p=o.value(f);f===u?(c=f,d=o.value(f)):i.value(f)-d>1&&(r.push(c,f-1),n.push(f-1,f),c=f),f===l-1&&r.push(c,f),d=p}return{polymerRanges:Kr.ofSortedRanges(r),gapRanges:Kr.ofSortedRanges(n)}}vr.atom_site.label_comp_id,vr.atom_site.label_seq_id,vr.atom_site.pdbx_PDB_ins_code,vr.atom_site.label_asym_id,vr.atom_site.label_entity_id,vr.atom_site.auth_atom_id,vr.atom_site.auth_seq_id,vr.atom_site.auth_asym_id;w(w({},vr.chem_comp_bond),{molstar_protonation_variant:ve.Schema.Str()});var wre=w(w({},vr.chem_comp),{type:ve.Schema.Aliased(ve.Schema.str)}),ui={entry:vr.entry,struct:vr.struct,struct_asym:vr.struct_asym,ihm_model_list:vr.ihm_model_list,ihm_model_group:vr.ihm_model_group,ihm_model_group_link:vr.ihm_model_group_link,entity:vr.entity,entity_poly:vr.entity_poly,entity_poly_seq:vr.entity_poly_seq,pdbx_entity_branch:vr.pdbx_entity_branch,chem_comp:wre,pdbx_chem_comp_identifier:vr.pdbx_chem_comp_identifier,atom_site:vr.atom_site,ihm_sphere_obj_site:vr.ihm_sphere_obj_site,ihm_gaussian_obj_site:vr.ihm_gaussian_obj_site,pdbx_unobs_or_zero_occ_residues:vr.pdbx_unobs_or_zero_occ_residues,pdbx_molecule:vr.pdbx_molecule};function $d(e){for(var t=Object.create(null),r=0,n=Object.keys(ui);r<n.length;r++){var a=n[r];a in e?t[a]=e[a]:t[a]=Xr.ofUndefinedColumns(ui[a],0)}return t}var sO={hierarchy:Nx.Empty,conformation:void 0};function Are(e,t){var r=e.ihm_sphere_obj_site,n=e.ihm_gaussian_obj_site;if(r._rowCount===0&&n._rowCount===0)return sO;var a=ST(r),i=Pre(r),o=yT(a,e.entities),s=bT(a,t.chemicalComponentMap),u=ST(n),l=Tre(n),c=yT(u,e.entities),d=bT(u,t.chemicalComponentMap);return{hierarchy:{isDefined:!0,spheres:w(w(w({},a),o),s),gaussians:w(w(w({},u),c),d)},conformation:{id:un.create22(),spheres:i,gaussians:l}}}function Pre(e){return{x:e.Cartn_x.toArray({array:Float32Array}),y:e.Cartn_y.toArray({array:Float32Array}),z:e.Cartn_z.toArray({array:Float32Array}),radius:e.object_radius.toArray({array:Float32Array}),rmsf:e.rmsf.toArray({array:Float32Array})}}function Tre(e){for(var t=ui.ihm_gaussian_obj_site.covariance_matrix.space,r=[],n=e.covariance_matrix,a=0,i=n.rowCount;a<i;a++)r[a]=Pr.toMat3(Mn(),t,n.value(a));return{x:e.mean_Cartn_x.toArray({array:Float32Array}),y:e.mean_Cartn_y.toArray({array:Float32Array}),z:e.mean_Cartn_z.toArray({array:Float32Array}),weight:e.weight.toArray({array:Float32Array}),covariance_matrix:r}}function Ere(e,t,r){for(var n=[0],a=1,i=e.rowCount;a<i;a++){var o=!e.areValuesEqual(a-1,a);o&&(n[n.length]=a)}return{chainElementSegments:nr.ofOffsets(n,Ie.ofBounds(0,e.rowCount))}}function ST(e){var t=e.entity_id,r=e.seq_id_begin,n=e.seq_id_end,a=e.asym_id;return w({count:t.rowCount,entity_id:t,asym_id:a,seq_id_begin:r,seq_id_end:n},Ere(a))}var Ire={HIS:"H",ARG:"R",LYS:"K",ILE:"I",PHE:"F",LEU:"L",TRP:"W",ALA:"A",MET:"M",PRO:"P",CYS:"C",ASN:"N",VAL:"V",GLY:"G",SER:"S",GLN:"Q",TYR:"Y",ASP:"D",GLU:"E",THR:"T",SEC:"U",PYL:"O",HSD:"H",HSE:"H",HSP:"H",LSN:"K",ASPP:"D",GLUP:"E",HID:"H",HIE:"H",HIP:"H",LYN:"K",ASH:"D",GLH:"E"},Mre={DA:"A",DC:"C",DG:"G",DT:"T",DU:"U"},Dre={A:"A",C:"C",G:"G",T:"T",U:"U"};function xT(e){var t=Ire[e];return t||"X"}function CT(e){var t=Dre[e];return t||"X"}function _T(e){var t=Mre[e];return t||"X"}var xv;(function(e){function t(u){var l=u.code.toArray();return(l instanceof Array?l:Array.from(l)).join("")}e.getSequenceString=t;function r(u){for(var l=0,c=Math.min(u.rowCount,10);l<c;l++){var d=u.value(l)||"";if(xT(d)!=="X")return"protein";if(CT(d)!=="X")return"RNA";if(_T(d)!=="X")return"DNA"}return"generic"}function n(u,l){var c;switch(u){case"protein":c=xT;break;case"DNA":c=_T;break;case"RNA":c=CT;break;case"generic":c=function(){return"X"};break;default:throw new Error("unknown kind '"+u+"'")}return l&&l.size>0?function(d){var f=c(d);return f!=="X"||!l.has(d)?f:c(l.get(d))}:c}function a(u,l){if(l.rowCount===0)throw new Error("cannot be empty");var c=r(u);return new i(c,u,l)}e.ofResidueNames=a;var i=function(){function u(l,c,d){this.kind=l,this.microHet=new Map;for(var f=n(l),p=[],h=[],v=[],m=new Map,g=0,y=new Map,b=0,x=d.rowCount;b<x;++b){var S=d.value(b);if(y.has(S))m.has(S)?m.get(S).push(c.value(b)):m.set(S,[h[y.get(S)],c.value(b)]);else{y.set(S,g);var _=c.value(b);h[g]=_,v[g]=S,p[g]=f(_),g+=1}}for(var A=[],b=0,x=g;b<x;++b){var T=m.get(v[b]);if(T){var I=T.map(function(D){var F=f(D);return F==="X"?D:F});A[b]="("+I.join("|")+")"}else A[b]=p[b]==="X"?h[b]:p[b]}this.length=g,this.code=ve.ofStringArray(p),this.compId=ve.ofStringArray(h),this.seqId=ve.ofIntArray(v),this.label=ve.ofStringArray(A),this.microHet=m,this.indexMap=y}return u.prototype.index=function(l){return this.indexMap.get(l)},u}();function o(u,l){var c="generic";return new s(c,u,l)}e.ofSequenceRanges=o;var s=function(){function u(l,c,d){this.kind=l,this.seqIdStart=c,this.seqIdEnd=d,this.microHet=new Map;for(var f=0,p=Number.MAX_SAFE_INTEGER,h=0,v=this.seqIdStart.rowCount;h<v;h++){var m=this.seqIdStart.value(h),g=this.seqIdEnd.value(h);m<p&&(p=m),f<g&&(f=g)}var y=f-p+1;this.code=ve.ofConst("X",y,ve.Schema.str),this.label=ve.ofConst("",y,ve.Schema.str),this.seqId=ve.ofLambda({value:function(b){return b+p+1},rowCount:y,schema:ve.Schema.int}),this.compId=ve.ofConst("",y,ve.Schema.str),this.length=y,this.minSeqId=p}return u.prototype.index=function(l){return l-this.minSeqId},u}()})(xv||(xv={}));var Ux;(function(e){var t={byEntityKey:{},sequences:[]};function r(){for(var s=[],u=0;u<arguments.length;u++)s[u]=arguments[u];for(var l=[],c={},d=0,f=s.length;d<f;++d)l.push.apply(l,s[d].sequences),Object.assign(c,s[d].byEntityKey);return{sequences:l,byEntityKey:c}}function n(s,u,l){var c=a(s,u),d=l.isDefined?i(s,l):t;return r(c,d)}e.fromHierarchy=n;function a(s,u){var l=u.atoms.label_comp_id,c=u.residues.label_seq_id,d=u.chainAtomSegments,f=u.residueAtomSegments,p=d.count,h=d.offsets,v={},m=[];if(p===1&&h[0]===0&&h[1]===0)return{byEntityKey:v,sequences:m};for(var g=0,y=u.chains._rowCount;g<y;g++){var b=u.index.getEntityFromChain(g);if(!(v[b]!==void 0||s.data.type.value(b)!=="polymer")){var x=g;for(g++;g<y&&b===u.index.getEntityFromChain(g)&&s.data.type.value(b)!=="polymer";)g++;g--;for(var S=f.index[h[x]],_=f.index[h[g+1]-1]+1,A=ve.window(c,S,_),T=[],I=S;I<_;++I)T.push(l.value(f.offsets[I]));var M=ve.ofStringArray(T);v[b]={entityId:s.data.id.value(b),sequence:xv.ofResidueNames(M,A)},m.push(v[b])}}return{byEntityKey:v,sequences:m}}e.fromAtomicHierarchy=a;function i(s,u){var l=o(s,u.spheres),c=o(s,u.gaussians);return r(l,c)}e.fromCoarseHierarchy=i;function o(s,u){var l=u.chainElementSegments,c=u.seq_id_begin,d=u.seq_id_end,f=l.count,p=l.offsets,h={},v=[];if(f===1&&p[0]===0&&p[1]===0)return{byEntityKey:h,sequences:v};for(var m=0,g=f;m<g;m++){var y=u.getEntityFromChain(m);if(h[y]===void 0){var b=m;for(m++;m<g&&y===u.getEntityFromChain(m);)m++;m--;var x=p[b],S=p[m+1]-1,_=ve.window(c,x,S),A=ve.window(d,x,S);h[y]={entityId:s.data.id.value(y),sequence:xv.ofSequenceRanges(_,A)},v.push(h[y])}}return{byEntityKey:h,sequences:v}}e.fromCoarseElements=o})(Ux||(Ux={}));function uO(e,t,r,n){if(!e.entity_poly_seq||!e.entity_poly_seq._rowCount)return Ux.fromHierarchy(t,r,n);for(var a=e.entity_poly_seq,i=a.entity_id,o=a.num,s=a.mon_id,u={},l=[],c=i.rowCount,d=0;d<c;){for(var f=d;d<c-1&&i.areValuesEqual(d,d+1);)d++;d++;var p=i.value(f),h=ve.window(s,f,d),v=ve.window(o,f,d),m=t.getEntityIndex(p);u[m]={entityId:p,sequence:xv.ofResidueNames(h,v)},l.push(u[m])}return{byEntityKey:u,sequences:l}}function lO(e,t,r,n){return ce(this,void 0,void 0,function(){var a,i,o,s,u,l,c,d,f,p,h;return de(this,function(v){switch(v.label){case 0:return a=WS(r,n-1),i=t.label_entity_id,o=t.label_asym_id,s=t.label_seq_id,u=_b(a,i.value),e.shouldUpdate?[4,e.update()]:[3,2];case 1:v.sent(),v.label=2;case 2:l=0,c=u.length-1,v.label=3;case 3:if(!(l<c))return[3,10];d=_b(a,o.value,{start:u[l],end:u[l+1]}),f=0,p=d.length-1,v.label=4;case 4:return f<p?(h=d[f],s.valueKind(h)!==0?[3,6]:(_b(a,s.value,{sort:!0,start:h,end:d[f+1]}),e.shouldUpdate?[4,e.update()]:[3,6])):[3,7];case 5:v.sent(),v.label=6;case 6:return f++,[3,4];case 7:return e.shouldUpdate?[4,e.update()]:[3,9];case 8:v.sent(),v.label=9;case 9:return l++,[3,3];case 10:return EX(a)&&a.length===t._rowCount?[2,{atom_site:t,sourceIndex:ve.ofIntArray(a)}]:[2,{atom_site:Xr.view(t,t._schema,a),sourceIndex:ve.ofIntArray(a)}]}})})}function wT(e,t,r,n,a){var i=a.residue,o=i.polymerType,s=i.traceElementIndex,u=i.directionFromElementIndex,l=i.directionToElementIndex,c=o[e],d=o[t];if(c===0||d===0||s[e]===-1||s[t]===-1)return!1;var f=n.findAtomsOnResidue(e,rc(c,"backboneStart")),p=n.findAtomsOnResidue(t,rc(d,"backboneEnd"));(f===-1||p===-1)&&(f=n.findAtomsOnResidue(e,rc(c,"coarseBackbone")),p=n.findAtomsOnResidue(t,rc(d,"coarseBackbone")));var h=r.x,v=r.y,m=r.z,g=C.create(h[f],v[f],m[f]),y=C.create(h[p],v[p],m[p]),b=u[e]===-1||l[e]===-1||u[t]===-1||l[t]===-1;return C.distance(g,y)<(b?10:3)}function cO(e,t,r,n){for(var a=[],i=[],o=new Map,s=nr.transientSegments(e.chainAtomSegments,Ie.ofBounds(0,e.atoms._rowCount)),u=nr.transientSegments(e.residueAtomSegments,Ie.ofBounds(0,e.atoms._rowCount)),l=e.index,c=e.derived,d=e.residues.label_seq_id,f=e.chains.label_entity_id,p=c.residue,h=p.moleculeType,v=p.traceElementIndex,m,g,y,b;s.hasNext;){var x=s.move();u.setSegment(x),m=-1,g=-1,y=-1,b=-1;var S=t.getEntityIndex(f.value(x.index)),_=n.byEntityKey[S],A=_?_.sequence.seqId.value(_.sequence.seqId.rowCount-1):-1,T=e.residueAtomSegments.index[x.start],I=e.residueAtomSegments.index[x.end-1],M=d.value(T),O=d.value(I);for(M===1&&O===A&&r.xyzDefined&&wT(T,I,r,l,c)&&(o.set(T,I),o.set(I,T));u.hasNext;){var D=u.move(),F=D.index,G=d.value(F);if(t3(h[F])&&v[F]!==-1)if(b!==-1)if(G!==m+1)a.push(b,y-1),i.push(g,D.end-1),b=D.start;else if(!u.hasNext)a.push(b,D.end-1);else{var N=e.residueAtomSegments.index[D.start],z=e.residueAtomSegments.index[y-1];r.xyzDefined&&!wT(N,z,r,e.index,c)&&(a.push(b,y-1),i.push(g,D.end-1),b=D.start)}else b=D.start;else b!==-1&&(a.push(b,y-1),b=-1);g=D.start,y=D.end,m=G}}return{polymerRanges:Kr.ofSortedRanges(a),gapRanges:Kr.ofSortedRanges(i),cyclicPolymerMap:o}}function bc(e){var t=void 0,r=void 0;return function(){for(var n=[],a=0;a<arguments.length;a++)n[a]=arguments[a];if(!t||t.length!==n.length)return t=n,r=e.apply(void 0,n),r;for(var i=0,o=n.length;i<o;i++)if(n[i]!==t[i])return t=n,r=e.apply(void 0,n),r;return r}}function $y(e){var t=new Map;return function(r){if(t.has(r))return t.get(r);var n=e(r);return t.set(r,n),n}}function Rre(e){for(var t=new Map,r=function(s,u,l){return s+"|"+u+"|"+l},n=e.pdbx_unobs_or_zero_occ_residues,a=0,i=n._rowCount;a<i;++a){var o=r(n.PDB_model_num.value(a),n.label_asym_id.value(a),n.label_seq_id.value(a));t.set(o,{polymer_flag:n.polymer_flag.value(a),occupancy_flag:n.occupancy_flag.value(a)})}return{has:function(s,u,l){return t.has(r(s,u,l))},get:function(s,u,l){return t.get(r(s,u,l))},size:t.size}}function Ore(e){var t=new Map;if(e.chem_comp._rowCount>0)for(var r=e.chem_comp.id,n=0,a=r.rowCount;n<a;++n)t.set(r.value(n),Xr.getRow(e.chem_comp,n));else{var i=dO(e);i.forEach(function(o){t.set(o,QK(o))})}return t}function Fre(e){var t=new Map;if(e.pdbx_chem_comp_identifier._rowCount>0){for(var r=e.pdbx_chem_comp_identifier,n=r.comp_id,a=r.type,i=r.identifier,o=0,s=n.rowCount;o<s;++o)if(a.value(o)==="SNFG CARBOHYDRATE SYMBOL"||a.value(o)==="SNFG CARB SYMBOL"){var u=i.value(o),l=kK.get(u);l?t.set(n.value(o),l):console.warn("Unknown SNFG name '"+u+"'")}}if(e.chem_comp._rowCount>0)for(var c=e.chem_comp,d=c.id,a=c.type,o=0,s=d.rowCount;o<s;++o){var f=d.value(o);if(!t.has(f)){var p=a.value(o);bd.has(f)?t.set(f,bd.get(f)):Ip(p,f)===9&&t.set(f,s6)}}else{var h=dO(e);bd.forEach(function(v,m){!t.has(m)&&h.has(m)&&t.set(m,v)})}return t}var dO=$y(function(e){for(var t=new Set,r=e.atom_site,n=r.label_comp_id,a=r.auth_comp_id,i=n.isDefined?n:a,o=0,s=i.rowCount;o<s;++o)t.add(i.value(o));return t});function kre(e){for(var t=new Map,r=e.atom_site,n=r.label_asym_id,a=r.auth_asym_id,i=r.label_entity_id,o=0,s=n.rowCount;o<s;++o){var u=n.value(o);t.has(u)||t.set(u,{id:u,auth_id:a.value(o),entity_id:i.value(o)})}if(e.struct_asym._rowCount>0)for(var l=e.struct_asym,u=l.id,c=l.entity_id,o=0,s=u.rowCount;o<s;++o){var d=u.value(o);t.has(d)||t.set(d,{id:d,auth_id:"",entity_id:c.value(o)})}return t}function Bre(e){return{missingResidues:Rre(e),chemicalComponentMap:Ore(e),saccharideComponentMap:Fre(e),structAsymMap:kre(e)}}var Lre=ve.Schema.Aliased(ve.Schema.Str(""));function fO(e,t){var r,n;if(e.entity.id.isDefined)n=e.entity;else{for(var a=new Set,i=[],o=[],s=e.atom_site,u=s.label_entity_id,l=s.label_comp_id,c=0,d=e.atom_site._rowCount;c<d;c++){var f=u.value(c);a.has(f)||(i.push(f),o.push(ZK(l.value(c))),a.add(f))}for(var p=e.ihm_sphere_obj_site.entity_id,c=0,d=e.ihm_sphere_obj_site._rowCount;c<d;c++){var f=p.value(c);a.has(f)||(i.push(f),o.push("polymer"),a.add(f))}for(var h=e.ihm_gaussian_obj_site.entity_id,c=0,d=e.ihm_gaussian_obj_site._rowCount;c<d;c++){var f=h.value(c);a.has(f)||(i.push(f),o.push("polymer"),a.add(f))}n=Xr.ofPartialColumns(ui.entity,{id:ve.ofArray({array:i,schema:ui.entity.id}),type:ve.ofArray({array:o,schema:ui.entity.type})},i.length)}var v=ve.createIndexer(n.id),m=new Array(n._rowCount);m.fill("other");var g=new Set,y=!1;if(e.entity_poly&&e.entity_poly.type.isDefined)for(var b=e.entity_poly,x=b.entity_id,S=b.type,_=b._rowCount,c=0;c<_;++c){var f=x.value(c);m[v(f)]=S.value(c),g.add(f)}else y=!0;if(e.pdbx_entity_branch&&e.pdbx_entity_branch.entity_id.isDefined)for(var A=e.pdbx_entity_branch,x=A.entity_id,S=A.type,_=A._rowCount,c=0;c<_;++c){var f=x.value(c);m[v(f)]=S.value(c),g.add(f)}else y=!0;if(g.size<m.length&&(y=!0),y){var T=new Map;if(e.chem_comp)for(var I=e.chem_comp,M=I.id,S=I.type,c=0,d=e.chem_comp._rowCount;c<d;c++)T.set(M.value(c),S.value(c));if(e.atom_site)for(var O=e.atom_site,u=O.label_entity_id,l=O.label_comp_id,c=0,d=e.atom_site._rowCount;c<d;c++){var f=u.value(c);if(!g.has(f)){var D=l.value(c),F=T.get(D)||"";m[v(f)]=JK(D,F),g.add(f)}}}var G=ve.ofArray({array:m,schema:Lre}),N=new Array(n._rowCount);if(N.fill(""),e.pdbx_molecule&&e.pdbx_molecule.prd_id.isDefined)for(var z=e.pdbx_molecule,$=z.asym_id,j=z.prd_id,_=z._rowCount,c=0;c<_;++c){var Z=$.value(c),f=(r=t.structAsymMap.get(Z))===null||r===void 0?void 0:r.entity_id;f!==void 0&&(N[v(f)]=j.value(c))}var q=ve.ofArray({array:N,schema:ve.Schema.str});return{data:n,subtype:G,prd_id:q,getEntityIndex:v}}function Nre(e,t){var r=t.ihm_model_group,n=t.ihm_model_group_link,a=Xr.pickRow(n,function(o){return n.model_id.value(o)===e});if(a){var i=Xr.pickRow(r,function(o){return r.id.value(o)===a.group_id});if(i)return i.name}return""}var kd=function(){function e(t){this.frames=t,this.frameCount=t.length,this.representative=t[0],this.duration=t.length}return e.prototype.getFrameAtIndex=function(t){return this.frames[t]},e}();function al(e,t,r){return ce(this,void 0,void 0,function(){var n,a,i,o;return de(this,function(s){switch(s.label){case 0:return n=Bre(e),e.ihm_model_list._rowCount>0?[4,Hre(r,e,n,t)]:[3,2];case 1:return i=s.sent(),[3,4];case 2:return[4,Vre(r,e,n,t)];case 3:i=s.sent(),s.label=4;case 4:for(a=i,o=0;o<a.length;o++)jt.TrajectoryInfo.set(a[o],{index:o,size:a.length});return[2,new kd(a)]}})})}function Ure(e,t,r,n,a,i,o){var s=oO(t,r,n,a.chemicalComponentMap,i,o),u=t.pdbx_PDB_model_num.value(0);if(o&&s.sameAsPrevious)return w(w({},o),{id:un.create22(),modelNum:u,atomicConformation:s.conformation,_dynamicPropertyData:Object.create(null)});var l=sO,c=uO(e,n,s.hierarchy,l.hierarchy),d=cO(s.hierarchy,n,s.conformation,c),f=e.entry.id.valueKind(0)===0?e.entry.id.value(0):i.name,p=[];return f&&p.push(f),e.struct.title.valueKind(0)===0&&p.push(e.struct.title.value(0)),{id:un.create22(),entryId:f,label:p.join(" | "),entry:f,sourceData:i,modelNum:u,parent:void 0,entities:n,sequence:c,atomicHierarchy:s.hierarchy,atomicConformation:s.conformation,atomicRanges:d,atomicChainOperatorMappinng:s.chainOperatorMapping,coarseHierarchy:l.hierarchy,coarseConformation:l.conformation,properties:a,customProperties:new Ks,_staticPropertyData:Object.create(null),_dynamicPropertyData:Object.create(null)}}function zre(e,t,r,n){var a=oO(t.atom_site,t.atom_site_sourceIndex,t.entities,r.chemicalComponentMap,n),i=Are(t,r),o=uO(e,t.entities,a.hierarchy,i.hierarchy),s=cO(a.hierarchy,t.entities,a.conformation,o),u=e.entry.id.valueKind(0)===0?e.entry.id.value(0):n.name,l=[];return u&&l.push(u),e.struct.title.valueKind(0)===0&&l.push(e.struct.title.value(0)),t.model_name&&l.push(t.model_name),t.model_group_name&&l.push(t.model_group_name),{id:un.create22(),entryId:u,label:l.join(" | "),entry:u,sourceData:n,modelNum:t.model_id,parent:void 0,entities:t.entities,sequence:o,atomicHierarchy:a.hierarchy,atomicConformation:a.conformation,atomicRanges:s,atomicChainOperatorMappinng:a.chainOperatorMapping,coarseHierarchy:i.hierarchy,coarseConformation:i.conformation,properties:r,customProperties:new Ks,_staticPropertyData:Object.create(null),_dynamicPropertyData:Object.create(null)}}function pO(e,t){var r=e.rowCount;if(!e.isDefined)return r;for(var n=t+1;n<r&&e.areValuesEqual(t,n);)n++;return n}function Vre(e,t,r,n){return ce(this,void 0,void 0,function(){var a,i,o,s,u,l,c,d,f;return de(this,function(p){switch(p.label){case 0:if(a=[],!t.atom_site)return[3,3];i=t.atom_site.id.rowCount,o=fO(t,r),s=0,p.label=1;case 1:return s<i?(u=pO(t.atom_site.pdbx_PDB_model_num,s),[4,lO(e,t.atom_site,s,u)]):[3,3];case 2:return l=p.sent(),c=l.atom_site,d=l.sourceIndex,f=Ure(t,c,d,o,r,n,a.length>0?a[a.length-1]:void 0),a.push(f),s=u,[3,1];case 3:return[2,a]}})})}function $b(e,t){for(var r=new Map,n=e._rowCount,a=0;a<n;){var i=pO(t,a),o=t.value(a);r.set(o,{table:Xr.window(e,e._schema,a,i),start:a,end:i}),a=i}return r}function Hre(e,t,r,n){return ce(this,void 0,void 0,function(){var a,i,o,s,u,l,c,d,f,p,h,v,m,g,y,b,x,S,_;return de(this,function(A){switch(A.label){case 0:if(a=fO(t,r),i=t.atom_site.ihm_model_id.isDefined?t.atom_site.ihm_model_id:t.atom_site.pdbx_PDB_model_num,o=$b(t.atom_site,i),s=$b(t.ihm_sphere_obj_site,t.ihm_sphere_obj_site.model_id),u=$b(t.ihm_gaussian_obj_site,t.ihm_gaussian_obj_site.model_id),l=[],!t.ihm_model_list)return[3,6];c=t.ihm_model_list,d=c.model_id,f=c.model_name,p=0,A.label=1;case 1:return p<t.ihm_model_list._rowCount?(h=d.value(p),v=void 0,m=void 0,o.has(h)?(g=o.get(h),[4,lO(e,t.atom_site,g.start,g.end)]):[3,3]):[3,6];case 2:return y=A.sent(),b=y.atom_site,x=y.sourceIndex,v=b,m=x,[3,4];case 3:v=Xr.window(t.atom_site,t.atom_site._schema,0,0),m=ve.ofIntArray([]),A.label=4;case 4:S={model_id:h,model_name:f.value(p),model_group_name:Nre(h,t),entities:a,atom_site:v,atom_site_sourceIndex:m,ihm_sphere_obj_site:s.has(h)?s.get(h).table:Xr.window(t.ihm_sphere_obj_site,t.ihm_sphere_obj_site._schema,0,0),ihm_gaussian_obj_site:u.has(h)?u.get(h).table:Xr.window(t.ihm_gaussian_obj_site,t.ihm_gaussian_obj_site._schema,0,0)},_=zre(t,S,r,n),l.push(_),A.label=5;case 5:return p++,[3,1];case 6:return[2,l]}})})}var Bd;(function(e){function t(n){var a=this,i=n.descriptor.name,o=n.type==="static"?"_staticPropertyData":"_dynamicPropertyData",s=function(l){return i in l[o]||(l[o][i]={props:w({},E.getDefaultValues(n.getParams(l))),data:fc.create(void 0)}),l[o][i]},u=function(l,c,d){var f=s(l);l[o][i]={props:c,data:fc.withValue(f.data,d)}};return{label:n.label,descriptor:n.descriptor,isHidden:n.isHidden,getParams:function(l){var c=E.clone(n.getParams(l));return E.setDefaultValues(c,s(l).props),c},defaultParams:n.defaultParams,isApplicable:n.isApplicable,attach:function(l,c,d,f){return d===void 0&&(d={}),ce(a,void 0,void 0,function(){var p,h,v,m,g;return de(this,function(y){switch(y.label){case 0:return f&&c.customProperties.reference(n.descriptor,!0),p=s(c),h=E.merge(n.defaultParams,p.props,d),p.data.value&&E.areEqual(n.defaultParams,p.props,h)?[2]:[4,n.obtain(l,c,h)];case 1:return v=y.sent(),m=v.value,g=v.assets,c.customProperties.add(n.descriptor),c.customProperties.assets(n.descriptor,g),u(c,h,m),[2]}})})},ref:function(l,c){return l.customProperties.reference(n.descriptor,c)},get:function(l){var c;return(c=s(l))===null||c===void 0?void 0:c.data},set:function(l,c){c===void 0&&(c={});var d=s(l),f=E.merge(n.defaultParams,d.props,c);E.areEqual(n.defaultParams,d.props,f)||(u(l,f,void 0),l.customProperties.assets(n.descriptor))},props:function(l){return s(l).props}}}e.createProvider=t;function r(n,a,i){var o=this,s={value:E.Value(i,{isHidden:!0})};return t({label:ji(n),descriptor:Pi({name:n}),isHidden:!0,type:a,defaultParams:s,getParams:function(){return{value:E.Value(i,{isHidden:!0})}},isApplicable:function(){return!0},obtain:function(u,l,c){return ce(o,void 0,void 0,function(){var d;return de(this,function(f){return[2,{value:(d=c.value)!==null&&d!==void 0?d:i}]})})}})}e.createSimple=r})(Bd||(Bd={}));var jt;(function(e){function t(N,z){for(var $=[],j=z.frames,Z=N.atomicHierarchy.atomSourceIndex,q=ve.isIdentity(Z),te=q?void 0:Z.toArray({array:Int32Array}),he=0,W=j.length;he<W;++he){var K=j[he],U=w(w({},N),{id:un.create22(),modelNum:he,atomicConformation:fv.getAtomicConformation(K,N.atomicConformation.atomId,te),customProperties:new Ks,_staticPropertyData:Object.create(null),_dynamicPropertyData:Object.create(null)});if(K.cell){var H=qn.fromCell(K.cell.size,K.cell.anglesInRadians);qn.Provider.set(U,H)}e.TrajectoryInfo.set(U,{index:he,size:j.length}),$.push(U)}return{trajectory:$,srcIndexArray:te}}function r(N,z){return new kd(t(N,z).trajectory)}e.trajectoryFromModelAndCoordinates=r;function n(N,z){var $=this;return We.create("Create Trajectory",function(j){return ce($,void 0,void 0,function(){var Z,q,te,he,W,K,U,H,J;return de(this,function(X){switch(X.label){case 0:return[4,al(N.basic,N.sourceData,j)];case 1:if(Z=X.sent(),Z.frameCount===0)throw new Error("found no model");for(q=Z.representative,te=t(q,z).trajectory,he={pairs:N.bonds,count:q.atomicHierarchy.atoms._rowCount},W=Ba.fromData(he),K=0,U=0,H=te;U<H.length;U++)J=H[U],Ba.Provider.set(J,W),e.TrajectoryInfo.set(J,{index:K++,size:te.length});return[2,new kd(te)]}})})})}e.trajectoryFromTopologyAndCoordinates=n;var a="__Center__";function i(N){if(N._dynamicPropertyData[a])return N._dynamicPropertyData[a];var z=hK(N.atomicConformation,N.coarseConformation);return N._dynamicPropertyData[a]=z,z}e.getCenter=i;function o(N){for(var z=new Int32Array(N.rowCount),$=!1,j=0,Z=N.rowCount;j<Z;j++){var q=N.value(j);q!==j&&($=!1),z[q]=j}return{isIdentity:$,invertedIndex:z}}var s="__InvertedAtomSrcIndex__";function u(N){if(N._staticPropertyData[s])return N._staticPropertyData[s];var z=o(N.atomicHierarchy.atomSourceIndex);return N._staticPropertyData[s]=z,z}e.getInvertedAtomSourceIndex=u;var l="__TrajectoryInfo__";e.TrajectoryInfo={get:function(N){return N._dynamicPropertyData[l]||{index:0,size:1}},set:function(N,z){return N._dynamicPropertyData[l]=z}};var c="__AsymIdCount__";e.AsymIdCount={get:function(N){if(N._dynamicPropertyData[c])return N._dynamicPropertyData[c];var z=vK(N);return N._dynamicPropertyData[c]=z,z}},e.AsymIdOffset=Bd.createSimple("asym_id_offset","static"),e.Index=Bd.createSimple("index","static");function d(N){return N.parent||N}e.getRoot=d;function f(N,z){return N.atomicHierarchy===z.atomicHierarchy&&N.coarseHierarchy===z.coarseHierarchy}e.areHierarchiesEqual=f;var p="__CoordinatesHistory__";e.CoordinatesHistory={get:function(N){return N._staticPropertyData[p]},set:function(N,z){return N._staticPropertyData[p]=z}};var h="__CoarseGrained__";function v(N){if(N._staticPropertyData[h]!==void 0)return N._staticPropertyData[h];for(var z=0,$=N.atomicHierarchy.derived.residue.polymerType,j=0;j<$.length;++j)$[j]!==0&&(z+=1);for(var Z=!1,q=!1,te=N.atomicHierarchy.atoms,he=te.label_atom_id,W=te._rowCount,j=0;j<W;++j){var K=he.value(j);if(!Z&&K==="BB"&&(Z=!0),!q&&K==="SC1"&&(q=!0),Z&&q)break}var U=Z&&q||(z&&W?W/z<3:!1);return N._staticPropertyData[h]=U,U}e.isCoarseGrained=v;function m(N){return N.properties.saccharideComponentMap.size>0}e.hasCarbohydrate=m;function g(N){for(var z=N.entities.subtype,$=0,j=z.rowCount;$<j;++$)if(z.value($).startsWith("polypeptide"))return!0;return!1}e.hasProtein=g;function y(N){for(var z=N.entities.subtype,$=0,j=z.rowCount;$<j;++$){var Z=z.value($);if(Z.endsWith("ribonucleotide hybrid")||Z.endsWith("ribonucleotide"))return!0}return!1}e.hasNucleic=y;function b(N){if(!Jr.is(N.sourceData))return!1;var z=N.sourceData.data.db;return z.database_2.database_id.isDefined||N.entryId.match(/^[1-9][a-z0-9]{3,3}$/i)!==null||N.entryId.match(/^pdb_[0-9]{4,4}[1-9][a-z0-9]{3,3}$/i)!==null}e.isFromPdbArchive=b;function x(N){if(!Jr.is(N.sourceData))return!1;var z=N.sourceData.data.db;return z.struct_conf.id.isDefined||z.struct_sheet_range.id.isDefined}e.hasSecondaryStructure=x;var S=C.create(1.5707963,1.5707963,1.5707963),_=C.create(1,1,1);function A(N){var z,$=(z=qn.Provider.get(N))===null||z===void 0?void 0:z.spacegroup;return!!$&&!($.num===1&&C.equals($.cell.anglesInRadians,S)&&C.equals($.cell.size,_))}e.hasCrystalSymmetry=A;function T(N){if(!Jr.is(N.sourceData))return!1;for(var z=N.sourceData.data.db,$=0;$<z.exptl.method.rowCount;$++){var j=z.exptl.method.value($).toUpperCase();if(j.indexOf("DIFFRACTION")>=0)return!0}return!1}e.isFromXray=T;function I(N){if(!Jr.is(N.sourceData))return!1;for(var z=N.sourceData.data.db,$=0;$<z.exptl.method.rowCount;$++){var j=z.exptl.method.value($).toUpperCase();if(j.indexOf("MICROSCOPY")>=0)return!0}return!1}e.isFromEm=I;function M(N){if(!Jr.is(N.sourceData))return!1;for(var z=N.sourceData.data.db,$=0;$<z.exptl.method.rowCount;$++){var j=z.exptl.method.value($).toUpperCase();if(j.indexOf("NMR")>=0)return!0}return!1}e.isFromNmr=M;function O(N){if(!Jr.is(N.sourceData)||!T(N))return!1;var z=N.sourceData.data.db,$=z.pdbx_database_status.status_code_sf;return $.isDefined&&$.value(0)==="REL"}e.hasXrayMap=O;function D(N){if(!Jr.is(N.sourceData))return!1;for(var z=N.sourceData.data.db,$=z.pdbx_database_related,j=$.db_name,Z=$.content_type,q=0,te=z.pdbx_database_related._rowCount;q<te;++q)if(j.value(q).toUpperCase()==="EMDB"&&Z.value(q)==="associated EM volume")return!0;return!1}e.hasEmMap=D;function F(N){return Jr.is(N.sourceData)?O(N)||D(N):!1}e.hasDensityMap=F;function G(N){if(!Jr.is(N.sourceData))return!1;var z=N.sourceData.data.db;return F(N)||b(N)&&(!z.exptl.method.isDefined||T(N)&&(!z.pdbx_database_status.status_code_sf.isDefined||z.pdbx_database_status.status_code_sf.valueKind(0)===2)||I(N)&&!z.pdbx_database_related.db_name.isDefined)}e.probablyHasDensityMap=G})(jt||(jt={}));var zx;(function(e){function t(d,f,p){if(!f)return{rowCount:0};if(p&&p[f.id])return p[f.id];var h=f.getElements(d),v={data:h,rowCount:h.elements.length};return p&&(p[f.id]=v),v}e.getCifDataSource=t;function r(d){return new AT(d)}e.fromAtomMap=r;function n(d){return new AT(Qb(d))}e.fromAtomArray=n;var a=function(d){return d.atomicHierarchy.residueAtomSegments};function i(d){return new Dm("residue",d,a,0)}e.fromResidueMap=i;function o(d){return new Dm("residue",Qb(d),a,0)}e.fromResidueArray=o;var s=function(d){return d.atomicHierarchy.chainAtomSegments};function u(d){return new Dm("chain",d,s,0)}e.fromChainMap=u;function l(d){return new Dm("chain",Qb(d),s,0)}e.fromChainArray=l;function c(d){return new Gre(d)}e.fromEntityMap=c})(zx||(zx={}));function Qb(e){for(var t=new Map,r=0,n=e.length;r<n;r++)t.set(r,e[r]);return t}var Dm=function(){function e(t,r,n,a){this.level=t,this.map=r,this.segmentGetter=n,this.id=un.create22(),this.kind=a}return e.prototype.has=function(t){return this.map.has(t)},e.prototype.get=function(t){return this.map.get(t)},e.prototype.getStructureElements=function(t){var r=t.models;if(r.length!==1)throw new Error("Only works on structures with a single model.");for(var n=new Set,a=t.unitSymmetryGroups,i=[],o=this.segmentGetter(r[0]),s=0,u=a;s<u.length;s++){var l=u[s],c=l.units[0];if(c.kind===this.kind)for(var d=nr.transientSegments(o,c.elements);d.hasNext;){var f=d.move();!this.has(f.index)||n.has(f.index)||(n.add(f.index),i[i.length]=Ze.create(t,c,c.elements[f.start]))}}return i.sort(function(p,h){return p.element-h.element}),i},e.prototype.getElements=function(t){var r=this,n=this.segmentGetter(t.model).index,a=this.getStructureElements(t);return{elements:a,property:function(i){return r.get(n[a[i].element])}}},e}(),AT=function(){function e(t){this.map=t,this.id=un.create22(),this.level="atom",this.kind=0}return e.prototype.has=function(t){return this.map.has(t)},e.prototype.get=function(t){return this.map.get(t)},e.prototype.getStructureElements=function(t){var r=t.models;if(r.length!==1)throw new Error("Only works on structures with a single model.");for(var n=new Set,a=t.unitSymmetryGroups,i=[],o=0,s=a;o<s.length;o++){var u=s[o],l=u.units[0];if(l.kind===this.kind)for(var c=l.elements,d=0,f=c.length;d<f;d++){var p=c[d];!this.has(p)||n.has(p)||(n.add(c[d]),i[i.length]=Ze.create(t,l,p))}}return i.sort(function(h,v){return h.element-v.element}),i},e.prototype.getElements=function(t){var r=this,n=this.getStructureElements(t);return{elements:n,property:function(a){return r.get(n[a].element)}}},e}(),Gre=function(){function e(t){this.map=t,this.id=un.create22(),this.level="entity",this.kind=0}return e.prototype.has=function(t){return this.map.has(t)},e.prototype.get=function(t){return this.map.get(t)},e.prototype.getStructureElements=function(t){var r=t.models;if(r.length!==1)throw new Error("Only works on structures with a single model.");for(var n=r[0].atomicHierarchy.index,a=new Set,i=t.unitSymmetryGroups,o=[],s=r[0].atomicHierarchy.chainAtomSegments,u=0,l=i;u<l.length;u++){var c=l[u],d=c.units[0];if(d.kind===this.kind)for(var f=nr.transientSegments(s,d.elements);f.hasNext;){var p=f.move(),h=n.getEntityFromChain(p.index);!this.has(h)||a.has(h)||(a.add(h),o[o.length]=Ze.create(t,d,d.elements[p.start]))}}return o.sort(function(v,m){return v.element-m.element}),o},e.prototype.getElements=function(t){var r=this,n=this.getStructureElements(t),a=t.model.atomicHierarchy.chainAtomSegments.index,i=t.model.atomicHierarchy.index;return{elements:n,property:function(o){return r.get(i.getEntityFromChain(a[n[o].element]))}}},e}(),qre=function(){function e(){this.map=new Map}return e.prototype.removeSymbol=function(t){this.map.delete(t.symbol.id)},e.prototype.addSymbol=function(t){this.map.has(t.symbol.id)&&console.warn("Symbol '"+t.symbol.id+"' already added. Call removeSymbol/removeCustomProps re-adding the symbol."),this.map.set(t.symbol.id,t)},e.prototype.addCustomProp=function(t){if(!!t.symbols)for(var r=0,n=Object.keys(t.symbols);r<n.length;r++){var a=n[r];this.addSymbol(t.symbols[a])}},e.prototype.removeCustomProp=function(t){if(!!t.symbols)for(var r=0,n=Object.keys(t.symbols);r<n.length;r++){var a=n[r];this.removeSymbol(t.symbols[a])}},e.prototype.getRuntime=function(t){return this.map.get(t)},e}(),_g=new qre,jre=function(){function e(t){this.table=t,this.constQueryContext=new Qi(Xe.Empty)}return e}(),PT;(function(e){function t(n){return{kind:"const",value:n}}e.Const=t;function r(n){return{kind:"dynamic",runtime:n}}e.Dynamic=r})(PT||(PT={}));var xd;(function(e){function t(n){return{isConst:!0,fn:function(i){return n}}}e.Const=t;function r(n){return{isConst:!1,fn:n}}e.Dynamic=r})(xd||(xd={}));var Wh;(function(e){function t(r,n,a,i){if(typeof r.length=="number")for(var o=0,s=r.length;o<s;o++)a(r[o](n),o,i);else for(var o=0,u=0,l=Object.keys(r);u<l.length;u++){var c=l[u];a(r[c](n),o++,i)}return i}e.forEachEval=t})(Wh||(Wh={}));var mp;(function(e){function t(n,a){return new TT(n,a,!0)}e.Const=t;function r(n,a){return new TT(n,a,!1)}e.Dynamic=r})(mp||(mp={}));var TT=function(){function e(t,r,n){this.symbol=t,this.fn=r,this.isConst=n}return e.prototype.compile=function(t,r){var n,a=!1;if(!r)n=void 0,a=!0;else if(na.isArgumentsArray(r)){n=[],a=!1;for(var i=0,o=r;i<o.length;i++){var s=o[i],u=Vx(t,s);a=a&&u.isConst,n.push(u.fn)}}else{n=Object.create(null),a=!1;for(var l=0,c=Object.keys(r);l<c.length;l++){var d=c[l],u=Vx(t,r[d]);a=a&&u.isConst,n[d]=u.fn}}return this.isConst?this.isConst&&a?xd.Const(this.fn(t.constQueryContext,n)):xd.Dynamic(ET(this.fn,n)):xd.Dynamic(ET(this.fn,n))},e}();function ET(e,t){return function(n){return e(n,t)}}function Vx(e,t){if(na.isLiteral(t))return xd.Const(t);if(na.isSymbol(t)){var r=e.table.getRuntime(t.name);return r?r.compile(e):xd.Const(t.name)}if(!na.isSymbol(t.head))throw new Error("Can only apply symbols.");var n=e.table.getRuntime(t.head.name);if(!n)throw new Error("Symbol '"+t.head.name+"' is not implemented.");return n.compile(e,t.args)}function Ld(e){var t=new jre(_g);return Vx(t,e).fn}var Qt=mp.Const,zt=mp.Dynamic,Wre=[Qt(Ce.core.type.bool,function(t,r){return!!r[0](t)}),Qt(Ce.core.type.num,function(t,r){return+r[0](t)}),Qt(Ce.core.type.str,function(t,r){return""+r[0](t)}),Qt(Ce.core.type.list,function(t,r){return Wh.forEachEval(r,t,function(n,a,i){return i[a]=n},[])}),Qt(Ce.core.type.set,function(t,r){return Wh.forEachEval(r,t,function(a,i,o){return o.add(a)},new Set)}),Qt(Ce.core.type.regex,function(t,r){return new RegExp(r[0](t),r[1]&&r[1](t)||"")}),Qt(Ce.core.type.bitflags,function(t,r){return+r[0](t)}),Qt(Ce.core.type.compositeKey,function(t,r){return Wh.forEachEval(r,t,function(n,a,i){return i[a]=""+n},[]).join("-")}),Qt(Ce.core.logic.not,function(e,t){return!t[0](e)}),Qt(Ce.core.logic.and,function(e,t){if(typeof t.length=="number"){for(var r=0,n=t.length;r<n;r++)if(!t[r](e))return!1}else for(var a=0,i=Object.keys(t);a<i.length;a++){var o=i[a];if(!t[o](e))return!1}return!0}),Qt(Ce.core.logic.or,function(e,t){if(typeof t.length=="number"){for(var r=0,n=t.length;r<n;r++)if(t[r](e))return!0}else for(var a=0,i=Object.keys(t);a<i.length;a++){var o=i[a];if(t[o](e))return!0}return!1}),Qt(Ce.core.rel.eq,function(e,t){return t[0](e)===t[1](e)}),Qt(Ce.core.rel.neq,function(e,t){return t[0](e)!==t[1](e)}),Qt(Ce.core.rel.lt,function(e,t){return t[0](e)<t[1](e)}),Qt(Ce.core.rel.lte,function(e,t){return t[0](e)<=t[1](e)}),Qt(Ce.core.rel.gr,function(e,t){return t[0](e)>t[1](e)}),Qt(Ce.core.rel.gre,function(e,t){return t[0](e)>=t[1](e)}),Qt(Ce.core.rel.inRange,function(e,t){var r=t[0](e);return r>=t[1](e)&&r<=t[2](e)}),Qt(Ce.core.math.add,function(e,t){var r=0;if(typeof t.length=="number")for(var n=0,a=t.length;n<a;n++)r+=t[n](e);else for(var i=0,o=Object.keys(t);i<o.length;i++){var s=o[i];r+=t[s](e)}return r}),Qt(Ce.core.math.sub,function(e,t){var r=0;if(typeof t.length=="number"){if(t.length===1)return-t[0](e);r=t[0](e)||0;for(var n=1,a=t.length;n<a;n++)r-=t[n](e)}else{var i=Object.keys(t);if(i.length===1)return-t[i[0]](e);r=t[i[0]](e)||0;for(var n=1,a=i.length;n<a;n++)r-=t[i[n]](e)}return r}),Qt(Ce.core.math.mult,function(e,t){var r=1;if(typeof t.length=="number")for(var n=0,a=t.length;n<a;n++)r*=t[n](e);else for(var i=0,o=Object.keys(t);i<o.length;i++){var s=o[i];r*=t[s](e)}return r}),Qt(Ce.core.math.div,function(e,t){return t[0](e)/t[1](e)}),Qt(Ce.core.math.pow,function(e,t){return Math.pow(t[0](e),t[1](e))}),Qt(Ce.core.math.mod,function(e,t){return t[0](e)%t[1](e)}),Qt(Ce.core.math.min,function(e,t){var r=Number.POSITIVE_INFINITY;if(typeof t.length=="number")for(var n=0,a=t.length;n<a;n++)r=Math.min(t[n](e),r);else for(var i=0,o=Object.keys(t);i<o.length;i++){var s=o[i];r=Math.min(t[s](e),r)}return r}),Qt(Ce.core.math.max,function(e,t){var r=Number.NEGATIVE_INFINITY;if(typeof t.length=="number")for(var n=0,a=t.length;n<a;n++)r=Math.max(t[n](e),r);else for(var i=0,o=Object.keys(t);i<o.length;i++){var s=o[i];r=Math.max(t[s](e),r)}return r}),Qt(Ce.core.math.floor,function(e,t){return Math.floor(t[0](e))}),Qt(Ce.core.math.ceil,function(e,t){return Math.ceil(t[0](e))}),Qt(Ce.core.math.roundInt,function(e,t){return Math.round(t[0](e))}),Qt(Ce.core.math.abs,function(e,t){return Math.abs(t[0](e))}),Qt(Ce.core.math.sqrt,function(e,t){return Math.sqrt(t[0](e))}),Qt(Ce.core.math.cbrt,function(e,t){return Math.cbrt(t[0](e))}),Qt(Ce.core.math.sin,function(e,t){return Math.sin(t[0](e))}),Qt(Ce.core.math.cos,function(e,t){return Math.cos(t[0](e))}),Qt(Ce.core.math.tan,function(e,t){return Math.tan(t[0](e))}),Qt(Ce.core.math.asin,function(e,t){return Math.asin(t[0](e))}),Qt(Ce.core.math.acos,function(e,t){return Math.acos(t[0](e))}),Qt(Ce.core.math.atan,function(e,t){return Math.atan(t[0](e))}),Qt(Ce.core.math.sinh,function(e,t){return Math.sinh(t[0](e))}),Qt(Ce.core.math.cosh,function(e,t){return Math.cosh(t[0](e))}),Qt(Ce.core.math.tanh,function(e,t){return Math.tanh(t[0](e))}),Qt(Ce.core.math.exp,function(e,t){return Math.exp(t[0](e))}),Qt(Ce.core.math.log,function(e,t){return Math.log(t[0](e))}),Qt(Ce.core.math.log10,function(e,t){return Math.log10(t[0](e))}),Qt(Ce.core.math.atan2,function(e,t){return Math.atan2(t[0](e),t[1](e))}),Qt(Ce.core.str.match,function(e,t){return t[0](e).test(t[1](e))}),Qt(Ce.core.str.concat,function(e,t){var r=[];if(typeof t.length=="number")for(var n=0,a=t.length;n<a;n++)r.push(t[n](e).toString());else for(var i=0,o=Object.keys(t);i<o.length;i++){var s=o[i];r.push(t[s](e).toString())}return r.join("")}),Qt(Ce.core.list.getAt,function(e,t){return t[0](e)[t[1](e)]}),Qt(Ce.core.list.equal,function(e,t){return L_(t[0](e),t[1](e))}),Qt(Ce.core.set.has,function(t,r){return r[0](t).has(r[1](t))}),Qt(Ce.core.set.isSubset,function(t,r){return jn.isSuperset(r[1](t),r[0](t))}),Qt(Ce.core.flags.hasAny,function(e,t){var r=t[1](e),n=t[0](e);return r?(n&r)!==0:!!n}),Qt(Ce.core.flags.hasAll,function(e,t){var r=t[1](e),n=t[0](e);return r?(n&r)===r:!n}),Qt(Ce.structureQuery.type.elementSymbol,function(e,t){return Ep(t[0](e))}),Qt(Ce.structureQuery.type.atomName,function(e,t){return YH(t[0](e))}),Qt(Ce.structureQuery.type.bondFlags,function(e,t){var r=0;if(typeof t.length=="number")for(var n=0,a=t.length;n<a;n++)r=IT(r,t[n](e));else for(var i=0,o=Object.keys(t);i<o.length;i++){var s=o[i];r=IT(r,t[s](e))}return r}),Qt(Ce.structureQuery.type.ringFingerprint,function(e,t){return xo.elementFingerprint(Xre(e,t))}),Qt(Ce.structureQuery.type.secondaryStructureFlags,function(e,t){var r=0;if(typeof t.length=="number")for(var n=0,a=t.length;n<a;n++)r=MT(r,t[n](e));else for(var i=0,o=Object.keys(t);i<o.length;i++){var s=o[i];r=MT(r,t[s](e))}return r}),zt(Ce.structureQuery.filter.pick,function(e,t){return Zr.filters.pick(t[0],t.test)(e)}),zt(Ce.structureQuery.filter.first,function(e,t){return Zr.filters.first(t[0])(e)}),zt(Ce.structureQuery.filter.withSameAtomProperties,function(e,t){return Zr.filters.withSameAtomProperties(t[0],t.source,t.property)(e)}),zt(Ce.structureQuery.filter.intersectedBy,function(e,t){return Zr.filters.areIntersectedBy(t[0],t.by)(e)}),zt(Ce.structureQuery.filter.within,function(e,t){return Zr.filters.within({query:t[0],target:t.target,minRadius:t["min-radius"],maxRadius:t["max-radius"],elementRadius:t["atom-radius"],invert:t.invert})(e)}),zt(Ce.structureQuery.filter.isConnectedTo,function(e,t){return Zr.filters.isConnectedTo({query:t[0],target:t.target,disjunct:t.disjunct,invert:t.invert,bondTest:t["bond-test"]})(e)}),zt(Ce.structureQuery.generator.atomGroups,function(t,r){return Zr.generators.atoms({entityTest:r["entity-test"],chainTest:r["chain-test"],residueTest:r["residue-test"],atomTest:r["atom-test"],groupBy:r["group-by"]})(t)}),zt(Ce.structureQuery.generator.all,function(t){return Zr.generators.all(t)}),zt(Ce.structureQuery.generator.empty,function(t){return Zr.generators.none(t)}),zt(Ce.structureQuery.generator.bondedAtomicPairs,function(t,r){return Zr.generators.bondedAtomicPairs(r&&r[0])(t)}),zt(Ce.structureQuery.generator.rings,function(t,r){var n,a;return Zr.generators.rings((n=r==null?void 0:r.fingerprint)===null||n===void 0?void 0:n.call(r,t),(a=r==null?void 0:r["only-aromatic"])===null||a===void 0?void 0:a.call(r,t))(t)}),zt(Ce.structureQuery.modifier.includeSurroundings,function(t,r){return Zr.modifiers.includeSurroundings(r[0],{radius:r.radius(t),wholeResidues:!!(r["as-whole-residues"]&&r["as-whole-residues"](t)),elementRadius:r["atom-radius"]})(t)}),zt(Ce.structureQuery.modifier.surroundingLigands,function(t,r){return Zr.modifiers.surroundingLigands({query:r[0],radius:r.radius(t),includeWater:!!(r["include-water"]&&r["include-water"](t))})(t)}),zt(Ce.structureQuery.modifier.wholeResidues,function(t,r){return Zr.modifiers.wholeResidues(r[0])(t)}),zt(Ce.structureQuery.modifier.union,function(t,r){return Zr.modifiers.union(r[0])(t)}),zt(Ce.structureQuery.modifier.expandProperty,function(t,r){return Zr.modifiers.expandProperty(r[0],r.property)(t)}),zt(Ce.structureQuery.modifier.exceptBy,function(t,r){return Zr.modifiers.exceptBy(r[0],r.by)(t)}),zt(Ce.structureQuery.modifier.includeConnected,function(t,r){var n,a;return Zr.modifiers.includeConnected({query:r[0],bondTest:r["bond-test"],wholeResidues:!!(r["as-whole-residues"]&&r["as-whole-residues"](t)),layerCount:r["layer-count"]&&r["layer-count"](t)||1,fixedPoint:(a=(n=r["fixed-point"])===null||n===void 0?void 0:n.call(r,t))!==null&&a!==void 0?a:!1})(t)}),zt(Ce.structureQuery.combinator.merge,function(e,t){return Zr.combinators.merge(t)(e)}),zt(Ce.structureQuery.atomProperty.core.elementSymbol,rn(ct.atom.type_symbol)),zt(Ce.structureQuery.atomProperty.core.vdw,function(e,t){return Mv(ct.atom.type_symbol(t&&t[0]&&t[0](e)||e.element))}),zt(Ce.structureQuery.atomProperty.core.mass,function(e,t){return PK(ct.atom.type_symbol(t&&t[0]&&t[0](e)||e.element))}),zt(Ce.structureQuery.atomProperty.core.atomicNumber,function(e,t){return Dv(ct.atom.type_symbol(t&&t[0]&&t[0](e)||e.element))}),zt(Ce.structureQuery.atomProperty.core.x,rn(ct.atom.x)),zt(Ce.structureQuery.atomProperty.core.y,rn(ct.atom.y)),zt(Ce.structureQuery.atomProperty.core.z,rn(ct.atom.z)),zt(Ce.structureQuery.atomProperty.core.sourceIndex,rn(ct.atom.sourceIndex)),zt(Ce.structureQuery.atomProperty.core.operatorName,rn(ct.unit.operator_name)),zt(Ce.structureQuery.atomProperty.core.modelIndex,rn(ct.unit.model_index)),zt(Ce.structureQuery.atomProperty.core.modelLabel,rn(ct.unit.model_label)),zt(Ce.structureQuery.atomProperty.core.atomKey,function(e,t){var r=t&&t[0]&&t[0](e)||e.element;return oc(r.unit.id,r.element)}),zt(Ce.structureQuery.atomProperty.macromolecular.residueKey,function(e,t){return cre(t&&t[0]&&t[0](e)||e.element)}),zt(Ce.structureQuery.atomProperty.macromolecular.chainKey,function(e,t){return dre(t&&t[0]&&t[0](e)||e.element)}),zt(Ce.structureQuery.atomProperty.macromolecular.entityKey,function(e,t){return fre(t&&t[0]&&t[0](e)||e.element)}),zt(Ce.structureQuery.atomProperty.macromolecular.id,rn(ct.atom.id)),zt(Ce.structureQuery.atomProperty.macromolecular.isHet,function(e,t){return ct.residue.group_PDB(t&&t[0]&&t[0](e)||e.element)!=="ATOM"}),zt(Ce.structureQuery.atomProperty.macromolecular.label_atom_id,rn(ct.atom.label_atom_id)),zt(Ce.structureQuery.atomProperty.macromolecular.label_alt_id,rn(ct.atom.label_alt_id)),zt(Ce.structureQuery.atomProperty.macromolecular.label_comp_id,rn(ct.atom.label_comp_id)),zt(Ce.structureQuery.atomProperty.macromolecular.label_seq_id,rn(ct.residue.label_seq_id)),zt(Ce.structureQuery.atomProperty.macromolecular.label_asym_id,rn(ct.chain.label_asym_id)),zt(Ce.structureQuery.atomProperty.macromolecular.label_entity_id,rn(ct.entity.id)),zt(Ce.structureQuery.atomProperty.macromolecular.auth_atom_id,rn(ct.atom.auth_atom_id)),zt(Ce.structureQuery.atomProperty.macromolecular.auth_comp_id,rn(ct.atom.auth_comp_id)),zt(Ce.structureQuery.atomProperty.macromolecular.auth_seq_id,rn(ct.residue.auth_seq_id)),zt(Ce.structureQuery.atomProperty.macromolecular.auth_asym_id,rn(ct.chain.auth_asym_id)),zt(Ce.structureQuery.atomProperty.macromolecular.pdbx_PDB_ins_code,rn(ct.residue.pdbx_PDB_ins_code)),zt(Ce.structureQuery.atomProperty.macromolecular.pdbx_formal_charge,rn(ct.atom.pdbx_formal_charge)),zt(Ce.structureQuery.atomProperty.macromolecular.occupancy,rn(ct.atom.occupancy)),zt(Ce.structureQuery.atomProperty.macromolecular.B_iso_or_equiv,rn(ct.atom.B_iso_or_equiv)),zt(Ce.structureQuery.atomProperty.macromolecular.entityType,rn(ct.entity.type)),zt(Ce.structureQuery.atomProperty.macromolecular.entitySubtype,rn(ct.entity.subtype)),zt(Ce.structureQuery.atomProperty.macromolecular.entityPrdId,rn(ct.entity.prd_id)),zt(Ce.structureQuery.atomProperty.macromolecular.entityDescription,rn(ct.entity.pdbx_description)),zt(Ce.structureQuery.atomProperty.macromolecular.objectPrimitive,rn(ct.unit.object_primitive)),zt(Ce.structureQuery.atomProperty.macromolecular.isNonStandard,rn(ct.residue.isNonStandard)),zt(Ce.structureQuery.atomProperty.macromolecular.secondaryStructureKey,rn(ct.residue.secondary_structure_key)),zt(Ce.structureQuery.atomProperty.macromolecular.secondaryStructureFlags,rn(ct.residue.secondary_structure_type)),zt(Ce.structureQuery.atomProperty.macromolecular.chemCompType,rn(ct.residue.chem_comp_type)),zt(Ce.structureQuery.bondProperty.order,function(e,t){return e.atomicBond.order}),zt(Ce.structureQuery.bondProperty.flags,function(e,t){return e.atomicBond.type}),zt(Ce.structureQuery.bondProperty.atomA,function(e,t){return e.atomicBond.a}),zt(Ce.structureQuery.bondProperty.atomB,function(e,t){return e.atomicBond.b}),zt(Ce.structureQuery.bondProperty.length,function(e,t){return e.atomicBond.length}),zt(Ce.internal.generator.bundleElement,function(t,r){return Z6(r.groupedUnits(t),r.ranges(t),r.set(t))}),zt(Ce.internal.generator.bundle,function(t,r){return J6(r.elements(t))(t)}),zt(Ce.internal.generator.current,function(t,r){return t.tryGetCurrentSelection()})];function rn(e){return function(t,r){return e(r&&r[0]&&r[0](t)||t.element)}}function IT(e,t){return e|(kr.isName(t)?kr.fromName(t):0)}function MT(e,t){switch(t.toLowerCase()){case"helix":return e|2;case"alpha":return e|2|4096;case"pi":return e|2|32768;case"310":return e|2|2048;case"beta":return e|4;case"strand":return e|4|4194304;case"sheet":return e|4|8388608;case"turn":return e|16;case"bend":return e|8;case"coil":return e|536870912;default:return e}}function Xre(e,t){var r=[];if(!t)return r;if(typeof t.length=="number")for(var n=0,a=t.length;n<a;n++)r.push(t[n](e));else for(var i=Object.keys(t),n=1,a=i.length;n<a;n++)r.push(t[i[n]](e));return r}(function(){for(var e=0,t=Wre;e<t.length;e++){var r=t[e];_g.addSymbol(r)}})();var rs;(function(e){function t(s){var u=new DataView(s.buffer);return Object.assign(s.subarray(0),{readInt8:function(l){return u.getInt8(l)},readUInt8:function(l){return u.getUint8(l)},writeInt8:function(l,c){return u.setInt8(c,l)},writeUInt8:function(l,c){return u.setUint8(c,l)},readInt16LE:function(l){return u.getInt16(l,!0)},readInt32LE:function(l){return u.getInt32(l,!0)},readUInt16LE:function(l){return u.getUint16(l,!0)},readUInt32LE:function(l){return u.getUint32(l,!0)},readFloatLE:function(l){return u.getFloat32(l,!0)},readDoubleLE:function(l){return u.getFloat64(l,!0)},writeInt16LE:function(l,c){return u.setInt16(c,l,!0)},writeInt32LE:function(l,c){return u.setInt32(c,l,!0)},writeUInt16LE:function(l,c){return u.setUint16(c,l,!0)},writeUInt32LE:function(l,c){return u.setUint32(c,l,!0)},writeFloatLE:function(l,c){return u.setFloat32(c,l,!0)},writeDoubleLE:function(l,c){return u.setFloat64(c,l,!0)},readInt16BE:function(l){return u.getInt16(l,!1)},readInt32BE:function(l){return u.getInt32(l,!1)},readUInt16BE:function(l){return u.getUint16(l,!1)},readUInt32BE:function(l){return u.getUint32(l,!1)},readFloatBE:function(l){return u.getFloat32(l,!1)},readDoubleBE:function(l){return u.getFloat64(l,!1)},writeInt16BE:function(l,c){return u.setInt16(c,l,!1)},writeInt32BE:function(l,c){return u.setInt32(c,l,!1)},writeUInt16BE:function(l,c){return u.setUint16(c,l,!1)},writeUInt32BE:function(l,c){return u.setUint32(c,l,!1)},writeFloatBE:function(l,c){return u.setFloat32(c,l,!1)},writeDoubleBE:function(l,c){return u.setFloat64(c,l,!1)},copy:function(l,c,d,f){return c=ia(c,0),d=ia(d,0),f=ia(f,s.length),l.set(s.subarray(d,f),c),f-d}})}e.fromUint8Array=t;function r(s){return t(new Uint8Array(s))}e.fromArrayBuffer=r;function n(s){return s}e.fromBuffer=n,e.IsNativeEndianLittle=new Uint16Array(new Uint8Array([18,52]).buffer)[0]===13330;function a(s,u,l,c,d){for(var f=0,p=l;f<p;f+=c)for(var h=0;h<c;h++)u[d+f+c-h-1]=s[d+f+h]}e.flipByteOrder=a;function i(s,u,l){u===void 0&&(u=0);for(var c=new Int16Array(s,u,l),d=0,f=c.length;d<f;++d){var p=c[d];c[d]=(p&255)<<8|p>>8&255}}e.flipByteOrderInPlace2=i;function o(s,u,l,c,d){e.IsNativeEndianLittle||!l||c<=1||a(s,u,l,c,d)}e.ensureLittleEndian=o})(rs||(rs={}));var wg;(function(e){function t(r,n){return{name:n,readBuffer:function(a,i,o,s){var u,l;if(typeof i=="number"){o=ia(o,i);var c=a,d=Math.min(r.length,c+o);u=d-c,l=rs.fromUint8Array(new Uint8Array(r.buffer,c,d-c))}else{o=ia(o,i.length);var c=a,d=Math.min(r.length,c+o);i.set(r.subarray(c,d),s),u=d-c,l=i}return o!==u&&console.warn("byteCount "+o+" and bytesRead "+u+" differ"),Promise.resolve({bytesRead:u,buffer:l})},writeBuffer:function(a,i,o){return o=ia(o,i.length),console.error(".writeBuffer not implemented for FileHandle.fromBuffer"),Promise.resolve(0)},writeBufferSync:function(a,i,o){return o=ia(o,i.length),console.error(".writeSync not implemented for FileHandle.fromBuffer"),0},close:ql}}e.fromBuffer=t})(wg||(wg={}));var Fa;(function(e){e.Float32="float32",e.Int8="int8",e.Int16="int16",e.Uint16="uint16"})(Fa||(Fa={}));function hO(e){return e===Fa.Float32?4:e===Fa.Int16||e===Fa.Uint16?2:1}function Yre(e,t,r,n){return r===void 0&&(r=0),e===Fa.Float32?new Float32Array(t,r,n):e===Fa.Int16?new Int16Array(t,r,n):e===Fa.Uint16?new Uint16Array(t,r,n):new Int8Array(t,r,n)}function Kre(e,t){var r=hO(t),n=new ArrayBuffer(r*e),a=rs.fromArrayBuffer(n),i=rs.IsNativeEndianLittle?n:new ArrayBuffer(r*e);return{type:t,elementByteSize:r,readBuffer:a,valuesBuffer:new Uint8Array(i),values:Yre(t,i)}}function $re(e,t,r,n,a,i){return ce(this,void 0,void 0,function(){return de(this,function(o){switch(o.label){case 0:return[4,t.readBuffer(r,e.readBuffer,n,a)];case 1:return o.sent(),e.elementByteSize>1&&(i!==void 0&&i!==rs.IsNativeEndianLittle||!rs.IsNativeEndianLittle)&&rs.flipByteOrder(e.readBuffer,e.valuesBuffer,n,e.elementByteSize,a),[2,e.values]}})})}function Qre(e){return ce(this,void 0,void 0,function(){var t,r,n,a,i,o,s,u,l;return de(this,function(c){switch(c.label){case 0:return t=1024,[4,e.readBuffer(0,t)];case 1:if(r=c.sent().buffer,n=String.fromCharCode(r.readUInt8(52*4),r.readUInt8(52*4+1),r.readUInt8(52*4+2),r.readUInt8(52*4+3)),n!=="MAP ")throw new Error('ccp4 format error, missing "MAP " string');return a=[r.readUInt8(53*4),r.readUInt8(53*4+1)],i=!1,a[0]===68&&a[1]===65?i=!0:a[0]===17&&a[1]===17?i=!1:(o=r.readInt32LE(3*4),o<=16&&(i=!0)),s=i?function(d){return r.readInt32LE(d*4)}:function(d){return r.readInt32BE(d*4)},u=i?function(d){return r.readFloatLE(d*4)}:function(d){return r.readFloatBE(d*4)},l={NC:s(0),NR:s(1),NS:s(2),MODE:s(3),NCSTART:s(4),NRSTART:s(5),NSSTART:s(6),NX:s(7),NY:s(8),NZ:s(9),xLength:u(10),yLength:u(11),zLength:u(12),alpha:u(13),beta:u(14),gamma:u(15),MAPC:s(16),MAPR:s(17),MAPS:s(18),AMIN:u(19),AMAX:u(20),AMEAN:u(21),ISPG:s(22),NSYMBT:s(23),LSKFLG:s(24),SKWMAT:[],SKWTRN:[],userFlag1:s(39),userFlag2:s(40),originX:u(49),originY:u(50),originZ:u(51),MAP:n,MACHST:a,ARMS:u(54)},[2,{header:l,littleEndian:i}]}})})}function Zre(e,t,r,n,a,i){return ce(this,void 0,void 0,function(){var o,s,u,l,c,d;return de(this,function(f){switch(f.label){case 0:return mO(e)?(o=3*a,[4,r.readBuffer(n,t.readBuffer,a,o)]):[3,2];case 1:for(f.sent(),s=new Int8Array(t.valuesBuffer.buffer,o),u=(e.AMAX-e.AMIN)/255,l=.5*(e.AMIN+e.AMAX+u),c=0,d=a;c<d;++c)t.values[c]=u*s[c]+l;return[3,4];case 2:return[4,$re(t,r,n,a,0,i)];case 3:f.sent(),f.label=4;case 4:return[2]}})})}function vO(e){switch(e){case 0:return Fa.Int8;case 1:return Fa.Int16;case 2:return Fa.Float32;case 3:throw new Error("mode 3 unsupported, complex 16-bit integers");case 4:throw new Error("mode 4 unsupported, complex 32-bit reals");case 6:Fa.Uint16;case 16:throw new Error("mode 16 unsupported, unsigned char * 3 (for rgb data, non-standard)")}throw new Error("unknown mode '"+e+"'")}function mO(e){return e.userFlag1===-128&&e.userFlag2===127}function gO(e){return mO(e)?Fa.Float32:vO(e.MODE)}function Jre(e){return 256*4+e.NSYMBT}function ene(e,t,r){return ce(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d,f,p;return de(this,function(h){switch(h.label){case 0:return[4,r.update({message:"Parsing CCP4/MRC/MAP file..."})];case 1:return h.sent(),[4,Qre(e)];case 2:return n=h.sent(),a=n.header,i=n.littleEndian,o=Jre(a),s=vO(a.MODE),u=gO(a),l=a.NC*a.NR*a.NS,c=hO(s),d=l*c,f=Kre(l,u),Zre(a,f,e,o,d,i),p={header:a,values:f.values,name:e.name},[2,p]}})})}function tne(e,t){var r=this;return We.create("Parse CCP4/MRC/MAP",function(n){return ce(r,void 0,void 0,function(){var a,i,o;return de(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),i=(a=bn).success,[4,ene(e,t,n)];case 1:return[2,i.apply(a,[s.sent()])];case 2:return o=s.sent(),[2,bn.error(o)];case 3:return[2]}})})})}function rne(e,t){return tne(wg.fromBuffer(rs.fromUint8Array(e),t),e.length)}var Hx=512;function nne(e){return{xStart:parseInt(e.substr(10,5)),yStart:parseInt(e.substr(15,5)),zStart:parseInt(e.substr(20,5)),xExtent:parseInt(e.substr(32,5)),yExtent:parseInt(e.substr(38,5)),zExtent:parseInt(e.substr(42,5)),xRate:parseInt(e.substr(52,5)),yRate:parseInt(e.substr(58,5)),zRate:parseInt(e.substr(62,5)),xlen:parseFloat(e.substr(73,10)),ylen:parseFloat(e.substr(83,10)),zlen:parseFloat(e.substr(93,10)),alpha:parseFloat(e.substr(103,10)),beta:parseFloat(e.substr(113,10)),gamma:parseFloat(e.substr(123,10)),divisor:parseFloat(e.substr(138,12)),summand:parseInt(e.substr(155,8)),sigma:parseFloat(e.substr(170,12))}}function ane(e,t){var r=t?function(a){return e.readInt16LE(a*2)}:function(a){return e.readInt16BE(a*2)},n=1/r(17);return{xStart:r(0),yStart:r(1),zStart:r(2),xExtent:r(3),yExtent:r(4),zExtent:r(5),xRate:r(6),yRate:r(7),zRate:r(8),xlen:r(9)*n,ylen:r(10)*n,zlen:r(11)*n,alpha:r(12)*n,beta:r(13)*n,gamma:r(14)*n,divisor:r(15)/100,summand:r(16),sigma:void 0}}function yO(e){var t=e.xExtent,r=e.yExtent,n=e.zExtent,a=Math.ceil(t/8),i=Math.ceil(r/8),o=Math.ceil(n/8);return{xBlocks:a,yBlocks:i,zBlocks:o}}function ine(e){return ce(this,void 0,void 0,function(){var t,r,n,a,i;return de(this,function(o){switch(o.label){case 0:return[4,e.readBuffer(0,Hx)];case 1:return t=o.sent().buffer,r=String.fromCharCode.apply(null,t),n=r.startsWith(":-)"),a=n||t.readInt16LE(18*2)===100,i=n?nne(r):ane(t,a),[2,{header:i,littleEndian:a}]}})})}function one(e,t,r,n){return ce(this,void 0,void 0,function(){var a,i,o,s,u,l,c,d,f,p,h,v,m,g,y,b,x,S,_,A;return de(this,function(T){for(n||rs.flipByteOrderInPlace2(t.buffer),a=e.divisor,i=e.summand,o=e.xExtent,s=e.yExtent,u=e.zExtent,l=yO(e),c=l.xBlocks,d=l.yBlocks,f=l.zBlocks,p=0,h=0;h<f;++h)for(v=0;v<d;++v)for(m=0;m<c;++m)for(g=0;g<8;++g)for(y=8*h+g,b=0;b<8;++b)for(x=8*v+b,S=0;S<8;++S)if(_=8*m+S,_<o&&x<s&&y<u)A=(_*s+x)*u+y,r[A]=(t[p]-i)/a,++p;else{p+=8-S;break}return[2]})})}function sne(e){var t=e.xExtent,r=e.yExtent,n=e.zExtent,a=yO(e),i=a.xBlocks,o=a.yBlocks,s=a.zBlocks,u=t*r*n,l=i*8*o*8*s*8,c=1,d=l*c;return{count:l,byteCount:d,valueCount:u}}function une(e,t,r){return ce(this,void 0,void 0,function(){var n,a,i,o,s,u,l;return de(this,function(c){switch(c.label){case 0:return[4,r.update({message:"Parsing DSN6/BRIX file..."})];case 1:return c.sent(),[4,ine(e)];case 2:return n=c.sent(),a=n.header,i=n.littleEndian,[4,e.readBuffer(Hx,t-Hx)];case 3:return o=c.sent().buffer,s=sne(a).valueCount,u=new Float32Array(s),[4,one(a,o,u,i)];case 4:return c.sent(),l={header:a,values:u,name:e.name},[2,l]}})})}function lne(e,t){var r=this;return We.create("Parse DSN6/BRIX",function(n){return ce(r,void 0,void 0,function(){var a,i,o;return de(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),i=(a=bn).success,[4,une(e,t,n)];case 1:return[2,i.apply(a,[s.sent()])];case 2:return o=s.sent(),[2,bn.error(o)];case 3:return[2]}})})})}function cne(e,t){return lne(wg.fromBuffer(rs.fromUint8Array(e),t),e.length)}var dne={char:1,uchar:1,short:2,ushort:2,int:4,uint:4,float:4,double:8,int8:1,uint8:1,int16:2,uint16:2,int32:4,uint32:4,float32:4,float64:8},fne=new Set(Object.keys(dne));function Zb(e){if(!fne.has(e))throw new Error("unknown ply type '"+e+"'");return e}function pne(e,t,r){for(var n=new Map,a=0,i=t.length;a<i;++a)n.set(t[a],e[a]);return{comments:r,elementNames:t,getElement:function(o){return n.get(o)}}}function hne(e,t){var r=Et(e);return{data:e,tokenizer:r,runtimeCtx:t,comments:[],elementSpecs:[],elements:[]}}function vne(e){var t=e.data.indexOf("end_header",e.position);if(t===-1)throw new Error("no 'end_header' record found");e.tokenStart=e.position,e.tokenEnd=t,e.position=t,Et.eatLine(e)}function mne(e){var t=e.tokenizer,r=e.comments,n=e.elementSpecs;vne(t);var a=Et.getTokenString(t).split(/\r?\n/);if(a[0]!=="ply")throw new Error("data not starting with 'ply'");if(a[1]!=="format ascii 1.0")throw new Error("format not 'ascii 1.0'");var i,o,s;function u(){if(i!==void 0&&o!==void 0&&s!==void 0){for(var p=!1,h=0,v=s.length;h<v;++h){var m=s[h];if(m.kind==="list"){p=!0;break}}p&&s.length,p?n.push({kind:"list",name:i,count:o,property:s[0]}):n.push({kind:"table",name:i,count:o,properties:s})}}for(var l=2,c=a.length;l<c;++l){var d=a[l],f=d.split(" ");if(d.startsWith("comment"))r.push(d.substr(8));else if(d.startsWith("element"))u(),s=[],i=f[1],o=parseInt(f[2]);else if(d.startsWith("property")){if(s===void 0)throw new Error("properties outside of element");f[1]==="list"?s.push({kind:"list",countType:Zb(f[2]),dataType:Zb(f[3]),name:f[4]}):s.push({kind:"column",type:Zb(f[1]),name:f[2]})}else d.startsWith("end_header")?u():console.warn("unknown header line")}}function gne(e){for(var t=e.elementSpecs,r=0,n=t.length;r<n;++r){var a=t[r];a.kind==="table"?yne(e,a):a.kind==="list"&&bne(e,a)}}function bO(e){switch(e){case"char":case"uchar":case"int8":case"uint8":case"short":case"ushort":case"int16":case"uint16":case"int":case"uint":case"int32":case"uint32":return ve.Schema.int;case"float":case"double":case"float32":case"float64":return ve.Schema.float}}function yne(e,t){for(var r=e.elements,n=e.tokenizer,a=t.count,i=t.properties,o=i.length,s=[],u=[],l=[],c=new Map,d=0,f=o;d<f;++d){var p=pt.create(n.data,a*2);l.push(p)}for(var d=0,f=a;d<f;++d)for(var h=0,v=o;h<v;++h)Et.skipWhitespace(n),Et.markStart(n),Et.eatValue(n),pt.addUnchecked(l[h],n.tokenStart,n.tokenEnd);for(var d=0,f=o;d<f;++d){var m=i[d],g=m.type,y=m.name,b=n3(l[d],bO(g));s.push(y),u.push(g),c.set(y,b)}r.push({kind:"table",rowCount:a,propertyNames:s,propertyTypes:u,getProperty:function(x){return c.get(x)}})}function bne(e,t){for(var r=e.elements,n=e.tokenizer,a=t.count,i=t.property,o=pt.create(n.data,a*2*3),s=new Uint32Array(a+1),u=0,l=0,c=a;l<c;++l){for(Et.skipWhitespace(n),Et.markStart(n);Et.skipWhitespace(n)!==10;)++u,Et.markStart(n),Et.eatValue(n),pt.addToken(o,n);s[l+1]=u}var d={entries:[],count:0},f=n3(o,bO(i.dataType));r.push({kind:"list",rowCount:a,name:i.name,type:i.dataType,value:function(p){for(var h=s[p]+1,v=f.value(h-1),m=h,g=h+v;m<g;++m)d.entries[m-h]=f.value(m);return d.count=v,d}})}function Sne(e,t){return ce(this,void 0,void 0,function(){var r,n,a,i,o,s;return de(this,function(u){return r=hne(e,t),t.update({message:"Parsing...",current:0,max:e.length}),mne(r),gne(r),n=r.elements,a=r.elementSpecs,i=r.comments,o=a.map(function(l){return l.name}),s=pne(n,o,i),[2,bn.success(s)]})})}function xne(e){var t=this;return We.create("Parse PLY",function(r){return ce(t,void 0,void 0,function(){return de(this,function(n){switch(n.label){case 0:return[4,Sne(e,r)];case 1:return[2,n.sent()]}})})})}var Ag=Et.readLine,SO=Et.skipWhitespace,xO=Et.eatValue,Cne=Et.eatLine,Gx=Et.markStart,R0=/\s+/,_ne=/(^\*|REMARK)*/;function wne(e,t){return{tokenizer:e,runtimeCtx:t}}function Ane(e,t){return ce(this,void 0,void 0,function(){var r,n,a,i,o,s,u,l,c,d,f,p,h,v,m;return de(this,function(g){switch(g.label){case 0:return r=e.tokenizer,n=pt.create(r.data,t*2),a=pt.create(r.data,t*2),i=pt.create(r.data,t*2),o=pt.create(r.data,t*2),s=pt.create(r.data,t*2),u=pt.create(r.data,t*2),l=pt.create(r.data,t*2),c=pt.create(r.data,t*2),d=r.position,f=Ag(r).trim(),r.position=d,p=f.split(R0).length===7,h=p?6:8,v=r.length,m=0,[4,Uu(e.runtimeCtx,1e5,void 0,function(y){for(var b=Math.min(t-m,y),x=0;x<b;++x){for(var S=0;S<h;++S)if(SO(r),Gx(r),xO(r),p)switch(S){case 0:pt.addUnchecked(n,r.tokenStart,r.tokenEnd);break;case 1:pt.addUnchecked(i,r.tokenStart,r.tokenEnd);break;case 2:pt.addUnchecked(s,r.tokenStart,r.tokenEnd);break;case 3:pt.addUnchecked(u,r.tokenStart,r.tokenEnd);break;case 4:pt.addUnchecked(l,r.tokenStart,r.tokenEnd);break;case 5:pt.addUnchecked(c,r.tokenStart,r.tokenEnd);break}else switch(S){case 0:pt.addUnchecked(n,r.tokenStart,r.tokenEnd);break;case 1:pt.addUnchecked(a,r.tokenStart,r.tokenEnd);break;case 2:pt.addUnchecked(i,r.tokenStart,r.tokenEnd);break;case 3:pt.addUnchecked(o,r.tokenStart,r.tokenEnd);break;case 4:pt.addUnchecked(s,r.tokenStart,r.tokenEnd);break;case 5:pt.addUnchecked(u,r.tokenStart,r.tokenEnd);break;case 6:pt.addUnchecked(l,r.tokenStart,r.tokenEnd);break;case 7:pt.addUnchecked(c,r.tokenStart,r.tokenEnd);break}Cne(r),Gx(r)}return m+=b,b},function(y){return y.update({message:"Parsing...",current:r.position,max:v})})];case 1:return g.sent(),[2,{count:t,atomId:qr(n)(ve.Schema.int),segmentName:p?qr(i)(ve.Schema.str):qr(a)(ve.Schema.str),residueId:qr(i)(ve.Schema.int),residueName:p?qr(i)(ve.Schema.str):qr(o)(ve.Schema.str),atomName:qr(s)(ve.Schema.str),atomType:qr(u)(ve.Schema.str),charge:qr(l)(ve.Schema.float),mass:qr(c)(ve.Schema.float)}]}})})}function Pne(e,t){return ce(this,void 0,void 0,function(){var r,n,a,i,o;return de(this,function(s){switch(s.label){case 0:return r=e.tokenizer,n=pt.create(r.data,t*2),a=pt.create(r.data,t*2),i=r.length,o=0,[4,Uu(e.runtimeCtx,10,void 0,function(u){for(var l=Math.min(t-o,u),c=0;c<l;++c)for(var d=0;d<2;++d)switch(SO(r),Gx(r),xO(r),d){case 0:pt.addUnchecked(n,r.tokenStart,r.tokenEnd);break;case 1:pt.addUnchecked(a,r.tokenStart,r.tokenEnd);break}return o+=l,l},function(u){return u.update({message:"Parsing...",current:r.position,max:i})})];case 1:return s.sent(),[2,{count:t,atomIdA:qr(n)(ve.Schema.int),atomIdB:qr(a)(ve.Schema.int)}]}})})}function Tne(e,t){for(var r=[],n=0;n<t;++n){var a=Ag(e.tokenizer);r.push(a.replace(_ne,"").trim())}return r}function Ene(e,t){return ce(this,void 0,void 0,function(){var r,n,a,i,o,s,u,l,c,d,f;return de(this,function(p){switch(p.label){case 0:r=Et(e),n=wne(r,t),a=void 0,i=void 0,o=void 0,s=Ag(n.tokenizer).trim(),p.label=1;case 1:return r.tokenEnd<r.length?(u=Ag(n.tokenizer).trim(),u.includes("!NTITLE")?(l=parseInt(u.split(R0)[0]),a=Tne(n,l),[3,7]):[3,2]):[3,8];case 2:return u.includes("!NATOM")?(c=parseInt(u.split(R0)[0]),[4,Ane(n,c)]):[3,4];case 3:return i=p.sent(),[3,7];case 4:return u.includes("!NBOND")?(d=parseInt(u.split(R0)[0]),[4,Pne(n,d)]):[3,6];case 5:return o=p.sent(),[3,8];case 6:u.includes("!NTHETA")||u.includes("!NPHI")||u.includes("!NIMPHI")||u.includes("!NDON")||u.includes("!NACC")||u.includes("!NNB")||u.includes("!NGRP NST2")||u.includes("!MOLNT")||u.includes("!NUMLP NUMLPH")||u.includes("!NCRTERM"),p.label=7;case 7:return[3,1];case 8:return a===void 0&&(a=[]),i===void 0?[2,bn.error("no atoms data")]:o===void 0?[2,bn.error("no bonds data")]:(f={id:s,title:a,atoms:i,bonds:o},[2,bn.success(f)])}})})}function Ine(e){var t=this;return We.create("Parse PSF",function(r){return ce(t,void 0,void 0,function(){return de(this,function(n){switch(n.label){case 0:return[4,Ene(e,r)];case 1:return[2,n.sent()]}})})})}var ge;(function(e){e.Create=Cn.factory();function t(s){return!!s&&s.type.typeClass==="Representation3D"}e.isRepresentation3D=t;function r(s){return!!s&&s.type.typeClass==="Behavior"}e.isBehavior=r;function n(s){return e.Create(w(w({},s),{typeClass:"Representation3D"}))}e.CreateRepresentation3D=n;function a(s){return e.Create(w(w({},s),{typeClass:"Behavior"}))}e.CreateBehavior=a;var i=function(s){Be(u,s);function u(){return s!==null&&s.apply(this,arguments)||this}return u}(e.Create({name:"Root",typeClass:"Root"}));e.Root=i;var o=function(s){Be(u,s);function u(){return s!==null&&s.apply(this,arguments)||this}return u}(e.Create({name:"Group",typeClass:"Group"}));e.Group=o,function(s){var u=function(d){Be(f,d);function f(){return d!==null&&d.apply(this,arguments)||this}return f}(e.Create({name:"String Data",typeClass:"Data"}));s.String=u;var l=function(d){Be(f,d);function f(){return d!==null&&d.apply(this,arguments)||this}return f}(e.Create({name:"Binary Data",typeClass:"Data"}));s.Binary=l;var c=function(d){Be(f,d);function f(){return d!==null&&d.apply(this,arguments)||this}return f}(e.Create({name:"Data Blob",typeClass:"Data"}));s.Blob=c}(e.Data||(e.Data={})),function(s){var u=function(g){Be(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(e.Create({name:"JSON Data",typeClass:"Data"}));s.Json=u;var l=function(g){Be(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(e.Create({name:"CIF File",typeClass:"Data"}));s.Cif=l;var c=function(g){Be(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(e.Create({name:"Cube File",typeClass:"Data"}));s.Cube=c;var d=function(g){Be(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(e.Create({name:"PSF File",typeClass:"Data"}));s.Psf=d;var f=function(g){Be(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(e.Create({name:"PLY File",typeClass:"Data"}));s.Ply=f;var p=function(g){Be(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(e.Create({name:"CCP4/MRC/MAP File",typeClass:"Data"}));s.Ccp4=p;var h=function(g){Be(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(e.Create({name:"DSN6/BRIX File",typeClass:"Data"}));s.Dsn6=h;var v=function(g){Be(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(e.Create({name:"DX File",typeClass:"Data"}));s.Dx=v;var m=function(g){Be(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(e.Create({name:"Format Blob",typeClass:"Data"}));s.Blob=m}(e.Format||(e.Format={})),function(s){var u=function(p){Be(h,p);function h(){return p!==null&&p.apply(this,arguments)||this}return h}(e.Create({name:"Coordinates",typeClass:"Object"}));s.Coordinates=u;var l=function(p){Be(h,p);function h(){return p!==null&&p.apply(this,arguments)||this}return h}(e.Create({name:"Topology",typeClass:"Object"}));s.Topology=l;var c=function(p){Be(h,p);function h(){return p!==null&&p.apply(this,arguments)||this}return h}(e.Create({name:"Model",typeClass:"Object"}));s.Model=c;var d=function(p){Be(h,p);function h(){return p!==null&&p.apply(this,arguments)||this}return h}(e.Create({name:"Trajectory",typeClass:"Object"}));s.Trajectory=d;var f=function(p){Be(h,p);function h(){return p!==null&&p.apply(this,arguments)||this}return h}(e.Create({name:"Structure",typeClass:"Object"}));s.Structure=f,function(p){var h=function(g){Be(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(n({name:"Structure 3D"}));p.Representation3D=h;var v=function(g){Be(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(e.Create({name:"Structure 3D State",typeClass:"Object"}));p.Representation3DState=v;var m=function(g){Be(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(e.Create({name:"Selections",typeClass:"Object"}));p.Selections=m}(f=s.Structure||(s.Structure={}))}(e.Molecule||(e.Molecule={})),function(s){var u=function(d){Be(f,d);function f(){return d!==null&&d.apply(this,arguments)||this}return f}(e.Create({name:"Volume",typeClass:"Object"}));s.Data=u;var l=function(d){Be(f,d);function f(){return d!==null&&d.apply(this,arguments)||this}return f}(e.Create({name:"Lazy Volume",typeClass:"Object"}));s.Lazy=l;var c=function(d){Be(f,d);function f(){return d!==null&&d.apply(this,arguments)||this}return f}(n({name:"Volume 3D"}));s.Representation3D=c}(e.Volume||(e.Volume={})),function(s){var u=function(c){Be(d,c);function d(){return c!==null&&c.apply(this,arguments)||this}return d}(e.Create({name:"Shape Provider",typeClass:"Object"}));s.Provider=u;var l=function(c){Be(d,c);function d(){return c!==null&&c.apply(this,arguments)||this}return d}(n({name:"Shape 3D"}));s.Representation3D=l}(e.Shape||(e.Shape={}))})(ge||(ge={}));var Ot;(function(e){e.CreateBuiltIn=ft.factory("ms-plugin"),e.BuiltIn=ft.builderFactory("ms-plugin")})(Ot||(Ot={}));var DT=.529177210859;function Mne(e){var t=Et.readLines(e,6),r=function(M,O){var D=+t[M].trim().split(/\s+/g)[O];return Number.isNaN(D)?0:D},n=function(M){var O=r(M+2,0),D=DT;return[Math.abs(O),C.create(r(M+2,1)*D,r(M+2,2)*D,r(M+2,3)*D),O]},a=t[0].trim(),i=t[1].trim(),o=n(0),s=o[0],u=o[1],l=o[2],c=n(1),d=c[0],f=c[1],p=n(2),h=p[0],v=p[1],m=n(3),g=m[0],y=m[1],b=Dne(e,s,DT),x=[];if(l>=0){var S=r(2,4);S===0&&(S=1);for(var _=0;_<S;_++)x.push(_)}else for(var A=Et.readLine(e).trim().split(/\s+/g),_=0,T=+A[0];_<T;_++)x.push(+A[_+1]);var I={orbitals:l<0,comment1:a,comment2:i,atomCount:s,origin:u,dim:C.create(d,h,g),basisX:f,basisY:v,basisZ:y,dataSetIds:x};return{header:I,atoms:b}}function Dne(e,t,r){for(var n=new Int32Array(t),a=new Float64Array(t),i=new Float32Array(t),o=new Float32Array(t),s=new Float32Array(t),u=0;u<t;u++){var l=Et.readLine(e).trim().split(/\s+/g);n[u]=+l[0],a[u]=+l[1],i[u]=+l[2]*r,o[u]=+l[3]*r,s[u]=+l[4]*r}return{count:t,number:ve.ofArray({array:n,schema:ve.Schema.int}),nuclearCharge:ve.ofArray({array:a,schema:ve.Schema.float}),x:ve.ofArray({array:i,schema:ve.Schema.float}),y:ve.ofArray({array:o,schema:ve.Schema.float}),z:ve.ofArray({array:s,schema:ve.Schema.float})}}function Rne(e,t,r){var n=r.dim[0]*r.dim[1]*r.dim[2]*r.dataSetIds.length,a=100*100*100,i=new Float64Array(n),o=0;return Uu(e,a,i,function(s,u){for(var l=Math.min(n,o+s),c=o;c<l;c++)Et.skipWhitespace(t),t.tokenStart=t.position,Et.eatValue(t),u[c]=Mu(t.data,t.tokenStart,t.tokenEnd);return o=l,l===n?0:a},function(s,u,l){return s.update({current:Math.min(l,n),max:n})})}function One(e,t){var r=this;return We.create("Parse Cube",function(n){return ce(r,void 0,void 0,function(){var a,i,o,s,u;return de(this,function(l){switch(l.label){case 0:return[4,n.update("Reading header...")];case 1:return l.sent(),a=Et(e),i=Mne(a),o=i.header,s=i.atoms,[4,Rne(n,a,o)];case 2:return u=l.sent(),[2,bn.success({header:o,atoms:s,values:u,name:t})]}})})})}function CO(e){for(var t={h:C()},r=0,n=0,a=/\s+/g;;){var i=Et.readLine(e),o=void 0;if(i.startsWith("object 1"))o=i.split(a),t.dim=C.create(parseInt(o[5]),parseInt(o[6]),parseInt(o[7]));else if(i.startsWith("origin"))o=i.split(a),t.min=C.create(parseFloat(o[1]),parseFloat(o[2]),parseFloat(o[3]));else if(i.startsWith("delta"))o=i.split(a),n===0?t.h[0]=parseFloat(o[1]):n===1?t.h[1]=parseFloat(o[2]):n===2&&(t.h[2]=parseFloat(o[3])),n+=1;else if(i.startsWith("object 3")){r+=i.length+1;break}r+=i.length+1}return{header:t,headerByteCount:r}}function Fne(e,t,r){var n=r.dim[0]*r.dim[1]*r.dim[2],a=100*100*100,i=new Float64Array(n),o=0;return Uu(e,a,i,function(s,u){for(var l=Math.min(n,o+s),c=o;c<l;c++)Et.skipWhitespace(t),t.tokenStart=t.position,Et.eatValue(t),u[c]=Mu(t.data,t.tokenStart,t.tokenEnd);return o=l,l===n?0:a},function(s,u,l){return s.update({current:Math.min(l,n),max:n})})}function kne(e,t,r){return ce(this,void 0,void 0,function(){var n,a,i;return de(this,function(o){switch(o.label){case 0:return[4,e.update("Reading header...")];case 1:return o.sent(),n=Et(t),a=CO(n).header,[4,e.update("Reading values...")];case 2:return o.sent(),[4,Fne(e,n,a)];case 3:return i=o.sent(),[2,bn.success({header:a,values:i,name:r})]}})})}function Bne(e,t,r){return ce(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d;return de(this,function(f){switch(f.label){case 0:return[4,e.update("Reading header...")];case 1:return f.sent(),n=B_(t,0,1e3),a=Et(n),i=CO(a),o=i.header,s=i.headerByteCount,[4,e.update("Reading values...")];case 2:for(f.sent(),u=o.dim[0]*o.dim[1]*o.dim[2],l=new DataView(t.buffer,t.byteOffset+s),c=new Float64Array(u),d=0;d<u;d++)c[d]=l.getFloat64(d*8,!0);return[2,bn.success({header:o,values:c,name:r})]}})})}function Lne(e,t){return We.create("Parse Cube",function(r){return typeof e=="string"?kne(r,e,t):Bne(r,e,t)})}var _O=Ot.BuiltIn({name:"download",display:{name:"Download",description:"Download string or binary data from the specified URL"},from:[ge.Root],to:[ge.Data.String,ge.Data.Binary],params:{url:E.Url("https://www.ebi.ac.uk/pdbe/static/entry/1cbs_updated.cif",{description:"Resource URL. Must be the same domain or support CORS."}),label:E.Optional(E.Text("")),isBinary:E.Optional(E.Boolean(!1,{description:"If true, download data as binary (string otherwise)"}))}})({apply:function(e,t){var r=this,n=e.params,a=e.cache;return We.create("Download",function(i){return ce(r,void 0,void 0,function(){var o,s;return de(this,function(u){switch(u.label){case 0:return o=gn.getUrlAsset(t.managers.asset,n.url),[4,t.managers.asset.resolve(o,n.isBinary?"binary":"string").runInContext(i)];case 1:return s=u.sent(),a.asset=s,[2,n.isBinary?new ge.Data.Binary(s.data,{label:n.label?n.label:o.url}):new ge.Data.String(s.data,{label:n.label?n.label:o.url})]}})})})},dispose:function(e){var t,r,n=e.cache;(r=(t=n)===null||t===void 0?void 0:t.asset)===null||r===void 0||r.dispose()},update:function(e){var t=e.oldParams,r=e.newParams,n=e.b;return t.url!==r.url||t.isBinary!==r.isBinary?ft.UpdateResult.Recreate:t.label!==r.label?(n.label=r.label||(typeof r.url=="string"?r.url:r.url.url),ft.UpdateResult.Updated):ft.UpdateResult.Unchanged}}),wO=Ot.BuiltIn({name:"download-blob",display:{name:"Download Blob",description:"Download multiple string or binary data from the specified URLs."},from:ge.Root,to:ge.Data.Blob,params:{sources:E.ObjectList({id:E.Text("",{label:"Unique ID"}),url:E.Url("https://www.ebi.ac.uk/pdbe/static/entry/1cbs_updated.cif",{description:"Resource URL. Must be the same domain or support CORS."}),isBinary:E.Optional(E.Boolean(!1,{description:"If true, download data as binary (string otherwise)"})),canFail:E.Optional(E.Boolean(!1,{description:"Indicate whether the download can fail and not be included in the blob as a result."}))},function(e){return e.id+": "+e.url}),maxConcurrency:E.Optional(E.Numeric(4,{min:1,max:12,step:1},{description:"The maximum number of concurrent downloads."}))}})({apply:function(e,t){var r=this,n=e.params,a=e.cache;return We.create("Download Blob",function(i){return ce(r,void 0,void 0,function(){var o,s,u,l,c,d;return de(this,function(f){switch(f.label){case 0:return o=[],[4,PX(i,t.managers.asset,n.sources,n.maxConcurrency||4)];case 1:for(s=f.sent(),u=[],l=0;l<s.length;l++)c=s[l],d=n.sources[l],c.kind==="error"?t.log.warn("Download "+c.id+" ("+d.url+") failed: "+c.error):(u.push(c.result),o.push(d.isBinary?{id:c.id,kind:"binary",data:c.result.data}:{id:c.id,kind:"string",data:c.result.data}));return a.assets=u,[2,new ge.Data.Blob(o,{label:"Data Blob",description:o.length+" "+(o.length===1?"entry":"entries")})]}})})})},dispose:function(e,t){var r,n=e.cache,a=(r=n)===null||r===void 0?void 0:r.assets;if(!!a)for(var i=0,o=a;i<o.length;i++){var s=o[i];s.dispose()}}}),AO=Ot.BuiltIn({name:"raw-data",display:{name:"Raw Data",description:"Raw data supplied by value."},from:[ge.Root],to:[ge.Data.String,ge.Data.Binary],params:{data:E.Value("",{isHidden:!0}),label:E.Optional(E.Text(""))}})({apply:function(e){var t=this,r=e.params;return We.create("Raw Data",function(){return ce(t,void 0,void 0,function(){return de(this,function(n){if(typeof r.data=="string")return[2,new ge.Data.String(r.data,{label:r.label?r.label:"String"})];if(Array.isArray(r.data))return[2,new ge.Data.Binary(new Uint8Array(r.data),{label:r.label?r.label:"Binary"})];if(r.data instanceof ArrayBuffer)return[2,new ge.Data.Binary(new Uint8Array(r.data),{label:r.label?r.label:"Binary"})];if(r.data instanceof Uint8Array)return[2,new ge.Data.Binary(r.data,{label:r.label?r.label:"Binary"})];throw new Error("Supplied binary data must be a plain array, ArrayBuffer, or Uint8Array.")})})})},update:function(e){var t=e.oldParams,r=e.newParams,n=e.b;return t.data!==r.data?ft.UpdateResult.Recreate:t.label!==r.label?(n.label=r.label||n.label,ft.UpdateResult.Updated):ft.UpdateResult.Unchanged},customSerialization:{toJSON:function(e){if(typeof e.data=="string"||Array.isArray(e.data))return e;if(e.data instanceof ArrayBuffer){for(var t=new Uint8Array(e.data),r=new Array(t.length),n=0,a=t.length;n<a;n++)r[n]=t[n];return{data:r,label:e.label}}else if(e.data instanceof Uint8Array){for(var r=new Array(e.data.length),n=0,a=e.data.length;n<a;n++)r[n]=e.data[n];return{data:r,label:e.label}}},fromJSON:function(e){return e}}}),PO=Ot.BuiltIn({name:"read-file",display:{name:"Read File",description:"Read string or binary data from the specified file"},from:ge.Root,to:[ge.Data.String,ge.Data.Binary],params:{file:E.File(),label:E.Optional(E.Text("")),isBinary:E.Optional(E.Boolean(!1,{description:"If true, open file as as binary (string otherwise)"}))}})({apply:function(e,t){var r=this,n=e.params,a=e.cache;return We.create("Open File",function(i){return ce(r,void 0,void 0,function(){var o,s;return de(this,function(u){switch(u.label){case 0:return n.file===null?(t.log.error("No file(s) selected"),[2,Cn.Null]):[4,t.managers.asset.resolve(n.file,n.isBinary?"binary":"string").runInContext(i)];case 1:return o=u.sent(),a.asset=o,s=n.isBinary?new ge.Data.Binary(o.data,{label:n.label?n.label:n.file.name}):new ge.Data.String(o.data,{label:n.label?n.label:n.file.name}),[2,s]}})})})},dispose:function(e){var t,r,n=e.cache;(r=(t=n)===null||t===void 0?void 0:t.asset)===null||r===void 0||r.dispose()},update:function(e){var t,r=e.oldParams,n=e.newParams,a=e.b;return r.label!==n.label?(a.label=n.label||((t=r.file)===null||t===void 0?void 0:t.name)||"",ft.UpdateResult.Updated):ft.UpdateResult.Unchanged},isSerializable:function(){return{isSerializable:!1,reason:"Cannot serialize user loaded files."}}}),Nne=Ot.BuiltIn({name:"parse-blob",display:{name:"Parse Blob",description:"Parse multiple data enties"},from:ge.Data.Blob,to:ge.Format.Blob,params:{formats:E.ObjectList({id:E.Text("",{label:"Unique ID"}),format:E.Select("cif",[["cif","cif"]])},function(e){return e.id+": "+e.format})}})({apply:function(e,t){var r=this,n=e.a,a=e.params;return We.create("Parse Blob",function(i){return ce(r,void 0,void 0,function(){var o,s,u,l,c,d,f,p,h;return de(this,function(v){switch(v.label){case 0:for(o=new Map,s=0,u=a.formats;s<u.length;s++)l=u[s],o.set(l.id,l.format);c=[],d=0,f=n.data,v.label=1;case 1:return d<f.length?(p=f[d],o.has(p.id)?[4,(p.kind==="string"?Gu.parse(p.data):Gu.parseBinary(p.data)).runInContext(i)]:[3,3]):[3,4];case 2:if(h=v.sent(),h.isError)throw new Error(p.id+": "+h.message);c.push({id:p.id,kind:"cif",data:h.result}),v.label=3;case 3:return d++,[3,1];case 4:return[2,new ge.Format.Blob(c,{label:"Format Blob",description:c.length+" "+(c.length===1?"entry":"entries")})]}})})})}}),Une=Ot.BuiltIn({name:"parse-cif",display:{name:"Parse CIF",description:"Parse CIF from String or Binary data"},from:[ge.Data.String,ge.Data.Binary],to:ge.Format.Cif})({apply:function(e){var t=this,r=e.a;return We.create("Parse CIF",function(n){return ce(t,void 0,void 0,function(){var a;return de(this,function(i){switch(i.label){case 0:return[4,(ge.Data.String.is(r)?Gu.parse(r.data):Gu.parseBinary(r.data)).runInContext(n)];case 1:if(a=i.sent(),a.isError)throw new Error(a.message);return[2,new ge.Format.Cif(a.result)]}})})})}}),zne=Ot.BuiltIn({name:"parse-cube",display:{name:"Parse Cube",description:"Parse Cube from String data"},from:ge.Data.String,to:ge.Format.Cube})({apply:function(e){var t=this,r=e.a;return We.create("Parse Cube",function(n){return ce(t,void 0,void 0,function(){var a;return de(this,function(i){switch(i.label){case 0:return[4,One(r.data,r.label).runInContext(n)];case 1:if(a=i.sent(),a.isError)throw new Error(a.message);return[2,new ge.Format.Cube(a.result)]}})})})}}),Vne=Ot.BuiltIn({name:"parse-psf",display:{name:"Parse PSF",description:"Parse PSF from String data"},from:[ge.Data.String],to:ge.Format.Psf})({apply:function(e){var t=this,r=e.a;return We.create("Parse PSF",function(n){return ce(t,void 0,void 0,function(){var a;return de(this,function(i){switch(i.label){case 0:return[4,Ine(r.data).runInContext(n)];case 1:if(a=i.sent(),a.isError)throw new Error(a.message);return[2,new ge.Format.Psf(a.result)]}})})})}}),Hne=Ot.BuiltIn({name:"parse-ply",display:{name:"Parse PLY",description:"Parse PLY from String data"},from:[ge.Data.String],to:ge.Format.Ply})({apply:function(e){var t=this,r=e.a;return We.create("Parse PLY",function(n){return ce(t,void 0,void 0,function(){var a;return de(this,function(i){switch(i.label){case 0:return[4,xne(r.data).runInContext(n)];case 1:if(a=i.sent(),a.isError)throw new Error(a.message);return[2,new ge.Format.Ply(a.result,{label:a.result.comments[0]||"PLY Data"})]}})})})}}),Gne=Ot.BuiltIn({name:"parse-ccp4",display:{name:"Parse CCP4/MRC/MAP",description:"Parse CCP4/MRC/MAP from Binary data"},from:[ge.Data.Binary],to:ge.Format.Ccp4})({apply:function(e){var t=this,r=e.a;return We.create("Parse CCP4/MRC/MAP",function(n){return ce(t,void 0,void 0,function(){var a;return de(this,function(i){switch(i.label){case 0:return[4,rne(r.data,r.label).runInContext(n)];case 1:if(a=i.sent(),a.isError)throw new Error(a.message);return[2,new ge.Format.Ccp4(a.result)]}})})})}}),qne=Ot.BuiltIn({name:"parse-dsn6",display:{name:"Parse DSN6/BRIX",description:"Parse CCP4/BRIX from Binary data"},from:[ge.Data.Binary],to:ge.Format.Dsn6})({apply:function(e){var t=this,r=e.a;return We.create("Parse DSN6/BRIX",function(n){return ce(t,void 0,void 0,function(){var a;return de(this,function(i){switch(i.label){case 0:return[4,cne(r.data,r.label).runInContext(n)];case 1:if(a=i.sent(),a.isError)throw new Error(a.message);return[2,new ge.Format.Dsn6(a.result)]}})})})}}),jne=Ot.BuiltIn({name:"parse-dx",display:{name:"Parse DX",description:"Parse DX from Binary/String data"},from:[ge.Data.Binary,ge.Data.String],to:ge.Format.Dx})({apply:function(e){var t=this,r=e.a;return We.create("Parse DX",function(n){return ce(t,void 0,void 0,function(){var a;return de(this,function(i){switch(i.label){case 0:return[4,Lne(r.data,r.label).runInContext(n)];case 1:if(a=i.sent(),a.isError)throw new Error(a.message);return[2,new ge.Format.Dx(a.result)]}})})})}}),Wne=Ot.BuiltIn({name:"import-string",display:{name:"Import String",description:"Import given data as a string"},from:ge.Root,to:ge.Data.String,params:{data:E.Value(""),label:E.Optional(E.Text(""))}})({apply:function(e){var t=e.params,r=t.data,n=t.label;return new ge.Data.String(r,{label:n||""})},update:function(e){var t=e.oldParams,r=e.newParams,n=e.b;return t.data!==r.data?ft.UpdateResult.Recreate:t.label!==r.label?(n.label=r.label||"",ft.UpdateResult.Updated):ft.UpdateResult.Unchanged},isSerializable:function(){return{isSerializable:!1,reason:"Cannot serialize user imported strings."}}}),Xne=Ot.BuiltIn({name:"import-json",display:{name:"Import JSON",description:"Import given data as a JSON"},from:ge.Root,to:ge.Format.Json,params:{data:E.Value({}),label:E.Optional(E.Text(""))}})({apply:function(e){var t=e.params,r=t.data,n=t.label;return new ge.Format.Json(r,{label:n||""})},update:function(e){var t=e.oldParams,r=e.newParams,n=e.b;return t.data!==r.data?ft.UpdateResult.Recreate:t.label!==r.label?(n.label=r.label||"",ft.UpdateResult.Updated):ft.UpdateResult.Unchanged},isSerializable:function(){return{isSerializable:!1,reason:"Cannot serialize user imported JSON."}}}),Yne=Ot.BuiltIn({name:"parse-json",display:{name:"Parse JSON",description:"Parse JSON from String data"},from:[ge.Data.String],to:ge.Format.Json})({apply:function(e){var t=this,r=e.a;return We.create("Parse JSON",function(n){return ce(t,void 0,void 0,function(){var a;return de(this,function(i){switch(i.label){case 0:return[4,new Response(r.data).json()];case 1:return a=i.sent(),[2,new ge.Format.Json(a)]}})})})}}),Kne=Ot.BuiltIn({name:"lazy-volume",display:{name:"Lazy Volume",description:"A placeholder for lazy loaded volume representation"},from:ge.Root,to:ge.Volume.Lazy,params:{url:E.Url(""),isBinary:E.Boolean(!1),format:E.Text("ccp4"),entryId:E.Value("",{isHidden:!0}),isovalues:E.ObjectList({type:E.Text("relative"),value:E.Numeric(0),color:E.Color(dr.black),alpha:E.Numeric(1,{min:0,max:1,step:.01}),volumeIndex:E.Numeric(0)},function(e){return e.type+" "+e.value})}})({apply:function(e){var t=this;e.a;var r=e.params;return We.create("Lazy Volume",function(n){return ce(t,void 0,void 0,function(){var a;return de(this,function(i){return a=Array.isArray(r.entryId)?r.entryId.join(", "):r.entryId,[2,new ge.Volume.Lazy(r,{label:""+(a||r.url),description:"Lazy Volume"})]})})})}}),$ne=Object.freeze(Object.defineProperty({__proto__:null,Download:_O,DownloadBlob:wO,RawData:AO,ReadFile:PO,ParseBlob:Nne,ParseCif:Une,ParseCube:zne,ParsePsf:Vne,ParsePly:Hne,ParseCcp4:Gne,ParseDsn6:qne,ParseDx:jne,ImportString:Wne,ImportJson:Xne,ParseJson:Yne,LazyVolume:Kne},Symbol.toStringTag,{value:"Module"})),Qne=Ot.BuiltIn({name:"create-group",display:{name:"Group"},from:[],to:ge.Group,params:{label:E.Text("Group"),description:E.Optional(E.Text(""))}})({apply:function(e){var t=e.params;return new ge.Group({},t)},update:function(e){var t=e.oldParams,r=e.newParams,n=e.b;return lp(t,r)?ft.UpdateResult.Unchanged:(n.label=r.label,n.description=r.description,ft.UpdateResult.Updated)}}),Zne=Object.freeze(Object.defineProperty({__proto__:null,CreateGroup:Qne},Symbol.toStringTag,{value:"Module"}));function Jne(e){var t=new DataView(e.buffer),r=Object.create(null),n=[],a=0,i=new Int32Array(e.buffer,0,23),o=i[0]!==t.getInt32(0);if(i[0]!==84)for(var s=e.byteLength,u=0;u<s;u+=4)t.setFloat32(u,t.getFloat32(u),!0);if(i[0]!==84)throw new Error("dcd bad format, header block start");var l=String.fromCharCode(t.getUint8(4),t.getUint8(5),t.getUint8(6),t.getUint8(7));if(l!=="CORD")throw new Error("dcd bad format, format string");var c=!1,d=!1,f=!1;if(i[22]!==0&&(c=!0,i[12]!==0&&(d=!0),i[13]===1&&(f=!0)),r.NSET=i[2],r.ISTART=i[3],r.NSAVC=i[4],r.NAMNF=i[10],c?r.DELTA=t.getFloat32(44,o):r.DELTA=t.getFloat64(44,o),i[22]!==84)throw new Error("dcd bad format, header block end");a=a+21*4+8;var p=t.getInt32(a,o),h=a+1;if((p-4)%80!==0)throw new Error("dcd bad format, title block start");if(r.TITLE=W$(e.subarray(h,p)),t.getInt32(h+p+4-1,o)!==p)throw new Error("dcd bad format, title block end");if(a=a+p+8,t.getInt32(a,o)!==4)throw new Error("dcd bad format, natom block start");if(r.NATOM=t.getInt32(a+4,o),t.getInt32(a+8,o)!==4)throw new Error("dcd bad format, natom block end");if(a=a+4+8,r.NAMNF>0)throw new Error("dcd format with fixed atoms unsupported, aborting");for(var v=r.NATOM,m=v*4,u=0,s=r.NSET;u<s;++u){var g=Object.create(null);g.elementCount=v,d&&(a+=4,g.cell=[t.getFloat64(a,o),t.getFloat64(a+1,o),t.getFloat64(a+2*8,o),t.getFloat64(a+3*8,o),t.getFloat64(a+4*8,o),t.getFloat64(a+5*8,o)],a+=48,a+=4);for(var y=0;y<3;++y){if(t.getInt32(a,o)!==m)throw new Error("dcd bad format, coord block start: "+u+", "+y);a+=4;var b=new Float32Array(e.buffer,a,v);if(y===0?g.x=b:y===1?g.y=b:g.z=b,a+=m,t.getInt32(a,o)!==m)throw new Error("dcd bad format, coord block end: "+u+", "+y);a+=4}if(f){var x=t.getInt32(a,o);a+=4+x+4}n.push(g)}return{header:r,frames:n}}function eae(e){var t=this;return We.create("Parse DCD",function(r){return ce(t,void 0,void 0,function(){var n;return de(this,function(a){try{return n=Jne(e),[2,bn.success(n)]}catch(i){return[2,bn.error(i)]}return[2]})})})}function tae(e){return function(t,r,n){return rae(e,t,r,n)}}function rae(e,t,r,n){var a=e.data,i=e.indices,o=e.count,s=n.valueType,u=s==="str"?function(l){var c=i[2*l]+t,d=i[2*l+1];if(c>=d)return"";var f=c+r;return f>d&&(f=d),_$(a,c,f)}:s==="int"?function(l){var c=i[2*l]+t;return c>i[2*l+1]?0:td(a,c,c+r)}:function(l){var c=i[2*l]+t;return c>i[2*l+1]?0:hG(a,c,c+r)};return{schema:n,__array:void 0,isDefined:!0,rowCount:o,value:u,valueKind:function(l){return 0},toArray:function(l){return Ta(o,u,l)},areValuesEqual:function(l,c){return u(l)===u(c)}}}function nae(){return{title:"",timeInPs:0,hasVelocities:!1,precision:{position:0,velocity:0},box:[0,0,0]}}function aae(e,t){return{tokenizer:e,header:nae(),numberOfAtoms:0,runtimeCtx:t}}function iae(e){var t=e.tokenizer,r=e.header,n=Et.readLine(t);n.trim().length===0&&(n=Et.readLine(t));var a=n.lastIndexOf("t=");a>=0?(r.timeInPs=parseFloat(n.substring(a+2)),r.title=n.substring(0,a).trim(),r.title&&r.title[r.title.length-1]===","&&(r.title=r.title.substring(0,r.title.length-1))):r.title=n}function oae(e){var t=e.tokenizer;Et.markLine(t);var r=Et.getTokenString(t);e.numberOfAtoms=parseInt(r)}function sae(e){return ce(this,void 0,void 0,function(){var t,r,n,a,i,o,s,u,l,c,d,f,p;return de(this,function(h){switch(h.label){case 0:return t=e.tokenizer,r=e.numberOfAtoms,[4,Et.readLinesAsync(t,r,e.runtimeCtx,1e5)];case 1:return n=h.sent(),a=t.data.substring(n.indices[0],n.indices[1]).substring(20),i=a.match(/\.\d+/g),o=i.length===6,e.header.hasVelocities=o,e.header.precision.position=i[0].length-1,e.header.precision.velocity=o?i[3].length-1:0,s=20,u=e.header.precision.position+5,l=s+3*u,c=e.header.precision.velocity+4,d=tae(n),f=ve.Undefined(e.numberOfAtoms,ve.Schema.float),p={count:e.numberOfAtoms,residueNumber:d(0,5,ve.Schema.int),residueName:d(5,5,ve.Schema.str),atomName:d(10,5,ve.Schema.str),atomNumber:d(15,5,ve.Schema.int),x:d(s,u,ve.Schema.float),y:d(s+u,u,ve.Schema.float),z:d(s+2*u,u,ve.Schema.float),vx:o?d(l,c,ve.Schema.float):f,vy:o?d(l+c,c,ve.Schema.float):f,vz:o?d(l+2*c,c,ve.Schema.float):f},[2,p]}})})}function uae(e){var t=e.tokenizer,r=Et.readLine(t).trim().split(/\s+/g);e.header.box=[+r[0],+r[1],+r[2]]}function lae(e,t){return ce(this,void 0,void 0,function(){var r,n,a,i,o;return de(this,function(s){switch(s.label){case 0:return r=Et(e),[4,t.update({message:"Parsing...",current:0,max:e.length})];case 1:s.sent(),n=[],s.label=2;case 2:return r.position<e.length?(a=aae(r,t),iae(a),oae(a),[4,sae(a)]):[3,4];case 3:return i=s.sent(),uae(a),n.push({header:a.header,atoms:i}),[3,2];case 4:return o={structures:n},[2,bn.success(o)]}})})}function cae(e){var t=this;return We.create("Parse GRO",function(r){return ce(t,void 0,void 0,function(){return de(this,function(n){switch(n.label){case 0:return[4,lae(e,r)];case 1:return[2,n.sent()]}})})})}function dae(e,t,r){var n=this;return r===void 0&&(r=!1),We.create("Parse PDB",function(a){return ce(n,void 0,void 0,function(){var i,o,s;return de(this,function(u){switch(u.label){case 0:return o=(i=bn).success,s={},[4,Et.readAllLinesAsync(e,a)];case 1:return[2,o.apply(i,[(s.lines=u.sent(),s.id=t,s.isPdbqt=r,s)])]}})})})}function fae(e,t){for(var r=0,n=t*3;r<n;r+=3){var a=e[r],i=e[r+1],o=e[r+2],s=1/Math.sqrt(a*a+i*i+o*o);e[r]=a*s,e[r+1]=i*s,e[r+2]=o*s}return e}var _i=C();function Nd(e,t,r,n){for(var a=0,i=n*3;a<i;a+=3)C.fromArray(_i,t,r+a),C.transformMat4(_i,_i,e),C.toArray(_i,t,r+a)}function pae(e,t,r,n){for(var a=0,i=n*3;a<i;a+=3)C.fromArray(_i,t,r+a),C.transformMat3(_i,_i,e),C.toArray(_i,t,r+a)}function hae(e,t){for(var r=0,n=e.length;r<n;r+=3)C.fromArray(_i,e,r),C.normalize(_i,_i),C.scale(_i,_i,t),C.toArray(_i,e,r)}var RT=C(),Jb=C(),OT=C(),io=C(),FT=C();function TO(e,t,r,n,a){for(var i=0,o=a*3;i<o;i+=3){var s=t[i]*3,u=t[i+1]*3,l=t[i+2]*3;C.fromArray(RT,e,s),C.fromArray(Jb,e,u),C.fromArray(OT,e,l),C.sub(io,OT,Jb),C.sub(FT,RT,Jb),C.cross(io,io,FT),r[s]+=io[0],r[s+1]+=io[1],r[s+2]+=io[2],r[u]+=io[0],r[u+1]+=io[1],r[u+2]+=io[2],r[l]+=io[0],r[l+1]+=io[1],r[l+2]+=io[2]}return fae(r,n)}function Rp(e,t,r){r===void 0&&(r=1);for(var n=Gs(e),a=new Int32Array(n+2),i=new Int32Array(t),o=new Int32Array(t),s=0,u=t*r;s<u;s+=r)++o[e[s]];for(var l=0,s=0;s<t;s++)a[s]=l,l+=o[s];a[t]=l;for(var c=new Int32Array(l),s=0,u=t*r;s<u;s+=r){var d=e[s],f=a[d]+i[d];c[f]=s,++i[d]}return{indices:c,offsets:a}}function vae(e,t){e=Math.max(e,2);var r=Math.sqrt(e),n=Math.ceil(r);n=n+(t-n%t)%t;var a=n>0?Math.ceil(e/n):0;return{width:n,height:a,length:n*a*t}}function Na(e,t,r,n){var a=vae(e,t),i=a.length,o=a.width,s=a.height;return n=n&&n.length>=i?n:new r(i),{array:n,width:o,height:s}}var go=C(),mae=new eo("14"),gae=new eo("98");function EO(e){return e>1e5?mae:gae}function Sc(e,t,r){var n=r*3,a=EO(t);a.reset();for(var i=0,o=t*3;i<o;i+=n)C.fromArray(go,e,i),a.includePosition(go);a.finishedIncludeStep();for(var i=0,o=t*3;i<o;i+=n)C.fromArray(go,e,i),a.radiusPosition(go);var s=a.getSphere();if(t<=98){for(var u=[],i=0,o=t*3;i<o;i+=n)u.push(C.fromArray(C(),e,i));Ne.setExtrema(s,u)}return s}var e2=ue();function ya(e,t,r){if(r===1){ue.fromArray(e2,t,0);var n=Ne.clone(e);return ue.isIdentity(e2)?n:Ne.transform(n,n,e2)}var a=EO(r);a.reset();var i=e.center,o=e.radius,s=e.extrema;if(s&&r<50){for(var u=0,l=r;u<l;++u)for(var c=0,d=s;c<d.length;c++){var f=d[c];C.transformMat4Offset(go,f,t,0,0,u*16),a.includePosition(go)}a.finishedIncludeStep();for(var u=0,l=r;u<l;++u)for(var p=0,h=s;p<h.length;p++){var f=h[p];C.transformMat4Offset(go,f,t,0,0,u*16),a.radiusPosition(go)}}else{for(var u=0,l=r;u<l;++u)C.transformMat4Offset(go,i,t,0,0,u*16),a.includePositionRadius(go,o);a.finishedIncludeStep();for(var u=0,l=r;u<l;++u)C.transformMat4Offset(go,i,t,0,0,u*16),a.radiusPositionRadius(go,o)}return a.getSphere()}function Fo(e,t){var r=Na(Math.max(1,e),1,Uint8Array,t&&t.tMarker.ref.value.array);return t?(k.update(t.tMarker,r),k.update(t.uMarkerTexDim,Ge.create(r.width,r.height)),t):{tMarker:k.create(r),uMarkerTexDim:k.create(Ge.create(r.width,r.height))}}var IO=new ArrayBuffer(4),yae=new Int32Array(IO),bae=new Float32Array(IO);function Sae(e){var t=e<-126?-126:e;return yae[0]=(1<<23)*(t+126.94269504),bae[0]}function xae(e){return Sae(1.44269504*e)}var MO=new ArrayBuffer(4),Cae=new Int32Array(MO),_ae=new Float32Array(MO);function wae(e){_ae[0]=e;var t=Cae[0]*11920928955078125e-23;return t-126.94269504}function Aae(e){return .6931471805599453*wae(e)}var Pae=1e4;Aae(Pae+1);function Fv(e,t,r){return e=Ka(e,0,16777216-1)+1,t[r+2]=e%256,e=Math.floor(e/256),t[r+1]=e%256,e=Math.floor(e/256),t[r]=e%256,t}function h3(e,t,r){return Math.floor(e)*256*256+Math.floor(t)*256+Math.floor(r)-1}var Rm=255/256,t2=C.create(256*256*256,256*256,256),Tae=Cr.create(Rm/t2[0],Rm/t2[1],Rm/t2[2],Rm/1),kT=Cr();function Eae(e,t,r,n){return Cr.set(kT,e/255,t/255,r/255,n/255),Cr.dot(kT,Tae)}function il(e,t,r){switch(Ma.getGranularity(e,t.granularity)){case"uniform":return Rae(e,t.size,r);case"group":return Fae(e,t.size,r);case"groupInstance":return kae(e,t.size,r);case"instance":return Oae(e,t.size,r)}}var Qy=100;function Cv(e){var t=e.dSizeType.ref.value;switch(t){case"uniform":return e.uSize.ref.value;case"instance":case"group":case"groupInstance":for(var r=0,n=e.tSize.ref.value.array,a=0,i=n.length;a<i;a+=3){var o=h3(n[a],n[a+1],n[a+2]);r<o&&(r=o)}return r/Qy}}var Iae={array:new Uint8Array(3),width:1,height:1};function Mae(){return{tSize:k.create(Iae),uSizeTexDim:k.create(Ge.create(1,1))}}function Dae(e,t){return t?(k.update(t.uSize,e),k.updateIfChanged(t.dSizeType,"uniform"),t):w(w({uSize:k.create(e)},Mae()),{dSizeType:k.create("uniform")})}function Rae(e,t,r){return Dae(t($i),r)}function v3(e,t,r){return r?(k.update(r.tSize,e),k.update(r.uSizeTexDim,Ge.create(e.width,e.height)),k.updateIfChanged(r.dSizeType,t),r):{uSize:k.create(0),tSize:k.create(e),uSizeTexDim:k.create(Ge.create(e.width,e.height)),dSizeType:k.create(t)}}function Oae(e,t,r){var n=e.instanceCount,a=Na(Math.max(1,n),3,Uint8Array,r&&r.tSize.ref.value.array);for(e.reset();e.hasNext&&!e.isNextNewInstance;){var i=e.move();Fv(t(i.location)*Qy,a.array,i.instanceIndex*3),e.skipInstance()}return v3(a,"instance",r)}function Fae(e,t,r){var n=e.groupCount,a=Na(Math.max(1,n),3,Uint8Array,r&&r.tSize.ref.value.array);for(e.reset();e.hasNext&&!e.isNextNewInstance;){var i=e.move();Fv(t(i.location)*Qy,a.array,i.groupIndex*3)}return v3(a,"group",r)}function kae(e,t,r){var n=e.groupCount,a=e.instanceCount,i=a*n,o=Na(Math.max(1,i),3,Uint8Array,r&&r.tSize.ref.value.array);for(e.reset();e.hasNext;){var s=e.move();Fv(t(s.location)*Qy,o.array,s.index*3)}return v3(o,"groupInstance",r)}function Bae(e,t,r,n){for(var a=t;a<r;++a)it.toArray(n,e,a*4),e[a*4+3]=255;return!0}function BT(e,t,r){return e.fill(0,t*4,r*4),!0}function Lae(e,t){var r=Na(Math.max(1,e),4,Uint8Array,t&&t.tOverpaint.ref.value.array);return t?(k.update(t.tOverpaint,r),k.update(t.uOverpaintTexDim,Ge.create(r.width,r.height)),k.updateIfChanged(t.dOverpaint,e>0),t):{tOverpaint:k.create(r),uOverpaintTexDim:k.create(Ge.create(r.width,r.height)),dOverpaint:k.create(e>0)}}var LT={array:new Uint8Array(4),width:1,height:1};function ol(e){return e?(k.update(e.tOverpaint,LT),k.update(e.uOverpaintTexDim,Ge.create(1,1)),e):{tOverpaint:k.create(LT),uOverpaintTexDim:k.create(Ge.create(1,1)),dOverpaint:k.create(!1)}}function Nae(e,t,r,n){for(var a=t;a<r;++a)e[a]=n*255;return!0}function DO(e,t){for(var r=0,n=0;n<t;++n)r+=e[n];return r/(255*t)}function Uae(e,t,r){e.fill(0,t,r)}function zae(e,t){var r=Na(Math.max(1,e),1,Uint8Array,t&&t.tTransparency.ref.value.array);return t?(k.update(t.tTransparency,r),k.update(t.uTransparencyTexDim,Ge.create(r.width,r.height)),k.updateIfChanged(t.dTransparency,e>0),k.updateIfChanged(t.transparencyAverage,DO(r.array,e)),t):{tTransparency:k.create(r),uTransparencyTexDim:k.create(Ge.create(r.width,r.height)),dTransparency:k.create(e>0),transparencyAverage:k.create(0)}}var NT={array:new Uint8Array(1),width:1,height:1};function sl(e){return e?(k.update(e.tTransparency,NT),k.update(e.uTransparencyTexDim,Ge.create(1,1)),e):{tTransparency:k.create(NT),uTransparencyTexDim:k.create(Ge.create(1,1)),dTransparency:k.create(!1),transparencyAverage:k.create(0)}}function Vae(e,t,r,n){for(var a=t;a<r;++a)e[a]=n;return!0}function Hae(e,t,r){e.fill(0,t,r)}function Gae(e,t){var r=Na(Math.max(1,e),1,Uint8Array,t&&t.tClipping.ref.value.array);return t?(k.update(t.tClipping,r),k.update(t.uClippingTexDim,Ge.create(r.width,r.height)),k.updateIfChanged(t.dClipping,e>0),t):{dClipObjectCount:k.create(0),dClipVariant:k.create("instance"),tClipping:k.create(r),uClippingTexDim:k.create(Ge.create(r.width,r.height)),dClipping:k.create(e>0)}}var UT={array:new Uint8Array(1),width:1,height:1};function ul(e){return e?(k.update(e.tClipping,UT),k.update(e.uClippingTexDim,Ge.create(1,1)),e):{dClipObjectCount:k.create(0),dClipVariant:k.create("instance"),tClipping:k.create(UT),uClippingTexDim:k.create(Ge.create(1,1)),dClipping:k.create(!1)}}var Ud;(function(e){function t(h,v,m,g){return g?i(h,v,m,g):a(h,v,m)}e.create=t;function r(h){var v=h?h.centerBuffer.ref.value:new Float32Array(0),m=h?h.groupBuffer.ref.value:new Float32Array(0);return t(v,m,0,h)}e.createEmpty=r;function n(h){return Ja([h.pointCount,h.centerBuffer.ref.version,h.groupBuffer.ref.version])}function a(h,v,m){var g=Ne(),y,b=-1,x=-1,S={kind:"points",pointCount:m,centerBuffer:k.create(h),groupBuffer:k.create(v),get boundingSphere(){var _=n(S);if(_!==b){var A=Sc(S.centerBuffer.ref.value,S.pointCount,1);Ne.copy(g,A),b=_}return g},get groupMapping(){return S.groupBuffer.ref.version!==x&&(y=Rp(S.groupBuffer.ref.value,S.pointCount),x=S.groupBuffer.ref.version),y},setBoundingSphere:function(_){Ne.copy(g,_),b=n(S)}};return S}function i(h,v,m,g){return g.pointCount=m,k.update(g.centerBuffer,h),k.update(g.groupBuffer,v),g}function o(h,v){var m=h.centerBuffer.ref.value;Nd(v,m,0,h.pointCount),k.update(h.centerBuffer,m)}e.transform=o,e.Params=w(w({},At.Params),{sizeFactor:E.Numeric(1.5,{min:0,max:10,step:.1}),pointSizeAttenuation:E.Boolean(!1),pointFilledCircle:E.Boolean(!1),pointEdgeBleach:E.Numeric(.2,{min:0,max:1,step:.05})}),e.Utils={Params:e.Params,createEmpty:r,createValues:u,createValuesSimple:l,updateValues:c,updateBoundingSphere:d,createRenderableState:f,updateRenderableState:p,createPositionIterator:s};function s(h,v){var m=h.pointCount,g=v.instanceCount.ref.value,y=Kd(),b=y.position,x=h.centerBuffer.ref.value,S=v.aTransform.ref.value,_=function(A,T){return T<0?C.fromArray(b,x,A*3):C.transformMat4Offset(b,x,S,0,A*3,T*16),y};return pn(m,g,1,_)}function u(h,v,m,g,y){var b=m.instanceCount,x=m.groupCount,S=s(h,v),_=to(m,S,g.color),A=il(m,g.size),T=Fo(b*x),I=ol(),M=sl(),O=ul(),D={drawCount:h.pointCount,vertexCount:h.pointCount,groupCount:x,instanceCount:b},F=Ne.clone(h.boundingSphere),G=ya(F,v.aTransform.ref.value,b);return w(w(w(w(w(w(w(w(w({aPosition:h.centerBuffer,aGroup:h.groupBuffer,boundingSphere:k.create(G),invariantBoundingSphere:k.create(F),uInvariantBoundingSphere:k.create(Cr.ofSphere(F))},_),A),T),I),M),O),v),At.createValues(y,D)),{uSizeFactor:k.create(y.sizeFactor),dPointSizeAttenuation:k.create(y.pointSizeAttenuation),dPointFilledCircle:k.create(y.pointFilledCircle),uPointEdgeBleach:k.create(y.pointEdgeBleach)})}function l(h,v,m,g,y){var b=At.createSimple(m,g,y),x=w(w({},E.getDefaultValues(e.Params)),v);return u(h,b.transform,b.locationIterator,b.theme,x)}function c(h,v){At.updateValues(h,v),k.updateIfChanged(h.uSizeFactor,v.sizeFactor),k.updateIfChanged(h.dPointSizeAttenuation,v.pointSizeAttenuation),k.updateIfChanged(h.dPointFilledCircle,v.pointFilledCircle),k.updateIfChanged(h.uPointEdgeBleach,v.pointEdgeBleach)}function d(h,v){var m=Ne.clone(v.boundingSphere),g=ya(m,h.aTransform.ref.value,h.instanceCount.ref.value);Ne.equals(g,h.boundingSphere.ref.value)||k.update(h.boundingSphere,g),Ne.equals(m,h.invariantBoundingSphere.ref.value)||(k.update(h.invariantBoundingSphere,m),k.update(h.uInvariantBoundingSphere,Cr.fromSphere(h.uInvariantBoundingSphere.ref.value,m)))}function f(h){var v=At.createRenderableState(h);return p(v,h),v}function p(h,v){At.updateRenderableState(h,v),h.opaque=h.opaque&&(!v.pointFilledCircle||v.pointFilledCircle&&v.pointEdgeBleach===0),h.writeDepth=h.opaque}})(Ud||(Ud={}));function zT(e,t,r,n,a,i,o){for(var s=0;s<t;s++){for(var u=0;u<r;u++)n[u]=e[u*t+s];VT(n,a,i,o,r);for(var u=0;u<r;u++)e[u*t+s]=a[u]}for(var u=0;u<r;u++){for(var s=0;s<t;s++)n[s]=e[u*t+s];VT(n,a,i,o,t);for(var s=0;s<t;s++)e[u*t+s]=Math.sqrt(a[s])}}function VT(e,t,r,n,a){r[0]=0,n[0]=Number.MIN_SAFE_INTEGER,n[1]=Number.MAX_SAFE_INTEGER;for(var i=1,o=0;i<a;i++){for(var s=(e[i]+i*i-(e[r[o]]+r[o]*r[o]))/(2*i-2*r[o]);s<=n[o];)o--,s=(e[i]+i*i-(e[r[o]]+r[o]*r[o]))/(2*i-2*r[o]);o++,r[o]=i,n[o]=s,n[o+1]=Number.MAX_SAFE_INTEGER}for(var i=0,o=0;i<a;i++){for(;n[o+1]<i;)o++;t[i]=(i-r[o])*(i-r[o])+e[r[o]]}}var r2={};function qae(e){var t=JSON.stringify(e);return r2[t]===void 0&&(r2[t]=new jae(e)),r2[t]}var RO={fontFamily:E.Select("sans-serif",[["sans-serif","Sans Serif"],["monospace","Monospace"],["serif","Serif"],["cursive","Cursive"]]),fontQuality:E.Select(3,[[0,"lower"],[1,"low"],[2,"medium"],[3,"high"],[4,"higher"]]),fontStyle:E.Select("normal",[["normal","Normal"],["italic","Italic"],["oblique","Oblique"]]),fontVariant:E.Select("normal",[["normal","Normal"],["small-caps","Small Caps"]]),fontWeight:E.Select("normal",[["normal","Normal"],["bold","Bold"]])},jae=function(){function e(t){t===void 0&&(t={}),this.mapped={},this.scratchW=0,this.scratchH=0,this.currentX=0,this.currentY=0,this.cutoff=.5;var r=w(w({},E.getDefaultValues(RO)),t);this.props=r;var n=32*(r.fontQuality+1);this.buffer=n/8,this.radius=n/3,this.lineHeight=Math.round(n+2*this.buffer+this.radius),this.maxWidth=Math.round(this.lineHeight*.75),this.texture=Na(350*this.lineHeight*this.maxWidth,1,Uint8Array),this.scratchCanvas=document.createElement("canvas"),this.scratchCanvas.width=this.maxWidth,this.scratchCanvas.height=this.lineHeight,this.scratchContext=this.scratchCanvas.getContext("2d"),this.scratchContext.font=r.fontStyle+" "+r.fontVariant+" "+r.fontWeight+" "+n+"px "+r.fontFamily,this.scratchContext.fillStyle="black",this.scratchContext.textBaseline="middle",this.scratchData=new Uint8Array(this.lineHeight*this.maxWidth),this.gridOuter=new Float64Array(this.lineHeight*this.maxWidth),this.gridInner=new Float64Array(this.lineHeight*this.maxWidth),this.f=new Float64Array(Math.max(this.lineHeight,this.maxWidth)),this.d=new Float64Array(Math.max(this.lineHeight,this.maxWidth)),this.z=new Float64Array(Math.max(this.lineHeight,this.maxWidth)+1),this.v=new Int16Array(Math.max(this.lineHeight,this.maxWidth)),this.middle=Math.ceil(this.lineHeight/2),this.placeholder=this.get(String.fromCharCode(65533))}return e.prototype.get=function(t){if(this.mapped[t]===void 0){this.draw(t);var r=this.texture,n=r.array,a=r.width,i=r.height,o=this.scratchData;if(this.currentX+this.scratchW>a&&(this.currentX=0,this.currentY+=this.scratchH),this.currentY+this.scratchH>i)return console.warn("canvas to small"),this.placeholder;this.mapped[t]={x:this.currentX,y:this.currentY,w:this.scratchW,h:this.scratchH,nw:this.scratchW/this.lineHeight,nh:this.scratchH/this.lineHeight};for(var s=0;s<this.scratchH;++s)for(var u=0;u<this.scratchW;++u)n[a*(this.currentY+s)+this.currentX+u]=o[s*this.scratchW+u];this.currentX+=this.scratchW}return this.mapped[t]},e.prototype.draw=function(t){var r=this.lineHeight,n=this.scratchContext,a=this.scratchData,i=n.measureText(t),o=Math.min(this.maxWidth,Math.ceil(i.width+2*this.buffer)),s=o*r;n.clearRect(0,0,o,r),n.fillText(t,this.buffer,this.middle);for(var u=n.getImageData(0,0,o,r),l=0;l<s;l++){var c=u.data[l*4+3]/255;this.gridOuter[l]=c===1?0:c===0?Number.MAX_SAFE_INTEGER:Math.pow(Math.max(0,.5-c),2),this.gridInner[l]=c===1?Number.MAX_SAFE_INTEGER:c===0?0:Math.pow(Math.max(0,c-.5),2)}zT(this.gridOuter,o,r,this.f,this.d,this.v,this.z),zT(this.gridInner,o,r,this.f,this.d,this.v,this.z);for(var l=0;l<s;l++){var d=this.gridOuter[l]-this.gridInner[l];a[l]=Math.max(0,Math.min(255,Math.round(255-255*(d/this.radius+this.cutoff))))}this.scratchW=o,this.scratchH=r},e}(),Do;(function(e){function t(p,h,v,m,g,y,b,x,S){return S?i(p,h,v,m,g,y,b,x,S):a(p,h,v,m,g,y,b,x)}e.create=t;function r(p){var h=p?p.fontTexture.ref.value:Na(0,1,Uint8Array),v=p?p.centerBuffer.ref.value:new Float32Array(0),m=p?p.mappingBuffer.ref.value:new Float32Array(0),g=p?p.depthBuffer.ref.value:new Float32Array(0),y=p?p.indexBuffer.ref.value:new Uint32Array(0),b=p?p.groupBuffer.ref.value:new Float32Array(0),x=p?p.tcoordBuffer.ref.value:new Float32Array(0);return t(h,v,m,g,y,b,x,0,p)}e.createEmpty=r;function n(p){return Ja([p.charCount,p.fontTexture.ref.version,p.centerBuffer.ref.version,p.mappingBuffer.ref.version,p.depthBuffer.ref.version,p.indexBuffer.ref.version,p.groupBuffer.ref.version,p.tcoordBuffer.ref.version])}function a(p,h,v,m,g,y,b,x){var S=Ne(),_,A=-1,T=-1,I={kind:"text",charCount:x,fontTexture:k.create(p),centerBuffer:k.create(h),mappingBuffer:k.create(v),depthBuffer:k.create(m),indexBuffer:k.create(g),groupBuffer:k.create(y),tcoordBuffer:k.create(b),get boundingSphere(){var M=n(I);if(M!==A){var O=Sc(I.centerBuffer.ref.value,I.charCount*4,4);Ne.copy(S,O),A=M}return S},get groupMapping(){return I.groupBuffer.ref.version!==T&&(_=Rp(I.groupBuffer.ref.value,I.charCount,4),T=I.groupBuffer.ref.version),_},setBoundingSphere:function(M){Ne.copy(S,M),A=n(I)}};return I}function i(p,h,v,m,g,y,b,x,S){return S.charCount=x,k.update(S.fontTexture,p),k.update(S.centerBuffer,h),k.update(S.mappingBuffer,v),k.update(S.depthBuffer,m),k.update(S.indexBuffer,g),k.update(S.groupBuffer,y),k.update(S.tcoordBuffer,b),S}e.Params=w(w(w({},At.Params),RO),{sizeFactor:E.Numeric(1,{min:0,max:10,step:.1}),borderWidth:E.Numeric(0,{min:0,max:.5,step:.01}),borderColor:E.Color(dr.grey),offsetX:E.Numeric(0,{min:0,max:10,step:.1}),offsetY:E.Numeric(0,{min:0,max:10,step:.1}),offsetZ:E.Numeric(0,{min:0,max:10,step:.1}),background:E.Boolean(!1),backgroundMargin:E.Numeric(.2,{min:0,max:1,step:.01}),backgroundColor:E.Color(dr.grey),backgroundOpacity:E.Numeric(1,{min:0,max:1,step:.01}),tether:E.Boolean(!1),tetherLength:E.Numeric(1,{min:0,max:5,step:.1}),tetherBaseWidth:E.Numeric(.3,{min:0,max:1,step:.01}),attachment:E.Select("middle-center",[["bottom-left","bottom-left"],["bottom-center","bottom-center"],["bottom-right","bottom-right"],["middle-left","middle-left"],["middle-center","middle-center"],["middle-right","middle-right"],["top-left","top-left"],["top-center","top-center"],["top-right","top-right"]])}),e.Utils={Params:e.Params,createEmpty:r,createValues:s,createValuesSimple:u,updateValues:l,updateBoundingSphere:c,createRenderableState:d,updateRenderableState:f,createPositionIterator:o};function o(p,h){var v=p.charCount*4,m=h.instanceCount.ref.value,g=Kd(),y=g.position,b=p.centerBuffer.ref.value,x=h.aTransform.ref.value,S=function(_,A){return A<0?C.fromArray(y,b,_*3):C.transformMat4Offset(y,b,x,0,_*3,A*16),g};return pn(v,m,4,S)}function s(p,h,v,m,g){var y=v.instanceCount,b=v.groupCount,x=o(p,h),S=to(v,x,m.color),_=il(v,m.size),A=Fo(y*b),T=ol(),I=sl(),M=ul(),O={drawCount:p.charCount*2*3,vertexCount:p.charCount*4,groupCount:b,instanceCount:y},D=HT(p.mappingBuffer.ref.value,p.depthBuffer.ref.value,p.charCount,Cv(_)),F=Ne.expand(Ne(),p.boundingSphere,D),G=ya(F,h.aTransform.ref.value,y);return w(w(w(w(w(w(w(w(w(w({aPosition:p.centerBuffer,aMapping:p.mappingBuffer,aDepth:p.depthBuffer,aGroup:p.groupBuffer,elements:p.indexBuffer,boundingSphere:k.create(G),invariantBoundingSphere:k.create(F),uInvariantBoundingSphere:k.create(Cr.ofSphere(F))},S),_),A),T),I),M),h),{aTexCoord:p.tcoordBuffer,tFont:p.fontTexture,padding:k.create(D)}),At.createValues(g,O)),{uSizeFactor:k.create(g.sizeFactor),uBorderWidth:k.create(Ka(g.borderWidth/2,0,.5)),uBorderColor:k.create(it.toArrayNormalized(g.borderColor,C.zero(),0)),uOffsetX:k.create(g.offsetX),uOffsetY:k.create(g.offsetY),uOffsetZ:k.create(g.offsetZ),uBackgroundColor:k.create(it.toArrayNormalized(g.backgroundColor,C.zero(),0)),uBackgroundOpacity:k.create(g.backgroundOpacity)})}function u(p,h,v,m,g){var y=At.createSimple(v,m,g),b=w(w({},E.getDefaultValues(e.Params)),h);return s(p,y.transform,y.locationIterator,y.theme,b)}function l(p,h){At.updateValues(p,h),k.updateIfChanged(p.uSizeFactor,h.sizeFactor),k.updateIfChanged(p.uBorderWidth,h.borderWidth),it.fromNormalizedArray(p.uBorderColor.ref.value,0)!==h.borderColor&&(it.toArrayNormalized(h.borderColor,p.uBorderColor.ref.value,0),k.update(p.uBorderColor,p.uBorderColor.ref.value)),k.updateIfChanged(p.uOffsetX,h.offsetX),k.updateIfChanged(p.uOffsetY,h.offsetY),k.updateIfChanged(p.uOffsetZ,h.offsetZ),it.fromNormalizedArray(p.uBackgroundColor.ref.value,0)!==h.backgroundColor&&(it.toArrayNormalized(h.backgroundColor,p.uBackgroundColor.ref.value,0),k.update(p.uBackgroundColor,p.uBackgroundColor.ref.value)),k.updateIfChanged(p.uBackgroundOpacity,h.backgroundOpacity)}function c(p,h){var v=HT(p.aMapping.ref.value,p.aDepth.ref.value,h.charCount,Cv(p)),m=Ne.expand(Ne(),h.boundingSphere,v),g=ya(m,p.aTransform.ref.value,p.instanceCount.ref.value);Ne.equals(g,p.boundingSphere.ref.value)||k.update(p.boundingSphere,g),Ne.equals(m,p.invariantBoundingSphere.ref.value)||(k.update(p.invariantBoundingSphere,m),k.update(p.uInvariantBoundingSphere,Cr.fromSphere(p.uInvariantBoundingSphere.ref.value,m))),k.update(p.padding,v)}function d(p){var h=At.createRenderableState(p);return f(h,p),h}function f(p,h){At.updateRenderableState(p,h),p.pickable=!1,p.opaque=!1,p.writeDepth=!0}})(Do||(Do={}));function HT(e,t,r,n){for(var a=0,i=0,o=0,s=r*4;o<s;++o){var u=2*o,l=Math.abs(e[u]);l>a&&(a=l);var c=Math.abs(e[u+1]);c>a&&(a=c);var d=Math.abs(t[o]);d>i&&(i=d)}return Math.max(i,n+n*a)}var xs=C(),Cs=C(),Lc=C(),GT=je.add,Om=je.add3,Zi;(function(e){function t(r,n,a){r===void 0&&(r=2048),n===void 0&&(n=1024);var i=je.create(Float32Array,1,n,a?a.groupBuffer.ref.value:r),o=je.create(Float32Array,3,n,a?a.startBuffer.ref.value:r),s=je.create(Float32Array,3,n,a?a.endBuffer.ref.value:r),u=function(d,f,p,h,v,m,g){for(var y=0;y<4;++y)Om(o,d,f,p),Om(s,h,v,m),GT(i,g)},l=function(d,f,p){for(var h=0;h<4;++h)Om(o,d[0],d[1],d[2]),Om(s,f[0],f[1],f[2]),GT(i,p)},c=function(d,f,p,h){var v=C.distance(d,f),m=Math.floor(p/2),g=1/p;C.sub(Lc,f,d);for(var y=0;y<m;++y){var b=g*(y*2+1);C.setMagnitude(Lc,Lc,v*b),C.add(xs,d,Lc),C.setMagnitude(Lc,Lc,v*g*((y+1)*2)),C.add(Cs,d,Lc),u(xs[0],xs[1],xs[2],Cs[0],Cs[1],Cs[2],h)}};return{add:u,addVec:l,addFixedCountDashes:c,addFixedLengthDashes:function(d,f,p,h){var v=C.distance(d,f);c(d,f,v/p,h)},addCage:function(d,f,p){for(var h=f.vertices,v=f.edges,m=0,g=v.length;m<g;m+=2)C.fromArray(xs,h,v[m]*3),C.fromArray(Cs,h,v[m+1]*3),C.transformMat4(xs,xs,d),C.transformMat4(Cs,Cs,d),u(xs[0],xs[1],xs[2],Cs[0],Cs[1],Cs[2],p)},getLines:function(){var d=i.elementCount/4,f=je.compact(i,!0),p=je.compact(o,!0),h=je.compact(s,!0),v=a&&d<=a.lineCount?a.mappingBuffer.ref.value:new Float32Array(d*8),m=a&&d<=a.lineCount?a.indexBuffer.ref.value:new Uint32Array(d*6);return(!a||d>a.lineCount)&&Wae(d,v,m),mn.create(v,m,f,p,h,d,a)}}}e.create=t})(Zi||(Zi={}));function Wae(e,t,r){for(var n=0;n<e;++n){var a=n*8;t[a]=-1,t[a+1]=-1,t[a+2]=1,t[a+3]=-1,t[a+4]=-1,t[a+5]=1,t[a+6]=1,t[a+7]=1}for(var n=0;n<e;++n){var i=n*4,o=n*6;r[o]=i,r[o+1]=i+1,r[o+2]=i+2,r[o+3]=i+1,r[o+4]=i+3,r[o+5]=i+2}}var mn;(function(e){function t(p,h,v,m,g,y,b){return b?o(p,h,v,m,g,y,b):i(p,h,v,m,g,y)}e.create=t;function r(p){var h=p?p.mappingBuffer.ref.value:new Float32Array(0),v=p?p.indexBuffer.ref.value:new Uint32Array(0),m=p?p.groupBuffer.ref.value:new Float32Array(0),g=p?p.startBuffer.ref.value:new Float32Array(0),y=p?p.endBuffer.ref.value:new Float32Array(0);return t(h,v,m,g,y,0,p)}e.createEmpty=r;function n(p,h){for(var v=p.vertexBuffer.ref.value,m=p.indexBuffer.ref.value,g=p.groupBuffer.ref.value,y=Zi.create(p.triangleCount*3,p.triangleCount/10,h),b=0,x=p.triangleCount*3;b<x;b+=3){var S=m[b],_=m[b+1],A=m[b+2],T=v[S*3],I=v[S*3+1],M=v[S*3+2],O=v[_*3],D=v[_*3+1],F=v[_*3+2],G=v[A*3],N=v[A*3+1],z=v[A*3+2];y.add(T,I,M,O,D,F,g[S]),y.add(T,I,M,G,N,z,g[S]),y.add(O,D,F,G,N,z,g[_])}return y.getLines()}e.fromMesh=n;function a(p){return Ja([p.lineCount,p.mappingBuffer.ref.version,p.indexBuffer.ref.version,p.groupBuffer.ref.version,p.startBuffer.ref.version,p.endBuffer.ref.version])}function i(p,h,v,m,g,y){var b=Ne(),x,S=-1,_=-1,A={kind:"lines",lineCount:y,mappingBuffer:k.create(p),indexBuffer:k.create(h),groupBuffer:k.create(v),startBuffer:k.create(m),endBuffer:k.create(g),get boundingSphere(){var T=a(A);if(T!==S){var I=Sc(A.startBuffer.ref.value,A.lineCount*4,4),M=Sc(A.endBuffer.ref.value,A.lineCount*4,4);Ne.expandBySphere(b,I,M),S=T}return b},get groupMapping(){return A.groupBuffer.ref.version!==_&&(x=Rp(A.groupBuffer.ref.value,A.lineCount,4),_=A.groupBuffer.ref.version),x},setBoundingSphere:function(T){Ne.copy(b,T),S=a(A)}};return A}function o(p,h,v,m,g,y,b){return y>b.lineCount&&(k.update(b.mappingBuffer,p),k.update(b.indexBuffer,h)),b.lineCount=y,k.update(b.groupBuffer,v),k.update(b.startBuffer,m),k.update(b.endBuffer,g),b}function s(p,h){var v=p.startBuffer.ref.value;Nd(h,v,0,p.lineCount*4),k.update(p.startBuffer,v);var m=p.endBuffer.ref.value;Nd(h,m,0,p.lineCount*4),k.update(p.endBuffer,m)}e.transform=s,e.Params=w(w({},At.Params),{sizeFactor:E.Numeric(1.5,{min:0,max:10,step:.1}),lineSizeAttenuation:E.Boolean(!1)}),e.Utils={Params:e.Params,createEmpty:r,createValues:l,createValuesSimple:c,updateValues:d,updateBoundingSphere:f,createRenderableState:At.createRenderableState,updateRenderableState:At.updateRenderableState,createPositionIterator:u};function u(p,h){var v=p.lineCount*4,m=h.instanceCount.ref.value,g=Kd(),y=g.position,b=p.startBuffer.ref.value,x=p.endBuffer.ref.value,S=h.aTransform.ref.value,_=function(A,T){var I=A%4===0?b:x;return T<0?C.fromArray(y,I,A*3):C.transformMat4Offset(y,I,S,0,A*3,T*16),g};return pn(v,m,2,_)}function l(p,h,v,m,g){var y=v.instanceCount,b=v.groupCount,x=u(p,h),S=to(v,x,m.color),_=il(v,m.size),A=Fo(y*b),T=ol(),I=sl(),M=ul(),O={drawCount:p.lineCount*2*3,vertexCount:p.lineCount*4,groupCount:b,instanceCount:y},D=Ne.clone(p.boundingSphere),F=ya(D,h.aTransform.ref.value,y);return w(w(w(w(w(w(w(w(w({aMapping:p.mappingBuffer,aGroup:p.groupBuffer,aStart:p.startBuffer,aEnd:p.endBuffer,elements:p.indexBuffer,boundingSphere:k.create(F),invariantBoundingSphere:k.create(D),uInvariantBoundingSphere:k.create(Cr.ofSphere(D))},S),_),A),T),I),M),h),At.createValues(g,O)),{uSizeFactor:k.create(g.sizeFactor),dLineSizeAttenuation:k.create(g.lineSizeAttenuation),dDoubleSided:k.create(!0),dFlipSided:k.create(!1)})}function c(p,h,v,m,g){var y=At.createSimple(v,m,g),b=w(w({},E.getDefaultValues(e.Params)),h);return l(p,y.transform,y.locationIterator,y.theme,b)}function d(p,h){At.updateValues(p,h),k.updateIfChanged(p.uSizeFactor,h.sizeFactor),k.updateIfChanged(p.dLineSizeAttenuation,h.lineSizeAttenuation)}function f(p,h){var v=Ne.clone(h.boundingSphere),m=ya(v,p.aTransform.ref.value,p.instanceCount.ref.value);Ne.equals(m,p.boundingSphere.ref.value)||k.update(p.boundingSphere,m),Ne.equals(v,p.invariantBoundingSphere.ref.value)||(k.update(p.invariantBoundingSphere,v),k.update(p.uInvariantBoundingSphere,Cr.fromSphere(p.uInvariantBoundingSphere.ref.value,v)))}})(mn||(mn={}));var qT=C(),jT=C(),WT=C();function Zy(e,t){for(var r=t.length,n=Op(r/3),a=0;a<r;a+=3)C.fromArray(qT,e,t[a]*3),C.fromArray(jT,e,t[a+1]*3),C.fromArray(WT,e,t[a+2]*3),n.add(qT,jT,WT);return n.getPrimitive()}var Fm=C();function Op(e,t){t===void 0&&(t=e*3);var r=new Float32Array(t*3),n=new Float32Array(t*3),a=new Uint32Array(e*3),i=0,o=0;return{add:function(s,u,l){C.toArray(s,r,i),C.toArray(u,r,i+3),C.toArray(l,r,i+6),C.triangleNormal(Fm,s,u,l);for(var c=0;c<3;++c)C.toArray(Fm,n,i+3*c),a[o+c]=i/3+c;i+=9,o+=3},addQuad:function(s,u,l,c){C.toArray(s,r,i),C.toArray(u,r,i+3),C.toArray(l,r,i+6),C.toArray(c,r,i+9),C.triangleNormal(Fm,s,u,l);for(var d=0;d<4;++d)C.toArray(Fm,n,i+3*d);var f=i/3;a[o]=f,a[o+1]=f+1,a[o+2]=f+2,a[o+3]=f+2,a[o+4]=f+3,a[o+5]=f,i+=12,o+=6},getPrimitive:function(){return{vertices:r,normals:n,indices:a}}}}var _f=C(),Xae=Mn();function m3(e,t){for(var r=e.vertices,n=e.normals,a=Mn.directionTransform(Xae,t),i=0,o=r.length;i<o;i+=3)C.transformMat4(_f,C.fromArray(_f,r,i),t),C.toArray(_f,r,i),C.transformMat3(_f,C.fromArray(_f,n,i),a),C.toArray(_f,n,i);return e}function Qs(e,t,r){r===void 0&&(r=-1);for(var n=new Float32Array(e*3),a=r===-1?e<=4?Math.sqrt(2)/2:.6:r,i=t?1:0,o=0,s=e;o<s;++o){var u=(o*2+i)/e*Math.PI;n[o*3]=Math.cos(u)*a,n[o*3+1]=Math.sin(u)*a,n[o*3+2]=0}return n}function g3(e,t){return{vertices:e,edges:t}}function OO(e){return{vertices:new Float32Array(e.vertices),edges:new Uint32Array(e.edges)}}var n2=C.zero();function FO(e,t){for(var r=e.vertices,n=0,a=r.length;n<a;n+=3)C.transformMat4(n2,C.fromArray(n2,r,n),t),C.toArray(n2,r,n);return e}var ou=C(),su=C(),uu=C(),wf=C(),Fn=Qs(4,!0);function kO(e){for(var t=12,r=e?12*3:6*4,n=Op(t,r),a=0;a<4;++a){var i=(a+1)%4;C.set(ou,Fn[a*3],Fn[a*3+1],-.5),C.set(su,Fn[i*3],Fn[i*3+1],-.5),C.set(uu,Fn[i*3],Fn[i*3+1],.5),C.set(wf,Fn[a*3],Fn[a*3+1],.5),e?n.add(ou,su,uu):n.addQuad(ou,su,uu,wf)}return C.set(ou,Fn[0],Fn[1],-.5),C.set(su,Fn[3],Fn[4],-.5),C.set(uu,Fn[6],Fn[7],-.5),C.set(wf,Fn[9],Fn[10],-.5),e?n.add(uu,su,ou):n.addQuad(wf,uu,su,ou),C.set(ou,Fn[0],Fn[1],.5),C.set(su,Fn[3],Fn[4],.5),C.set(uu,Fn[6],Fn[7],.5),C.set(wf,Fn[9],Fn[10],.5),e?n.add(ou,su,uu):n.addQuad(ou,su,uu,wf),n.getPrimitive()}var a2;function y3(){return a2||(a2=kO(!1)),a2}var i2;function Yae(){return i2||(i2=kO(!0)),i2}var o2;function BO(){return o2||(o2=g3([.5,.5,-.5,-.5,.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5],[0,4,1,5,2,6,3,7,0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4])),o2}function XT(e){return e.map(function(t){return{x:t[0],alpha:t[1]}})}function YT(e,t,r){for(var n=Nt(Nt([{x:0,alpha:0},{x:0,alpha:0}],e),[{x:1,alpha:0},{x:1,alpha:0}]),a=us.create({domain:[0,1],listOrName:t}),i=256,o=r?r.ref.value.array:new Uint8Array(i*4),s=0,u,l,c,d,f,p,h=e.length+1,v=0;v<h;++v){u=n[v+1].x,l=n[v+2].x,c=n[v].alpha,d=n[v+1].alpha,f=n[v+2].alpha,p=n[v+3].alpha;for(var m=Math.round((l-u)*i),g=0;g<m;++g){var y=g/m;o[s*4+3]=Math.max(0,_0(c,d,f,p,y,.5)*255),a.colorToArray(s/255,o,s*4),++s}}var b={array:o,width:256,height:1};return r?(k.update(r,b),r):k.create(b)}function Kae(e,t,r){if(r)return KT(e,t,r.min,r.max);var n=Ui(e),a=n[0],i=n[1];return KT(e,t,a,i)}function KT(e,t,r,n){var a=(n-r)/t;a===0&&(a=1);for(var i=new Int32Array(t),o=0,s=e.length;o<s;o++){var u=Math.floor((e[o]-r)/a);u>=t?u=t-1:u<0&&(u=0),i[u]++}return{min:r,max:n,binWidth:a,counts:i}}var qa;(function(e){e.One={transform:{kind:"matrix",matrix:ue.identity()},cells:Pr.create(Pr.Space([1,1,1],[0,1,2]),Pr.Data1([0])),stats:{min:0,max:0,mean:0,sigma:0}};var t=ue.zero(),r=ue.zero();function n(u){if(u.transform.kind==="matrix")return ue.copy(ue(),u.transform.matrix);if(u.transform.kind==="spacegroup"){var l=u.cells.space,c=ue.fromScaling(t,C.div(C.zero(),Xt.size(C.zero(),u.transform.fractionalBox),C.ofArray(l.dimensions))),d=ue.fromTranslation(r,u.transform.fractionalBox.min);return ue.mul3(ue.zero(),u.transform.cell.fromFractional,d,c)}return ue.identity()}e.getGridToCartesianTransform=n;function a(u,l){return u===l}e.areEquivalent=a;function i(u){return u.cells.data.length===0}e.isEmpty=i;function o(u,l){l||(l=Ne());var c=u.cells.space.dimensions,d=e.getGridToCartesianTransform(u);return Ne.fromDimensionsAndTransform(l,c,d)}e.getBoundingSphere=o;function s(u,l){var c=u._historams;return c||(c=u._historams={}),c[l]||(c[l]=Kae(u.cells.data,l,{min:u.stats.min,max:u.stats.max})),c[l]}e.getHistogram=s})(qa||(qa={}));function $ae(e,t){var r=this;return We.create("Create Volume",function(){return ce(r,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d,f,p,h,v,m,g,y,b;return de(this,function(x){if(n=e.header,a=e.values,i=Pr.Space(n.dim,[0,1,2],Float64Array),n.dataSetIds.length===0)o=a;else for(s=n.dim,u=s[0],l=s[1],c=s[2],d=((t==null?void 0:t.dataIndex)||0)+1,f=0,p=0,o=new Float64Array(u*l*c),h=0;h<u;h++)for(v=0;v<l;v++)for(m=0;m<c;m++)o[f++]=a[p],p+=d;return g=Pr.create(i,Pr.Data1(o)),y=ue.fromTranslation(ue(),n.origin),b=ue.fromBasis(ue(),n.basisX,n.basisY,n.basisZ),ue.mul(y,y,b),[2,{label:t==null?void 0:t.label,entryId:t==null?void 0:t.entryId,grid:{transform:{kind:"matrix",matrix:y},cells:g,stats:{min:Oy(o),max:Gs(o),mean:Fy(o),sigma:ky(o)}},sourceData:Pg.create(e),customProperties:new Ks,_propertyData:Object.create(null)}]})})})}var Pg;(function(e){function t(n){return(n==null?void 0:n.kind)==="cube"}e.is=t;function r(n){return{kind:"cube",name:n.name,data:n}}e.create=r})(Pg||(Pg={}));var Ct;(function(e){function t(f){var p,h,v,m;return((m=(v=(h=(p=f==null?void 0:f.grid)===null||p===void 0?void 0:p.cells)===null||h===void 0?void 0:h.space)===null||v===void 0?void 0:v.dimensions)===null||m===void 0?void 0:m.length)&&(f==null?void 0:f.sourceData)&&(f==null?void 0:f.customProperties)&&(f==null?void 0:f._propertyData)}e.is=t,function(f){function p(S,_,A){return cn(y(S,A).absoluteValue,y(_,A).absoluteValue,A.sigma/100)}f.areSame=p;function h(S){return{kind:"absolute",absoluteValue:S}}f.absolute=h;function v(S){return{kind:"relative",relativeValue:S}}f.relative=v;function m(S,_){return _*S.sigma+S.mean}f.calcAbsolute=m;function g(S,_){return S.sigma===0?0:(_-S.mean)/S.sigma}f.calcRelative=g;function y(S,_){return S.kind==="absolute"?S:{kind:"absolute",absoluteValue:f.calcAbsolute(_,S.relativeValue)}}f.toAbsolute=y;function b(S,_){return S.kind==="relative"?S:{kind:"relative",relativeValue:f.calcRelative(_,S.absoluteValue)}}f.toRelative=b;function x(S){return S.kind==="relative"?S.relativeValue.toFixed(2)+" \u03C3":""+S.absoluteValue.toPrecision(4)}f.toString=x}(e.IsoValue||(e.IsoValue={}));var r={min:-1,max:1,mean:0,sigma:.1};function n(f,p){var h=p||r,v=h.min,m=h.max,g=h.mean,y=h.sigma,b=(v-g)/y,x=(m-g)/y,S=f;return f.kind==="absolute"?f.absoluteValue<v?S=e.IsoValue.absolute(v):f.absoluteValue>m&&(S=e.IsoValue.absolute(m)):f.relativeValue<b?S=e.IsoValue.relative(b):f.relativeValue>x&&(S=e.IsoValue.relative(x)),E.Conditioned(S,{absolute:E.Converted(function(_){return e.IsoValue.toAbsolute(_,qa.One.stats).absoluteValue},function(_){return e.IsoValue.absolute(_)},E.Numeric(g,{min:v,max:m,step:Px(y/100,2)})),relative:E.Converted(function(_){return e.IsoValue.toRelative(_,qa.One.stats).relativeValue},function(_){return e.IsoValue.relative(_)},E.Numeric(Math.min(1,x),{min:b,max:x,step:Px(Math.round((m-v)/y)/100,2)}))},function(_){return _.kind==="absolute"?"absolute":"relative"},function(_,A){return A==="absolute"?e.IsoValue.toAbsolute(_,h):e.IsoValue.toRelative(_,h)},{isEssential:!0})}e.createIsoValueParam=n,e.IsoValueParam=n(e.IsoValue.relative(2)),e.One={label:"",grid:qa.One,sourceData:{kind:"",name:"",data:{}},customProperties:new Ks,_propertyData:Object.create(null)};function a(f,p){return qa.areEquivalent(f.grid,p.grid)}e.areEquivalent=a;function i(f){return qa.isEmpty(f.grid)}e.isEmpty=i;function o(f){return Pg.is(f.sourceData)?f.sourceData.data.header.orbitals:!1}e.isOrbitals=o;function s(f){return{kind:"volume-loci",volume:f}}e.Loci=s;function u(f){return!!f&&f.kind==="volume-loci"}e.isLoci=u;function l(f,p){return f.volume===p.volume}e.areLociEqual=l;function c(f){return qa.isEmpty(f.volume.grid)}e.isLociEmpty=c;function d(f,p){return qa.getBoundingSphere(f.grid,p)}e.getBoundingSphere=d,function(f){function p(y,b){return{kind:"isosurface-loci",volume:y,isoValue:b}}f.Loci=p;function h(y){return!!y&&y.kind==="isosurface-loci"}f.isLoci=h;function v(y,b){return y.volume===b.volume&&e.IsoValue.areSame(y.isoValue,b.isoValue,y.volume.grid.stats)}f.areLociEqual=v;function m(y){return y.volume.grid.cells.data.length===0}f.isLociEmpty=m;function g(y,b,x){return e.getBoundingSphere(y,x)}f.getBoundingSphere=g}(e.Isosurface||(e.Isosurface={})),function(f){function p(x,S){return{kind:"cell-loci",volume:x,indices:S}}f.Loci=p;function h(x){return!!x&&x.kind==="cell-loci"}f.isLoci=h;function v(x,S){return x.volume===S.volume&&ke.areEqual(x.indices,S.indices)}f.areLociEqual=v;function m(x){return ke.size(x.indices)===0}f.isLociEmpty=m;var g=new eo("98"),y=C();function b(x,S,_){g.reset();for(var A=qa.getGridToCartesianTransform(x.grid),T=x.grid.cells.space.getCoords,I=0,M=ke.size(S);I<M;I++){var O=ke.getAt(S,I);T(O,y),C.transformMat4(y,y,A),g.includePosition(y)}g.finishedIncludeStep();for(var I=0,M=ke.size(S);I<M;I++){var O=ke.getAt(S,I);T(O,y),C.transformMat4(y,y,A),g.radiusPosition(y)}var D=g.getSphere(_);return Ne.expand(D,D,ue.getMaxScaleOnAxis(A)*10)}f.getBoundingSphere=b}(e.Cell||(e.Cell={}))})(Ct||(Ct={}));var s2=y3(),di;(function(e){function t(y,b,x,S,_,A,T,I,M){return M?a(y,b,x,S,_,A,T,I,M):n(y,b,x,S,_,A,T,I)}e.create=t;function r(y){return Ja([y.bboxSize.ref.version,y.gridDimension.ref.version,y.gridTexture.ref.version,y.transform.ref.version,y.gridStats.ref.version])}function n(y,b,x,S,_,A,T,I){var M=Ne(),O=-1,D=A.getWidth(),F=A.getHeight(),G=A.getDepth(),N={kind:"direct-volume",gridDimension:k.create(b),gridTexture:k.create(A),gridTextureDim:k.create(C.create(D,F,G)),gridStats:k.create(Cr.create(T.min,T.max,T.mean,T.sigma)),bboxMin:k.create(y.min),bboxMax:k.create(y.max),bboxSize:k.create(C.sub(C(),y.max,y.min)),transform:k.create(x),cellDim:k.create(_),unitToCartn:k.create(S),cartnToUnit:k.create(ue.invert(ue(),S)),get boundingSphere(){var z=r(N);if(z!==O){var $=Qae(N.gridDimension.ref.value,N.transform.ref.value);Ne.copy(M,$),O=z}return M},packedGroup:k.create(I),setBoundingSphere:function(z){Ne.copy(M,z),O=r(N)}};return N}function a(y,b,x,S,_,A,T,I,M){var O=A.getWidth(),D=A.getHeight(),F=A.getDepth();return k.update(M.gridDimension,b),k.update(M.gridTexture,A),k.update(M.gridTextureDim,C.set(M.gridTextureDim.ref.value,O,D,F)),k.update(M.gridStats,Cr.set(M.gridStats.ref.value,T.min,T.max,T.mean,T.sigma)),k.update(M.bboxMin,y.min),k.update(M.bboxMax,y.max),k.update(M.bboxSize,C.sub(M.bboxSize.ref.value,y.max,y.min)),k.update(M.transform,x),k.update(M.cellDim,_),k.update(M.unitToCartn,S),k.update(M.cartnToUnit,ue.invert(ue(),S)),k.updateIfChanged(M.packedGroup,I),M}function i(y){return{}}e.createEmpty=i;function o(y){var b=y?Ct.createIsoValueParam(Ct.IsoValue.relative(2),y):Ct.IsoValueParam;return E.MappedStatic("volume",{isosurface:E.Group({isoValue:b,singleLayer:E.Boolean(!1,{isEssential:!0})},{isFlat:!0}),volume:E.Group({controlPoints:E.LineGraph([Ge.create(.19,0),Ge.create(.2,.05),Ge.create(.25,.05),Ge.create(.26,0),Ge.create(.79,0),Ge.create(.8,.05),Ge.create(.85,.05),Ge.create(.86,0)]),list:E.ColorList({kind:"interpolate",colors:[[dr.white,0],[dr.red,.25],[dr.white,.5],[dr.blue,.75],[dr.white,1]]},{offsets:!0})},{isFlat:!0})},{isEssential:!0})}e.createRenderModeParam=o,e.Params=w(w({},At.Params),{doubleSided:E.Boolean(!1,At.CustomQualityParamInfo),flipSided:E.Boolean(!1,At.ShadingCategory),flatShaded:E.Boolean(!1,At.ShadingCategory),ignoreLight:E.Boolean(!1,At.ShadingCategory),xrayShaded:E.Boolean(!1,At.ShadingCategory),renderMode:o(),stepsPerCell:E.Numeric(5,{min:1,max:20,step:1}),jumpLength:E.Numeric(0,{min:0,max:20,step:.1})}),e.Utils={Params:e.Params,createEmpty:i,createValues:f,createValuesSimple:p,updateValues:h,updateBoundingSphere:v,createRenderableState:m,updateRenderableState:g,createPositionIterator:s};function s(y,b){var x=y.transform.ref.value,S=y.gridDimension.ref.value,_=S[0],A=S[1],T=S[2],I=_*A*T,M=b.instanceCount.ref.value,O=Kd(),D=O.position,F=b.aTransform.ref.value,G=function(N,z){var $=Math.floor(N/T);return D[0]=Math.floor($/A),D[1]=$%A,D[2]=N%T,C.transformMat4(D,D,x),z>=0&&C.transformMat4Offset(D,D,F,0,0,z*16),O};return pn(I,M,1,G)}function u(y,b,x){var S=x[0],_=x[1],A=x[2],T=x[3],I=Ct.IsoValue.toAbsolute(b,{min:S,max:_,mean:A,sigma:T}).absoluteValue;return Ge.set(y,(I-S)/(_-S),(0-S)/(_-S)),y}function l(y,b){return Math.ceil(C.magnitude(y)*b)}function c(y,b){return Math.min.apply(Math,y)*(1/b)}function d(y){return 1/y}function f(y,b,x,S,_){var A=y.gridTexture,T=y.gridTextureDim,I=y.gridStats,M=y.bboxSize,O=y.bboxMin,D=y.bboxMax,F=y.gridDimension,G=y.transform,N=x.instanceCount,z=x.groupCount,$=e.Utils.createPositionIterator(y,b),j=to(x,$,S.color),Z=Fo(N*z),q=ol(),te=sl(),he=ul(),W=F.ref.value,K=W[0],U=W[1],H=W[2],J={drawCount:s2.indices.length,vertexCount:K*U*H,groupCount:z,instanceCount:N},X=Ne.clone(y.boundingSphere),Q=ya(X,b.aTransform.ref.value,N),ee=_.renderMode.name==="volume"?XT(_.renderMode.params.controlPoints):[],le=YT(ee,_.renderMode.name==="volume"?_.renderMode.params.list.colors:[]),ye=_.renderMode.name==="isosurface"?_.renderMode.params.isoValue:Ct.IsoValue.relative(2),be=_.renderMode.name==="isosurface"?_.renderMode.params.singleLayer:!1;return w(w(w(w(w(w(w(w({},j),Z),q),te),he),b),At.createValues(_,J)),{aPosition:k.create(s2.vertices),elements:k.create(s2.indices),boundingSphere:k.create(Q),invariantBoundingSphere:k.create(X),uInvariantBoundingSphere:k.create(Cr.ofSphere(X)),uIsoValue:k.create(u(Ge(),ye,y.gridStats.ref.value)),uBboxMin:O,uBboxMax:D,uBboxSize:M,uMaxSteps:k.create(l(F.ref.value,_.stepsPerCell)),uStepScale:k.create(c(y.cellDim.ref.value,_.stepsPerCell)),uJumpLength:k.create(_.jumpLength),uTransform:G,uGridDim:F,dRenderMode:k.create(_.renderMode.name),tTransferTex:le,uTransferScale:k.create(d(_.stepsPerCell)),dGridTexType:k.create(A.ref.value.getDepth()>0?"3d":"2d"),uGridTexDim:T,tGridTex:A,uGridStats:I,uCellDim:y.cellDim,uCartnToUnit:y.cartnToUnit,uUnitToCartn:y.unitToCartn,dPackedGroup:y.packedGroup,dSingleLayer:k.create(be),dDoubleSided:k.create(_.doubleSided),dFlatShaded:k.create(_.flatShaded),dFlipSided:k.create(_.flipSided),dIgnoreLight:k.create(_.ignoreLight),dXrayShaded:k.create(_.xrayShaded)})}function p(y,b,x,S,_){var A=At.createSimple(x,S,_),T=w(w({},E.getDefaultValues(e.Params)),b);return f(y,A.transform,A.locationIterator,A.theme,T)}function h(y,b){if(k.updateIfChanged(y.alpha,b.alpha),k.updateIfChanged(y.uAlpha,b.alpha),k.updateIfChanged(y.dDoubleSided,b.doubleSided),k.updateIfChanged(y.dFlatShaded,b.flatShaded),k.updateIfChanged(y.dFlipSided,b.flipSided),k.updateIfChanged(y.dIgnoreLight,b.ignoreLight),k.updateIfChanged(y.dXrayShaded,b.xrayShaded),k.updateIfChanged(y.dRenderMode,b.renderMode.name),b.renderMode.name==="isosurface")k.updateIfChanged(y.uIsoValue,u(y.uIsoValue.ref.value,b.renderMode.params.isoValue,y.uGridStats.ref.value)),k.updateIfChanged(y.dSingleLayer,b.renderMode.params.singleLayer);else if(b.renderMode.name==="volume"){var x=XT(b.renderMode.params.controlPoints);YT(x,b.renderMode.params.list.colors,y.tTransferTex)}k.updateIfChanged(y.uMaxSteps,l(y.uGridDim.ref.value,b.stepsPerCell)),k.updateIfChanged(y.uStepScale,c(y.uCellDim.ref.value,b.stepsPerCell)),k.updateIfChanged(y.uTransferScale,d(b.stepsPerCell)),k.updateIfChanged(y.uJumpLength,b.jumpLength)}function v(y,b){var x=Ne.clone(b.boundingSphere),S=ya(x,y.aTransform.ref.value,y.instanceCount.ref.value);Ne.equals(S,y.boundingSphere.ref.value)||k.update(y.boundingSphere,S),Ne.equals(x,y.invariantBoundingSphere.ref.value)||(k.update(y.invariantBoundingSphere,x),k.update(y.uInvariantBoundingSphere,Cr.fromSphere(y.uInvariantBoundingSphere.ref.value,x)))}function m(y){var b=At.createRenderableState(y);return b.opaque=!1,b.writeDepth=y.renderMode.name==="isosurface",b}function g(y,b){At.updateRenderableState(y,b),y.opaque=!1,y.writeDepth=b.renderMode.name==="isosurface"}})(di||(di={}));function Qae(e,t){return Ne.fromDimensionsAndTransform(Ne(),e,t)}var xc;(function(e){function t(p,h,v,m,g,y){return y?i(p,h,v,m,g,y):a(p,h,v,m,g)}e.create=t;function r(p){var h=p?p.centerBuffer.ref.value:new Float32Array(0),v=p?p.mappingBuffer.ref.value:new Float32Array(0),m=p?p.indexBuffer.ref.value:new Uint32Array(0),g=p?p.groupBuffer.ref.value:new Float32Array(0);return t(h,v,m,g,0,p)}e.createEmpty=r;function n(p){return Ja([p.sphereCount,p.centerBuffer.ref.version,p.mappingBuffer.ref.version,p.indexBuffer.ref.version,p.groupBuffer.ref.version])}function a(p,h,v,m,g){var y=Ne(),b,x=-1,S=-1,_={kind:"spheres",sphereCount:g,centerBuffer:k.create(p),mappingBuffer:k.create(h),indexBuffer:k.create(v),groupBuffer:k.create(m),get boundingSphere(){var A=n(_);if(A!==x){var T=Sc(_.centerBuffer.ref.value,_.sphereCount*4,4);Ne.copy(y,T),x=A}return y},get groupMapping(){return _.groupBuffer.ref.version!==S&&(b=Rp(_.groupBuffer.ref.value,_.sphereCount,4),S=_.groupBuffer.ref.version),b},setBoundingSphere:function(A){Ne.copy(y,A),x=n(_)}};return _}function i(p,h,v,m,g,y){return g>y.sphereCount&&(k.update(y.mappingBuffer,h),k.update(y.indexBuffer,v)),y.sphereCount=g,k.update(y.centerBuffer,p),k.update(y.groupBuffer,m),y}e.Params=w(w({},At.Params),{sizeFactor:E.Numeric(1,{min:0,max:10,step:.1}),doubleSided:E.Boolean(!1,At.CustomQualityParamInfo),ignoreLight:E.Boolean(!1,At.ShadingCategory),xrayShaded:E.Boolean(!1,At.ShadingCategory)}),e.Utils={Params:e.Params,createEmpty:r,createValues:s,createValuesSimple:u,updateValues:l,updateBoundingSphere:c,createRenderableState:d,updateRenderableState:f,createPositionIterator:o};function o(p,h){var v=p.sphereCount*4,m=h.instanceCount.ref.value,g=Kd(),y=g.position,b=p.centerBuffer.ref.value,x=h.aTransform.ref.value,S=function(_,A){return A<0?C.fromArray(y,b,_*3):C.transformMat4Offset(y,b,x,0,_*3,A*16),g};return pn(v,m,4,S)}function s(p,h,v,m,g){var y=v.instanceCount,b=v.groupCount,x=o(p,h),S=to(v,x,m.color),_=il(v,m.size),A=Fo(y*b),T=ol(),I=sl(),M=ul(),O={drawCount:p.sphereCount*2*3,vertexCount:p.sphereCount*4,groupCount:b,instanceCount:y},D=p.boundingSphere.radius?Cv(_)*g.sizeFactor:0,F=Ne.expand(Ne(),p.boundingSphere,D),G=ya(F,h.aTransform.ref.value,y);return w(w(w(w(w(w(w(w(w(w({aPosition:p.centerBuffer,aMapping:p.mappingBuffer,aGroup:p.groupBuffer,elements:p.indexBuffer,boundingSphere:k.create(G),invariantBoundingSphere:k.create(F),uInvariantBoundingSphere:k.create(Cr.ofSphere(F))},S),_),A),T),I),M),h),{padding:k.create(D)}),At.createValues(g,O)),{uSizeFactor:k.create(g.sizeFactor),dDoubleSided:k.create(g.doubleSided),dIgnoreLight:k.create(g.ignoreLight),dXrayShaded:k.create(g.xrayShaded)})}function u(p,h,v,m,g){var y=At.createSimple(v,m,g),b=w(w({},E.getDefaultValues(e.Params)),h);return s(p,y.transform,y.locationIterator,y.theme,b)}function l(p,h){At.updateValues(p,h),k.updateIfChanged(p.uSizeFactor,h.sizeFactor),k.updateIfChanged(p.dDoubleSided,h.doubleSided),k.updateIfChanged(p.dIgnoreLight,h.ignoreLight),k.updateIfChanged(p.dXrayShaded,h.xrayShaded)}function c(p,h){var v=h.boundingSphere.radius?Cv(p)*p.uSizeFactor.ref.value:0,m=Ne.expand(Ne(),h.boundingSphere,v),g=ya(m,p.aTransform.ref.value,p.instanceCount.ref.value);Ne.equals(g,p.boundingSphere.ref.value)||k.update(p.boundingSphere,g),Ne.equals(m,p.invariantBoundingSphere.ref.value)||(k.update(p.invariantBoundingSphere,m),k.update(p.uInvariantBoundingSphere,Cr.fromSphere(p.uInvariantBoundingSphere.ref.value,m))),k.update(p.padding,v)}function d(p){var h=At.createRenderableState(p);return f(h,p),h}function f(p,h){At.updateRenderableState(p,h),p.opaque=p.opaque&&!h.xrayShaded,p.writeDepth=p.opaque}})(xc||(xc={}));var ps;(function(e){var t=function(){function u(){this.index=0,this.textures=[]}return u.prototype.get=function(){return this.textures[this.index]},u.prototype.set=function(l,c,d){this.textures[this.index]=Object.assign(this.textures[this.index]||{},{vertex:l,group:c,normal:d}),this.index=(this.index+1)%2},u.prototype.destroy=function(){for(var l=0,c=this.textures;l<c.length;l++){var d=c[l];d.vertex.destroy(),d.group.destroy(),d.normal.destroy()}},u}();e.DoubleBuffer=t;function r(u,l,c,d,f,p,h){var v=c.getWidth(),m=c.getHeight();return h?(h.vertexCount=u,h.groupCount=l,k.update(h.geoTextureDim,Ge.set(h.geoTextureDim.ref.value,v,m)),k.update(h.vertexTexture,c),k.update(h.groupTexture,d),k.update(h.normalTexture,f),h.doubleBuffer.set(c,d,f),Ne.copy(h.boundingSphere,p),h):{kind:"texture-mesh",vertexCount:u,groupCount:l,geoTextureDim:k.create(Ge.create(v,m)),vertexTexture:k.create(c),groupTexture:k.create(d),normalTexture:k.create(f),doubleBuffer:new t,boundingSphere:Ne.clone(p)}}e.create=r;function n(u){return{}}e.createEmpty=n,e.Params=w(w({},At.Params),{doubleSided:E.Boolean(!1,At.CustomQualityParamInfo),flipSided:E.Boolean(!1,At.ShadingCategory),flatShaded:E.Boolean(!1,At.ShadingCategory),ignoreLight:E.Boolean(!1,At.ShadingCategory),xrayShaded:E.Boolean(!1,At.ShadingCategory)}),e.Utils={Params:e.Params,createEmpty:n,createValues:a,createValuesSimple:i,updateValues:o,updateBoundingSphere:s,createRenderableState:At.createRenderableState,updateRenderableState:At.updateRenderableState,createPositionIterator:function(){return pn(1,1,1,function(){return $i})}};function a(u,l,c,d,f){var p=c.instanceCount,h=c.groupCount,v=e.Utils.createPositionIterator(u,l),m=to(c,v,d.color),g=Fo(p*h),y=ol(),b=sl(),x=ul(),S={drawCount:u.vertexCount,vertexCount:u.vertexCount,groupCount:h,instanceCount:p},_=Ne.clone(u.boundingSphere),A=ya(_,l.aTransform.ref.value,p);return w(w(w(w(w(w(w(w({uGeoTexDim:u.geoTextureDim,tPosition:u.vertexTexture,tGroup:u.groupTexture,tNormal:u.normalTexture,boundingSphere:k.create(A),invariantBoundingSphere:k.create(_),uInvariantBoundingSphere:k.create(Cr.ofSphere(_))},m),g),y),b),x),l),At.createValues(f,S)),{dDoubleSided:k.create(f.doubleSided),dFlatShaded:k.create(f.flatShaded),dFlipSided:k.create(f.flipSided),dIgnoreLight:k.create(f.ignoreLight),dXrayShaded:k.create(f.xrayShaded),dGeoTexture:k.create(!0)})}function i(u,l,c,d,f){var p=At.createSimple(c,d,f),h=w(w({},E.getDefaultValues(e.Params)),l);return a(u,p.transform,p.locationIterator,p.theme,h)}function o(u,l){At.updateValues(u,l),k.updateIfChanged(u.dDoubleSided,l.doubleSided),k.updateIfChanged(u.dFlatShaded,l.flatShaded),k.updateIfChanged(u.dFlipSided,l.flipSided),k.updateIfChanged(u.dIgnoreLight,l.ignoreLight),k.updateIfChanged(u.dXrayShaded,l.xrayShaded)}function s(u,l){var c=Ne.clone(l.boundingSphere),d=ya(c,u.aTransform.ref.value,u.instanceCount.ref.value);Ne.equals(d,u.boundingSphere.ref.value)||k.update(u.boundingSphere,d),Ne.equals(c,u.invariantBoundingSphere.ref.value)||(k.update(u.invariantBoundingSphere,c),k.update(u.uInvariantBoundingSphere,Cr.fromSphere(u.uInvariantBoundingSphere.ref.value,c)))}})(ps||(ps={}));function Zae(e,t){var r={},n={},a={},i={},o={},s={};return Object.keys(e).forEach(function(u){var l=e[u];l.type==="attribute"&&(r[u]=t[u]),l.type==="define"&&(n[u]=t[u]),l.type==="texture"&&t[u]!==void 0&&(a[u]=t[u]),l.type==="uniform"&&t[u]!==void 0&&(l.variant==="material"?o[u]=t[u]:l.variant==="buffered"?s[u]=t[u]:i[u]=t[u])}),{attributeValues:r,defineValues:n,textureValues:a,uniformValues:i,materialUniformValues:o,bufferedUniformValues:s}}function Jae(e){var t={};return Object.keys(e).forEach(function(r){t[r]=e[r].ref.version}),t}function Vr(e,t,r){return{type:"attribute",kind:e,itemSize:t,divisor:r}}function qe(e,t){return{type:"uniform",kind:e,variant:t}}function ur(e,t,r,n){return{type:"texture",kind:e,format:t,dataType:r,filter:n}}function Qd(e){return{type:"elements",kind:e}}function $t(e,t){return{type:"define",kind:e,options:t}}function Zn(e){return{type:"value",kind:e}}var ll={uModel:qe("m4"),uView:qe("m4"),uInvView:qe("m4"),uModelView:qe("m4"),uInvModelView:qe("m4"),uProjection:qe("m4"),uInvProjection:qe("m4"),uModelViewProjection:qe("m4"),uInvModelViewProjection:qe("m4"),uIsOrtho:qe("f"),uPixelRatio:qe("f"),uViewportHeight:qe("f"),uViewport:qe("v4"),uViewOffset:qe("v2"),uDrawingBufferSize:qe("v2"),uCameraPosition:qe("v3"),uCameraDir:qe("v3"),uNear:qe("f"),uFar:qe("f"),uFogNear:qe("f"),uFogFar:qe("f"),uFogColor:qe("v3"),uTransparentBackground:qe("b"),uClipObjectType:qe("i[]"),uClipObjectInvert:qe("b[]"),uClipObjectPosition:qe("v3[]"),uClipObjectRotation:qe("v4[]"),uClipObjectScale:qe("v3[]"),uLightIntensity:qe("f"),uAmbientIntensity:qe("f"),uMetalness:qe("f"),uRoughness:qe("f"),uReflectivity:qe("f"),uPickingAlphaThreshold:qe("f"),uInteriorDarkening:qe("f"),uInteriorColorFlag:qe("b"),uInteriorColor:qe("v3"),uHighlightColor:qe("v3"),uSelectColor:qe("v3"),uXrayEdgeFalloff:qe("f"),uRenderWboit:qe("b")},cl={tDepth:ur("texture","depth","ushort","nearest")},dl={uObjectId:qe("i")},eie={uColor:qe("v3","material"),uColorTexDim:qe("v2"),uColorGridDim:qe("v3"),uColorGridTransform:qe("v4"),tColor:ur("image-uint8","rgb","ubyte","nearest"),tPalette:ur("image-uint8","rgb","ubyte","nearest"),tColorGrid:ur("texture","rgb","ubyte","linear"),dColorType:$t("string",["uniform","attribute","instance","group","groupInstance","vertex","vertexInstance","volume","volumeInstance"]),dUsePalette:$t("boolean")},kv={uSize:qe("f","material"),uSizeTexDim:qe("v2"),tSize:ur("image-uint8","rgb","ubyte","nearest"),dSizeType:$t("string",["uniform","attribute","instance","group","groupInstance"]),uSizeFactor:qe("f")},tie={uMarkerTexDim:qe("v2"),tMarker:ur("image-uint8","alpha","ubyte","nearest")},rie={uOverpaintTexDim:qe("v2"),tOverpaint:ur("image-uint8","rgba","ubyte","nearest"),dOverpaint:$t("boolean")},nie={uTransparencyTexDim:qe("v2"),tTransparency:ur("image-uint8","alpha","ubyte","nearest"),dTransparency:$t("boolean"),transparencyAverage:Zn("number")},aie={dClipObjectCount:$t("number"),dClipVariant:$t("string",["instance","pixel"]),uClippingTexDim:qe("v2"),tClipping:ur("image-uint8","alpha","ubyte","nearest"),dClipping:$t("boolean")},fl=w(w(w(w(w(w({},eie),tie),rie),nie),aie),{aInstance:Vr("float32",1,1),aTransform:Vr("float32",16,1),uAlpha:qe("f","material"),uVertexCount:qe("i"),uInstanceCount:qe("i"),uGroupCount:qe("i"),uInvariantBoundingSphere:qe("v4"),drawCount:Zn("number"),instanceCount:Zn("number"),alpha:Zn("number"),matrix:Zn("m4"),transform:Zn("float32"),extraTransform:Zn("float32"),hasReflection:Zn("boolean"),boundingSphere:Zn("sphere"),invariantBoundingSphere:Zn("sphere")}),LO=new Float32Array([1,1,-1,1,-1,-1,-1,-1,1,-1,1,1]),Ua={drawCount:Zn("number"),instanceCount:Zn("number"),aPosition:Vr("float32",2,0),uQuadScale:qe("v2")},za={drawCount:k.create(6),instanceCount:k.create(1),aPosition:k.create(LO),uQuadScale:k.create(Ge.create(1,1))},$T=new Uint32Array([0,1,2,1,3,2]),iie=new Float32Array([0,1,0,0,1,1,1,0]),NO={nearest:"Nearest",catmulrom:"Catmulrom (Cubic)",mitchell:"Mitchell (Cubic)",bspline:"B-Spline (Cubic)"},oie=Object.keys(NO),ju;(function(e){function t(f,p,h,v){return v?a(f,p,h,v):n(f,p,h)}e.create=t;function r(f){return Ja([f.cornerBuffer.ref.version])}function n(f,p,h){var v=Ne(),m=-1,g=f.width,y=f.height,b={kind:"image",imageTexture:k.create(f),imageTextureDim:k.create(Ge.create(g,y)),cornerBuffer:k.create(p),groupTexture:k.create(h),get boundingSphere(){var x=r(b);if(x!==m){var S=sie(b.cornerBuffer.ref.value);Ne.copy(v,S),m=x}return v}};return b}function a(f,p,h,v){var m=f.width,g=f.height;return k.update(v.imageTexture,f),k.update(v.imageTextureDim,Ge.set(v.imageTextureDim.ref.value,m,g)),k.update(v.cornerBuffer,p),k.update(v.groupTexture,h),v}function i(f){return{}}e.createEmpty=i,e.Params=w(w({},At.Params),{interpolation:E.Select("bspline",E.objectToOptions(NO))}),e.Utils={Params:e.Params,createEmpty:i,createValues:o,createValuesSimple:s,updateValues:u,updateBoundingSphere:l,createRenderableState:c,updateRenderableState:d,createPositionIterator:function(){return pn(1,1,1,function(){return $i})}};function o(f,p,h,v,m){var g=h.instanceCount,y=h.groupCount,b=e.Utils.createPositionIterator(f,p),x=to(h,b,v.color),S=Fo(g*y),_=ol(),A=sl(),T=ul(),I={drawCount:$T.length,vertexCount:LO.length/3,groupCount:y,instanceCount:g},M=Ne.clone(f.boundingSphere),O=ya(M,p.aTransform.ref.value,g);return w(w(w(w(w(w(w(w({},x),S),_),A),T),p),At.createValues(m,I)),{aPosition:f.cornerBuffer,aUv:k.create(iie),elements:k.create($T),aGroup:k.create(Mo(new Float32Array(4))),boundingSphere:k.create(O),invariantBoundingSphere:k.create(M),uInvariantBoundingSphere:k.create(Cr.ofSphere(M)),dInterpolation:k.create(m.interpolation),uImageTexDim:f.imageTextureDim,tImageTex:f.imageTexture,tGroupTex:f.groupTexture})}function s(f,p,h,v,m){var g=At.createSimple(h,v,m),y=w(w({},E.getDefaultValues(e.Params)),p);return o(f,g.transform,g.locationIterator,g.theme,y)}function u(f,p){At.updateValues(f,p),k.updateIfChanged(f.dInterpolation,p.interpolation)}function l(f,p){var h=Ne.clone(p.boundingSphere),v=ya(h,f.aTransform.ref.value,f.instanceCount.ref.value);Ne.equals(v,f.boundingSphere.ref.value)||k.update(f.boundingSphere,v),Ne.equals(h,f.invariantBoundingSphere.ref.value)||(k.update(f.invariantBoundingSphere,h),k.update(f.uInvariantBoundingSphere,Cr.fromSphere(f.uInvariantBoundingSphere.ref.value,h)))}function c(f){var p=At.createRenderableState(f);return p.opaque=!1,p}function d(f,p){At.updateRenderableState(f,p),f.opaque=!1}})(ju||(ju={}));function sie(e){for(var t=C(),r=[],n=0,a=e.length;n<a;n+=3){var i=C.fromArray(C(),e,n);r.push(i),C.add(t,t,i)}C.scale(t,t,1/(e.length/3));for(var o=0,s=0,u=r;s<u.length;s++){var i=u[s],l=C.distance(t,i);l>o&&(o=l)}var c=Ne.create(t,o);return Ne.setExtrema(c,r),c}var Wi;(function(e){function t(h,v,m,g,y,b,x,S,_){return _?i(h,v,m,g,y,b,x,S,_):a(h,v,m,g,y,b,x,S)}e.create=t;function r(h){var v=h?h.mappingBuffer.ref.value:new Float32Array(0),m=h?h.indexBuffer.ref.value:new Uint32Array(0),g=h?h.groupBuffer.ref.value:new Float32Array(0),y=h?h.startBuffer.ref.value:new Float32Array(0),b=h?h.endBuffer.ref.value:new Float32Array(0),x=h?h.scaleBuffer.ref.value:new Float32Array(0),S=h?h.capBuffer.ref.value:new Float32Array(0);return t(v,m,g,y,b,x,S,0,h)}e.createEmpty=r;function n(h){return Ja([h.cylinderCount,h.mappingBuffer.ref.version,h.indexBuffer.ref.version,h.groupBuffer.ref.version,h.startBuffer.ref.version,h.endBuffer.ref.version,h.scaleBuffer.ref.version,h.capBuffer.ref.version])}function a(h,v,m,g,y,b,x,S){var _=Ne(),A,T=-1,I=-1,M={kind:"cylinders",cylinderCount:S,mappingBuffer:k.create(h),indexBuffer:k.create(v),groupBuffer:k.create(m),startBuffer:k.create(g),endBuffer:k.create(y),scaleBuffer:k.create(b),capBuffer:k.create(x),get boundingSphere(){var O=n(M);if(O!==T){var D=Sc(M.startBuffer.ref.value,M.cylinderCount*6,6),F=Sc(M.endBuffer.ref.value,M.cylinderCount*6,6);Ne.expandBySphere(_,D,F),T=O}return _},get groupMapping(){return M.groupBuffer.ref.version!==I&&(A=Rp(M.groupBuffer.ref.value,M.cylinderCount,6),I=M.groupBuffer.ref.version),A},setBoundingSphere:function(O){Ne.copy(_,O),T=n(M)}};return M}function i(h,v,m,g,y,b,x,S,_){return S>_.cylinderCount&&(k.update(_.mappingBuffer,h),k.update(_.indexBuffer,v)),_.cylinderCount=S,k.update(_.groupBuffer,m),k.update(_.startBuffer,g),k.update(_.endBuffer,y),k.update(_.scaleBuffer,b),k.update(_.capBuffer,x),_}function o(h,v){var m=h.startBuffer.ref.value;Nd(v,m,0,h.cylinderCount*6),k.update(h.startBuffer,m);var g=h.endBuffer.ref.value;Nd(v,g,0,h.cylinderCount*6),k.update(h.endBuffer,g)}e.transform=o,e.Params=w(w({},At.Params),{sizeFactor:E.Numeric(1,{min:0,max:10,step:.1}),sizeAspectRatio:E.Numeric(1,{min:0,max:3,step:.01}),doubleSided:E.Boolean(!1,At.CustomQualityParamInfo),ignoreLight:E.Boolean(!1,At.ShadingCategory),xrayShaded:E.Boolean(!1,At.ShadingCategory)}),e.Utils={Params:e.Params,createEmpty:r,createValues:u,createValuesSimple:l,updateValues:c,updateBoundingSphere:d,createRenderableState:f,updateRenderableState:p,createPositionIterator:s};function s(h,v){var m=h.cylinderCount*6,g=v.instanceCount.ref.value,y=Kd(),b=y.position,x=h.startBuffer.ref.value,S=h.endBuffer.ref.value,_=v.aTransform.ref.value,A=function(T,I){var M=T%6===0?x:S;return I<0?C.fromArray(b,M,T*3):C.transformMat4Offset(b,M,_,0,T*3,I*16),y};return pn(m,g,2,A)}function u(h,v,m,g,y){var b=m.instanceCount,x=m.groupCount,S=s(h,v),_=to(m,S,g.color),A=il(m,g.size),T=Fo(b*x),I=ol(),M=sl(),O=ul(),D={drawCount:h.cylinderCount*4*3,vertexCount:h.cylinderCount*6,groupCount:x,instanceCount:b},F=Cv(A)*y.sizeFactor,G=Ne.clone(h.boundingSphere),N=ya(G,v.aTransform.ref.value,b);return w(w(w(w(w(w(w(w(w(w({aMapping:h.mappingBuffer,aGroup:h.groupBuffer,aStart:h.startBuffer,aEnd:h.endBuffer,aScale:h.scaleBuffer,aCap:h.capBuffer,elements:h.indexBuffer,boundingSphere:k.create(N),invariantBoundingSphere:k.create(G),uInvariantBoundingSphere:k.create(Cr.ofSphere(G))},_),A),T),I),M),O),v),{padding:k.create(F)}),At.createValues(y,D)),{uSizeFactor:k.create(y.sizeFactor*y.sizeAspectRatio),dDoubleSided:k.create(y.doubleSided),dIgnoreLight:k.create(y.ignoreLight),dXrayShaded:k.create(y.xrayShaded)})}function l(h,v,m,g,y){var b=At.createSimple(m,g,y),x=w(w({},E.getDefaultValues(e.Params)),v);return u(h,b.transform,b.locationIterator,b.theme,x)}function c(h,v){At.updateValues(h,v),k.updateIfChanged(h.uSizeFactor,v.sizeFactor*v.sizeAspectRatio),k.updateIfChanged(h.dDoubleSided,v.doubleSided),k.updateIfChanged(h.dIgnoreLight,v.ignoreLight),k.updateIfChanged(h.dXrayShaded,v.xrayShaded)}function d(h,v){var m=Ne.clone(v.boundingSphere),g=ya(m,h.aTransform.ref.value,h.instanceCount.ref.value);Ne.equals(g,h.boundingSphere.ref.value)||k.update(h.boundingSphere,g),Ne.equals(m,h.invariantBoundingSphere.ref.value)||(k.update(h.invariantBoundingSphere,m),k.update(h.uInvariantBoundingSphere,Cr.fromSphere(h.uInvariantBoundingSphere.ref.value,m)))}function f(h){var v=At.createRenderableState(h);return p(v,h),v}function p(h,v){At.updateRenderableState(h,v),h.opaque=h.opaque&&!v.xrayShaded,h.writeDepth=h.opaque}})(Wi||(Wi={}));var Ma;(function(e){function t(o){switch(o.kind){case"mesh":return o.triangleCount*3;case"points":return o.pointCount;case"spheres":return o.sphereCount*2*3;case"cylinders":return o.cylinderCount*4*3;case"text":return o.charCount*2*3;case"lines":return o.lineCount*2*3;case"direct-volume":return 12*3;case"image":return 2*3;case"texture-mesh":return o.vertexCount}}e.getDrawCount=t;function r(o){switch(o.kind){case"mesh":return o.vertexCount;case"points":return o.pointCount;case"spheres":return o.sphereCount*4;case"cylinders":return o.cylinderCount*6;case"text":return o.charCount*4;case"lines":return o.lineCount*4;case"direct-volume":var s=o.gridDimension.ref.value,u=s[0],l=s[1],c=s[2];return u*l*c;case"image":return 4;case"texture-mesh":return o.vertexCount}}e.getVertexCount=r;function n(o){switch(o.kind){case"mesh":case"points":case"spheres":case"cylinders":case"text":case"lines":return t(o)===0?0:Gs(o.groupBuffer.ref.value)+1;case"direct-volume":return 1;case"image":return Gs(o.groupTexture.ref.value.array)+1;case"texture-mesh":return o.groupCount}}e.getGroupCount=n;function a(o){switch(o.kind){case"mesh":return Lt.Utils;case"points":return Ud.Utils;case"spheres":return xc.Utils;case"cylinders":return Wi.Utils;case"text":return Do.Utils;case"lines":return mn.Utils;case"direct-volume":return di.Utils;case"image":return ju.Utils;case"texture-mesh":return ps.Utils}}e.getUtils=a;function i(o,s){return s==="instance"&&o.nonInstanceable?"group":s}e.getGranularity=i})(Ma||(Ma={}));var UO=ti();function uie(e,t){switch(t){case e.FRAMEBUFFER_COMPLETE:return"complete";case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"incomplete attachment";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"incomplete missing attachment";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"incomplete dimensions";case e.FRAMEBUFFER_UNSUPPORTED:return"unsupported"}if(_r(e))switch(t){case e.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:return"incomplete multisample";case e.RENDERBUFFER_SAMPLES:return"renderbuffer samples"}return"unknown error"}function b3(e){var t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE){var r=uie(e,t);throw new Error("Framebuffer status: "+r)}}function QT(e){var t=e.createFramebuffer();if(t===null)throw new Error("Could not create WebGL framebuffer");return t}function lie(e){var t=QT(e),r=!1;return{id:UO(),bind:function(){return e.bindFramebuffer(e.FRAMEBUFFER,t)},reset:function(){t=QT(e)},destroy:function(){r||(e.deleteFramebuffer(t),r=!0)}}}function cie(){return{id:UO(),bind:function(){},reset:function(){},destroy:function(){}}}function ZT(e){var t=yse(e);if(t===null)throw new Error('Could not find support for "instanced_arrays"');var r=Sse(e);if(r===null)throw new Error('Could not find support for "element_index_uint"');var n=bse(e);Ir&&n===null&&console.log('Could not find support for "standard_derivatives"');var a=Cse(e);Ir&&a===null&&console.log('Could not find support for "texture_float"');var i=_se(e);Ir&&i===null&&console.log('Could not find support for "texture_float_linear"');var o=wse(e);Ir&&o===null&&console.log('Could not find support for "texture_half_float"');var s=Ase(e);Ir&&s===null&&console.log('Could not find support for "texture_half_float_linear"');var u=Rse(e);Ir&&u===null&&console.log('Could not find support for "depth_texture"');var l=Pse(e);Ir&&l===null&&console.log('Could not find support for "blend_minmax"');var c=xse(e);Ir&&c===null&&console.log('Could not find support for "vertex_array_object"');var d=Tse(e);Ir&&d===null&&console.log('Could not find support for "frag_depth"');var f=Ese(e);Ir&&f===null&&console.log('Could not find support for "color_buffer_float"');var p=Ise(e);Ir&&p===null&&console.log('Could not find support for "color_buffer_half_float"');var h=Mse(e);Ir&&h===null&&console.log('Could not find support for "draw_buffers"');var v=Dse(e);Ir&&v===null&&console.log('Could not find support for "shader_texture_lod"');var m=Ose(e);return Ir&&m===null&&console.log('Could not find support for "sRGB"'),{instancedArrays:t,standardDerivatives:n,textureFloat:a,textureFloatLinear:i,textureHalfFloat:o,textureHalfFloatLinear:s,elementIndexUint:r,depthTexture:u,blendMinMax:l,vertexArrayObject:c,fragDepth:d,colorBufferFloat:f,colorBufferHalfFloat:p,drawBuffers:h,shaderTextureLod:v,sRGB:m}}function die(e){var t={},r=e.getParameter(e.FRONT_FACE),n=e.getParameter(e.CULL_FACE_MODE),a=e.getParameter(e.DEPTH_WRITEMASK),i=e.getParameter(e.COLOR_WRITEMASK),o=e.getParameter(e.COLOR_CLEAR_VALUE),s=e.getParameter(e.BLEND_SRC_RGB),u=e.getParameter(e.BLEND_DST_RGB),l=e.getParameter(e.BLEND_SRC_ALPHA),c=e.getParameter(e.BLEND_DST_ALPHA),d=e.getParameter(e.BLEND_EQUATION_RGB),f=e.getParameter(e.BLEND_EQUATION_ALPHA);return{currentProgramId:-1,currentMaterialId:-1,currentRenderItemId:-1,enable:function(p){t[p]!==!0&&(e.enable(p),t[p]=!0)},disable:function(p){t[p]!==!1&&(e.disable(p),t[p]=!1)},frontFace:function(p){p!==r&&(e.frontFace(p),r=p)},cullFace:function(p){p!==n&&(e.cullFace(p),n=p)},depthMask:function(p){p!==a&&(e.depthMask(p),a=p)},colorMask:function(p,h,v,m){(p!==i[0]||h!==i[1]||v!==i[2]||m!==i[3])&&(e.colorMask(p,h,v,m),i[0]=p,i[1]=h,i[2]=v,i[3]=m)},clearColor:function(p,h,v,m){(p!==o[0]||h!==o[1]||v!==o[2]||m!==o[3])&&(e.clearColor(p,h,v,m),o[0]=p,o[1]=h,o[2]=v,o[3]=m)},blendFunc:function(p,h){(p!==s||h!==u||p!==l||h!==c)&&(e.blendFunc(p,h),s=p,u=h,l=p,c=h)},blendFuncSeparate:function(p,h,v,m){(p!==s||h!==u||v!==l||m!==c)&&(e.blendFuncSeparate(p,h,v,m),s=p,u=h,l=v,c=m)},blendEquation:function(p){(p!==d||p!==f)&&(e.blendEquation(p),d=p,f=p)},blendEquationSeparate:function(p,h){(p!==d||h!==f)&&(e.blendEquationSeparate(p,h),d=p,f=h)},reset:function(){t={},r=e.getParameter(e.FRONT_FACE),n=e.getParameter(e.CULL_FACE_MODE),a=e.getParameter(e.DEPTH_WRITEMASK),i=e.getParameter(e.COLOR_WRITEMASK),o=e.getParameter(e.COLOR_CLEAR_VALUE),s=e.getParameter(e.BLEND_SRC_RGB),u=e.getParameter(e.BLEND_DST_RGB),l=e.getParameter(e.BLEND_SRC_ALPHA),c=e.getParameter(e.BLEND_DST_ALPHA),d=e.getParameter(e.BLEND_EQUATION_RGB),f=e.getParameter(e.BLEND_EQUATION_ALPHA)}}}var Cd;(function(e){function t(a,i,o){return{array:a,width:i,height:o}}e.create=t;function r(a){for(var i=a.array,o=a.width,s=a.height,u=o*4,l=0,c=s/2;l<c;++l)for(var d=0,f=u;d<f;++d){var p=l*u+d,h=(s-l-1)*u+d,v=i[p];i[p]=i[h],i[h]=v}return a}e.flipY=r;function n(a){for(var i=a.array,o=0,s=i.length;o<s;o+=4){var u=i[o+3]/255;i[o]/=u,i[o+1]/=u,i[o+2]/=u}return a}e.divideByAlpha=n})(Cd||(Cd={}));var fie=`
float viewZ = depthToViewZ(uIsOrtho, fragmentDepth, uNear, uFar);
float fogFactor = smoothstep(uFogNear, uFogFar, abs(viewZ));
float fogAlpha = (1.0 - fogFactor) * gl_FragColor.a;
float preFogAlpha = gl_FragColor.a;
if (!uTransparentBackground) {
    if (gl_FragColor.a < 1.0) {
        // transparent objects are blended with background color
        gl_FragColor.a = fogAlpha;
    } else {
        // mix opaque objects with background color
        gl_FragColor.rgb = mix(gl_FragColor.rgb, uFogColor, fogFactor);
    }
} else {
    // pre-multiplied alpha expected for transparent background
    gl_FragColor.rgb *= fogAlpha;
    gl_FragColor.a = fogAlpha;
}
`,pie=`
if (interior) {
    if (uInteriorColorFlag) {
        gl_FragColor.rgb = uInteriorColor;
    } else {
        gl_FragColor.rgb *= 1.0 - uInteriorDarkening;
    }
}
`,hie=`
// inputs
// - vec4 material
// - vec3 vViewPosition
// - vec3 normal
// - float uMetalness
// - float uRoughness
// - float uReflectivity
// - float uLightIntensity
// - float uAmbientIntensity

// outputs
// - sets gl_FragColor

vec4 color = material;

ReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0));

PhysicalMaterial physicalMaterial;
physicalMaterial.diffuseColor = color.rgb * (1.0 - uMetalness);
physicalMaterial.specularRoughness = clamp(uRoughness, 0.04, 1.0);
physicalMaterial.specularColor = mix(vec3(0.16 * pow2(uReflectivity)), color.rgb, uMetalness);

GeometricContext geometry;
geometry.position = -vViewPosition;
geometry.normal = normal;
geometry.viewDir = normalize(vViewPosition);

IncidentLight directLight;
directLight.direction = vec3(0.0, 0.0, -1.0);
directLight.color = vec3(uLightIntensity);

RE_Direct_Physical(directLight, geometry, physicalMaterial, reflectedLight);

vec3 irradiance = vec3(uAmbientIntensity) * PI;
RE_IndirectDiffuse_Physical(irradiance, geometry, physicalMaterial, reflectedLight);

vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular;

gl_FragColor = vec4(outgoingLight, color.a);

#ifdef dXrayShaded
    gl_FragColor.a *= 1.0 - pow(abs(dot(normal, vec3(0, 0, 1))), uXrayEdgeFalloff);
#endif
`,vie=`
float marker = floor(vMarker * 255.0 + 0.5); // rounding required to work on some cards on win
if (marker > 0.1) {
    if (intMod(marker, 2.0) > 0.1) {
        gl_FragColor.rgb = mix(uHighlightColor, gl_FragColor.rgb, 0.3);
        gl_FragColor.a = max(0.02, gl_FragColor.a); // for direct-volume rendering
    } else {
        gl_FragColor.rgb = mix(uSelectColor, gl_FragColor.rgb, 0.3);
    }
}
`,mie=`
#if dClipObjectCount != 0 && defined(dClipping)
    vClipping = readFromTexture(tClipping, aInstance * float(uGroupCount) + group, uClippingTexDim).a;
#endif
`,gie=`
#if defined(dRenderVariant_color)
    #if defined(dColorType_attribute)
        vColor.rgb = aColor;
    #elif defined(dColorType_instance)
        vColor.rgb = readFromTexture(tColor, aInstance, uColorTexDim).rgb;
    #elif defined(dColorType_group)
        vColor.rgb = readFromTexture(tColor, group, uColorTexDim).rgb;
    #elif defined(dColorType_groupInstance)
        vColor.rgb = readFromTexture(tColor, aInstance * float(uGroupCount) + group, uColorTexDim).rgb;
    #elif defined(dColorType_vertex)
        vColor.rgb = readFromTexture(tColor, VertexID, uColorTexDim).rgb;
    #elif defined(dColorType_vertexInstance)
        vColor.rgb = readFromTexture(tColor, int(aInstance) * uVertexCount + VertexID, uColorTexDim).rgb;
    #elif defined(dColorType_volume)
        vec3 gridPos = (uColorGridTransform.w * (position - uColorGridTransform.xyz)) / uColorGridDim;
        vColor.rgb = texture3dFrom2dLinear(tColorGrid, gridPos, uColorGridDim, uColorTexDim).rgb;
    #elif defined(dColorType_volumeInstance)
        vec3 gridPos = (uColorGridTransform.w * (vModelPosition - uColorGridTransform.xyz)) / uColorGridDim;
        vColor.rgb = texture3dFrom2dLinear(tColorGrid, gridPos, uColorGridDim, uColorTexDim).rgb;
    #endif

    #ifdef dUsePalette
        vPaletteV = ((vColor.r * 256.0 * 256.0 * 255.0 + vColor.g * 256.0 * 255.0 + vColor.b * 255.0) - 1.0) / 16777215.0;
    #endif

    #ifdef dOverpaint
        vOverpaint = readFromTexture(tOverpaint, aInstance * float(uGroupCount) + group, uOverpaintTexDim);
    #endif
#elif defined(dRenderVariant_pick)
    #if defined(dRenderVariant_pickObject)
        vColor = vec4(encodeFloatRGB(float(uObjectId)), 1.0);
    #elif defined(dRenderVariant_pickInstance)
        vColor = vec4(encodeFloatRGB(aInstance), 1.0);
    #elif defined(dRenderVariant_pickGroup)
        vColor = vec4(encodeFloatRGB(group), 1.0);
    #endif
#endif

#ifdef dTransparency
    vGroup = group;
    vTransparency = readFromTexture(tTransparency, aInstance * float(uGroupCount) + group, uTransparencyTexDim).a;
#endif
`,yie=`
#ifdef dGeoTexture
    float group = decodeFloatRGB(readFromTexture(tGroup, VertexID, uGeoTexDim).rgb);
#else
    float group = aGroup;
#endif
`,bie=`
vMarker = readFromTexture(tMarker, aInstance * float(uGroupCount) + group, uMarkerTexDim).a;
`,Sie=`
#if defined(dRenderVariant_color)
    #if defined(dUsePalette)
        vec4 material = vec4(texture2D(tPalette, vec2(vPaletteV, 0.5)).rgb, uAlpha);
    #elif defined(dColorType_uniform)
        vec4 material = vec4(uColor, uAlpha);
    #elif defined(dColorType_varying)
        vec4 material = vec4(vColor.rgb, uAlpha);
    #endif

    // mix material with overpaint
    #if defined(dOverpaint)
        material.rgb = mix(material.rgb, vOverpaint.rgb, vOverpaint.a);
    #endif
#elif defined(dRenderVariant_pick)
    vec4 material = vColor;
#elif defined(dRenderVariant_depth)
    #ifdef enabledFragDepth
        vec4 material = packDepthToRGBA(gl_FragDepthEXT);
    #else
        vec4 material = packDepthToRGBA(gl_FragCoord.z);
    #endif
#endif

// apply screendoor transparency
#if defined(dTransparency)
    float ta = 1.0 - vTransparency;

    #if defined(dRenderVariant_pick)
        if (ta < uPickingAlphaThreshold)
            discard; // ignore so the element below can be picked
    #else
        #if defined(dRenderVariant_colorBlended)
            float at = 0.0;

            // shift by view-offset during multi-sample rendering to allow for blending
            vec2 coord = gl_FragCoord.xy + uViewOffset * 0.25;

            const mat4 thresholdMatrix = mat4(
                1.0 / 17.0,  9.0 / 17.0,  3.0 / 17.0, 11.0 / 17.0,
                13.0 / 17.0,  5.0 / 17.0, 15.0 / 17.0,  7.0 / 17.0,
                4.0 / 17.0, 12.0 / 17.0,  2.0 / 17.0, 10.0 / 17.0,
                16.0 / 17.0,  8.0 / 17.0, 14.0 / 17.0,  6.0 / 17.0
            );
            int ci = int(intMod(coord.x, 4.0));
            int ri = int(intMod(coord.y, 4.0));
            #if __VERSION__ == 100
                vec4 i = vec4(float(ci * 4 + ri));
                vec4 v = thresholdMatrix[0] * vec4(equal(i, vec4(0.0, 1.0, 2.0, 3.0))) +
                    thresholdMatrix[1] * vec4(equal(i, vec4(4.0, 5.0, 6.0, 7.0))) +
                    thresholdMatrix[2] * vec4(equal(i, vec4(8.0, 9.0, 10.0, 11.0))) +
                    thresholdMatrix[3] * vec4(equal(i, vec4(12.0, 13.0, 14.0, 15.0)));
                at = v.x + v.y + v.z + v.w;
            #else
                at = thresholdMatrix[ci][ri];
            #endif

            if (ta < 0.99 && (ta < 0.01 || ta < at)) {
                discard;
            }
        #elif defined(dRenderVariant_colorWboit)
            material.a *= ta;
        #endif
    #endif
#endif
`,xie=`
mat4 model = uModel * aTransform;
mat4 modelView = uView * model;
#ifdef dGeoTexture
    vec3 position = readFromTexture(tPosition, VertexID, uGeoTexDim).xyz;
#else
    vec3 position = aPosition;
#endif
vec4 position4 = vec4(position, 1.0);
// for accessing tColorGrid in vert shader and for clipping in frag shader
vModelPosition = (model * position4).xyz;
vec4 mvPosition = modelView * position4;
vViewPosition = mvPosition.xyz;
gl_Position = uProjection * mvPosition;
`,Cie=`
#if defined(dSizeType_uniform)
    float size = uSize;
#elif defined(dSizeType_attribute)
    float size = aSize;
#elif defined(dSizeType_instance)
    float size = decodeFloatRGB(readFromTexture(tSize, aInstance, uSizeTexDim).rgb);
#elif defined(dSizeType_group)
    float size = decodeFloatRGB(readFromTexture(tSize, group, uSizeTexDim).rgb);
#elif defined(dSizeType_groupInstance)
    float size = decodeFloatRGB(readFromTexture(tSize, aInstance * float(uGroupCount) + group, uSizeTexDim).rgb);
#endif

#if defined(dSizeType_instance) || defined(dSizeType_group) || defined(dSizeType_groupInstance)
    size /= 100.0; // NOTE factor also set in TypeScript
#endif

size *= uSizeFactor;
`,_ie=`
float viewZ = depthToViewZ(uIsOrtho, fragmentDepth, uNear, uFar);
float fogFactor = smoothstep(uFogNear, uFogFar, abs(viewZ));
float alpha = (1.0 - fogFactor) * uAlpha;
if (uAlpha < uPickingAlphaThreshold || alpha < 0.1)
    discard; // ignore so the element below can be picked
`,wie=`
#if defined(dClipVariant_instance) && dClipObjectCount != 0
    int flag = 0;
    #if defined(dClipping)
        flag = int(floor(vClipping * 255.0 + 0.5));
    #endif

    vec4 mCenter = uModel * aTransform * vec4(uInvariantBoundingSphere.xyz, 1.0);
    if (clipTest(vec4(mCenter.xyz, uInvariantBoundingSphere.w), flag))
        // move out of [ -w, +w ] to 'discard' in vert shader
        gl_Position.z = 2.0 * gl_Position.w;
#endif
`,Aie=`
#if defined(dClipVariant_pixel) && dClipObjectCount != 0
    #if defined(dClipping)
        int clippingFlag = int(floor(vClipping * 255.0 + 0.5));
    #else
        int clippingFlag = 0;
    #endif

    if (clipTest(vec4(vModelPosition, 0.0), clippingFlag))
        discard;
#endif
`,Pie=`
#if defined(dRenderVariant_color)
    #if defined(dColorType_uniform)
        uniform vec3 uColor;
    #elif defined(dColorType_varying)
        varying vec4 vColor;
    #endif

    #ifdef dOverpaint
        varying vec4 vOverpaint;
    #endif
#elif defined(dRenderVariant_pick)
    #if __VERSION__ == 100
        varying vec4 vColor;
    #else
        flat in vec4 vColor;
    #endif
#endif

#ifdef dTransparency
    varying float vGroup;
    varying float vTransparency;
#endif

#ifdef dUsePalette
    uniform sampler2D tPalette;
    varying float vPaletteV;
#endif
`,Tie=`
#if defined(dRenderVariant_color)
    #if defined(dColorType_uniform)
        uniform vec3 uColor;
    #elif defined(dColorType_attribute)
        varying vec4 vColor;
        attribute vec3 aColor;
    #elif defined(dColorType_texture)
        varying vec4 vColor;
        uniform vec2 uColorTexDim;
        uniform sampler2D tColor;
    #elif defined(dColorType_grid)
        varying vec4 vColor;
        uniform vec2 uColorTexDim;
        uniform vec3 uColorGridDim;
        uniform vec4 uColorGridTransform;
        uniform sampler2D tColorGrid;
    #endif

    #ifdef dOverpaint
        varying vec4 vOverpaint;
        uniform vec2 uOverpaintTexDim;
        uniform sampler2D tOverpaint;
    #endif
#elif defined(dRenderVariant_pick)
    #if __VERSION__ == 100
        varying vec4 vColor;
    #else
        flat out vec4 vColor;
    #endif
#endif

#ifdef dTransparency
    varying float vGroup;
    varying float vTransparency;
    uniform vec2 uTransparencyTexDim;
    uniform sampler2D tTransparency;
#endif

#ifdef dUsePalette
    varying float vPaletteV;
#endif
`,Eie=`
#if dClipObjectCount != 0
    vec3 quaternionTransform(vec4 q, vec3 v) {
        vec3 t = 2.0 * cross(q.xyz, v);
        return v + q.w * t + cross(q.xyz, t);
    }

    vec4 computePlane(vec3 normal, vec3 inPoint) {
        return vec4(normalize(normal), -dot(normal, inPoint));
    }

    float planeSD(vec4 plane, vec3 center) {
        return -dot(plane.xyz, center - plane.xyz * -plane.w);
    }

    float sphereSD(vec3 position, vec4 rotation, vec3 size, vec3 center) {
        return (
            length(quaternionTransform(vec4(-rotation.x, -rotation.y, -rotation.z, rotation.w), center - position) / size) - 1.0
        ) * min(min(size.x, size.y), size.z);
    }

    float cubeSD(vec3 position, vec4 rotation, vec3 size, vec3 center) {
        vec3 d = abs(quaternionTransform(vec4(-rotation.x, -rotation.y, -rotation.z, rotation.w), center - position)) - size;
        return min(max(d.x, max(d.y, d.z)), 0.0) + length(max(d, 0.0));
    }

    float cylinderSD(vec3 position, vec4 rotation, vec3 size, vec3 center) {
        vec3 t = quaternionTransform(vec4(-rotation.x, -rotation.y, -rotation.z, rotation.w), center - position);

        vec2 d = abs(vec2(length(t.xz), t.y)) - size.xy;
        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0));
    }

    float infiniteConeSD(vec3 position, vec4 rotation, vec3 size, vec3 center) {
        vec3 t = quaternionTransform(vec4(-rotation.x, -rotation.y, -rotation.z, rotation.w), center - position);

        float q = length(t.xy);
        return dot(size.xy, vec2(q, t.z));
    }

    float getSignedDistance(vec3 center, int type, vec3 position, vec4 rotation, vec3 scale) {
        if (type == 1) {
            vec3 normal = quaternionTransform(rotation, vec3(0.0, 1.0, 0.0));
            vec4 plane = computePlane(normal, position);
            return planeSD(plane, center);
        } else if (type == 2) {
            return sphereSD(position, rotation, scale * 0.5, center);
        } else if (type == 3) {
            return cubeSD(position, rotation, scale * 0.5, center);
        } else if (type == 4) {
            return cylinderSD(position, rotation, scale * 0.5, center);
        } else if (type == 5) {
            return infiniteConeSD(position, rotation, scale * 0.5, center);
        } else {
            return 0.1;
        }
    }

    #if __VERSION__ == 100
        // 8-bit
        int bitwiseAnd(int a, int b) {
            int d = 128;
            int result = 0;
            for (int i = 0; i < 8; ++i) {
                if (d <= 0) break;
                if (a >= d && b >= d) result += d;
                if (a >= d) a -= d;
                if (b >= d) b -= d;
                d /= 2;
            }
            return result;
        }

        bool hasBit(int mask, int bit) {
            return bitwiseAnd(mask, bit) == 0;
        }
    #else
        bool hasBit(int mask, int bit) {
            return (mask & bit) == 0;
        }
    #endif

    // flag is a bit-flag for clip-objects to ignore (note, object ids start at 1 not 0)
    bool clipTest(vec4 sphere, int flag) {
        for (int i = 0; i < dClipObjectCount; ++i) {
            if (flag == 0 || hasBit(flag, i + 1)) {
                // TODO take sphere radius into account?
                bool test = getSignedDistance(sphere.xyz, uClipObjectType[i], uClipObjectPosition[i], uClipObjectRotation[i], uClipObjectScale[i]) <= 0.0;
                if ((!uClipObjectInvert[i] && test) || (uClipObjectInvert[i] && !test)) {
                    return true;
                }
            }
        }
        return false;
    }
#endif
`,Iie=`
uniform int uObjectId;
uniform int uInstanceCount;
uniform int uGroupCount;

#if dClipObjectCount != 0
    uniform int uClipObjectType[dClipObjectCount];
    uniform bool uClipObjectInvert[dClipObjectCount];
    uniform vec3 uClipObjectPosition[dClipObjectCount];
    uniform vec4 uClipObjectRotation[dClipObjectCount];
    uniform vec3 uClipObjectScale[dClipObjectCount];

    #if defined(dClipping)
        #if __VERSION__ == 100
            varying float vClipping;
        #else
            flat in float vClipping;
        #endif
    #endif
#endif

uniform vec3 uHighlightColor;
uniform vec3 uSelectColor;
#if __VERSION__ == 100
    varying float vMarker;
#else
    flat in float vMarker;
#endif

varying vec3 vModelPosition;
varying vec3 vViewPosition;

uniform vec2 uViewOffset;

uniform float uNear;
uniform float uFar;
uniform float uIsOrtho;

uniform float uFogNear;
uniform float uFogFar;
uniform vec3 uFogColor;

uniform float uAlpha;
uniform float uPickingAlphaThreshold;
uniform bool uTransparentBackground;

uniform float uInteriorDarkening;
uniform bool uInteriorColorFlag;
uniform vec3 uInteriorColor;
bool interior;

uniform float uXrayEdgeFalloff;

uniform mat4 uProjection;
`,Mie=`
uniform mat4 uProjection, uModel, uView;
uniform vec3 uCameraPosition;

uniform int uObjectId;
uniform int uVertexCount;
uniform int uInstanceCount;
uniform int uGroupCount;
uniform vec4 uInvariantBoundingSphere;

#if dClipObjectCount != 0
    uniform int uClipObjectType[dClipObjectCount];
    uniform bool uClipObjectInvert[dClipObjectCount];
    uniform vec3 uClipObjectPosition[dClipObjectCount];
    uniform vec4 uClipObjectRotation[dClipObjectCount];
    uniform vec3 uClipObjectScale[dClipObjectCount];

    #if defined(dClipping)
        uniform vec2 uClippingTexDim;
        uniform sampler2D tClipping;
        #if __VERSION__ == 100
            varying float vClipping;
        #else
            flat out float vClipping;
        #endif
    #endif
#endif

uniform vec2 uMarkerTexDim;
uniform sampler2D tMarker;
#if __VERSION__ == 100
    varying float vMarker;
#else
    flat out float vMarker;
#endif

varying vec3 vModelPosition;
varying vec3 vViewPosition;

#if __VERSION__ == 100
    attribute float aVertex;
    #define VertexID int(aVertex)
#else
    // not using gl_VertexID but aVertex to ensure there is an active attribute with divisor 0
    // since FF 85 this is not needed anymore but lets keep it for backwards compatibility
    // https://bugzilla.mozilla.org/show_bug.cgi?id=1679693
    // see also note in src/mol-gl/webgl/render-item.ts
    attribute float aVertex;
    #define VertexID int(aVertex)
    // #define VertexID gl_VertexID
#endif
`,Die=`
// TODO find a better place for these convenience defines

#if defined(dRenderVariant_colorBlended) || defined(dRenderVariant_colorWboit)
    #define dRenderVariant_color
#endif

#if defined(dRenderVariant_pickObject) || defined(dRenderVariant_pickInstance) || defined(dRenderVariant_pickGroup)
    #define dRenderVariant_pick
#endif

#if defined(dColorType_instance) || defined(dColorType_group) || defined(dColorType_groupInstance) || defined(dColorType_vertex) || defined(dColorType_vertexInstance)
    #define dColorType_texture
#endif

#if defined(dColorType_volume) || defined(dColorType_volumeInstance)
    #define dColorType_grid
#endif

#if defined(dColorType_attribute) || defined(dColorType_texture) || defined(dColorType_grid)
    #define dColorType_varying
#endif

//

#define PI 3.14159265
#define RECIPROCAL_PI 0.31830988618
#define EPSILON 1e-6

#define saturate(a) clamp(a, 0.0, 1.0)

float intDiv(const in float a, const in float b) { return float(int(a) / int(b)); }
vec2 ivec2Div(const in vec2 a, const in vec2 b) { return vec2(ivec2(a) / ivec2(b)); }
float intMod(const in float a, const in float b) { return a - b * float(int(a) / int(b)); }
int imod(const in int a, const in int b) { return a - b * (a / b); }

float pow2(const in float x) { return x * x; }

const float maxFloat = 10000.0; // NOTE constant also set in TypeScript
const float floatLogFactor = 9.210440366976517; // log(maxFloat + 1.0);
float encodeFloatLog(const in float value) { return log(value + 1.0) / floatLogFactor; }
float decodeFloatLog(const in float value) { return exp(value * floatLogFactor) - 1.0; }

vec3 encodeFloatRGB(in float value) {
    value = clamp(value, 0.0, 16777216.0 - 1.0) + 1.0;
    vec3 c = vec3(0.0);
    c.b = mod(value, 256.0);
    value = floor(value / 256.0);
    c.g = mod(value, 256.0);
    value = floor(value / 256.0);
    c.r = mod(value, 256.0);
    return c / 255.0;
}
float decodeFloatRGB(const in vec3 rgb) {
    return (rgb.r * 256.0 * 256.0 * 255.0 + rgb.g * 256.0 * 255.0 + rgb.b * 255.0) - 1.0;
}

vec2 packUnitIntervalToRG(const in float v) {
    vec2 enc;
    enc.xy = vec2(fract(v * 256.0), v);
    enc.y -= enc.x * (1.0 / 256.0);
    enc.xy *=  256.0 / 255.0;

    return enc;
}

float unpackRGToUnitInterval(const in vec2 enc) {
    return dot(enc, vec2(255.0 / (256.0 * 256.0), 255.0 / 256.0));
}

vec3 screenSpaceToViewSpace(const in vec3 ssPos, const in mat4 invProjection) {
    vec4 p = vec4(ssPos * 2.0 - 1.0, 1.0);
    p = invProjection * p;
    return p.xyz / p.w;
}

const float PackUpscale = 256.0 / 255.0; // fraction -> 0..1 (including 1)
const float UnpackDownscale = 255.0 / 256.0; // 0..1 -> fraction (excluding 1)
const vec3 PackFactors = vec3(256.0 * 256.0 * 256.0, 256.0 * 256.0,  256.0);
const vec4 UnpackFactors = UnpackDownscale / vec4(PackFactors, 1.0);
const float ShiftRight8 = 1.0 / 256.0;

vec4 packDepthToRGBA(const in float v) {
    vec4 r = vec4(fract(v * PackFactors), v);
    r.yzw -= r.xyz * ShiftRight8; // tidy overflow
    return r * PackUpscale;
}
float unpackRGBAToDepth(const in vec4 v) {
    return dot(v, UnpackFactors);
}

vec4 sRGBToLinear(const in vec4 c) {
    return vec4(mix(pow(c.rgb * 0.9478672986 + vec3(0.0521327014), vec3(2.4)), c.rgb * 0.0773993808, vec3(lessThanEqual(c.rgb, vec3(0.04045)))), c.a);
}
vec4 linearTosRGB(const in vec4 c) {
    return vec4(mix(pow(c.rgb, vec3(0.41666)) * 1.055 - vec3(0.055), c.rgb * 12.92, vec3(lessThanEqual(c.rgb, vec3(0.0031308)))), c.a);
}

float linearizeDepth(const in float depth, const in float near, const in float far) {
    return (2.0 * near) / (far + near - depth * (far - near));
}

float perspectiveDepthToViewZ(const in float invClipZ, const in float near, const in float far) {
    return (near * far) / ((far - near) * invClipZ - far);
}

float orthographicDepthToViewZ(const in float linearClipZ, const in float near, const in float far) {
    return linearClipZ * (near - far) - near;
}

float depthToViewZ(const in float isOrtho, const in float linearClipZ, const in float near, const in float far) {
    return isOrtho == 1.0 ? orthographicDepthToViewZ(linearClipZ, near, far) : perspectiveDepthToViewZ(linearClipZ, near, far);
}

#if __VERSION__ == 100
    // transpose

    float transpose(const in float m) {
        return m;
    }

    mat2 transpose2(const in mat2 m) {
        return mat2(
            m[0][0], m[1][0],
            m[0][1], m[1][1]
        );
    }

    mat3 transpose3(const in mat3 m) {
        return mat3(
            m[0][0], m[1][0], m[2][0],
            m[0][1], m[1][1], m[2][1],
            m[0][2], m[1][2], m[2][2]
        );
    }

    mat4 transpose4(const in mat4 m) {
        return mat4(
            m[0][0], m[1][0], m[2][0], m[3][0],
            m[0][1], m[1][1], m[2][1], m[3][1],
            m[0][2], m[1][2], m[2][2], m[3][2],
            m[0][3], m[1][3], m[2][3], m[3][3]
        );
    }

    // inverse

    float inverse(const in float m) {
        return 1.0 / m;
    }

    mat2 inverse2(const in mat2 m) {
        return mat2(m[1][1],-m[0][1],
                -m[1][0], m[0][0]) / (m[0][0]*m[1][1] - m[0][1]*m[1][0]);
    }

    mat3 inverse3(const in mat3 m) {
        float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2];
        float a10 = m[1][0], a11 = m[1][1], a12 = m[1][2];
        float a20 = m[2][0], a21 = m[2][1], a22 = m[2][2];

        float b01 = a22 * a11 - a12 * a21;
        float b11 = -a22 * a10 + a12 * a20;
        float b21 = a21 * a10 - a11 * a20;

        float det = a00 * b01 + a01 * b11 + a02 * b21;

        return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),
                    b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),
                    b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;
    }

    mat4 inverse4(const in mat4 m) {
        float
            a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],
            a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],
            a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],
            a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],

            b00 = a00 * a11 - a01 * a10,
            b01 = a00 * a12 - a02 * a10,
            b02 = a00 * a13 - a03 * a10,
            b03 = a01 * a12 - a02 * a11,
            b04 = a01 * a13 - a03 * a11,
            b05 = a02 * a13 - a03 * a12,
            b06 = a20 * a31 - a21 * a30,
            b07 = a20 * a32 - a22 * a30,
            b08 = a20 * a33 - a23 * a30,
            b09 = a21 * a32 - a22 * a31,
            b10 = a21 * a33 - a23 * a31,
            b11 = a22 * a33 - a23 * a32,

            det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;

        return mat4(
            a11 * b11 - a12 * b10 + a13 * b09,
            a02 * b10 - a01 * b11 - a03 * b09,
            a31 * b05 - a32 * b04 + a33 * b03,
            a22 * b04 - a21 * b05 - a23 * b03,
            a12 * b08 - a10 * b11 - a13 * b07,
            a00 * b11 - a02 * b08 + a03 * b07,
            a32 * b02 - a30 * b05 - a33 * b01,
            a20 * b05 - a22 * b02 + a23 * b01,
            a10 * b10 - a11 * b08 + a13 * b06,
            a01 * b08 - a00 * b10 - a03 * b06,
            a30 * b04 - a31 * b02 + a33 * b00,
            a21 * b02 - a20 * b04 - a23 * b00,
            a11 * b07 - a10 * b09 - a12 * b06,
            a00 * b09 - a01 * b07 + a02 * b06,
            a31 * b01 - a30 * b03 - a32 * b00,
            a20 * b03 - a21 * b01 + a22 * b00) / det;
    }
#else
    #define transpose2(m) transpose(m)
    #define transpose3(m) transpose(m)
    #define transpose4(m) transpose(m)

    #define inverse2(m) inverse(m)
    #define inverse3(m) inverse(m)
    #define inverse4(m) inverse(m)
#endif
`,Rie=`
    // floatToRgba adapted from https://github.com/equinor/glsl-float-to-rgba
    // MIT License, Copyright (c) 2020 Equinor

    float shiftRight (float v, float amt) {
    v = floor(v) + 0.5;
    return floor(v / exp2(amt));
    }
    float shiftLeft (float v, float amt) {
        return floor(v * exp2(amt) + 0.5);
    }
    float maskLast (float v, float bits) {
        return mod(v, shiftLeft(1.0, bits));
    }
    float extractBits (float num, float from, float to) {
        from = floor(from + 0.5); to = floor(to + 0.5);
        return maskLast(shiftRight(num, from), to - from);
    }

    vec4 floatToRgba(float texelFloat, bool littleEndian) {
        if (texelFloat == 0.0) return vec4(0.0, 0.0, 0.0, 0.0);
        float sign = texelFloat > 0.0 ? 0.0 : 1.0;
        texelFloat = abs(texelFloat);
        float exponent = floor(log2(texelFloat));
        float biased_exponent = exponent + 127.0;
        float fraction = ((texelFloat / exp2(exponent)) - 1.0) * 8388608.0;
        float t = biased_exponent / 2.0;
        float last_bit_of_biased_exponent = fract(t) * 2.0;
        float remaining_bits_of_biased_exponent = floor(t);
        float byte4 = extractBits(fraction, 0.0, 8.0) / 255.0;
        float byte3 = extractBits(fraction, 8.0, 16.0) / 255.0;
        float byte2 = (last_bit_of_biased_exponent * 128.0 + extractBits(fraction, 16.0, 23.0)) / 255.0;
        float byte1 = (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0;
        return (
            littleEndian
                ? vec4(byte4, byte3, byte2, byte1)
                : vec4(byte1, byte2, byte3, byte4)
        );
    }
`,Oie=`
uniform float uLightIntensity;
uniform float uAmbientIntensity;
uniform float uReflectivity;
uniform float uMetalness;
uniform float uRoughness;

struct PhysicalMaterial {
    vec3 diffuseColor;
    float specularRoughness;
    vec3 specularColor;
};

struct IncidentLight {
    vec3 color;
    vec3 direction;
};

struct ReflectedLight {
    vec3 directDiffuse;
    vec3 directSpecular;
    vec3 indirectDiffuse;
};

struct GeometricContext {
    vec3 position;
    vec3 normal;
    vec3 viewDir;
};

vec3 F_Schlick(const in vec3 specularColor, const in float dotLH) {
    // Original approximation by Christophe Schlick '94
    // float fresnel = pow( 1.0 - dotLH, 5.0 );
    // Optimized variant (presented by Epic at SIGGRAPH '13)
    // https://cdn2.unrealengine.com/Resources/files/2013SiggraphPresentationsNotes-26915738.pdf
    float fresnel = exp2((-5.55473 * dotLH - 6.98316) * dotLH);
    return (1.0 - specularColor) * fresnel + specularColor;
}

// Moving Frostbite to Physically Based Rendering 3.0 - page 12, listing 2
// https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf
float G_GGX_SmithCorrelated(const in float alpha, const in float dotNL, const in float dotNV) {
    float a2 = pow2(alpha);
    // dotNL and dotNV are explicitly swapped. This is not a mistake.
    float gv = dotNL * sqrt(a2 + (1.0 - a2) * pow2(dotNV));
    float gl = dotNV * sqrt(a2 + (1.0 - a2) * pow2(dotNL));
    return 0.5 / max(gv + gl, EPSILON);
}

// Microfacet Models for Refraction through Rough Surfaces - equation (33)
// http://graphicrants.blogspot.com/2013/08/specular-brdf-reference.html
// alpha is "roughness squared" in Disney\u2019s reparameterization
float D_GGX(const in float alpha, const in float dotNH) {
    float a2 = pow2(alpha);
    float denom = pow2(dotNH) * (a2 - 1.0) + 1.0; // avoid alpha = 0 with dotNH = 1
    return RECIPROCAL_PI * a2 / pow2(denom);
}

vec3 BRDF_Diffuse_Lambert(const in vec3 diffuseColor) {
    return RECIPROCAL_PI * diffuseColor;
}

// GGX Distribution, Schlick Fresnel, GGX-Smith Visibility
vec3 BRDF_Specular_GGX(const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness) {
    float alpha = pow2(roughness); // UE4's roughness
    vec3 halfDir = normalize(incidentLight.direction + geometry.viewDir);

    float dotNL = saturate(dot(geometry.normal, incidentLight.direction));
    float dotNV = saturate(dot(geometry.normal, geometry.viewDir));
    float dotNH = saturate(dot(geometry.normal, halfDir));
    float dotLH = saturate(dot(incidentLight.direction, halfDir));

    vec3 F = F_Schlick(specularColor, dotLH);
    float G = G_GGX_SmithCorrelated(alpha, dotNL, dotNV);
    float D = D_GGX(alpha, dotNH);
    return F * (G * D);
}

// ref: https://www.unrealengine.com/blog/physically-based-shading-on-mobile - environmentBRDF for GGX on mobile
vec3 BRDF_Specular_GGX_Environment(const in GeometricContext geometry, const in vec3 specularColor, const in float roughness) {
    float dotNV = saturate(dot(geometry.normal, geometry.viewDir));
    const vec4 c0 = vec4(-1, -0.0275, -0.572, 0.022);
    const vec4 c1 = vec4(1, 0.0425, 1.04, -0.04);
    vec4 r = roughness * c0 + c1;
    float a004 = min(r.x * r.x, exp2(-9.28 * dotNV)) * r.x + r.y;
    vec2 AB = vec2(-1.04, 1.04) * a004 + r.zw;
    return specularColor * AB.x + AB.y;
}

void RE_Direct_Physical(const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
    float dotNL = saturate(dot(geometry.normal, directLight.direction));
    vec3 irradiance = dotNL * directLight.color;
    irradiance *= PI; // punctual light

    reflectedLight.directSpecular += irradiance * BRDF_Specular_GGX(directLight, geometry, material.specularColor, material.specularRoughness);
    reflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert(material.diffuseColor);
}

void RE_IndirectDiffuse_Physical(const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
    reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert(material.diffuseColor);
}
`,Fie=`
float matrixScale(in mat4 m){
    vec4 r = m[0];
    return sqrt(r[0] * r[0] + r[1] * r[1] + r[2] * r[2]);
}
`,kie=`
varying vec3 vNormal;
`,Bie=`
vec4 readFromTexture(const in sampler2D tex, const in float i, const in vec2 dim) {
    float x = intMod(i, dim.x);
    float y = floor(intDiv(i, dim.x));
    vec2 uv = (vec2(x, y) + 0.5) / dim;
    return texture2D(tex, uv);
}

vec4 readFromTexture(const in sampler2D tex, const in int i, const in vec2 dim) {
    int x = imod(i, int(dim.x));
    int y = i / int(dim.x);
    vec2 uv = (vec2(x, y) + 0.5) / dim;
    return texture2D(tex, uv);
}
`,Lie=`
    // rgbaToFloat adapted from https://github.com/ihmeuw/glsl-rgba-to-float
    // BSD 3-Clause License
    //
    // Copyright (c) 2019, Institute for Health Metrics and Evaluation All rights reserved.
    // Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:
    //  - Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.
    //  - Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.
    //  - Neither the name of the copyright holder nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.
    //
    // THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES,
    // INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
    // IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY,
    // OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA,
    // OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
    // OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED
    // OF THE POSSIBILITY OF SUCH DAMAGE.

    ivec4 floatsToBytes(vec4 inputFloats, bool littleEndian) {
        ivec4 bytes = ivec4(inputFloats * 255.0);
        return (
            littleEndian
                ? bytes.abgr
                : bytes
        );
    }

    // Break the four bytes down into an array of 32 bits.
    void bytesToBits(const in ivec4 bytes, out bool bits[32]) {
        for (int channelIndex = 0; channelIndex < 4; ++channelIndex) {
            float acc = float(bytes[channelIndex]);
            for (int indexInByte = 7; indexInByte >= 0; --indexInByte) {
                float powerOfTwo = exp2(float(indexInByte));
                bool bit = acc >= powerOfTwo;
                bits[channelIndex * 8 + (7 - indexInByte)] = bit;
                acc = mod(acc, powerOfTwo);
            }
        }
    }

    // Compute the exponent of the 32-bit float.
    float getExponent(bool bits[32]) {
        const int startIndex = 1;
        const int bitStringLength = 8;
        const int endBeforeIndex = startIndex + bitStringLength;
        float acc = 0.0;
        int pow2 = bitStringLength - 1;
        for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {
            acc += float(bits[bitIndex]) * exp2(float(pow2--));
        }
        return acc;
    }

    // Compute the mantissa of the 32-bit float.
    float getMantissa(bool bits[32], bool subnormal) {
        const int startIndex = 9;
        const int bitStringLength = 23;
        const int endBeforeIndex = startIndex + bitStringLength;
        // Leading/implicit/hidden bit convention:
        // If the number is not subnormal (with exponent 0), we add a leading 1 digit.
        float acc = float(!subnormal) * exp2(float(bitStringLength));
        int pow2 = bitStringLength - 1;
        for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {
            acc += float(bits[bitIndex]) * exp2(float(pow2--));
        }
        return acc;
    }

    // Parse the float from its 32 bits.
    float bitsToFloat(bool bits[32]) {
        float signBit = float(bits[0]) * -2.0 + 1.0;
        float exponent = getExponent(bits);
        bool subnormal = abs(exponent - 0.0) < 0.01;
        float mantissa = getMantissa(bits, subnormal);
        float exponentBias = 127.0;
        return signBit * mantissa * exp2(exponent - exponentBias - 23.0);
    }

    float rgbaToFloat(vec4 texelRGBA, bool littleEndian) {
        ivec4 rgbaBytes = floatsToBytes(texelRGBA, littleEndian);
        bool bits[32];
        bytesToBits(rgbaBytes, bits);
        return bitsToFloat(bits);
    }
`,Nie=`
#if defined(dSizeType_uniform)
    uniform float uSize;
#elif defined(dSizeType_attribute)
    attribute float aSize;
#elif defined(dSizeType_instance) || defined(dSizeType_group) || defined(dSizeType_groupInstance)
    uniform vec2 uSizeTexDim;
    uniform sampler2D tSize;
#endif

uniform float uSizeFactor;
`,Uie=`
vec4 texture3dFrom1dTrilinear(const in sampler2D tex, const in vec3 pos, const in vec3 gridDim, const in vec2 texDim, const in float offset) {
    float gdYZ = gridDim.z * gridDim.y;
    float gdZ = gridDim.z;
    vec3 p0 = floor(pos * gridDim);
    vec3 p1 = ceil(pos * gridDim);
    vec3 pd = (pos * gridDim - p0) / (p1 - p0);
    vec4 s000 = readFromTexture(tex, offset + p0.z + p0.y * gdZ + p0.x * gdYZ, texDim);
    vec4 s100 = readFromTexture(tex, offset + p0.z + p0.y * gdZ + p1.x * gdYZ, texDim);
    vec4 s001 = readFromTexture(tex, offset + p1.z + p0.y * gdZ + p0.x * gdYZ, texDim);
    vec4 s101 = readFromTexture(tex, offset + p1.z + p0.y * gdZ + p1.x * gdYZ, texDim);
    vec4 s010 = readFromTexture(tex, offset + p0.z + p1.y * gdZ + p0.x * gdYZ, texDim);
    vec4 s110 = readFromTexture(tex, offset + p0.z + p1.y * gdZ + p1.x * gdYZ, texDim);
    vec4 s011 = readFromTexture(tex, offset + p1.z + p1.y * gdZ + p0.x * gdYZ, texDim);
    vec4 s111 = readFromTexture(tex, offset + p1.z + p1.y * gdZ + p1.x * gdYZ, texDim);
    vec4 s00 = mix(s000, s100, pd.x);
    vec4 s01 = mix(s001, s101, pd.x);
    vec4 s10 = mix(s010, s110, pd.x);
    vec4 s11 = mix(s011, s111, pd.x);
    vec4 s0 = mix(s00, s10, pd.y);
    vec4 s1 = mix(s01, s11, pd.y);
    return mix(s0, s1, pd.z);
}
`,zie=`
vec4 texture3dFrom2dLinear(sampler2D tex, vec3 pos, vec3 gridDim, vec2 texDim) {
    float zSlice0 = floor(pos.z * gridDim.z);
    float column0 = intMod(zSlice0 * gridDim.x, texDim.x) / gridDim.x;
    float row0 = floor(intDiv(zSlice0 * gridDim.x, texDim.x));
    vec2 coord0 = (vec2(column0 * gridDim.x, row0 * gridDim.y) + (pos.xy * gridDim.xy)) / texDim;
    vec4 color0 = texture2D(tex, coord0);

    float zSlice1 = zSlice0 + 1.0;
    float column1 = intMod(zSlice1 * gridDim.x, texDim.x) / gridDim.x;
    float row1 = floor(intDiv(zSlice1 * gridDim.x, texDim.x));
    vec2 coord1 = (vec2(column1 * gridDim.x, row1 * gridDim.y) + (pos.xy * gridDim.xy)) / texDim;
    vec4 color1 = texture2D(tex, coord1);

    float delta0 = abs((pos.z * gridDim.z) - zSlice0);
    return mix(color0, color1, delta0);
}
`,Vie=`
vec4 texture3dFrom2dNearest(sampler2D tex, vec3 pos, vec3 gridDim, vec2 texDim) {
    float zSlice = floor(pos.z * gridDim.z + 0.5); // round to nearest z-slice
    float column = intMod(zSlice * gridDim.x, texDim.x) / gridDim.x;
    float row = floor(intDiv(zSlice * gridDim.x, texDim.x));
    vec2 coord = (vec2(column * gridDim.x, row * gridDim.y) + (pos.xy * gridDim.xy)) / texDim;
    return texture2D(tex, coord);
}
`,Hie=`
#if defined(dRenderVariant_colorWboit)
    #if !defined(dRenderMode_volume) && !defined(dRenderMode_isosurface)
        uniform sampler2D tDepth;
        uniform vec2 uDrawingBufferSize;

        float getDepth(const in vec2 coords) {
            // always packed due to merged depth from primitives and volumes
            return unpackRGBAToDepth(texture2D(tDepth, coords));
        }
    #endif
#endif

uniform bool uRenderWboit;

float calcDepth(const in vec3 pos) {
    vec2 clipZW = pos.z * uProjection[2].zw + uProjection[3].zw;
    return 0.5 + 0.5 * clipZW.x / clipZW.y;
}
`,Gie=`
#if defined(dRenderVariant_colorWboit)
    if (!uRenderWboit) {
        if (preFogAlpha < 1.0) {
            discard;
        }
    } else if (uRenderWboit) {
        // the 'fragmentDepth > 0.99' check is to handle precision issues with packed depth
        if (preFogAlpha != 1.0 && !interior && (fragmentDepth < getDepth(gl_FragCoord.xy / uDrawingBufferSize) || fragmentDepth > 0.99)) {
            float alpha = gl_FragColor.a;
            float wboitWeight = alpha * clamp(pow(1.0 - fragmentDepth, 2.0), 0.01, 1.0);
            gl_FragColor = vec4(gl_FragColor.rgb * alpha * wboitWeight, alpha);
            // extra alpha is to handle pre-multiplied alpha
            #if !defined(dRenderMode_volume) && !defined(dRenderMode_isosurface)
                gl_FragData[1] = vec4((uTransparentBackground ? alpha : 1.0) * alpha * wboitWeight);
            #else
                gl_FragData[1] = vec4(alpha * alpha * wboitWeight);
            #endif
        } else {
            discard;
        }
    }
#endif
`,qie=`
precision highp float;
precision highp int;

#include common
#include read_from_texture
#include common_vert_params
#include color_vert_params
#include size_vert_params
#include common_clip

uniform float uPixelRatio;
uniform float uViewportHeight;

attribute vec3 aPosition;
attribute mat4 aTransform;
attribute float aInstance;
attribute float aGroup;

void main(){
    #include assign_group
    #include assign_color_varying
    #include assign_marker_varying
    #include assign_clipping_varying
    #include assign_position
    #include assign_size

    #ifdef dPointSizeAttenuation
        gl_PointSize = size * uPixelRatio * ((uViewportHeight / 2.0) / -mvPosition.z) * 5.0;
    #else
        gl_PointSize = size * uPixelRatio;
    #endif

    gl_Position = uProjection * mvPosition;

    #include clip_instance
}
`,jie=`
precision highp float;
precision highp int;

#include common
#include common_frag_params
#include color_frag_params
#include common_clip
#include wboit_params

#ifdef dPointFilledCircle
    uniform float uPointEdgeBleach;
#endif

const vec2 center = vec2(0.5);
const float radius = 0.5;

void main(){
    #include clip_pixel

    float fragmentDepth = gl_FragCoord.z;
    bool interior = false;
    #include assign_material_color

    #if defined(dRenderVariant_pick)
        #include check_picking_alpha
        gl_FragColor = material;
    #elif defined(dRenderVariant_depth)
        gl_FragColor = material;
    #elif defined(dRenderVariant_color)
        gl_FragColor = material;

        #ifdef dPointFilledCircle
            float dist = distance(gl_PointCoord, center);
            float alpha = 1.0 - smoothstep(radius - uPointEdgeBleach, radius, dist);
            if (alpha < 0.0001) discard;
            gl_FragColor.a *= alpha;
        #endif

        #include apply_marker_color
        #include apply_fog
        #include wboit_write
    #endif
}
`,Wie=`
precision highp float;
precision highp int;

#include common
#include read_from_texture
#include common_vert_params
#include color_vert_params
#include size_vert_params
#include common_clip

uniform mat4 uModelView;
uniform mat4 uInvProjection;

attribute vec3 aPosition;
attribute vec2 aMapping;
attribute mat4 aTransform;
attribute float aInstance;
attribute float aGroup;

varying float vRadius;
varying float vRadiusSq;
varying vec3 vPoint;
varying vec3 vPointViewPosition;

#include matrix_scale

const mat4 D = mat4(
    1.0, 0.0, 0.0, 0.0,
    0.0, 1.0, 0.0, 0.0,
    0.0, 0.0, 1.0, 0.0,
    0.0, 0.0, 0.0, -1.0
);

/**
 * Compute point size and center using the technique described in:
 * "GPU-Based Ray-Casting of Quadratic Surfaces" http://dl.acm.org/citation.cfm?id=2386396
 * by Christian Sigg, Tim Weyrich, Mario Botsch, Markus Gross.
 */
void quadraticProjection(const in float radius, const in vec3 position){
    vec2 xbc, ybc;

    mat4 T = mat4(
        radius, 0.0, 0.0, 0.0,
        0.0, radius, 0.0, 0.0,
        0.0, 0.0, radius, 0.0,
        position.x, position.y, position.z, 1.0
    );

    mat4 R = transpose4(uProjection * uModelView * aTransform * T);
    float A = dot(R[3], D * R[3]);
    float B = -2.0 * dot(R[0], D * R[3]);
    float C = dot(R[0], D * R[0]);
    xbc[0] = (-B - sqrt(B * B - 4.0 * A * C)) / (2.0 * A);
    xbc[1] = (-B + sqrt(B * B - 4.0 * A * C)) / (2.0 * A);
    float sx = abs(xbc[0] - xbc[1]) * 0.5;

    A = dot(R[3], D * R[3]);
    B = -2.0 * dot(R[1], D * R[3]);
    C = dot(R[1], D * R[1]);
    ybc[0] = (-B - sqrt(B * B - 4.0 * A * C)) / (2.0 * A);
    ybc[1] = (-B + sqrt(B * B - 4.0 * A * C)) / (2.0 * A);
    float sy = abs(ybc[0] - ybc[1]) * 0.5;

    gl_Position.xy = vec2(0.5 * (xbc.x + xbc.y), 0.5 * (ybc.x + ybc.y));
    gl_Position.xy -= aMapping * vec2(sx, sy);
    gl_Position.xy *= gl_Position.w;
}


void main(void){
    #include assign_group
    #include assign_color_varying
    #include assign_marker_varying
    #include assign_clipping_varying
    #include assign_size

    vRadius = size * matrixScale(uModelView);

    vec4 position4 = vec4(aPosition, 1.0);
    vec4 mvPosition = uModelView * aTransform * position4;
    mvPosition.z -= vRadius; // avoid clipping, added again in fragment shader

    gl_Position = uProjection * vec4(mvPosition.xyz, 1.0);
    quadraticProjection(size, aPosition);

    vRadiusSq = vRadius * vRadius;
    vec4 vPoint4 = uInvProjection * gl_Position;
    vPoint = vPoint4.xyz / vPoint4.w;
    vPointViewPosition = -mvPosition.xyz / mvPosition.w;

    vModelPosition = (uModel * aTransform * position4).xyz; // for clipping in frag shader

    #include clip_instance
}
`,Xie=`
precision highp float;
precision highp int;

#include common
#include common_frag_params
#include color_frag_params
#include light_frag_params
#include common_clip
#include wboit_params

varying float vRadius;
varying float vRadiusSq;
varying vec3 vPoint;
varying vec3 vPointViewPosition;

vec3 cameraPos;
vec3 cameraNormal;

bool Impostor(out vec3 cameraPos, out vec3 cameraNormal){
    vec3 cameraSpherePos = -vPointViewPosition;
    cameraSpherePos.z += vRadius;

    vec3 rayOrigin = mix(vec3(0.0, 0.0, 0.0), vPoint, uIsOrtho);
    vec3 rayDirection = mix(normalize(vPoint), vec3(0.0, 0.0, 1.0), uIsOrtho);
    vec3 cameraSphereDir = mix(cameraSpherePos, rayOrigin - cameraSpherePos, uIsOrtho);

    float B = dot(rayDirection, cameraSphereDir);
    float det = B * B + vRadiusSq - dot(cameraSphereDir, cameraSphereDir);

    if (det < 0.0){
        discard;
        return false;
    }

    float sqrtDet = sqrt(det);
    float posT = mix(B + sqrtDet, B + sqrtDet, uIsOrtho);
    float negT = mix(B - sqrtDet, sqrtDet - B, uIsOrtho);

    cameraPos = rayDirection * negT + rayOrigin;


    if (calcDepth(cameraPos) <= 0.0) {
        cameraPos = rayDirection * posT + rayOrigin;
        interior = true;
    } else {
        interior = false;
    }

    cameraNormal = normalize(cameraPos - cameraSpherePos);
    cameraNormal *= float(!interior) * 2.0 - 1.0;

    return !interior;
}

void main(void){
    #include clip_pixel

    bool flag = Impostor(cameraPos, cameraNormal);
    #ifndef dDoubleSided
        if (interior)
            discard;
    #endif

    vec3 vViewPosition = cameraPos;
    gl_FragDepthEXT = calcDepth(vViewPosition);
    if (!flag && gl_FragDepthEXT >= 0.0) {
        gl_FragDepthEXT = 0.0 + (0.0000001 / vRadius);
    }

    // bugfix (mac only?)
    if (gl_FragDepthEXT < 0.0) discard;
    if (gl_FragDepthEXT > 1.0) discard;

    float fragmentDepth = gl_FragDepthEXT;
    #include assign_material_color

    #if defined(dRenderVariant_pick)
        #include check_picking_alpha
        gl_FragColor = material;
    #elif defined(dRenderVariant_depth)
        gl_FragColor = material;
    #elif defined(dRenderVariant_color)
        #ifdef dIgnoreLight
            gl_FragColor = material;
        #else
            vec3 normal = -cameraNormal;
            #include apply_light_color
        #endif

        #include apply_interior_color
        #include apply_marker_color
        #include apply_fog
        #include wboit_write
    #endif
}
`,Yie=`
precision highp float;
precision highp int;

#include common
#include read_from_texture
#include common_vert_params
#include color_vert_params
#include size_vert_params
#include common_clip

uniform mat4 uModelView;

attribute mat4 aTransform;
attribute float aInstance;
attribute float aGroup;

attribute vec3 aMapping;
attribute vec3 aStart;
attribute vec3 aEnd;
attribute float aScale;
attribute float aCap;

varying mat4 vTransform;
varying vec3 vStart;
varying vec3 vEnd;
varying float vSize;
varying float vCap;

uniform float uIsOrtho;
uniform vec3 uCameraDir;

void main() {
    #include assign_group
    #include assign_color_varying
    #include assign_marker_varying
    #include assign_clipping_varying
    #include assign_size

    mat4 modelTransform = uModel * aTransform;

    vTransform = aTransform;
    vStart = (modelTransform * vec4(aStart, 1.0)).xyz;
    vEnd = (modelTransform * vec4(aEnd, 1.0)).xyz;
    vSize = size * aScale;
    vCap = aCap;

    vModelPosition = (vStart + vEnd) * 0.5;
    vec3 camDir = -mix(normalize(vModelPosition - uCameraPosition), uCameraDir, uIsOrtho);
    vec3 dir = vEnd - vStart;
    // ensure cylinder 'dir' is pointing towards the camera
    if(dot(camDir, dir) < 0.0) dir = -dir;

    vec3 left = cross(camDir, dir);
    vec3 up = cross(left, dir);
    left = vSize * normalize(left);
    up = vSize * normalize(up);

    // move vertex in object-space from center to corner
    vModelPosition += aMapping.x * dir + aMapping.y * left + aMapping.z * up;

    vec4 mvPosition = uView * vec4(vModelPosition, 1.0);
    vViewPosition = mvPosition.xyz;
    gl_Position = uProjection * mvPosition;

    #include clip_instance
}
`,Kie=`
precision highp float;
precision highp int;

uniform mat4 uView;

varying mat4 vTransform;
varying vec3 vStart;
varying vec3 vEnd;
varying float vSize;
varying float vCap;

uniform vec3 uCameraDir;
uniform vec3 uCameraPosition;

#include common
#include common_frag_params
#include color_frag_params
#include light_frag_params
#include common_clip
#include wboit_params

// adapted from https://www.shadertoy.com/view/4lcSRn
// The MIT License, Copyright 2016 Inigo Quilez
bool CylinderImpostor(
    in vec3 rayOrigin, in vec3 rayDir,
    in vec3 start, in vec3 end, in float radius,
    out vec4 intersection, out bool interior
){
    vec3 ba = end - start;
    vec3 oc = rayOrigin - start;

    float baba = dot(ba, ba);
    float bard = dot(ba, rayDir);
    float baoc = dot(ba, oc);

    float k2 = baba - bard*bard;
    float k1 = baba * dot(oc, rayDir) - baoc * bard;
    float k0 = baba * dot(oc, oc) - baoc * baoc - radius * radius * baba;

    float h = k1 * k1 - k2 * k0;
    if (h < 0.0) return false;

    bool topCap = (vCap > 0.9 && vCap < 1.1) || vCap >= 2.9;
    bool bottomCap = (vCap > 1.9 && vCap < 2.1) || vCap >= 2.9;

    // body outside
    h = sqrt(h);
    float t = (-k1 - h) / k2;
    float y = baoc + t * bard;
    if (y > 0.0 && y < baba) {
        interior = false;
        intersection = vec4(t, (oc + t * rayDir - ba * y / baba) / radius);
        return true;
    }

    if (topCap && y < 0.0) {
        // top cap
        t = -baoc / bard;
        if (abs(k1 + k2 * t) < h) {
            interior = false;
            intersection = vec4(t, ba * sign(y) / baba);
            return true;
        }
    } else if(bottomCap && y >= 0.0) {
        // bottom cap
        t = (baba - baoc) / bard;
        if (abs(k1 + k2 * t) < h) {
            interior = false;
            intersection = vec4(t, ba * sign(y) / baba);
            return true;
        }
    }

    #ifdef dDoubleSided
        // body inside
        h = -h;
        t = (-k1 - h) / k2;
        y = baoc + t * bard;
        if (y > 0.0 && y < baba) {
            interior = true;
            intersection = vec4(t, (oc + t * rayDir - ba * y / baba) / radius);
            return true;
        }

        // TODO: handle inside caps???
    #endif

    return false;
}

void main() {
    #include clip_pixel

    vec3 rayDir = mix(normalize(vModelPosition - uCameraPosition), uCameraDir, uIsOrtho);

    vec4 intersection;
    bool interior;
    bool hit = CylinderImpostor(vModelPosition, rayDir, vStart, vEnd, vSize, intersection, interior);
    if (!hit) discard;

    vec3 vViewPosition = vModelPosition + intersection.x * rayDir;
    vViewPosition = (uView * vec4(vViewPosition, 1.0)).xyz;
    gl_FragDepthEXT = calcDepth(vViewPosition);

    // bugfix (mac only?)
    if (gl_FragDepthEXT < 0.0) discard;
    if (gl_FragDepthEXT > 1.0) discard;

    float fragmentDepth = gl_FragDepthEXT;
    #include assign_material_color

    #if defined(dRenderVariant_pick)
        #include check_picking_alpha
        gl_FragColor = material;
    #elif defined(dRenderVariant_depth)
        gl_FragColor = material;
    #elif defined(dRenderVariant_color)
        #ifdef dIgnoreLight
            gl_FragColor = material;
        #else
            mat3 normalMatrix = transpose3(inverse3(mat3(uView)));
            vec3 normal = normalize(normalMatrix * -normalize(intersection.yzw));
            #include apply_light_color
        #endif

        #include apply_interior_color
        #include apply_marker_color
        #include apply_fog
        #include wboit_write
    #endif
}
`,$ie=`
precision highp float;
precision highp int;

#include common
#include read_from_texture
#include common_vert_params
#include color_vert_params
#include size_vert_params
#include common_clip

uniform mat4 uModelView;

attribute vec3 aPosition;
attribute vec2 aMapping;
attribute float aDepth;
attribute vec2 aTexCoord;
attribute mat4 aTransform;
attribute float aInstance;
attribute float aGroup;

uniform float uOffsetX;
uniform float uOffsetY;
uniform float uOffsetZ;

// uniform bool ortho;
uniform float uPixelRatio;
uniform float uViewportHeight;

varying vec2 vTexCoord;

#include matrix_scale

void main(void){
    #include assign_group
    #include assign_color_varying
    #include assign_marker_varying
    #include assign_clipping_varying
    #include assign_size

    vTexCoord = aTexCoord;

    float scale = matrixScale(uModelView);

    float offsetX = uOffsetX * scale;
    float offsetY = uOffsetY * scale;
    float offsetZ = (uOffsetZ + aDepth * 0.95) * scale;

    vec4 position4 = vec4(aPosition, 1.0);
    vec4 mvPosition = uModelView * aTransform * position4;

    vModelPosition = (uModel * aTransform * position4).xyz; // for clipping in frag shader

    // TODO
    // #ifdef FIXED_SIZE
    //     if (ortho) {
    //         scale /= pixelRatio * ((uViewportHeight / 2.0) / -uCameraPosition.z) * 0.1;
    //     } else {
    //         scale /= pixelRatio * ((uViewportHeight / 2.0) / -mvPosition.z) * 0.1;
    //     }
    // #endif

    vec4 mvCorner = vec4(mvPosition.xyz, 1.0);

    if (vTexCoord.x == 10.0) { // indicates background plane
        // move a bit to the back, taking distance to camera into account to avoid z-fighting
        offsetZ -= 0.001 * distance(uCameraPosition, (uProjection * mvCorner).xyz);
    }

    mvCorner.xy += aMapping * size * scale;
    mvCorner.x += offsetX;
    mvCorner.y += offsetY;

    // TODO
    // if(ortho){
    //     mvCorner.xyz += normalize(-uCameraPosition) * offsetZ;
    // } else {
    //     mvCorner.xyz += normalize(-mvCorner.xyz) * offsetZ;
    // }
    mvCorner.xyz += normalize(-mvCorner.xyz) * offsetZ;

    gl_Position = uProjection * mvCorner;

    vViewPosition = -mvCorner.xyz;

    #include clip_instance
}
`,Qie=`
precision highp float;
precision highp int;

#include common
#include common_frag_params
#include color_frag_params
#include common_clip
#include wboit_params

uniform sampler2D tFont;

uniform vec3 uBorderColor;
uniform float uBorderWidth;
uniform vec3 uBackgroundColor;
uniform float uBackgroundOpacity;

varying vec2 vTexCoord;

const float smoothness = 32.0;
const float gamma = 2.2;

void main2(){
    gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);
}

void main(){
    #include clip_pixel

    float fragmentDepth = gl_FragCoord.z;
    bool interior = false;
    #include assign_material_color

    if (vTexCoord.x > 1.0) {
        gl_FragColor = vec4(uBackgroundColor, uBackgroundOpacity * material.a);
    } else {
        // retrieve signed distance
        float sdf = texture2D(tFont, vTexCoord).a + uBorderWidth;

        // perform adaptive anti-aliasing of the edges
        float w = clamp(smoothness * (abs(dFdx(vTexCoord.x)) + abs(dFdy(vTexCoord.y))), 0.0, 0.5);
        float a = smoothstep(0.5 - w, 0.5 + w, sdf);

        // gamma correction for linear attenuation
        a = pow(a, 1.0 / gamma);

        if (a < 0.5) discard;
        material.a *= a;

        // add border
        float t = 0.5 + uBorderWidth;
        if (uBorderWidth > 0.0 && sdf < t) {
            material.xyz = mix(uBorderColor, material.xyz, smoothstep(t - w, t, sdf));
        }

        gl_FragColor = material;
    }

    #if defined(dRenderVariant_pick)
        #include check_picking_alpha
    #elif defined(dRenderVariant_depth)
        gl_FragColor = material;
    #elif defined(dRenderVariant_color)
        #include apply_marker_color
        #include apply_fog
        #include wboit_write
    #endif
}
`,Zie=`
precision highp float;
precision highp int;

#include common
#include read_from_texture
#include common_vert_params
#include color_vert_params
#include size_vert_params
#include common_clip

uniform float uPixelRatio;
uniform float uViewportHeight;

attribute mat4 aTransform;
attribute float aInstance;
attribute float aGroup;

attribute vec2 aMapping;
attribute vec3 aStart;
attribute vec3 aEnd;

void trimSegment(const in vec4 start, inout vec4 end) {
    // trim end segment so it terminates between the camera plane and the near plane
    // conservative estimate of the near plane
    float a = uProjection[2][2];  // 3rd entry in 3rd column
    float b = uProjection[3][2];  // 3rd entry in 4th column
    float nearEstimate = -0.5 * b / a;
    float alpha = (nearEstimate - start.z) / (end.z - start.z);
    end.xyz = mix(start.xyz, end.xyz, alpha);
}

void main(){
    #include assign_group
    #include assign_color_varying
    #include assign_marker_varying
    #include assign_clipping_varying
    #include assign_size

    mat4 modelView = uView * uModel * aTransform;

    // camera space
    vec4 start = modelView * vec4(aStart, 1.0);
    vec4 end = modelView * vec4(aEnd, 1.0);

    // assign position
    vec4 position4 = vec4((aMapping.y < 0.5) ? aStart : aEnd, 1.0);
    vec4 mvPosition = modelView * position4;
    vViewPosition = mvPosition.xyz;

    vModelPosition = (uModel * aTransform * position4).xyz; // for clipping in frag shader

    // special case for perspective projection, and segments that terminate either in, or behind, the camera plane
    // clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
    // but we need to perform ndc-space calculations in the shader, so we must address this issue directly
    // perhaps there is a more elegant solution -- WestLangley
    bool perspective = (uProjection[2][3] == -1.0); // 4th entry in the 3rd column
    if (perspective) {
        if (start.z < 0.0 && end.z >= 0.0) {
            trimSegment(start, end);
        } else if (end.z < 0.0 && start.z >= 0.0) {
            trimSegment(end, start);
        }
    }

    // clip space
    vec4 clipStart = uProjection * start;
    vec4 clipEnd = uProjection * end;

    // ndc space
    vec2 ndcStart = clipStart.xy / clipStart.w;
    vec2 ndcEnd = clipEnd.xy / clipEnd.w;

    // direction
    vec2 dir = ndcEnd - ndcStart;

    // account for clip-space aspect ratio
    dir.x *= uPixelRatio;
    dir = normalize(dir);

    // perpendicular to dir
    vec2 offset = vec2(dir.y, - dir.x);

    // undo aspect ratio adjustment
    dir.x /= uPixelRatio;
    offset.x /= uPixelRatio;

    // sign flip
    if (aMapping.x < 0.0) offset *= -1.0;

    // calculate linewidth
    float linewidth;
    #ifdef dLineSizeAttenuation
        linewidth = size * uPixelRatio * ((uViewportHeight / 2.0) / -start.z) * 5.0;
    #else
        linewidth = size * uPixelRatio;
    #endif

    // adjust for linewidth
    offset *= linewidth;

    // adjust for clip-space to screen-space conversion
    offset /= uViewportHeight;

    // select end
    vec4 clip = (aMapping.y < 0.5) ? clipStart : clipEnd;

    // back to clip space
    offset *= clip.w;
    clip.xy += offset;
    gl_Position = clip;

    #include clip_instance
}
`,Jie=`
precision highp float;
precision highp int;

#include common
#include common_frag_params
#include color_frag_params
#include common_clip
#include wboit_params

void main(){
    #include clip_pixel

    bool interior = false;
    float fragmentDepth = gl_FragCoord.z;
    #include assign_material_color

    #if defined(dRenderVariant_pick)
        #include check_picking_alpha
        gl_FragColor = material;
    #elif defined(dRenderVariant_depth)
        gl_FragColor = material;
    #elif defined(dRenderVariant_color)
        gl_FragColor = material;

        #include apply_marker_color
        #include apply_fog
        #include wboit_write
    #endif
}
`,eoe=`
precision highp float;
precision highp int;
precision highp sampler2D;

#include common
#include read_from_texture
#include common_vert_params
#include color_vert_params
#include common_clip

#if defined(dColorType_grid)
    #include texture3d_from_2d_linear
#endif

#ifdef dGeoTexture
    uniform vec2 uGeoTexDim;
    uniform sampler2D tPosition;
    uniform sampler2D tGroup;
    uniform sampler2D tNormal;
#else
    attribute vec3 aPosition;
    attribute float aGroup;
    attribute vec3 aNormal;
#endif
attribute mat4 aTransform;
attribute float aInstance;

varying vec3 vNormal;

void main(){
    #include assign_group
    #include assign_marker_varying
    #include assign_clipping_varying
    #include assign_position
    #include assign_color_varying
    #include clip_instance

    #ifdef dGeoTexture
        vec3 normal = readFromTexture(tNormal, VertexID, uGeoTexDim).xyz;
    #else
        vec3 normal = aNormal;
    #endif
    mat3 normalMatrix = transpose3(inverse3(mat3(modelView)));
    vec3 transformedNormal = normalize(normalMatrix * normalize(normal));
    #if defined(dFlipSided) && !defined(dDoubleSided) // TODO checking dDoubleSided should not be required, ASR
        transformedNormal = -transformedNormal;
    #endif
    vNormal = transformedNormal;
}
`,toe=`
precision highp float;
precision highp int;

#include common
#include common_frag_params
#include color_frag_params
#include light_frag_params
#include normal_frag_params
#include common_clip
#include wboit_params

void main() {
    #include clip_pixel

    // Workaround for buggy gl_FrontFacing (e.g. on some integrated Intel GPUs)
    #if defined(enabledStandardDerivatives)
        vec3 fdx = dFdx(vViewPosition);
        vec3 fdy = dFdy(vViewPosition);
        vec3 faceNormal = normalize(cross(fdx,fdy));
        bool frontFacing = dot(vNormal, faceNormal) > 0.0;
    #else
        bool frontFacing = dot(vNormal, vViewPosition) < 0.0;
    #endif

    #if defined(dFlipSided)
        interior = frontFacing;
    #else
        interior = !frontFacing;
    #endif

    float fragmentDepth = gl_FragCoord.z;
    #include assign_material_color

    #if defined(dRenderVariant_pick)
        #include check_picking_alpha
        gl_FragColor = material;
    #elif defined(dRenderVariant_depth)
        gl_FragColor = material;
    #elif defined(dRenderVariant_color)
        #ifdef dIgnoreLight
            gl_FragColor = material;
        #else
            #if defined(dFlatShaded) && defined(enabledStandardDerivatives)
                vec3 normal = -faceNormal;
            #else
                vec3 normal = -normalize(vNormal);
                #ifdef dDoubleSided
                    normal = normal * (float(frontFacing) * 2.0 - 1.0);
                #endif
            #endif
            #include apply_light_color
        #endif

        #include apply_interior_color
        #include apply_marker_color
        #include apply_fog
        #include wboit_write
    #endif
}
`,roe=`
precision highp float;

attribute vec3 aPosition;
attribute mat4 aTransform;
attribute float aInstance;

uniform mat4 uModelView;
uniform mat4 uProjection;
uniform vec4 uInvariantBoundingSphere;

varying vec3 vOrigPos;
varying float vInstance;
varying vec4 vBoundingSphere;
varying mat4 vTransform;

uniform vec3 uBboxSize;
uniform vec3 uBboxMin;
uniform vec3 uBboxMax;
uniform vec3 uGridDim;
uniform mat4 uTransform;

uniform mat4 uUnitToCartn;

void main() {
    vec4 unitCoord = vec4(aPosition + vec3(0.5), 1.0);
    vec4 mvPosition = uModelView * aTransform * uUnitToCartn * unitCoord;

    vOrigPos = (aTransform * uUnitToCartn * unitCoord).xyz;
    vInstance = aInstance;
    vBoundingSphere = vec4(
        (aTransform * vec4(uInvariantBoundingSphere.xyz, 1.0)).xyz,
        uInvariantBoundingSphere.w
    );
    vTransform = aTransform;

    gl_Position = uProjection * mvPosition;

    // move z position to near clip plane (but not too close to get precision issues)
    gl_Position.z = gl_Position.w - 0.01;
}
`,noe=`
precision highp float;
precision highp int;

#include common
#include light_frag_params

#if dClipObjectCount != 0
    uniform int uClipObjectType[dClipObjectCount];
    uniform bool uClipObjectInvert[dClipObjectCount];
    uniform vec3 uClipObjectPosition[dClipObjectCount];
    uniform vec4 uClipObjectRotation[dClipObjectCount];
    uniform vec3 uClipObjectScale[dClipObjectCount];
#endif
#include common_clip

#include read_from_texture
#include texture3d_from_1d_trilinear
#include texture3d_from_2d_nearest
#include texture3d_from_2d_linear

uniform mat4 uProjection, uTransform, uModelView, uModel, uView;
uniform vec3 uCameraDir;

uniform sampler2D tDepth;
uniform vec2 uDrawingBufferSize;

varying vec3 vOrigPos;
varying float vInstance;
varying vec4 vBoundingSphere;
varying mat4 vTransform;

uniform mat4 uInvView;
uniform vec2 uIsoValue;
uniform vec3 uGridDim;
uniform vec3 uBboxSize;
uniform sampler2D tTransferTex;
uniform float uTransferScale;
uniform float uStepScale;
uniform float uJumpLength;

uniform int uObjectId;
uniform int uVertexCount;
uniform int uInstanceCount;
uniform int uGroupCount;

uniform vec3 uHighlightColor;
uniform vec3 uSelectColor;
uniform vec2 uMarkerTexDim;
uniform sampler2D tMarker;

uniform float uFogNear;
uniform float uFogFar;
uniform vec3 uFogColor;

uniform float uAlpha;
uniform float uPickingAlphaThreshold;
uniform bool uTransparentBackground;

uniform float uInteriorDarkening;
uniform bool uInteriorColorFlag;
uniform vec3 uInteriorColor;
bool interior;

uniform float uNear;
uniform float uFar;
uniform float uIsOrtho;

uniform vec3 uCellDim;
uniform vec3 uCameraPosition;
uniform mat4 uCartnToUnit;

#if __VERSION__ != 100
    // for webgl1 this is given as a 'define'
    uniform int uMaxSteps;
#endif

#if defined(dGridTexType_2d)
    precision highp sampler2D;
    uniform sampler2D tGridTex;
    uniform vec3 uGridTexDim;
#elif defined(dGridTexType_3d)
    precision highp sampler3D;
    uniform sampler3D tGridTex;
#endif

#if defined(dRenderVariant_color)
    #if defined(dColorType_uniform)
        uniform vec3 uColor;
    #elif defined(dColorType_texture)
        uniform vec2 uColorTexDim;
        uniform sampler2D tColor;
    #endif

    #ifdef dOverpaint
        varying vec4 vOverpaint;
        uniform vec2 uOverpaintTexDim;
        uniform sampler2D tOverpaint;
    #endif
#endif

#if defined(dGridTexType_2d)
    vec4 textureVal(vec3 pos) {
        return texture3dFrom2dLinear(tGridTex, pos + (vec3(0.5, 0.5, 0.0) / uGridDim), uGridDim, uGridTexDim.xy);
    }
    vec4 textureGroup(vec3 pos) {
        return texture3dFrom2dNearest(tGridTex, pos + (vec3(0.5, 0.5, 0.0) / uGridDim), uGridDim, uGridTexDim.xy);
    }
#elif defined(dGridTexType_3d)
    vec4 textureVal(vec3 pos) {
        return texture(tGridTex, pos + (vec3(0.5) / uGridDim));
    }
    vec4 textureGroup(vec3 pos) {
        return texelFetch(tGridTex, ivec3(pos * uGridDim), 0);
    }
#endif

#include wboit_params

vec4 transferFunction(float value) {
    return texture2D(tTransferTex, vec2(value, 0.0));
}

float getDepth(const in vec2 coords) {
    #ifdef depthTextureSupport
        if (!uRenderWboit) {
            // in case of opaque volumes (and depth texture support)
            return texture2D(tDepth, coords).r;
        } else {
            return unpackRGBAToDepth(texture2D(tDepth, coords));
        }
    #else
        return unpackRGBAToDepth(texture2D(tDepth, coords));
    #endif
}

const float gradOffset = 0.5;

vec3 v3m4(vec3 p, mat4 m) {
    return (m * vec4(p, 1.0)).xyz;
}

float preFogAlphaBlended = 0.0;

vec4 raymarch(vec3 startLoc, vec3 step, vec3 rayDir) {
    #if defined(dRenderVariant_color) && !defined(dIgnoreLight)
        mat3 normalMatrix = transpose3(inverse3(mat3(uModelView * vTransform)));
    #endif
    mat4 cartnToUnit = uCartnToUnit * inverse4(vTransform);
    #if defined(dClipVariant_pixel) && dClipObjectCount != 0
        mat4 modelTransform = uModel * vTransform * uTransform;
    #endif
    mat4 modelViewTransform = uModelView * vTransform * uTransform;

    vec3 scaleVol = vec3(1.0) / uGridDim;
    vec3 pos = startLoc;
    vec4 cell;
    float prevValue = -1.0;
    float value = 0.0;
    vec4 src = vec4(0.0);
    vec4 dst = vec4(0.0);
    bool hit = false;
    float fragmentDepth;

    vec3 posMin = vec3(0.0);
    vec3 posMax = vec3(1.0) - vec3(1.0) / uGridDim;

    vec3 unitPos;
    vec3 isoPos;

    vec3 nextPos;
    float nextValue;

    vec3 color = vec3(0.45, 0.55, 0.8);
    vec3 gradient = vec3(1.0);
    vec3 dx = vec3(gradOffset * scaleVol.x, 0.0, 0.0);
    vec3 dy = vec3(0.0, gradOffset * scaleVol.y, 0.0);
    vec3 dz = vec3(0.0, 0.0, gradOffset * scaleVol.z);

    float maxDist = min(vBoundingSphere.w * 2.0, uFar - uNear);
    float maxDistSq = maxDist * maxDist;

    for (int i = 0; i < uMaxSteps; ++i) {
        // break when beyond bounding-sphere or far-plane
        vec3 distVec = startLoc - pos;
        if (dot(distVec, distVec) > maxDistSq) break;

        unitPos = v3m4(pos, cartnToUnit);

        // continue when outside of grid
        if (unitPos.x > posMax.x || unitPos.y > posMax.y || unitPos.z > posMax.z ||
            unitPos.x < posMin.x || unitPos.y < posMin.y || unitPos.z < posMin.z
        ) {
            if (hit) break;
            prevValue = value;
            pos += step;
            continue;
        }

        cell = textureVal(unitPos);
        value = cell.a; // current voxel value

        if (uJumpLength > 0.0 && value < 0.01) {
            nextPos = pos + rayDir * uJumpLength;
            nextValue = textureVal(v3m4(nextPos, cartnToUnit)).a;
            if (nextValue < 0.01) {
                prevValue = nextValue;
                pos = nextPos;
                continue;
            }
        }

        #if defined(dRenderMode_isosurface)
            if (prevValue > 0.0 && ( // there was a prev Value
                (prevValue < uIsoValue.x && value > uIsoValue.x) || // entering isosurface
                (prevValue > uIsoValue.x && value < uIsoValue.x) // leaving isosurface
            )) {
                isoPos = v3m4(mix(pos - step, pos, ((prevValue - uIsoValue.x) / ((prevValue - uIsoValue.x) - (value - uIsoValue.x)))), cartnToUnit);

                vec4 mvPosition = modelViewTransform * vec4(isoPos * uGridDim, 1.0);

                #if defined(dClipVariant_pixel) && dClipObjectCount != 0
                    vec3 vModelPosition = v3m4(isoPos * uGridDim, modelTransform);
                    if (clipTest(vec4(vModelPosition, 0.0), 0)) {
                        prevValue = value;
                        pos += step;
                        continue;
                    }
                #endif

                float depth = calcDepth(mvPosition.xyz);
                if (depth > getDepth(gl_FragCoord.xy / uDrawingBufferSize))
                    break;

                #ifdef enabledFragDepth
                    if (!hit) {
                        gl_FragDepthEXT = depth;
                    }
                #endif

                #if defined(dRenderVariant_pickObject)
                    return vec4(encodeFloatRGB(float(uObjectId)), 1.0);
                #elif defined(dRenderVariant_pickInstance)
                    return vec4(encodeFloatRGB(vInstance), 1.0);
                #elif defined(dRenderVariant_pickGroup)
                    #ifdef dPackedGroup
                        return vec4(textureGroup(floor(isoPos * uGridDim + 0.5) / uGridDim).rgb, 1.0);
                    #else
                        vec3 g = floor(isoPos * uGridDim + 0.5);
                        return vec4(encodeFloatRGB(g.z + g.y * uGridDim.z + g.x * uGridDim.z * uGridDim.y), 1.0);
                    #endif
                #elif defined(dRenderVariant_depth)
                    #ifdef enabledFragDepth
                        return packDepthToRGBA(gl_FragDepthEXT);
                    #else
                        return packDepthToRGBA(depth);
                    #endif
                #elif defined(dRenderVariant_color)
                    #ifdef dPackedGroup
                        float group = decodeFloatRGB(textureGroup(floor(isoPos * uGridDim + 0.5) / uGridDim).rgb);
                    #else
                        vec3 g = floor(isoPos * uGridDim + 0.5);
                        float group = g.z + g.y * uGridDim.z + g.x * uGridDim.z * uGridDim.y;
                    #endif

                    #if defined(dColorType_uniform)
                        color = uColor;
                    #elif defined(dColorType_instance)
                        color = readFromTexture(tColor, vInstance, uColorTexDim).rgb;
                    #elif defined(dColorType_group)
                        color = readFromTexture(tColor, group, uColorTexDim).rgb;
                    #elif defined(dColorType_groupInstance)
                        color = readFromTexture(tColor, vInstance * float(uGroupCount) + group, uColorTexDim).rgb;
                    #elif defined(dColorType_vertex)
                        color = texture3dFrom1dTrilinear(tColor, isoPos, uGridDim, uColorTexDim, 0.0).rgb;
                    #elif defined(dColorType_vertexInstance)
                        color = texture3dFrom1dTrilinear(tColor, isoPos, uGridDim, uColorTexDim, vInstance * float(uVertexCount)).rgb;
                    #endif

                    // handle flipping and negative isosurfaces
                    #ifdef dFlipSided
                        bool flipped = value < uIsoValue.y; // flipped
                    #else
                        bool flipped = value > uIsoValue.y;
                    #endif
                    interior = value < uIsoValue.x && flipped;
                    #ifndef dDoubleSided
                        if (interior) {
                            prevValue = value;
                            pos += step;
                            continue;
                        }
                    #endif
                    vec3 vViewPosition = mvPosition.xyz;
                    vec4 material = vec4(color, uAlpha);

                    #ifdef dIgnoreLight
                        gl_FragColor = material;
                    #else
                        #if defined(dFlatShaded)
                            // nearest grid point
                            isoPos = floor(isoPos * uGridDim + 0.5) / uGridDim;
                        #endif
                        #ifdef dPackedGroup
                            // compute gradient by central differences
                            gradient.x = textureVal(isoPos - dx).a - textureVal(isoPos + dx).a;
                            gradient.y = textureVal(isoPos - dy).a - textureVal(isoPos + dy).a;
                            gradient.z = textureVal(isoPos - dz).a - textureVal(isoPos + dz).a;
                        #else
                            gradient = textureVal(isoPos).xyz * 2.0 - 1.0;
                        #endif
                        vec3 normal = -normalize(normalMatrix * normalize(gradient));
                        normal = normal * (float(flipped) * 2.0 - 1.0);
                        normal = normal * -(float(interior) * 2.0 - 1.0);
                        #include apply_light_color
                    #endif

                    float vMarker = readFromTexture(tMarker, vInstance * float(uGroupCount) + group, uMarkerTexDim).a;
                    #include apply_interior_color
                    #include apply_marker_color

                    preFogAlphaBlended = (1.0 - preFogAlphaBlended) * gl_FragColor.a + preFogAlphaBlended;
                    fragmentDepth = depth;
                    #include apply_fog

                    src = gl_FragColor;

                    if (!uTransparentBackground) {
                        // done in 'apply_fog' otherwise
                        src.rgb *= src.a;
                    }
                    dst = (1.0 - dst.a) * src + dst; // standard blending
                #endif

                #ifdef dSingleLayer
                    break;
                #endif

                hit = true;
            }
            prevValue = value;
        #elif defined(dRenderMode_volume)
            vec4 mvPosition = modelViewTransform * vec4(unitPos * uGridDim, 1.0);
            if (calcDepth(mvPosition.xyz) > getDepth(gl_FragCoord.xy / uDrawingBufferSize))
                break;

            #if defined(dClipVariant_pixel) && dClipObjectCount != 0
                vec3 vModelPosition = v3m4(unitPos * uGridDim, modelTransform);
                if (clipTest(vec4(vModelPosition, 0.0), 0)) {
                    prevValue = value;
                    pos += step;
                    continue;
                }
            #endif

            #if defined(dRenderVariant_color)
                vec3 vViewPosition = mvPosition.xyz;
                vec4 material = transferFunction(value);

                #ifdef dIgnoreLight
                    gl_FragColor.rgb = material.rgb;
                #else
                    if (material.a >= 0.01) {
                        #ifdef dPackedGroup
                            // compute gradient by central differences
                            gradient.x = textureVal(unitPos - dx).a - textureVal(unitPos + dx).a;
                            gradient.y = textureVal(unitPos - dy).a - textureVal(unitPos + dy).a;
                            gradient.z = textureVal(unitPos - dz).a - textureVal(unitPos + dz).a;
                        #else
                            gradient = cell.xyz * 2.0 - 1.0;
                        #endif
                        vec3 normal = -normalize(normalMatrix * normalize(gradient));
                        #include apply_light_color
                    } else {
                        gl_FragColor.rgb = material.rgb;
                    }
                #endif

                gl_FragColor.a = material.a * uAlpha * uTransferScale;

                #ifdef dPackedGroup
                    float group = decodeFloatRGB(textureGroup(floor(unitPos * uGridDim + 0.5) / uGridDim).rgb);
                #else
                    vec3 g = floor(unitPos * uGridDim + 0.5);
                    float group = g.z + g.y * uGridDim.z + g.x * uGridDim.z * uGridDim.y;
                #endif

                float vMarker = readFromTexture(tMarker, vInstance * float(uGroupCount) + group, uMarkerTexDim).a;
                #include apply_marker_color

                preFogAlphaBlended = (1.0 - preFogAlphaBlended) * gl_FragColor.a + preFogAlphaBlended;
                fragmentDepth = calcDepth(mvPosition.xyz);
                #include apply_fog

                src = gl_FragColor;

                if (!uTransparentBackground) {
                    // done in 'apply_fog' otherwise
                    src.rgb *= src.a;
                }
                dst = (1.0 - dst.a) * src + dst; // standard blending
            #endif
        #endif

        // break if the color is opaque enough
        if (dst.a > 0.95)
            break;

        pos += step;
    }

    #if defined(dRenderMode_isosurface) && defined(enabledFragDepth)
        // ensure depth is written everywhere
        if (!hit)
            gl_FragDepthEXT = 1.0;
    #endif

    return dst;
}

// TODO: support float texture for higher precision values???
// TODO: support clipping exclusion texture support

void main() {
    if (gl_FrontFacing)
        discard;

    #if defined(dRenderVariant_pick) || defined(dRenderVariant_depth)
        #if defined(dRenderMode_volume)
            // always ignore pick & depth for volume
            discard;
        #elif defined(dRenderMode_isosurface)
            if (uAlpha < uPickingAlphaThreshold)
                discard; // ignore so the element below can be picked
        #endif
    #endif

    vec3 rayDir = mix(normalize(vOrigPos - uCameraPosition), uCameraDir, uIsOrtho);
    vec3 step = rayDir * uStepScale;

    float boundingSphereNear = distance(vBoundingSphere.xyz, uCameraPosition) - vBoundingSphere.w;
    float d = max(uNear, boundingSphereNear) - mix(0.0, distance(vOrigPos, uCameraPosition), uIsOrtho);
    vec3 start = mix(uCameraPosition, vOrigPos, uIsOrtho) + (d * rayDir);
    gl_FragColor = raymarch(start, step, rayDir);

    #if defined(dRenderVariant_pick) || defined(dRenderVariant_depth)
        // discard when nothing was hit
        if (gl_FragColor == vec4(0.0))
            discard;
    #endif

    #if defined(dRenderVariant_color)
        #if defined(dRenderMode_isosurface) && defined(enabledFragDepth)
            float fragmentDepth = gl_FragDepthEXT;
        #else
            float fragmentDepth = calcDepth((uModelView * vec4(start, 1.0)).xyz);
        #endif
        float preFogAlpha = clamp(preFogAlphaBlended, 0.0, 1.0);
        interior = false;
        #include wboit_write
    #endif
}
`,aoe=`
precision highp float;
precision highp int;

#include common
#include common_vert_params

attribute vec3 aPosition;
attribute vec2 aUv;
attribute mat4 aTransform;
attribute float aInstance;

varying vec2 vUv;
varying float vInstance;

void main() {
    #include assign_position

    vUv = aUv;
    vInstance = aInstance;
}
`,ioe=`
precision highp float;
precision highp int;

#include common
#include read_from_texture
#include common_frag_params
#include common_clip
#include wboit_params

uniform vec2 uImageTexDim;
uniform sampler2D tImageTex;
uniform sampler2D tGroupTex;

uniform vec2 uMarkerTexDim;
uniform sampler2D tMarker;

varying vec2 vUv;
varying float vInstance;

#if defined(dInterpolation_catmulrom) || defined(dInterpolation_mitchell) || defined(dInterpolation_bspline)
    #define dInterpolation_cubic
#endif

#if defined(dInterpolation_cubic)
    #if defined(dInterpolation_catmulrom) || defined(dInterpolation_mitchell)
        #if defined(dInterpolation_catmulrom)
            const float B = 0.0;
            const float C = 0.5;
        #elif defined(dInterpolation_mitchell)
            const float B = 0.333;
            const float C = 0.333;
        #endif

        float cubicFilter(float x){
            float f = x;
            if (f < 0.0) {
                f = -f;
            }
            if (f < 1.0) {
                return ((12.0 - 9.0 * B - 6.0 * C) * (f * f * f) +
                    (-18.0 + 12.0 * B + 6.0 * C) * (f * f) +
                    (6.0 - 2.0 * B)) / 6.0;
            }else if (f >= 1.0 && f < 2.0){
                return ((-B - 6.0 * C) * ( f * f * f)
                    + (6.0 * B + 30.0 * C) * (f * f) +
                    (-(12.0 * B) - 48.0 * C) * f +
                    8.0 * B + 24.0 * C) / 6.0;
            }else{
                return 0.0;
            }
        }
    #elif defined(dInterpolation_bspline)
        float cubicFilter(float x) {
            float f = x;
            if (f < 0.0) {
                f = -f;
            }
            if (f >= 0.0 && f <= 1.0){
                return (2.0 / 3.0) + (0.5) * (f * f * f) - (f * f);
            } else if (f > 1.0 && f <= 2.0) {
                return 1.0 / 6.0 * pow((2.0 - f), 3.0);
            }
            return 1.0;
        }
    #endif

    vec4 biCubic(sampler2D tex, vec2 texCoord) {
        vec2 texelSize = 1.0 / uImageTexDim;
        texCoord -= texelSize / 2.0;
        vec4 nSum = vec4(0.0);
        float nDenom = 0.0;
        vec2 cell = fract(texCoord * uImageTexDim);
        for (float m = -1.0; m <= 2.0; ++m) {
            for (float n = -1.0; n <= 2.0; ++n) {
                vec4 vecData = texture2D(tex, texCoord + texelSize * vec2(m, n));
                float c = cubicFilter(m - cell.x) * cubicFilter(-n + cell.y);
                nSum += vecData * c;
                nDenom += c;
            }
        }
        return nSum / nDenom;
    }
#endif

void main() {
    #include clip_pixel

    #if defined(dInterpolation_cubic)
        vec4 imageData = biCubic(tImageTex, vUv);
    #else
        vec4 imageData = texture2D(tImageTex, vUv);
    #endif
    imageData.a = clamp(imageData.a, 0.0, 1.0);
    if (imageData.a > 0.9) imageData.a = 1.0;

    float fragmentDepth = gl_FragCoord.z;
    bool interior = false;

    #if defined(dRenderVariant_pick)
        if (imageData.a < 0.3)
            discard;

        #if defined(dRenderVariant_pickObject)
            gl_FragColor = vec4(encodeFloatRGB(float(uObjectId)), 1.0);
        #elif defined(dRenderVariant_pickInstance)
            gl_FragColor = vec4(encodeFloatRGB(vInstance), 1.0);
        #elif defined(dRenderVariant_pickGroup)
            gl_FragColor = vec4(texture2D(tGroupTex, vUv).rgb, 1.0);
        #endif
    #elif defined(dRenderVariant_depth)
        if (imageData.a < 0.05)
            discard;

        gl_FragColor = packDepthToRGBA(gl_FragCoord.z);
    #elif defined(dRenderVariant_color)
        if (imageData.a < 0.05)
            discard;

        gl_FragColor = imageData;
        gl_FragColor.a *= uAlpha;

        float group = decodeFloatRGB(texture2D(tGroupTex, vUv).rgb);
        float vMarker = readFromTexture(tMarker, vInstance * float(uGroupCount) + group, uMarkerTexDim).a;

        #include apply_marker_color
        #include apply_fog
        #include wboit_write
    #endif
}
`,zO=ti(),ooe={apply_fog:fie,apply_interior_color:pie,apply_light_color:hie,apply_marker_color:vie,assign_clipping_varying:mie,assign_color_varying:gie,assign_group:yie,assign_marker_varying:bie,assign_material_color:Sie,assign_position:xie,assign_size:Cie,check_picking_alpha:_ie,clip_instance:wie,clip_pixel:Aie,color_frag_params:Pie,color_vert_params:Tie,common_clip:Eie,common_frag_params:Iie,common_vert_params:Mie,common:Die,float_to_rgba:Rie,light_frag_params:Oie,matrix_scale:Fie,normal_frag_params:kie,read_from_texture:Bie,rgba_to_float:Lie,size_vert_params:Nie,texture3d_from_1d_trilinear:Uie,texture3d_from_2d_linear:zie,texture3d_from_2d_nearest:Vie,wboit_params:Hie,wboit_write:Gie},soe=/^(?!\/\/)\s*#include\s+(\S+)/gmi,uoe=/[ \t]*\/\/.*\n/g,loe=/[ \t]*\/\*[\s\S]*?\*\//g,coe=/\n{2,}/g;function JT(e){return e.replace(soe,function(t,r){var n=ooe[r];if(!n)throw new Error("empty chunk, '"+r+"'");return n}).trim().replace(uoe,`
`).replace(loe,`
`).replace(coe,`
`)}function _n(e,t,r,n,a){return n===void 0&&(n={}),a===void 0&&(a={}),{id:zO(),name:e,vert:JT(t),frag:JT(r),extensions:n,outTypes:a}}var doe=_n("points",qie,jie,{drawBuffers:"optional"}),foe=_n("spheres",Wie,Xie,{fragDepth:"required",drawBuffers:"optional"}),poe=_n("cylinders",Yie,Kie,{fragDepth:"required",drawBuffers:"optional"}),hoe=_n("text",$ie,Qie,{standardDerivatives:"required",drawBuffers:"optional"}),voe=_n("lines",Zie,Jie,{drawBuffers:"optional"}),VO=_n("mesh",eoe,toe,{standardDerivatives:"optional",drawBuffers:"optional"}),moe=_n("direct-volume",roe,noe,{fragDepth:"optional",drawBuffers:"optional"}),goe=_n("image",aoe,ioe,{drawBuffers:"optional"});function yoe(e){if(e===void 0)return"";var t=[];for(var r in e){var n=e[r],a=n.ref.value;if(a!==void 0)if(typeof a=="string")t.push("#define "+r+"_"+a);else if(typeof a=="number")t.push("#define "+r+" "+a);else if(typeof a=="boolean")a&&t.push("#define "+r);else throw new Error("unknown define type")}return t.join(`
`)+`
`}function boe(e,t){var r=[];if(t.standardDerivatives&&(r.push("#extension GL_OES_standard_derivatives : enable"),r.push("#define enabledStandardDerivatives")),t.fragDepth){if(e.fragDepth)r.push("#extension GL_EXT_frag_depth : enable"),r.push("#define enabledFragDepth");else if(t.fragDepth==="required")throw new Error("required 'GL_EXT_frag_depth' extension not available")}if(t.drawBuffers){if(e.drawBuffers)r.push("#extension GL_EXT_draw_buffers : require"),r.push("#define requiredDrawBuffers"),r.push("#define gl_FragColor gl_FragData[0]");else if(t.drawBuffers==="required")throw new Error("required 'GL_EXT_draw_buffers' extension not available")}if(t.shaderTextureLod){if(e.shaderTextureLod)r.push("#extension GL_EXT_shader_texture_lod : enable"),r.push("#define enabledShaderTextureLod");else if(t.shaderTextureLod==="required")throw new Error("required 'GL_EXT_shader_texture_lod' extension not available")}return e.depthTexture&&r.push("#define depthTextureSupport"),r.join(`
`)+`
`}var Soe=`#version 300 es
#define attribute in
#define varying out
#define texture2D texture
`,xoe=`
#define varying in
#define texture2D texture
#define texture2DLodEXT textureLod

#define gl_FragColor out_FragData0
#define gl_FragDepthEXT gl_FragDepth

#define depthTextureSupport
`;function Coe(e,t,r,n){var a=["#version 300 es","layout(location = 0) out highp "+(n[0]||"vec4")+" out_FragData0;"];if(r.standardDerivatives&&a.push("#define enabledStandardDerivatives"),r.fragDepth&&a.push("#define enabledFragDepth"),r.drawBuffers){a.push("#define requiredDrawBuffers");for(var i=e.getParameter(e.MAX_DRAW_BUFFERS),o=1,s=i;o<s;++o)a.push("layout(location = "+o+") out highp "+(n[o]||"vec4")+" out_FragData"+o+";")}return r.shaderTextureLod&&a.push("#define enabledShaderTextureLod"),a.push(xoe),a.join(`
`)+`
`}function _oe(e){return e.replace(/gl_FragData\[([0-9]+)\]/g,"out_FragData$1")}function woe(e,t,r,n){var a=yoe(r),i=_r(e)?Soe:"",o=_r(e)?Coe(e,t,n.extensions,n.outTypes):boe(t,n.extensions),s=_r(e)?_oe(n.frag):n.frag;return{id:zO(),name:n.name,vert:""+i+a+n.vert,frag:""+o+a+s,extensions:n.extensions,outTypes:n.outTypes}}function Aoe(e,t){switch(t){case"b":case"b[]":return e.BOOL;case"f":case"f[]":return e.FLOAT;case"i":case"i[]":return e.INT;case"v2":case"v2[]":return e.FLOAT_VEC2;case"v3":case"v3[]":return e.FLOAT_VEC3;case"v4":case"v4[]":return e.FLOAT_VEC4;case"m3":case"m3[]":return e.FLOAT_MAT3;case"m4":case"m4[]":return e.FLOAT_MAT4;default:console.error("unknown uniform kind '"+t+"'")}}function Poe(e,t,r){e.uniform1f(t,r)}function Toe(e,t,r){e.uniform1fv(t,r)}function Eoe(e,t,r){e.uniform1i(t,r)}function Ioe(e,t,r){e.uniform1iv(t,r)}function Moe(e,t,r){e.uniform2fv(t,r)}function Doe(e,t,r){e.uniform3fv(t,r)}function Roe(e,t,r){e.uniform4fv(t,r)}function Ooe(e,t,r){e.uniformMatrix3fv(t,!1,r)}function Foe(e,t,r){e.uniformMatrix4fv(t,!1,r)}function eE(e){switch(e){case"f":return Poe;case"f[]":return Toe;case"i":case"t":case"b":return Eoe;case"i[]":case"t[]":case"b[]":return Ioe;case"v2":case"v2[]":return Moe;case"v3":case"v3[]":return Doe;case"v4":case"v4[]":return Roe;case"m3":case"m3[]":return Ooe;case"m4":case"m4[]":return Foe}}function koe(e){var t={};return Object.keys(e).forEach(function(r){var n=e[r];n.type==="uniform"?t[r]=eE(n.kind):n.type==="texture"&&(t[r]=eE("t"))}),t}function Boe(e){var t={};return Object.keys(e).forEach(function(r){t[r]=k.create(hc(e[r].ref.value))}),t}var Loe=ti();function Noe(e,t){switch(t){case"static":return e.STATIC_DRAW;case"dynamic":return e.DYNAMIC_DRAW;case"stream":return e.STREAM_DRAW}}function Uoe(e,t){if(t instanceof Uint8Array)return e.UNSIGNED_BYTE;if(t instanceof Int8Array)return e.BYTE;if(t instanceof Uint16Array)return e.UNSIGNED_SHORT;if(t instanceof Int16Array)return e.SHORT;if(t instanceof Uint32Array)return e.UNSIGNED_INT;if(t instanceof Int32Array)return e.INT;if(t instanceof Float32Array)return e.FLOAT;throw new Error("Should nevver happen")}function zoe(e,t){switch(t){case"attribute":return e.ARRAY_BUFFER;case"elements":return e.ELEMENT_ARRAY_BUFFER;case"uniform":return e.UNIFORM_BUFFER}}function tE(e){var t=e.createBuffer();if(t===null)throw new Error("Could not create WebGL buffer");return t}function HO(e,t,r,n){var a=tE(e),i=Noe(e,r),o=zoe(e,n),s=Uoe(e,t),u=t.BYTES_PER_ELEMENT,l=t.length;function c(f){e.bindBuffer(o,a),e.bufferData(o,f,i)}c(t);var d=!1;return{id:Loe(),_usageHint:i,_bufferType:o,_dataType:s,_bpe:u,length:l,getBuffer:function(){return a},updateData:c,updateSubData:function(f,p,h){e.bindBuffer(o,a),h-p===f.length?e.bufferSubData(o,0,f):e.bufferSubData(o,p*u,f.subarray(p,p+h))},reset:function(){a=tE(e),c(t)},destroy:function(){d||(e.deleteBuffer(a),d=!0)}}}function Voe(e,t,r){switch(t){case"int32":switch(r){case 1:return e.INT;case 2:return e.INT_VEC2;case 3:return e.INT_VEC3;case 4:return e.INT_VEC4}break;case"float32":switch(r){case 1:return e.FLOAT;case 2:return e.FLOAT_VEC2;case 3:return e.FLOAT_VEC3;case 4:return e.FLOAT_VEC4;case 16:return e.FLOAT_MAT4}break}throw new Error("unknown attribute type for kind '"+t+"' and itemSize '"+r+"'")}function Hoe(e,t,r,n,a,i){i===void 0&&(i="dynamic");var o=t.instancedArrays,s=HO(e,r,i,"attribute"),u=s._bufferType,l=s._dataType,c=s._bpe;return w(w({},s),{bind:function(d){if(e.bindBuffer(u,s.getBuffer()),n===16)for(var f=0;f<4;++f)e.enableVertexAttribArray(d+f),e.vertexAttribPointer(d+f,4,l,!1,4*4*c,f*4*c),o.vertexAttribDivisor(d+f,a);else e.enableVertexAttribArray(d),e.vertexAttribPointer(d,n,l,!1,0,0),o.vertexAttribDivisor(d,a)}})}function Goe(e,t,r){var n=[];return Object.keys(t).forEach(function(a){var i=t[a];i.type==="attribute"&&(n[n.length]=[a,e.resources.attribute(r[a].ref.value,i.itemSize,i.divisor)])}),n}function qoe(e,t,r){r===void 0&&(r="static");var n=HO(e,t,r,"elements");return w(w({},n),{bind:function(){e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n.getBuffer())}})}var joe=ti();function Woe(e,t,r){var n={};return Object.keys(r).forEach(function(a){var i=r[a];if(i.type==="attribute"){var o=e.getAttribLocation(t,a);n[a]=o}else if(i.type==="uniform"||i.type==="texture"){var o=e.getUniformLocation(t,a);n[a]=o}}),n}function Xoe(e,t,r){for(var n=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),a=0;a<n;++a){var i=e.getActiveAttrib(t,a);if(i){var o=i.name,s=i.type;if(o.startsWith("__activeAttribute")||o==="gl_InstanceID"||o==="gl_VertexID")continue;var u=r[o];if(u===void 0)throw new Error("missing 'uniform' or 'texture' with name '"+o+"' in schema");if(u.type!=="attribute")throw new Error("'"+o+"' must be of type 'attribute' but is '"+u.type+"'");var l=Voe(e,u.kind,u.itemSize);if(l!==s)throw new Error("unexpected attribute type for "+o)}}}function Yoe(e,t,r){for(var n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),a=0;a<n;++a){var i=e.getActiveUniform(t,a);if(i){var o=i.name,s=i.type;if(o.startsWith("__activeUniform"))continue;var u=o.replace(/[[0-9]+\]$/,""),l=r[u];if(l===void 0)throw new Error("missing 'uniform' or 'texture' with name '"+o+"' in schema");if(l.type==="uniform"){var c=Aoe(e,l.kind);if(c!==s)throw new Error("unexpected uniform type for "+o)}else if(l.type==="texture"){if(l.kind==="image-float32"||l.kind==="image-uint8"){if(s!==e.SAMPLER_2D)throw new Error("unexpected sampler type for '"+o+"'")}else if((l.kind==="volume-float32"||l.kind==="volume-uint8")&&s!==e.SAMPLER_3D)throw new Error("unexpected sampler type for '"+o+"'")}else throw new Error("'"+o+"' must be of type 'uniform' or 'texture' but is '"+l.type+"'")}}}function Koe(e,t){if(!e.getProgramParameter(t,e.LINK_STATUS))throw new Error(`Could not compile WebGL program. 

`+e.getProgramInfoLog(t))}function qx(e){var t=e.createProgram();if(t===null)throw new Error("Could not create WebGL program");return t}function $oe(e,t,r,n,a){var i=a.defineValues,o=a.shaderCode,s=a.schema,u=qx(e),l=joe(),c=woe(e,r,i,o),d=n("vert",c.vert),f=n("frag",c.frag),p,h;function v(){d.attach(u),f.attach(u),e.linkProgram(u),Ir&&Koe(e,u),p=Woe(e,u,s),h=koe(s),Ir&&(Xoe(e,u,s),Yoe(e,u,s))}v();var m=!1;return{id:l,use:function(){t.currentProgramId=l,e.useProgram(u)},setUniforms:function(g){for(var y=0,b=g.length;y<b;++y){var x=g[y],S=x[0],_=x[1];if(_){var A=p[S];A!==null&&h[S](e,A,_.ref.value)}}},bindAttributes:function(g){for(var y=0,b=g.length;y<b;++y){var x=g[y],S=x[0],_=x[1],A=p[S];A!==-1&&_.bind(A)}},bindTextures:function(g,y){for(var b=0,x=g.length;b<x;++b){var S=g[b],_=S[0],A=S[1],T=p[_];T!=null&&(A.bind(b+y),h[_](e,T,b+y))}},reset:function(){u=qx(e),v()},destroy:function(){m||(d.destroy(),f.destroy(),e.deleteProgram(u),m=!0)}}}var Qoe=ti();function Zoe(e){for(var t=e.split(`
`),r=0;r<t.length;++r)t[r]=r+1+": "+t[r];return t.join(`
`)}function Tg(e,t){var r=t.type,n=t.source,a=e.createShader(r==="vert"?e.VERTEX_SHADER:e.FRAGMENT_SHADER);if(a===null)throw new Error("Error creating "+r+" shader");if(e.shaderSource(a,n),e.compileShader(a),Ir&&e.getShaderParameter(a,e.COMPILE_STATUS)===!1)throw console.warn("'"+r+"' shader info log '"+e.getShaderInfoLog(a)+`'
`+Zoe(n)),new Error("Error compiling "+r+" shader");return a}function Joe(e,t){var r=Tg(e,t);return{id:Qoe(),attach:function(n){e.attachShader(n,r)},reset:function(){r=Tg(e,t)},destroy:function(){e.deleteShader(r)}}}function ese(e,t){return t===void 0&&(t=0),{value:e,usageCount:t}}function tse(e){return{free:function(){e.usageCount-=1},value:e.value}}function rE(e,t,r){var n=new Map;return{get:function(a){var i=e(a),o=n.get(i);return o||(o=ese(t(a)),n.set(i,o)),o.usageCount+=1,tse(o)},clear:function(){n.forEach(function(a,i){a.usageCount<=0&&(a.usageCount<0&&console.warn("Reference usageCount below zero."),r(a.value),n.delete(i))})},get count(){return n.size},dispose:function(){n.forEach(function(a){return r(a.value)}),n.clear()}}}var rse=ti();function nse(e,t){switch(t){case"depth16":return e.DEPTH_COMPONENT16;case"stencil8":return e.STENCIL_INDEX8;case"rgba4":return e.RGBA4;case"depth-stencil":return e.DEPTH_STENCIL;case"depth32f":if(_r(e))return e.DEPTH_COMPONENT32F;throw new Error("WebGL2 needed for `depth32f` renderbuffer format")}}function ase(e,t){switch(t){case"depth":return e.DEPTH_ATTACHMENT;case"stencil":return e.STENCIL_ATTACHMENT;case"depth-stencil":return e.DEPTH_STENCIL_ATTACHMENT;case"color0":return e.COLOR_ATTACHMENT0}}function nE(e){var t=e.createRenderbuffer();if(t===null)throw new Error("Could not create WebGL renderbuffer");return t}function ise(e,t,r,n,a){var i=nE(e),o=function(){return e.bindRenderbuffer(e.RENDERBUFFER,i)},s=nse(e,t),u=ase(e,r);function l(){o(),e.renderbufferStorage(e.RENDERBUFFER,s,n,a)}l();var c=!1;return{id:rse(),bind:o,attachFramebuffer:function(d){d.bind(),o(),e.framebufferRenderbuffer(e.FRAMEBUFFER,u,e.RENDERBUFFER,i),Ir&&b3(e)},setSize:function(d,f){n=d,a=f,l()},reset:function(){i=nE(e),l()},destroy:function(){c||(e.deleteRenderbuffer(i),c=!0)}}}var ose=ti();function aE(e){var t=e.vertexArrayObject;if(!t)throw new Error("VertexArrayObject not supported");var r=t.createVertexArray();if(!r)throw new Error("Could not create WebGL vertex array");return r}function iE(e){var t=e.vertexArrayObject;if(t===null)throw new Error("VertexArrayObject not supported");return t}function sse(e,t,r,n){var a=ose(),i=aE(e),o=iE(e);function s(){o.bindVertexArray(i),n&&n.bind(),t.bindAttributes(r),o.bindVertexArray(null)}s();var u=!1;return{id:a,bind:function(){o.bindVertexArray(i)},update:s,reset:function(){i=aE(e),o=iE(e),s()},destroy:function(){u||(o.deleteVertexArray(i),u=!0)}}}function use(e){return typeof e=="boolean"?e?1:0:typeof e=="number"?e*1e4:A_(e)}function oE(e){var t=w(w({},e.value),{destroy:function(){e.free()}});return t}function lse(e,t,r,n){var a={attribute:new Set,elements:new Set,framebuffer:new Set,program:new Set,renderbuffer:new Set,shader:new Set,texture:new Set,vertexArray:new Set};function i(l,c){return a[l].add(c),r.resourceCounts[l]+=1,w(w({},c),{destroy:function(){c.destroy(),a[l].delete(c),r.resourceCounts[l]-=1}})}var o=rE(function(l){return JSON.stringify(l)},function(l){return i("shader",Joe(e,l))},function(l){l.destroy()});function s(l,c){return oE(o.get({type:l,source:c}))}var u=rE(function(l){var c=[l.shaderCode.id];return Object.keys(l.defineValues).forEach(function(d){return c.push(A_(d),use(l.defineValues[d].ref.value))}),Ja(c).toString()},function(l){return i("program",$oe(e,t,n,s,l))},function(l){l.destroy()});return{attribute:function(l,c,d,f){return i("attribute",Hoe(e,n,l,c,d,f))},elements:function(l,c){return i("elements",qoe(e,l,c))},framebuffer:function(){return i("framebuffer",lie(e))},program:function(l,c,d){return oE(u.get({defineValues:l,shaderCode:c,schema:d}))},renderbuffer:function(l,c,d,f){return i("renderbuffer",ise(e,l,c,d,f))},shader:s,texture:function(l,c,d,f){return i("texture",Wx(e,n,l,c,d,f))},vertexArray:function(l,c,d){return i("vertexArray",sse(n,l,c,d))},getByteCounts:function(){var l=0;a.texture.forEach(function(f){l+=f.getByteCount()});var c=0;a.attribute.forEach(function(f){c+=f.length*4});var d=0;return a.elements.forEach(function(f){d+=f.length*4}),{texture:l,attribute:c,elements:d}},reset:function(){a.attribute.forEach(function(l){return l.reset()}),a.elements.forEach(function(l){return l.reset()}),a.framebuffer.forEach(function(l){return l.reset()}),a.renderbuffer.forEach(function(l){return l.reset()}),a.shader.forEach(function(l){return l.reset()}),a.program.forEach(function(l){return l.reset()}),a.vertexArray.forEach(function(l){return l.reset()}),a.texture.forEach(function(l){return l.reset()})},destroy:function(){a.attribute.forEach(function(l){return l.destroy()}),a.elements.forEach(function(l){return l.destroy()}),a.framebuffer.forEach(function(l){return l.destroy()}),a.renderbuffer.forEach(function(l){return l.destroy()}),a.shader.forEach(function(l){return l.destroy()}),a.program.forEach(function(l){return l.destroy()}),a.vertexArray.forEach(function(l){return l.destroy()}),a.texture.forEach(function(l){return l.destroy()}),o.clear(),u.clear()}}}var GO=ti();function cse(e,t,r,n,a,i,o){a===void 0&&(a=!0),i===void 0&&(i="uint8"),o===void 0&&(o="nearest");var s=t.framebuffer(),u=i==="fp16"?t.texture("image-float16","rgba","fp16",o):i==="float32"?t.texture("image-float32","rgba","float",o):t.texture("image-uint8","rgba","ubyte",o),l=a?_r(e)?t.renderbuffer("depth32f","depth",r,n):t.renderbuffer("depth16","depth",r,n):null;function c(){u.define(r,n),u.attachFramebuffer(s,"color0"),l&&l.attachFramebuffer(s)}c();var d=!1;return{id:GO(),texture:u,framebuffer:s,getWidth:function(){return r},getHeight:function(){return n},bind:function(){s.bind()},setSize:function(f,p){r===f&&n===p||(r=f,n=p,u.define(r,n),l&&l.setSize(r,n))},reset:function(){c()},destroy:function(){d||(u.destroy(),s.destroy(),l&&l.destroy(),d=!0)}}}function dse(e){return{id:GO(),texture:Jy(e),framebuffer:cie(),getWidth:function(){return 0},getHeight:function(){return 0},bind:function(){e.bindFramebuffer(e.FRAMEBUFFER,null)},setSize:function(){},reset:function(){},destroy:function(){}}}function fse(e,t){function r(a){try{return e.getContext(a,t)}catch{return null}}var n=r("webgl2")||r("webgl")||r("experimental-webgl");return Ir&&console.log("isWebgl2: "+_r(n)),n}function qO(e,t){switch(t){case e.NO_ERROR:return"no error";case e.INVALID_ENUM:return"invalid enum";case e.INVALID_VALUE:return"invalid value";case e.INVALID_OPERATION:return"invalid operation";case e.INVALID_FRAMEBUFFER_OPERATION:return"invalid framebuffer operation";case e.OUT_OF_MEMORY:return"out of memory";case e.CONTEXT_LOST_WEBGL:return"context lost"}return"unknown error"}function jO(e){var t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL error: '"+qO(e,t)+"'")}function pse(e){for(var t=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),r=0;r<t;++r)e.activeTexture(e.TEXTURE0+r),e.bindTexture(e.TEXTURE_2D,null),e.bindTexture(e.TEXTURE_CUBE_MAP,null),_r(e)&&(e.bindTexture(e.TEXTURE_2D_ARRAY,null),e.bindTexture(e.TEXTURE_3D,null));var n=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,n);for(var a=e.getParameter(e.MAX_VERTEX_ATTRIBS),r=0;r<a;++r)e.vertexAttribPointer(r,1,e.FLOAT,!1,0,0);e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),e.bindRenderbuffer(e.RENDERBUFFER,null),Eg(e)}function Eg(e){e.bindFramebuffer(e.FRAMEBUFFER,null)}var WO=new Uint8Array(1*4);function XO(e,t,r){e.getSyncParameter(t,e.SYNC_STATUS)===e.SIGNALED?(e.deleteSync(t),r()):O_.setImmediate(XO,e,t,r)}function YO(e,t){var r=e.fenceSync(e.SYNC_GPU_COMMANDS_COMPLETE,0);r?O_.setImmediate(XO,e,r,t):(console.warn("Could not create a WebGLSync object"),e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,WO),t())}var sE=!1;function hse(e){return new Promise(function(t){_r(e)?YO(e,t):(sE||(console.info("Sync object not supported in WebGL"),sE=!0),KO(e),t())})}function KO(e){e.bindFramebuffer(e.FRAMEBUFFER,null),e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,WO)}function jx(e,t,r,n,a,i){if(Ir&&b3(e),i instanceof Uint8Array)e.readPixels(t,r,n,a,e.RGBA,e.UNSIGNED_BYTE,i);else if(i instanceof Float32Array)e.readPixels(t,r,n,a,e.RGBA,e.FLOAT,i);else if(i instanceof Int32Array&&_r(e))e.readPixels(t,r,n,a,e.RGBA_INTEGER,e.INT,i);else throw new Error("unsupported readPixels buffer type");Ir&&jO(e)}function vse(e){var t=e.drawingBufferWidth,r=e.drawingBufferHeight,n=new Uint8Array(t*r*4);return Eg(e),e.viewport(0,0,t,r),jx(e,0,0,t,r,n),Cd.flipY(Cd.create(n,t,r))}function mse(){return{resourceCounts:{attribute:0,elements:0,framebuffer:0,program:0,renderbuffer:0,shader:0,texture:0,vertexArray:0},drawCount:0,instanceCount:0,instancedDrawCount:0}}function gse(e,t){var r=this;t===void 0&&(t={});var n=ZT(e),a=die(e),i=mse(),o=lse(e,a,i,n),s={maxTextureSize:e.getParameter(e.MAX_TEXTURE_SIZE),max3dTextureSize:_r(e)?e.getParameter(e.MAX_3D_TEXTURE_SIZE):0,maxRenderbufferSize:e.getParameter(e.MAX_RENDERBUFFER_SIZE),maxDrawBuffers:n.drawBuffers?e.getParameter(n.drawBuffers.MAX_DRAW_BUFFERS):0,maxTextureImageUnits:e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS)};if(s.maxVertexTextureImageUnits<8)throw new Error('Need "MAX_VERTEX_TEXTURE_IMAGE_UNITS" >= 8');var u=!1,l=new tc(0),c;if(_r(e)){var d=e.createBuffer(),f=void 0,p=void 0,h=!1,v=function(){e.bindBuffer(e.PIXEL_PACK_BUFFER,d),e.getBufferSubData(e.PIXEL_PACK_BUFFER,0,f),e.bindBuffer(e.PIXEL_PACK_BUFFER,null),h=!1,p(),p=void 0,f=void 0};c=function(g,y,b,x,S){return new Promise(function(_,A){if(h){A("Can not call multiple readPixelsAsync at the same time");return}h=!0,e.bindBuffer(e.PIXEL_PACK_BUFFER,d),e.bufferData(e.PIXEL_PACK_BUFFER,b*x*4,e.STREAM_READ),e.readPixels(g,y,b,x,e.RGBA,e.UNSIGNED_BYTE,0),e.bindBuffer(e.PIXEL_PACK_BUFFER,null),p=_,f=S,YO(e,v)})}}else c=function(g,y,b,x,S){return ce(r,void 0,void 0,function(){return de(this,function(_){return jx(e,g,y,b,x,S),[2]})})};var m=new Set;return{gl:e,isWebGL2:_r(e),get pixelRatio(){var g=typeof window!="undefined"?window.devicePixelRatio:1;return g*(t.pixelScale||1)},extensions:n,state:a,stats:i,resources:o,get maxTextureSize(){return s.maxTextureSize},get max3dTextureSize(){return s.max3dTextureSize},get maxRenderbufferSize(){return s.maxRenderbufferSize},get maxDrawBuffers(){return s.maxDrawBuffers},get maxTextureImageUnits(){return s.maxTextureImageUnits},namedComputeRenderables:Object.create(null),namedFramebuffers:Object.create(null),namedTextures:Object.create(null),get isContextLost(){return u||e.isContextLost()},contextRestored:l,setContextLost:function(){u=!0},handleContextRestored:function(g){Object.assign(n,ZT(e)),a.reset(),a.currentMaterialId=-1,a.currentProgramId=-1,a.currentRenderItemId=-1,o.reset(),m.forEach(function(y){return y.reset()}),g==null||g(),u=!1,l.next(xn())},createRenderTarget:function(g,y,b,x,S){var _=cse(e,o,g,y,b,x,S);return m.add(_),w(w({},_),{destroy:function(){_.destroy(),m.delete(_)}})},unbindFramebuffer:function(){return Eg(e)},readPixels:function(g,y,b,x,S){jx(e,g,y,b,x,S)},readPixelsAsync:c,waitForGpuCommandsComplete:function(){return hse(e)},waitForGpuCommandsCompleteSync:function(){return KO(e)},getDrawingBufferPixelData:function(){return vse(e)},clear:function(g,y,b,x){Eg(e),a.enable(e.SCISSOR_TEST),a.depthMask(!0),a.colorMask(!0,!0,!0,!0),a.clearColor(g,y,b,x),e.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight),e.scissor(0,0,e.drawingBufferWidth,e.drawingBufferHeight),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT)},destroy:function(g){var y;o.destroy(),pse(e),g!=null&&g.doNotForceWebGLContextLoss||(y=e.getExtension("WEBGL_lose_context"))===null||y===void 0||y.loseContext()}}}function _r(e){return typeof WebGL2RenderingContext!="undefined"&&e instanceof WebGL2RenderingContext}function yse(e){if(_r(e))return{drawArraysInstanced:e.drawArraysInstanced.bind(e),drawElementsInstanced:e.drawElementsInstanced.bind(e),vertexAttribDivisor:e.vertexAttribDivisor.bind(e),VERTEX_ATTRIB_ARRAY_DIVISOR:e.VERTEX_ATTRIB_ARRAY_DIVISOR};var t=e.getExtension("ANGLE_instanced_arrays");return t===null?null:{drawArraysInstanced:t.drawArraysInstancedANGLE.bind(t),drawElementsInstanced:t.drawElementsInstancedANGLE.bind(t),vertexAttribDivisor:t.vertexAttribDivisorANGLE.bind(t),VERTEX_ATTRIB_ARRAY_DIVISOR:t.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE}}function bse(e){if(_r(e))return{FRAGMENT_SHADER_DERIVATIVE_HINT:e.FRAGMENT_SHADER_DERIVATIVE_HINT};var t=e.getExtension("OES_standard_derivatives");return t===null?null:{FRAGMENT_SHADER_DERIVATIVE_HINT:t.FRAGMENT_SHADER_DERIVATIVE_HINT_OES}}function Sse(e){return _r(e)?{}:e.getExtension("OES_element_index_uint")}function xse(e){if(_r(e))return{VERTEX_ARRAY_BINDING:e.VERTEX_ARRAY_BINDING,bindVertexArray:e.bindVertexArray.bind(e),createVertexArray:e.createVertexArray.bind(e),deleteVertexArray:e.deleteVertexArray.bind(e),isVertexArray:e.isVertexArray.bind(e)};var t=e.getExtension("OES_vertex_array_object");return t===null?null:{VERTEX_ARRAY_BINDING:t.VERTEX_ARRAY_BINDING_OES,bindVertexArray:t.bindVertexArrayOES.bind(t),createVertexArray:t.createVertexArrayOES.bind(t),deleteVertexArray:t.deleteVertexArrayOES.bind(t),isVertexArray:t.isVertexArrayOES.bind(t)}}function Cse(e){return _r(e)?{}:e.getExtension("OES_texture_float")}function _se(e){return e.getExtension("OES_texture_float_linear")}function wse(e){if(_r(e))return{HALF_FLOAT:e.HALF_FLOAT};var t=e.getExtension("OES_texture_half_float");return t===null?null:{HALF_FLOAT:t.HALF_FLOAT_OES}}function Ase(e){return e.getExtension("OES_texture_half_float_linear")}function Pse(e){if(_r(e))return{MIN:e.MIN,MAX:e.MAX};var t=e.getExtension("EXT_blend_minmax");return t===null?null:{MIN:t.MIN_EXT,MAX:t.MAX_EXT}}function Tse(e){return _r(e)?{}:e.getExtension("EXT_frag_depth")}function Ese(e){if(_r(e))return e.getExtension("EXT_color_buffer_float")===null?null:(e.getExtension("EXT_float_blend"),{RGBA32F:e.RGBA32F});var t=e.getExtension("WEBGL_color_buffer_float");return t===null?(e.getExtension("OES_texture_float"),$O(e,e.FLOAT)?{RGBA32F:34836}:null):(e.getExtension("EXT_float_blend"),{RGBA32F:t.RGBA32F_EXT})}function Ise(e){if(_r(e))return e.getExtension("EXT_color_buffer_half_float")===null?null:(e.getExtension("EXT_float_blend"),{RGBA16F:e.RGBA16F});var t=e.getExtension("EXT_color_buffer_half_float");return t===null?(e.getExtension("OES_texture_half_float"),$O(e,36193)?{RGBA16F:34842}:null):(e.getExtension("EXT_float_blend"),{RGBA16F:t.RGBA16F_EXT})}function Mse(e){if(_r(e))return{drawBuffers:e.drawBuffers.bind(e),COLOR_ATTACHMENT0:e.COLOR_ATTACHMENT0,COLOR_ATTACHMENT1:e.COLOR_ATTACHMENT1,COLOR_ATTACHMENT2:e.COLOR_ATTACHMENT2,COLOR_ATTACHMENT3:e.COLOR_ATTACHMENT3,COLOR_ATTACHMENT4:e.COLOR_ATTACHMENT4,COLOR_ATTACHMENT5:e.COLOR_ATTACHMENT5,COLOR_ATTACHMENT6:e.COLOR_ATTACHMENT6,COLOR_ATTACHMENT7:e.COLOR_ATTACHMENT7,DRAW_BUFFER0:e.DRAW_BUFFER0,DRAW_BUFFER1:e.DRAW_BUFFER1,DRAW_BUFFER2:e.DRAW_BUFFER2,DRAW_BUFFER3:e.DRAW_BUFFER3,DRAW_BUFFER4:e.DRAW_BUFFER4,DRAW_BUFFER5:e.DRAW_BUFFER5,DRAW_BUFFER6:e.DRAW_BUFFER6,DRAW_BUFFER7:e.DRAW_BUFFER7,MAX_COLOR_ATTACHMENTS:e.MAX_COLOR_ATTACHMENTS,MAX_DRAW_BUFFERS:e.MAX_DRAW_BUFFERS};var t=e.getExtension("WEBGL_draw_buffers");return t===null?null:{drawBuffers:t.drawBuffersWEBGL.bind(t),COLOR_ATTACHMENT0:t.COLOR_ATTACHMENT0_WEBGL,COLOR_ATTACHMENT1:t.COLOR_ATTACHMENT1_WEBGL,COLOR_ATTACHMENT2:t.COLOR_ATTACHMENT2_WEBGL,COLOR_ATTACHMENT3:t.COLOR_ATTACHMENT3_WEBGL,COLOR_ATTACHMENT4:t.COLOR_ATTACHMENT4_WEBGL,COLOR_ATTACHMENT5:t.COLOR_ATTACHMENT5_WEBGL,COLOR_ATTACHMENT6:t.COLOR_ATTACHMENT6_WEBGL,COLOR_ATTACHMENT7:t.COLOR_ATTACHMENT7_WEBGL,DRAW_BUFFER0:t.DRAW_BUFFER0_WEBGL,DRAW_BUFFER1:t.DRAW_BUFFER1_WEBGL,DRAW_BUFFER2:t.DRAW_BUFFER2_WEBGL,DRAW_BUFFER3:t.DRAW_BUFFER3_WEBGL,DRAW_BUFFER4:t.DRAW_BUFFER4_WEBGL,DRAW_BUFFER5:t.DRAW_BUFFER5_WEBGL,DRAW_BUFFER6:t.DRAW_BUFFER6_WEBGL,DRAW_BUFFER7:t.DRAW_BUFFER7_WEBGL,MAX_COLOR_ATTACHMENTS:t.MAX_COLOR_ATTACHMENTS_WEBGL,MAX_DRAW_BUFFERS:t.MAX_DRAW_BUFFERS_WEBGL}}function Dse(e){return _r(e)?{}:e.getExtension("EXT_shader_texture_lod")}function Rse(e){if(_r(e))return{UNSIGNED_INT_24_8:e.UNSIGNED_INT_24_8};var t=e.getExtension("WEBGL_depth_texture");return t===null?null:{UNSIGNED_INT_24_8:t.UNSIGNED_INT_24_8_WEBGL}}function Ose(e){if(_r(e))return{FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:e.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING,SRGB8_ALPHA8:e.SRGB8_ALPHA8,SRGB8:e.SRGB8,SRGB:e.SRGB};var t=e.getExtension("EXT_sRGB");return t===null?null:{FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:t.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT,SRGB8_ALPHA8:t.SRGB8_ALPHA8_EXT,SRGB8:t.SRGB_ALPHA_EXT,SRGB:t.SRGB_EXT}}var Fse=`
attribute vec4 aPosition;

void main() {
    gl_Position = aPosition;
}`,kse=`
precision mediump float;
uniform vec4 uColor;
uniform sampler2D uTexture;

void main() {
    gl_FragColor = texture2D(uTexture, vec2(0.5, 0.5)) * uColor;
}`,Bse=new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]);function $O(e,t){var r=Tg(e,{type:"vert",source:Fse}),n=Tg(e,{type:"frag",source:kse});if(!r||!n)return!1;var a=qx(e);e.attachShader(a,r),e.attachShader(a,n),e.linkProgram(a),e.useProgram(a);var i=e.getAttribLocation(a,"aPosition"),o=e.getUniformLocation(a,"uColor");if(!o)return Ir&&console.log("error getting 'uColor' uniform location"),!1;var s=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,s),e.bufferData(e.ARRAY_BUFFER,Bse,e.STATIC_DRAW),e.enableVertexAttribArray(i),e.vertexAttribPointer(i,2,e.FLOAT,!1,0,0);var u=e.createTexture(),l=new Uint8Array([255,255,255,255]);e.bindTexture(e.TEXTURE_2D,u),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,l);var c=e.createTexture();e.bindTexture(e.TEXTURE_2D,c),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,t,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST);var d=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,d),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,c,0);var f=e.checkFramebufferStatus(e.FRAMEBUFFER);if(f!==e.FRAMEBUFFER_COMPLETE)return Ir&&console.log("error creating framebuffer for '"+t+"'"),!1;e.bindTexture(e.TEXTURE_2D,u),e.uniform4fv(o,[0,10,20,1]),e.drawArrays(e.TRIANGLES,0,6),e.bindTexture(e.TEXTURE_2D,c),e.bindFramebuffer(e.FRAMEBUFFER,null),e.clearColor(1,0,0,1),e.clear(e.COLOR_BUFFER_BIT),e.uniform4fv(o,[0,1/10,1/20,1]),e.drawArrays(e.TRIANGLES,0,6);var p=new Uint8Array(4);if(e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,p),p[0]!==0||p[1]<248||p[2]<248||p[3]<254)return Ir&&console.log("not able to actually render to '"+t+"' texture"),!1;if(t===e.FLOAT){e.bindFramebuffer(e.FRAMEBUFFER,d);var h=new Float32Array(4);e.readPixels(0,0,1,1,e.RGBA,e.FLOAT,h);var v=e.getError();if(v)return Ir&&console.log("error reading float pixels: '"+qO(e,v)+"'"),!1}return!0}var QO=ti();function Lse(e,t){switch(t){case"image-uint8":return e.TEXTURE_2D;case"image-float32":return e.TEXTURE_2D;case"image-float16":return e.TEXTURE_2D;case"image-depth":return e.TEXTURE_2D}if(_r(e))switch(t){case"image-int32":return e.TEXTURE_2D;case"volume-uint8":return e.TEXTURE_3D;case"volume-float32":return e.TEXTURE_3D;case"volume-float16":return e.TEXTURE_3D}throw new Error("unknown texture kind '"+t+"'")}function ZO(e,t,r){switch(t){case"alpha":return _r(e)&&r==="float"?e.RED:_r(e)&&r==="int"?e.RED_INTEGER:e.ALPHA;case"rgb":return _r(e)&&r==="int"?e.RGB_INTEGER:e.RGB;case"rgba":return _r(e)&&r==="int"?e.RGBA_INTEGER:e.RGBA;case"depth":return e.DEPTH_COMPONENT}}function Nse(e,t,r){if(_r(e))switch(t){case"alpha":switch(r){case"ubyte":return e.ALPHA;case"float":return e.R32F;case"fp16":return e.R16F;case"int":return e.R32I}case"rgb":switch(r){case"ubyte":return e.RGB;case"float":return e.RGB32F;case"fp16":return e.RGB16F;case"int":return e.RGB32I}case"rgba":switch(r){case"ubyte":return e.RGBA;case"float":return e.RGBA32F;case"fp16":return e.RGBA16F;case"int":return e.RGBA32I}case"depth":switch(r){case"ushort":return e.DEPTH_COMPONENT16;case"float":return e.DEPTH_COMPONENT32F}}return ZO(e,t,r)}function Use(e,t,r,n,a){var i=zse(e)*Vse(t);return i*r*n*(a||1)}function zse(e){switch(e){case"alpha":return 1;case"rgb":return 3;case"rgba":return 4;case"depth":return 4}}function Vse(e){switch(e){case"ubyte":return 1;case"ushort":return 2;case"float":return 4;case"fp16":return 2;case"int":return 4}}function Hse(e,t,r){switch(r){case"ubyte":return e.UNSIGNED_BYTE;case"ushort":return e.UNSIGNED_SHORT;case"float":return e.FLOAT;case"fp16":if(t.textureHalfFloat)return t.textureHalfFloat.HALF_FLOAT;throw new Error('extension "texture_half_float" unavailable');case"int":if(_r(e))return e.INT;throw new Error('texture type "int" requires webgl2')}}function uE(e,t){switch(t){case"nearest":return e.NEAREST;case"linear":return e.LINEAR}}function km(e,t,r){switch(r){case"depth":return e.DEPTH_ATTACHMENT;case"stencil":return e.STENCIL_ATTACHMENT;case"color0":case 0:return e.COLOR_ATTACHMENT0}if(t.drawBuffers)switch(r){case"color1":case 1:return t.drawBuffers.COLOR_ATTACHMENT1;case"color2":case 2:return t.drawBuffers.COLOR_ATTACHMENT2;case"color3":case 3:return t.drawBuffers.COLOR_ATTACHMENT3;case"color4":case 4:return t.drawBuffers.COLOR_ATTACHMENT4;case"color5":case 5:return t.drawBuffers.COLOR_ATTACHMENT5;case"color6":case 6:return t.drawBuffers.COLOR_ATTACHMENT6;case"color7":case 7:return t.drawBuffers.COLOR_ATTACHMENT7}throw new Error("unknown texture attachment")}function Gse(e){return typeof HTMLImageElement!="undefined"&&e instanceof HTMLImageElement}function qse(e,t,r){return t===r.TEXTURE_2D}function jse(e,t,r){return t===r.TEXTURE_3D}function lE(e){var t=e.createTexture();if(t===null)throw new Error("Could not create WebGL texture");return t}function Wx(e,t,r,n,a,i){var o=QO(),s=lE(e);if(r.endsWith("float32")&&a!=="float"||r.endsWith("float16")&&a!=="fp16"||r.endsWith("uint8")&&a!=="ubyte"||r.endsWith("int32")&&a!=="int"||r.endsWith("depth")&&a!=="ushort"&&a!=="float")throw new Error("texture kind '"+r+"' and type '"+a+"' are incompatible");var u=Lse(e,r),l=uE(e,i),c=ZO(e,n,a),d=Nse(e,n,a),f=Hse(e,t,a);function p(){e.bindTexture(u,s),e.texParameteri(u,e.TEXTURE_MAG_FILTER,l),e.texParameteri(u,e.TEXTURE_MIN_FILTER,l),e.texParameteri(u,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(u,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(u,null)}p();var h=0,v=0,m=0,g,y=!1;function b(_,A,T){if(!(h===_&&v===A&&m===(T||0)))if(h=_,v=A,m=T||0,e.bindTexture(u,s),u===e.TEXTURE_2D)e.texImage2D(u,0,d,h,v,0,c,f,null);else if(_r(e)&&u===e.TEXTURE_3D&&m!==void 0)e.texImage3D(u,0,d,h,v,m,0,c,f,null);else throw new Error("unknown texture target")}function x(_,A){if(A===void 0&&(A=!1),e.bindTexture(u,s),e.pixelStorei(e.UNPACK_ALIGNMENT,1),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.NONE),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),Gse(_))e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.bindTexture(e.TEXTURE_2D,s),e.texImage2D(e.TEXTURE_2D,0,d,c,f,_);else if(qse(_,u,e)){var T=_.filter?uE(e,_.filter):l;e.texParameteri(u,e.TEXTURE_MAG_FILTER,T),e.texParameteri(u,e.TEXTURE_MIN_FILTER,T),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!!_.flipY),A?e.texSubImage2D(u,0,0,0,_.width,_.height,c,f,_.array):(h=_.width,v=_.height,e.texImage2D(u,0,d,h,v,0,c,f,_.array))}else if(_r(e)&&jse(_,u,e))e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),A?e.texSubImage3D(u,0,0,0,0,_.width,_.height,_.depth,c,f,_.array):(h=_.width,v=_.height,m=_.depth,e.texImage3D(u,0,d,h,v,m,0,c,f,_.array));else throw new Error("unknown texture target");e.bindTexture(u,null),g=_}function S(_,A,T){if(_.bind(),u===e.TEXTURE_2D)e.framebufferTexture2D(e.FRAMEBUFFER,km(e,t,A),e.TEXTURE_2D,s,0);else if(_r(e)&&u===e.TEXTURE_3D){if(T===void 0)throw new Error("need `layer` to attach 3D texture");e.framebufferTextureLayer(e.FRAMEBUFFER,km(e,t,A),s,0,T)}else throw new Error("unknown/unsupported texture target")}return{id:o,target:u,format:c,internalFormat:d,type:f,filter:l,getWidth:function(){return h},getHeight:function(){return v},getDepth:function(){return m},getByteCount:function(){return Use(n,a,h,v,m)},define:b,load:x,bind:function(_){e.activeTexture(e.TEXTURE0+_),e.bindTexture(u,s)},unbind:function(_){e.activeTexture(e.TEXTURE0+_),e.bindTexture(u,null)},attachFramebuffer:S,detachFramebuffer:function(_,A){if(_.bind(),u===e.TEXTURE_2D)e.framebufferTexture2D(e.FRAMEBUFFER,km(e,t,A),e.TEXTURE_2D,null,0);else if(_r(e)&&u===e.TEXTURE_3D)e.framebufferTextureLayer(e.FRAMEBUFFER,km(e,t,A),null,0,0);else throw new Error("unknown texture target")},reset:function(){s=lE(e),p();var _=[h,v,m],A=_[0],T=_[1],I=_[2];h=0,v=0,m=0,b(A,T,I),g&&x(g)},destroy:function(){y||(e.deleteTexture(s),y=!0)}}}function Wse(e,t,r){var n=e.resources,a=[];return Object.keys(t).forEach(function(i){var o=t[i];if(o.type==="texture"){var s=r[i];if(s)if(o.kind==="texture")a[a.length]=[i,s.ref.value];else{var u=n.texture(o.kind,o.format,o.dataType,o.filter);u.load(s.ref.value),a[a.length]=[i,u]}}}),a}function cE(e,t,r){var n=new Image;n.onload=function(){r.load(n),k.update(t,r)},n.src=e}function Jy(e){var t,r=(t=e==null?void 0:e.TEXTURE_2D)!==null&&t!==void 0?t:3553;return{id:QO(),target:r,format:0,internalFormat:0,type:0,filter:0,getWidth:function(){return 0},getHeight:function(){return 0},getDepth:function(){return 0},getByteCount:function(){return 0},define:function(){},load:function(){},bind:function(n){e&&(e.activeTexture(e.TEXTURE0+n),e.bindTexture(r,null))},unbind:function(n){e&&(e.activeTexture(e.TEXTURE0+n),e.bindTexture(r,null))},attachFramebuffer:function(){},detachFramebuffer:function(){},reset:function(){},destroy:function(){}}}function to(e,t,r,n){var a=Xse(e,t,r,n);return r.palette?(k.updateIfChanged(a.dUsePalette,!0),Yse(r.palette,a.tPalette)):k.updateIfChanged(a.dUsePalette,!1),a}function Xse(e,t,r,n){switch(Ma.getGranularity(e,r.granularity)){case"uniform":return $se(e,r.color,n);case"instance":return Qse(e,r.color,n);case"group":return Zse(e,r.color,n);case"groupInstance":return Jse(e,r.color,n);case"vertex":return eue(t,r.color,n);case"vertexInstance":return tue(t,r.color,n);case"volume":return dE(r.grid,"volume",n);case"volumeInstance":return dE(r.grid,"volumeInstance",n)}}function Yse(e,t){var r=!0,n=t.ref.value;if(e.colors.length!==n.width||n.filter!==e.filter)r=!1;else for(var a=n.array,i=0,o=0,s=e.colors;o<s.length;o++){var u=s[o],l=it.toRgb(u),c=l[0],d=l[1],f=l[2];if(a[i++]!==c||a[i++]!==d||a[i++]!==f){r=!1;break}}if(!r){for(var p=new Uint8Array(e.colors.length*3),h=0,v=0,m=e.colors;v<m.length;v++){var u=m[v],g=it.toRgb(u),c=g[0],d=g[1],f=g[2];p[h++]=c,p[h++]=d,p[h++]=f}k.update(t,{array:p,height:1,width:e.colors.length,filter:e.filter})}}function Kse(e,t){return t?(k.update(t.uColor,it.toVec3Normalized(t.uColor.ref.value,e)),k.updateIfChanged(t.dColorType,"uniform"),t):{uColor:k.create(it.toVec3Normalized(C(),e)),tColor:k.create({array:new Uint8Array(3),width:1,height:1}),tColorGrid:k.create(Jy()),tPalette:k.create({array:new Uint8Array(3),width:1,height:1}),uColorTexDim:k.create(Ge.create(1,1)),uColorGridDim:k.create(C.create(1,1,1)),uColorGridTransform:k.create(Cr.create(0,0,0,1)),dColorType:k.create("uniform"),dUsePalette:k.create(!1)}}function $se(e,t,r){return Kse(t($i,!1),r)}function Bv(e,t,r){return r?(k.update(r.tColor,e),k.update(r.uColorTexDim,Ge.create(e.width,e.height)),k.updateIfChanged(r.dColorType,t),r):{uColor:k.create(C()),tColor:k.create(e),tColorGrid:k.create(Jy()),tPalette:k.create({array:new Uint8Array(3),width:1,height:1}),uColorTexDim:k.create(Ge.create(e.width,e.height)),uColorGridDim:k.create(C.create(1,1,1)),uColorGridTransform:k.create(Cr.create(0,0,0,1)),dColorType:k.create(t),dUsePalette:k.create(!1)}}function Qse(e,t,r){var n=e.instanceCount,a=Na(Math.max(1,n),3,Uint8Array,r&&r.tColor.ref.value.array);for(e.reset();e.hasNext;){var i=e.move(),o=i.location,s=i.isSecondary,u=i.instanceIndex;it.toArray(t(o,s),a.array,u*3),e.skipInstance()}return Bv(a,"instance",r)}function Zse(e,t,r){var n=e.groupCount,a=Na(Math.max(1,n),3,Uint8Array,r&&r.tColor.ref.value.array);for(e.reset();e.hasNext&&!e.isNextNewInstance;){var i=e.move(),o=i.location,s=i.isSecondary,u=i.groupIndex;it.toArray(t(o,s),a.array,u*3)}return Bv(a,"group",r)}function Jse(e,t,r){var n=e.groupCount,a=e.instanceCount,i=a*n,o=Na(Math.max(1,i),3,Uint8Array,r&&r.tColor.ref.value.array);for(e.reset();e.hasNext;){var s=e.move(),u=s.location,l=s.isSecondary,c=s.index;it.toArray(t(u,l),o.array,c*3)}return Bv(o,"groupInstance",r)}function eue(e,t,r){var n=e.groupCount,a=e.stride,i=Na(Math.max(1,n),3,Uint8Array,r&&r.tColor.ref.value.array);for(e.reset(),e.voidInstances();e.hasNext&&!e.isNextNewInstance;)for(var o=e.move(),s=o.location,u=o.isSecondary,l=o.groupIndex,c=t(s,u),d=0;d<a;++d)it.toArray(c,i.array,(l+d)*3);return Bv(i,"vertex",r)}function tue(e,t,r){var n=e.groupCount,a=e.instanceCount,i=e.stride,o=a*n,s=Na(Math.max(1,o),3,Uint8Array,r&&r.tColor.ref.value.array);for(e.reset();e.hasNext;)for(var u=e.move(),l=u.location,c=u.isSecondary,d=u.index,f=t(l,c),p=0;p<i;++p)it.toArray(f,s.array,(d+p)*3);return Bv(s,"vertexInstance",r)}function dE(e,t,r){var n=e.colors,a=e.dimension,i=e.transform,o=n.getWidth(),s=n.getHeight();return r?(k.update(r.tColorGrid,n),k.update(r.uColorTexDim,Ge.create(o,s)),k.update(r.uColorGridDim,C.clone(a)),k.update(r.uColorGridTransform,Cr.clone(i)),k.updateIfChanged(r.dColorType,t),r):{uColor:k.create(C()),tColor:k.create({array:new Uint8Array(3),width:1,height:1}),tColorGrid:k.create(n),tPalette:k.create({array:new Uint8Array(3),width:1,height:1}),uColorTexDim:k.create(Ge.create(o,s)),uColorGridDim:k.create(C.clone(a)),uColorGridTransform:k.create(Cr.clone(i)),dColorType:k.create(t),dUsePalette:k.create(!1)}}var Lt;(function(e){function t(b,x,S,_,A,T,I){return I?i(b,x,S,_,A,T,I):a(b,x,S,_,A,T)}e.create=t;function r(b){var x=b?b.vertexBuffer.ref.value:new Float32Array(0),S=b?b.indexBuffer.ref.value:new Uint32Array(0),_=b?b.normalBuffer.ref.value:new Float32Array(0),A=b?b.groupBuffer.ref.value:new Float32Array(0);return t(x,S,_,A,0,0,b)}e.createEmpty=r;function n(b){return Ja([b.vertexCount,b.triangleCount,b.vertexBuffer.ref.version,b.indexBuffer.ref.version,b.normalBuffer.ref.version,b.groupBuffer.ref.version])}function a(b,x,S,_,A,T){var I=Ne(),M,O=-1,D=-1,F={kind:"mesh",vertexCount:A,triangleCount:T,vertexBuffer:k.create(b),indexBuffer:k.create(x),normalBuffer:k.create(S),groupBuffer:k.create(_),get boundingSphere(){var G=n(F);if(G!==O){var N=Sc(F.vertexBuffer.ref.value,F.vertexCount,1);Ne.copy(I,N),O=G}return I},get groupMapping(){return F.groupBuffer.ref.version!==D&&(M=Rp(F.groupBuffer.ref.value,F.vertexCount),D=F.groupBuffer.ref.version),M},setBoundingSphere:function(G){Ne.copy(I,G),O=n(F)},meta:{}};return F}function i(b,x,S,_,A,T,I){return I.vertexCount=A,I.triangleCount=T,k.update(I.vertexBuffer,b),k.update(I.indexBuffer,x),k.update(I.normalBuffer,S),k.update(I.groupBuffer,_),I}function o(b){var x=b.vertexCount,S=b.triangleCount,_=b.vertexBuffer.ref.value,A=b.indexBuffer.ref.value,T=b.normalBuffer.ref.value.length>=x*3?b.normalBuffer.ref.value:new Float32Array(x*3);T===b.normalBuffer.ref.value&&T.fill(0,0,x*3),TO(_,A,T,x,S),k.update(b.normalBuffer,T)}e.computeNormals=o;function s(b,x){x===void 0&&(x=3);for(var S=b.vertexBuffer.ref.value,_=new Map,A=function(G,N){return G[0].toFixed(N)+"|"+G[1].toFixed(N)+"|"+G[2].toFixed(N)},T=0,I=C(),M=0,O=b.vertexCount;M<O;++M){C.fromArray(I,S,M*3);var D=A(I,x),F=_.get(D);F!==void 0?(T+=1,_.set(D,F+1)):_.set(D,1)}return T}e.checkForDuplicateVertices=s;var u=Mn();function l(b,x){var S=b.vertexBuffer.ref.value;if(Nd(x,S,0,b.vertexCount),!ue.isTranslationAndUniformScaling(x)){var _=Mn.directionTransform(u,x);pae(_,b.normalBuffer.ref.value,0,b.vertexCount)}k.update(b.vertexBuffer,S)}e.transform=l;function c(b){var x=("kind"in b?b.meta:b.meta.ref.value).originalData;return x}e.getOriginalData=c;function d(b,x){x===void 0&&(x=!0);var S=b.indexBuffer,_=b.vertexBuffer,A=b.groupBuffer,T=b.normalBuffer,I=b.triangleCount,M=b.vertexCount,O=S.ref.value,D=_.ref.value,F=A.ref.value,G=T.ref.value,N=je.create(Uint32Array,3,1024,I),z=je.create(Float32Array,3,1024,D);z.currentIndex=M*3,z.elementCount=M;var $=je.create(Float32Array,3,1024,G);$.currentIndex=M*3,$.elementCount=M;var j=je.create(Float32Array,1,1024,F);j.currentIndex=M,j.elementCount=M;var Z=C(),q=C(),te=C(),he=C(),W=C(),K=C();function U(Ye){C.fromArray(Z,D,Ye*3),C.fromArray(he,G,Ye*3),je.add3(z,Z[0],Z[1],Z[2]),je.add3($,he[0],he[1],he[2])}function H(Ye,lt){C.fromArray(Z,D,Ye*3),C.fromArray(q,D,lt*3),C.scale(Z,C.add(Z,Z,q),.5),C.fromArray(he,G,Ye*3),C.fromArray(W,G,lt*3),C.scale(he,C.add(he,he,W),.5),je.add3(z,Z[0],Z[1],Z[2]),je.add3($,he[0],he[1],he[2])}function J(Ye,lt,Le){C.fromArray(Z,D,Ye*3),C.fromArray(q,D,lt*3),C.fromArray(te,D,Le*3),C.scale(Z,C.add(Z,C.add(Z,Z,q),te),1/3),C.fromArray(he,G,Ye*3),C.fromArray(W,G,lt*3),C.fromArray(K,G,Le*3),C.scale(he,C.add(he,C.add(he,he,W),K),1/3),je.add3(z,Z[0],Z[1],Z[2]),je.add3($,he[0],he[1],he[2])}function X(Ye,lt,Le,Qe,at){++ee,U(Ye),H(Ye,lt),H(Ye,Le),je.add3(N,Q,Q+1,Q+2);for(var ot=0;ot<3;++ot)je.add(j,Qe);Q+=3,ee+=2,U(lt),U(Le),H(Ye,lt),H(Ye,Le),je.add3(N,Q,Q+1,Q+3),je.add3(N,Q,Q+3,Q+2);for(var ot=0;ot<4;++ot)je.add(j,at);Q+=4}var Q=M,ee=0;if(x)for(var le=0,ye=I;le<ye;++le){var be=O[le*3],Ae=O[le*3+1],xe=O[le*3+2],ae=F[be],oe=F[Ae],R=F[xe];if(ae===oe&&ae===R)++ee,je.add3(N,be,Ae,xe);else if(ae===oe)X(xe,be,Ae,R,ae);else if(ae===R)X(Ae,xe,be,oe,R);else if(oe===R)X(be,Ae,xe,ae,oe);else{ee+=2,U(be),H(be,Ae),H(be,xe),J(be,Ae,xe),je.add3(N,Q,Q+1,Q+3),je.add3(N,Q,Q+3,Q+2);for(var V=0;V<4;++V)je.add(j,ae);Q+=4,ee+=2,U(Ae),H(Ae,xe),H(Ae,be),J(be,Ae,xe),je.add3(N,Q,Q+1,Q+3),je.add3(N,Q,Q+3,Q+2);for(var V=0;V<4;++V)je.add(j,oe);Q+=4,ee+=2,U(xe),H(xe,Ae),H(xe,be),J(be,Ae,xe),je.add3(N,Q+3,Q+1,Q),je.add3(N,Q+2,Q+3,Q);for(var V=0;V<4;++V)je.add(j,R);Q+=4}}else for(var le=0,ye=I;le<ye;++le){var be=O[le*3],Ae=O[le*3+1],xe=O[le*3+2],ae=F[be],oe=F[Ae],R=F[xe];if(ae!==oe||ae!==R){++ee,U(be),U(Ae),U(xe),je.add3(N,Q,Q+1,Q+2);for(var pe=oe===R?oe:ae,V=0;V<3;++V)je.add(j,pe);Q+=3}else++ee,je.add3(N,be,Ae,xe)}var _e=je.compact(N),Ee=je.compact(z),Ve=je.compact($),He=je.compact(j);return b.vertexCount=Q,b.triangleCount=ee,k.update(_,Ee),k.update(A,He),k.update(S,_e),k.update(T,Ve),b.meta.originalData={indexBuffer:O,vertexCount:M,triangleCount:I},b}e.uniformTriangleGroup=d,e.Params=w(w({},At.Params),{doubleSided:E.Boolean(!1,At.CustomQualityParamInfo),flipSided:E.Boolean(!1,At.ShadingCategory),flatShaded:E.Boolean(!1,At.ShadingCategory),ignoreLight:E.Boolean(!1,At.ShadingCategory),xrayShaded:E.Boolean(!1,At.ShadingCategory)}),e.Utils={Params:e.Params,createEmpty:r,createValues:p,createValuesSimple:h,updateValues:v,updateBoundingSphere:m,createRenderableState:g,updateRenderableState:y,createPositionIterator:f};function f(b,x){var S=b.vertexCount,_=x.instanceCount.ref.value,A=Kd(),T=A.position,I=b.vertexBuffer.ref.value,M=x.aTransform.ref.value,O=function(D,F){return F<0?C.fromArray(T,I,D*3):C.transformMat4Offset(T,I,M,0,D*3,F*16),A};return pn(S,_,1,O)}function p(b,x,S,_,A){var T=S.instanceCount,I=S.groupCount,M=f(b,x),O=to(S,M,_.color),D=Fo(T*I),F=ol(),G=sl(),N=ul(),z={drawCount:b.triangleCount*3,vertexCount:b.vertexCount,groupCount:I,instanceCount:T},$=Ne.clone(b.boundingSphere),j=ya($,x.aTransform.ref.value,T);return w(w(w(w(w(w(w(w({aPosition:b.vertexBuffer,aNormal:b.normalBuffer,aGroup:b.groupBuffer,elements:b.indexBuffer,boundingSphere:k.create(j),invariantBoundingSphere:k.create($),uInvariantBoundingSphere:k.create(Cr.ofSphere($))},O),D),F),G),N),x),At.createValues(A,z)),{dDoubleSided:k.create(A.doubleSided),dFlatShaded:k.create(A.flatShaded),dFlipSided:k.create(A.flipSided),dIgnoreLight:k.create(A.ignoreLight),dXrayShaded:k.create(A.xrayShaded),meta:k.create(b.meta)})}function h(b,x,S,_,A){var T=At.createSimple(S,_,A),I=w(w({},E.getDefaultValues(e.Params)),x);return p(b,T.transform,T.locationIterator,T.theme,I)}function v(b,x){At.updateValues(b,x),k.updateIfChanged(b.dDoubleSided,x.doubleSided),k.updateIfChanged(b.dFlatShaded,x.flatShaded),k.updateIfChanged(b.dFlipSided,x.flipSided),k.updateIfChanged(b.dIgnoreLight,x.ignoreLight),k.updateIfChanged(b.dXrayShaded,x.xrayShaded)}function m(b,x){var S=Ne.clone(x.boundingSphere),_=ya(S,b.aTransform.ref.value,b.instanceCount.ref.value);Ne.equals(_,b.boundingSphere.ref.value)||k.update(b.boundingSphere,_),Ne.equals(S,b.invariantBoundingSphere.ref.value)||(k.update(b.invariantBoundingSphere,S),k.update(b.uInvariantBoundingSphere,Cr.fromSphere(b.uInvariantBoundingSphere.ref.value,S)))}function g(b){var x=At.createRenderableState(b);return y(x,b),x}function y(b,x){At.updateRenderableState(b,x),b.opaque=b.opaque&&!x.xrayShaded,b.writeDepth=b.opaque}})(Lt||(Lt={}));var rue={radius:1,detail:0};function nue(e,t,r){var n=w(w({},rue),r),a=n.radius,i=n.detail,o=aue(),s=o.vertices,u=o.indices;c(i),hae(s,a);var l=new Float32Array(s.length);return TO(s,u,l,s.length/3,u.length/3),{vertices:new Float32Array(s),normals:new Float32Array(l),indices:new Uint32Array(u)};function c(f){for(var p=C(),h=C(),v=C(),m=0;m<t.length;m+=3)C.fromArray(p,e,t[m+0]*3),C.fromArray(h,e,t[m+1]*3),C.fromArray(v,e,t[m+2]*3),d(p,h,v,f)}function d(f,p,h,v){for(var m=Math.pow(2,v),g=[],y=0;y<=m;++y){g[y]=[];var b=C();C.lerp(b,f,h,y/m);var x=C();C.lerp(x,p,h,y/m);for(var S=m-y,_=0;_<=S;++_)if(_===0&&y===m)g[y][_]=b;else{var A=C();C.lerp(A,b,x,_/S),g[y][_]=A}}for(var y=0;y<m;++y)for(var _=0;_<2*(m-y)-1;++_){var T=Math.floor(_/2);_%2===0?o.add(g[y][T+1],g[y+1][T],g[y][T]):o.add(g[y][T+1],g[y+1][T+1],g[y+1][T])}}}function aue(){var e=[],t=[],r=new Map;function n(a){var i=a[0].toFixed(5)+"|"+a[1].toFixed(5)+"|"+a[2].toFixed(5),o=r.get(i);return o===void 0&&(o=e.length/3,r.set(i,o),e.push.apply(e,a)),o}return{vertices:e,indices:t,add:function(a,i,o){t.push(n(a),n(i),n(o))}}}var oo=(1+Math.sqrt(5))/2,iue=[-1,oo,0,1,oo,0,-1,-oo,0,1,-oo,0,0,-1,oo,0,1,oo,0,-1,-oo,0,1,-oo,oo,0,-1,oo,0,1,-oo,0,-1,-oo,0,1],oue=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],u2;function sue(){return u2||(u2=Zy(iue,oue)),u2}var JO=sue(),uue=JO.vertices,lue=JO.indices;function e1(e){return 10*Math.pow(Math.pow(2,e),2)+2}function cue(e){return nue(uue,lue,{detail:e,radius:1})}var fE=new Map,due=ue.identity();function fue(e,t,r){return ue.scaleUniformly(e,ue.fromTranslation(e,t),r)}function eF(e){var t=fE.get(e);return t===void 0&&(t=cue(e),fE.set(e,t)),t}function la(e,t,r,n){_t.addPrimitive(e,fue(due,t,r),eF(n))}var Is={radiusTop:1,radiusBottom:1,height:1,radialSegments:8,heightSegments:1,topCap:!1,bottomCap:!1,thetaStart:0,thetaLength:Math.PI*2};function pue(e){var t=w(w({},Is),e),r=t.radiusTop,n=t.radiusBottom,a=t.height,i=t.radialSegments,o=t.heightSegments,s=t.topCap,u=t.bottomCap,l=t.thetaStart,c=t.thetaLength,d=[],f=[],p=[],h=0,v=[],m=a/2;return g(),s&&r>0&&y(!0),u&&n>0&&y(!1),{vertices:new Float32Array(f),normals:new Float32Array(p),indices:new Uint32Array(d)};function g(){for(var b=C.zero(),x=(n-r)/a,S=0;S<=o;++S){for(var _=[],A=S/o,T=A*(n-r)+r,I=0;I<=i;++I){var M=I/i,O=M*c+l,D=Math.sin(O),F=Math.cos(O);f.push(T*D,-A*a+m,T*F),C.normalize(b,C.set(b,D,x,F)),p.push.apply(p,b),_.push(h++)}v.push(_)}for(var I=0;I<i;++I)for(var S=0;S<o;++S){var G=v[S][I],N=v[S+1][I],z=v[S+1][I+1],$=v[S][I+1];d.push(G,N,$),d.push(N,z,$)}}function y(b){for(var x=b===!0?r:n,S=b===!0?1:-1,_=h,A=1;A<=i;++A)f.push(0,m*S,0),p.push(0,S,0),++h;for(var T=h,A=0;A<=i;++A){var I=A/i,M=I*c+l,O=Math.cos(M),D=Math.sin(M);f.push(x*D,m*S,x*O),p.push(0,S,0),++h}for(var A=0;A<i;++A){var F=_+A,G=T+A;b===!0?d.push(G,G+1,F):d.push(G+1,G,F)}}}var pE=C(),hE=C(),gi=C(),yi=C(),_s=C(),Af=C(),hue={height:1,topCap:!0,bottomCap:!0};function Fp(e,t){var r=e.length/3;if(r<3)throw new Error("need at least 3 points to build a prism");var n=w(w({},hue),t),a=n.height,i=n.topCap,o=n.bottomCap,s=r*2,u=r*4,l=(i?1:0)+(o?1:0);r===3?(s+=l,u+=l*3):r===4?(s+=l*2,u+=l*4):(s+=l*r,u+=l*r*3);var c=Op(s,u),d=a*.5;C.set(pE,0,0,-d),C.set(hE,0,0,d);for(var f=0;f<r;++f){var p=(f+1)%r;C.set(gi,e[f*3],e[f*3+1],-d),C.set(yi,e[p*3],e[p*3+1],-d),C.set(_s,e[p*3],e[p*3+1],d),C.set(Af,e[f*3],e[f*3+1],d),c.addQuad(gi,yi,_s,Af)}if(r===3)i&&(C.set(gi,e[0],e[1],-d),C.set(yi,e[3],e[4],-d),C.set(_s,e[6],e[7],-d),c.add(_s,yi,gi)),o&&(C.set(gi,e[0],e[1],d),C.set(yi,e[3],e[4],d),C.set(_s,e[6],e[7],d),c.add(gi,yi,_s));else if(r===4)i&&(C.set(gi,e[0],e[1],-d),C.set(yi,e[3],e[4],-d),C.set(_s,e[6],e[7],-d),C.set(Af,e[9],e[10],-d),c.addQuad(Af,_s,yi,gi)),o&&(C.set(gi,e[0],e[1],d),C.set(yi,e[3],e[4],d),C.set(_s,e[6],e[7],d),C.set(Af,e[9],e[10],d),c.addQuad(gi,yi,_s,Af));else for(var f=0;f<r;++f){var p=(f+1)%r;i&&(C.set(gi,e[f*3],e[f*3+1],-d),C.set(yi,e[p*3],e[p*3+1],-d),c.add(pE,yi,gi)),o&&(C.set(gi,e[f*3],e[f*3+1],d),C.set(yi,e[p*3],e[p*3+1],d),c.add(gi,yi,hE))}return c.getPrimitive()}var l2;function vue(){return l2||(l2=Fp(Qs(4,!1))),l2}var c2;function mue(){return c2||(c2=Fp(Qs(5,!1))),c2}var d2;function gue(){return d2||(d2=Fp(Qs(6,!1))),d2}var f2;function yue(){return f2||(f2=Fp(Qs(6,!0))),f2}var p2;function bue(){return p2||(p2=Fp(Qs(7,!1))),p2}var vE=new Map,mE=C.create(0,1,0),Bs=C(),Bm=C(),gE=C(),ac=ue(),yE=ue(),Sue=C(),bE=ue(),Wf=C(),h2=C();function Ig(e,t,r,n,a){return C.setMagnitude(Bm,r,n/2),C.add(gE,t,Bm),a?C.matchDirection(h2,mE,Bm):C.copy(h2,mE),ue.fromScaling(bE,C.set(Sue,1,n,1)),C.makeRotation(yE,h2,Bm),ue.mul(e,yE,bE),ue.setTranslation(e,gE)}var ws=new Int32Array(9);function xue(e){var t,r,n,a,i,o,s,u,l;return ws[0]=Math.round(1e3*((t=e.radiusTop)!==null&&t!==void 0?t:Is.radiusTop)),ws[1]=Math.round(1e3*((r=e.radiusBottom)!==null&&r!==void 0?r:Is.radiusBottom)),ws[2]=Math.round(1e3*((n=e.height)!==null&&n!==void 0?n:Is.height)),ws[3]=(a=e.radialSegments)!==null&&a!==void 0?a:Is.radialSegments,ws[4]=(i=e.heightSegments)!==null&&i!==void 0?i:Is.heightSegments,ws[5]=((o=e.topCap)!==null&&o!==void 0?o:Is.topCap)?1:0,ws[6]=((s=e.bottomCap)!==null&&s!==void 0?s:Is.bottomCap)?1:0,ws[7]=Math.round(1e3*((u=e.thetaStart)!==null&&u!==void 0?u:Is.thetaStart)),ws[8]=Math.round(1e3*((l=e.thetaLength)!==null&&l!==void 0?l:Is.thetaLength)),Ja(ws)}function S3(e){var t=xue(e),r=vE.get(t);if(r===void 0){if(e.radialSegments&&e.radialSegments<=4){var n=Math.max(3,e.radialSegments),a=Fp(Qs(n,!0,e.radiusTop),e);r=m3(a,ue.rotX90)}else r=pue(e);vE.set(t,r)}return r}function $a(e,t,r,n,a){var i=C.distance(t,r)*n;C.sub(Bs,r,t),Ig(ac,t,Bs,i,!0),_t.addPrimitive(e,ac,S3(a))}function Cue(e,t,r,n,a,i){var o=C.distance(t,r)*n,s=S3(i);C.sub(Bs,r,t),C.add(Wf,t,a),Ig(ac,Wf,Bs,o,!0),_t.addPrimitive(e,ac,s),C.sub(Wf,t,a),Ig(ac,Wf,Bs,o,!0),_t.addPrimitive(e,ac,s)}function Xh(e,t,r,n,a,i){var o=Math.floor(a/2),s=1/a;if(n<1){var u=n/2/a;n+=a%2===1?u:-u}var l=C.distance(t,r)*n,c=S3(i);C.sub(Bs,r,t);for(var d=0;d<o;++d){var f=s*(d*2+1);C.setMagnitude(Bs,Bs,l*f),C.add(Wf,t,Bs),Ig(ac,Wf,Bs,l*s,!1),_t.addPrimitive(e,ac,c)}}var kn=C(),SE=Mn(),lu=C(),As=C(),Nc=C(),Lm=C(),Li=C.fromArray,_ue=C.triangleNormal,xE=C.copy,Nm=C.transformMat4,CE=C.transformMat3,_E=Mn.directionTransform,Uo=je.add3,v2=je.add,_t;(function(e){function t(c,d,f){return c===void 0&&(c=2048),d===void 0&&(d=1024),{currentGroup:-1,vertices:je.create(Float32Array,3,d,f?f.vertexBuffer.ref.value:c),normals:je.create(Float32Array,3,d,f?f.normalBuffer.ref.value:c),indices:je.create(Uint32Array,3,d*3,f?f.indexBuffer.ref.value:c*3),groups:je.create(Float32Array,1,d,f?f.groupBuffer.ref.value:c),mesh:f}}e.createState=t;function r(c,d,f,p){var h=c.vertices,v=c.normals,m=c.indices,g=c.groups,y=c.currentGroup,b=h.elementCount;Uo(h,d[0],d[1],d[2]),Uo(h,f[0],f[1],f[2]),Uo(h,p[0],p[1],p[2]),_ue(kn,d,f,p);for(var x=0;x<3;++x)Uo(v,kn[0],kn[1],kn[2]),v2(g,y);Uo(m,b,b+1,b+2)}e.addTriangle=r;function n(c,d,f){Li(Nc,d,f[0]*3),Li(Lm,d,f[1]*3);for(var p=2,h=f.length;p<h;p+=2)xE(lu,Nc),xE(As,Lm),Li(Nc,d,f[p]*3),Li(Lm,d,f[p+1]*3),r(c,lu,As,Nc),r(c,As,Lm,Nc)}e.addTriangleStrip=n;function a(c,d,f){Li(lu,d,f[0]*3);for(var p=2,h=f.length;p<h;++p)Li(As,d,f[p-1]*3),Li(Nc,d,f[p]*3),r(c,lu,Nc,As)}e.addTriangleFan=a;function i(c,d,f){for(var p=f.vertices,h=f.normals,v=f.indices,m=c.vertices,g=c.normals,y=c.indices,b=c.groups,x=c.currentGroup,S=m.elementCount,_=_E(SE,d),A=0,T=p.length;A<T;A+=3)Nm(kn,Li(kn,p,A),d),Uo(m,kn[0],kn[1],kn[2]),CE(kn,Li(kn,h,A),_),Uo(g,kn[0],kn[1],kn[2]),v2(b,x);for(var A=0,T=v.length;A<T;A+=3)Uo(y,v[A]+S,v[A+1]+S,v[A+2]+S)}e.addPrimitive=i;function o(c,d,f){for(var p=f.vertices,h=f.normals,v=f.indices,m=c.vertices,g=c.normals,y=c.indices,b=c.groups,x=c.currentGroup,S=m.elementCount,_=_E(SE,d),A=0,T=p.length;A<T;A+=3)Nm(kn,Li(kn,p,A),d),Uo(m,kn[0],kn[1],kn[2]),CE(kn,Li(kn,h,A),_),Uo(g,-kn[0],-kn[1],-kn[2]),v2(b,x);for(var A=0,T=v.length;A<T;A+=3)Uo(y,v[A+2]+S,v[A+1]+S,v[A]+S)}e.addPrimitiveFlipped=o;function s(c,d,f,p,h,v){for(var m=f.vertices,g=f.edges,y={radiusTop:p,radiusBottom:p,radialSegments:v},b=0,x=g.length;b<x;b+=2)Li(lu,m,g[b]*3),Li(As,m,g[b+1]*3),Nm(lu,lu,d),Nm(As,As,d),la(c,lu,p,h),la(c,As,p,h),$a(c,lu,As,1,y)}e.addCage=s;function u(c,d,f){i(c,d,{vertices:f.vertexBuffer.ref.value.subarray(0,f.vertexCount*3),normals:f.normalBuffer.ref.value.subarray(0,f.vertexCount*3),indices:f.indexBuffer.ref.value.subarray(0,f.triangleCount*3)})}e.addMesh=u;function l(c){var d=c.vertices,f=c.normals,p=c.indices,h=c.groups,v=c.mesh,m=je.compact(d,!0),g=je.compact(p,!0),y=je.compact(f,!0),b=je.compact(h,!0);return Lt.create(m,g,y,b,c.vertices.elementCount,c.indices.elementCount,v)}e.getMesh=l})(_t||(_t={}));var wue=1,Aue="Assigns sizes as defined by the shape object.",tF={};function Pue(e){return tF}function x3(e,t){return{factory:x3,granularity:"groupInstance",size:function(r){return si.isLocation(r)?r.shape.getSize(r.group,r.instance):wue},props:t,description:Aue}}var Tue={name:"shape-group",label:"Shape Group",category:"",factory:x3,getParams:Pue,defaultValues:E.getDefaultValues(tF),isApplicable:function(e){return!!e.shape}},Eue=it(13421772),Iue="Assigns colors as defined by the shape object.",rF={};function Mue(e){return rF}function C3(e,t){return{factory:C3,granularity:"groupInstance",color:function(r){return si.isLocation(r)?r.shape.getColor(r.group,r.instance):Eue},props:t,description:Iue}}var Due={name:"shape-group",label:"Shape Group",category:"Miscellaneous",factory:C3,getParams:Mue,defaultValues:E.getDefaultValues(rF),isApplicable:function(e){return!!e.shape}},nF=ti();function pl(e,t,r){return{id:nF(),materialId:e.materialId,values:t,state:r,render:function(n,a){t.uAlpha&&t.alpha&&k.updateIfChanged(t.uAlpha,Ka(t.alpha.ref.value*r.alphaFactor,0,1)),e.render(n,a)},getProgram:function(n){return e.getProgram(n)},update:function(){return e.update()},dispose:function(){return e.destroy()}}}function xa(e,t){return{id:nF(),values:t,render:function(){return e.render("compute")},update:function(){return e.update()},dispose:function(){return e.destroy()}}}var Rue=ti();function Oue(e,t){var r=e.gl;switch(t){case"points":return r.POINTS;case"lines":return r.LINES;case"line-strip":return r.LINE_STRIP;case"line-loop":return r.LINE_LOOP;case"triangles":return r.TRIANGLES;case"triangle-strip":return r.TRIANGLE_STRIP;case"triangle-fan":return r.TRIANGLE_FAN}}var Fue={colorBlended:"",colorWboit:"",pickObject:"",pickInstance:"",pickGroup:"",depth:""},kue=Object.keys(Fue),Bue={compute:""},Lue=Object.keys(Bue);function wE(e,t,r,n,a){return r=w(w({},r),{dRenderVariant:k.create(t)}),a.dRenderVariant===void 0&&Object.defineProperty(a,"dRenderVariant",{value:$t("string")}),e.resources.program(r,n,a)}function Nue(){return{attributes:!1,defines:!1,elements:!1,textures:!1}}function Uue(e){e.attributes=!1,e.defines=!1,e.elements=!1,e.textures=!1}function hl(e,t,r,n,a,i){return aF(e,t,r,n,a,i,kue)}function Ca(e,t,r,n,a,i){return i===void 0&&(i=-1),aF(e,t,r,n,a,i,Lue)}function aF(e,t,r,n,a,i,o){var s=Rue(),u=e.stats,l=e.state,c=e.resources,d=e.extensions,f=d.instancedArrays,p=d.vertexArrayObject;if(a.uVertexCount){var h=a.uVertexCount.ref.value;a.aVertex=k.create(Mo(new Float32Array(h))),n.aVertex=Vr("float32",1,0)}for(var v=Zae(n,a),m=v.attributeValues,g=v.defineValues,y=v.textureValues,b=v.uniformValues,x=v.materialUniformValues,S=v.bufferedUniformValues,_=Object.entries(b),A=Object.entries(x),T=Object.entries(S),I=Object.entries(Boe(S)),M=Object.entries(g),O=Jae(a),D=Oue(e,t),F={},G=0,N=o;G<N.length;G++){var z=N[G];F[z]=wE(e,z,g,r,n)}var $=Wse(e,n,y),j=Goe(e,n,m),Z,q=a.elements;q&&q.ref.value&&(Z=c.elements(q.ref.value));for(var te={},he=0,W=o;he<W.length;he++){var z=W[he];te[z]=p?c.vertexArray(F[z],j,Z):null}var K=a.drawCount.ref.value,U=a.instanceCount.ref.value;u.drawCount+=K,u.instanceCount+=U,u.instancedDrawCount+=U*K;var H=Nue(),J=!1,X=-1;return{id:s,materialId:i,getProgram:function(Q){return F[Q]},render:function(Q,ee){if(!(K===0||U===0||e.isContextLost)){var le=F[Q];if(le.id===X&&l.currentRenderItemId===s)le.setUniforms(_),ee&&ee.length>0?(le.bindTextures(ee,0),le.bindTextures($,ee.length)):le.bindTextures($,0);else{var ye=te[Q];(le.id!==l.currentProgramId||le.id!==X||i===-1||i!==l.currentMaterialId)&&(le.id!==l.currentProgramId&&le.use(),le.setUniforms(A),l.currentMaterialId=i,X=le.id),le.setUniforms(_),le.setUniforms(I),ee&&ee.length>0?(le.bindTextures(ee,0),le.bindTextures($,ee.length)):le.bindTextures($,0),ye?(ye.bind(),Z&&Z.bind()):(Z&&Z.bind(),le.bindAttributes(j)),l.currentRenderItemId=s}if(Ir)try{b3(e.gl)}catch(be){throw new Error("Framebuffer error rendering item id "+s+": '"+be+"'")}if(Z?f.drawElementsInstanced(D,K,Z._dataType,0,U):f.drawArraysInstanced(D,0,K,U),Ir)try{jO(e.gl)}catch(be){throw new Error("Draw error rendering item id "+s+": '"+be+"'")}}},update:function(){if(Uue(H),a.aVertex){var Q=a.uVertexCount.ref.value;a.aVertex.ref.value.length<Q&&k.update(a.aVertex,Mo(new Float32Array(Q)))}for(var ee=0,le=M.length;ee<le;++ee){var ye=M[ee],be=ye[0],Ae=ye[1];Ae.ref.version!==O[be]&&(H.defines=!0,O[be]=Ae.ref.version)}if(H.defines)for(var xe=0,ae=o;xe<ae.length;xe++){var be=ae[xe];F[be].destroy(),F[be]=wE(e,be,g,r,n)}a.drawCount.ref.version!==O.drawCount&&(u.drawCount+=a.drawCount.ref.value-K,u.instancedDrawCount+=U*a.drawCount.ref.value-U*K,K=a.drawCount.ref.value,O.drawCount=a.drawCount.ref.version),a.instanceCount.ref.version!==O.instanceCount&&(u.instanceCount+=a.instanceCount.ref.value-U,u.instancedDrawCount+=a.instanceCount.ref.value*K-U*K,U=a.instanceCount.ref.value,O.instanceCount=a.instanceCount.ref.version);for(var ee=0,le=j.length;ee<le;++ee){var oe=j[ee],be=oe[0],R=oe[1],Ae=m[be];if(Ae.ref.version!==O[be]){if(R.length>=Ae.ref.value.length)R.updateSubData(Ae.ref.value,0,R.length);else{R.destroy();var V=n[be],pe=V.itemSize,_e=V.divisor;j[ee][1]=c.attribute(Ae.ref.value,pe,_e),H.attributes=!0}O[be]=Ae.ref.version}}if(Z&&a.elements.ref.version!==O.elements&&(Z.length>=a.elements.ref.value.length?Z.updateSubData(a.elements.ref.value,0,Z.length):(Z.destroy(),Z=c.elements(a.elements.ref.value),H.elements=!0),O.elements=a.elements.ref.version),H.attributes||H.defines||H.elements)for(var Ee=0,Ve=o;Ee<Ve.length;Ee++){var be=Ve[Ee],He=te[be];He&&He.destroy(),te[be]=p?c.vertexArray(F[be],j,Z):null}for(var ee=0,le=$.length;ee<le;++ee){var Ye=$[ee],be=Ye[0],lt=Ye[1],Ae=y[be];Ae.ref.version!==O[be]&&(n[be].kind!=="texture"?(lt.load(Ae.ref.value),H.textures=!0):$[ee][1]=Ae.ref.value,O[be]=Ae.ref.version)}for(var ee=0,le=T.length;ee<le;++ee){var Le=T[ee],be=Le[0],Qe=Le[1];Qe.ref.version!==O[be]&&(k.update(I[ee][1],hc(Qe.ref.value)),O[be]=Qe.ref.version)}return H},destroy:function(){if(!J){for(var Q=0,ee=o;Q<ee.length;Q++){var le=ee[Q];F[le].destroy();var ye=te[le];ye&&ye.destroy()}$.forEach(function(be){var Ae=be[0],xe=be[1];n[Ae].kind!=="texture"&&xe.destroy()}),j.forEach(function(be){be[0];var Ae=be[1];return Ae.destroy()}),Z&&Z.destroy(),u.drawCount-=K,u.instanceCount-=U,u.instancedDrawCount-=U*K,J=!0}}}}var zue=w(w({},fl),{aPosition:Vr("float32",3,0),elements:Qd("uint32"),uColor:qe("v3"),uColorTexDim:qe("v2"),tColor:ur("image-uint8","rgb","ubyte","nearest"),dColorType:$t("string",["uniform","attribute","instance","group","groupInstance","vertex","vertexInstance"]),uIsoValue:qe("v2"),uBboxMin:qe("v3"),uBboxMax:qe("v3"),uBboxSize:qe("v3"),uMaxSteps:qe("i"),uStepScale:qe("f"),uJumpLength:qe("f"),uTransform:qe("m4"),uGridDim:qe("v3"),dRenderMode:$t("string",["isosurface","volume"]),dSingleLayer:$t("boolean"),tTransferTex:ur("image-uint8","rgba","ubyte","linear"),uTransferScale:qe("f"),dGridTexType:$t("string",["2d","3d"]),uGridTexDim:qe("v3"),tGridTex:ur("texture","rgba","ubyte","linear"),uGridStats:qe("v4"),uCellDim:qe("v3"),uCartnToUnit:qe("m4"),uUnitToCartn:qe("m4"),dPackedGroup:$t("boolean"),dDoubleSided:$t("boolean"),dFlipSided:$t("boolean"),dFlatShaded:$t("boolean"),dIgnoreLight:$t("boolean"),dXrayShaded:$t("boolean")});function Vue(e,t,r,n,a){var i=w(w(w(w({},ll),cl),dl),zue);e.isWebGL2||(i.uMaxSteps=$t("number"));var o={uObjectId:k.create(t)},s=moe,u=hl(e,"triangles",s,i,w(w({},r),o),a);return pl(u,r,n)}var Hue=w(w({},fl),{aGroup:Vr("float32",1,0),aPosition:Vr("float32",3,0),aNormal:Vr("float32",3,0),elements:Qd("uint32"),dFlatShaded:$t("boolean"),dDoubleSided:$t("boolean"),dFlipSided:$t("boolean"),dIgnoreLight:$t("boolean"),dXrayShaded:$t("boolean"),meta:Zn("unknown")});function Gue(e,t,r,n,a){var i=w(w(w(w({},ll),cl),dl),Hue),o={uObjectId:k.create(t)},s=VO,u=hl(e,"triangles",s,i,w(w({},r),o),a);return pl(u,r,n)}var que=w(w(w({},fl),kv),{aGroup:Vr("float32",1,0),aPosition:Vr("float32",3,0),dPointSizeAttenuation:$t("boolean"),dPointFilledCircle:$t("boolean"),uPointEdgeBleach:qe("f")});function jue(e,t,r,n,a){var i=w(w(w(w({},ll),cl),dl),que),o={uObjectId:k.create(t)},s=doe,u=hl(e,"points",s,i,w(w({},r),o),a);return pl(u,r,n)}var Wue=w(w(w({},fl),kv),{aGroup:Vr("float32",1,0),aMapping:Vr("float32",2,0),aStart:Vr("float32",3,0),aEnd:Vr("float32",3,0),elements:Qd("uint32"),dLineSizeAttenuation:$t("boolean"),dDoubleSided:$t("boolean"),dFlipSided:$t("boolean")});function Xue(e,t,r,n,a){var i=w(w(w(w({},ll),cl),dl),Wue),o={uObjectId:k.create(t)},s=voe,u=hl(e,"triangles",s,i,w(w({},r),o),a);return pl(u,r,n)}var Yue=w(w(w({},fl),kv),{aGroup:Vr("float32",1,0),aPosition:Vr("float32",3,0),aMapping:Vr("float32",2,0),elements:Qd("uint32"),padding:Zn("number"),dDoubleSided:$t("boolean"),dIgnoreLight:$t("boolean"),dXrayShaded:$t("boolean")});function Kue(e,t,r,n,a){var i=w(w(w(w({},ll),cl),dl),Yue),o={uObjectId:k.create(t)},s=foe,u=hl(e,"triangles",s,i,w(w({},r),o),a);return pl(u,r,n)}var $ue=w(w(w({},fl),kv),{aGroup:Vr("float32",1,0),aPosition:Vr("float32",3,0),aMapping:Vr("float32",2,0),aDepth:Vr("float32",1,0),elements:Qd("uint32"),aTexCoord:Vr("float32",2,0),tFont:ur("image-uint8","alpha","ubyte","linear"),padding:Zn("number"),uBorderWidth:qe("f"),uBorderColor:qe("v3"),uOffsetX:qe("f"),uOffsetY:qe("f"),uOffsetZ:qe("f"),uBackgroundColor:qe("v3"),uBackgroundOpacity:qe("f")});function Que(e,t,r,n,a){var i=w(w(w(w({},ll),cl),dl),$ue),o={uObjectId:k.create(t)},s=hoe,u=hl(e,"triangles",s,i,w(w({},r),o),a);return pl(u,r,n)}var Zue=w(w({},fl),{uGeoTexDim:qe("v2","buffered"),tPosition:ur("texture","rgb","float","nearest"),tGroup:ur("texture","alpha","float","nearest"),tNormal:ur("texture","rgb","float","nearest"),dFlatShaded:$t("boolean"),dDoubleSided:$t("boolean"),dFlipSided:$t("boolean"),dIgnoreLight:$t("boolean"),dXrayShaded:$t("boolean"),dGeoTexture:$t("boolean")});function Jue(e,t,r,n,a){var i=w(w(w(w({},ll),cl),dl),Zue),o={uObjectId:k.create(t)},s=VO,u=hl(e,"triangles",s,i,w(w({},r),o),a);return pl(u,r,n)}var ele=w(w({},fl),{aGroup:Vr("float32",1,0),aPosition:Vr("float32",3,0),aUv:Vr("float32",2,0),elements:Qd("uint32"),uImageTexDim:qe("v2"),tImageTex:ur("image-uint8","rgba","ubyte","nearest"),tGroupTex:ur("image-uint8","rgba","ubyte","nearest"),dInterpolation:$t("string",oie)});function tle(e,t,r,n,a){var i=w(w(w(w({},ll),cl),dl),ele),o={uObjectId:k.create(t)},s=goe,u=hl(e,"triangles",s,i,w(w({},r),o),a);return pl(u,r,n)}var rle=w(w(w({},fl),kv),{aGroup:Vr("float32",1,0),aStart:Vr("float32",3,0),aEnd:Vr("float32",3,0),aMapping:Vr("float32",3,0),aScale:Vr("float32",1,0),aCap:Vr("float32",1,0),elements:Qd("uint32"),padding:Zn("number"),dDoubleSided:$t("boolean"),dIgnoreLight:$t("boolean"),dXrayShaded:$t("boolean")});function nle(e,t,r,n,a){var i=w(w(w(w({},ll),cl),dl),rle),o={uObjectId:k.create(t)},s=poe,u=hl(e,"triangles",s,i,w(w({},r),o),a);return pl(u,r,n)}var ale=ti(0,2147483647),vl=ti(0,2147483647);function kp(e,t,r,n){return{id:ale(),type:e,values:t,state:r,materialId:n}}function ile(e,t){switch(t.type){case"mesh":return Gue(e,t.id,t.values,t.state,t.materialId);case"points":return jue(e,t.id,t.values,t.state,t.materialId);case"spheres":return Kue(e,t.id,t.values,t.state,t.materialId);case"cylinders":return nle(e,t.id,t.values,t.state,t.materialId);case"text":return Que(e,t.id,t.values,t.state,t.materialId);case"lines":return Xue(e,t.id,t.values,t.state,t.materialId);case"direct-volume":return Vue(e,t.id,t.values,t.state,t.materialId);case"image":return tle(e,t.id,t.values,t.state,t.materialId);case"texture-mesh":return Jue(e,t.id,t.values,t.state,t.materialId)}throw new Error("unsupported type")}var Rr;(function(e){function t(c,d,f,p,h,v,m){return{id:un.create22(),name:c,sourceData:d,geometry:f,transforms:m||[ue.identity()],get groupCount(){return Ma.getGroupCount(f)},getColor:p,getSize:h,getLabel:v}}e.create=t;function r(c){return{color:C3({shape:c},{}),size:x3({shape:c},{})}}e.getTheme=r;function n(c){var d=c.transforms.length,f=si.Location(c),p=function(h,v){return f.group=h,f.instance=v,f};return pn(c.groupCount,d,1,p)}e.groupIterator=n;function a(c,d){for(var f=d&&d.aTransform.ref.value.length>=c.length*16?d.aTransform.ref.value:new Float32Array(c.length*16),p=0,h=c.length;p<h;++p)ue.toArray(c[p],f,p*16);return X_(f,c.length,d)}e.createTransform=a;function i(c,d){var f=e.getTheme(c),p=Ma.getUtils(c.geometry),h=vl(),v=n(c),m=e.createTransform(c.transforms),g=p.createValues(c.geometry,m,v,f,d),y=p.createRenderableState(d);return kp(c.geometry.kind,g,y,h)}e.createRenderObject=i;function o(c){return{kind:"shape-loci",shape:c}}e.Loci=o;function s(c){return!!c&&c.kind==="shape-loci"}e.isLoci=s;function u(c,d){return c.shape===d.shape}e.areLociEqual=u;function l(c){return c.shape.groupCount===0}e.isLociEmpty=l})(Rr||(Rr={}));var si;(function(e){function t(p,h,v){return h===void 0&&(h=0),v===void 0&&(v=0),{kind:"group-location",shape:p,group:h,instance:v}}e.Location=t;function r(p){return!!p&&p.kind==="group-location"}e.isLocation=r;function n(p,h){return{kind:"group-loci",shape:p,groups:h}}e.Loci=n;function a(p){return!!p&&p.kind==="group-loci"}e.isLoci=a;function i(p,h){if(p.shape!==h.shape||p.groups.length!==h.groups.length)return!1;for(var v=0,m=p.groups.length;v<m;++v){var g=p.groups[v],y=g.ids,b=g.instance,x=h.groups[v],S=x.ids,_=x.instance;if(b!==_||!ke.areEqual(y,S))return!1}return!0}e.areLociEqual=i;function o(p){return s(p)===0}e.isLociEmpty=o;function s(p){for(var h=0,v=0,m=p.groups;v<m.length;v++){var g=m[v];h+=ke.size(g.ids)}return h}e.size=s;var u=new qu,l=C.zero();function c(p,h,v,m){for(var g=h.indices,y=h.offsets,b=function(I,M){ke.forEach(I,function(O){for(var D=y[O],F=y[O+1];D<F;++D)C.fromArray(l,v,g[D]*3),C.transformMat4(l,l,m[M]),u.includeStep(l)})},x=0,S=p;x<S.length;x++){var _=S[x],A=_.ids,T=_.instance;b(A,T)}}function d(p,h,v,m){for(var g=h.indices,y=h.offsets,b=function(I,M){ke.forEach(I,function(O){for(var D=y[O],F=y[O+1];D<F;++D)C.fromArray(l,v,g[D]*3),C.transformMat4(l,l,m[M]),u.radiusStep(l)})},x=0,S=p;x<S.length;x++){var _=S[x],A=_.ids,T=_.instance;b(A,T)}}function f(p,h){h||(h=Ne()),u.reset();var v=0,m=p.shape,g=m.geometry,y=m.transforms;if(g.kind==="mesh"||g.kind==="points"){var b=g.kind==="mesh"?g.vertexBuffer.ref.value:g.centerBuffer.ref.value;c(p.groups,g.groupMapping,b,y),u.finishedIncludeStep(),d(p.groups,g.groupMapping,b,y)}else if(g.kind==="lines"){var x=g.startBuffer.ref.value,S=g.endBuffer.ref.value;c(p.groups,g.groupMapping,x,y),c(p.groups,g.groupMapping,S,y),u.finishedIncludeStep(),d(p.groups,g.groupMapping,x,y),d(p.groups,g.groupMapping,S,y)}else if(g.kind==="spheres"||g.kind==="text"){var b=g.centerBuffer.ref.value;c(p.groups,g.groupMapping,b,y),u.finishedIncludeStep(),d(p.groups,g.groupMapping,b,y);for(var _=function(F,G){ke.forEach(F,function(N){var z=p.shape.getSize(N,G);v<z&&(v=z)})},A=0,T=p.groups;A<T.length;A++){var I=T[A],M=I.ids,O=I.instance;_(M,O)}}else return Ne.copy(h,g.boundingSphere);return C.copy(h.center,u.center),h.radius=Math.sqrt(u.radiusSq),Ne.expand(h,h,v),h}e.getBoundingSphere=f})(si||(si={}));function iF(e){var t=e&&e.getElement("vertex"),r=e&&e.getElement("material"),n={group:"",vRed:"",vGreen:"",vBlue:"",mRed:"",mGreen:"",mBlue:""},a=[["",""]],i=[["",""]];if(t){for(var o=0,s=t.propertyNames.length;o<s;++o){var u=t.propertyNames[o],l=t.propertyTypes[o];(l==="uchar"||l==="uint8"||l==="ushort"||l==="uint16"||l==="uint"||l==="uint32"||l==="int")&&a.push([u,u]),(l==="uchar"||l==="uint8")&&i.push([u,u])}t.propertyNames.includes("atomid")?n.group="atomid":t.propertyNames.includes("material_index")&&(n.group="material_index"),t.propertyNames.includes("red")&&(n.vRed="red"),t.propertyNames.includes("green")&&(n.vGreen="green"),t.propertyNames.includes("blue")&&(n.vBlue="blue")}var c=[["",""]];if(r){for(var o=0,s=r.propertyNames.length;o<s;++o){var d=r.propertyNames[o],l=r.propertyTypes[o];(l==="uchar"||l==="uint8")&&c.push([d,d])}r.propertyNames.includes("red")&&(n.mRed="red"),r.propertyNames.includes("green")&&(n.mGreen="green"),r.propertyNames.includes("blue")&&(n.mBlue="blue")}var f=n.vRed&&n.vGreen&&n.vBlue?"vertex":n.mRed&&n.mGreen&&n.mBlue?"material":"uniform";return w(w({},Lt.Params),{coloring:E.MappedStatic(f,{vertex:E.Group({red:E.Select(n.vRed,i,{label:"Red Property"}),green:E.Select(n.vGreen,i,{label:"Green Property"}),blue:E.Select(n.vBlue,i,{label:"Blue Property"})},{isFlat:!0}),material:E.Group({red:E.Select(n.mRed,c,{label:"Red Property"}),green:E.Select(n.mGreen,c,{label:"Green Property"}),blue:E.Select(n.mBlue,c,{label:"Blue Property"})},{isFlat:!0}),uniform:E.Group({color:E.Color(dr.grey)},{isFlat:!0})}),grouping:E.MappedStatic(n.group?"vertex":"none",{vertex:E.Group({group:E.Select(n.group,a,{label:"Group Property"})},{isFlat:!0}),none:E.Group({})})})}var AE=iF();function ole(e,t,r,n,a){var i=r.vertices,o=r.normals,s=r.groups,u=n.getProperty("x"),l=n.getProperty("y"),c=n.getProperty("z");if(!u||!l||!c)throw new Error("missing coordinate properties");for(var d=n.getProperty("nx"),f=n.getProperty("ny"),p=n.getProperty("nz"),h=!!d&&!!f&&!!p,v=e;v<t;++v)je.add3(i,u.value(v),l.value(v),c.value(v)),h&&je.add3(o,d.value(v),f.value(v),p.value(v)),je.add(s,a[v])}function sle(e,t,r,n){for(var a=r.indices,i=e;i<t;++i){var o=n.value(i),s=o.entries,u=o.count;u===3?je.add3(a,s[0],s[1],s[2]):u===4&&(je.add3(a,s[2],s[1],s[0]),je.add3(a,s[2],s[0],s[3]))}}function ule(e,t,r,n,a){return ce(this,void 0,void 0,function(){var i,o,s,u,l,c,d,f,p,h,v,h,v,m;return de(this,function(g){switch(g.label){case 0:if(i=_t.createState(t.rowCount,t.rowCount/4,a),o=t.getProperty("x"),s=t.getProperty("y"),u=t.getProperty("z"),!o||!s||!u)throw new Error("missing coordinate properties");l=t.getProperty("nx"),c=t.getProperty("ny"),d=t.getProperty("nz"),f=!!l&&!!c&&!!d,p=1e5,h=0,v=t.rowCount,g.label=1;case 1:return h<v?(ole(h,Math.min(h+p,v),i,t,n),e.shouldUpdate?[4,e.update({message:"adding ply mesh vertices",current:h,max:v})]:[3,3]):[3,4];case 2:g.sent(),g.label=3;case 3:return h+=p,[3,1];case 4:h=0,v=r.rowCount,g.label=5;case 5:return h<v?(sle(h,Math.min(h+p,v),i,r),e.shouldUpdate?[4,e.update({message:"adding ply mesh faces",current:h,max:v})]:[3,7]):[3,8];case 6:g.sent(),g.label=7;case 7:return h+=p,[3,5];case 8:return m=_t.getMesh(i),f||Lt.computeNormals(m),[2,m]}})})}var cu=ve.Schema.int;function lle(e,t){for(var r=t.grouping,n=e.rowCount,a=r.name==="vertex"?e.getProperty(r.params.group):void 0,i=r.name==="vertex"?ji(r.params.group):"Vertex",o=a?a.toArray({array:Uint32Array}):Mo(new Uint32Array(n)),s=a?Gs(o):n-1,u=new Uint32Array(s+1),l=0,c=o.length;l<c;++l)u[o[l]]=l;return{ids:o,map:u,label:i}}function PE(e,t,r){var n=r.coloring,a=e.rowCount,i,o,s;if(n.name==="vertex")i=e.getProperty(n.params.red)||ve.ofConst(127,a,cu),o=e.getProperty(n.params.green)||ve.ofConst(127,a,cu),s=e.getProperty(n.params.blue)||ve.ofConst(127,a,cu);else if(n.name==="material")i=t&&t.getProperty(n.params.red)||ve.ofConst(127,a,cu),o=t&&t.getProperty(n.params.green)||ve.ofConst(127,a,cu),s=t&&t.getProperty(n.params.blue)||ve.ofConst(127,a,cu);else{var u=it.toRgb(n.params.color),l=u[0],c=u[1],d=u[2];i=ve.ofConst(l,a,cu),o=ve.ofConst(c,a,cu),s=ve.ofConst(d,a,cu)}return{kind:n.name,red:i,green:o,blue:s}}function TE(e,t,r,n){var a=r.kind,i=r.red,o=r.green,s=r.blue,u=n.ids,l=n.map,c=n.label;return Rr.create("ply-mesh",e,t,function(d){var f=a==="material"?d:l[d];return it.fromRgb(i.value(f),o.value(f),s.value(f))},function(){return 1},function(d){return c+" "+u[d]})}function cle(){var e=this,t,r,n,a,i,o,s=function(u,l,c,d){return ce(e,void 0,void 0,function(){var f,p,h,v,m;return de(this,function(g){switch(g.label){case 0:if(f=l.getElement("vertex"),!f)throw new Error("missing vertex element");if(p=l.getElement("face"),!p)throw new Error("missing face element");return h=l.getElement("material"),v=!1,m=!1,(!t||t!==l)&&(v=!0),(!r||!E.isParamEqual(AE.grouping,r.grouping,c.grouping))&&(v=!0),(!r||!E.isParamEqual(AE.coloring,r.coloring,c.coloring))&&(m=!0),v?(i=PE(f,h,c),o=lle(f,c),[4,ule(u,f,p,o.ids,d&&d.geometry)]):[3,2];case 1:return a=g.sent(),n=TE(l,a,i,o),[3,3];case 2:m&&(i=PE(f,h,c),n=TE(l,a,i,o)),g.label=3;case 3:return t=l,r=hc(c),[2,n]}})})};return s}function dle(e,t){var r=this;return We.create("Shape Provider",function(n){return ce(r,void 0,void 0,function(){return de(this,function(a){return[2,{label:"Mesh",data:e,params:iF(e),getShape:cle(),geometryUtils:Lt.Utils}]})})})}function _d(){return _d.empty()}(function(e){function t(a,i){return{size:a,anglesInRadians:i}}e.create=t;function r(){return t(C(),C())}e.empty=r;function n(a,i,o){var s=C.magnitude(a),u=C.magnitude(i),l=C.magnitude(o),c=Math.acos(C.dot(i,o)/(u*l)),d=Math.acos(C.dot(a,o)/(s*l)),f=Math.acos(C.dot(a,i)/(s*u));return s<=0||u<=0||l<=0||c>=Math.PI||d>=Math.PI||f>=Math.PI?r():t(C.create(s,u,l),C.create(c,d,f))}e.fromBasis=n})(_d||(_d={}));var fle=20.45482949774598;function ple(e){var t=this;return We.create("Parse DCD",function(r){return ce(t,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d;return de(this,function(f){switch(f.label){case 0:return[4,r.update("Converting to coordinates")];case 1:for(f.sent(),n=e.header,a=n.DELTA?Wl(n.DELTA*fle,"ps"):Wl(1,"step"),i=n.ISTART>=1?Wl((n.ISTART-1)*a.value,a.unit):Wl(0,a.unit),o=[],s=0,u=e.frames.length;s<u;++s)l=e.frames[s],c={elementCount:l.elementCount,time:Wl(i.value+a.value*s,a.unit),x:l.x,y:l.y,z:l.z,xyzOrdering:{isIdentity:!0}},l.cell&&(d=l.cell,d[1]>=-1&&d[1]<=1&&d[3]>=-1&&d[3]<=1&&d[4]>=-1&&d[4]<=1?c.cell=_d.create(C.create(d[0],d[2],d[5]),C.create(Wr(90-Math.asin(d[1])*90/Nh),Wr(90-Math.asin(d[3])*90/Nh),Wr(90-Math.asin(d[4])*90/Nh))):d[0]<0||d[1]<0||d[2]<0||d[3]<0||d[4]<0||d[5]<0||d[3]>180||d[4]>180||d[5]>180?c.cell=_d.fromBasis(C.create(d[0],d[1],d[3]),C.create(d[1],d[2],d[4]),C.create(d[3],d[4],d[5])):c.cell=_d.create(C.create(d[0],d[2],d[5]),C.create(Wr(cn(d[1],0,fn)?90:d[1]),Wr(cn(d[3],0,fn)?90:d[3]),Wr(cn(d[4],0,fn)?90:d[4])))),o.push(c);return[2,fv.create(o,a,i)]}})})})}function Mg(e,t,r,n){for(var a=r,i=n-1,o=t.charCodeAt(a);(o===32||o>=48&&o<=57)&&a<=i;)o=t.charCodeAt(++a);for(o=t.charCodeAt(i);(o===32||o>=48&&o<=57)&&i>=a;)o=t.charCodeAt(--i);if(++i,a===i||a+1===i)return pt.add(e,a,i);if(o=t.charCodeAt(a),a+2===i){var s=t.charCodeAt(a+1);if((o===78||o===110)&&(s===65||s===97)||(o===67||o===99)&&(s===76||s===108)||(o===70||o===102)&&(s===69||s===101)||(o===83||o===115)&&(s===73||s===105)||(o===66||o===98)&&(s===82||s===114)||(o===65||o===97)&&(s===83||s===115))return pt.add(e,a,a+2)}if(o===67||o===99||o===72||o===104||o===78||o===110||o===79||o===111||o===80||o===112||o===83||o===115)return pt.add(e,a,a+1);pt.add(e,a,a)}var hle=/^[\s\d]+|[\s\d]+$/g;function t1(e){e=e.replace(hle,"").toUpperCase();var t=e.length;if(t===0||t===1||t===2&&(e==="NA"||e==="CL"||e==="FE"||e==="SI"||e==="BR"||e==="AS"))return e;if(t===3){if(e==="SOD")return"NA";if(e==="POT")return"K";if(e==="CES")return"CS";if(e==="CAL")return"CA";if(e==="CLA")return"CL"}var r=e[0];return r==="C"||r==="H"||r==="N"||r==="O"||r==="P"||r==="S"?r:""}var vle=[new Set(["CA"]),new Set(["C"]),new Set(["N"])],mle=[new Set(["P","O3'","O3*"]),new Set(["C4'","C4*"]),new Set(["O2'","O2*","F2'","F2*"])],gle=[new Set(["P","O3'","O3*"]),new Set(["C3'","C3*"]),new Set(["O2'","O2*","F2'","F2*"])],yle=new Set(["FMN","NCN","FNS","FMA"]),EE=function(){var e=new Map,t=[{id:"HIS",name:"HISTIDINE",type:"L-peptide linking"},{id:"ARG",name:"ARGININE",type:"L-peptide linking"},{id:"LYS",name:"LYSINE",type:"L-peptide linking"},{id:"ILE",name:"ISOLEUCINE",type:"L-peptide linking"},{id:"PHE",name:"PHENYLALANINE",type:"L-peptide linking"},{id:"LEU",name:"LEUCINE",type:"L-peptide linking"},{id:"TRP",name:"TRYPTOPHAN",type:"L-peptide linking"},{id:"ALA",name:"ALANINE",type:"L-peptide linking"},{id:"MET",name:"METHIONINE",type:"L-peptide linking"},{id:"CYS",name:"CYSTEINE",type:"L-peptide linking"},{id:"ASN",name:"ASPARAGINE",type:"L-peptide linking"},{id:"VAL",name:"VALINE",type:"L-peptide linking"},{id:"GLY",name:"GLYCINE",type:"peptide linking"},{id:"SER",name:"SERINE",type:"L-peptide linking"},{id:"GLN",name:"GLUTAMINE",type:"L-peptide linking"},{id:"TYR",name:"TYROSINE",type:"L-peptide linking"},{id:"ASP",name:"ASPARTIC ACID",type:"L-peptide linking"},{id:"GLU",name:"GLUTAMIC ACID",type:"L-peptide linking"},{id:"THR",name:"THREONINE",type:"L-peptide linking"},{id:"PRO",name:"PROLINE",type:"L-peptide linking"},{id:"SEC",name:"SELENOCYSTEINE",type:"L-peptide linking"},{id:"PYL",name:"PYRROLYSINE",type:"L-peptide linking"},{id:"MSE",name:"SELENOMETHIONINE",type:"L-peptide linking"},{id:"SEP",name:"PHOSPHOSERINE",type:"L-peptide linking"},{id:"TPO",name:"PHOSPHOTHREONINE",type:"L-peptide linking"},{id:"PTR",name:"O-PHOSPHOTYROSINE",type:"L-peptide linking"},{id:"PCA",name:"PYROGLUTAMIC ACID",type:"L-peptide linking"},{id:"A",name:"ADENOSINE-5'-MONOPHOSPHATE",type:"RNA linking"},{id:"C",name:"CYTIDINE-5'-MONOPHOSPHATE",type:"RNA linking"},{id:"T",name:"THYMIDINE-5'-MONOPHOSPHATE",type:"RNA linking"},{id:"G",name:"GUANOSINE-5'-MONOPHOSPHATE",type:"RNA linking"},{id:"I",name:"INOSINIC ACID",type:"RNA linking"},{id:"U",name:"URIDINE-5'-MONOPHOSPHATE",type:"RNA linking"},{id:"DA",name:"2'-DEOXYADENOSINE-5'-MONOPHOSPHATE",type:"DNA linking"},{id:"DC",name:"2'-DEOXYCYTIDINE-5'-MONOPHOSPHATE",type:"DNA linking"},{id:"DT",name:"THYMIDINE-5'-MONOPHOSPHATE",type:"DNA linking"},{id:"DG",name:"2'-DEOXYGUANOSINE-5'-MONOPHOSPHATE",type:"DNA linking"},{id:"DI",name:"2'-DEOXYINOSINE-5'-MONOPHOSPHATE",type:"DNA linking"},{id:"DU",name:"2'-DEOXYURIDINE-5'-MONOPHOSPHATE",type:"DNA linking"}];return t.forEach(function(r){return e.set(r.id,r)}),e}(),IE=function(){var e=new Map,t=[{id:"ZN2",name:"ZINC ION",type:"Ion"},{id:"SOD",name:"SODIUM ION",type:"Ion"},{id:"CES",name:"CESIUM ION",type:"Ion"},{id:"CLA",name:"CHLORIDE ION",type:"Ion"},{id:"CAL",name:"CALCIUM ION",type:"Ion"},{id:"POT",name:"POTASSIUM ION",type:"Ion"}];return t.forEach(function(r){return e.set(r.id,r)}),e}(),Ec=function(){function e(t,r){this.seqId=t,this.atomId=r,this.namesMap=new Map,this.comps=new Map,this.ids=[],this.names=[],this.types=[],this.mon_nstd_flags=[]}return e.prototype.set=function(t){this.comps.set(t.id,t),this.ids.push(t.id),this.names.push(t.name),this.types.push(t.type),this.mon_nstd_flags.push(Rv.has(t.id)?"y":"n")},e.prototype.getAtomIds=function(t){for(var r=new Set,n=this.seqId.value(t);t<this.seqId.rowCount;){var a=this.seqId.value(t);if(a!==n)break;r.add(this.atomId.value(t)),t+=1}return r},e.prototype.hasAtomIds=function(t,r){for(var n=0,a=r.length;n<a;++n)if(!jn.areIntersecting(t,r[n]))return!1;return!0},e.prototype.getType=function(t){return this.hasAtomIds(t,vle)?"peptide linking":this.hasAtomIds(t,mle)?"RNA linking":this.hasAtomIds(t,gle)?"DNA linking":"other"},e.prototype.has=function(t){return this.comps.has(t)},e.prototype.get=function(t){return this.comps.get(t)},e.prototype.add=function(t,r){if(!this.has(t))if(EE.has(t))this.set(EE.get(t));else if(zy.has(t))this.set({id:t,name:"WATER",type:"non-polymer"});else if(yle.has(t))this.set({id:t,name:this.namesMap.get(t)||t,type:"non-polymer"});else{var n=this.getAtomIds(r);if(n.size===1&&IE.has(t))this.set(IE.get(t));else{var a=this.getType(n);this.set({id:t,name:this.namesMap.get(t)||t,type:a})}}return this.get(t)},e.prototype.getChemCompTable=function(){return Xr.ofPartialColumns(ui.chem_comp,{id:ve.ofStringArray(this.ids),name:ve.ofStringArray(this.names),type:ve.ofStringAliasArray(this.types),mon_nstd_flag:ve.ofStringAliasArray(this.mon_nstd_flags)},this.ids.length)},e.prototype.setNames=function(t){var r=this;t.forEach(function(n){return r.namesMap.set(n[0],n[1])})},e}(),m2="ABCDEFGHIJKLMNOPQRSTUVWXYZ";function ble(e){for(var t=m2.length,r=e,n=0,a=m2[r%t];r>=t;)r=Math.floor(r/t),a+=m2[r%t],n+=1;return n>=5&&console.warn("getChainId overflow"),a}var Xx=$y(ble),Ic=function(){function e(){this.count=0,this.ids=[],this.types=[],this.descriptions=[],this.compoundsMap=new Map,this.namesMap=new Map,this.heteroMap=new Map,this.chainMap=new Map}return e.prototype.set=function(t,r){this.count+=1,this.ids.push(""+this.count),this.types.push(t),this.descriptions.push([r])},e.prototype.getEntityId=function(t,r,n,a){return r===2?(this.waterId===void 0&&(this.set("water",(a==null?void 0:a.customName)||"Water"),this.waterId=""+this.count),this.waterId):t3(r)?this.compoundsMap.has(n)?this.compoundsMap.get(n):(this.chainMap.has(n)||(this.set("polymer",(a==null?void 0:a.customName)||"Polymer "+(this.chainMap.size+1)),this.chainMap.set(n,""+this.count)),this.chainMap.get(n)):(this.heteroMap.has(t)||(this.set("non-polymer",(a==null?void 0:a.customName)||this.namesMap.get(t)||t),this.heteroMap.set(t,""+this.count)),this.heteroMap.get(t))},e.prototype.getEntityTable=function(){return Xr.ofPartialColumns(ui.entity,{id:ve.ofStringArray(this.ids),type:ve.ofStringAliasArray(this.types),pdbx_description:ve.ofStringListArray(this.descriptions)},this.count)},e.prototype.setCompounds=function(t){for(var r=0,n=t.length;r<n;++r){var a=t[r],i=a.chains,o=a.description;this.set("polymer",o);for(var s=0,u=i.length;s<u;++s)this.compoundsMap.set(i[s],""+this.count)}},e.prototype.setNames=function(t){var r=this;t.forEach(function(n){return r.namesMap.set(n[0],n[1])})},e}();function Sle(e,t){for(var r=e.atomName,n=e.residueName,a=new Array(e.count),i=new Array(e.count),o=new Uint32Array(e.count),s=new Uint32Array(e.count),u=new Ic,l=new Ec(e.residueNumber,e.atomName),c="",d=0,f="",p=0,h=0,v=-1,m=0,g=e.count;m<g;++m){var y=e.residueNumber.value(m);if(y!==v){var b=e.residueName.value(m),x=Ip(l.add(b,m).type,b);(x!==h||y!==v+1&&!(v===99999&&y===0))&&(f=Xx(d),d+=1,p=0),c=u.getEntityId(b,x,f),p+=1,v=y,h=x}a[m]=c,i[m]=f,o[m]=p,s[m]=m}var S=ve.ofStringArray(i),_=Xr.ofPartialColumns(ui.atom_site,{auth_asym_id:S,auth_atom_id:r,auth_comp_id:n,auth_seq_id:e.residueNumber,Cartn_x:ve.ofFloatArray(ve.mapToArray(e.x,function(A){return A*10},Float32Array)),Cartn_y:ve.ofFloatArray(ve.mapToArray(e.y,function(A){return A*10},Float32Array)),Cartn_z:ve.ofFloatArray(ve.mapToArray(e.z,function(A){return A*10},Float32Array)),id:ve.ofIntArray(s),label_asym_id:S,label_atom_id:r,label_comp_id:n,label_seq_id:ve.ofIntArray(o),label_entity_id:ve.ofStringArray(a),occupancy:ve.ofConst(1,e.count,ve.Schema.float),type_symbol:ve.ofStringArray(ve.mapToArray(e.atomName,function(A){return t1(A)})),pdbx_PDB_model_num:ve.ofConst(t,e.count,ve.Schema.int)},e.count);return $d({entity:u.getEntityTable(),chem_comp:l.getChemCompTable(),atom_site:_})}var Yx;(function(e){function t(n){return(n==null?void 0:n.kind)==="gro"}e.is=t;function r(n){return{kind:"gro",name:n.structures[0].header.title,data:n}}e.fromGro=r})(Yx||(Yx={}));function xle(e){var t=this;return We.create("Parse GRO",function(r){return ce(t,void 0,void 0,function(){var n,a,i,o,s,u;return de(this,function(l){switch(l.label){case 0:n=Yx.fromGro(e),a=[],i=0,o=e.structures.length,l.label=1;case 1:return i<o?(s=Sle(e.structures[i].atoms,i+1),[4,al(s,n,r)]):[3,4];case 2:u=l.sent(),u.frameCount===1&&a.push(u.representative),l.label=3;case 3:return++i,[3,1];case 4:return[2,new kd(a)]}})})})}function Cle(e,t){var r=function(i,o){return(t.substr(i,o)||"").trim()},n={entry_id:xt.ofString(e),length_a:xt.ofString(r(6,9)),length_b:xt.ofString(r(15,9)),length_c:xt.ofString(r(24,9)),angle_alpha:xt.ofString(r(33,7)),angle_beta:xt.ofString(r(40,7)),angle_gamma:xt.ofString(r(47,7)),Z_PDB:xt.ofString(r(66,4)),pdbx_unique_axis:xt.ofString("?")},a={entry_id:xt.ofString(e),"space_group_name_H-M":xt.ofString(r(55,11)),Int_Tables_number:xt.ofString("?"),cell_setting:xt.ofString("?"),space_group_name_Hall:xt.ofString("?")};return[Oa.ofFields("cell",n),Oa.ofFields("symmetry",a)]}function ME(e,t){return{id:e,details:t,groups:[]}}function _le(e,t,r){for(var n=[],a,i,o,s=1,u=1,l=function(K){return e.data.substring(e.indices[2*K],e.indices[2*K+1])},c=t;c<r;c++){var d=l(c);if(d.substr(11,12)==="BIOMOLECULE:"){var f=d.substr(23).trim(),p="Biomolecule "+f;d=l(c+1),d.substr(11,30)!=="APPLY THE FOLLOWING TO CHAINS:"&&(c++,p=d.substr(11).trim()),a=ME(f,p),n.push(a)}else if(d.substr(13,5)==="BIOMT"){var h=d.split(/\s+/),v=parseInt(d[18])-1;v===0&&(o=ue.identity(),i.operators.push({id:s++,matrix:o})),ue.setValue(o,v,0,parseFloat(h[4])),ue.setValue(o,v,1,parseFloat(h[5])),ue.setValue(o,v,2,parseFloat(h[6])),ue.setValue(o,v,3,parseFloat(h[7]))}else if(d.substr(11,30)==="APPLY THE FOLLOWING TO CHAINS:"||d.substr(11,30)==="                   AND CHAINS:"){d.substr(11,5)==="APPLY"&&(i={chains:[],operators:[]},a.groups.push(i));for(var m=d.substr(41,30).split(","),g=0,y=m.length;g<y;++g){var b=m[g].trim();b&&i.chains.push(b)}}else if(d.substr(11,33)==="APPLYING THE FOLLOWING TO CHAINS:"){a=ME(""+u,"Biomolecule "+u),n.push(a),u+=1,i={chains:[],operators:[]},a.groups.push(i),c++,d=l(c);for(var m=d.substr(11,69).split(","),g=0,y=m.length;g<y;++g){var b=m[g].trim();b&&i.chains.push(b)}}}if(n.length===0)return[];for(var x={id:xt.ofStrings(n.map(function(K){return K.id})),details:xt.ofStrings(n.map(function(K){return K.details}))},S=[],_=0,A=n;_<A.length;_++)for(var T=A[_],I=0,M=T.groups;I<M.length;I++){var O=M[I];S.push({assembly_id:T.id,oper_expression:O.operators.map(function(K){return K.id}).join(","),asym_id_list:O.chains.join(",")})}for(var D={assembly_id:xt.ofStrings(S.map(function(K){return K.assembly_id})),oper_expression:xt.ofStrings(S.map(function(K){return K.oper_expression})),asym_id_list:xt.ofStrings(S.map(function(K){return K.asym_id_list}))},F=[],G=0,N=n;G<N.length;G++)for(var T=N[G],z=0,$=T.groups;z<$.length;z++)for(var j=$[z],Z=0,q=j.operators;Z<q.length;Z++){for(var te=q[Z],v={id:""+te.id,type:"?",name:"?",symmetry_operation:"?"},c=0;c<3;c++){for(var g=0;g<3;g++)v["matrix["+(c+1)+"]["+(g+1)+"]"]=""+ue.getValue(te.matrix,c,g);v["vector["+(c+1)+"]"]=""+ue.getValue(te.matrix,c,3)}F.push(v)}for(var he={id:xt.ofStrings(F.map(function(K){return K.id})),type:xt.ofStrings(F.map(function(K){return K.type})),name:xt.ofStrings(F.map(function(K){return K.name})),symmetry_operation:xt.ofStrings(F.map(function(K){return K.symmetry_operation}))},W=function(K){for(var U=function(X){var Q="matrix["+(K+1)+"]["+(X+1)+"]";he[Q]=xt.ofStrings(F.map(function(ee){return ee[Q]}))},H=0;H<3;H++)U(H);var J="vector["+(K+1)+"]";he[J]=xt.ofStrings(F.map(function(X){return X[J]}))},c=0;c<3;c++)W(c);return[Oa.ofFields("pdbx_struct_assembly",x),Oa.ofFields("pdbx_struct_assembly_gen",D),Oa.ofFields("pdbx_struct_oper_list",he)]}function wle(e,t,r){for(var n=[],a,i=function(y){return e.data.substring(e.indices[2*y],e.indices[2*y+1])},o=t;o<r;o++){var s=i(o),u=s.split(/\s+/),l=parseInt(s[5])-1;l===0&&(a=ue.identity(),n.push(a)),ue.setValue(a,l,0,parseFloat(u[2])),ue.setValue(a,l,1,parseFloat(u[3])),ue.setValue(a,l,2,parseFloat(u[4])),ue.setValue(a,l,3,parseFloat(u[5]))}if(n.length===0)return[];for(var c=[],d=1,f=0,p=n;f<p.length;f++){for(var h=p[f],l={id:"ncsop"+d++,code:".",details:"."},o=0;o<3;o++){for(var v=0;v<3;v++)l["matrix["+(o+1)+"]["+(v+1)+"]"]=""+ue.getValue(h,o,v);l["vector["+(o+1)+"]"]=""+ue.getValue(h,o,3)}c.push(l)}for(var m={id:xt.ofStrings(c.map(function(y){return y.id})),code:xt.ofStrings(c.map(function(y){return y.code})),details:xt.ofStrings(c.map(function(y){return y.details}))},g=function(y){for(var b=function(_){var A="matrix["+(y+1)+"]["+(_+1)+"]";m[A]=xt.ofStrings(c.map(function(T){return T[A]}))},x=0;x<3;x++)b(x);var S="vector["+(y+1)+"]";m[S]=xt.ofStrings(c.map(function(_){return _[S]}))},o=0;o<3;o++)g(o);return[Oa.ofFields("struct_ncs_oper",m)]}var Ale={1:"HELX_RH_AL_P",2:"HELX_RH_OM_P",3:"HELX_RH_PI_P",4:"HELX_RH_GA_P",5:"HELX_RH_3T_P",6:"HELX_LH_AL_P",7:"HELX_LH_OM_P",8:"HELX_LH_GA_P",9:"HELX_RH_27_P",10:"HELX_RH_PP_P"};function Ple(e){return Ale[e]||"HELX_P"}function Tle(e,t,r){for(var n=[],a=function(f){return e.data.substring(e.indices[2*f],e.indices[2*f+1])},i=t;i<r;i++){var o=a(i);n.push({serNum:o.substr(7,3).trim(),helixID:o.substr(11,3).trim(),initResName:o.substr(15,3).trim(),initChainID:o.substr(19,1).trim(),initSeqNum:o.substr(21,4).trim(),initICode:o.substr(25,1).trim(),endResName:o.substr(27,3).trim(),endChainID:o.substr(31,3).trim(),endSeqNum:o.substr(33,4).trim(),endICode:o.substr(37,1).trim(),helixClass:o.substr(38,2).trim(),comment:o.substr(40,30).trim(),length:o.substr(71,5).trim()})}var s=xt.ofStrings(n.map(function(f){return f.initChainID})),u=xt.ofStrings(n.map(function(f){return f.initResName})),l=xt.ofStrings(n.map(function(f){return f.endChainID})),c=xt.ofStrings(n.map(function(f){return f.endResName})),d={beg_label_asym_id:s,beg_label_comp_id:u,beg_label_seq_id:xt.ofUndefined(n.length,ve.Schema.int),beg_auth_asym_id:s,beg_auth_comp_id:u,beg_auth_seq_id:xt.ofStrings(n.map(function(f){return f.initSeqNum})),conf_type_id:xt.ofStrings(n.map(function(f){return Ple(f.helixClass)})),details:xt.ofStrings(n.map(function(f){return f.comment})),end_label_asym_id:l,end_label_comp_id:c,end_label_seq_id:xt.ofUndefined(n.length,ve.Schema.int),end_auth_asym_id:l,end_auth_comp_id:c,end_auth_seq_id:xt.ofStrings(n.map(function(f){return f.endSeqNum})),id:xt.ofStrings(n.map(function(f){return f.serNum})),pdbx_beg_PDB_ins_code:xt.ofStrings(n.map(function(f){return f.initICode})),pdbx_end_PDB_ins_code:xt.ofStrings(n.map(function(f){return f.endICode})),pdbx_PDB_helix_class:xt.ofStrings(n.map(function(f){return f.helixClass})),pdbx_PDB_helix_length:xt.ofStrings(n.map(function(f){return f.length})),pdbx_PDB_helix_id:xt.ofStrings(n.map(function(f){return f.helixID}))};return Oa.ofFields("struct_conf",d)}function Ele(e,t,r){for(var n=[],a=function(h){return e.data.substring(e.indices[2*h],e.indices[2*h+1])},i=t;i<r;i++){var o=a(i);n.push({strand:o.substr(7,3).trim(),sheetID:o.substr(11,3).trim(),numStrands:o.substr(14,2).trim(),initResName:o.substr(17,3).trim(),initChainID:o.substr(21,1).trim(),initSeqNum:o.substr(22,4).trim(),initICode:o.substr(26,1).trim(),endResName:o.substr(28,3).trim(),endChainID:o.substr(32,1).trim(),endSeqNum:o.substr(33,4).trim(),endICode:o.substr(37,1).trim(),sense:o.substr(38,2).trim(),curAtom:o.substr(41,4).trim(),curResName:o.substr(45,3).trim(),curChainId:o.substr(49,1).trim(),curResSeq:o.substr(50,4).trim(),curICode:o.substr(54,1).trim(),prevAtom:o.substr(56,4).trim(),prevResName:o.substr(60,3).trim(),prevChainId:o.substr(64,1).trim(),prevResSeq:o.substr(65,4).trim(),prevICode:o.substr(69,1).trim()})}var s=xt.ofStrings(n.map(function(h){return h.initChainID})),u=xt.ofStrings(n.map(function(h){return h.initResName})),l=xt.ofStrings(n.map(function(h){return h.initSeqNum})),c=xt.ofStrings(n.map(function(h){return h.endChainID})),d=xt.ofStrings(n.map(function(h){return h.endResName})),f=xt.ofStrings(n.map(function(h){return h.endSeqNum})),p={beg_label_asym_id:s,beg_label_comp_id:u,beg_label_seq_id:l,beg_auth_asym_id:s,beg_auth_comp_id:u,beg_auth_seq_id:l,end_label_asym_id:c,end_label_comp_id:c,end_label_seq_id:f,end_auth_asym_id:c,end_auth_comp_id:d,end_auth_seq_id:f,id:xt.ofStrings(n.map(function(h){return h.strand})),sheet_id:xt.ofStrings(n.map(function(h){return h.sheetID})),pdbx_beg_PDB_ins_code:xt.ofStrings(n.map(function(h){return h.initICode})),pdbx_end_PDB_ins_code:xt.ofStrings(n.map(function(h){return h.endICode}))};return Oa.ofFields("struct_sheet_range",p)}var Ile={MOL_ID:"",MOLECULE:"",CHAIN:"",FRAGMENT:"",SYNONYM:"",EC:"",ENGINEERED:"",MUTATION:"",OTHER_DETAILS:""};function Mle(e,t,r){for(var n=function(p){return e.data.substring(e.indices[2*p],e.indices[2*p+1])},a,i={chains:[],description:""},o=[],s=t;s<r;s++){var u=n(s),l=u.substr(10,70).trim(),c=l.indexOf(":"),d=l.substring(0,c),f=void 0;d in Ile?(a=d,f=l.substring(c+2)):f=l,f=f.replace(/;$/,""),a==="MOL_ID"?(i={chains:[],description:""},o.push(i)):a==="MOLECULE"?(i.description&&(i.description+=" "),i.description+=f):a==="CHAIN"&&Array.prototype.push.apply(i.chains,f.split(/\s*,\s*/))}return o}function Dle(e,t,r){for(var n=function(l){return e.data.substring(e.indices[2*l],e.indices[2*l+1])},a=new Map,i=t;i<r;i++){var o=n(i),s=o.substr(11,3).trim(),u=o.substr(15).trim();a.has(s)?a.set(s,a.get(s)+" "+u):a.set(s,u)}return a}function Rle(e,t){var r=function(){return[]},n=function(){return pt.create(e,2*t)};return{index:0,group_PDB:n(),id:r(),auth_atom_id:n(),label_alt_id:n(),auth_comp_id:n(),auth_asym_id:n(),auth_seq_id:n(),pdbx_PDB_ins_code:n(),Cartn_x:n(),Cartn_y:n(),Cartn_z:n(),occupancy:n(),B_iso_or_equiv:n(),type_symbol:n(),pdbx_PDB_model_num:r(),label_entity_id:r(),partial_charge:n()}}function Ole(e){var t=xt.ofTokens(e.auth_asym_id),r=xt.ofTokens(e.auth_atom_id),n=xt.ofTokens(e.auth_comp_id);return{auth_asym_id:t,auth_atom_id:r,auth_comp_id:n,auth_seq_id:xt.ofTokens(e.auth_seq_id),B_iso_or_equiv:xt.ofTokens(e.B_iso_or_equiv),Cartn_x:xt.ofTokens(e.Cartn_x),Cartn_y:xt.ofTokens(e.Cartn_y),Cartn_z:xt.ofTokens(e.Cartn_z),group_PDB:xt.ofTokens(e.group_PDB),id:xt.ofStrings(e.id),label_alt_id:xt.ofTokens(e.label_alt_id),label_asym_id:t,label_atom_id:r,label_comp_id:n,label_seq_id:xt.ofUndefined(e.index,ve.Schema.int),label_entity_id:xt.ofStrings(e.label_entity_id),occupancy:xt.ofTokens(e.occupancy),type_symbol:xt.ofTokens(e.type_symbol),pdbx_PDB_ins_code:xt.ofTokens(e.pdbx_PDB_ins_code),pdbx_PDB_model_num:xt.ofStrings(e.pdbx_PDB_model_num),partial_charge:xt.ofTokens(e.partial_charge)}}function DE(e,t,r,n,a,i){var o=r.data,s=a-n;pt.addToken(e.group_PDB,Et.trim(r,n,n+6)),Et.trim(r,n+6,n+11),e.id[e.index]=r.data.substring(r.tokenStart,r.tokenEnd),pt.addToken(e.auth_atom_id,Et.trim(r,n+12,n+16)),o.charCodeAt(n+16)===32?pt.add(e.label_alt_id,0,0):pt.add(e.label_alt_id,n+16,n+17),pt.addToken(e.auth_comp_id,Et.trim(r,n+17,n+20)),pt.add(e.auth_asym_id,n+21,n+22),pt.addToken(e.auth_seq_id,Et.trim(r,n+22,n+26)),o.charCodeAt(n+26)===32?pt.add(e.pdbx_PDB_ins_code,0,0):pt.add(e.pdbx_PDB_ins_code,n+26,n+27),pt.addToken(e.Cartn_x,Et.trim(r,n+30,n+38)),pt.addToken(e.Cartn_y,Et.trim(r,n+38,n+46)),pt.addToken(e.Cartn_z,Et.trim(r,n+46,n+54)),pt.addToken(e.occupancy,Et.trim(r,n+54,n+60)),s>=66?pt.addToken(e.B_iso_or_equiv,Et.trim(r,n+60,n+66)):pt.add(e.B_iso_or_equiv,0,0),i&&pt.addToken(e.partial_charge,Et.trim(r,n+70,n+76)),s>=78&&!i?(Et.trim(r,n+76,n+78),r.tokenStart<r.tokenEnd?pt.addToken(e.type_symbol,r):Mg(e.type_symbol,o,n+12,n+16)):Mg(e.type_symbol,o,n+12,n+16),e.pdbx_PDB_model_num[e.index]=t,e.index++}function Fle(e,t){var r=function(){return[]},n=function(){return new Float32Array(t)},a=function(){return pt.create(e,2*t)};return{index:0,count:t,id:r(),type_symbol:a(),pdbx_label_atom_id:a(),pdbx_label_alt_id:a(),pdbx_label_comp_id:a(),pdbx_label_asym_id:a(),pdbx_label_seq_id:a(),pdbx_PDB_ins_code:a(),"U[1][1]":n(),"U[2][2]":n(),"U[3][3]":n(),"U[1][2]":n(),"U[1][3]":n(),"U[2][3]":n(),pdbx_auth_seq_id:a(),pdbx_auth_comp_id:a(),pdbx_auth_asym_id:a(),pdbx_auth_atom_id:a()}}function kle(e){var t=xt.ofTokens(e.pdbx_auth_seq_id),r=xt.ofTokens(e.pdbx_auth_comp_id),n=xt.ofTokens(e.pdbx_auth_asym_id),a=xt.ofTokens(e.pdbx_auth_atom_id),i={id:xt.ofStrings(e.id),type_symbol:xt.ofTokens(e.type_symbol),pdbx_label_atom_id:a,pdbx_label_alt_id:xt.ofTokens(e.pdbx_label_alt_id),pdbx_label_comp_id:r,pdbx_label_asym_id:n,pdbx_label_seq_id:t,pdbx_PDB_ins_code:xt.ofTokens(e.pdbx_PDB_ins_code),pdbx_auth_seq_id:t,pdbx_auth_comp_id:r,pdbx_auth_asym_id:n,pdbx_auth_atom_id:a};return i["U[1][1]"]=xt.ofNumbers(e["U[1][1]"]),i["U[2][2]"]=xt.ofNumbers(e["U[2][2]"]),i["U[3][3]"]=xt.ofNumbers(e["U[3][3]"]),i["U[1][2]"]=xt.ofNumbers(e["U[1][2]"]),i["U[1][3]"]=xt.ofNumbers(e["U[1][3]"]),i["U[2][3]"]=xt.ofNumbers(e["U[2][3]"]),i}function Ble(e,t,r,n,a){var i=r.data,o=a-n;Et.trim(r,n+6,n+11),e.id[e.index]=i.substring(r.tokenStart,r.tokenEnd),pt.addToken(e.pdbx_auth_atom_id,Et.trim(r,n+12,n+16)),i.charCodeAt(n+16)===32?pt.add(e.pdbx_label_alt_id,0,0):pt.add(e.pdbx_label_alt_id,n+16,n+17),pt.addToken(e.pdbx_auth_comp_id,Et.trim(r,n+17,n+20)),pt.add(e.pdbx_auth_asym_id,n+21,n+22),pt.addToken(e.pdbx_auth_seq_id,Et.trim(r,n+22,n+26)),i.charCodeAt(n+26)===32?pt.add(e.pdbx_PDB_ins_code,0,0):pt.add(e.pdbx_PDB_ins_code,n+26,n+27),e["U[1][1]"][e.index]=td(i,n+28,n+35)/1e4,e["U[2][2]"][e.index]=td(i,n+35,n+42)/1e4,e["U[3][3]"][e.index]=td(i,n+42,n+49)/1e4,e["U[1][2]"][e.index]=td(i,n+49,n+56)/1e4,e["U[1][3]"][e.index]=td(i,n+56,n+63)/1e4,e["U[2][3]"][e.index]=td(i,n+63,n+70)/1e4,o>=78?(Et.trim(r,n+76,n+78),r.tokenStart<r.tokenEnd?pt.addToken(e.type_symbol,r):Mg(e.type_symbol,i,n+12,n+16)):Mg(e.type_symbol,i,n+12,n+16),e.index++}function Lle(e,t,r,n){for(var a={},i=0,o=n.id.rowCount;i<o;++i)a[n.id.str(i)]=i;for(var s=function(O){return e.data.substring(e.indices[2*O],e.indices[2*O+1])},u=[],l=[],c=[],d=[],f=[],p=[],h=[],v=[],m=[],g=[],y=[11,16,21,26],b=1,i=t;i<r;i++){var x=s(i),S=a[parseInt(x.substr(6,5))],_={};if(S!==void 0)for(var A=0;A<4;++A){var T=parseInt(x.substr(y[A],5));if(!Number.isNaN(T)){var I=a[T];I!==void 0&&(S>I||_[I]===void 0&&(u.push("covale"+b),l.push("covale"),c.push(n.label_asym_id.str(S)),f.push(n.auth_seq_id.int(S)),d.push(n.label_seq_id.int(S)),p.push(n.label_atom_id.str(S)),h.push(n.label_asym_id.str(I)),m.push(n.auth_seq_id.int(I)),v.push(n.label_seq_id.int(I)),g.push(n.label_atom_id.str(I)),b+=1))}}}var M={id:xt.ofStrings(u),conn_type_id:xt.ofStrings(l),ptnr1_label_asym_id:xt.ofStrings(c),ptnr1_auth_seq_id:xt.ofNumbers(f),ptnr1_label_seq_id:xt.ofNumbers(d),ptnr1_label_atom_id:xt.ofStrings(p),ptnr2_label_asym_id:xt.ofStrings(h),ptnr2_label_seq_id:xt.ofNumbers(v),ptnr2_auth_seq_id:xt.ofNumbers(m),ptnr2_label_atom_id:xt.ofStrings(g)};return Oa.ofFields("struct_conn",M)}function Nle(e){return ce(this,void 0,void 0,function(){var t,r,n,a,i,o,s,I,m,g,y,u,l,c,d,f,p,h,v,I,m,g,y,b,b,b,b,b,b,b,x,S,_,A,T,I,M,O,D,F,G,N,z,$;return de(this,function(j){for(t=e.lines,r=t.data,n=t.indices,a=Et(r),i=!!e.isPdbqt,o=0,s=0,I=0,m=t.count;I<m;I++)switch(g=n[2*I],y=n[2*I+1],r[g]){case"A":Wn(r,g,y,"ATOM  ")?o++:Wn(r,g,y,"ANISOU")&&s++;break;case"H":Wn(r,g,y,"HETATM")&&o++;break}for(u=Rle(r,o),l=Fle(r,s),c=new Ic,d=[],f=[],p=0,h="",v=void 0,I=0,m=t.count;I<m;I++)switch(g=n[2*I],y=n[2*I+1],r[g]){case"A":Wn(r,g,y,"ATOM  ")?(p||(p++,h=""+p),DE(u,h,a,g,y,i)):Wn(r,g,y,"ANISOU")&&Ble(l,h,a,g,y);break;case"C":if(Wn(r,g,y,"CRYST1"))d.push.apply(d,Cle(e.id||"?",r.substring(g,y)));else if(Wn(r,g,y,"CONECT")){for(b=I+1;g=n[2*b],y=n[2*b+1],!!Wn(r,g,y,"CONECT");)b++;v?Ir&&console.log("only single CONECT block allowed, ignoring others"):v=[I,b],I=b-1}else if(Wn(r,g,y,"COMPND")){for(b=I+1;g=n[2*b],y=n[2*b+1],!!Wn(r,g,y,"COMPND");)b++;c.setCompounds(Mle(t,I,b)),I=b-1}break;case"H":if(Wn(r,g,y,"HETATM"))p||(p++,h=""+p),DE(u,h,a,g,y,i);else if(Wn(r,g,y,"HELIX")){for(b=I+1;g=n[2*b],y=n[2*b+1],!!Wn(r,g,y,"HELIX");)b++;d.push(Tle(t,I,b)),I=b-1}else if(Wn(r,g,y,"HETNAM")){for(b=I+1;g=n[2*b],y=n[2*b+1],!!Wn(r,g,y,"HETNAM");)b++;f.push.apply(f,Array.from(Dle(t,I,b).entries())),I=b-1}break;case"M":if(Wn(r,g,y,"MODEL ")&&(p++,h=""+p),Wn(r,g,y,"MTRIX")){for(b=I+1;g=n[2*b],y=n[2*b+1],!!Wn(r,g,y,"MTRIX");)b++;d.push.apply(d,wle(t,I,b)),I=b-1}break;case"O":break;case"R":if(Wn(r,g,y,"REMARK 350")){for(b=I+1;g=n[2*b],y=n[2*b+1],!!Wn(r,g,y,"REMARK 350");)b++;d.push.apply(d,_le(t,I,b)),I=b-1}break;case"S":if(Wn(r,g,y,"SHEET")){for(b=I+1;g=n[2*b],y=n[2*b+1],!!Wn(r,g,y,"SHEET");)b++;d.push(Ele(t,I,b)),I=b-1}break}for(x=ve.ofIntTokens(u.auth_seq_id),S=ve.ofStringTokens(u.auth_atom_id),_=ve.ofStringTokens(u.auth_comp_id),A=ve.ofStringTokens(u.auth_asym_id),T=new Ec(x,S),T.setNames(f),c.setNames(f),I=0,M=_.rowCount;I<M;++I)O=_.value(I),D=Ip(T.add(O,I).type,O),u.label_entity_id[I]=c.getEntityId(O,D,A.value(I));for(F=Ole(u),i||delete F.partial_charge,v&&d.push(Lle(t,v[0],v[1],F)),G={entity:Oa.ofTable("entity",c.getEntityTable()),chem_comp:Oa.ofTable("chem_comp",T.getChemCompTable()),atom_site:Oa.ofFields("atom_site",F),atom_site_anisotrop:Oa.ofFields("atom_site_anisotrop",kle(l))},N=0,z=d;N<z.length;N++)$=z[N],G[$.name]=$;return[2,{header:e.id||"PDB",categoryNames:Object.keys(G),categories:G}]})})}var gp;(function(e){e.Descriptor={name:"atom_partial_charge"},e.Provider=ds.create(e.Descriptor)})(gp||(gp={}));var Kx;(function(e){function t(n){return(n==null?void 0:n.kind)==="pdb"}e.is=t;function r(n){return{kind:"pdb",name:n.id||"",data:n}}e.create=r})(Kx||(Kx={}));function Ule(e){var t=this;return We.create("Parse PDB",function(r){return ce(t,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d,f,p;return de(this,function(h){switch(h.label){case 0:return[4,r.update("Converting to mmCIF")];case 1:return h.sent(),[4,Nle(e)];case 2:return n=h.sent(),a=Jr.fromFrame(n,void 0,Kx.create(e)),[4,al(a.data.db,a,r)];case 3:return i=h.sent(),o=(p=n.categories.atom_site)===null||p===void 0?void 0:p.getField("partial_charge"),o&&i.frameCount===1&&(s=i.representative,u=s.atomicHierarchy.atomSourceIndex,l=ve.isIdentity(u),c=l?void 0:u.toArray({array:Int32Array}),d=o.toFloatArray(),f=c?ve.ofFloatArray(ve.mapToArray(u,function(v){return d[v]},Float32Array)):ve.ofFloatArray(d),gp.Provider.set(s,{data:f,type:"GASTEIGER"})),[2,i]}})})})}function zle(e){for(var t=new Array(e.count),r=new Array(e.count),n=new Uint32Array(e.count),a=new Uint32Array(e.count),i=new Ic,o=new Ec(e.residueId,e.atomName),s="",u=0,l="",c=0,d=e.segmentName.value(0),f=!1,p=0,h=-1,v=0,m=e.count;v<m;++v){var g=e.residueId.value(v),y=e.segmentName.value(v);if(d!==y?(l=Xx(u),u+=1,c=0,f=!0,d=y):f=!1,f||g!==h){var b=e.residueName.value(v),x=Ip(o.add(b,v).type,b);!f&&(x!==p||g!==h+1)&&(l=Xx(u),u+=1,c=0),s=i.getEntityId(b,x,l),c+=1,h=g,p=x}t[v]=s,r[v]=l,n[v]=c,a[v]=v}var S=Xr.ofPartialColumns(ui.atom_site,{auth_asym_id:e.segmentName,auth_atom_id:e.atomName,auth_comp_id:e.residueName,auth_seq_id:e.residueId,id:ve.ofIntArray(a),label_asym_id:ve.ofStringArray(r),label_atom_id:e.atomName,label_comp_id:e.residueName,label_seq_id:ve.ofIntArray(n),label_entity_id:ve.ofStringArray(t),occupancy:ve.ofConst(1,e.count,ve.Schema.float),type_symbol:ve.ofStringArray(ve.mapToArray(e.atomName,function(_){return t1(_)})),pdbx_PDB_model_num:ve.ofConst(1,e.count,ve.Schema.int)},e.count);return $d({entity:i.getEntityTable(),chem_comp:o.getChemCompTable(),atom_site:S})}var $x;(function(e){function t(n){return(n==null?void 0:n.kind)==="psf"}e.is=t;function r(n){return{kind:"psf",name:n.id,data:n}}e.fromPsf=r})($x||($x={}));function Vle(e){var t=this;return We.create("Parse PSF",function(r){return ce(t,void 0,void 0,function(){var n,a,i,o,s,u;return de(this,function(l){return n=$x.fromPsf(e),a=zle(e.atoms),i=e.bonds,o=i.atomIdA,s=i.atomIdB,u={indexA:ve.ofLambda({value:function(c){return o.value(c)-1},rowCount:o.rowCount,schema:o.schema}),indexB:ve.ofLambda({value:function(c){return s.value(c)-1},rowCount:s.rowCount,schema:s.schema}),order:ve.ofConst(1,e.bonds.count,ve.Schema.int)},[2,xx.create(e.id,a,u,n)]})})})}function Hle(e){return Object.keys(e).filter(function(t){return!isNaN(t)}).map(function(t){return+t}).sort(function(t,r){return t-r}).map(function(t){return e[t]})}function g2(e,t,r){return e&&e[t]!==void 0?e[t]:r}function nt(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return{kind:"alias",aliases:t,symbol:e}}function Um(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];return e.info.namespace="molscript-macro",e.id="molscript-macro."+e.info.name,{kind:"macro",symbol:e,translate:t,aliases:Nt([e.info.name],r)}}function Gle(e){return e.kind==="alias"||e.kind==="macro"}var qle=[["Core symbols",nt(Ce.core.type.bool,"bool"),nt(Ce.core.type.num,"num"),nt(Ce.core.type.str,"str"),nt(Ce.core.type.regex,"regex"),nt(Ce.core.type.list,"list"),nt(Ce.core.type.set,"set"),nt(Ce.core.type.compositeKey,"composite-key"),nt(Ce.core.logic.not,"not"),nt(Ce.core.logic.and,"and"),nt(Ce.core.logic.or,"or"),nt(Ce.core.ctrl.if,"if"),nt(Ce.core.ctrl.fn,"fn"),nt(Ce.core.ctrl.eval,"eval"),nt(Ce.core.math.add,"add","+"),nt(Ce.core.math.sub,"sub","-"),nt(Ce.core.math.mult,"mult","*"),nt(Ce.core.math.div,"div","/"),nt(Ce.core.math.pow,"pow","**"),nt(Ce.core.math.mod,"mod"),nt(Ce.core.math.min,"min"),nt(Ce.core.math.max,"max"),nt(Ce.core.math.floor,"floor"),nt(Ce.core.math.ceil,"ceil"),nt(Ce.core.math.roundInt,"round"),nt(Ce.core.math.abs,"abs"),nt(Ce.core.math.sqrt,"sqrt"),nt(Ce.core.math.cbrt,"cbrt"),nt(Ce.core.math.sin,"sin"),nt(Ce.core.math.cos,"cos"),nt(Ce.core.math.tan,"tan"),nt(Ce.core.math.asin,"asin"),nt(Ce.core.math.acos,"acos"),nt(Ce.core.math.atan,"atan"),nt(Ce.core.math.sinh,"sinh"),nt(Ce.core.math.cosh,"cosh"),nt(Ce.core.math.tanh,"tanh"),nt(Ce.core.math.exp,"exp"),nt(Ce.core.math.log,"log"),nt(Ce.core.math.log10,"log10"),nt(Ce.core.math.atan2,"atan2"),nt(Ce.core.rel.eq,"eq","="),nt(Ce.core.rel.neq,"neq","!="),nt(Ce.core.rel.lt,"lt","<"),nt(Ce.core.rel.lte,"lte","<="),nt(Ce.core.rel.gr,"gr",">"),nt(Ce.core.rel.gre,"gre",">="),nt(Ce.core.rel.inRange,"in-range"),nt(Ce.core.str.concat,"concat"),nt(Ce.core.str.match,"regex.match"),nt(Ce.core.list.getAt,"list.get"),nt(Ce.core.set.has,"set.has"),nt(Ce.core.set.isSubset,"set.subset")],["Structure",["Types",nt(Ce.structureQuery.type.entityType,"ent-type"),nt(Ce.structureQuery.type.authResidueId,"auth-resid"),nt(Ce.structureQuery.type.labelResidueId,"label-resid"),nt(Ce.structureQuery.type.ringFingerprint,"ringfp"),nt(Ce.structureQuery.type.bondFlags,"bond-flags")],["Slots",nt(Ce.structureQuery.slot.elementSetReduce,"atom.set.reduce.value")],["Generators",nt(Ce.structureQuery.generator.atomGroups,"sel.atom.atom-groups"),nt(Ce.structureQuery.generator.queryInSelection,"sel.atom.query-in-selection"),nt(Ce.structureQuery.generator.rings,"sel.atom.rings"),nt(Ce.structureQuery.generator.empty,"sel.atom.empty"),nt(Ce.structureQuery.generator.all,"sel.atom.all"),nt(Ce.structureQuery.generator.bondedAtomicPairs,"sel.atom.bonded-pairs"),Um(Ah("sel.atom.atoms",Dt.Dictionary({0:vt(De.Bool,{isOptional:!0,defaultValue:!0,description:"Test applied to each atom."})}),Pt.ElementSelection,"A selection of singleton atom sets."),function(e){return se.struct.generator.atomGroups({"atom-test":g2(e,0,!0)})}),Um(Ah("sel.atom.res",Dt.Dictionary({0:vt(De.Bool,{isOptional:!0,defaultValue:!0,description:"Test applied to the 1st atom of each residue."})}),Pt.ElementSelection,"A selection of atom sets grouped by residue."),function(e){return se.struct.generator.atomGroups({"residue-test":g2(e,0,!0),"group-by":se.ammp("residueKey")})}),Um(Ah("sel.atom.chains",Dt.Dictionary({0:vt(De.Bool,{isOptional:!0,defaultValue:!0,description:"Test applied to the 1st atom of each chain."})}),Pt.ElementSelection,"A selection of atom sets grouped by chain."),function(e){return se.struct.generator.atomGroups({"chain-test":g2(e,0,!0),"group-by":se.ammp("chainKey")})})],["Modifiers",nt(Ce.structureQuery.modifier.queryEach,"sel.atom.query-each"),nt(Ce.structureQuery.modifier.intersectBy,"sel.atom.intersect-by"),nt(Ce.structureQuery.modifier.exceptBy,"sel.atom.except-by"),nt(Ce.structureQuery.modifier.unionBy,"sel.atom.union-by"),nt(Ce.structureQuery.modifier.union,"sel.atom.union"),nt(Ce.structureQuery.modifier.cluster,"sel.atom.cluster"),nt(Ce.structureQuery.modifier.includeSurroundings,"sel.atom.include-surroundings"),nt(Ce.structureQuery.modifier.surroundingLigands,"sel.atom.surrounding-ligands"),nt(Ce.structureQuery.modifier.includeConnected,"sel.atom.include-connected"),nt(Ce.structureQuery.modifier.expandProperty,"sel.atom.expand-property")],["Filters",nt(Ce.structureQuery.filter.pick,"sel.atom.pick"),nt(Ce.structureQuery.filter.first,"sel.atom.first"),nt(Ce.structureQuery.filter.withSameAtomProperties,"sel.atom.with-same-atom-properties"),nt(Ce.structureQuery.filter.intersectedBy,"sel.atom.intersected-by"),nt(Ce.structureQuery.filter.within,"sel.atom.within"),nt(Ce.structureQuery.filter.isConnectedTo,"sel.atom.is-connected-to")],["Combinators",nt(Ce.structureQuery.combinator.intersect,"sel.atom.intersect"),nt(Ce.structureQuery.combinator.merge,"sel.atom.merge"),nt(Ce.structureQuery.combinator.distanceCluster,"sel.atom.dist-cluster")],["Atom Set Properties",nt(Ce.structureQuery.atomSet.atomCount,"atom.set.atom-count"),nt(Ce.structureQuery.atomSet.countQuery,"atom.set.count-query"),nt(Ce.structureQuery.atomSet.reduce,"atom.set.reduce"),nt(Ce.structureQuery.atomSet.propertySet,"atom.set.property")],["Atom Properties",nt(Ce.structureQuery.atomProperty.core.elementSymbol,"atom.el"),nt(Ce.structureQuery.atomProperty.core.vdw,"atom.vdw"),nt(Ce.structureQuery.atomProperty.core.mass,"atom.mass"),nt(Ce.structureQuery.atomProperty.core.atomicNumber,"atom.atomic-number"),nt(Ce.structureQuery.atomProperty.core.x,"atom.x"),nt(Ce.structureQuery.atomProperty.core.y,"atom.y"),nt(Ce.structureQuery.atomProperty.core.z,"atom.z"),nt(Ce.structureQuery.atomProperty.core.sourceIndex,"atom.src-index"),nt(Ce.structureQuery.atomProperty.core.operatorName,"atom.op-name"),nt(Ce.structureQuery.atomProperty.core.modelIndex,"atom.model-index"),nt(Ce.structureQuery.atomProperty.core.modelLabel,"atom.model-label"),nt(Ce.structureQuery.atomProperty.core.atomKey,"atom.key"),nt(Ce.structureQuery.atomProperty.core.bondCount,"atom.bond-count"),nt(Ce.structureQuery.atomProperty.topology.connectedComponentKey,"atom.key.molecule"),nt(Ce.structureQuery.atomProperty.macromolecular.authResidueId,"atom.auth-resid"),nt(Ce.structureQuery.atomProperty.macromolecular.labelResidueId,"atom.label-resid"),nt(Ce.structureQuery.atomProperty.macromolecular.residueKey,"atom.key.res"),nt(Ce.structureQuery.atomProperty.macromolecular.chainKey,"atom.key.chain"),nt(Ce.structureQuery.atomProperty.macromolecular.entityKey,"atom.key.entity"),nt(Ce.structureQuery.atomProperty.macromolecular.isHet,"atom.is-het"),nt(Ce.structureQuery.atomProperty.macromolecular.id,"atom.id"),nt(Ce.structureQuery.atomProperty.macromolecular.label_atom_id,"atom.label_atom_id"),nt(Ce.structureQuery.atomProperty.macromolecular.label_alt_id,"atom.label_alt_id","atom.altloc"),nt(Ce.structureQuery.atomProperty.macromolecular.label_comp_id,"atom.label_comp_id"),nt(Ce.structureQuery.atomProperty.macromolecular.label_asym_id,"atom.label_asym_id"),nt(Ce.structureQuery.atomProperty.macromolecular.label_entity_id,"atom.label_entity_id"),nt(Ce.structureQuery.atomProperty.macromolecular.label_seq_id,"atom.label_seq_id"),nt(Ce.structureQuery.atomProperty.macromolecular.auth_atom_id,"atom.auth_atom_id","atom.name"),nt(Ce.structureQuery.atomProperty.macromolecular.auth_comp_id,"atom.auth_comp_id","atom.resname"),nt(Ce.structureQuery.atomProperty.macromolecular.auth_asym_id,"atom.auth_asym_id","atom.chain"),nt(Ce.structureQuery.atomProperty.macromolecular.auth_seq_id,"atom.auth_seq_id","atom.resno"),nt(Ce.structureQuery.atomProperty.macromolecular.pdbx_PDB_ins_code,"atom.pdbx_PDB_ins_code","atom.inscode"),nt(Ce.structureQuery.atomProperty.macromolecular.pdbx_formal_charge,"atom.pdbx_formal_charge"),nt(Ce.structureQuery.atomProperty.macromolecular.occupancy,"atom.occupancy"),nt(Ce.structureQuery.atomProperty.macromolecular.B_iso_or_equiv,"atom.B_iso_or_equiv","atom.bfactor"),nt(Ce.structureQuery.atomProperty.macromolecular.entityType,"atom.entity-type"),nt(Ce.structureQuery.atomProperty.macromolecular.entitySubtype,"atom.entity-subtype"),nt(Ce.structureQuery.atomProperty.macromolecular.entityPrdId,"atom.entity-prd-id"),nt(Ce.structureQuery.atomProperty.macromolecular.entityDescription,"atom.entity-description"),nt(Ce.structureQuery.atomProperty.macromolecular.objectPrimitive,"atom.object-primitive"),nt(Ce.structureQuery.atomProperty.macromolecular.chemCompType,"atom.chem-comp-type"),nt(Ce.structureQuery.atomProperty.macromolecular.secondaryStructureKey,"atom.key.sec-struct"),nt(Ce.structureQuery.atomProperty.macromolecular.isModified,"atom.is-modified"),nt(Ce.structureQuery.atomProperty.macromolecular.modifiedParentName,"atom.modified-parent")],["Bond Properties",nt(Ce.structureQuery.bondProperty.order,"bond.order"),nt(Ce.structureQuery.bondProperty.length,"bond.length"),nt(Ce.structureQuery.bondProperty.atomA,"bond.atom-a"),nt(Ce.structureQuery.bondProperty.atomB,"bond.atom-b"),Um(Ah("bond.is",Dt.List(Pt.BondFlag),De.Bool,"Test if the current bond has at least one (or all if partial = false) of the specified flags: "+De.oneOfValues(Pt.BondFlag).join(", ")),function(e){return se.core.flags.hasAny([se.struct.bondProperty.flags(),se.struct.type.bondFlags(Hle(e))])})]]],oF=[];function sF(e){for(var t=0,r=e;t<r.length;t++){var n=r[t];Gle(n)?oF.push(n):n instanceof Array&&sF(n)}}sF(qle);var jle=function(){for(var e=[],t=Object.create(null),r=$r.create(),n=$r.create(),a=0,i=oF;a<i.length;a++){for(var o=i[a],s=0,u=o.aliases;s<u.length;s++){var l=u[s];if(e.push([l,o]),t[l])throw new Error("Alias '"+l+"' already in use.");t[l]=o}var c=o.symbol.args;if(c.kind!=="dictionary"){c.type.kind==="oneof"&&De.oneOfValues(c.type).forEach(function(h){return $r.add(n,h,h)});continue}for(var d=0,f=Object.keys(c.map);d<f.length;d++){var l=f[d];isNaN(l)&&$r.add(r,l,l);var p=c.map[l];p.type.kind==="oneof"&&De.oneOfValues(p.type).forEach(function(v){return $r.add(n,v,v)})}}return{symbolList:e,symbolMap:t,namedArgs:r.array,constants:n.array}}(),Pf=jle.symbolMap;function Ih(e){if(na.isLiteral(e))return e;if(na.isSymbol(e)){if(!Pf[e.name])return e;var t=Pf[e.name];if(t.kind==="alias")return na.Symbol(Pf[e.name].symbol.id);throw t.translate([])}var r=na.isSymbol(e.head)&&!!Pf[e.head.name]&&Pf[e.head.name].kind==="macro",n=r?e.head:Ih(e.head),a=n!==e.head;if(!e.args)return r?Ih(e.head):a?na.Apply(n):e;var i=!1,o;if(na.isArgumentsArray(e.args)){o=[];for(var s=0,u=e.args.length;s<u;s++){var l=e.args[s],c=Ih(l);l!==c&&(i=!0),o[o.length]=c}if(i||(o=e.args),!r&&!a&&!i)return e}else{o={};for(var d=0,f=Object.keys(e.args);d<f.length;d++){var p=f[d],l=e.args[p],c=Ih(l);l!==c&&(i=!0),o[p]=c}if(!r&&!a&&!i)return e;i||(o=e.args)}if(r){var h=Pf[e.head.name];if(h.kind!=="macro")return na.Apply(n,o);var v=h.translate(o);return v}return na.Apply(n,o)}function Wle(e){return Ih(e)}var qo=function(){function e(t){this._=t}return e.prototype.parse=function(t){var r=this.skip(e.eof)._(t,0);return r.status?{success:!0,value:r.value}:{success:!1,index:uF(t,r.furthest),expected:r.expected}},e.prototype.tryParse=function(t){var r=this.parse(t);if(r.success)return r.value;var n=Kle(t,r),a=new Error(n);throw a},e.prototype.or=function(t){return e.alt(this,t)},e.prototype.trim=function(t){return this.wrap(t,t)},e.prototype.wrap=function(t,r){return y2(1,typeof t=="string"?e.string(t):t,this,typeof r=="string"?e.string(r):r)},e.prototype.thru=function(t){return t(this)},e.prototype.then=function(t){return y2(1,this,t)},e.prototype.many=function(){var t=this;return new e(function(r,n){for(var a=[],i=void 0;;)if(i=bo(t._(r,n),i),i.status){if(n===i.index)throw new Error("infinite loop detected in .many() parser --- calling .many() on a parser which can accept zero characters is usually the cause");n=i.index,a.push(i.value)}else return bo(Ga(n,a),i)})},e.prototype.times=function(t,r){var n=this,a=typeof r=="undefined"?t:r;return new e(function(i,o){var s=[],u=void 0,l=void 0,c;for(c=0;c<t;c++)if(u=n._(i,o),l=bo(u,l),u.status)o=u.index,s.push(u.value);else return l;for(;c<a&&(u=n._(i,o),l=bo(u,l),u.status);c+=1)o=u.index,s.push(u.value);return bo(Ga(o,s),l)})},e.prototype.result=function(t){return this.map(function(){return t})},e.prototype.atMost=function(t){return this.times(0,t)},e.prototype.atLeast=function(t){return e.seq(this.times(t),this.many()).map(function(r){return Nt(Nt([],r[0]),r[1])})},e.prototype.map=function(t){var r=this;return new e(function(n,a){var i=r._(n,a);return i.status?bo(Ga(i.index,t(i.value)),i):i})},e.prototype.skip=function(t){return y2(0,this,t)},e.prototype.mark=function(){return e.seq(e.index,this,e.index).map(function(t){return{start:t[0],value:t[1],end:t[2]}})},e.prototype.node=function(t){return e.seq(e.index,this,e.index).map(function(r){return{name:t,start:r[0],value:r[1],end:r[2]}})},e.prototype.sepBy=function(t){return e.sepBy(this,t)},e.prototype.sepBy1=function(t){return e.sepBy1(this,t)},e.prototype.lookahead=function(t){return this.skip(e.lookahead(t))},e.prototype.notFollowedBy=function(t){return this.skip(e.notFollowedBy(t))},e.prototype.desc=function(t){var r=this;return new e(function(n,a){var i=r._(n,a);return i.status||(i.expected=[t]),i})},e.prototype.fallback=function(t){return this.or(e.succeed(t))},e.prototype.ap=function(t){return e.seq(t,this).map(function(r){var n=r[0],a=r[1];return n(a)})},e.prototype.chain=function(t){var r=this;return new e(function(n,a){var i=r._(n,a);if(!i.status)return i;var o=t(i.value);return bo(o._(n,i.index),i)})},e}();(function(e){function t(){for(var x=[],S=0;S<arguments.length;S++)x[S]=arguments[S];var _=x.length;return new e(function(A,T){for(var I,M=new Array(_),O=T,D=0;D<_;D++){if(I=bo(x[D]._(A,O),I),!I.status)return I;M[D]=I.value,O=I.index}return bo(Ga(O,M),I)})}e.seq=t;function r(){for(var x=[],S=0;S<arguments.length;S++)x[S]=arguments[S];var _=x.length;return _===0?c("zero alternates"):new e(function(A,T){for(var I,M=0;M<x.length;M++)if(I=bo(x[M]._(A,T),I),I.status)return I;return I})}e.alt=r;function n(x,S){return a(x,S).or(l([]))}e.sepBy=n;function a(x,S){var _=S.then(x).many();return t(x,_).map(function(A){return Nt([A[0]],A[1])})}e.sepBy1=a;function i(x){var S="'"+x+"'";if(x.length===1){var _=x.charCodeAt(0);return new e(function(A,T){return A.charCodeAt(T)===_?Ga(T+1,x):du(T,S)})}return new e(function(A,T){var I=T+x.length;return A.slice(T,I)===x?Ga(I,x):du(T,S)})}e.string=i;function o(x){var S=""+x;return S.slice(S.lastIndexOf("/")+1)}function s(x){return RegExp("^(?:"+x.source+")",o(x))}function u(x,S){S===void 0&&(S=0);var _=s(x),A=""+x;return new e(function(T,I){var M=_.exec(T.slice(I));if(M){if(0<=S&&S<=M.length){var O=M[0],D=M[S];return Ga(I+O.length,D)}var F="invalid match group (0 to "+M.length+") in "+A;return du(I,F)}return du(I,A)})}e.regexp=u;function l(x){return new e(function(S,_){return Ga(_,x)})}e.succeed=l;function c(x){return new e(function(S,_){return du(_,x)})}e.fail=c;function d(x){if(Qle(x))return new e(function(S,_){var A=x._(S,_);return A.status&&(A.index=_,A.value=null),A});if(typeof x=="string")return d(i(x));if(x instanceof RegExp)return d(u(x));throw new Error("not a string, regexp, or parser: "+x)}e.lookahead=d;function f(x){return new e(function(S,_){var A=x._(S,_);return A.status?du(_,'not "'+S.slice(_,A.index)+'"'):Ga(_,null)})}e.notFollowedBy=f;function p(x){return new e(function(S,_){var A=S.charAt(_);return _<S.length&&x(A)?Ga(_+1,A):du(_,"a character "+x)})}e.test=p;function h(x){return p(function(S){return x.indexOf(S)>=0})}e.oneOf=h;function v(x){return p(function(S){return x.indexOf(S)<0})}e.noneOf=v;function m(x,S){return p(function(_){return x<=_&&_<=S}).desc(x+"-"+S)}e.range=m;function g(x){return new e(function(S,_){for(var A=_;A<S.length&&x(S.charAt(A));)A++;return Ga(A,S.slice(_,A))})}e.takeWhile=g;function y(x){var S=new e(function(_,A){var T=x()._;return S._=T,T(_,A)});return S}e.lazy=y;function b(){return c("empty")}e.empty=b,e.index=new e(function(x,S){return Ga(S,uF(x,S))}),e.anyChar=new e(function(x,S){return S>=x.length?du(S,"any character"):Ga(S+1,x.charAt(S))}),e.all=new e(function(x,S){return Ga(x.length,x.slice(S))}),e.eof=new e(function(x,S){return S<x.length?du(S,"EOF"):Ga(S,null)}),e.digit=u(/[0-9]/).desc("a digit"),e.digits=u(/[0-9]*/).desc("optional digits"),e.letter=u(/[a-z]/i).desc("a letter"),e.letters=u(/[a-z]*/i).desc("optional letters"),e.optWhitespace=u(/\s*/).desc("optional whitespace"),e.whitespace=u(/\s+/).desc("whitespace"),e.cr=i("\r"),e.lf=i(`
`),e.crlf=i(`\r
`),e.newline=r(e.crlf,e.lf,e.cr).desc("newline"),e.end=r(e.newline,e.eof)})(qo||(qo={}));function y2(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var n=t.length;return new qo(function(a,i){for(var o,s,u=i,l=0;l<n;l++){if(o=bo(t[l]._(a,u),o),!o.status)return o;e===l&&(s=o.value),u=o.index}return bo(Ga(u,s),o)})}function Ga(e,t){return{status:!0,index:e,value:t}}function du(e,t){return{status:!1,furthest:e,expected:[t]}}function bo(e,t){if(!t||e.status||t.status||e.furthest>t.furthest)return e;var r=e.furthest===t.furthest?$le(e.expected,t.expected):t.expected;return{status:e.status,furthest:t.furthest,expected:r}}function uF(e,t){var r=e.slice(0,t).split(`
`),n=r.length,a=r[r.length-1].length+1;return{offset:t,line:n,column:a}}function Xle(e){return e.length===1?e[0]:"one of "+e.join(", ")}function Yle(e,t){var r=t.index,n=r.offset;if(n===e.length)return", got the end of the input";var a=n>0?"'...":"'",i=e.length-n>12?"...'":"'";return" at line "+r.line+" column "+r.column+", got "+a+e.slice(n,n+12)+i}function Kle(e,t){return"expected "+Xle(t.expected)+Yle(e,t)}function $le(e,t){var r=e.length,n=t.length;if(r===0)return t;if(n===0)return e;for(var a=new Set,i=[],o=0;o<r;o++)a.has(e[o])||(i[i.length]=e[o],a.add(e[o]));for(var o=0;o<n;o++)a.has(t[o])||(i[i.length]=t[o],a.add(t[o]));return i.sort(),i}function Qle(e){return e instanceof qo}function Zle(e){return Qx.parse(e)}var Qx;(function(e){var t;(function(x){function S(I){return{kind:"string",value:I}}x.str=S;function _(I){return{kind:"symbol",value:I}}x.symb=_;function A(I,M){return{kind:"list",bracket:I,nodes:M}}x.list=A;function T(I){return{kind:"comment",value:I}}x.comment=T})(t||(t={}));var r=qo.regexp(/[\n\r\s]*/),n=qo.lazy(function(){return qo.alt(a,d,i,o).trim(r)}),a=qo.takeWhile(function(x){return x!=="`"}).trim("`").map(t.str),i=qo.regexp(/[^()\[\]{};`,\n\r\s]+/).map(t.symb),o=qo.regexp(/\s*;+([^\n\r]*)\n/,1).map(t.comment),s=n.many(),u=s.wrap("(",")").map(function(x){return t.list("(",x)}),l=s.wrap("[","]").map(function(x){return t.list("[",x)}),c=s.wrap("{","}").map(function(x){return t.list("{",x)}),d=qo.alt(u,l,c),f=n.many();function p(x){return f.tryParse(x)}function h(x){switch(x.kind){case"string":return x.value;case"symbol":{var S=x.value;if(S.length>1){var _=S.charAt(0);switch(_){case".":return se.atomName(S.substr(1));case"_":return se.struct.type.elementSymbol([S.substr(1)])}}return S==="true"?!0:S==="false"?!1:y(S)?+S:na.Symbol(S)}case"list":{switch(x.bracket){case"[":return se.core.type.list(g(x.nodes).map(h));case"{":return se.core.type.set(g(x.nodes).map(h));case"(":{var A=h(x.nodes[0]);return na.Apply(A,v(x.nodes))}}return 0}default:throw new Error("should not happen")}}function v(x){if(!(x.length<=1)){if(!m(x)){for(var S=[],_=1,A=x.length;_<A;_++){var T=x[_];T.kind!=="comment"&&(S[S.length]=h(T))}return S}for(var I={},M=!0,O=0,_=1,A=x.length;_<A;_++){var T=x[_];if(T.kind!=="comment")if(T.kind==="symbol"&&T.value.length>1&&T.value.charAt(0)===":"){var D=T.value.substr(1);for(++_;_<A&&x[_].kind==="comment";)_++;if(_>=A)throw new Error("There must be a value foolowed a named arg ':"+D+"'.");I[D]=h(x[_]),isNaN(+D)&&(M=!1)}else I[O++]=h(T)}if(M){for(var F=Object.keys(I).map(function(z){return+z}).sort(function(z,$){return z-$}),G=!0,_=0,A=F.length;_<A;_++)if(F[_]!==_){G=!1;break}if(G){for(var N=[],_=0,A=F.length;_<A;_++)N[_]=I[_];return N}}return I}}function m(x){for(var S=1,_=x.length;S<_;S++){var A=x[S];if(A.kind==="symbol"&&A.value.length>1&&A.value.charAt(0)===":")return!0}return!1}function g(x){for(var S=!1,_=0,A=x.length;_<A;_++)if(x[_].kind==="comment"){S=!0;break}return S?x.filter(function(T){return T.kind!=="comment"}):x}function y(x){return/-?(0|[1-9][0-9]*)([.][0-9]+)?([eE][+-]?[0-9]+)?/.test(x)&&!isNaN(+x)}function b(x){for(var S=p(x),_=[],A=0,T=S;A<T.length;A++){var I=T[A];I.kind!=="comment"&&(_[_.length]=h(I))}return _}e.parse=b})(Qx||(Qx={}));function pa(e,t){return{expression:e,language:t}}(function(e){function t(s){return!!s&&typeof s.expression=="string"&&!!s.language}e.is=t;function r(s,u){return s.language===u.language&&s.expression===u.expression}e.areEqual=r;function n(s){switch(s.language){case"mol-script":var u=Zle(s.expression);if(u.length===0)throw new Error("No query");return Wle(u[0])}throw new Error("unsupported script language")}e.toExpression=n;function a(s){var u=n(s);return Ld(u)}e.toQuery=a;function i(s,u){var l=a(s),c=l(new Qi(u));return mt.toLociWithSourceUnits(c)}e.toLoci=i;function o(s,u,l){var c=typeof s=="function"?s(se):s,d=Ld(c);return d(new Qi(u,l))}e.getStructureSelection=o})(pa||(pa={}));var wd;(function(e){function t(u,l){var c=u&&qn.Provider.get(u),d=c?c.assemblies.map(function(x){return[x.id,x.id+": "+ji(x.details)]}):[],f=c?!Ei.isZero(c.spacegroup.cell):!0,p=[];if(c)for(var h=c.spacegroup.operators,v=0,m=h.length;v<m;v++)p.push([v,v+1+": "+fs.getOperatorXyz(h[v])]);var g=[];u&&u.properties.structAsymMap.forEach(function(x){var S=x.id===x.auth_id?x.id:x.id+" [auth "+x.auth_id+"]";g.push([x.id,S])});var y={auto:E.EmptyGroup(),model:E.EmptyGroup(),assembly:E.Group({id:E.Optional(u?E.Select(d.length?d[0][0]:"",d,{label:"Asm Id",description:"Assembly Id"}):E.Text("",{label:"Asm Id",description:"Assembly Id (use empty for the 1st assembly)"}))},{isFlat:!0}),"symmetry-mates":E.Group({radius:E.Numeric(5,{min:0,max:50,step:1})},{isFlat:!0}),symmetry:E.Group({ijkMin:E.Vec3(C.create(-1,-1,-1),{step:1},{label:"Min IJK",fieldLabels:{x:"I",y:"J",z:"K"}}),ijkMax:E.Vec3(C.create(1,1,1),{step:1},{label:"Max IJK",fieldLabels:{x:"I",y:"J",z:"K"}})},{isFlat:!0}),"symmetry-assembly":E.Group({generators:E.ObjectList({operators:E.ObjectList({index:E.Select(0,p),shift:E.Vec3(C(),{step:1},{label:"IJK",fieldLabels:{x:"I",y:"J",z:"K"}})},function(x){return x.index+1+"_"+x.shift.map(function(S){return S+5}).join("")},{defaultValue:[]}),asymIds:E.MultiSelect([],g)},function(x){return x.asymIds.length+" asym ids, "+x.operators.length+" operators"},{defaultValue:[]})},{isFlat:!0})},b=[];return l==="auto"&&b.push(["auto","Auto"]),b.push(["model","Model"]),d.length>0&&b.push(["assembly","Assembly"]),f&&(b.push(["symmetry-mates","Symmetry Mates"]),b.push(["symmetry","Symmetry (indices)"]),b.push(["symmetry-assembly","Symmetry (assembly)"])),{type:E.MappedStatic(l||"model",y,{options:b})}}e.getParams=t;function r(u,l){return!(l.name==="symmetry-assembly"||l.name==="symmetry"&&u.name==="symmetry")}e.canAutoUpdate=r;function n(u,l,c,d){return ce(this,void 0,void 0,function(){var f,p,h,v,m,g;return de(this,function(y){switch(y.label){case 0:return f=void 0,p=qn.Provider.get(c),!d&&p&&p.assemblies.length!==0&&(d=p.assemblies[0].id),!p||p.assemblies.length===0?u.log.warn("Model '"+c.entryId+"' has no assembly, returning model structure."):(f=vv.findAssembly(c,d||""),f||u.log.warn("Model '"+c.entryId+"' has no assembly called '"+d+"', returning model structure.")),h=Xe.ofModel(c),f?(d=f.id,[4,Us.buildAssembly(h,d).runInContext(l)]):(v={label:"Model",description:Xe.elementDescription(h)},[2,new ge.Molecule.Structure(h,v)]);case 1:return m=y.sent(),g={label:"Assembly "+d,description:Xe.elementDescription(m)},[2,new ge.Molecule.Structure(m,g)]}})})}function a(u,l,c,d){return ce(this,void 0,void 0,function(){var f,p,h;return de(this,function(v){switch(v.label){case 0:return f=Xe.ofModel(l),[4,Us.buildSymmetryRange(f,c,d).runInContext(u)];case 1:return p=v.sent(),h={label:"Symmetry ["+c+"] to ["+d+"]",description:Xe.elementDescription(p)},[2,new ge.Molecule.Structure(p,h)]}})})}function i(u,l,c){return ce(this,void 0,void 0,function(){var d,f,p;return de(this,function(h){switch(h.label){case 0:return d=Xe.ofModel(l),[4,Us.builderSymmetryMates(d,c).runInContext(u)];case 1:return f=h.sent(),p={label:"Symmetry Mates",description:Xe.elementDescription(f)},[2,new ge.Molecule.Structure(f,p)]}})})}function o(u,l,c,d){return ce(this,void 0,void 0,function(){var f,p,h;return de(this,function(v){switch(v.label){case 0:return f=Xe.ofModel(l),[4,Us.buildSymmetryAssembly(f,c,d).runInContext(u)];case 1:return p=v.sent(),h={label:"Symmetry Assembly",description:Xe.elementDescription(p)},[2,new ge.Molecule.Structure(p,h)]}})})}function s(u,l,c,d){return ce(this,void 0,void 0,function(){var f,p,p;return de(this,function(h){if(f=qn.Provider.get(c),!f||!d||d.name==="model")return p=Xe.ofModel(c),[2,new ge.Molecule.Structure(p,{label:"Model",description:Xe.elementDescription(p)})];if(d.name==="auto")return f.assemblies.length===0?(p=Xe.ofModel(c),[2,new ge.Molecule.Structure(p,{label:"Model",description:Xe.elementDescription(p)})]):[2,n(u,l,c)];if(d.name==="assembly")return[2,n(u,l,c,d.params.id)];if(d.name==="symmetry")return[2,a(l,c,d.params.ijkMin,d.params.ijkMax)];if(d.name==="symmetry-mates")return[2,i(l,c,d.params.radius)];if(d.name==="symmetry-assembly")return[2,o(l,c,d.params.generators,f)];throw new Error("Unknown represetation type: "+d.name)})})}e.create=s})(wd||(wd={}));var Ya;(function(e){function t(s,u,l){return s.currentStructure!==l?!1:pa.is(u)?!!s.script&&pa.areEqual(s.script,u):s.expression===u}e.isUnchanged=t;function r(s,u){var l=pa.is(u)?u:void 0,c=pa.is(u)?pa.toExpression(u):u,d=Ld(c);return{script:l,expression:c,compiled:d,originalStructure:s,currentStructure:s}}e.create=r;function n(s,u){return s.compiled(new Qi(u))}e.run=n;function a(s,u){var l=r(s,u);return{entry:l,selection:n(l,s)}}e.createAndRun=a;function i(s,u){return s.currentStructure=u,s.compiled(new Qi(u))}e.updateStructure=i;function o(s,u,l){var c=mt.unionStructure(u);s.label=""+(l||"Selection"),s.description=Xe.elementDescription(c),s.data=c}e.updateStructureObject=o})(Ya||(Ya={}));var Jle=function(){return{type:E.MappedStatic("static",{static:E.Text("polymer"),expression:E.Value(se.struct.generator.all),bundle:E.Value(Qr.Empty),script:E.Script({language:"mol-script",expression:"(sel.atom.all)"})},{isHidden:!0}),nullIfEmpty:E.Optional(E.Boolean(!0,{isHidden:!0})),label:E.Text("",{isHidden:!0})}};function ece(e,t,r){r.source=e;var n=Xe.Empty,a=void 0;switch(t.type.name){case"static":{var i=void 0;switch(t.type.params){case"all":i=Xn.all.query,a="All";break;case"polymer":i=Xn.polymer.query,a="Polymer";break;case"protein":i=Xn.protein.query,a="Protein";break;case"nucleic":i=Xn.nucleic.query,a="Nucleic";break;case"water":i=Zr.internal.water(),a="Water";break;case"ion":i=Xn.ion.query,a="Ion";break;case"lipid":i=Xn.lipid.query,a="Lipid";break;case"branched":i=Xn.branchedPlusConnected.query,a="Branched";break;case"ligand":i=Xn.ligandPlusConnected.query,a="Ligand";break;case"non-standard":i=Xn.nonStandardPolymer.query,a="Non-standard";break;case"coarse":i=Xn.coarse.query,a="Coarse";break;default:throw new Error(t.type+" is a not valid complex element.")}var o=i(new Qi(e));n=mt.unionStructure(o);break}case"script":case"expression":{var s=Ya.createAndRun(e,t.type.params),u=s.selection,l=s.entry;r.entry=l,n=mt.unionStructure(u);break}case"bundle":{if(t.type.params.hash!==e.hashCode)break;n=Qr.toStructure(t.type.params,e);break}}if(t.nullIfEmpty&&n.elementCount===0)return Cn.Null;var c={label:""+(t.label||a||"Component"),description:Xe.elementDescription(n)};return new ge.Molecule.Structure(n,c)}function tce(e,t,r,n,a){if(r.type.name!==n.type.name)return ft.UpdateResult.Recreate;var i=!1;switch(n.type.name){case"static":return r.type.params!==n.type.params||!Xe.areEquivalent(e,a.source)?ft.UpdateResult.Recreate:t.data.model===e.model?ft.UpdateResult.Unchanged:jt.areHierarchiesEqual(e.model,t.data.model)?(t.data=t.data.remapModel(e.model),ft.UpdateResult.Updated):ft.UpdateResult.Recreate;case"script":if(!pa.areEqual(r.type.params,n.type.params))return ft.UpdateResult.Recreate;case"expression":{if(r.type.params!==n.type.params)return ft.UpdateResult.Recreate;if(e===a.source)break;var o=a.entry,s=Ya.updateStructure(o,e);a.source=e,t.data=mt.unionStructure(s),Ya.updateStructureObject(t,s,n.label),i=!0;break}case"bundle":{if(e===a.source&&Qr.areEqual(r.type.params,n.type.params))break;a.source=e,n.type.params.hash!==e.hashCode?(i=t.data.elementCount!==0,t.data=t.data.elementCount===0?t.data:Xe.Empty):(i=!0,t.data=Qr.toStructure(n.type.params,e));break}}if(i){if(n.nullIfEmpty&&t.data.elementCount===0)return ft.UpdateResult.Null;t.description=Xe.elementDescription(t.data)}return r.label!==n.label&&(i=!0,t.label=""+(n.label||t.label)),i?ft.UpdateResult.Updated:ft.UpdateResult.Unchanged}function lF(e,t){for(var r=pt.create(e.data,t*2),n=pt.create(e.data,t*2),a=pt.create(e.data,t*2),i=pt.create(e.data,t*2),o=0;o<t;++o){Et.markLine(e);var s=e.tokenStart,u=e.position;Et.trim(e,s,s+10),pt.addUnchecked(r,e.tokenStart,e.tokenEnd),Et.trim(e,s+10,s+20),pt.addUnchecked(n,e.tokenStart,e.tokenEnd),Et.trim(e,s+20,s+30),pt.addUnchecked(a,e.tokenStart,e.tokenEnd),Et.trim(e,s+31,s+34),pt.addUnchecked(i,e.tokenStart,e.tokenEnd),e.position=u}return{count:t,x:qr(r)(ve.Schema.float),y:qr(n)(ve.Schema.float),z:qr(a)(ve.Schema.float),type_symbol:qr(i)(ve.Schema.str)}}function cF(e,t){for(var r=pt.create(e.data,t*2),n=pt.create(e.data,t*2),a=pt.create(e.data,t*2),i=0;i<t;++i){Et.markLine(e);var o=e.tokenStart,s=e.position;Et.trim(e,o,o+3),pt.addUnchecked(r,e.tokenStart,e.tokenEnd),Et.trim(e,o+3,o+6),pt.addUnchecked(n,e.tokenStart,e.tokenEnd),Et.trim(e,o+6,o+9),pt.addUnchecked(a,e.tokenStart,e.tokenEnd),e.position=s}return{count:t,atomIdxA:qr(r)(ve.Schema.int),atomIdxB:qr(n)(ve.Schema.int),order:qr(a)(ve.Schema.int)}}function rce(e){var t=Et(e),r=Et.readLine(t).trim(),n=Et.readLine(t).trim(),a=Et.readLine(t).trim(),i=Et.readLine(t),o=+i.substr(0,3),s=+i.substr(3,3),u=lF(t,o),l=cF(t,s),c={title:r,program:n,comment:a,atoms:u,bonds:l};return bn.success(c)}function nce(e){var t=this;return We.create("Parse Mol",function(){return ce(t,void 0,void 0,function(){return de(this,function(r){return[2,rce(e)]})})})}function dF(e,t,r){return ce(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d,f,p,h,v,m,g;return de(this,function(y){switch(y.label){case 0:return n=e.atoms,a=e.bonds,i=ve.ofConst("MOL",e.atoms.count,ve.Schema.str),o=ve.ofConst("A",e.atoms.count,ve.Schema.str),s=ve.asArrayColumn(n.type_symbol),u=ve.ofConst(1,n.count,ve.Schema.int),l=Xr.ofPartialColumns(ui.atom_site,{auth_asym_id:o,auth_atom_id:s,auth_comp_id:i,auth_seq_id:u,Cartn_x:ve.asArrayColumn(n.x,Float32Array),Cartn_y:ve.asArrayColumn(n.y,Float32Array),Cartn_z:ve.asArrayColumn(n.z,Float32Array),id:ve.range(0,n.count-1),label_asym_id:o,label_atom_id:s,label_comp_id:i,label_seq_id:u,label_entity_id:ve.ofConst("1",n.count,ve.Schema.str),occupancy:ve.ofConst(1,n.count,ve.Schema.float),type_symbol:s,pdbx_PDB_model_num:ve.ofConst(1,n.count,ve.Schema.int)},n.count),c=new Ic,c.setNames([["MOL","Unknown Entity"]]),c.getEntityId("MOL",0,"A"),d=new Ec(u,s),d.setNames([["MOL","Unknown Molecule"]]),d.add("MOL",0),f=$d({entity:c.getEntityTable(),chem_comp:d.getChemCompTable(),atom_site:l}),[4,al(f,t!=null?t:Zx.create(e),r)];case 1:return p=y.sent(),p.frameCount>0&&(h=ve.ofIntArray(ve.mapToArray(a.atomIdxA,function(b){return b-1},Int32Array)),v=ve.ofIntArray(ve.mapToArray(a.atomIdxB,function(b){return b-1},Int32Array)),m=ve.asArrayColumn(a.order,Int32Array),g=Ba.fromData({pairs:{indexA:h,indexB:v,order:m},count:n.count}),Ba.Provider.set(p.representative,g)),[2,p]}})})}var Zx;(function(e){function t(n){return(n==null?void 0:n.kind)==="mol"}e.is=t;function r(n){return{kind:"mol",name:n.title,data:n}}e.create=r})(Zx||(Zx={}));function ace(e){return We.create("Parse MOL",function(t){return dF(e,void 0,t)})}function ice(e){var t=e.IT_number.value(0),r=e["name_H-M_full"].value(0);return e.IT_number.isDefined?(e["name_H-M_full"].isDefined,t):r}function oce(e){var t=e.cell,r=e.space_group,n=ice(r),a=Ei.create(n,C.create(t.length_a.value(0),t.length_b.value(0),t.length_c.value(0)),C.scale(C(),C.create(t.angle_alpha.value(0),t.angle_beta.value(0),t.angle_gamma.value(0)),Math.PI/180));return{spacegroup:fs.create(a),assemblies:[],isNonStandardCrystalFrame:!1,ncsOperators:[]}}function sce(e,t,r){var n;return ce(this,void 0,void 0,function(){var a,i,o,s,u,l,c,d,f,p,h,v,m,g,xe,y,b,x,S,_,M,A,xe,T,I,M,xe,O,D,F,G,N,z,$,j,Z,q,xe,te,he,W,K,U,H,J,X,Q,ee,le,ye,be,Ae,xe,ae,oe,R,V;return de(this,function(pe){switch(pe.label){case 0:for(a=e.atom_site._rowCount,i=ve.ofConst("MOL",a,ve.Schema.str),o=ve.ofConst("A",a,ve.Schema.str),s=ve.ofConst(1,a,ve.Schema.int),u=oce(e),l=u.spacegroup.cell.fromFractional,c=e.atom_site,d=c.fract_x,f=c.fract_y,p=c.fract_z,h=new Float32Array(a),v=new Float32Array(a),m=new Float32Array(a),g=C(),xe=0;xe<a;++xe)C.set(g,d.value(xe),f.value(xe),p.value(xe)),C.transformMat4(g,g,l),h[xe]=g[0],v[xe]=g[1],m[xe]=g[2];if(y=e.atom_site,b=y.type_symbol,x=y.label,b.isDefined){for(M=new Array(a),A=new Int8Array(a),xe=0;xe<a;++xe)T=b.value(xe),I=T.length,T[I-1]==="+"?(M[xe]=T.substring(0,I-2),A[xe]=parseInt(T[I-2])):T[I-2]==="+"?(M[xe]=T.substring(0,I-2),A[xe]=parseInt(T[I-1])):T[I-1]==="-"?(M[xe]=T.substring(0,I-2),A[xe]=-parseInt(T[I-2])):T[I-2]==="-"?(M[xe]=T.substring(0,I-2),A[xe]=-parseInt(T[I-1])):(M[xe]=T,A[xe]=0);S=ve.ofStringArray(M),_=ve.ofIntArray(A)}else{for(M=new Array(a),xe=0;xe<a;++xe)M[xe]=t1(x.value(xe));S=ve.ofStringArray(M),_=ve.Undefined(a,ve.Schema.int)}return O=Xr.ofPartialColumns(ui.atom_site,{auth_asym_id:o,auth_atom_id:x,auth_comp_id:i,auth_seq_id:s,Cartn_x:ve.ofFloatArray(h),Cartn_y:ve.ofFloatArray(v),Cartn_z:ve.ofFloatArray(m),id:ve.range(0,a-1),label_asym_id:o,label_atom_id:x,label_comp_id:i,label_seq_id:s,label_entity_id:ve.ofConst("1",a,ve.Schema.str),occupancy:e.atom_site.occupancy.isDefined?e.atom_site.occupancy:ve.ofConst(1,a,ve.Schema.float),type_symbol:S,pdbx_formal_charge:_,pdbx_PDB_model_num:ve.ofConst(1,a,ve.Schema.int),B_iso_or_equiv:e.atom_site.U_iso_or_equiv},a),D=e.chemical.name_common.value(0)||e.chemical.name_systematic.value(0)||e.chemical_formula.sum.value(0),F=new Ic,F.setNames([["MOL",D||"Unknown Entity"]]),F.getEntityId("MOL",0,"A"),G=new Ec(s,e.atom_site.type_symbol),G.setNames([["MOL",D||"Unknown Molecule"]]),G.add("MOL",0),N=$d({entity:F.getEntityTable(),chem_comp:G.getChemCompTable(),atom_site:O}),[4,al(N,t,r)];case 1:if(z=pe.sent(),z.frameCount>0&&($=z.representative,qn.Provider.set($,u),j=e.geom_bond._rowCount,j>0)){for(Z={},q=e.atom_site.label,xe=0,te=q.rowCount;xe<te;++xe)Z[q.value(xe)]=xe;for(he=(n=t.data.frame.categories.ccdc_geom_bond_type)===null||n===void 0?void 0:n.getField(""),W=[],K=[],U=[],H=[],J=[],X=new Set,Q=0,ee=e.geom_bond,le=ee.atom_site_label_1,ye=ee.atom_site_label_2,be=ee.valence,Ae=ee.distance,xe=0;xe<j;++xe)ae=Z[le.value(xe)],oe=Z[ye.value(xe)],R=ae<oe?oc(ae,oe):oc(oe,ae),!X.has(R)&&(X.add(R),W[Q]=ae,K[Q]=oe,H[Q]=Ae.value(xe)||-1,he?(V=he.str(xe),V==="D"?(U[Q]=2,J[Q]=1):V==="A"?(U[Q]=1,J[Q]=17):(U[Q]=1,J[Q]=1)):(J[Q]=1,U[Q]=be.isDefined?be.value(xe):1),Q+=1);Ba.Provider.set($,Ba.fromData({pairs:{indexA:ve.ofIntArray(W),indexB:ve.ofIntArray(K),order:ve.ofIntArray(U),distance:ve.ofFloatArray(H),flag:ve.ofIntArray(J)},count:a}))}return[2,z]}})})}function uce(e){if(!!_v.is(e.sourceData)){var t=e.sourceData.data.db,r=t.atom_site,n=t.atom_site_aniso,a=Xr.ofPartialColumns(js.Schema,{U:n.U,U_esd:n.U_su},n._rowCount),i=js.getElementToAnsiotropFromLabel(r.label,n.label);return{data:a,elementToAnsiotrop:i}}}function lce(e){return _v.is(e.sourceData)?e.sourceData.data.db.atom_site_aniso.U.isDefined:!1}js.Provider.formatRegistry.add("cifCore",uce,lce);var _v;(function(e){function t(n){return(n==null?void 0:n.kind)==="cifCore"}e.is=t;function r(n,a){a||(a=Gu.schema.cifCore(n));var i=a.database_code.depnum_ccdc_archive.value(0)||a.database_code.depnum_ccdc_fiz.value(0)||a.database_code.ICSD.value(0)||a.database_code.MDF.value(0)||a.database_code.NBS.value(0)||a.database_code.CSD.value(0)||a.database_code.COD.value(0)||a._name;return{kind:"cifCore",name:i,data:{db:a,frame:n}}}e.fromFrame=r})(_v||(_v={}));function cce(e){var t=_v.fromFrame(e);return We.create("Parse CIF Core",function(r){return sce(t.data.db,t,r)})}function dce(e,t){return ce(this,void 0,void 0,function(){var r,n,a,i,o,s,u,l,c;return de(this,function(d){switch(d.label){case 0:return r=e.atoms,n=ve.ofConst("MOL",e.atoms.count,ve.Schema.str),a=ve.ofConst("A",e.atoms.count,ve.Schema.str),i=ve.ofArray({array:ve.mapToArray(r.number,function(f){return UK(f)}),schema:ve.Schema.Aliased(ve.Schema.str)}),o=ve.ofConst(1,r.count,ve.Schema.int),s=Xr.ofPartialColumns(ui.atom_site,{auth_asym_id:a,auth_atom_id:i,auth_comp_id:n,auth_seq_id:o,Cartn_x:ve.asArrayColumn(r.x,Float32Array),Cartn_y:ve.asArrayColumn(r.y,Float32Array),Cartn_z:ve.asArrayColumn(r.z,Float32Array),id:ve.range(0,r.count-1),label_asym_id:a,label_atom_id:i,label_comp_id:n,label_seq_id:o,label_entity_id:ve.ofConst("1",r.count,ve.Schema.str),occupancy:ve.ofConst(1,r.count,ve.Schema.float),type_symbol:i,pdbx_PDB_model_num:ve.ofConst(1,r.count,ve.Schema.int)},r.count),u=new Ic,u.setNames([["MOL","Unknown Entity"]]),u.getEntityId("MOL",0,"A"),l=new Ec(o,i),l.setNames([["MOL","Unknown Molecule"]]),l.add("MOL",0),c=$d({entity:u.getEntityTable(),chem_comp:l.getChemCompTable(),atom_site:s}),[4,al(c,Jx.create(e),t)];case 1:return[2,d.sent()]}})})}var Jx;(function(e){function t(n){return(n==null?void 0:n.kind)==="cube"}e.is=t;function r(n){return{kind:"cube",name:n.header.comment1,data:n}}e.create=r})(Jx||(Jx={}));function fce(e){return We.create("Parse Cube",function(t){return dce(e,t)})}var _3=Et.skipWhitespace,fF=Et.eatValue,Ds=Et.markLine,Rs=Et.getTokenString,pF=Et.readLine;function pce(){return{mol_name:"",num_atoms:0,num_bonds:0,num_subst:0,num_feat:0,num_sets:0,mol_type:"",charge_type:"",status_bits:"",mol_comment:""}}function hce(e,t){return{tokenizer:e,molecule:pce(),runtimeCtx:t}}var vce=/\s+/g;function mce(e){for(var t=e.tokenizer,r=e.molecule;Rs(t)!=="@<TRIPOS>MOLECULE"&&t.position<t.data.length;)Ds(t);Ds(t),r.mol_name=Rs(t),Ds(t);var n=Rs(t).trim().split(vce);r.num_atoms=parseInt(n[0]),r.num_bonds=parseInt(n[1]),r.num_subst=parseInt(n[2]),r.num_feat=parseInt(n[3]),r.num_sets=parseInt(n[4]),Ds(t);var a=Rs(t);if(!a.startsWith("@<TRIPOS>")){r.mol_type=a,Ds(t);var i=Rs(t);if(!i.startsWith("@<TRIPOS>")){r.charge_type=i,Ds(t);var o=Rs(t);if(!o.startsWith("@<TRIPOS>")){r.status_bits=o,Ds(t);var s=Rs(t);s.startsWith("@<TRIPOS>")||(r.mol_comment=s)}}}}function gce(e){return ce(this,void 0,void 0,function(){var t,r,n,a,i,o,s,u,l,c,d,f,p,h,v,m,g,y,b,x,S,_,A;return de(this,function(T){switch(T.label){case 0:for(t=e.tokenizer,r=e.molecule;Rs(t)!=="@<TRIPOS>ATOM"&&t.position<t.data.length;)Ds(t);return n=t.position,a=t.lineNumber,i=pF(t),o=i.trim().split(/\s+/g),s=o.length,u=pt.create(t.data,r.num_atoms*2),l=pt.create(t.data,r.num_atoms*2),c=pt.create(t.data,r.num_atoms*2),d=pt.create(t.data,r.num_atoms*2),f=pt.create(t.data,r.num_atoms*2),p=pt.create(t.data,r.num_atoms*2),h=pt.create(t.data,r.num_atoms*2),v=pt.create(t.data,r.num_atoms*2),m=pt.create(t.data,r.num_atoms*2),g=pt.create(t.data,r.num_atoms*2),y=ve.Undefined(r.num_atoms,ve.Schema.float),b=ve.Undefined(r.num_atoms,ve.Schema.int),x=ve.Undefined(r.num_atoms,ve.Schema.str),t.position=n,t.lineNumber=a,S=t.length,_=0,[4,Uu(e.runtimeCtx,1e5,void 0,function(I){for(var M=Math.min(r.num_atoms-_,I),O=0;O<M;O++)for(var D=0;D<s;D++)switch(_3(t),t.tokenStart=t.position,fF(t),D){case 0:pt.addUnchecked(u,t.tokenStart,t.tokenEnd);break;case 1:pt.addUnchecked(l,t.tokenStart,t.tokenEnd);break;case 2:pt.addUnchecked(c,t.tokenStart,t.tokenEnd);break;case 3:pt.addUnchecked(d,t.tokenStart,t.tokenEnd);break;case 4:pt.addUnchecked(f,t.tokenStart,t.tokenEnd);break;case 5:pt.addUnchecked(p,t.tokenStart,t.tokenEnd);break;case 6:pt.addUnchecked(h,t.tokenStart,t.tokenEnd);break;case 7:pt.addUnchecked(v,t.tokenStart,t.tokenEnd);break;case 8:pt.addUnchecked(m,t.tokenStart,t.tokenEnd);break;case 9:pt.addUnchecked(g,t.tokenStart,t.tokenEnd);break}return _+=M,M},function(I){return I.update({message:"Parsing...",current:t.position,max:S})})];case 1:return T.sent(),A={count:r.num_atoms,atom_id:qr(u)(ve.Schema.int),atom_name:qr(l)(ve.Schema.str),x:qr(c)(ve.Schema.float),y:qr(d)(ve.Schema.float),z:qr(f)(ve.Schema.float),atom_type:s>5?qr(p)(ve.Schema.str):x,subst_id:s>6?qr(h)(ve.Schema.int):b,subst_name:s>7?qr(v)(ve.Schema.str):x,charge:s>8?qr(m)(ve.Schema.float):y,status_bit:s>9?qr(g)(ve.Schema.str):x},[2,A]}})})}function yce(e){return ce(this,void 0,void 0,function(){var t,r,n,a,i,o,s,u,l,c,d,f,p,h,v;return de(this,function(m){switch(m.label){case 0:for(t=e.tokenizer,r=e.molecule;Rs(t)!=="@<TRIPOS>BOND"&&t.position<t.data.length;)Ds(t);return n=t.position,a=t.lineNumber,i=pF(t),o=i.trim().split(/\s+/g),s=o.length,u=pt.create(t.data,r.num_bonds*2),l=pt.create(t.data,r.num_bonds*2),c=pt.create(t.data,r.num_bonds*2),d=pt.create(t.data,r.num_bonds*2),f=pt.create(t.data,r.num_bonds*2),t.position=n,t.lineNumber=a,p=t.length,h=0,[4,Uu(e.runtimeCtx,1e5,void 0,function(g){for(var y=Math.min(r.num_bonds-h,g),b=0;b<y;b++)for(var x=0;x<s;x++)switch(_3(t),t.tokenStart=t.position,fF(t),x){case 0:pt.addUnchecked(u,t.tokenStart,t.tokenEnd);break;case 1:pt.addUnchecked(l,t.tokenStart,t.tokenEnd);break;case 2:pt.addUnchecked(c,t.tokenStart,t.tokenEnd);break;case 3:pt.addUnchecked(d,t.tokenStart,t.tokenEnd);break;default:pt.addUnchecked(f,t.tokenStart,t.tokenEnd);break}return h+=y,y},function(g){return g.update({message:"Parsing...",current:t.position,max:p})})];case 1:return m.sent(),v={count:r.num_bonds,bond_id:qr(u)(ve.Schema.int),origin_atom_id:qr(l)(ve.Schema.int),target_atom_id:qr(c)(ve.Schema.int),bond_type:qr(d)(ve.Schema.str),status_bits:s>4?qr(f)(ve.Schema.str):ve.Undefined(r.num_bonds,ve.Schema.str)},[2,v]}})})}function bce(e,t,r){return ce(this,void 0,void 0,function(){var n,a,i,o,s,u;return de(this,function(l){switch(l.label){case 0:n=Et(t),e.update({message:"Parsing...",current:0,max:t.length}),a=[],l.label=1;case 1:return n.position<t.length?(i=hce(n,e),mce(i),[4,gce(i)]):[3,4];case 2:return o=l.sent(),[4,yce(i)];case 3:for(s=l.sent(),a.push({molecule:i.molecule,atoms:o,bonds:s}),_3(n);Rs(n)!=="@<TRIPOS>MOLECULE"&&n.position<n.data.length;)Ds(n);return[3,1];case 4:return u={name:r,structures:a},[2,bn.success(u)]}})})}function Sce(e,t){var r=this;return We.create("Parse MOL2",function(n){return ce(r,void 0,void 0,function(){return de(this,function(a){switch(a.label){case 0:return[4,bce(n,e,t)];case 1:return[2,a.sent()]}})})})}function xce(e,t){return ce(this,void 0,void 0,function(){var r,n,a,i,o,s,u,l,c,d,f,p,h,v,m,g,y,b,x,S,_,A,T;return de(this,function(I){switch(I.label){case 0:r=[],n=0,a=e.structures.length,I.label=1;case 1:if(!(n<a))return[3,4];for(i=e.structures[n],o=i.atoms,s=i.bonds,u=i.molecule,l=ve.ofConst("A",o.count,ve.Schema.str),c=new Array(o.count),d=0;d<o.count;++d)c[d]=t1(o.atom_name.value(d));for(f=Xr.ofPartialColumns(ui.atom_site,{auth_asym_id:l,auth_atom_id:ve.asArrayColumn(o.atom_name),auth_comp_id:o.subst_name,auth_seq_id:o.subst_id,Cartn_x:ve.asArrayColumn(o.x,Float32Array),Cartn_y:ve.asArrayColumn(o.y,Float32Array),Cartn_z:ve.asArrayColumn(o.z,Float32Array),id:ve.asArrayColumn(o.atom_id),label_asym_id:l,label_atom_id:ve.asArrayColumn(o.atom_name),label_comp_id:o.subst_name,label_seq_id:o.subst_id,label_entity_id:ve.ofConst("1",o.count,ve.Schema.str),occupancy:ve.ofConst(1,o.count,ve.Schema.float),type_symbol:ve.ofStringArray(c),pdbx_PDB_model_num:ve.ofConst(n,o.count,ve.Schema.int)},o.count),p=new Ic,p.setNames([["MOL",u.mol_name||"Unknown Entity"]]),p.getEntityId("MOL",0,"A"),h=new Ec(o.subst_id,o.atom_name),v=0,m=o.subst_name.rowCount;v<m;++v)h.add(o.subst_name.value(v),v);return g=$d({entity:p.getEntityTable(),chem_comp:h.getChemCompTable(),atom_site:f}),[4,al(g,eC.create(e),t)];case 2:y=I.sent(),y.frameCount>0&&(b=ve.ofIntArray(ve.mapToArray(s.origin_atom_id,function(M){return M-1},Int32Array)),x=ve.ofIntArray(ve.mapToArray(s.target_atom_id,function(M){return M-1},Int32Array)),S=ve.ofIntArray(ve.mapToArray(s.bond_type,function(M){switch(M){case"ar":case"am":case"un":return 1;case"du":case"nc":return 0;default:return parseInt(M)}},Int8Array)),_=ve.ofIntArray(ve.mapToArray(s.bond_type,function(M){switch(M){case"ar":return 17;case"du":case"nc":return 0;case"am":case"un":default:return 1}},Int8Array)),A=Ba.fromData({pairs:{indexA:b,indexB:x,order:S,flag:_},count:o.count}),T=y.representative,Ba.Provider.set(T,A),gp.Provider.set(T,{data:o.charge,type:u.charge_type}),r.push(T)),I.label=3;case 3:return++n,[3,1];case 4:return[2,new kd(r)]}})})}var eC;(function(e){function t(n){return(n==null?void 0:n.kind)==="mol2"}e.is=t;function r(n){return{kind:"mol2",name:n.name,data:n}}e.create=r})(eC||(eC={}));function Cce(e){return We.create("Parse MOL2",function(t){return xce(e,t)})}var Tf=new Uint32Array([0,0,0,0,0,0,0,0,0,8,10,12,16,20,25,32,40,50,64,80,101,128,161,203,256,322,406,512,645,812,1024,1290,1625,2048,2580,3250,4096,5060,6501,8192,10321,13003,16384,20642,26007,32768,41285,52015,65536,82570,104031,131072,165140,208063,262144,330280,416127,524287,660561,832255,1048576,1321122,1664510,2097152,2642245,3329021,4194304,5284491,6658042,8388607,10568983,13316085,16777216]),b2=9,Ci;(function(e){function t(c){for(var d=1,f=0;c>=d&&f<32;)f++,d<<=1;return f}e.sizeOfInt=t;var r=new Uint8Array(32);function n(c,d){var f=1,p=0;r[0]=1;for(var h=0;h<c;h++){var v=void 0,m=0;for(v=0;v<f;v++)m+=r[v]*d[h],r[v]=m&255,m>>=8;for(;m!==0;)r[v++]=m&255,m>>=8;f=v}var g=1;for(f--;r[f]>=g;)p++,g*=2;return p+f*8}e.sizeOfInts=n;var a=new ArrayBuffer(8*3);e.buf=new Int32Array(a);var i=new Uint32Array(a);function o(c,d,f){for(var p=f,h=(1<<p)-1,v=i[1],m=i[2],g=e.buf[0],y=0;p>=8;)m=m<<8|c[d+g++],y|=m>>v<<p-8,p-=8;return p>0&&(v<p&&(v+=8,m=m<<8|c[d+g++]),v-=p,y|=m>>v&(1<<p)-1),y&=h,e.buf[0]=g,e.buf[1]=v,e.buf[2]=m,y}e.decodeBits=o;function s(c,d){var f=i[2],p=e.buf[0];return f=f<<8|c[d+p],e.buf[0]=p+1,e.buf[2]=f,f>>i[1]&255}var u=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];function l(c,d,f,p,h){var v=f,m=0;for(u[0]=0,u[1]=0,u[2]=0,u[3]=0;v>8;)u[m++]=s(c,d),v-=8;v>0&&(u[m++]=o(c,d,v));for(var g=2;g>0;g--){for(var y=0,b=p[g],x=m-1;x>=0;x--){y=y<<8|u[x];var S=y/b|0;u[x]=S,y=y-S*b}h[g]=y}h[0]=u[0]|u[1]<<8|u[2]<<16|u[3]<<24}e.decodeInts=l})(Ci||(Ci={}));function _ce(){throw new Error("(xdrfile error) Undefined error.")}function wce(e,t){return ce(this,void 0,void 0,function(){var r,n,a,i,o,s,u,l,c,d,f,p,h,v,m,g,F,F,y,b,x,S,_,A,T,I,M,O,D,F,G,N,z,$,j;return de(this,function(Z){switch(Z.label){case 0:r=new DataView(t.buffer,t.byteOffset),n={frames:[],boxes:[],times:[],timeOffset:0,deltaTime:0},a=n.frames,i=n.boxes,o=n.times,s=[0,0,0,0,0,0],u=[0,0,0],l=[0,0,0],c=[0,0,0],d=[.1,.1,.1],f=[.1,.1,.1],p=0,h=Ci.buf,Z.label=1;case 1:for(v=void 0,m=r.getInt32(p+4),p+=12,o.push(r.getFloat32(p)),p+=4,g=new Float32Array(9),F=0;F<9;++F)g[F]=r.getFloat32(p)*10,p+=4;if(i.push(g),m<=9)for(v={count:m/3,x:new Float32Array(m/3),y:new Float32Array(m/3),z:new Float32Array(m/3)},F=0;F<m/3;++F)v.x[F]=r.getFloat32(p),v.y[F]=r.getFloat32(p),v.z[F]=r.getFloat32(p),p+=4;else{for(h[0]=h[1]=h[2]=0,u[0]=u[1]=u[2]=0,c[0]=c[1]=c[2]=0,l[0]=l[1]=l[2]=0,d[0]=d[1]=d[2]=0,f[0]=f[1]=f[2]=0,v={count:m,x:new Float32Array(m),y:new Float32Array(m),z:new Float32Array(m)},y=0,b=r.getInt32(p),p+=4,x=r.getFloat32(p),p+=4,s[0]=r.getInt32(p),s[1]=r.getInt32(p+4),s[2]=r.getInt32(p+8),s[3]=r.getInt32(p+12),s[4]=r.getInt32(p+16),s[5]=r.getInt32(p+20),u[0]=s[3]-s[0]+1,u[1]=s[4]-s[1]+1,u[2]=s[5]-s[2]+1,p+=24,S=void 0,(u[0]|u[1]|u[2])>16777215?(l[0]=Ci.sizeOfInt(u[0]),l[1]=Ci.sizeOfInt(u[1]),l[2]=Ci.sizeOfInt(u[2]),S=0):S=Ci.sizeOfInts(3,u),_=r.getInt32(p),p+=4,A=_-1,A=b2>A?b2:A,T=Tf[A]/2|0,I=Tf[_]/2|0,c[0]=c[1]=c[2]=Tf[_],M=Math.ceil(r.getInt32(p)/4)*4,p+=4,O=1/x,D=0,F=0,d[0]=d[1]=d[2]=0;F<b;){if(S===0?(d[0]=Ci.decodeBits(t,p,l[0]),d[1]=Ci.decodeBits(t,p,l[1]),d[2]=Ci.decodeBits(t,p,l[2])):Ci.decodeInts(t,p,S,u,d),F++,d[0]+=s[0],d[1]+=s[1],d[2]+=s[2],f[0]=d[0],f[1]=d[1],f[2]=d[2],G=Ci.decodeBits(t,p,1),N=0,G===1&&(D=Ci.decodeBits(t,p,5),N=D%3,D-=N,N--),D>0)for(d[0]=d[1]=d[2]=0,z=0;z<D;z+=3)Ci.decodeInts(t,p,_,c,d),F++,d[0]+=f[0]-I,d[1]+=f[1]-I,d[2]+=f[2]-I,z===0?($=d[0],d[0]=f[0],f[0]=$,$=d[1],d[1]=f[1],f[1]=$,$=d[2],d[2]=f[2],f[2]=$,v.x[y]=f[0]*O,v.y[y]=f[1]*O,v.z[y]=f[2]*O,y++):(f[0]=d[0],f[1]=d[1],f[2]=d[2]),v.x[y]=d[0]*O,v.y[y]=d[1]*O,v.z[y]=d[2]*O,y++;else v.x[y]=d[0]*O,v.y[y]=d[1]*O,v.z[y]=d[2]*O,y++;_+=N,N<0?(I=T,_>b2?T=Tf[_-1]/2|0:T=0):N>0&&(T=I,I=Tf[_]/2|0),c[0]=c[1]=c[2]=Tf[_],(c[0]===0||c[1]===0||c[2]===0)&&_ce()}p+=M}for(j=0;j<m;j++)v.x[j]*=10,v.y[j]*=10,v.z[j]*=10;return a.push(v),e.shouldUpdate?[4,e.update({current:p,max:t.length})]:[3,3];case 2:Z.sent(),Z.label=3;case 3:return p>=t.length?[3,4]:[3,1];case 4:return o.length>=1&&(n.timeOffset=o[0]),o.length>=2&&(n.deltaTime=o[1]-o[0]),[2,n]}})})}function Ace(e){var t=this;return We.create("Parse XTC",function(r){return ce(t,void 0,void 0,function(){var n,a;return de(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),r.update({canAbort:!0,message:"Parsing trajectory..."}),[4,wce(r,e)];case 1:return n=i.sent(),[2,bn.success(n)];case 2:return a=i.sent(),[2,bn.error(""+a)];case 3:return[2]}})})})}function Pce(e){var t=this;return We.create("Parse XTC",function(r){return ce(t,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d;return de(this,function(f){switch(f.label){case 0:return[4,r.update("Converting to coordinates")];case 1:for(f.sent(),n=Wl(e.deltaTime,"step"),a=Wl(e.timeOffset,n.unit),i=[],o=0,s=e.frames.length;o<s;++o)u=e.boxes[o],l=C.fromArray(C(),u,0),c=C.fromArray(C(),u,3),d=C.fromArray(C(),u,6),i.push({elementCount:e.frames[o].count,cell:_d.fromBasis(l,c,d),x:e.frames[o].x,y:e.frames[o].y,z:e.frames[o].z,xyzOrdering:{isIdentity:!0},time:Wl(a.value+n.value*o,n.unit)});return[2,fv.create(i,n,a)]}})})})}function Tce(e){var t=e.position>=e.data.length-1?0:+Et.readLine(e);isNaN(t)&&(t=0);for(var r=Et.readLine(e),n=new Float64Array(t),a=new Float64Array(t),i=new Float64Array(t),o=new Array(t),s=0;s<t;++s){var u=Et.readLineTrim(e),l=u.split(/\s+/g);o[s]=l[0],n[s]=+l[1],a[s]=+l[2],i[s]=+l[3]}return{count:t,comment:r,x:ve.ofFloatArray(n),y:ve.ofFloatArray(a),z:ve.ofFloatArray(i),type_symbol:ve.ofStringArray(o)}}function Ece(e){for(var t=Et(e),r=[];;){var n=Tce(t);if(n.count===0)break;r.push(n)}var a={molecules:r};return bn.success(a)}function Ice(e){var t=this;return We.create("Parse Mol",function(){return ce(t,void 0,void 0,function(){return de(this,function(r){return[2,Ece(e)]})})})}function Mce(e,t){for(var r=e.molecules,n=0,a=0,i=r;a<i.length;a++){var o=i[a];n+=o.count}for(var s=new Array(n),u=new Int32Array(n),l=new Float32Array(n),c=new Float32Array(n),d=new Float32Array(n),f=new Int32Array(n),p=0,h=0;h<r.length;h++)for(var o=r[h],v=0;v<o.count;v++)s[p]=o.type_symbol.value(v),l[p]=o.x.value(v),c[p]=o.y.value(v),d[p]=o.z.value(v),u[p]=v,f[p]=h,p++;var m=ve.ofConst("MOL",n,ve.Schema.str),g=ve.ofConst("A",n,ve.Schema.str),y=ve.ofConst(1,n,ve.Schema.int),b=ve.ofStringArray(s),x=Xr.ofPartialColumns(ui.atom_site,{auth_asym_id:g,auth_atom_id:b,auth_comp_id:m,auth_seq_id:y,Cartn_x:ve.ofFloatArray(l),Cartn_y:ve.ofFloatArray(c),Cartn_z:ve.ofFloatArray(d),id:ve.ofIntArray(u),label_asym_id:g,label_atom_id:b,label_comp_id:m,label_seq_id:y,label_entity_id:ve.ofConst("1",n,ve.Schema.str),occupancy:ve.ofConst(1,n,ve.Schema.float),type_symbol:b,pdbx_PDB_model_num:ve.ofIntArray(f)},n),S=new Ic;S.setNames([["MOL","Unknown Entity"]]),S.getEntityId("MOL",0,"A");var _=new Ec(y,b);_.setNames([["MOL","Unknown Molecule"]]),_.add("MOL",0);var A=$d({entity:S.getEntityTable(),chem_comp:_.getChemCompTable(),atom_site:x});return al(A,tC.create(e),t)}var tC;(function(e){function t(n){return(n==null?void 0:n.kind)==="xyz"}e.is=t;function r(n){return{kind:"xyz",name:"xyz",data:n}}e.create=r})(tC||(tC={}));function Dce(e){return We.create("Parse XYZ",function(t){return Mce(e,t)})}var rC="$$$$";function Rce(e){for(var t=pt.create(e.data,32),r=pt.create(e.data,32);e.position<e.length;){var n=Et.readLine(e);if(n.startsWith(rC))break;if(!!n&&n.startsWith("> ")){pt.add(t,e.tokenStart+2,e.tokenEnd),Et.markLine(e);for(var a=e.tokenStart,i=e.tokenEnd,o=!1;e.position<e.length;){var s=Et.readLine(e);if(!s||s.startsWith(rC)||s.startsWith("> ")){pt.add(r,a,i),o=!0;break}i=e.tokenEnd}o||pt.add(r,a,i)}}return{dataHeader:qr(t)(ve.Schema.str),data:qr(r)(ve.Schema.str)}}function Oce(e){var t=Et.readLine(e).trim(),r=Et.readLine(e).trim(),n=Et.readLine(e).trim(),a=Et.readLine(e),i=+a.substr(0,3),o=+a.substr(3,3);if(Number.isNaN(i)||Number.isNaN(o)){for(;e.position<e.length;){var s=Et.readLine(e);if(s.startsWith(rC))break}return}var u=lF(e,i),l=cF(e,o),c=Rce(e);return{molFile:{title:t,program:r,comment:n,atoms:u,bonds:l},dataItems:c}}function Fce(e){for(var t=Et(e),r=[];t.position<t.length;){var n=Oce(t);n&&r.push(n)}return bn.success({compounds:r})}function kce(e){var t=this;return We.create("Parse Sdf",function(){return ce(t,void 0,void 0,function(){return de(this,function(r){return[2,Fce(e)]})})})}var nC;(function(e){function t(n){return(n==null?void 0:n.kind)==="sdf"}e.is=t;function r(n){return{kind:"sdf",name:n.molFile.title,data:n}}e.create=r})(nC||(nC={}));function Bce(e){return We.create("Parse SDF",function(t){return dF(e.molFile,nC.create(e),t)})}var Lce=Ot.BuiltIn({name:"coordinates-from-dcd",display:{name:"Parse DCD",description:"Parse DCD binary data."},from:[ge.Data.Binary],to:ge.Molecule.Coordinates})({apply:function(e){var t=this,r=e.a;return We.create("Parse DCD",function(n){return ce(t,void 0,void 0,function(){var a,i;return de(this,function(o){switch(o.label){case 0:return[4,eae(r.data).runInContext(n)];case 1:if(a=o.sent(),a.isError)throw new Error(a.message);return[4,ple(a.result).runInContext(n)];case 2:return i=o.sent(),[2,new ge.Molecule.Coordinates(i,{label:r.label,description:"Coordinates"})]}})})})}}),Nce=Ot.BuiltIn({name:"coordinates-from-xtc",display:{name:"Parse XTC",description:"Parse XTC binary data."},from:[ge.Data.Binary],to:ge.Molecule.Coordinates})({apply:function(e){var t=this,r=e.a;return We.create("Parse XTC",function(n){return ce(t,void 0,void 0,function(){var a,i;return de(this,function(o){switch(o.label){case 0:return[4,Ace(r.data).runInContext(n)];case 1:if(a=o.sent(),a.isError)throw new Error(a.message);return[4,Pce(a.result).runInContext(n)];case 2:return i=o.sent(),[2,new ge.Molecule.Coordinates(i,{label:r.label,description:"Coordinates"})]}})})})}}),Uce=Ot.BuiltIn({name:"topology-from-psf",display:{name:"PSF Topology",description:"Parse PSF string data."},from:[ge.Format.Psf],to:ge.Molecule.Topology})({apply:function(e){var t=this,r=e.a;return We.create("Create Topology",function(n){return ce(t,void 0,void 0,function(){var a;return de(this,function(i){switch(i.label){case 0:return[4,Vle(r.data).runInContext(n)];case 1:return a=i.sent(),[2,new ge.Molecule.Topology(a,{label:a.label||r.label,description:"Topology"})]}})})})}});function zce(e,t,r){return ce(this,void 0,void 0,function(){var n,a;return de(this,function(i){switch(i.label){case 0:return t.type!==ge.Molecule.Topology.type?[3,2]:(n=t.data,[4,jt.trajectoryFromTopologyAndCoordinates(n,r).runInContext(e)]);case 1:return[2,i.sent()];case 2:if(t.type===ge.Molecule.Model.type)return a=t.data,[2,jt.trajectoryFromModelAndCoordinates(a,r)];i.label=3;case 3:throw new Error("no model/topology found")}})})}var hF=Ot.BuiltIn({name:"trajectory-from-model-and-coordinates",display:{name:"Trajectory from Topology & Coordinates",description:"Create a trajectory from existing model/topology and coordinates."},from:ge.Root,to:ge.Molecule.Trajectory,params:{modelRef:E.Text("",{isHidden:!0}),coordinatesRef:E.Text("",{isHidden:!0})}})({apply:function(e){var t=this,r=e.params,n=e.dependencies;return We.create("Create trajectory from model/topology and coordinates",function(a){return ce(t,void 0,void 0,function(){var i,o,s;return de(this,function(u){switch(u.label){case 0:return i=n[r.coordinatesRef].data,[4,zce(a,n[r.modelRef],i)];case 1:return o=u.sent(),s={label:"Trajectory",description:o.frameCount+" model"+(o.frameCount===1?"":"s")},[2,new ge.Molecule.Trajectory(o,s)]}})})})}}),Vce=Ot.BuiltIn({name:"trajectory-from-blob",display:{name:"Parse Blob",description:"Parse format blob into a single trajectory."},from:ge.Format.Blob,to:ge.Molecule.Trajectory})({apply:function(e){var t=this,r=e.a;return We.create("Parse Format Blob",function(n){return ce(t,void 0,void 0,function(){var a,i,o,s,u,l,d,c,d,f;return de(this,function(p){switch(p.label){case 0:a=[],i=0,o=r.data,p.label=1;case 1:return i<o.length?(s=o[i],s.kind!=="cif"?[3,6]:(u=s.data.blocks[0],[4,V6(u).runInContext(n)])):[3,7];case 2:if(l=p.sent(),l.frameCount===0)throw new Error("No models found.");d=0,p.label=3;case 3:return d<l.frameCount?[4,We.resolveInContext(l.getFrameAtIndex(d),n)]:[3,6];case 4:c=p.sent(),a.push(c),p.label=5;case 5:return d++,[3,3];case 6:return i++,[3,1];case 7:for(d=0;d<a.length;d++)jt.TrajectoryInfo.set(a[d],{index:d,size:a.length});return f={label:"Trajectory",description:a.length+" model"+(a.length===1?"":"s")},[2,new ge.Molecule.Trajectory(new kd(a),f)]}})})})}});function ml(e){var t=e.representative;return{label:""+t.entry,description:e.frameCount+" model"+(e.frameCount===1?"":"s")}}var Hce=Ot.BuiltIn({name:"trajectory-from-mmcif",display:{name:"Trajectory from mmCIF",description:"Identify and create all separate models in the specified CIF data block"},from:ge.Format.Cif,to:ge.Molecule.Trajectory,params:function(e){if(!e)return{blockHeader:E.Optional(E.Text(void 0,{description:"Header of the block to parse. If none is specifed, the 1st data block in the file is used."}))};var t=e.data.blocks;return{blockHeader:E.Optional(E.Select(t[0]&&t[0].header,t.map(function(r){return[r.header,r.header]}),{description:"Header of the block to parse"}))}}})({isApplicable:function(e){return e.data.blocks.length>0},apply:function(e){var t=this,r=e.a,n=e.params;return We.create("Parse mmCIF",function(a){return ce(t,void 0,void 0,function(){var i,o,s,u;return de(this,function(l){switch(l.label){case 0:if(i=n.blockHeader||r.data.blocks[0].header,o=r.data.blocks.find(function(c){return c.header===i}),!o)throw new Error("Data block '"+[i]+"' not found.");return[4,V6(o).runInContext(a)];case 1:if(s=l.sent(),s.frameCount===0)throw new Error("No models found.");return u=ml(s),[2,new ge.Molecule.Trajectory(s,u)]}})})})}}),Gce=Ot.BuiltIn({name:"trajectory-from-pdb",display:{name:"Parse PDB",description:"Parse PDB string and create trajectory."},from:[ge.Data.String],to:ge.Molecule.Trajectory,params:{isPdbqt:E.Boolean(!1)}})({apply:function(e){var t=this,r=e.a,n=e.params;return We.create("Parse PDB",function(a){return ce(t,void 0,void 0,function(){var i,o,s;return de(this,function(u){switch(u.label){case 0:return[4,dae(r.data,r.label,n.isPdbqt).runInContext(a)];case 1:if(i=u.sent(),i.isError)throw new Error(i.message);return[4,Ule(i.result).runInContext(a)];case 2:return o=u.sent(),s=ml(o),[2,new ge.Molecule.Trajectory(o,s)]}})})})}}),qce=Ot.BuiltIn({name:"trajectory-from-gro",display:{name:"Parse GRO",description:"Parse GRO string and create trajectory."},from:[ge.Data.String],to:ge.Molecule.Trajectory})({apply:function(e){var t=this,r=e.a;return We.create("Parse GRO",function(n){return ce(t,void 0,void 0,function(){var a,i,o;return de(this,function(s){switch(s.label){case 0:return[4,cae(r.data).runInContext(n)];case 1:if(a=s.sent(),a.isError)throw new Error(a.message);return[4,xle(a.result).runInContext(n)];case 2:return i=s.sent(),o=ml(i),[2,new ge.Molecule.Trajectory(i,o)]}})})})}}),jce=Ot.BuiltIn({name:"trajectory-from-xyz",display:{name:"Parse XYZ",description:"Parse XYZ string and create trajectory."},from:[ge.Data.String],to:ge.Molecule.Trajectory})({apply:function(e){var t=this,r=e.a;return We.create("Parse XYZ",function(n){return ce(t,void 0,void 0,function(){var a,i,o;return de(this,function(s){switch(s.label){case 0:return[4,Ice(r.data).runInContext(n)];case 1:if(a=s.sent(),a.isError)throw new Error(a.message);return[4,Dce(a.result).runInContext(n)];case 2:return i=s.sent(),o=ml(i),[2,new ge.Molecule.Trajectory(i,o)]}})})})}}),Wce=Ot.BuiltIn({name:"trajectory-from-mol",display:{name:"Parse MOL",description:"Parse MOL string and create trajectory."},from:[ge.Data.String],to:ge.Molecule.Trajectory})({apply:function(e){var t=this,r=e.a;return We.create("Parse MOL",function(n){return ce(t,void 0,void 0,function(){var a,i,o;return de(this,function(s){switch(s.label){case 0:return[4,nce(r.data).runInContext(n)];case 1:if(a=s.sent(),a.isError)throw new Error(a.message);return[4,ace(a.result).runInContext(n)];case 2:return i=s.sent(),o=ml(i),[2,new ge.Molecule.Trajectory(i,o)]}})})})}}),Xce=Ot.BuiltIn({name:"trajectory-from-sdf",display:{name:"Parse SDF",description:"Parse SDF string and create trajectory."},from:[ge.Data.String],to:ge.Molecule.Trajectory})({apply:function(e){var t=this,r=e.a;return We.create("Parse SDF",function(n){return ce(t,void 0,void 0,function(){var a,i,o,s,u,l,c,d,f,p,h;return de(this,function(v){switch(v.label){case 0:return[4,kce(r.data).runInContext(n)];case 1:if(a=v.sent(),a.isError)throw new Error(a.message);i=[],o=0,s=a.result.compounds,v.label=2;case 2:return o<s.length?(u=s[o],[4,Bce(u).runInContext(n)]):[3,8];case 3:l=v.sent(),c=0,v.label=4;case 4:return c<l.frameCount?(f=(d=i).push,[4,We.resolveInContext(l.getFrameAtIndex(c),n)]):[3,7];case 5:f.apply(d,[v.sent()]),v.label=6;case 6:return c++,[3,4];case 7:return o++,[3,2];case 8:return p=new kd(i),h=ml(p),[2,new ge.Molecule.Trajectory(p,h)]}})})})}}),Yce=Ot.BuiltIn({name:"trajectory-from-mol2",display:{name:"Parse MOL2",description:"Parse MOL2 string and create trajectory."},from:[ge.Data.String],to:ge.Molecule.Trajectory})({apply:function(e){var t=this,r=e.a;return We.create("Parse MOL2",function(n){return ce(t,void 0,void 0,function(){var a,i,o;return de(this,function(s){switch(s.label){case 0:return[4,Sce(r.data,r.label).runInContext(n)];case 1:if(a=s.sent(),a.isError)throw new Error(a.message);return[4,Cce(a.result).runInContext(n)];case 2:return i=s.sent(),o=ml(i),[2,new ge.Molecule.Trajectory(i,o)]}})})})}}),Kce=Ot.BuiltIn({name:"trajectory-from-cube",display:{name:"Parse Cube",description:"Parse Cube file to create a trajectory."},from:ge.Format.Cube,to:ge.Molecule.Trajectory})({apply:function(e){var t=this,r=e.a;return We.create("Parse MOL",function(n){return ce(t,void 0,void 0,function(){var a,i;return de(this,function(o){switch(o.label){case 0:return[4,fce(r.data).runInContext(n)];case 1:return a=o.sent(),i=ml(a),[2,new ge.Molecule.Trajectory(a,i)]}})})})}}),$ce=Ot.BuiltIn({name:"trajectory-from-cif-core",display:{name:"Parse CIF Core",description:"Identify and create all separate models in the specified CIF data block"},from:ge.Format.Cif,to:ge.Molecule.Trajectory,params:function(e){if(!e)return{blockHeader:E.Optional(E.Text(void 0,{description:"Header of the block to parse. If none is specifed, the 1st data block in the file is used."}))};var t=e.data.blocks;return{blockHeader:E.Optional(E.Select(t[0]&&t[0].header,t.map(function(r){return[r.header,r.header]}),{description:"Header of the block to parse"}))}}})({apply:function(e){var t=this,r=e.a,n=e.params;return We.create("Parse CIF Core",function(a){return ce(t,void 0,void 0,function(){var i,o,s,u;return de(this,function(l){switch(l.label){case 0:if(i=n.blockHeader||r.data.blocks[0].header,o=r.data.blocks.find(function(c){return c.header===i}),!o)throw new Error("Data block '"+[i]+"' not found.");return[4,cce(o).runInContext(a)];case 1:if(s=l.sent(),s.frameCount===0)throw new Error("No models found.");return u=ml(s),[2,new ge.Molecule.Trajectory(s,u)]}})})})}}),Qce=function(e){return e+1},Zce=function(e){return e-1},Jce=Ot.BuiltIn({name:"model-from-trajectory",display:{name:"Molecular Model",description:"Create a molecular model from specified index in a trajectory."},from:ge.Molecule.Trajectory,to:ge.Molecule.Model,params:function(e){return e?{modelIndex:E.Converted(Qce,Zce,E.Numeric(1,{min:1,max:e.data.frameCount,step:1},{description:"Model Index",immediateUpdate:!0}))}:{modelIndex:E.Numeric(0,{},{description:"Zero-based index of the model",immediateUpdate:!0})}}})({isApplicable:function(e){return e.data.frameCount>0},apply:function(e){var t=this,r=e.a,n=e.params;return We.create("Model from Trajectory",function(a){return ce(t,void 0,void 0,function(){var i,o,s,u;return de(this,function(l){switch(l.label){case 0:return i=n.modelIndex%r.data.frameCount,i<0&&(i+=r.data.frameCount),[4,We.resolveInContext(r.data.getFrameAtIndex(i),a)];case 1:return o=l.sent(),s="Model "+(i+1),u=r.data.frameCount===1?void 0:"of "+r.data.frameCount,[2,new ge.Molecule.Model(o,{label:s,description:u})]}})})})},interpolate:function(e,t,r){var n=r>=1?t.modelIndex:e.modelIndex+Math.floor((t.modelIndex-e.modelIndex+1)*r);return{modelIndex:n}},dispose:function(e){var t=e.b;t==null||t.data.customProperties.dispose()}}),ede=Ot.BuiltIn({name:"structure-from-trajectory",display:{name:"Structure from Trajectory",description:"Create a molecular structure from a trajectory."},from:ge.Molecule.Trajectory,to:ge.Molecule.Structure})({apply:function(e){var t=this,r=e.a;return We.create("Build Structure",function(n){return ce(t,void 0,void 0,function(){var a,i;return de(this,function(o){switch(o.label){case 0:return[4,Xe.ofTrajectory(r.data,n)];case 1:return a=o.sent(),i={label:"Ensemble",description:Xe.elementDescription(a)},[2,new ge.Molecule.Structure(a,i)]}})})})},dispose:function(e){var t=e.b;t==null||t.data.customPropertyDescriptors.dispose()}}),tde=Ot.BuiltIn({name:"structure-from-model",display:{name:"Structure",description:"Create a molecular structure (model, assembly, or symmetry) from the specified model."},from:ge.Molecule.Model,to:ge.Molecule.Structure,params:function(e){return wd.getParams(e&&e.data)}})({canAutoUpdate:function(e){var t=e.oldParams,r=e.newParams;return wd.canAutoUpdate(t.type,r.type)},apply:function(e,t){var r=this,n=e.a,a=e.params;return We.create("Build Structure",function(i){return ce(r,void 0,void 0,function(){return de(this,function(o){return[2,wd.create(t,i,n.data,a&&a.type)]})})})},update:function(e){var t=e.a,r=e.b,n=e.oldParams,a=e.newParams;return ku(n,a)?r.data.model===t.data?ft.UpdateResult.Unchanged:jt.areHierarchiesEqual(t.data,r.data.model)?(r.data=r.data.remapModel(t.data),ft.UpdateResult.Updated):ft.UpdateResult.Recreate:ft.UpdateResult.Recreate},dispose:function(e){var t=e.b;t==null||t.data.customPropertyDescriptors.dispose()}}),RE=C(),OE=ue(),FE=ue(),rde=Ot.BuiltIn({name:"transform-structure-conformation",display:{name:"Transform Conformation"},isDecorator:!0,from:ge.Molecule.Structure,to:ge.Molecule.Structure,params:{transform:E.MappedStatic("components",{components:E.Group({axis:E.Vec3(C.create(1,0,0)),angle:E.Numeric(0,{min:-180,max:180,step:.1}),translation:E.Vec3(C.create(0,0,0))},{isFlat:!0}),matrix:E.Group({data:E.Mat4(ue.identity()),transpose:E.Boolean(!1)},{isFlat:!0})},{label:"Kind"})}})({canAutoUpdate:function(e){var t=e.newParams;return t.transform.name!=="matrix"},apply:function(e){var t=e.a,r=e.params,n=ue();if(r.transform.name==="components"){var a=r.transform.params,i=a.axis,o=a.angle,s=a.translation,u=t.data.boundary.sphere.center;ue.fromTranslation(OE,C.negate(RE,u)),ue.fromTranslation(FE,C.add(RE,u,s));var l=ue.fromRotation(ue(),Math.PI/180*o,C.normalize(C(),i));ue.mul3(n,FE,l,OE)}else r.transform.name==="matrix"&&(ue.copy(n,r.transform.params.data),r.transform.params.transpose&&ue.transpose(n,n));var c=Xe.transform(t.data,n);return new ge.Molecule.Structure(c,{label:t.label,description:t.description+" [Transformed]"})},dispose:function(e){var t=e.b;t==null||t.data.customPropertyDescriptors.dispose()}}),nde=Ot.BuiltIn({name:"structure-selection-from-expression",display:{name:"Selection",description:"Create a molecular structure from the specified expression."},from:ge.Molecule.Structure,to:ge.Molecule.Structure,params:function(){return{expression:E.Value(se.struct.generator.all,{isHidden:!0}),label:E.Optional(E.Text("",{isHidden:!0}))}}})({apply:function(e){var t=e.a,r=e.params,n=e.cache,a=Ya.createAndRun(t.data,r.expression),i=a.selection,o=a.entry;if(n.entry=o,mt.isEmpty(i))return Cn.Null;var s=mt.unionStructure(i),u={label:""+(r.label||"Selection"),description:Xe.elementDescription(s)};return new ge.Molecule.Structure(s,u)},update:function(e){var t=e.a,r=e.b,n=e.oldParams,a=e.newParams,i=e.cache;if(n.expression!==a.expression)return ft.UpdateResult.Recreate;var o=i.entry;if(o.currentStructure===t.data)return ft.UpdateResult.Unchanged;var s=Ya.updateStructure(o,t.data);return mt.isEmpty(s)?ft.UpdateResult.Null:(Ya.updateStructureObject(r,s,a.label),ft.UpdateResult.Updated)},dispose:function(e){var t=e.b;t==null||t.data.customPropertyDescriptors.dispose()}}),ade=Ot.BuiltIn({name:"structure-multi-selection-from-expression",display:{name:"Multi-structure Measurement Selection",description:"Create selection object from multiple structures."},from:ge.Root,to:ge.Molecule.Structure.Selections,params:function(){return{selections:E.ObjectList({key:E.Text(void 0,{description:"A unique key."}),ref:E.Text(),groupId:E.Optional(E.Text()),expression:E.Value(se.struct.generator.empty)},function(e){return e.ref},{isHidden:!0}),isTransitive:E.Optional(E.Boolean(!1,{isHidden:!0,description:"Remap the selections from the original structure if structurally equivalent."})),label:E.Optional(E.Text("",{isHidden:!0}))}}})({apply:function(e){for(var t=e.params,r=e.cache,n=e.dependencies,a=new Map,i=[],o=0,s=0,u=t.selections;s<u.length;s++){var l=u[s],c=Ya.createAndRun(n[l.ref].data,l.expression),d=c.selection,f=c.entry;a.set(l.key,f);var p=mt.toLociWithSourceUnits(d);i.push({key:l.key,loci:p,groupId:l.groupId}),o+=Re.size(p)}r.entries=a;var h={label:""+(t.label||"Multi-selection"),description:t.selections.length+" source(s), "+o+" element(s) total"};return new ge.Molecule.Structure.Selections(i,h)},update:function(e){var t=e.b,r=e.oldParams,n=e.newParams,a=e.cache,i=e.dependencies;if(!!r.isTransitive!=!!n.isTransitive)return ft.UpdateResult.Recreate;for(var o=a.entries,s=new Map,u=new Map,l=0,c=t.data;l<c.length;l++){var d=c[l];u.set(d.key,d)}for(var f=!1,p=0,h=[],v=0,m=n.selections;v<m.length;v++){var g=m[v],y=i[g.ref].data,b=!1;if(o.has(g.key)){var x=o.get(g.key);if(Ya.isUnchanged(x,g.expression,y)&&u.has(g.key)){var S=u.get(g.key);S.groupId!==g.groupId&&(S.groupId=g.groupId,f=!0),s.set(g.key,x),h.push(S),p+=Re.size(S.loci);continue}if(x.expression!==g.expression)b=!0;else{var _=!1;if(n.isTransitive)if(Xe.areUnitIdsAndIndicesEqual(x.originalStructure,y)){var A=Ya.run(x,x.originalStructure);x.currentStructure=y,s.set(g.key,x);var S=Re.remap(mt.toLociWithSourceUnits(A),y);h.push({key:g.key,loci:S,groupId:g.groupId}),p+=Re.size(S),f=!0}else _=!0;else _=!0;if(_){f=!0;var A=Ya.updateStructure(x,y);s.set(g.key,x);var S=mt.toLociWithSourceUnits(A);h.push({key:g.key,loci:S,groupId:g.groupId}),p+=Re.size(S)}}}else b=!0;if(b){f=!0;var T=Ya.createAndRun(y,g.expression),A=T.selection,x=T.entry;s.set(g.key,x);var S=mt.toLociWithSourceUnits(A);h.push({key:g.key,loci:S}),p+=Re.size(S)}}return f?(a.entries=s,t.data=h,t.label=""+(n.label||"Multi-selection"),t.description=h.length+" source(s), "+p+" element(s) total",ft.UpdateResult.Updated):ft.UpdateResult.Unchanged}}),ide=Ot.BuiltIn({name:"structure-selection-from-script",display:{name:"Selection",description:"Create a molecular structure from the specified script."},from:ge.Molecule.Structure,to:ge.Molecule.Structure,params:function(){return{script:E.Script({language:"mol-script",expression:"(sel.atom.atom-groups :residue-test (= atom.resname ALA))"}),label:E.Optional(E.Text(""))}}})({apply:function(e){var t=e.a,r=e.params,n=e.cache,a=Ya.createAndRun(t.data,r.script),i=a.selection,o=a.entry;n.entry=o;var s=mt.unionStructure(i),u={label:""+(r.label||"Selection"),description:Xe.elementDescription(s)};return new ge.Molecule.Structure(s,u)},update:function(e){var t=e.a,r=e.b,n=e.oldParams,a=e.newParams,i=e.cache;if(!pa.areEqual(n.script,a.script))return ft.UpdateResult.Recreate;var o=i.entry;if(o.currentStructure===t.data)return ft.UpdateResult.Unchanged;var s=Ya.updateStructure(o,t.data);return Ya.updateStructureObject(r,s,a.label),ft.UpdateResult.Updated},dispose:function(e){var t=e.b;t==null||t.data.customPropertyDescriptors.dispose()}}),ode=Ot.BuiltIn({name:"structure-selection-from-bundle",display:{name:"Selection",description:"Create a molecular structure from the specified structure-element bundle."},from:ge.Molecule.Structure,to:ge.Molecule.Structure,params:function(){return{bundle:E.Value(Qr.Empty,{isHidden:!0}),label:E.Optional(E.Text("",{isHidden:!0}))}}})({apply:function(e){var t=e.a,r=e.params,n=e.cache;if(r.bundle.hash!==t.data.hashCode)return Cn.Null;n.source=t.data;var a=Qr.toStructure(r.bundle,t.data);if(a.elementCount===0)return Cn.Null;var i={label:""+(r.label||"Selection"),description:Xe.elementDescription(a)};return new ge.Molecule.Structure(a,i)},update:function(e){var t=e.a,r=e.b,n=e.oldParams,a=e.newParams,i=e.cache;if(!Qr.areEqual(n.bundle,a.bundle))return ft.UpdateResult.Recreate;if(a.bundle.hash!==t.data.hashCode)return ft.UpdateResult.Null;if(i.source===t.data)return ft.UpdateResult.Unchanged;i.source=t.data;var o=Qr.toStructure(a.bundle,t.data);return o.elementCount===0?ft.UpdateResult.Null:(r.label=""+(a.label||"Selection"),r.description=Xe.elementDescription(o),r.data=o,ft.UpdateResult.Updated)},dispose:function(e){var t=e.b;t==null||t.data.customPropertyDescriptors.dispose()}}),vF={polymer:"polymer",protein:"protein",nucleic:"nucleic",water:"water",branched:"branched",ligand:"ligand","non-standard":"non-standard",coarse:"coarse","atomic-sequence":"atomic-sequence","atomic-het":"atomic-het",spheres:"spheres"},sde=E.objectToOptions(vF),ude=Ot.BuiltIn({name:"structure-complex-element",display:{name:"Complex Element",description:"Create a molecular structure from the specified model."},from:ge.Molecule.Structure,to:ge.Molecule.Structure,params:{type:E.Select("atomic-sequence",sde,{isHidden:!0})}})({apply:function(e){var t=e.a,r=e.params,n,a;switch(r.type){case"polymer":n=Xn.polymer.query,a="Polymer";break;case"protein":n=Xn.protein.query,a="Protein";break;case"nucleic":n=Xn.nucleic.query,a="Nucleic";break;case"water":n=Zr.internal.water(),a="Water";break;case"branched":n=Xn.branchedPlusConnected.query,a="Branched";break;case"ligand":n=Xn.ligandPlusConnected.query,a="Ligand";break;case"non-standard":n=Xn.nonStandardPolymer.query,a="Non-standard";break;case"coarse":n=Xn.coarse.query,a="Coarse";break;case"atomic-sequence":n=Zr.internal.atomicSequence(),a="Sequence";break;case"atomic-het":n=Zr.internal.atomicHet(),a="HET Groups/Ligands";break;case"spheres":n=Zr.internal.spheres(),a="Coarse Spheres";break;default:throw new Error(r.type+" is a not valid complex element.")}var i=n(new Qi(t.data)),o=mt.unionStructure(i);return o.elementCount===0?Cn.Null:new ge.Molecule.Structure(o,{label:a,description:Xe.elementDescription(o)})},dispose:function(e){var t=e.b;t==null||t.data.customPropertyDescriptors.dispose()}}),lde=Ot.BuiltIn({name:"structure-component",display:{name:"Component",description:"A molecular structure component."},from:ge.Molecule.Structure,to:ge.Molecule.Structure,params:Jle})({apply:function(e){var t=e.a,r=e.params,n=e.cache;return ece(t.data,r,n)},update:function(e){var t=e.a,r=e.b,n=e.oldParams,a=e.newParams,i=e.cache;return tce(t.data,r,n,a,i)},dispose:function(e){var t=e.b;t==null||t.data.customPropertyDescriptors.dispose()}}),mF=Ot.BuiltIn({name:"custom-model-properties",display:{name:"Custom Model Properties"},isDecorator:!0,from:ge.Molecule.Model,to:ge.Molecule.Model,params:function(e,t){return t.customModelProperties.getParams(e==null?void 0:e.data)}})({apply:function(e,t){var r=this,n=e.a,a=e.params;return We.create("Custom Props",function(i){return ce(r,void 0,void 0,function(){return de(this,function(o){switch(o.label){case 0:return[4,kE(n.data,t,i,a)];case 1:return o.sent(),[2,new ge.Molecule.Model(n.data,{label:n.label,description:n.description})]}})})})},update:function(e,t){var r=this,n=e.a,a=e.b,i=e.oldParams,o=e.newParams;return We.create("Custom Props",function(s){return ce(r,void 0,void 0,function(){var u,l,c,d;return de(this,function(f){switch(f.label){case 0:for(a.data=n.data,a.label=n.label,a.description=n.description,u=0,l=i.autoAttach;u<l.length;u++)c=l[u],d=t.customModelProperties.get(c),d&&n.data.customProperties.reference(d.descriptor,!1);return[4,kE(n.data,t,s,o)];case 1:return f.sent(),[2,ft.UpdateResult.Updated]}})})})},dispose:function(e){var t=e.b;t==null||t.data.customProperties.dispose()}});function kE(e,t,r,n){return ce(this,void 0,void 0,function(){var a,i,o,s,u,l,c,d,f;return de(this,function(p){switch(p.label){case 0:a={runtime:r,assetManager:t.managers.asset},i=n.autoAttach,o=n.properties,s=0,u=Object.keys(o),p.label=1;case 1:if(!(s<u.length))return[3,8];if(l=u[s],c=t.customModelProperties.get(l),d=o[l],!(i.includes(l)||c.isHidden))return[3,6];p.label=2;case 2:return p.trys.push([2,4,,5]),[4,c.attach(a,e,d,!0)];case 3:return p.sent(),[3,5];case 4:return f=p.sent(),t.log.warn("Error attaching model prop '"+l+"': "+f),[3,5];case 5:return[3,7];case 6:c.set(e,d),p.label=7;case 7:return s++,[3,1];case 8:return[2]}})})}var gF=Ot.BuiltIn({name:"custom-structure-properties",display:{name:"Custom Structure Properties"},isDecorator:!0,from:ge.Molecule.Structure,to:ge.Molecule.Structure,params:function(e,t){return t.customStructureProperties.getParams(e==null?void 0:e.data.root)}})({apply:function(e,t){var r=this,n=e.a,a=e.params;return We.create("Custom Props",function(i){return ce(r,void 0,void 0,function(){return de(this,function(o){switch(o.label){case 0:return[4,BE(n.data.root,t,i,a)];case 1:return o.sent(),[2,new ge.Molecule.Structure(n.data,{label:n.label,description:n.description})]}})})})},update:function(e,t){var r=this,n=e.a,a=e.b,i=e.oldParams,o=e.newParams;return n.data!==a.data?ft.UpdateResult.Recreate:We.create("Custom Props",function(s){return ce(r,void 0,void 0,function(){var u,l,c,d;return de(this,function(f){switch(f.label){case 0:for(a.data=n.data,a.label=n.label,a.description=n.description,u=0,l=i.autoAttach;u<l.length;u++)c=l[u],d=t.customStructureProperties.get(c),d&&n.data.customPropertyDescriptors.reference(d.descriptor,!1);return[4,BE(n.data.root,t,s,o)];case 1:return f.sent(),[2,ft.UpdateResult.Updated]}})})})},dispose:function(e){var t=e.b;t==null||t.data.customPropertyDescriptors.dispose()}});function BE(e,t,r,n){return ce(this,void 0,void 0,function(){var a,i,o,s,u,l,c,d,f;return de(this,function(p){switch(p.label){case 0:a={runtime:r,assetManager:t.managers.asset},i=n.autoAttach,o=n.properties,s=0,u=Object.keys(o),p.label=1;case 1:if(!(s<u.length))return[3,8];if(l=u[s],c=t.customStructureProperties.get(l),d=o[l],!(i.includes(l)||c.isHidden))return[3,6];p.label=2;case 2:return p.trys.push([2,4,,5]),[4,c.attach(a,e,d,!0)];case 3:return p.sent(),[3,5];case 4:return f=p.sent(),t.log.warn("Error attaching structure prop '"+l+"': "+f),[3,5];case 5:return[3,7];case 6:c.set(e,d),p.label=7;case 7:return s++,[3,1];case 8:return[2]}})})}var cde=Ot.BuiltIn({name:"shape-from-ply",display:{name:"Shape from PLY",description:"Create Shape from PLY data"},from:ge.Format.Ply,to:ge.Shape.Provider,params:function(e){return{}}})({apply:function(e){var t=this,r=e.a;return e.params,We.create("Create shape from PLY",function(n){return ce(t,void 0,void 0,function(){var a,i;return de(this,function(o){switch(o.label){case 0:return[4,dle(r.data).runInContext(n)];case 1:return a=o.sent(),i={label:"Shape"},[2,new ge.Shape.Provider(a,i)]}})})})}}),dde=Object.freeze(Object.defineProperty({__proto__:null,CoordinatesFromDcd:Lce,CoordinatesFromXtc:Nce,TopologyFromPsf:Uce,TrajectoryFromModelAndCoordinates:hF,TrajectoryFromBlob:Vce,TrajectoryFromMmCif:Hce,TrajectoryFromPDB:Gce,TrajectoryFromGRO:qce,TrajectoryFromXYZ:jce,TrajectoryFromMOL:Wce,TrajectoryFromSDF:Xce,TrajectoryFromMOL2:Yce,TrajectoryFromCube:Kce,TrajectoryFromCifCore:$ce,ModelFromTrajectory:Jce,StructureFromTrajectory:ede,StructureFromModel:tde,TransformStructureConformation:rde,StructureSelectionFromExpression:nde,MultiStructureSelectionFromExpression:ade,StructureSelectionFromScript:ide,StructureSelectionFromBundle:ode,StructureComplexElement:ude,StructureComponent:lde,CustomModelProperties:mF,CustomStructureProperties:gF,ShapeFromPly:cde,StructureComplexElementTypes:vF},Symbol.toStringTag,{value:"Module"}));function fde(e){return e.originX===0&&e.originY===0&&e.originZ===0?C.create(e.NCSTART,e.NRSTART,e.NSSTART):C.create(e.originX/(e.xLength/e.NX),e.originY/(e.yLength/e.NY),e.originZ/(e.zLength/e.NZ))}function pde(e){var t=gO(e);switch(t){case Fa.Float32:return Float32Array;case Fa.Int8:return Int8Array;case Fa.Int16:return Int16Array;case Fa.Uint16:return Uint16Array}throw Error(t+" is not a supported value format.")}function hde(e,t){var r=this;return We.create("Create Volume",function(n){return ce(r,void 0,void 0,function(){var a,i,o,s,u,l,c,d,f,p,h,v,m,g,y,b,x;return de(this,function(S){return a=e.header,i=e.values,o=C.create(a.xLength,a.yLength,a.zLength),t&&t.voxelSize&&C.mul(o,o,t.voxelSize),s=C.create(Wr(a.alpha),Wr(a.beta),Wr(a.gamma)),u=a.ISPG>65536?0:a.ISPG,l=Ei.create(u||"P 1",o,s),c=C.create(a.MAPC-1,a.MAPR-1,a.MAPS-1),d=Pr.convertToCanonicalAxisIndicesFastToSlow(c),f=[a.NX,a.NY,a.NZ],p=d([a.NC,a.NR,a.NS]),h=fde(a),t!=null&&t.offset&&C.add(h,h,t.offset),v=d(h),m=C.create(v[0]/f[0],v[1]/f[1],v[2]/f[2]),g=C.create(p[0]/f[0],p[1]/f[1],p[2]/f[2]),y=Pr.Space(p,Pr.invertAxisOrder(c),pde(a)),b=Pr.create(y,Pr.Data1(i)),x=a.AMIN===0&&a.AMAX===0&&a.AMEAN===0&&a.ARMS===0,[2,{label:t==null?void 0:t.label,entryId:t==null?void 0:t.entryId,grid:{transform:{kind:"spacegroup",cell:l,fractionalBox:Xt.create(m,C.add(C.zero(),m,g))},cells:b,stats:{min:isNaN(a.AMIN)||x?Oy(i):a.AMIN,max:isNaN(a.AMAX)||x?Gs(i):a.AMAX,mean:isNaN(a.AMEAN)||x?Fy(i):a.AMEAN,sigma:isNaN(a.ARMS)||a.ARMS===0?ky(i):a.ARMS}},sourceData:aC.create(e),customProperties:new Ks,_propertyData:Object.create(null)}]})})})}var aC;(function(e){function t(n){return(n==null?void 0:n.kind)==="ccp4"}e.is=t;function r(n){return{kind:"ccp4",name:n.name,data:n}}e.create=r})(aC||(aC={}));function yF(e,t){var r=this;return We.create("Create Volume",function(n){return ce(r,void 0,void 0,function(){var a,i,o,s,u,l,c,d,f,p;return de(this,function(h){return a=e.volume_data_3d_info,i=e.volume_data_3d,o=Ei.create(a.spacegroup_number.value(0),C.ofArray(a.spacegroup_cell_size.value(0)),C.scale(C.zero(),C.ofArray(a.spacegroup_cell_angles.value(0)),Math.PI/180)),s=a.axis_order.value(0),u=Pr.convertToCanonicalAxisIndicesFastToSlow(s),l=u(a.sample_count.value(0)),c=Pr.Space(l,Pr.invertAxisOrder(s),Float32Array),d=Pr.create(c,Pr.Data1(i.values.toArray({array:Float32Array}))),f=C.ofArray(u(a.origin.value(0))),p=C.ofArray(u(a.dimensions.value(0))),[2,{label:t==null?void 0:t.label,entryId:t==null?void 0:t.entryId,grid:{transform:{kind:"spacegroup",cell:o,fractionalBox:Xt.create(f,C.add(C.zero(),f,p))},cells:d,stats:{min:a.min_sampled.value(0),max:a.max_sampled.value(0),mean:a.mean_sampled.value(0),sigma:a.sigma_sampled.value(0)}},sourceData:Dg.create(e),customProperties:new Ks,_propertyData:Object.create(null)}]})})})}var Dg;(function(e){function t(n){return(n==null?void 0:n.kind)==="dscif"}e.is=t;function r(n){return{kind:"dscif",name:n._name,data:n}}e.create=r})(Dg||(Dg={}));function vde(e,t){var r=this;return We.create("Create Volume",function(n){return ce(r,void 0,void 0,function(){var a,i,o,s,u,l,c,d,f,p,h,v;return de(this,function(m){return a=e.header,i=e.values,o=C.create(a.xlen,a.ylen,a.zlen),t&&t.voxelSize&&C.mul(o,o,t.voxelSize),s=C.create(Wr(a.alpha),Wr(a.beta),Wr(a.gamma)),u=Ei.create("P 1",o,s),l=[a.xRate,a.yRate,a.zRate],c=[a.xExtent,a.yExtent,a.zExtent],d=[a.xStart,a.yStart,a.zStart],f=C.create(d[0]/l[0],d[1]/l[1],d[2]/l[2]),p=C.create(c[0]/l[0],c[1]/l[1],c[2]/l[2]),h=Pr.Space(c,[0,1,2],Float32Array),v=Pr.create(h,Pr.Data1(i)),[2,{label:t==null?void 0:t.label,entryId:t==null?void 0:t.entryId,grid:{transform:{kind:"spacegroup",cell:u,fractionalBox:Xt.create(f,C.add(C.zero(),f,p))},cells:v,stats:{min:Oy(i),max:Gs(i),mean:Fy(i),sigma:a.sigma!==void 0?a.sigma:ky(i)}},sourceData:iC.create(e),customProperties:new Ks,_propertyData:Object.create(null)}]})})})}var iC;(function(e){function t(n){return(n==null?void 0:n.kind)==="dsn6"}e.is=t;function r(n){return{kind:"dsn6",name:n.name,data:n}}e.create=r})(iC||(iC={}));function mde(e,t){var r=this;return We.create("Create Volume",function(){return ce(r,void 0,void 0,function(){var n,a,i,o,s,u;return de(this,function(l){return n=e.header,a=e.values,i=Pr.Space(n.dim,[0,1,2],Float64Array),o=Pr.create(i,Pr.Data1(a)),s=ue.fromTranslation(ue(),n.min),u=ue.fromScaling(ue(),n.h),ue.mul(s,s,u),[2,{label:t==null?void 0:t.label,entryId:t==null?void 0:t.entryId,grid:{transform:{kind:"matrix",matrix:s},cells:o,stats:{min:Oy(a),max:Gs(a),mean:Fy(a),sigma:ky(a)}},sourceData:oC.create(e),customProperties:new Ks,_propertyData:Object.create(null)}]})})})}var oC;(function(e){function t(n){return(n==null?void 0:n.kind)==="dx"}e.is=t;function r(n){return{kind:"dx",name:n.name,data:n}}e.create=r})(oC||(oC={}));var gde=Ot.BuiltIn({name:"volume-from-ccp4",display:{name:"Volume from CCP4/MRC/MAP",description:"Create Volume from CCP4/MRC/MAP data"},from:ge.Format.Ccp4,to:ge.Volume.Data,params:function(e){return{voxelSize:E.Vec3(C.create(1,1,1)),offset:E.Vec3(C.create(0,0,0)),entryId:E.Text("")}}})({apply:function(e){var t=this,r=e.a,n=e.params;return We.create("Create volume from CCP4/MRC/MAP",function(a){return ce(t,void 0,void 0,function(){var i,o;return de(this,function(s){switch(s.label){case 0:return[4,hde(r.data,w(w({},n),{label:r.data.name||r.label})).runInContext(a)];case 1:return i=s.sent(),o={label:i.label||"Volume",description:"Volume "+r.data.header.NX+"\xD7"+r.data.header.NX+"\xD7"+r.data.header.NX},[2,new ge.Volume.Data(i,o)]}})})})},dispose:function(e){var t=e.b;t==null||t.data.customProperties.dispose()}}),yde=Ot.BuiltIn({name:"volume-from-dsn6",display:{name:"Volume from DSN6/BRIX",description:"Create Volume from DSN6/BRIX data"},from:ge.Format.Dsn6,to:ge.Volume.Data,params:function(e){return{voxelSize:E.Vec3(C.create(1,1,1)),entryId:E.Text("")}}})({apply:function(e){var t=this,r=e.a,n=e.params;return We.create("Create volume from DSN6/BRIX",function(a){return ce(t,void 0,void 0,function(){var i,o;return de(this,function(s){switch(s.label){case 0:return[4,vde(r.data,w(w({},n),{label:r.data.name||r.label})).runInContext(a)];case 1:return i=s.sent(),o={label:i.label||"Volume",description:"Volume "+r.data.header.xExtent+"\xD7"+r.data.header.yExtent+"\xD7"+r.data.header.zExtent},[2,new ge.Volume.Data(i,o)]}})})})},dispose:function(e){var t=e.b;t==null||t.data.customProperties.dispose()}}),bde=Ot.BuiltIn({name:"volume-from-cube",display:{name:"Volume from Cube",description:"Create Volume from Cube data"},from:ge.Format.Cube,to:ge.Volume.Data,params:function(e){var t=e?E.Select(0,e.data.header.dataSetIds.map(function(r,n){return[n,""+r]})):E.Numeric(0);return{dataIndex:t,entryId:E.Text("")}}})({apply:function(e){var t=this,r=e.a,n=e.params;return We.create("Create volume from Cube",function(a){return ce(t,void 0,void 0,function(){var i,o;return de(this,function(s){switch(s.label){case 0:return[4,$ae(r.data,w(w({},n),{label:r.data.name||r.label})).runInContext(a)];case 1:return i=s.sent(),o={label:i.label||"Volume",description:"Volume "+r.data.header.dim[0]+"\xD7"+r.data.header.dim[1]+"\xD7"+r.data.header.dim[2]},[2,new ge.Volume.Data(i,o)]}})})})},dispose:function(e){var t=e.b;t==null||t.data.customProperties.dispose()}}),Sde=Ot.BuiltIn({name:"volume-from-dx",display:{name:"Parse DX",description:"Create volume from DX data."},from:ge.Format.Dx,to:ge.Volume.Data})({apply:function(e){var t=this,r=e.a;return We.create("Parse DX",function(n){return ce(t,void 0,void 0,function(){var a,i;return de(this,function(o){switch(o.label){case 0:return[4,mde(r.data,{label:r.data.name||r.label}).runInContext(n)];case 1:return a=o.sent(),i={label:a.label||"Volume",description:"Volume "+r.data.header.dim[0]+"\xD7"+r.data.header.dim[1]+"\xD7"+r.data.header.dim[2]},[2,new ge.Volume.Data(a,i)]}})})})},dispose:function(e){var t=e.b;t==null||t.data.customProperties.dispose()}}),xde=Ot.BuiltIn({name:"volume-from-density-server-cif",display:{name:"Volume from density-server CIF",description:"Identify and create all separate models in the specified CIF data block"},from:ge.Format.Cif,to:ge.Volume.Data,params:function(e){if(!e)return{blockHeader:E.Optional(E.Text(void 0,{description:"Header of the block to parse. If none is specifed, the 1st data block in the file is used."})),entryId:E.Text("")};var t=e.data.blocks.slice(1);return{blockHeader:E.Optional(E.Select(t[0]&&t[0].header,t.map(function(r){return[r.header,r.header]}),{description:"Header of the block to parse"})),entryId:E.Text("")}}})({isApplicable:function(e){return e.data.blocks.length>0},apply:function(e){var t=this,r=e.a,n=e.params;return We.create("Parse density-server CIF",function(a){return ce(t,void 0,void 0,function(){var i,o,s,u,l,c,d,f,p,h;return de(this,function(v){switch(v.label){case 0:if(i=n.blockHeader||r.data.blocks[1].header,o=r.data.blocks.find(function(m){return m.header===i}),!o)throw new Error("Data block '"+[i]+"' not found.");return s=Gu.schema.densityServer(o),[4,yF(s,{entryId:n.entryId}).runInContext(a)];case 1:return u=v.sent(),l=u.grid.cells.space.dimensions,c=l[0],d=l[1],f=l[2],p={label:(h=n.entryId)!==null&&h!==void 0?h:s.volume_data_3d_info.name.value(0),description:"Volume "+c+"\xD7"+d+"\xD7"+f},[2,new ge.Volume.Data(u,p)]}})})})},dispose:function(e){var t=e.b;t==null||t.data.customProperties.dispose()}}),Cde=Ot.BuiltIn({name:"assign-color-volume",display:{name:"Assign Color Volume",description:"Assigns another volume to be available for coloring."},from:ge.Volume.Data,to:ge.Volume.Data,isDecorator:!0,params:function(e,t){if(!e)return{ref:E.Text()};var r=t.state.data.select(ar.Generators.root.subtree().ofType(ge.Volume.Data).filter(function(n){var a;return!!n.obj&&!(!((a=n.obj)===null||a===void 0)&&a.data.colorVolume)&&n.obj!==e}));return r.length===0?{ref:E.Text("",{isHidden:!0})}:{ref:E.Select(r[0].transform.ref,r.map(function(n){return[n.transform.ref,n.obj.label]}))}}})({apply:function(e){var t=this,r=e.a,n=e.params,a=e.dependencies;return We.create("Assign Color Volume",function(i){return ce(t,void 0,void 0,function(){var o,s,u;return de(this,function(l){if(!a||!a[n.ref])throw new Error("Dependency not available.");return o=a[n.ref].data,s=w(w({},r.data),{colorVolume:o}),u={label:r.label,description:"Volume + Colors"},[2,new ge.Volume.Data(s,u)]})})})}}),_de=Object.freeze(Object.defineProperty({__proto__:null,VolumeFromCcp4:gde,VolumeFromDsn6:yde,VolumeFromCube:bde,VolumeFromDx:Sde,AssignColorVolume:Cde,VolumeFromDensityServerCif:xde},Symbol.toStringTag,{value:"Module"})),zm=it(13421772),wde="Assigns colors according to the Symbol Nomenclature for Glycans (SNFG).",bF={};function Ade(e){return bF}function SF(e,t){var r;if(e.structure){var n=e.structure.carbohydrates,a=n.elements,i=n.getElementIndices,o=function(s,u){if(!ze.isAtomic(s))return zm;var l=i(s,u);return l.length>0?a[l[0]].component.color:zm};r=function(s,u){return u?Mt.Secondary:Ze.is(s)?o(s.unit,s.element):Ht.isLocation(s)?o(s.aUnit,s.aUnit.elements[s.aIndex]):zm}}else r=function(){return zm};return{factory:SF,granularity:"group",color:r,props:t,description:wde,legend:Pc(BK)}}var Pde={name:"carbohydrate-symbol",label:"Carbohydrate Symbol",category:"Residue Property",factory:SF,getParams:Ade,defaultValues:E.getDefaultValues(bF),isApplicable:function(e){return!!e.structure&&e.structure.models.some(function(t){return jt.hasCarbohydrate(t)})}},xF={hue:E.Interval([1,360],{min:0,max:360,step:1}),chroma:E.Interval([40,70],{min:0,max:100,step:1}),luminance:E.Interval([15,85],{min:0,max:100,step:1}),clusteringStepCount:E.Numeric(50,{min:10,max:200,step:1},{isHidden:!0}),minSampleCount:E.Numeric(800,{min:100,max:5e3,step:100},{isHidden:!0})};function CF(e,t){return Math.sqrt(Math.pow(Math.abs(e[0]-t[0]),2)+Math.pow(Math.abs(e[1]-t[1]),2)+Math.pow(Math.abs(e[2]-t[2]),2))}var Ef=2,Uc=[0,0,0],zc=[0,0,0];function Tde(e,t){return Ia.toHcl(Uc,e),Ia.fromColor(zc,Ia.toColor(e)),Uc[0]>=t.hue[0]&&Uc[0]<=t.hue[1]&&Uc[1]>=t.chroma[0]&&Uc[1]<=t.chroma[1]&&Uc[2]>=t.luminance[0]&&Uc[2]<=t.luminance[1]&&zc[0]>=e[0]-Ef&&zc[0]<=e[0]+Ef&&zc[1]>=e[1]-Ef&&zc[1]<=e[1]+Ef&&zc[2]>=e[2]-Ef&&zc[2]<=e[2]+Ef}function Ede(e){for(var t=e.slice(0),r=[t.shift()];t.length>0;){for(var n=r[r.length-1],a=0,i=Number.MIN_SAFE_INTEGER,o=0;o<t.length;++o){var s=CF(n,t[o]);s>i&&(i=s,a=o)}r.push(t.splice(a,1)[0])}return r}function Ide(e,t){for(var r=new Map,n=Math.cbrt(e)*1.001,a=(t.hue[1]-t.hue[0])/n,i=(t.chroma[1]-t.chroma[0])/n,o=(t.luminance[1]-t.luminance[0])/n,s=t.hue[0];s<=t.hue[1];s+=a)for(var u=t.chroma[0];u<=t.chroma[1];u+=i)for(var l=t.luminance[0];l<=t.luminance[1];l+=o){var c=Ia.fromHcl(Ia(),zs.create(s,u,l));Tde(c,t)&&r.set(c.toString(),c)}return Array.from(r.values())}function Mde(e,t){t===void 0&&(t={});var r=w(w({},E.getDefaultValues(xF)),t);if(e<=0)return[];var n=Ide(Math.max(r.minSampleCount,e*5),r);if(n.length<e)throw new Error("Not enough samples to generate distinct colors, increase sample count.");for(var a=[],i=[],o=Math.floor(n.length/e),s=0;s<n.length&&(a.push(n[s]),i.push([]),!(a.length>=e));s+=o);for(var u=1;u<=r.clusteringStepCount;++u){for(var l=hc(i),s=0;s<n.length;++s){for(var c=Number.MAX_SAFE_INTEGER,d=0,f=0;f<a.length;f++){var p=CF(n[s],a[f]);p<c&&(c=p,d=f)}l[d].push(n[s])}for(var h=hc(a),s=0;s<l.length;++s){for(var v=l[s],m=v.length,g=[],y=[],b=[],x=0,S=v;x<S.length;x++){var _=S[x];g.push(_[0]),y.push(_[1]),b.push(_[2])}var A=Hh(g)/m,T=Hh(y)/m,I=Hh(b)/m;a[s]=[A,T,I]}if(ku(h,a))break}return Ede(a).map(function(M){return Ia.toColor(M)})}var _F={type:"generate",colorList:"red-yellow-blue"};function ro(e){e===void 0&&(e={});var t=w(w({},_F),e);return{palette:E.MappedStatic(t.type,{colors:E.Group({list:E.ColorList(t.colorList)},{isFlat:!0}),generate:E.Group(w(w({},xF),{maxCount:E.Numeric(75,{min:1,max:250,step:1})}),{isFlat:!0})},{options:[["colors","Color List"],["generate","Generate Distinct"]]})}}E.getDefaultValues(ro());var LE={valueLabel:function(e){return""+(e+1)},minLabel:"Start",maxLabel:"End"};function ko(e,t,r){var n;r===void 0&&(r={});var a,i;if(t.palette.name==="colors"&&t.palette.params.list.kind==="interpolate"){var o=t.palette.params.list,s=[0,e-1],u=w(w({},LE),r),l=u.minLabel,c=u.maxLabel,d=o.colors;d.length===0&&(d=To(_F.colorList).list);var f=us.create({listOrName:d,domain:s,minLabel:l,maxLabel:c});i=f.legend,a=f.color}else{var p;t.palette.name==="colors"?(p=t.palette.params.list.colors.map(function(b){return Array.isArray(b)?b[0]:b}),p.length===0&&(p=To("dark-2").list.map(function(b){return Array.isArray(b)?b[0]:b}))):(e=Math.min(e,t.palette.params.maxCount),p=Mde(e,t.palette.params));for(var h=(n=r.valueLabel)!==null&&n!==void 0?n:LE.valueLabel,v=p.length,m=[],g=0;g<e;++g){var y=g%v;m[y]===void 0?m[y]=[h(g),p[y]]:m[y][0]+=", "+h(g)}i=Pc(m),a=function(b){return p[b%v]}}return{color:a,legend:i}}var Dde="many-distinct",NE=it(16448250),Rde="Gives every chain a color based on its `asym_id` value.",r1=w({asymId:E.Select("auth",E.arrayToOptions(["auth","label"]))},ro({type:"colors",colorList:Dde}));function Ode(e){var t,r=E.clone(r1);return!((t=e.structure)===null||t===void 0)&&t.models.some(function(n){return n.coarseHierarchy.isDefined})&&(r.asymId.defaultValue="label"),r}function Fde(e,t){switch(e.kind){case 0:return t==="auth"?ct.chain.auth_asym_id:ct.chain.label_asym_id;case 1:case 2:return ct.coarse.asym_id}}function UE(e,t){var r=Fde(e.unit,t)(e);return e.structure.root.models.length>1?wF(e.unit.model,r):r}function wF(e,t){return t+"|"+((jt.Index.get(e).value||0)+1)}function kde(e,t){for(var r=new Map,n=function(s){var u=jt.AsymIdOffset.get(s).value,l=(t==="auth"?u==null?void 0:u.auth:u==null?void 0:u.label)||0,c=0;s.properties.structAsymMap.forEach(function(d,f){var p=d.auth_id,h=t==="auth"?p:f,v=e.models.length>1?wF(s,h):h;r.has(v)||(r.set(v,c+l),++c)})},a=0,i=e.models;a<i.length;a++){var o=i[a];n(o)}return r}function n1(e,t){var r,n;if(e.structure){var a=Ze.create(e.structure.root),i=kde(e.structure.root,t.asymId),o=Array.from(i.keys()),s=function(l){return o[l]},u=ko(i.size,t,{valueLabel:s});n=u.legend,r=function(l){var c=void 0;if(Ze.is(l)){var d=UE(l,t.asymId);c=i.get(d)}else if(Ht.isLocation(l)){a.unit=l.aUnit,a.element=l.aUnit.elements[l.aIndex];var d=UE(a,t.asymId);c=i.get(d)}return c===void 0?NE:u.color(c)}}else r=function(){return NE};return{factory:n1,granularity:"group",color:r,props:t,description:Rde,legend:n}}var AF={name:"chain-id",label:"Chain Id",category:"Chain Property",factory:n1,getParams:Ode,defaultValues:E.getDefaultValues(r1),isApplicable:function(e){return!!e.structure}},zE=it(13421772),Bde="Gives every element (atom or coarse sphere/gaussian) a unique color based on the position (index) of the element in the list of elements in the structure.",PF=w({},ro({type:"colors",colorList:"red-yellow-blue"}));function Lde(e){return PF}function TF(e,t){var r,n;if(e.structure){for(var a=e.structure.root.units,i=a.length,o=new Map,s=new Map,u=0,l=0;l<i;++l)o.set(l,u),u+=a[l].elements.length,s.set(a[l].id,l);var c=ko(u,t);n=c.legend,r=function(d){if(Ze.is(d)){var f=s.get(d.unit.id),p=ke.findPredecessorIndex(a[f].elements,d.element);return c.color(o.get(f)+p)}else if(Ht.isLocation(d)){var f=s.get(d.aUnit.id),p=ke.findPredecessorIndex(a[f].elements,d.aUnit.elements[d.aIndex]);return c.color(o.get(f)+p)}return zE}}else r=function(){return zE};return{factory:TF,granularity:"groupInstance",preferSmoothing:!0,color:r,props:t,description:Bde,legend:n}}var Nde={name:"element-index",label:"Element Index",category:"Atom Property",factory:TF,getParams:Lde,defaultValues:E.getDefaultValues(PF),isApplicable:function(e){return!!e.structure}},Ude="many-distinct",VE=it(13421772),zde="Assigns a color based on the operator name of a transformed chain.",w3=w({},ro({type:"colors",colorList:Ude}));function Vde(e){var t=E.clone(w3);return t}function Hde(e){for(var t=new Map,r=0,n=e.units.length;r<n;++r){var a=e.units[r].conformation.operator.name;t.has(a)||t.set(a,t.size)}return t}function A3(e,t){var r,n;if(e.structure){var a=Hde(e.structure.root),i=Array.from(a.keys()),o=function(u){return i[u]},s=ko(a.size,t,{valueLabel:o});n=s.legend,r=function(u){var l=void 0;if(Ze.is(u)){var c=u.unit.conformation.operator.name;l=a.get(c)}else if(Ht.isLocation(u)){var d=u.aUnit.conformation.operator.name;l=a.get(d)}return l===void 0?VE:s.color(l)}}else r=function(){return VE};return{factory:A3,granularity:"instance",color:r,props:t,description:zde,legend:n}}var P3={name:"operator-name",label:"Operator Name",category:"Symmetry",factory:A3,getParams:Vde,defaultValues:E.getDefaultValues(w3),isApplicable:function(e){return!!e.structure}},S2={H:16777215,D:16777152,T:16777120,HE:14286847,LI:13402367,BE:12779264,B:16758197,C:9474192,N:3166456,O:16715021,F:9494608,NE:11789301,NA:11230450,MG:9109248,AL:12560038,SI:1578e4,P:16744448,S:16777008,CL:2093087,AR:8442339,K:9388244,CA:4062976,SC:15132390,TI:12567239,V:10921643,CR:9083335,MN:10255047,FE:14706227,CO:15765664,NI:5296208,CU:13140019,ZN:8224944,GA:12750735,GE:6721423,AS:12419299,SE:16752896,BR:10889513,KR:6076625,RB:7351984,SR:65280,Y:9764863,ZR:9756896,NB:7586505,MO:5551541,TC:3907230,RU:2396047,RH:687500,PD:27013,AG:12632256,CD:16767375,IN:10909043,SN:6717568,SB:10380213,TE:13924864,I:9699476,XE:9699476,CS:5707663,BA:51456,LA:7394559,CE:16777159,PR:14286791,ND:13107143,PM:10747847,SM:9437127,EU:6422471,GD:4587463,TB:3211207,DY:2097095,HO:65436,ER:58997,TM:54354,YB:48952,LU:43812,HF:5096191,TA:5089023,W:2200790,RE:2522539,OS:2516630,IR:1528967,PT:13684960,AU:16765219,HG:12105936,TL:10900557,PB:5724513,BI:10375093,PO:11230208,AT:7688005,RN:4358806,FR:4325478,RA:32e3,AC:7384058,TH:47871,PA:41471,U:36863,NP:33023,PU:27647,AM:5528818,CM:7888099,BK:9064419,CF:10565332,ES:11739092,FM:11739066,MD:11734438,NO:12389767,LR:13041766,RF:13369433,DB:13697103,SG:14221381,BH:14680120,HS:15073326,MT:15400998,DS:16777215,RG:16777215,CN:16777215,UUT:16777215,FL:16777215,UUP:16777215,LV:16777215,UUH:16777215},EF=it(16777215),Gde="Assigns a color to every atom according to its chemical element.",IF={carbonColor:E.MappedStatic("chain-id",{"chain-id":E.Group(w({},r1)),"operator-name":E.Group(w({},w3)),"element-symbol":E.Group({})},{description:"Use chain-id coloring for carbon atoms."}),saturation:E.Numeric(0,{min:-6,max:6,step:.1}),lightness:E.Numeric(.2,{min:-6,max:6,step:.1})};function qde(e){return IF}function jde(e,t){var r=e[t];return r===void 0?EF:r}function MF(e,t){var r=Ay(S2,t.saturation,t.lightness),n=t.carbonColor.name==="chain-id"?n1(e,t.carbonColor.params).color:t.carbonColor.name==="operator-name"?A3(e,t.carbonColor.params).color:void 0;function a(s,u){return n&&s==="C"?n(u,!1):jde(r,s)}function i(s){if(Ze.is(s)){if(ze.isAtomic(s.unit)){var u=s.unit.model.atomicHierarchy.atoms.type_symbol;return a(u.value(s.element),s)}}else if(Ht.isLocation(s)&&ze.isAtomic(s.aUnit)){var u=s.aUnit.model.atomicHierarchy.atoms.type_symbol,l=u.value(s.aUnit.elements[s.aIndex]);return a(l,s)}return EF}var o=t.carbonColor.name==="operator-name"?"groupInstance":"group";return{factory:MF,granularity:o,preferSmoothing:!0,color:i,props:t,description:Gde,legend:Pc(Object.keys(S2).map(function(s){return[s,S2[s]]}))}}var Wde={name:"element-symbol",label:"Element Symbol",category:"Atom Property",factory:MF,getParams:qde,defaultValues:E.getDefaultValues(IF),isApplicable:function(e){return!!e.structure}},x2={water:3697840,ion:15729279,protein:12496596,RNA:16629894,DNA:12540695,PNA:4367514,saccharide:8374655},sC=it(16777113),Xde="Assigns a color based on the molecule type of a residue.",DF={saturation:E.Numeric(0,{min:-6,max:6,step:.1}),lightness:E.Numeric(0,{min:-6,max:6,step:.1})};function Yde(e){return DF}function HE(e,t,r){var n=r3(t,r);switch(n){case 2:return e.water;case 3:return e.ion;case 5:return e.protein;case 6:return e.RNA;case 7:return e.DNA;case 8:return e.PNA;case 9:return e.saccharide}return sC}function RF(e,t){var r=Ay(x2,t.saturation,t.lightness);function n(a){return Ze.is(a)?HE(r,a.unit,a.element):Ht.isLocation(a)?HE(r,a.aUnit,a.aUnit.elements[a.aIndex]):sC}return{factory:RF,granularity:"group",color:n,props:t,description:Xde,legend:Pc(Object.keys(x2).map(function(a){return[a,x2[a]]}).concat([["Other/unknown",sC]]))}}var Kde={name:"molecule-type",label:"Molecule Type",category:"Residue Property",factory:RF,getParams:Yde,defaultValues:E.getDefaultValues(DF),isApplicable:function(e){return!!e.structure}},uC="dark-2",GE=it(16448250),$de="Gives every polymer chain a color based on its `asym_id` value.",OF=w({},ro({type:"colors",colorList:uC}));function Qde(e){var t=E.clone(OF);return e.structure&&FF(e.structure.root).size>wi[uC].list.length&&(t.palette.defaultValue.name="colors",t.palette.defaultValue.params=w(w({},t.palette.defaultValue.params),{list:{kind:"interpolate",colors:To(uC).list}})),t}function qE(e){switch(e.kind){case 0:return ct.chain.label_asym_id;case 1:case 2:return ct.coarse.asym_id}}function FF(e){for(var t=new Map,r=0,n=e.unitSymmetryGroups.length;r<n;++r){var a=e.unitSymmetryGroups[r].units[0],i=a.model;if(ze.isAtomic(a))for(var o=i.atomicHierarchy,s=o.chainAtomSegments,u=o.chains,l=nr.transientSegments(s,a.elements);l.hasNext;){var c=l.move().index,d=u.label_entity_id.value(c),f=i.entities.getEntityIndex(d);if(i.entities.data.type.value(f)==="polymer"){var p=u.label_asym_id.value(c);t.has(p)||t.set(p,t.size)}}else if(ze.isCoarse(a))for(var h=ze.isSpheres(a)?i.coarseHierarchy.spheres:i.coarseHierarchy.gaussians,v=h.chainElementSegments,m=h.asym_id,g=h.entity_id,l=nr.transientSegments(v,a.elements);l.hasNext;){var c=l.move().index,y=v.offsets[c],d=g.value(y),f=i.entities.getEntityIndex(d);if(i.entities.data.type.value(f)==="polymer"){var p=m.value(y);t.has(p)||t.set(p,t.size)}}}return t}function kF(e,t){var r,n;if(e.structure){var a=Ze.create(e.structure),i=FF(e.structure.root),o=Array.from(i.keys()),s=function(l){return o[l]},u=ko(i.size,t,{valueLabel:s});n=u.legend,r=function(l){var c=void 0;if(Ze.is(l)){var d=qE(l.unit);c=i.get(d(l))}else if(Ht.isLocation(l)){var d=qE(l.aUnit);a.unit=l.aUnit,a.element=l.aUnit.elements[l.aIndex],c=i.get(d(a))}return c===void 0?GE:u.color(c)}}else r=function(){return GE};return{factory:kF,granularity:"group",color:r,props:t,description:$de,legend:n}}var Zde={name:"polymer-id",label:"Polymer Chain Id",category:"Chain Property",factory:kF,getParams:Qde,defaultValues:E.getDefaultValues(OF),isApplicable:function(e){return!!e.structure}},lC="dark-2",jE=it(13421772),Jde="Gives every polymer chain instance a unique color based on the position (index) of the polymer in the list of polymers in the structure.",BF=w({},ro({type:"colors",colorList:lC}));function efe(e){var t=E.clone(BF);return e.structure&&LF(e.structure.root)>wi[lC].list.length&&(t.palette.defaultValue.name="colors",t.palette.defaultValue.params=w(w({},t.palette.defaultValue.params),{list:{kind:"interpolate",colors:To(lC).list}})),t}function LF(e){for(var t=0,r=e.units,n=0,a=r.length;n<a;++n)r[n].polymerElements.length>0&&++t;return t}function NF(e,t){var r,n;if(e.structure){var a=ko(LF(e.structure.root),t);n=a.legend;for(var i=e.structure.root.units,o=new Map,s=0,u=0,l=i.length;s<l;++s)i[s].polymerElements.length>0&&(o.set(i[s].id,a.color(u)),++u);r=function(c){var d;return Ze.is(c)?d=o.get(c.unit.id):Ht.isLocation(c)&&(d=o.get(c.aUnit.id)),d!==void 0?d:jE}}else r=function(){return jE};return{factory:NF,granularity:"instance",color:r,props:t,description:Jde,legend:n}}var tfe={name:"polymer-index",label:"Polymer Chain Instance",category:"Chain Property",factory:NF,getParams:efe,defaultValues:E.getDefaultValues(BF),isApplicable:function(e){return!!e.structure}},C2={ALA:9240460,ARG:124,ASN:16743536,ASP:10485826,CYS:16777072,GLN:16731212,GLU:6684672,GLY:15658734,HIS:7368959,ILE:19456,LEU:4546117,LYS:4671416,MET:12099650,PHE:5459026,PRO:5395026,SER:16740418,THR:12078080,TRP:5195264,TYR:9203788,VAL:16747775,A:14423100,G:3329330,I:10145074,C:16766720,T:4286945,U:4251856,DA:14423100,DG:3329330,DI:10145074,DC:16766720,DT:4286945,DU:4251856,APN:14423100,GPN:3329330,CPN:16766720,TPN:4286945},cC=it(16711935),rfe="Assigns a color to every residue according to its name.",UF={saturation:E.Numeric(0,{min:-6,max:6,step:.1}),lightness:E.Numeric(1,{min:-6,max:6,step:.1})};function nfe(e){return UF}function WE(e,t){return e.model.atomicHierarchy.atoms.label_comp_id.value(t)}function XE(e,t){var r=e.coarseElements.seq_id_begin.value(t),n=e.coarseElements.seq_id_end.value(t);if(r===n){var a=e.coarseElements.entityKey[t],i=e.model.sequence.byEntityKey[a].sequence;return i.compId.value(r-1)}}function Vm(e,t){var r=e[t];return r===void 0?cC:r}function zF(e,t){var r=Ay(C2,t.saturation,t.lightness);function n(a){if(Ze.is(a))if(ze.isAtomic(a.unit)){var i=WE(a.unit,a.element);return Vm(r,i)}else{var i=XE(a.unit,a.element);if(i)return Vm(r,i)}else if(Ht.isLocation(a))if(ze.isAtomic(a.aUnit)){var i=WE(a.aUnit,a.aUnit.elements[a.aIndex]);return Vm(r,i)}else{var i=XE(a.aUnit,a.aUnit.elements[a.aIndex]);if(i)return Vm(r,i)}return cC}return{factory:zF,granularity:"group",preferSmoothing:!0,color:n,props:t,description:rfe,legend:Pc(Object.keys(C2).map(function(a){return[a,C2[a]]}).concat([["Unknown",cC]]))}}var afe={name:"residue-name",label:"Residue Name",category:"Residue Property",factory:zF,getParams:nfe,defaultValues:E.getDefaultValues(UF),isApplicable:function(e){return!!e.structure}},_2={alphaHelix:16711808,threeTenHelix:10485888,piHelix:6291584,betaTurn:6324479,betaStrand:16762880,coil:16777215,bend:6740169,turn:45670,dna:11403518,rna:16580962,carbohydrate:10921722},dC=it(8421504),ife="Assigns a color based on the type of secondary structure and basic molecule type.",VF={saturation:E.Numeric(-1,{min:-6,max:6,step:.1}),lightness:E.Numeric(0,{min:-6,max:6,step:.1})};function ofe(e){return VF}function YE(e,t,r,n){var a=Fr.create(0);if(n&&ze.isAtomic(t)){var i=n.get(t.invariantId);i&&(a=i.type[i.getIndex(t.residueIndex[r])])}if(Fr.is(a,2))return Fr.is(a,2048)?e.threeTenHelix:Fr.is(a,32768)?e.piHelix:e.alphaHelix;if(Fr.is(a,4))return e.betaStrand;if(Fr.is(a,8))return e.bend;if(Fr.is(a,16))return e.turn;var o=r3(t,r);return o===7?e.dna:o===6?e.rna:o===9?e.carbohydrate:o===5?e.coil:dC}function HF(e,t){var r=e.structure&&Xs.get(e.structure),n=r?jd(r.id,r.version):-1,a=Ay(_2,t.saturation,t.lightness);function i(o){return Ze.is(o)?YE(a,o.unit,o.element,r==null?void 0:r.value):Ht.isLocation(o)?YE(a,o.aUnit,o.aUnit.elements[o.aIndex],r==null?void 0:r.value):dC}return{factory:HF,granularity:"group",preferSmoothing:!0,color:i,props:t,contextHash:n,description:ife,legend:Pc(Object.keys(_2).map(function(o){return[o,_2[o]]}).concat([["Other",dC]]))}}var sfe={name:"secondary-structure",label:"Secondary Structure",category:"Residue Property",factory:HF,getParams:ofe,defaultValues:E.getDefaultValues(VF),isApplicable:function(e){return!!e.structure},ensureCustomProperties:{attach:function(e,t){return t.structure?Xs.attach(e,t.structure,void 0,!0):Promise.resolve()},detach:function(e){return e.structure&&Xs.ref(e.structure,!1)}}},ufe=it(13421772),lfe="Gives every polymer residue a color based on its `seq_id` value.",GF={list:E.ColorList("turbo",{presetKind:"scale"})};function cfe(e){return GF}function KE(e,t){var r=e.model;switch(e.kind){case 0:var n=r.atomicHierarchy.residueAtomSegments.index[t];return r.atomicHierarchy.residues.label_seq_id.value(n);case 1:return Math.round((r.coarseHierarchy.spheres.seq_id_begin.value(t)+r.coarseHierarchy.spheres.seq_id_end.value(t))/2);case 2:return Math.round((r.coarseHierarchy.gaussians.seq_id_begin.value(t)+r.coarseHierarchy.gaussians.seq_id_end.value(t))/2)}}function $E(e,t){var r=e.model,n="";switch(e.kind){case 0:var a=r.atomicHierarchy.chainAtomSegments.index[t];n=r.atomicHierarchy.chains.label_entity_id.value(a);break;case 1:n=r.coarseHierarchy.spheres.entity_id.value(t);break;case 2:n=r.coarseHierarchy.gaussians.entity_id.value(t);break}if(n==="")return 0;var i=r.entities.getEntityIndex(n);if(i===-1)return 0;var o=r.sequence.byEntityKey[i];return o===void 0?0:o.sequence.length}function qF(e,t){var r=us.create({listOrName:t.list.colors,minLabel:"Start",maxLabel:"End"}),n=function(a){if(Ze.is(a)){var i=a.unit,o=a.element,s=KE(i,o);if(s>0){var u=$E(i,o);if(u)return r.setDomain(0,u-1),r.color(s)}}else if(Ht.isLocation(a)){var l=a.aUnit,c=a.aIndex,s=KE(l,l.elements[c]);if(s>0){var u=$E(l,l.elements[c]);if(u)return r.setDomain(0,u-1),r.color(s)}}return ufe};return{factory:qF,granularity:"group",preferSmoothing:!0,color:n,props:t,description:lfe,legend:r?r.legend:void 0}}var dfe={name:"sequence-id",label:"Sequence Id",category:"Residue Property",factory:qF,getParams:cfe,defaultValues:E.getDefaultValues(GF),isApplicable:function(e){return!!e.structure}},fC="dark-2",QE=it(13421772),ffe="Gives every chain instance (single chain or collection of single elements) a unique color based on the position (index) of the chain in the list of chains in the structure.",jF=w({},ro({type:"colors",colorList:fC}));function pfe(e){var t=E.clone(jF);return e.structure&&e.structure.root.units.length>wi[fC].list.length&&(t.palette.defaultValue.name="colors",t.palette.defaultValue.params=w(w({},t.palette.defaultValue.params),{list:{kind:"interpolate",colors:To(fC).list}})),t}function WF(e,t){var r,n;if(e.structure){var a=e.structure.root.units,i=ko(a.length,t);n=i.legend;for(var o=new Map,s=0,u=a.length;s<u;++s)o.set(a[s].id,i.color(s));r=function(l){return Ze.is(l)?o.get(l.unit.id):Ht.isLocation(l)?o.get(l.aUnit.id):QE}}else r=function(){return QE};return{factory:WF,granularity:"instance",color:r,props:t,description:ffe,legend:n}}var hfe={name:"unit-index",label:"Chain Instance",category:"Chain Property",factory:WF,getParams:pfe,defaultValues:E.getDefaultValues(jF),isApplicable:function(e){return!!e.structure}},vfe=it(16777113),mfe="Assigns a color based on the uncertainty or disorder of an element's position, e.g. B-factor or RMSF, depending on the data availability and experimental technique.",XF={domain:E.Interval([0,100]),list:E.ColorList("red-white-blue",{presetKind:"scale"})};function gfe(e){return XF}function ZE(e,t){return ze.isAtomic(e)?e.model.atomicConformation.B_iso_or_equiv.value(t):ze.isSpheres(e)?e.model.coarseConformation.spheres.rmsf[t]:0}function YF(e,t){var r=us.create({reverse:!0,domain:t.domain,listOrName:t.list.colors});function n(a){return Ze.is(a)?r.color(ZE(a.unit,a.element)):Ht.isLocation(a)?r.color(ZE(a.aUnit,a.aUnit.elements[a.aIndex])):vfe}return{factory:YF,granularity:"group",preferSmoothing:!0,color:n,props:t,description:mfe,legend:r?r.legend:void 0}}var yfe={name:"uncertainty",label:"Uncertainty/Disorder",category:"Atom Property",factory:YF,getParams:gfe,defaultValues:E.getDefaultValues(XF),isApplicable:function(e){return!!e.structure&&e.structure.models.some(function(t){return t.atomicConformation.B_iso_or_equiv.isDefined||t.coarseHierarchy.isDefined})}},pC="dark-2",Hm=it(16448250),bfe="Gives ranges of a polymer chain a color based on the entity source it originates from (e.g. gene, plasmid, organism).",KF=w({},ro({type:"colors",colorList:pC}));function Sfe(e){var t=E.clone(KF);return e.structure&&QF(e.structure.root.models).srcKeySerialMap.size>wi[pC].list.length&&(t.palette.defaultValue.name="colors",t.palette.defaultValue.params=w(w({},t.palette.defaultValue.params),{list:{kind:"interpolate",colors:To(pC).list}})),t}function $F(e,t){return e+"|"+t}function xfe(e,t,r,n,a,i){return e+"|"+t+"|"+r+"|"+(i||a||n)}function w2(e,t,r,n,a,i,o,s){for(var u=a.entity_id,l=a.pdbx_src_id,c=a.pdbx_beg_seq_num,d=a.pdbx_end_seq_num,f=0,p=a._rowCount;f<p;++f){var h=u.value(f),v=$F(r,h),m=void 0;if(e.has(v))m=e.get(v);else{var g=n.entities.getEntityIndex(h),y=n.sequence.sequences[g].sequence;m=new Int16Array(y.length),e.set(v,m)}var b=o?o.value(f):"",x=s?s.value(f)[0]:"",S=xfe(r,h,i.value(f),l.value(f),b,x),_=c.valueKind(f)===0?c.value(f):1,A=d.valueKind(f)===0?d.value(f):m.length,T=void 0;t.has(S)?T=t.get(S):(T=t.size+1,t.set(S,T));for(var I=_,M=A;I<=M;++I)m[I-1]=T}}function QF(e){for(var t=new Map,r=new Map,n=0,a=e.length;n<a;++n){var i=e[n];if(!!Jr.is(i.sourceData)){var o=i.sourceData.data.db,s=o.entity_src_gen,u=o.entity_src_nat,l=o.pdbx_entity_src_syn;w2(t,r,n,i,s,s.pdbx_gene_src_scientific_name,s.plasmid_name,s.pdbx_gene_src_gene),w2(t,r,n,i,u,u.pdbx_organism_scientific,u.pdbx_plasmid_name),w2(t,r,n,i,l,l.organism_scientific)}}return{seqToSrcByModelEntity:t,srcKeySerialMap:r}}function Cfe(e){var t=0;return Array.from(e.keys()).map(function(r){var n=r.split("|"),a=n[2],i=pQ(n[3])?"Unnamed "+ ++t:n[3];return""+i+(a?" ("+a+")":"")})}function ZF(e,t){var r,n;if(e.structure){var a=Ze.create(e.structure),i=e.structure.root.models,o=QF(i),s=o.seqToSrcByModelEntity,u=o.srcKeySerialMap,l=Cfe(u),c=function(p){return l[p]},d=ko(u.size,t,{valueLabel:c});n=d.legend;var f=function(p){var h=i.indexOf(p.unit.model),v=ct.entity.id(p),m=$F(h,v),g=s.get(m);if(g){var y=g[ct.residue.label_seq_id(p)-1]-1;return y===-1?Hm:d.color(y)}else return Hm};r=function(p){return Ze.is(p)?f(p):Ht.isLocation(p)?(a.unit=p.aUnit,a.element=p.aUnit.elements[p.aIndex],f(a)):Hm}}else r=function(){return Hm};return{factory:ZF,granularity:"group",color:r,props:t,description:bfe,legend:n}}var _fe={name:"entity-source",label:"Entity Source",category:"Chain Property",factory:ZF,getParams:Sfe,defaultValues:E.getDefaultValues(KF),isApplicable:function(e){return!!e.structure}},wfe=it(15658734),Afe="Assigns an illustrative color that gives every chain a unique color with lighter carbons (inspired by David Goodsell's Molecule of the Month style).",JF=w({},r1);function Pfe(e){return JF}function ek(e,t){var r=n1(e,t),n=r.color,a=r.legend;function i(s,u){var l=n(s,!1);return u==="C"?it.lighten(l,.8):l}function o(s){if(Ze.is(s)&&ze.isAtomic(s.unit)){var u=s.unit.model.atomicHierarchy.atoms.type_symbol.value(s.element);return i(s,u)}else if(Ht.isLocation(s)&&ze.isAtomic(s.aUnit)){var l=s.aUnit.elements[s.aIndex],u=s.aUnit.model.atomicHierarchy.atoms.type_symbol.value(l);return i(s,u)}return wfe}return{factory:ek,granularity:"group",preferSmoothing:!0,color:o,props:t,description:Afe,legend:a}}var Tfe={name:"illustrative",label:"Illustrative",category:"Miscellaneous",factory:ek,getParams:Pfe,defaultValues:E.getDefaultValues(JF),isApplicable:function(e){return!!e.structure}},Efe='Assigns a color to every amino acid according to the "Experimentally determined hydrophobicity scale for proteins at membrane interfaces" by Wimely and White (doi:10.1038/nsb1096-842).',tk={list:E.ColorList("red-yellow-green",{presetKind:"scale"}),scale:E.Select("DGwif",[["DGwif","DG water-membrane"],["DGwoct","DG water-octanol"],["Oct-IF","DG difference"]])};function Ife(e){return tk}var Mfe={DGwif:0,DGwoct:1,"Oct-IF":2};function Dfe(e,t){var r=_x[e];return r===void 0?0:r[t]}function JE(e,t){return e.model.atomicHierarchy.atoms.label_comp_id.value(t)}function e5(e,t){var r=e.coarseElements.seq_id_begin.value(t),n=e.coarseElements.seq_id_end.value(t);if(r===n){var a=e.coarseElements.entityKey[t],i=e.model.sequence.byEntityKey[a].sequence;return i.compId.value(r-1)}}function rk(e,t){var r=Mfe[t.scale],n=1/0,a=-1/0;for(var i in _x){var o=_x[i][r];n=Math.min(n,o),a=Math.max(a,o)}var s=us.create({listOrName:t.list.colors,domain:[a,n],minLabel:"Hydrophobic",maxLabel:"Hydrophilic"});function u(l){var c;return Ze.is(l)?ze.isAtomic(l.unit)?c=JE(l.unit,l.element):c=e5(l.unit,l.element):Ht.isLocation(l)&&(ze.isAtomic(l.aUnit)?c=JE(l.aUnit,l.aUnit.elements[l.aIndex]):c=e5(l.aUnit,l.aUnit.elements[l.aIndex])),s.color(c?Dfe(c,r):0)}return{factory:rk,granularity:"group",preferSmoothing:!0,color:u,props:t,description:Efe,legend:s?s.legend:void 0}}var Rfe={name:"hydrophobicity",label:"Hydrophobicity",category:"Residue Property",factory:rk,getParams:Ife,defaultValues:E.getDefaultValues(tk),isApplicable:function(e){return!!e.structure}},t5=it(13421772),Ofe="Gives every model a unique color based on the position (index) of the model in the list of models in the structure.",nk=w({},ro({type:"colors",colorList:"purples"}));function Ffe(e){return nk}function ak(e,t){var r,n,a,i;if(e.structure){for(var o=e.structure.root.models,s=0,u=0,l=o;u<l.length;u++){var c=l[u];s=Math.max(s,((r=jt.TrajectoryInfo.get(c))===null||r===void 0?void 0:r.size)||0)}var d=ko(s,t);i=d.legend;for(var f=new Map,p=0,h=o.length;p<h;++p){var v=((n=jt.TrajectoryInfo.get(o[p]))===null||n===void 0?void 0:n.index)||0;f.set(v,d.color(v))}a=function(m){return Ze.is(m)?f.get(jt.TrajectoryInfo.get(m.unit.model).index):Ht.isLocation(m)?f.get(jt.TrajectoryInfo.get(m.aUnit.model).index):t5}}else a=function(){return t5};return{factory:ak,granularity:"instance",color:a,props:t,description:Ofe,legend:i}}var kfe={name:"model-index",label:"Model Index",category:"Chain Property",factory:ak,getParams:Ffe,defaultValues:E.getDefaultValues(nk),isApplicable:function(e){return!!e.structure&&e.structure.elementCount>0&&jt.TrajectoryInfo.get(e.structure.models[0]).size>1}},Bfe=it(13421772),Lfe="Assigns a color based on the occupancy of an atom.",ik={domain:E.Interval([0,1]),list:E.ColorList("purples",{presetKind:"scale"})};function Nfe(e){return ik}function r5(e,t){return ze.isAtomic(e)?e.model.atomicConformation.occupancy.value(t):0}function ok(e,t){var r=us.create({reverse:!1,domain:t.domain,listOrName:t.list.colors});function n(a){return Ze.is(a)?r.color(r5(a.unit,a.element)):Ht.isLocation(a)?r.color(r5(a.aUnit,a.aUnit.elements[a.aIndex])):Bfe}return{factory:ok,granularity:"group",preferSmoothing:!0,color:n,props:t,description:Lfe,legend:r?r.legend:void 0}}var Ufe={name:"occupancy",label:"Occupancy",category:"Atom Property",factory:ok,getParams:Nfe,defaultValues:E.getDefaultValues(ik),isApplicable:function(e){return!!e.structure&&e.structure.models.some(function(t){return t.atomicConformation.occupancy.isDefined})}},hC="dark-2",n5=it(13421772),zfe="Assigns a color based on the operator HKL value of a transformed chain.",sk=w({},ro({type:"colors",colorList:hC}));function Vfe(e){var t=E.clone(sk);return e.structure&&uk(e.structure.root).map.size>wi[hC].list.length&&(t.palette.defaultValue.name="colors",t.palette.defaultValue.params=w(w({},t.palette.defaultValue.params),{list:{kind:"interpolate",colors:To(hC).list}})),t}var Mh=1e4;function vC(e){return e.map(function(t){return(""+(t+Mh)).padStart(5,"0")}).join("")}function mC(e){var t=dQ(Mh,0),r=parseInt(e.substr(0,t)),n=parseInt(e.substr(t,t)),a=parseInt(e.substr(t+t,t));return[r-Mh,n-Mh,a-Mh]}function A2(e){return e.map(function(t){return t+5}).join("")}function uk(e){for(var t=new Map,r=new Set,n=0,a=e.units.length;n<a;++n){var i=vC(e.units[n].conformation.operator.hkl);r.add(i)}var o=Array.from(r.values()).sort();o.forEach(function(l){return t.set(l,t.size)});var s=mC(o[0]),u=mC(o[o.length-1]);return{min:s,max:u,map:t}}function lk(e,t){var r,n;if(e.structure){var a=uk(e.structure.root),i=a.min,o=a.max,s=a.map,u=[];s.forEach(function(d,f){var p=d%s.size,h=A2(mC(f));u[p]===void 0?u[p]=h:u[p]+=", "+h});var l={minLabel:A2(i),maxLabel:A2(o),valueLabel:function(d){return u[d]}},c=ko(s.size,t,l);n=c.legend,r=function(d){var f=void 0;if(Ze.is(d)){var p=vC(d.unit.conformation.operator.hkl);f=s.get(p)}else if(Ht.isLocation(d)){var p=vC(d.aUnit.conformation.operator.hkl);f=s.get(p)}return f===void 0?n5:c.color(f)}}else r=function(){return n5};return{factory:lk,granularity:"instance",color:r,props:t,description:zfe,legend:n}}var Hfe={name:"operator-hkl",label:"Operator HKL",category:"Symmetry",factory:lk,getParams:Vfe,defaultValues:E.getDefaultValues(sk),isApplicable:function(e){return!!e.structure}},P2=it(16777113),Gfe="Assigns a color based on the partial charge of an atom.",ck={domain:E.Interval([-1,1]),list:E.ColorList("red-white-blue",{presetKind:"scale"})};function qfe(e){return ck}function a5(e,t){var r;return(r=gp.Provider.get(e.model))===null||r===void 0?void 0:r.data.value(t)}function dk(e,t){var r=us.create({domain:t.domain,listOrName:t.list.colors});function n(a){if(Ze.is(a)){var i=a5(a.unit,a.element);return i!==void 0?r.color(i):P2}else if(Ht.isLocation(a)){var i=a5(a.aUnit,a.aUnit.elements[a.aIndex]);return i!==void 0?r.color(i):P2}return P2}return{factory:dk,granularity:"group",preferSmoothing:!0,color:n,props:t,description:Gfe,legend:r?r.legend:void 0}}var jfe={name:"partial-charge",label:"Partial Charge",category:"Atom Property",factory:dk,getParams:qfe,defaultValues:E.getDefaultValues(ck),isApplicable:function(e){return!!e.structure&&e.structure.models.some(function(t){return gp.Provider.get(t)!==void 0})}},Wfe="many-distinct",i5=it(16448250),Xfe="Gives every atom a color based on its `label_atom_id` value.",fk=w({},ro({type:"colors",colorList:Wfe}));function Yfe(e){var t=E.clone(fk);return t}function Kfe(e){for(var t=new Map,r=0,n=e.models;r<n.length;r++)for(var a=n[r],i=a.atomicHierarchy.atoms.label_atom_id,o=0,s=i.rowCount;o<s;++o){var u=i.value(o);t.has(u)||t.set(u,t.size)}return t}function pk(e,t){var r,n;if(e.structure){var a=Ze.create(e.structure.root),i=Kfe(e.structure.root),o=Array.from(i.keys()),s=function(l){return o[l]},u=ko(i.size,t,{valueLabel:s});n=u.legend,r=function(l){var c=void 0;if(Ze.is(l)){var d=ct.atom.label_atom_id(l);c=i.get(d)}else if(Ht.isLocation(l)){a.unit=l.aUnit,a.element=l.aUnit.elements[l.aIndex];var d=ct.atom.label_atom_id(a);c=i.get(d)}return c===void 0?i5:u.color(c)}}else r=function(){return i5};return{factory:pk,granularity:"group",preferSmoothing:!0,color:r,props:t,description:Xfe,legend:n}}var $fe={name:"atom-id",label:"Atom Id",category:"Atom Property",factory:pk,getParams:Yfe,defaultValues:E.getDefaultValues(fk),isApplicable:function(e){return!!e.structure}},Qfe="many-distinct",o5=it(16448250),Zfe="Gives every chain a color based on its `label_entity_id` value.",hk=w({},ro({type:"colors",colorList:Qfe}));function Jfe(e){var t=E.clone(hk);return t}function gC(e,t){return e+"|"+t}function epe(e){for(var t=new Map,r=0,n=e.models.length;r<n;++r)for(var a=e.models[r].atomicHierarchy.chains.label_entity_id,i=0,o=a.rowCount;i<o;++i){var s=gC(a.value(i),r);t.has(s)||t.set(s,t.size)}return t}function vk(e,t){var r,n;if(e.structure){var a=Ze.create(e.structure.root),i=epe(e.structure.root),o=Array.from(i.keys()),s=function(l){return o[l]},u=ko(i.size,t,{valueLabel:s});n=u.legend,r=function(l){var c=void 0;if(Ze.is(l)){var d=ct.chain.label_entity_id(l),f=l.structure.models.indexOf(l.unit.model),p=gC(d,f);c=i.get(p)}else if(Ht.isLocation(l)){a.unit=l.aUnit,a.element=l.aUnit.elements[l.aIndex];var d=ct.chain.label_entity_id(a),f=a.structure.models.indexOf(a.unit.model),p=gC(d,f);c=i.get(p)}return c===void 0?o5:u.color(c)}}else r=function(){return o5};return{factory:vk,granularity:"group",color:r,props:t,description:Zfe,legend:n}}var tpe={name:"entity-id",label:"Entity Id",category:"Chain Property",factory:vk,getParams:Jfe,defaultValues:E.getDefaultValues(hk),isApplicable:function(e){return!!e.structure}},Wu;(function(e){e.PaletteScale=(1<<24)-1,e.EmptyFactory=function(){return e.Empty};var t=it(13421772);e.Empty={factory:e.EmptyFactory,granularity:"uniform",color:function(){return t},props:{}};function r(a,i){return a.contextHash===i.contextHash&&a.factory===i.factory&&ku(a.props,i.props)}e.areEqual=r,e.EmptyProvider={name:"",label:"",category:"",factory:e.EmptyFactory,getParams:function(){return{}},defaultValues:{},isApplicable:function(){return!0}};function n(){return new bk(e.BuiltIn,e.EmptyProvider)}e.createRegistry=n,e.BuiltIn={"atom-id":$fe,"carbohydrate-symbol":Pde,"chain-id":AF,"element-index":Nde,"element-symbol":Wde,"entity-id":tpe,"entity-source":_fe,hydrophobicity:Rfe,illustrative:Tfe,"model-index":kfe,"molecule-type":Kde,occupancy:Ufe,"operator-hkl":Hfe,"operator-name":P3,"partial-charge":jfe,"polymer-id":Zde,"polymer-index":tfe,"residue-name":afe,"secondary-structure":sfe,"sequence-id":dfe,"shape-group":Due,uncertainty:yfe,"unit-index":hfe,uniform:uK}})(Wu||(Wu={}));var rpe=1,npe="Assigns a physical size, i.e. vdW radius for atoms or given radius for coarse spheres.",mk={scale:E.Numeric(1,{min:.1,max:5,step:.1})};function ape(e){return mk}function T2(e,t){return ze.isAtomic(e)?Mv(e.model.atomicHierarchy.atoms.type_symbol.value(t)):ze.isSpheres(e)?e.model.coarseConformation.spheres.radius[t]:0}function Lv(e,t){var r=t.scale===void 0?1:t.scale;function n(a){var i;return Ze.is(a)?i=r*T2(a.unit,a.element):Ht.isLocation(a)?i=r*Math.min(T2(a.aUnit,a.aUnit.elements[a.aIndex]),T2(a.bUnit,a.bUnit.elements[a.bIndex])):i=r*rpe,i}return{factory:Lv,granularity:"group",size:n,props:t,description:npe}}var ipe={name:"physical",label:"Physical",category:"",factory:Lv,getParams:ape,defaultValues:E.getDefaultValues(mk),isApplicable:function(e){return!!e.structure}},ope="Assigns a size reflecting the uncertainty or disorder of an element's position, e.g. B-factor or RMSF, depending on the data availability and experimental technique.",gk={bfactorFactor:E.Numeric(.1,{min:0,max:1,step:.01}),rmsfFactor:E.Numeric(.05,{min:0,max:1,step:.01}),baseSize:E.Numeric(.2,{min:0,max:2,step:.1})};function spe(e){return gk}function s5(e,t,r){return ze.isAtomic(e)?e.model.atomicConformation.B_iso_or_equiv.value(t)*r.bfactorFactor:ze.isSpheres(e)?e.model.coarseConformation.spheres.rmsf[t]*r.rmsfFactor:0}function yk(e,t){function r(n){var a=t.baseSize;return Ze.is(n)?a+=s5(n.unit,n.element,t):Ht.isLocation(n)&&(a+=s5(n.aUnit,n.aUnit.elements[n.aIndex],t)),a}return{factory:yk,granularity:"group",size:r,props:t,description:ope}}var upe={name:"uncertainty",label:"Uncertainty/Disorder",category:"",factory:yk,getParams:spe,defaultValues:E.getDefaultValues(gk),isApplicable:function(e){return!!e.structure&&e.structure.models.some(function(t){return t.atomicConformation.B_iso_or_equiv.isDefined||t.coarseHierarchy.isDefined})}},ba;(function(e){e.EmptyFactory=function(){return e.Empty},e.Empty={factory:e.EmptyFactory,granularity:"uniform",size:function(){return 1},props:{}};function t(n,a){return n.factory===a.factory&&ku(n.props,a.props)}e.areEqual=t,e.EmptyProvider={name:"",label:"",category:"",factory:e.EmptyFactory,getParams:function(){return{}},defaultValues:{},isApplicable:function(){return!0}};function r(){return new bk(e.BuiltIn,e.EmptyProvider)}e.createRegistry=r,e.BuiltIn={physical:ipe,"shape-group":Tue,uncertainty:upe,uniform:dK}})(ba||(ba={}));var Yn;(function(e){function t(i,o,s,u){u=u||r();var l=s.colorTheme,c=s.sizeTheme;return u.color=i.colorThemeRegistry.create(l.name,o,l.params),u.size=i.sizeThemeRegistry.create(c.name,o,c.params),u}e.create=t;function r(){return{color:Wu.Empty,size:ba.Empty}}e.createEmpty=r;function n(i,o,s,u){var l,c;return ce(this,void 0,void 0,function(){return de(this,function(d){switch(d.label){case 0:return[4,(l=o.colorThemeRegistry.get(u.colorTheme.name).ensureCustomProperties)===null||l===void 0?void 0:l.attach(i,s)];case 1:return d.sent(),[4,(c=o.sizeThemeRegistry.get(u.sizeTheme.name).ensureCustomProperties)===null||c===void 0?void 0:c.attach(i,s)];case 2:return d.sent(),[2]}})})}e.ensureDependencies=n;function a(i,o,s){var u,l;(u=i.colorThemeRegistry.get(s.colorTheme.name).ensureCustomProperties)===null||u===void 0||u.detach(o),(l=i.sizeThemeRegistry.get(s.sizeTheme.name).ensureCustomProperties)===null||l===void 0||l.detach(o)}e.releaseDependencies=a})(Yn||(Yn={}));function u5(e){return e.map(function(t){return[t.name,t.provider.label,t.provider.category]})}var bk=function(){function e(t,r){var n=this;this.emptyProvider=r,this._list=[],this._map=new Map,this._name=new Map,cs(t,function(a,i){if(a.name!==i)throw new Error("Fix build in themes to have matching names. "+a.name+" "+i);n.add(a)})}return Object.defineProperty(e.prototype,"default",{get:function(){return this._list[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"list",{get:function(){return this._list},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"types",{get:function(){return u5(this._list)},enumerable:!1,configurable:!0}),e.prototype.sort=function(){this._list.sort(function(t,r){return t.provider.category===r.provider.category?t.provider.label<r.provider.label?-1:t.provider.label>r.provider.label?1:0:t.provider.category<r.provider.category?-1:1})},e.prototype.add=function(t){if(this._map.has(t.name))throw new Error(t.name+" already registered.");var r=t.name;this._list.push({name:r,provider:t}),this._map.set(r,t),this._name.set(t,r),this.sort()},e.prototype.remove=function(t){this._list.splice(this._list.findIndex(function(n){return n.name===t.name}),1);var r=this._map.get(t.name);r&&(this._map.delete(t.name),this._name.delete(r))},e.prototype.has=function(t){return this._map.has(t.name)},e.prototype.get=function(t){return this._map.get(t)||this.emptyProvider},e.prototype.getName=function(t){if(!this._name.has(t))throw new Error("'"+t.label+"' is not a registered theme provider.");return this._name.get(t)},e.prototype.create=function(t,r,n){n===void 0&&(n={});var a=this.get(t);return a.factory(r,w(w({},E.getDefaultValues(a.getParams(r))),n))},e.prototype.getApplicableList=function(t){return this._list.filter(function(r){return r.provider.isApplicable(t)})},e.prototype.getApplicableTypes=function(t){return u5(this.getApplicableList(t))},e}();function a1(e){return Object.keys(e)}function yC(e){throw new Error("unreachable")}function T3(e){return typeof(e==null?void 0:e.then)=="function"}var tr;(function(e){e[e.None=0]="None",e[e.Highlight=1]="Highlight",e[e.RemoveHighlight=2]="RemoveHighlight",e[e.Select=4]="Select",e[e.Deselect=8]="Deselect",e[e.Toggle=16]="Toggle",e[e.Clear=32]="Clear"})(tr||(tr={}));var Ii;(function(e){e.is=ka.has,e.All=tr.Highlight|tr.RemoveHighlight|tr.Select|tr.Deselect|tr.Toggle|tr.Clear,e.Highlighting=tr.Highlight|tr.RemoveHighlight|tr.Clear,e.Selecting=tr.Select|tr.Deselect|tr.Toggle|tr.Clear})(Ii||(Ii={}));function Rg(e,t,r){switch(r){case tr.Highlight:e[t]|=1;break;case tr.RemoveHighlight:e[t]&=-2;break;case tr.Select:e[t]|=2;break;case tr.Deselect:e[t]&=-3;break;case tr.Toggle:e[t]^=2;break;case tr.Clear:e[t]=0;break}}function hs(e,t,r){if(r===tr.None)return!1;if(Ie.is(t)){var n=Ie.start(t),a=Ie.end(t),i=new Uint32Array(e.buffer,0,e.buffer.byteLength>>2),o=n+3>>2,s=o+(a-4*o>>2),u=n,l=Math.min(4*o,a),c=Math.max(n,4*s),d=a;switch(r){case tr.Highlight:for(var f=o;f<s;++f)i[f]|=16843009;break;case tr.RemoveHighlight:for(var f=o;f<s;++f)i[f]&=-16843010;break;case tr.Select:for(var f=o;f<s;++f)i[f]|=33686018;break;case tr.Deselect:for(var f=o;f<s;++f)i[f]&=-33686019;break;case tr.Toggle:for(var f=o;f<s;++f)i[f]^=33686018;break;case tr.Clear:for(var f=o;f<s;++f)i[f]=0;break;default:yC()}for(var f=u;f<l;++f)Rg(e,f,r);for(var f=c;f<d;++f)Rg(e,f,r)}else switch(r){case tr.Highlight:for(var f=0,p=t.length;f<p;++f)e[t[f]]|=1;break;case tr.RemoveHighlight:for(var f=0,p=t.length;f<p;++f)e[t[f]]&=-2;break;case tr.Select:for(var f=0,p=t.length;f<p;++f)e[t[f]]|=2;break;case tr.Deselect:for(var f=0,p=t.length;f<p;++f)e[t[f]]&=-3;break;case tr.Toggle:for(var f=0,p=t.length;f<p;++f)e[t[f]]^=2;break;case tr.Clear:for(var f=0,p=t.length;f<p;++f)e[t[f]]=0;break;default:yC()}return!0}var lpe={kind:"every-loci"};function Ao(e){return!!e&&e.kind==="every-loci"}var Or={kind:"empty-loci"};function ns(e){return!!e&&e.kind==="empty-loci"}function Yh(e){return!!e&&e.kind==="data-loci"}function cpe(e,t){if(!Y0(e.data,t.data)||e.tag!==t.tag||e.elements.length!==t.elements.length)return!1;for(var r=0,n=e.elements.length;r<n;++r)if(!Y0(e.elements[r],t.elements[r]))return!1;return!0}function dpe(e){return e.elements.length===0}function i1(e,t,r,n,a){return{kind:"data-loci",tag:e,data:t,elements:r,getBoundingSphere:n,getLabel:a}}var ir;(function(e){var t=new eo("98");function r(v){var m=v.loci.map(function(_){return s(_)}).filter(function(_){return!!_});t.reset();for(var g=0,y=m;g<y.length;g++){var b=y[g];t.includePositionRadius(b.center,b.radius)}t.finishedIncludeStep();for(var x=0,S=m;x<S.length;x++){var b=S[x];t.radiusPositionRadius(b.center,b.radius)}return t.getSphere()}e.getBundleBoundingSphere=r;function n(v,m){return Ao(v)&&Ao(m)||ns(v)&&ns(m)?!0:Yh(v)&&Yh(m)?cpe(v,m):Xe.isLoci(v)&&Xe.isLoci(m)?Xe.areLociEqual(v,m):Re.is(v)&&Re.is(m)?Re.areEqual(v,m):Ht.isLoci(v)&&Ht.isLoci(m)?Ht.areLociEqual(v,m):Rr.isLoci(v)&&Rr.isLoci(m)?Rr.areLociEqual(v,m):si.isLoci(v)&&si.isLoci(m)?si.areLociEqual(v,m):Ct.isLoci(v)&&Ct.isLoci(m)?Ct.areLociEqual(v,m):Ct.Isosurface.isLoci(v)&&Ct.Isosurface.isLoci(m)?Ct.Isosurface.areLociEqual(v,m):Ct.Cell.isLoci(v)&&Ct.Cell.isLoci(m)?Ct.Cell.areLociEqual(v,m):!1}e.areEqual=n;function a(v){return!!v&&v.kind==="every-loci"}e.isEvery=a;function i(v){return Ao(v)?!1:ns(v)?!0:Yh(v)?dpe(v):Xe.isLoci(v)?Xe.isLociEmpty(v):Re.is(v)?Re.isEmpty(v):Ht.isLoci(v)?Ht.isLociEmpty(v):Rr.isLoci(v)?Rr.isLociEmpty(v):si.isLoci(v)?si.isLociEmpty(v):Ct.isLoci(v)?Ct.isLociEmpty(v):Ct.Isosurface.isLoci(v)?Ct.Isosurface.isLociEmpty(v):Ct.Cell.isLoci(v)?Ct.Cell.isLociEmpty(v):!1}e.isEmpty=i;function o(v,m){return m instanceof Xe&&(Re.is(v)?v=Re.remap(v,m):Xe.isLoci(v)?v=Xe.remapLoci(v,m):Ht.isLoci(v)&&(v=Ht.remapLoci(v,m))),v}e.remap=o;function s(v,m){var g;if(!(v.kind==="every-loci"||v.kind==="empty-loci")){if(m||(m=Ne()),v.kind==="structure-loci")return Ne.copy(m,v.structure.boundary.sphere);if(v.kind==="element-loci")return Ne.copy(m,Re.getBoundary(v).sphere);if(v.kind==="bond-loci")return Ht.getBoundingSphere(v,m);if(v.kind==="shape-loci")return Ne.copy(m,v.shape.geometry.boundingSphere);if(v.kind==="group-loci")return si.getBoundingSphere(v,m);if(v.kind==="data-loci")return(g=v.getBoundingSphere)===null||g===void 0?void 0:g.call(v,m);if(v.kind==="volume-loci")return Ct.getBoundingSphere(v.volume,m);if(v.kind==="isosurface-loci")return Ct.Isosurface.getBoundingSphere(v.volume,v.isoValue,m);if(v.kind==="cell-loci")return Ct.Cell.getBoundingSphere(v.volume,v.indices,m)}}e.getBoundingSphere=s;var u=Ne.zero();function l(v,m){var g=s(v,u);return g?C.copy(m||C(),g.center):void 0}e.getCenter=l;function c(v){if(!(v.kind==="every-loci"||v.kind==="empty-loci")){if(v.kind==="structure-loci")return Re.getPrincipalAxes(Xe.toStructureElementLoci(v.structure));if(v.kind==="element-loci")return Re.getPrincipalAxes(v);if(v.kind==="bond-loci")return;if(v.kind==="shape-loci")return;if(v.kind==="group-loci")return;if(v.kind==="data-loci")return;if(v.kind==="volume-loci")return;if(v.kind==="isosurface-loci")return;if(v.kind==="cell-loci")return}}e.getPrincipalAxes=c;var d={element:function(v){return v},residue:function(v){return Re.is(v)?Re.extendToWholeResidues(v,!0):v},chain:function(v){return Re.is(v)?Re.extendToWholeChains(v):v},entity:function(v){return Re.is(v)?Re.extendToWholeEntities(v):v},model:function(v){return Re.is(v)?Re.extendToWholeModels(v):v},operator:function(v){return Re.is(v)?Re.extendToWholeOperators(v):v},structure:function(v){return Re.is(v)?Xe.toStructureElementLoci(v.structure):si.isLoci(v)?Rr.Loci(v.shape):v},elementInstances:function(v){return Re.is(v)?Re.extendToAllInstances(v):v},residueInstances:function(v){return Re.is(v)?Re.extendToAllInstances(Re.extendToWholeResidues(v,!0)):v},chainInstances:function(v){return Re.is(v)?Re.extendToAllInstances(Re.extendToWholeChains(v)):v}};e.GranularityOptions=E.objectToOptions(d,function(v){switch(v){case"element":return"Atom/Coarse Element";case"elementInstances":return["Atom/Coarse Element Instances","With Symmetry"];case"structure":return"Structure/Shape";default:return v.indexOf("Instances")?[ji(v),"With Symmetry"]:ji(v)}});function f(v){return v.replace("Instances","")}e.simpleGranularity=f;function p(v,m){return d[m](v)}e.applyGranularity=p;function h(v,m){return m!=="element"&&Ht.isLoci(v)&&(v=Ht.toStructureElementLoci(v)),Xe.isLoci(v)&&(v=Xe.toStructureElementLoci(v.structure)),Re.is(v)&&(v=Re.remap(v,v.structure.root)),m&&(v=p(v,m)),v}e.normalize=h})(ir||(ir={}));function va(e){return{layers:e}}(function(e){e.Empty={layers:[]};function t(l,c){if(l.layers.length===0&&c.layers.length===0)return!0;if(l.layers.length!==c.layers.length)return!1;for(var d=0,f=l.layers.length;d<f;++d)if(l.layers[d].clear!==c.layers[d].clear||l.layers[d].color!==c.layers[d].color||!ir.areEqual(l.layers[d].loci,c.layers[d].loci))return!1;return!0}e.areEqual=t;function r(l){return l.layers.length===0}e.isEmpty=r;function n(l,c){for(var d=[],f=0,p=l.layers;f<p.length;f++){var h=p[f],v=h.loci,m=h.color,g=h.clear;v=Re.remap(v,c),Re.isEmpty(v)||d.push({loci:v,color:m,clear:g})}return{layers:d}}e.remap=n;function a(l){if(r(l))return l;for(var c=l.layers[0].loci.structure,d=new Map,f=Re.none(c),p=0,h=l.layers.length;p<h;++p){var v=l.layers[h-p-1],m=v.loci,g=v.color,y=v.clear;if(m=Re.subtract(m,f),f=Re.union(m,f),!Re.isEmpty(m)){var b=y?-1:g;d.has(b)&&(m=Re.union(m,d.get(b))),d.set(b,m)}}var x=[];return d.forEach(function(S,_){var A=_===-1,T=_===-1?it(0):_;x.push({loci:S,color:T,clear:A})}),{layers:x}}e.merge=a;function i(l,c){if(r(l))return l;for(var d=l.layers[0].loci.structure,f=[],p=0,h=l.layers;p<h.length;p++){var v=h[p],m=v.loci,g=v.color,y=v.clear,b=Re.remap(m,c);m=Re.remap(b,d),Re.isEmpty(m)||f.push({loci:m,color:g,clear:y})}return{layers:f}}e.filter=i;function o(l,c){for(var d=[],f=0,p=l.length;f<p;++f){var h=l[f],v=h.script,m=h.color,g=h.clear,y=pa.toLoci(v,c);Re.isEmpty(y)||d.push({loci:y,color:m,clear:g})}return{layers:d}}e.ofScript=o;function s(l,c){for(var d=[],f=0,p=l.length;f<p;++f){var h=l[f],v=h.bundle,m=h.color,g=h.clear,y=Qr.toLoci(v,c.root);d.push({loci:y,color:m,clear:g})}return{layers:d}}e.ofBundle=s;function u(l){for(var c=[],d=0,f=l.layers.length;d<f;++d){var p=l.layers[d],h=p.loci,v=p.color,m=p.clear,g=Qr.fromLoci(h);c.push({bundle:g,color:v,clear:m})}return{layers:c}}e.toBundle=u})(va||(va={}));function ma(e,t){return{kind:e,layers:t}}(function(e){e.Empty={kind:"empty-loci",layers:[]};function t(l,c){if(l.layers.length===0&&c.layers.length===0)return!0;if(l.layers.length!==c.layers.length)return!1;for(var d=0,f=l.layers.length;d<f;++d)if(l.layers[d].value!==c.layers[d].value||!ir.areEqual(l.layers[d].loci,c.layers[d].loci))return!1;return!0}e.areEqual=t;function r(l){return l.layers.length===0}e.isEmpty=r;function n(l,c){if(l.kind==="element-loci"){for(var d=[],f=0,p=l.layers;f<p.length;f++){var h=p[f],v=Re.remap(h.loci,c);Re.isEmpty(v)||d.push({loci:v,value:h.value})}return{kind:"element-loci",layers:d}}else return l}e.remap=n;function a(l){if(r(l))return l;if(l.kind==="element-loci"){for(var c=l.layers[0].loci.structure,d=new Map,f=Re.none(c),p=0,h=l.layers.length;p<h;++p){var v=l.layers[h-p-1],m=v.loci,g=v.value;m=Re.subtract(m,f),f=Re.union(m,f),Re.isEmpty(m)||(d.has(g)&&(m=Re.union(m,d.get(g))),d.set(g,m))}var y=[];return d.forEach(function(b,x){y.push({loci:b,value:x})}),{kind:"element-loci",layers:y}}else return l}e.merge=a;function i(l,c){if(r(l))return l;if(l.kind==="element-loci"){for(var d=l.layers[0].loci.structure,f=[],p=0,h=l.layers;p<h.length;p++){var v=h[p],m=v.loci,g=v.value,y=Re.remap(m,c);m=Re.remap(y,d),Re.isEmpty(m)||f.push({loci:m,value:g})}return{kind:"element-loci",layers:f}}else return l}e.filter=i;function o(l,c){for(var d=[],f=0,p=l.length;f<p;++f){var h=l[f],v=h.script,m=h.value,g=pa.toLoci(v,c);Re.isEmpty(g)||d.push({loci:g,value:m})}return{kind:"element-loci",layers:d}}e.ofScript=o;function s(l,c){for(var d=[],f=0,p=l.length;f<p;++f){var h=l[f],v=h.bundle,m=h.value,g=Qr.toLoci(v,c.root);d.push({loci:g,value:m})}return{kind:"element-loci",layers:d}}e.ofBundle=s;function u(l){for(var c=[],d=0,f=l.layers.length;d<f;++d){var p=l.layers[d],h=p.loci,v=p.value,m=Qr.fromLoci(h);c.push({bundle:m,value:v})}return{kind:"element-loci",layers:c}}e.toBundle=u})(ma||(ma={}));var Ys;(function(e){function t(){return{updateTransform:!1,updateMatrix:!1,updateColor:!1,updateSize:!1,createGeometry:!1,createNew:!1,info:{}}}e.create=t;function r(n){n.updateTransform=!1,n.updateMatrix=!1,n.updateColor=!1,n.updateSize=!1,n.createGeometry=!1,n.createNew=!1}e.reset=r})(Ys||(Ys={}));var fpe={lowestElementCount:1e6,lowerElementCount:5e5,lowElementCount:1e5,mediumElementCount:2e4,highElementCount:2e3,coarseGrainedFactor:10,elementCountFactor:1};function Sk(e,t){t===void 0&&(t={});var r=w(w({},fpe),t),n=e.elementCount*r.elementCountFactor;return e.isCoarseGrained&&(n*=r.coarseGrainedFactor),n>r.lowestElementCount?"lowest":n>r.lowerElementCount?"lower":n>r.lowElementCount?"low":n>r.mediumElementCount?"medium":n>r.highElementCount?"high":"higher"}function ppe(e){if(e.root.models.length===1){var t=qn.Provider.get(e.root.model);if(t&&t.spacegroup.name==="P 1"&&!Ei.isZero(t.spacegroup.cell))return t.spacegroup.cell.volume}return Xt.volume(e.root.boundary.box)}function bC(e,t){var r=ia(e.quality,"auto"),n=ia(e.detail,1),a=ia(e.radialSegments,12),i=ia(e.linearSegments,8),o=ia(e.resolution,2),s=ia(e.probePositions,12),u=ia(e.doubleSided,!0),l=0;if(r==="auto"){if(t instanceof Xe)r=Sk(t.root),l=ppe(t);else if(Ct.is(t)){var c=t.grid.cells.space.dimensions,d=c[0],f=c[1],p=c[2];l=d*f*p,r=l<1e7?"medium":"low"}}switch(r){case"highest":n=3,a=36,i=18,o=.1,s=72,u=!0;break;case"higher":n=3,a=28,i=14,o=.3,s=48,u=!0;break;case"high":n=2,a=20,i=10,o=.5,s=36,u=!0;break;case"medium":n=1,a=12,i=8,o=.8,s=24,u=!0;break;case"low":n=0,a=8,i=3,o=1.3,s=24,u=!1;break;case"lower":n=0,a=4,i=2,o=3,s=12,u=!1;break;case"lowest":n=0,a=2,i=1,o=8,s=12,u=!1;break}return o=Math.max(o,l/5e8),o=Math.min(o,20),(e.alpha!==void 0&&e.alpha<1||!!e.xrayShaded)&&(u=!1),{detail:n,radialSegments:a,linearSegments:i,resolution:o,probePositions:s,doubleSided:u}}var Sr;(function(e){function t(c,d){c&&(c.state.visible=d)}e.setVisibility=t;function r(c,d){c&&(c.state.alphaFactor=d)}e.setAlphaFactor=r;function n(c,d){c&&(c.state.pickable=d)}e.setPickable=n;function a(c,d){c&&(c.state.colorOnly=d)}e.setColorOnly=a;function i(c,d,f,p){if(!c)return!1;var h=c.values,v=h.tMarker,m=h.uGroupCount,g=h.instanceCount,y=m.ref.value*g.ref.value,b=v.ref.value.array,x=!1;return Ao(d)?x=hs(b,Ie.ofLength(y),f):ns(d)||(x=p(d,function(S){return hs(b,S,f)},!0)),x&&k.update(v,v.ref.value),x}e.mark=i;function o(c,d,f,p){if(!!c){var h=c.values,v=h.tOverpaint,m=h.uGroupCount,g=h.instanceCount,y=m.ref.value*g.ref.value;Lae(d.layers.length?y:0,c.values);var b=v.ref.value.array;p&&BT(b,0,y);for(var x=function(A,T){var I=d.layers[A],M=I.loci,O=I.color,D=I.clear,F=function(G){var N=Ie.start(G),z=Ie.end(G);return D?BT(b,N,z):Bae(b,N,z,O)};f(M,F,!1)},S=0,_=d.layers.length;S<_;++S)x(S);k.update(v,v.ref.value)}}e.setOverpaint=o;function s(c,d,f,p){if(!!c){var h=c.values,v=h.tTransparency,m=h.transparencyAverage,g=h.uGroupCount,y=h.instanceCount,b=g.ref.value*y.ref.value;zae(d.layers.length?b:0,c.values);var x=v.ref.value.array;p&&Uae(x,0,b);for(var S=function(T,I){var M=d.layers[T],O=M.loci,D=M.value,F=function(G){var N=Ie.start(G),z=Ie.end(G);return Nae(x,N,z,D)};f(O,F,!1)},_=0,A=d.layers.length;_<A;++_)S(_);k.update(v,v.ref.value),k.updateIfChanged(m,DO(x,b))}}e.setTransparency=s;function u(c,d,f,p){if(!!c){var h=c.values,v=h.tClipping,m=h.uGroupCount,g=h.instanceCount,y=m.ref.value*g.ref.value;Gae(d.layers.length?y:0,c.values);var b=v.ref.value.array;p&&Hae(b,0,y);for(var x=function(A,T){var I=d.layers[A],M=I.loci,O=I.groups,D=function(F){var G=Ie.start(F),N=Ie.end(F);return Vae(b,G,N,O)};f(M,D,!1)},S=0,_=d.layers.length;S<_;++S)x(S);k.update(v,v.ref.value)}}e.setClipping=u;function l(c,d,f){if(!(!c||!d&&!f)){var p=c.values;d&&(ue.copy(p.matrix.ref.value,d),k.update(p.matrix,p.matrix.ref.value)),f?(p.extraTransform.ref.value.set(f),k.update(p.extraTransform,p.extraTransform.ref.value)):f===null&&(dg(p.extraTransform.ref.value,p.instanceCount.ref.value),k.update(p.extraTransform,p.extraTransform.ref.value)),r6(p);var h=ya(p.invariantBoundingSphere.ref.value,p.aTransform.ref.value,p.instanceCount.ref.value);k.update(p.boundingSphere,h)}}e.setTransform=l})(Sr||(Sr={}));function en(e){return{layers:e}}(function(e){e.Empty={layers:[]},function(l){l.is=ka.has;function c(v){return ka.create(v)}l.create=c,l.Names={one:1,two:2,three:4,four:8,five:16,six:32};function d(v){return v in l.Names}l.isName=d;function f(v){switch(v){case"one":return 1;case"two":return 2;case"three":return 4;case"four":return 8;case"five":return 16;case"six":return 32}}l.fromName=f;function p(v){for(var m=0,g=0,y=v.length;g<y;++g)m|=f(v[g]);return m}l.fromNames=p;function h(v){var m=[];return l.is(v,1)&&m.push("one"),l.is(v,2)&&m.push("two"),l.is(v,4)&&m.push("three"),l.is(v,8)&&m.push("four"),l.is(v,16)&&m.push("five"),l.is(v,32)&&m.push("six"),m}l.toNames=h}(e.Groups||(e.Groups={})),e.Type={none:0,plane:1,sphere:2,cube:3,cylinder:4,infiniteCone:5};function t(l,c){if(l.layers.length===0&&c.layers.length===0)return!0;if(l.layers.length!==c.layers.length)return!1;for(var d=0,f=l.layers.length;d<f;++d)if(l.layers[d].groups!==c.layers[d].groups||!ir.areEqual(l.layers[d].loci,c.layers[d].loci))return!1;return!0}e.areEqual=t;function r(l){return l.layers.length===0}e.isEmpty=r;function n(l,c){for(var d=[],f=0,p=l.layers;f<p.length;f++){var h=p[f],v=h.loci,m=h.groups;v=Re.remap(v,c),Re.isEmpty(v)||d.push({loci:v,groups:m})}return{layers:d}}e.remap=n;function a(l){if(r(l))return l;for(var c=l.layers[0].loci.structure,d=new Map,f=Re.none(c),p=0,h=l.layers.length;p<h;++p){var v=l.layers[h-p-1],m=v.loci,g=v.groups;m=Re.subtract(m,f),f=Re.union(m,f),Re.isEmpty(m)||(d.has(g)&&(m=Re.union(m,d.get(g))),d.set(g,m))}var y=[];return d.forEach(function(b,x){y.push({loci:b,groups:x})}),{layers:y}}e.merge=a;function i(l,c){if(r(l))return l;for(var d=l.layers[0].loci.structure,f=[],p=0,h=l.layers;p<h.length;p++){var v=h[p],m=v.loci,g=v.groups,y=Re.remap(m,c);m=Re.remap(y,d),Re.isEmpty(m)||f.push({loci:m,groups:g})}return{layers:f}}e.filter=i;function o(l,c){for(var d=[],f=0,p=l.length;f<p;++f){var h=l[f],v=h.script,m=h.groups,g=pa.toLoci(v,c);Re.isEmpty(g)||d.push({loci:g,groups:m})}return{layers:d}}e.ofScript=o;function s(l,c){for(var d=[],f=0,p=l.length;f<p;++f){var h=l[f],v=h.bundle,m=h.groups,g=Qr.toLoci(v,c.root);d.push({loci:g,groups:m})}return{layers:d}}e.ofBundle=s;function u(l){for(var c=[],d=0,f=l.layers.length;d<f;++d){var p=l.layers[d],h=p.loci,v=p.groups,m=Qr.fromLoci(h);c.push({bundle:m,groups:v})}return{layers:c}}e.toBundle=u})(en||(en={}));var l5;(function(e){function t(r,n,a){return E.getDefaultValues(r.getParams(n,a))}e.getDetaultParams=t})(l5||(l5={}));var hpe={label:"",description:"",factory:function(){return or.Empty},getParams:function(){return{}},defaultValues:{}};function c5(e){return e.map(function(t){return[t.name,t.provider.label]})}var xk=function(){function e(){this._list=[],this._map=new Map,this._name=new Map}return Object.defineProperty(e.prototype,"default",{get:function(){return this._list[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"types",{get:function(){return c5(this._list)},enumerable:!1,configurable:!0}),e.prototype.add=function(t){if(this._map.has(t.name))throw new Error(t.name+" already registered.");this._list.push({name:t.name,provider:t}),this._map.set(t.name,t),this._name.set(t,t.name)},e.prototype.getName=function(t){if(!this._name.has(t))throw new Error("'"+t.label+"' is not a registered represenatation provider.");return this._name.get(t)},e.prototype.remove=function(t){var r=t.name;this._list.splice(this._list.findIndex(function(a){return a.name===r}),1);var n=this._map.get(r);n&&(this._map.delete(r),this._name.delete(n))},e.prototype.get=function(t){return this._map.get(t)||hpe},Object.defineProperty(e.prototype,"list",{get:function(){return this._list},enumerable:!1,configurable:!0}),e.prototype.getApplicableList=function(t){return this._list.filter(function(r){return r.provider.isApplicable(t)})},e.prototype.getApplicableTypes=function(t){return c5(this.getApplicableList(t))},e}(),or;(function(e){(function(i){function o(u,l){return u.repr===l.repr&&ir.areEqual(u.loci,l.loci)}i.areEqual=o;function s(u){return ir.isEmpty(u.loci)}i.isEmpty=s,i.Empty={loci:Or}})(e.Loci||(e.Loci={}));function t(){return{visible:!0,alphaFactor:1,pickable:!0,colorOnly:!1,syncManually:!1,transform:ue.identity(),overpaint:va.Empty,transparency:ma.Empty,clipping:en.Empty,markerActions:Ii.All}}e.createState=t;function r(i,o){o.visible!==void 0&&(i.visible=o.visible),o.alphaFactor!==void 0&&(i.alphaFactor=o.alphaFactor),o.pickable!==void 0&&(i.pickable=o.pickable),o.colorOnly!==void 0&&(i.colorOnly=o.colorOnly),o.overpaint!==void 0&&(i.overpaint=o.overpaint),o.transparency!==void 0&&(i.transparency=o.transparency),o.clipping!==void 0&&(i.clipping=o.clipping),o.syncManually!==void 0&&(i.syncManually=o.syncManually),o.transform!==void 0&&ue.copy(i.transform,o.transform),o.markerActions!==void 0&&(i.markerActions=o.markerActions)}e.updateState=r,e.StateBuilder={create:t,update:r},e.Empty={label:"",groupCount:0,renderObjects:[],props:{},params:{},updated:new Ln,state:t(),theme:Yn.createEmpty(),createOrUpdate:function(){return We.constant("",void 0)},setState:function(){},setTheme:function(){},getLoci:function(){return Or},mark:function(){return!1},destroy:function(){}};function n(i,o,s,u,l){var c=this,d=0,f=new Ln,p=u.create(),h=Yn.createEmpty(),v,m,g,y={},b=Object.keys(l).map(function(x,S){y[S]=x;var _=l[x](o,s);return _.setState(p),_});return{label:i,updated:f,get groupCount(){var x=0;if(m)for(var S=m.visuals,_=0,A=b.length;_<A;++_)(!S||S.includes(y[_]))&&(x+=b[_].groupCount);return x},get renderObjects(){var x=[];if(m)for(var S=m.visuals,_=0,A=b.length;_<A;++_)(!S||S.includes(y[_]))&&x.push.apply(x,b[_].renderObjects);return x},get props(){return m},get params(){return v},createOrUpdate:function(x,S){x===void 0&&(x={}),S&&S!==g&&(v=s(o,S),g=S,m||(m=E.getDefaultValues(v)));var _=bC(Object.assign({},m,x),g);Object.assign(m,x,_);var A=m.visuals;return We.create("Creating or updating '"+i+"' representation",function(T){return ce(c,void 0,void 0,function(){var I,M;return de(this,function(O){switch(O.label){case 0:I=0,M=b.length,O.label=1;case 1:return I<M?!A||A.includes(y[I])?[4,b[I].createOrUpdate(m,g).runInContext(T)]:[3,3]:[3,4];case 2:O.sent(),O.label=3;case 3:return++I,[3,1];case 4:return f.next(d++),[2]}})})})},get state(){return p},get theme(){return h},getLoci:function(x){for(var S=m.visuals,_=0,A=b.length;_<A;++_)if(!S||S.includes(y[_])){var T=b[_].getLoci(x);if(!ns(T))return T}return Or},mark:function(x,S){for(var _=!1,A=0,T=b.length;A<T;++A)_=b[A].mark(x,S)||_;return _},setState:function(x){u.update(p,x);for(var S=0,_=b.length;S<_;++S)b[S].setState(p)},setTheme:function(x){for(var S=0,_=b.length;S<_;++S)b[S].setTheme(x)},destroy:function(){for(var x=0,S=b.length;x<S;++x)b[x].destroy()}}}e.createMulti=n;function a(i,o){var s=this,u=0,l=new Ln,c=e.createState(),d=Yn.createEmpty(),f=E.clone(At.Params),p=E.getDefaultValues(At.Params);return{label:i,updated:l,get groupCount(){return o.values.uGroupCount.ref.value},get renderObjects(){return[o]},get props(){return p},get params(){return f},createOrUpdate:function(h){h===void 0&&(h={});var v=bC(Object.assign({},p,h));return Object.assign(p,h,v),We.create("Updating '"+i+"' representation",function(m){return ce(s,void 0,void 0,function(){return de(this,function(g){return l.next(u++),[2]})})})},get state(){return c},get theme(){return d},getLoci:function(){return Or},mark:function(h,v){return!1},setState:function(h){h.visible!==void 0&&Sr.setVisibility(o,h.visible),h.alphaFactor!==void 0&&Sr.setAlphaFactor(o,h.alphaFactor),h.pickable!==void 0&&Sr.setPickable(o,h.pickable),h.colorOnly!==void 0&&Sr.setColorOnly(o,h.colorOnly),h.overpaint,h.transparency,h.transform!==void 0&&Sr.setTransform(o,h.transform),e.updateState(c,h)},setTheme:function(){},destroy:function(){}}}e.fromRenderObject=a})(or||(or={}));function sa(e,t,r){r===void 0&&(r={});var n=0,a=new Ln,i=or.createState(),o=vl(),s=[],u,l,c=Yn.createEmpty(),d=E.getDefaultValues(t.Params),f,p,h;r.modifyState&&or.updateState(i,r.modifyState(i));var v=Ys.create();function m(b,x){Ys.reset(v),!(!x&&!l)&&(x&&!l?v.createNew=!0:x&&l&&x.id===l.id||(x&&l&&x.id!==l.id?(v.updateTransform=!0,v.createGeometry=!0):x&&console.warn("unexpected state")),v.updateTransform&&(v.updateColor=!0,v.updateSize=!0),v.createGeometry&&(v.updateColor=!0,v.updateSize=!0))}function g(b,x){var S=this;return b===void 0&&(b={}),r.modifyProps&&(b=r.modifyProps(b)),We.create("ShapeRepresentation.create",function(_){return ce(S,void 0,void 0,function(){var A,T,I,M,O,D,F,G;return de(this,function(N){switch(N.label){case 0:return A=Object.assign(d,b),x?[4,e(_,x,A,l)]:[3,2];case 1:return I=N.sent(),[3,3];case 2:I=void 0,N.label=3;case 3:if(T=I,m(b,T),T&&(l=T,Object.assign(c,Rr.getTheme(l))),v.createNew)s.length=0,p=Rr.groupIterator(l),M=Rr.createTransform(l.transforms),O=t.createValues(l.geometry,M,p,c,A),D=t.createRenderableState(A),r.modifyState&&Object.assign(D,r.modifyState(D)),or.updateState(i,D),u=kp(l.geometry.kind,O,D,o),u&&s.push(u),h=t.createPositionIterator(l.geometry,u.values);else{if(!u)throw new Error("expected renderObject to be available");v.updateTransform&&(Rr.createTransform(l.transforms,u.values),p=Rr.groupIterator(l),F=p.instanceCount,G=p.groupCount,Fo(F*G,u.values)),v.createGeometry&&(k.updateIfChanged(u.values.drawCount,Ma.getDrawCount(l.geometry)),k.updateIfChanged(u.values.uVertexCount,Ma.getVertexCount(l.geometry))),(v.updateTransform||v.createGeometry)&&(t.updateBoundingSphere(u.values,l.geometry),h=t.createPositionIterator(l.geometry,u.values)),v.updateColor&&to(p,h,c.color,u.values),v.updateSize&&"uSize"in u.values&&il(p,c.size,u.values),t.updateValues(u.values,A),t.updateRenderableState(u.state,A)}return d=A,a.next(n++),[2]}})})})}function y(b,x){return Ao(b)||Rr.isLoci(b)&&b.shape===l?x(Ie.ofBounds(0,l.groupCount*l.transforms.length)):vpe(b,l,x)}return{label:"Shape geometry",get groupCount(){return p?p.count:0},get props(){return d},get params(){return f},get state(){return i},get theme(){return c},renderObjects:s,updated:a,createOrUpdate:g,getLoci:function(b){if(b===void 0)return Rr.Loci(l);var x=b.objectId,S=b.groupId,_=b.instanceId;return u&&u.id===x?si.Loci(l,[{ids:ke.ofSingleton(S),instance:_}]):Or},mark:function(b,x){if(!Ii.is(i.markerActions,x))return!1;if(si.isLoci(b)||Rr.isLoci(b)){if(b.shape!==l)return!1}else if(!Ao(b))return!1;return Sr.mark(u,b,x,y)},setState:function(b){r.modifyState&&(b=r.modifyState(b)),u&&(b.visible!==void 0&&Sr.setVisibility(u,b.visible),b.alphaFactor!==void 0&&Sr.setAlphaFactor(u,b.alphaFactor),b.pickable!==void 0&&Sr.setPickable(u,b.pickable),b.colorOnly!==void 0&&Sr.setColorOnly(u,b.colorOnly),b.overpaint!==void 0&&Sr.setOverpaint(u,b.overpaint,y,!0),b.transparency!==void 0&&Sr.setTransparency(u,b.transparency,y,!0),b.transform!==void 0&&Sr.setTransform(u,b.transform)),or.updateState(i,b)},setTheme:function(b){Ir&&console.warn("The `ShapeRepresentation` theme is fixed to `ShapeGroupColorTheme` and `ShapeGroupSizeTheme`. Colors are taken from `Shape.getColor` and sizes from `Shape.getSize`")},destroy:function(){s.length=0,u&&(u.state.disposed=!0,u=void 0)}}}function vpe(e,t,r){if(!si.isLoci(e)||e.shape!==t)return!1;for(var n=!1,a=t.groupCount,i=e.groups,o=0,s=i;o<s.length;o++){var u=s[o],l=u.ids,c=u.instance;if(Ie.is(l)){var d=c*a+Ie.start(l),f=c*a+Ie.end(l);r(Ie.ofBounds(d,f))&&(n=!0)}else for(var p=0,h=l.length;p<h;p++){var v=c*a+l[p];r(Ie.ofSingleton(v))&&(n=!0)}}return n}var d5=ue(),yp=function(){function e(t){this.structure=t,this.groupUnitTransforms=[],this.unitOffsetMap=Eo.Mutable(),this.groupIndexMap=Eo.Mutable(),this._isIdentity=void 0,this.version=0,this.unitTransforms=new Float32Array(t.units.length*16),this.size=t.units.length,this.reset();for(var r=0,n=0,a=t.unitSymmetryGroups.length;n<a;++n){var i=t.unitSymmetryGroups[n];this.groupIndexMap.set(i.hashCode,n);var o=this.unitTransforms.subarray(r,r+i.units.length*16);this.groupUnitTransforms.push(o);for(var s=0,u=i.units.length;s<u;++s)this.unitOffsetMap.set(i.units[s].id,r+s*16);r+=i.units.length*16}}return e.prototype.reset=function(){this.version=0,dg(this.unitTransforms,this.size),this._isIdentity=!0},Object.defineProperty(e.prototype,"isIdentity",{get:function(){if(this._isIdentity===void 0){this._isIdentity=!0;for(var t=0,r=this.size*16;t<r;t+=16)if(ue.fromArray(d5,this.unitTransforms,t),!ue.isIdentity(d5)){this._isIdentity=!1;break}}return this._isIdentity},enumerable:!1,configurable:!0}),e.prototype.setTransform=function(t,r){this.version=(this.version+1)%2147483647,ue.toArray(t,this.unitTransforms,this.unitOffsetMap.get(r.id)),this._isIdentity=void 0},e.prototype.getTransform=function(t,r){return ue.fromArray(t,this.unitTransforms,this.unitOffsetMap.get(r.id))},e.prototype.getSymmetryGroupTransforms=function(t){return this.groupUnitTransforms[this.groupIndexMap.get(t.hashCode)]},e}(),f5=ue.zero();function p5(e,t,r){for(var n=0,a=e.units.length;n<a;n++){var i=e.units[n];dn.lerpFromIdentity(f5,i.conformation.operator,r),t.setTransform(f5,i)}}var h5=C.zero(),Xf=C.zero(),Og=ue.zero();function v5(e,t,r){for(var n=e.boundary.sphere,a=n.radius*r,i=0,o=e.units.length;i<o;i++){var s=e.units[i];C.transformMat4(h5,s.lookup3d.boundary.sphere.center,s.conformation.operator.matrix),C.sub(Xf,h5,n.center),C.setMagnitude(Xf,Xf,a),ue.fromTranslation(Og,Xf),t.setTransform(Og,s)}}var mpe={axis:E.MappedStatic("custom",{structure:E.Group({principalAxis:E.Select("dirA",[["dirA","A"],["dirB","B"],["dirC","C"]])}),custom:E.Group({vector:E.Vec3(C.create(0,0,1))})}),origin:E.MappedStatic("structure",{structure:E.Group({}),custom:E.Group({vector:E.Vec3(C.create(0,0,0))})})};function m5(e,t){var r,n;if(t.axis.name==="custom")r=t.axis.params.vector;else{var a=Xe.getPrincipalAxes(e);r=a.momentsAxes[t.axis.params.principalAxis]}if(t.origin.name==="custom")n=t.origin.params.vector;else{var a=Xe.getPrincipalAxes(e);n=a.momentsAxes.origin}return{axis:r,origin:n}}var g5=ue(),y5=ue(),Gm=ue();function b5(e,t,r,n,a){for(var i=0,o=e.units.length;i<o;i++){var s=e.units[i];C.negate(Xf,a),ue.fromTranslation(Og,Xf),ue.fromRotation(g5,Math.PI*r*2,n),ue.fromTranslation(y5,a),ue.mul(Gm,g5,Og),ue.mul(Gm,y5,Gm),t.setTransform(Gm,s)}}var gpe=ue.fromTranslation(ue(),C.create(.5,.5,.5)),ype=FO(OO(BO()),gpe),zo=C(),S5=ue(),bpe={origin:"Origin",model:"Model"},Spe={corner:"Corner",center:"Center"},xpe=w(w({},Lt.Params),{cellColor:E.Color(dr.orange),cellScale:E.Numeric(2,{min:.1,max:5,step:.1}),ref:E.Select("model",E.objectToOptions(bpe),{isEssential:!0}),attachment:E.Select("corner",E.objectToOptions(Spe),{isEssential:!0})}),Cpe={mesh:function(e,t){return sa(wpe,Lt.Utils)}},x5=w({},xpe);function _pe(e,t,r){var n=_t.createState(256,128,r),a=e.symmetry.spacegroup.cell.fromFractional;C.copy(zo,e.ref),t.attachment==="center"?(C.trunc(zo,zo),C.subScalar(zo,zo,.5)):C.floor(zo,zo),ue.fromTranslation(S5,zo);var i=FO(OO(ype),S5),o=Math.cbrt(e.symmetry.spacegroup.cell.volume)/300*t.cellScale;n.currentGroup=1,_t.addCage(n,a,i,o,2,20);var s=Ne.fromDimensionsAndTransform(Ne(),C.unit,a);C.transformMat4(zo,zo,a),Ne.translate(s,s,zo),Ne.expand(s,s,o);var u=_t.getMesh(n);return u.setBoundingSphere(s),u}function wpe(e,t,r,n){var a=_pe(t,r,n&&n.geometry),i=vv.getUnitcellLabel(t.symmetry);return Rr.create(i,t,a,function(){return r.cellColor},function(){return 1},function(){return i})}function C5(e,t,r){var n=C();return r.ref==="model"&&C.transformMat4(n,jt.getCenter(e),t.spacegroup.cell.toFractional),{symmetry:t,ref:n}}function Ape(e,t){return or.createMulti("Unit Cell",e,t,or.StateBuilder,Cpe)}var so=new Uint16Array([0,1,2,1,3,2]),Vc=je.add3,Aa=je.add2,_5=je.add,Xu;(function(e){function t(r,n,a,i){r===void 0&&(r={}),n===void 0&&(n=2048),a===void 0&&(a=1024),n*=2,a*=2;var o=je.create(Float32Array,3,a,i?i.centerBuffer.ref.value:n),s=je.create(Float32Array,2,a,i?i.mappingBuffer.ref.value:n),u=je.create(Float32Array,1,a,i?i.depthBuffer.ref.value:n),l=je.create(Uint32Array,3,a,i?i.indexBuffer.ref.value:n),c=je.create(Float32Array,1,a,i?i.groupBuffer.ref.value:n),d=je.create(Float32Array,2,a,i?i.tcoordBuffer.ref.value:n),f=w(w({},E.getDefaultValues(Do.Params)),r),p=f.attachment,h=f.background,v=f.backgroundMargin,m=f.tether,g=f.tetherLength,y=f.tetherBaseWidth,b=qae(f),x=1/2.5*v,S=b.buffer/b.lineHeight,_=function(A,T,I,M,O){Vc(o,A,T,I),_5(u,M),_5(c,O)};return{add:function(A,T,I,M,O,D,F){for(var G=0,N=A.length,z=0;z<N;++z){var $=b.get(A[z]);G+=$.nw-2*S}var j=1/1.25,Z,q;if(p.startsWith("top")?Z=j:p.startsWith("middle")?Z=j/2:Z=0,p.endsWith("right")?q=G:p.endsWith("center")?q=G/2:q=0,m)switch(p){case"bottom-left":q-=g/2+x+.1,Z-=g/2+x;break;case"bottom-center":Z-=g+x;break;case"bottom-right":q+=g/2+x+.1,Z-=g/2+x;break;case"middle-left":q-=g+x+.1;break;case"middle-center":break;case"middle-right":q+=g+x+.1;break;case"top-left":q-=g/2+x+.1,Z+=g/2+x;break;case"top-center":Z+=g+x;break;case"top-right":q+=g/2+x+.1,Z+=g/2+x;break}var te=(-q-x-.1)*D,he=(G-q+x+.1)*D,W=(j-Z+x)*D,K=(-Z-x)*D;if(h){Aa(s,te,W),Aa(s,te,K),Aa(s,he,W),Aa(s,he,K);for(var U=o.elementCount,H=0;H<4;++H)Aa(d,10,10),_(T,I,M,O,F);Vc(l,U+so[0],U+so[1],U+so[2]),Vc(l,U+so[3],U+so[4],U+so[5])}if(m){var J=void 0,X=void 0,Q=void 0,ee=void 0,le=void 0,ye=void 0,be=void 0,Ae=void 0,xe=g*D,ae=y*D;switch(p){case"bottom-left":J=te-xe/2,Q=te+ae/2,le=te,be=te,X=K-xe/2,ee=K,ye=K+ae/2,Ae=K;break;case"bottom-center":J=0,Q=ae/2,le=-ae/2,be=0,X=K-xe,ee=K,ye=K,Ae=K;break;case"bottom-right":J=he+xe/2,Q=he,le=he-ae/2,be=he,X=K-xe/2,ee=K+ae/2,ye=K,Ae=K;break;case"middle-left":J=te-xe,Q=te,le=te,be=te,X=0,ee=-ae/2,ye=ae/2,Ae=0;break;case"middle-center":J=0,Q=0,le=0,be=0,X=0,ee=0,ye=0,Ae=0;break;case"middle-right":J=he+xe,Q=he,le=he,be=he,X=0,ee=ae/2,ye=-ae/2,Ae=0;break;case"top-left":J=te-xe/2,Q=te+ae/2,le=te,be=te,X=W+xe/2,ee=W,ye=W-ae/2,Ae=W;break;case"top-center":J=0,Q=ae/2,le=-ae/2,be=0,X=W+xe,ee=W,ye=W,Ae=W;break;case"top-right":J=he+xe/2,Q=he,le=he-ae/2,be=he,X=W+xe/2,ee=W-ae/2,ye=W,Ae=W;break;default:throw new Error("unsupported attachment")}Aa(s,J,X),Aa(s,Q,ee),Aa(s,le,ye),Aa(s,be,Ae);for(var U=o.elementCount,H=0;H<4;++H)Aa(d,10,10),_(T,I,M,O,F);Vc(l,U,U+1,U+3),Vc(l,U,U+3,U+2)}q+=S,Z+=S;for(var oe=0,z=0;z<N;++z){var $=b.get(A[z]),R=(oe-q)*D,V=(oe+$.nw-q)*D,pe=($.nh-Z)*D,_e=-Z*D;Aa(s,R,pe),Aa(s,R,_e),Aa(s,V,pe),Aa(s,V,_e);var Ee=b.texture.width,Ve=b.texture.height;Aa(d,$.x/Ee,$.y/Ve),Aa(d,$.x/Ee,($.y+$.h)/Ve),Aa(d,($.x+$.w)/Ee,$.y/Ve),Aa(d,($.x+$.w)/Ee,($.y+$.h)/Ve),oe+=$.nw-2*S;for(var U=o.elementCount,H=0;H<4;++H)_(T,I,M,O,F);Vc(l,U+so[0],U+so[1],U+so[2]),Vc(l,U+so[3],U+so[4],U+so[5])}},getText:function(){var A=b.texture,T=je.compact(o,!0),I=je.compact(s,!0),M=je.compact(u,!0),O=je.compact(l,!0),D=je.compact(c,!0),F=je.compact(d,!0);return Do.create(A,T,I,M,O,D,F,l.elementCount/2,i)}}}e.create=t})(Xu||(Xu={}));var Bp={granularity:"element",condensed:!1,reverse:!1,countsOnly:!1,hidePrefix:!1,htmlStyling:!0};function Cc(e,t){switch(t===void 0&&(t={}),e.kind){case"structure-loci":return e.structure.models.map(function(l){return l.entry}).filter(function(l){return!!l}).join(", ");case"element-loci":return Fg(nc.ofLoci(e),t);case"bond-loci":var r=e.bonds[0];return r?E3(r):"";case"shape-loci":return e.shape.name;case"group-loci":var n=e.groups[0];return n?e.shape.getLabel(ke.start(n.ids),n.instance):"";case"every-loci":return"Everything";case"empty-loci":return"Nothing";case"data-loci":return e.getLabel();case"volume-loci":return e.volume.label||"Volume";case"isosurface-loci":return[""+(e.volume.label||"Volume"),"Isosurface at "+Ct.IsoValue.toString(e.isoValue)].join(" | ");case"cell-loci":var a=ke.size(e.indices),i=ke.start(e.indices),o=Ct.IsoValue.absolute(e.volume.grid.cells.data[i]),s=Ct.IsoValue.toRelative(o,e.volume.grid.stats),u=[""+(e.volume.label||"Volume"),a===1?"Cell #"+i:a+" Cells"];return a===1&&u.push(Ct.IsoValue.toString(o)+" ("+Ct.IsoValue.toString(s)+")"),u.join(" | ")}}function Vf(e,t){return e===1?"1 "+t:e+" "+t+"s"}function th(e,t,r,n,a,i){return Go(t,{granularity:r,hidePrefix:n,reverse:a,condensed:i})+" <small>[+ "+Vf(e-1,"other "+Cp(r))+"]</small>"}function Ppe(e){var t=e.elements,r=e.model,n=r.atomicHierarchy,a=n.chainAtomSegments,i=n.residueAtomSegments,o=a.offsets[a.index[t[0]]],s=a.offsets[a.index[t[t.length-1]]+1]-1;return i.index[s]-i.index[o]+1}function Fg(e,t){t===void 0&&(t={});var r=w(w({},Bp),t),n=Tpe(e,r.countsOnly,r.hidePrefix,r.condensed,r.reverse);return r.htmlStyling?n:Zl(n)}function Tpe(e,t,r,n,a){t===void 0&&(t=!1),r===void 0&&(r=!1),n===void 0&&(n=!1),a===void 0&&(a=!1);var i=e.structureCount,o=e.chainCount,s=e.residueCount,u=e.conformationCount,l=e.elementCount;if(!t&&l===1&&s===0&&o===0)return Go(e.firstElementLoc,{hidePrefix:r,condensed:n,granularity:"element",reverse:a});if(!t&&l===0&&s===1&&o===0)return Go(e.firstResidueLoc,{hidePrefix:r,condensed:n,granularity:"residue",reverse:a});if(!t&&l===0&&s===0&&o===1){var c=e.firstChainLoc.unit,d=ze.isAtomic(c)&&Ppe(c)===1||ze.Traits.is(c.traits,1)?"residue":"chain";return Go(e.firstChainLoc,{hidePrefix:r,condensed:n,granularity:d,reverse:a})}else if(t){var f=[];return i>0&&f.push(Vf(i,"Structure")),o>0&&f.push(Vf(o,"Chain")),s>0&&f.push(Vf(s,"Residue")),u>0&&f.push(Vf(u,"Conformation")),l>0&&f.push(Vf(l,"Element")),f.join("<small> + </small>")}else{var f=[];return i>0&&f.push(i===1?Go(e.firstStructureLoc,{hidePrefix:r,condensed:n,granularity:"structure",reverse:a}):th(i,e.firstStructureLoc,"structure",r,a,n)),o>0&&(f.push(o===1?Go(e.firstChainLoc,{condensed:n,granularity:"chain",hidePrefix:r,reverse:a}):th(o,e.firstChainLoc,"chain",r,a,n)),r=!0),s>0&&(f.push(s===1?Go(e.firstResidueLoc,{condensed:n,granularity:"residue",hidePrefix:r,reverse:a}):th(s,e.firstResidueLoc,"residue",r,a,n)),r=!0),u>0&&(f.push(u===1?Go(e.firstConformationLoc,{condensed:n,granularity:"conformation",hidePrefix:r,reverse:a}):th(u,e.firstConformationLoc,"conformation",r,a,n)),r=!0),l>0&&f.push(l===1?Go(e.firstElementLoc,{condensed:n,granularity:"element",hidePrefix:r,reverse:a}):th(l,e.firstElementLoc,"element",r,a,n)),f.join("<small> + </small>")}}function E3(e,t){return t===void 0&&(t={}),o1({loci:[Re(e.aStructure,[{unit:e.aUnit,indices:ke.ofSingleton(e.aIndex)}]),Re(e.bStructure,[{unit:e.bUnit,indices:ke.ofSingleton(e.bIndex)}])]},t)}function o1(e,t){t===void 0&&(t={});var r=w(w({},Bp),t),n=Epe(e,r);return r.htmlStyling?n:Zl(n)}function Epe(e,t){for(var r=t.granularity,n=t.hidePrefix,a=t.reverse,i=t.condensed,o=!0,s=0,u=e.loci;s<u.length;s++){var l=u[s];if(!Re.is(l)||Re.size(l)!==1){o=!1;break}}if(o){var c=e.loci.map(function(b){var x=b.elements[0],S=x.unit,_=x.indices;return Ze.create(b.structure,S,S.elements[ke.start(_)])}),d=c.map(function(b){return Ck(b,r,n,a||i)});if(i)return d.map(function(b){return b[0].replace(/\[.*\]/g,"").trim()}).filter(function(b){return!!b}).join(" \u2014 ");for(var f=0,p=0,h=Math.min.apply(Math,d.map(function(b){return b.length}))-1;p<h;++p){for(var v=!0,m=1,g=d.length;m<g;++m)if(d[0][p]!==d[m][p]){v=!1;break}if(v)f+=1;else break}if(f>0){for(var y=[d[0].join(" | ")],m=1,g=d.length;m<g;++m)y.push(d[m].slice(f).filter(function(S){return!!S}).join(" | "));return y.join(" \u2014 ")}else return d.map(function(b){return b.filter(function(x){return!!x}).join(" | ")}).filter(function(b){return!!b}).join("</br>")}else{var d=e.loci.map(function(x){return Cc(x,t)});return d.filter(function(x){return!!x}).join(i?" \u2014 ":"</br>")}}function Go(e,t){var r,n;t===void 0&&(t={});var a=w(w({},Bp),t),i=Ck(e,a.granularity,a.hidePrefix,a.reverse||a.condensed),o=a.condensed?(n=(r=i[0])===null||r===void 0?void 0:r.replace(/\[.*\]/g,"").trim())!==null&&n!==void 0?n:"":i.filter(function(s){return!!s}).join(" | ");return a.htmlStyling?o:Zl(o)}function Ck(e,t,r,n){t===void 0&&(t="element"),r===void 0&&(r=!1),n===void 0&&(n=!1);var a=[];if(!r){var i=e.unit.model.entry;i.length>30&&(i=i.substr(0,27)+"\u2026"),a.push("<small>"+i+"</small>"),t!=="structure"&&(a.push("<small>Model "+e.unit.model.modelNum+"</small>"),a.push("<small>Instance "+e.unit.conformation.operator.name+"</small>"))}return ze.isAtomic(e.unit)?a.push.apply(a,Ipe(e,t,n)):ze.isCoarse(e.unit)?a.push.apply(a,Mpe(e,t)):a.push("Unknown"),n?a.reverse():a}function Ipe(e,t,r){r===void 0&&(r=!1);var n=Ze.residueIndex(e),a=ct.chain.label_asym_id(e),i=ct.chain.auth_asym_id(e),o=e.unit.model.atomicHierarchy.residues.label_seq_id.valueKind(n)===0,s=ct.residue.label_seq_id(e),u=ct.residue.auth_seq_id(e),l=ct.residue.pdbx_PDB_ins_code(e),c=ct.atom.label_comp_id(e),d=ct.atom.label_atom_id(e),f=ct.atom.label_alt_id(e),p=ct.atom.occupancy(e),h=ct.residue.microheterogeneityCompIds(e),v=t==="residue"&&h.length>1?"("+h.join("|")+")":c,m=[];switch(t){case"element":m.push("<b>"+d+"</b>"+(f?"%"+f:""));case"conformation":t==="conformation"&&f&&m.push("<small>Conformation</small> <b>"+f+"</b>");case"residue":var g=s===u||!o?u:s;m.push("<b>"+v+" "+g+"</b>"+(g!==u?" <small>[auth</small> <b>"+u+"</b><small>]</small>":"")+"<b>"+(l||"")+"</b>");case"chain":a===i?m.push("<b>"+a+"</b>"):t==="chain"&&ze.Traits.is(e.unit.traits,1)?m.push("<small>[auth</small> <b>"+i+"</b><small>]</small>"):m.push("<b>"+a+"</b> <small>[auth</small> <b>"+i+"</b><small>]</small>")}return m.length>0&&p!==1&&!r&&(m[0]=m[0]+" <small>[occupancy</small> <b>"+Math.round(100*p)/100+"</b><small>]</small>"),m.reverse()}function Mpe(e,t){var r=ct.coarse.asym_id(e),n=ct.coarse.seq_id_begin(e),a=ct.coarse.seq_id_end(e),i=[];switch(t){case"element":case"conformation":case"residue":if(n===a){var o=ct.coarse.entityKey(e),s=e.unit.model.sequence.byEntityKey[o],u=s.sequence.compId.value(n-1);i.push("<b>"+u+" "+n+"</b>")}else i.push("<b>"+n+"-"+a+"</b>");case"chain":i.push("<b>"+r+"</b>")}return i.reverse()}function s1(e,t){t===void 0&&(t={});var r=w(w(w({},Bp),{measureOnly:!1,unitLabel:"\u212B"}),t),n=e.loci.map(function(u){return ir.getCenter(u)}),a=n[0],i=n[1],o=C.distance(a,i).toFixed(2)+" "+r.unitLabel;if(r.measureOnly)return o;var s=o1(e,r);return r.condensed?o+" | "+s:"Distance "+o+"</br>"+s}function u1(e,t){t===void 0&&(t={});var r=w(w(w({},Bp),{measureOnly:!1}),t),n=e.loci.map(function(d){return ir.getCenter(d)}),a=n[0],i=n[1],o=n[2],s=C.sub(C(),a,i),u=C.sub(C(),o,i),l=Jo(C.angle(s,u)).toFixed(2)+"\xB0";if(r.measureOnly)return l;var c=o1(e,r);return r.condensed?l+" | "+c:"Angle "+l+"</br>"+c}function l1(e,t){t===void 0&&(t={});var r=w(w(w({},Bp),{measureOnly:!1}),t),n=e.loci.map(function(c){return ir.getCenter(c)}),a=n[0],i=n[1],o=n[2],s=n[3],u=Jo(C.dihedralAngle(a,i,o,s)).toFixed(2)+"\xB0";if(r.measureOnly)return u;var l=o1(e,r);return r.condensed?u+" | "+l:"Dihedral "+u+"</br>"+l}var _k={customText:E.Text("",{label:"Text",description:"Override the label with custom value."}),textColor:E.Color(dr.black,{isEssential:!0}),textSize:E.Numeric(.5,{min:.1,max:5,step:.1},{isEssential:!0})},c1=w(w(w({},Do.Params),_k),{borderWidth:E.Numeric(.2,{min:0,max:.5,step:.01})}),wk={unitLabel:E.Text("\u212B",{isEssential:!0})},Dpe=w(w(w({},mn.Params),wk),{lineSizeAttenuation:E.Boolean(!0),linesColor:E.Color(dr.lightgreen,{isEssential:!0}),linesSize:E.Numeric(.075,{min:.01,max:5,step:.01}),dashLength:E.Numeric(.2,{min:.01,max:.2,step:.01})}),Rpe=w(w({},c1),wk),Ak={lines:function(e,t){return sa(kpe,mn.Utils,{modifyState:function(r){return w(w({},r),{markerActions:Ii.Highlighting})}})},text:function(e,t){return sa(Lpe,Do.Utils,{modifyState:function(r){return w(w({},r),{markerActions:tr.None})}})}},w5=w(w(w({},Dpe),Rpe),{visuals:E.MultiSelect(["lines","text"],E.objectToOptions(Ak))});function Ope(){return{sphereA:Ne(),sphereB:Ne(),center:C(),distance:0}}function Pk(e,t){var r=t.sphereA,n=t.sphereB,a=t.center,i=e.loci,o=i[0],s=i[1];return ir.getBoundingSphere(o,r),ir.getBoundingSphere(s,n),C.add(a,r.center,n.center),C.scale(a,a,.5),t.distance=C.distance(r.center,n.center),t}var Kl=Ope();function Tk(e,t){return e.pairs.length===1?"Distance "+s1(e.pairs[0],{unitLabel:t,measureOnly:!0}):e.pairs.length+" Distances"}function Fpe(e,t,r){for(var n=Zi.create(128,64,r),a=0,i=e.pairs.length;a<i;++a)Pk(e.pairs[a],Kl),n.addFixedLengthDashes(Kl.sphereA.center,Kl.sphereB.center,t.dashLength,a);return n.getLines()}function kpe(e,t,r,n){var a=Fpe(t,r,n&&n.geometry),i=Tk(t,r.unitLabel),o=function(s){return s1(t.pairs[s],r)};return Rr.create(i,t,a,function(){return r.linesColor},function(){return r.linesSize},o)}function Bpe(e,t,r){for(var n=Xu.create(t,128,64,r),a=0,i=e.pairs.length;a<i;++a){Pk(e.pairs[a],Kl);var o=Kl.center,s=Kl.distance,u=Kl.sphereA,l=Kl.sphereB,c=t.customText||s.toFixed(2)+" "+t.unitLabel,d=Math.max(2,u.radius,l.radius),f=d/2;n.add(c,o[0],o[1],o[2],1,f,a)}return n.getText()}function Lpe(e,t,r,n){var a=Bpe(t,r,n&&n.geometry),i=Tk(t,r.unitLabel),o=function(s){return s1(t.pairs[s],r)};return Rr.create(i,t,a,function(){return r.textColor},function(){return r.textSize},o)}function Npe(e,t){return or.createMulti("Distance",e,t,or.StateBuilder,Ak)}function A5(e){var t=e[0].loci,r=e[1].loci;return{pairs:[{loci:[t,r]}]}}function P5(e){var t=e[0].loci,r=e[1].loci,n=e[2].loci;return{triples:[{loci:[t,r,n]}]}}function T5(e){var t=e[0].loci,r=e[1].loci,n=e[2].loci,a=e[3].loci;return{quads:[{loci:[t,r,n,a]}]}}function E5(e){var t=e[0].loci;return{infos:[{loci:t}]}}function I5(e){var t=e[0].loci;return{locis:[t]}}var Upe=w(w({},c1),{offsetZ:E.Numeric(2,{min:0,max:10,step:.1})}),Ek={text:function(e,t){return sa(Gpe,Do.Utils,{modifyState:function(r){return w(w({},r),{pickable:!1})}})}},M5=w(w({},Upe),{scaleByRadius:E.Boolean(!0),visuals:E.MultiSelect(["text"],E.objectToOptions(Ek))}),zpe=Ne();function I3(e,t){return t===void 0&&(t=!1),e.label||Cc(e.loci,{hidePrefix:!0,htmlStyling:!1,condensed:t})}function Vpe(e){return e.infos.length===1?I3(e.infos[0]):e.infos.length+" Labels"}function Hpe(e,t,r){for(var n=Xu.create(t,128,64,r),a=t.customText.trim(),i=0,o=e.infos.length;i<o;++i){var s=e.infos[i],u=ir.getBoundingSphere(s.loci,zpe);if(!!u){var l=u.center,c=u.radius,d=a||I3(s,!0);n.add(d,l[0],l[1],l[2],t.scaleByRadius?c/.9:0,t.scaleByRadius?Math.max(1,c):1,i)}}return n.getText()}function Gpe(e,t,r,n){var a=Hpe(t,r,n&&n.geometry),i=Vpe(t),o=r.customText.trim(),s=o?function(u){return o}:function(u){return I3(t.infos[u])};return Rr.create(i,t,a,function(){return r.textColor},function(){return r.textSize},s)}function qpe(e,t){return or.createMulti("Label",e,t,or.StateBuilder,Ek)}var Hc=C(),jpe=ue.identity(),Gc=new Float32Array(6*3),Wpe=new Uint8Array([0,1,2,3,4,5]);function Xpe(e,t,r,n,a){var i=t.origin,o=t.dirA,s=t.dirB,u=t.dirC;C.add(Hc,i,o),C.toArray(C.add(Hc,i,o),Gc,0),C.toArray(C.sub(Hc,i,o),Gc,3),C.toArray(C.add(Hc,i,s),Gc,6),C.toArray(C.sub(Hc,i,s),Gc,9),C.toArray(C.add(Hc,i,u),Gc,12),C.toArray(C.sub(Hc,i,u),Gc,15);var l=g3(Gc,Wpe),c=Qo.volume(t),d=Math.cbrt(c)/300*r;_t.addCage(e,jpe,l,d,n,a)}C.zero();C.zero();var Al=C(),Ype=C(),Kpe=C(),$pe=C(),Qpe=ue.identity(),D5=new Float32Array(8*3),Zpe=new Uint8Array([0,1,0,3,0,6,1,2,1,7,2,3,2,4,3,5,4,5,4,7,5,6,6,7]);function Jpe(e,t,r,n,a){var i=t.origin,o=t.dirA,s=t.dirB,u=t.dirC,l=C.negate(Ype,o),c=C.negate(Kpe,s),d=C.negate($pe,u),f=0,p=function(g,y,b){C.copy(Al,i),C.add(Al,Al,g),C.add(Al,Al,y),C.add(Al,Al,b),C.toArray(Al,D5,f),f+=3};p(o,s,u),p(o,s,d),p(o,c,d),p(o,c,u),p(l,c,d),p(l,c,u),p(l,s,u),p(l,s,d);var h=g3(D5,Zpe),v=Qo.volume(t),m=Math.cbrt(v)/300*r;_t.addCage(e,Qpe,h,m,n,a)}var ehe=ue.identity(),R5=C();function the(e,t,r,n,a){return C.add(R5,t,r),ue.targetTo(e,t,R5,n),ue.setTranslation(e,t),ue.scale(e,e,a)}function M3(e,t,r,n,a,i){_t.addPrimitive(e,the(ehe,t,r,n,a),eF(i))}var D3={color:E.Color(dr.orange),scale:E.Numeric(2,{min:.1,max:10,step:.1})},rhe=w(w({},Lt.Params),D3),nhe=w(w({},Lt.Params),D3);w(w({},Lt.Params),D3);var Ik={axes:function(e,t){return sa(ihe,Lt.Utils)},box:function(e,t){return sa(she,Lt.Utils)},ellipsoid:function(e,t){return sa(lhe,Lt.Utils)}},O5=w(w(w({},rhe),nhe),{visuals:E.MultiSelect(["box"],E.objectToOptions(Ik)),color:E.Color(dr.orange),scale:E.Numeric(2,{min:.1,max:5,step:.1})});function d1(e){var t=Cc(e,{countsOnly:!0});return"Principal Axes of "+t}function R3(e){return e.locis.length===1?d1(e.locis[0]):e.locis.length+" Orientations"}function ahe(e,t,r){for(var n=_t.createState(256,128,r),a=0,i=e.locis.length;a<i;++a){var o=ir.getPrincipalAxes(e.locis[a]);o&&(n.currentGroup=a,Xpe(n,o.momentsAxes,t.scale,2,20))}return _t.getMesh(n)}function ihe(e,t,r,n){var a=ahe(t,r,n&&n.geometry),i=R3(t),o=function(s){return d1(t.locis[s])};return Rr.create(i,t,a,function(){return r.color},function(){return 1},o)}function ohe(e,t,r){for(var n=_t.createState(256,128,r),a=0,i=e.locis.length;a<i;++a){var o=ir.getPrincipalAxes(e.locis[a]);o&&(n.currentGroup=a,Jpe(n,o.boxAxes,t.scale,2,20))}return _t.getMesh(n)}function she(e,t,r,n){var a=ohe(t,r,n&&n.geometry),i=R3(t),o=function(s){return d1(t.locis[s])};return Rr.create(i,t,a,function(){return r.color},function(){return 1},o)}function uhe(e,t,r){for(var n=_t.createState(256,128,r),a=0,i=e.locis.length;a<i;++a){var o=ir.getPrincipalAxes(e.locis[a]);if(o){var s=o.boxAxes,u=s.origin,l=s.dirA,c=s.dirB,d=Qo.size(C(),s);C.scale(d,d,.5);var f=C.create(d[2],d[1],d[0]);n.currentGroup=a,M3(n,u,l,c,f,2)}}return _t.getMesh(n)}function lhe(e,t,r,n){var a=uhe(t,r,n&&n.geometry),i=R3(t),o=function(s){return d1(t.locis[s])};return Rr.create(i,t,a,function(){return r.color},function(){return 1},o)}function che(e,t){var r=or.createMulti("Orientation",e,t,or.StateBuilder,Ik);return r.setState({markerActions:Ii.Highlighting}),r}var dhe={radius:1,segments:36,thetaStart:0,thetaLength:Math.PI*2};function Mk(e){var t=w(w({},dhe),e),r=t.radius,n=t.segments,a=t.thetaStart,i=t.thetaLength,o=i===Math.PI*2,s=o?n+1:n+2,u=new Float32Array(s*3),l=new Float32Array(s*3),c=new Uint32Array(n*3);u[0]=0,u[1]=0,u[2]=0,l[0]=0,l[1]=1,l[2]=0;for(var d=0,f=3;d<n;++d,f+=3){var p=a+d/n*i;u[f]=r*Math.sin(p),u[f+1]=0,u[f+2]=r*Math.cos(p),l[f]=0,l[f+1]=1,l[f+2]=0}for(var d=1,f=0;d<n;++d,f+=3)c[f]=d,c[f+1]=d+1,c[f+2]=0;if(o){var h=(n-1)*3;c[h]=n,c[h+1]=1,c[h+2]=0}else{var p=a+i,f=(n+1)*3;u[f]=r*Math.sin(p),u[f+1]=0,u[f+2]=r*Math.cos(p),l[f]=0,l[f+1]=1,l[f+2]=0;var h=(n-1)*3;c[h]=n,c[h+1]=n+1,c[h+2]=0}return{vertices:u,normals:l,indices:c}}var Dk={color:E.Color(dr.lightgreen),arcScale:E.Numeric(.7,{min:.01,max:1,step:.01})},Rk=w(w(w({},mn.Params),Dk),{lineSizeAttenuation:E.Boolean(!0),linesSize:E.Numeric(.04,{min:.01,max:5,step:.01}),dashLength:E.Numeric(.04,{min:.01,max:.2,step:.01})}),fhe=w({},Rk),phe=w({},Rk),hhe=w(w(w({},Lt.Params),Dk),{ignoreLight:E.Boolean(!0),sectorOpacity:E.Numeric(.75,{min:0,max:1,step:.01})}),Ok={vectors:function(e,t){return sa(ghe,mn.Utils,{modifyState:function(r){return w(w({},r),{pickable:!1})}})},arc:function(e,t){return sa(bhe,mn.Utils,{modifyState:function(r){return w(w({},r),{pickable:!1})}})},sector:function(e,t){return sa(xhe,Lt.Utils,{modifyProps:function(r){return w(w({},r),{alpha:r.sectorOpacity})},modifyState:function(r){return w(w({},r),{markerActions:Ii.Highlighting})}})},text:function(e,t){return sa(_he,Do.Utils,{modifyState:function(r){return w(w({},r),{markerActions:tr.None})}})}},F5=w(w(w(w(w({},fhe),phe),hhe),c1),{visuals:E.MultiSelect(["vectors","sector","text"],E.objectToOptions(Ok))});function vhe(){return{sphereA:Ne(),sphereB:Ne(),sphereC:Ne(),arcDirA:C(),arcDirC:C(),arcNormal:C(),radius:0,angle:0}}var Pl=C(),rh=ue();function f1(e,t,r){var n=t.sphereA,a=t.sphereB,i=t.sphereC,o=t.arcDirA,s=t.arcDirC,u=t.arcNormal,l=e.loci,c=l[0],d=l[1],f=l[2];ir.getBoundingSphere(c,n),ir.getBoundingSphere(d,a),ir.getBoundingSphere(f,i),C.sub(o,n.center,a.center),C.sub(s,i.center,a.center),C.cross(u,o,s);var p=Math.min(C.magnitude(o),C.magnitude(s)),h=p*r;return t.radius=h,t.angle=C.angle(o,s),t}function Fk(e,t){var r=e.radius,n=e.angle,a=t?JD(n,r)/t:32;ue.targetTo(rh,e.sphereB.center,e.sphereA.center,e.arcNormal),ue.setTranslation(rh,e.sphereB.center),ue.mul(rh,rh,ue.rotY180);var i=Mk({radius:r,thetaLength:n,segments:a});return m3(i,rh)}var Ea=vhe();function p1(e){return e.triples.length===1?"Angle "+u1(e.triples[0],{measureOnly:!0}):e.triples.length+" Angles"}function mhe(e,t,r){for(var n=Zi.create(128,64,r),a=0,i=e.triples.length;a<i;++a)f1(e.triples[a],Ea,t.arcScale),n.addFixedLengthDashes(Ea.sphereB.center,Ea.sphereA.center,t.dashLength,a),n.addFixedLengthDashes(Ea.sphereB.center,Ea.sphereC.center,t.dashLength,a);return n.getLines()}function ghe(e,t,r,n){var a=mhe(t,r,n&&n.geometry),i=p1(t);return Rr.create(i,t,a,function(){return r.color},function(){return r.linesSize},function(){return""})}function yhe(e,t,r){for(var n=Zi.create(128,64,r),a=0,i=e.triples.length;a<i;++a){f1(e.triples[a],Ea,t.arcScale);for(var o=Fk(Ea,t.dashLength),s=o.indices,u=o.vertices,l=0,c=s.length;l<c;l+=3)if(l%2!==1){var d=s[l]*3,f=s[l+1]*3,p=u[d],h=u[d+1],v=u[d+2],m=u[f],g=u[f+1],y=u[f+2];n.add(p,h,v,m,g,y,a)}}return n.getLines()}function bhe(e,t,r,n){var a=yhe(t,r,n&&n.geometry),i=p1(t);return Rr.create(i,t,a,function(){return r.color},function(){return r.linesSize},function(){return""})}function She(e,t,r){for(var n=_t.createState(128,64,r),a=0,i=e.triples.length;a<i;++a){f1(e.triples[a],Ea,t.arcScale);var o=Fk(Ea);n.currentGroup=a,_t.addPrimitive(n,ue.id,o),_t.addPrimitiveFlipped(n,ue.id,o)}return _t.getMesh(n)}function xhe(e,t,r,n){var a=She(t,r,n&&n.geometry),i=p1(t),o=function(s){return u1(t.triples[s])};return Rr.create(i,t,a,function(){return r.color},function(){return 1},o)}function Che(e,t,r){for(var n=Xu.create(t,128,64,r),a=0,i=e.triples.length;a<i;++a){f1(e.triples[a],Ea,t.arcScale),C.add(Pl,Ea.arcDirA,Ea.arcDirC),C.setMagnitude(Pl,Pl,Ea.radius),C.add(Pl,Ea.sphereB.center,Pl);var o=Jo(Ea.angle).toFixed(2),s=t.customText||o+"\xB0",u=Math.max(2,Ea.sphereA.radius,Ea.sphereB.radius,Ea.sphereC.radius),l=u/2;n.add(s,Pl[0],Pl[1],Pl[2],.1,l,a)}return n.getText()}function _he(e,t,r,n){var a=Che(t,r,n&&n.geometry),i=p1(t),o=function(s){return u1(t.triples[s])};return Rr.create(i,t,a,function(){return r.textColor},function(){return r.textSize},o)}function whe(e,t){return or.createMulti("Angle",e,t,or.StateBuilder,Ok)}var kk={color:E.Color(dr.lightgreen),arcScale:E.Numeric(.7,{min:.01,max:1,step:.01})},h1=w(w(w({},mn.Params),kk),{lineSizeAttenuation:E.Boolean(!0),linesSize:E.Numeric(.04,{min:.01,max:5,step:.01}),dashLength:E.Numeric(.04,{min:.01,max:.2,step:.01})}),Ahe=w({},h1),Phe=w({},h1),The=w({},h1),Ehe=w({},h1),Ihe=w(w(w({},Lt.Params),kk),{ignoreLight:E.Boolean(!0),sectorOpacity:E.Numeric(.75,{min:0,max:1,step:.01})}),Bk={vectors:function(e,t){return sa(Rhe,mn.Utils,{modifyState:function(r){return w(w({},r),{pickable:!1})}})},extenders:function(e,t){return sa(Nhe,mn.Utils,{modifyState:function(r){return w(w({},r),{pickable:!1})}})},connector:function(e,t){return sa(Fhe,mn.Utils,{modifyState:function(r){return w(w({},r),{pickable:!1})}})},arms:function(e,t){return sa(Bhe,mn.Utils,{modifyState:function(r){return w(w({},r),{pickable:!1})}})},arc:function(e,t){return sa(zhe,mn.Utils,{modifyState:function(r){return w(w({},r),{pickable:!1})}})},sector:function(e,t){return sa(Hhe,Lt.Utils,{modifyProps:function(r){return w(w({},r),{alpha:r.sectorOpacity})},modifyState:function(r){return w(w({},r),{markerActions:Ii.Highlighting})}})},text:function(e,t){return sa(qhe,Do.Utils,{modifyState:function(r){return w(w({},r),{markerActions:tr.None})}})}},k5=w(w(w(w(w(w(w({},Ahe),Phe),The),Ehe),Ihe),c1),{visuals:E.MultiSelect(["extenders","arms","sector","text"],E.objectToOptions(Bk))});function Mhe(){return{sphereA:Ne(),sphereB:Ne(),sphereC:Ne(),sphereD:Ne(),dirBA:C(),dirCD:C(),projA:C(),projD:C(),arcPointA:C(),arcPointD:C(),arcDirA:C(),arcDirD:C(),arcCenter:C(),arcNormal:C(),radius:0,angle:0}}var ja=C(),nh=ue();function Zd(e,t,r){var n=t.sphereA,a=t.sphereB,i=t.sphereC,o=t.sphereD,s=t.dirBA,u=t.dirCD,l=t.projA,c=t.projD,d=t.arcPointA,f=t.arcPointD,p=t.arcDirA,h=t.arcDirD,v=t.arcCenter,m=t.arcNormal,g=e.loci,y=g[0],b=g[1],x=g[2],S=g[3];ir.getBoundingSphere(y,n),ir.getBoundingSphere(b,a),ir.getBoundingSphere(x,i),ir.getBoundingSphere(S,o),C.add(v,a.center,i.center),C.scale(v,v,.5),C.sub(s,n.center,a.center),C.sub(u,o.center,i.center),C.add(d,v,s),C.add(f,v,u),C.sub(m,i.center,a.center),C.orthogonalize(p,m,s),C.orthogonalize(h,m,u),C.projectPointOnVector(l,d,p,v),C.projectPointOnVector(c,f,h,v);var _=Math.min(C.distance(l,v),C.distance(c,v)),A=_*r;C.setMagnitude(p,p,A),C.setMagnitude(h,h,A),C.add(d,v,p),C.add(f,v,h),t.radius=A,t.angle=C.dihedralAngle(n.center,a.center,i.center,o.center),C.matchDirection(ja,m,C.sub(ja,d,n.center));var T=C.angle(s,ja),I=A/Math.cos(T-Nh);C.add(l,a.center,C.setMagnitude(ja,s,I)),C.matchDirection(ja,m,C.sub(ja,f,o.center));var M=C.angle(u,ja),O=A/Math.cos(M-Nh);return C.add(c,i.center,C.setMagnitude(ja,u,O)),t}function Lk(e,t){var r=e.radius,n=e.angle,a=t?JD(n,r)/t:32;ue.targetTo(nh,e.arcCenter,n<0?e.arcPointD:e.arcPointA,e.arcNormal),ue.setTranslation(nh,e.arcCenter),ue.mul(nh,nh,ue.rotY180);var i=Mk({radius:r,thetaLength:Math.abs(n),segments:a});return m3(i,nh)}var an=Mhe();function Jd(e){return e.quads.length===1?"Dihedral "+l1(e.quads[0],{measureOnly:!0}):e.quads.length+" Dihedrals"}function Dhe(e,t,r){for(var n=Zi.create(128,64,r),a=0,i=e.quads.length;a<i;++a)Zd(e.quads[a],an,t.arcScale),n.addFixedLengthDashes(an.arcCenter,an.arcPointA,t.dashLength,a),n.addFixedLengthDashes(an.arcCenter,an.arcPointD,t.dashLength,a);return n.getLines()}function Rhe(e,t,r,n){var a=Dhe(t,r,n&&n.geometry),i=Jd(t);return Rr.create(i,t,a,function(){return r.color},function(){return r.linesSize},function(){return""})}function Ohe(e,t,r){for(var n=Zi.create(128,64,r),a=0,i=e.quads.length;a<i;++a)Zd(e.quads[a],an,t.arcScale),n.addFixedLengthDashes(an.sphereB.center,an.sphereC.center,t.dashLength,a);return n.getLines()}function Fhe(e,t,r,n){var a=Ohe(t,r,n&&n.geometry),i=Jd(t);return Rr.create(i,t,a,function(){return r.color},function(){return r.linesSize},function(){return""})}function khe(e,t,r){for(var n=Zi.create(128,64,r),a=0,i=e.quads.length;a<i;++a)Zd(e.quads[a],an,t.arcScale),n.addFixedLengthDashes(an.sphereB.center,an.sphereA.center,t.dashLength,a),n.addFixedLengthDashes(an.sphereC.center,an.sphereD.center,t.dashLength,a);return n.getLines()}function Bhe(e,t,r,n){var a=khe(t,r,n&&n.geometry),i=Jd(t);return Rr.create(i,t,a,function(){return r.color},function(){return r.linesSize},function(){return""})}function Lhe(e,t,r){for(var n=Zi.create(128,64,r),a=0,i=e.quads.length;a<i;++a)Zd(e.quads[a],an,t.arcScale),n.addFixedLengthDashes(an.arcPointA,an.projA,t.dashLength,a),n.addFixedLengthDashes(an.arcPointD,an.projD,t.dashLength,a);return n.getLines()}function Nhe(e,t,r,n){var a=Lhe(t,r,n&&n.geometry),i=Jd(t);return Rr.create(i,t,a,function(){return r.color},function(){return r.linesSize},function(){return""})}function Uhe(e,t,r){for(var n=Zi.create(128,64,r),a=0,i=e.quads.length;a<i;++a){Zd(e.quads[a],an,t.arcScale);for(var o=Lk(an,t.dashLength),s=o.indices,u=o.vertices,l=0,c=s.length;l<c;l+=3)if(l%2!==1){var d=s[l]*3,f=s[l+1]*3,p=u[d],h=u[d+1],v=u[d+2],m=u[f],g=u[f+1],y=u[f+2];n.add(p,h,v,m,g,y,a)}}return n.getLines()}function zhe(e,t,r,n){var a=Uhe(t,r,n&&n.geometry),i=Jd(t);return Rr.create(i,t,a,function(){return r.color},function(){return r.linesSize},function(){return""})}function Vhe(e,t,r){for(var n=_t.createState(128,64,r),a=0,i=e.quads.length;a<i;++a){Zd(e.quads[a],an,t.arcScale);var o=Lk(an);n.currentGroup=a,_t.addPrimitive(n,ue.id,o),_t.addPrimitiveFlipped(n,ue.id,o)}return _t.getMesh(n)}function Hhe(e,t,r,n){var a=Vhe(t,r,n&&n.geometry),i=Jd(t),o=function(s){return l1(t.quads[s])};return Rr.create(i,t,a,function(){return r.color},function(){return 1},o)}function Ghe(e,t,r){for(var n=Xu.create(t,128,64,r),a=0,i=e.quads.length;a<i;++a){Zd(e.quads[a],an,t.arcScale),C.add(ja,an.arcDirA,an.arcDirD),C.setMagnitude(ja,ja,an.radius),C.add(ja,an.arcCenter,ja);var o=Jo(an.angle).toFixed(2);o==="-0.00"&&(o="0.00");var s=t.customText||o+"\xB0",u=Math.max(2,an.sphereA.radius,an.sphereB.radius,an.sphereC.radius,an.sphereD.radius),l=u/2;n.add(s,ja[0],ja[1],ja[2],.1,l,a)}return n.getText()}function qhe(e,t,r,n){var a=Ghe(t,r,n&&n.geometry),i=Jd(t),o=function(s){return l1(t.quads[s])};return Rr.create(i,t,a,function(){return r.textColor},function(){return r.textSize},o)}function jhe(e,t){return or.createMulti("Dihedral",e,t,or.StateBuilder,Bk)}var Whe=Ot.BuiltIn({name:"box-shape-3d",display:"Box Shape",from:ge.Root,to:ge.Shape.Provider,params:{bottomLeft:E.Vec3(C()),topRight:E.Vec3(C.create(1,1,1)),radius:E.Numeric(.15,{min:.01,max:4,step:.01}),color:E.Color(dr.red)}})({canAutoUpdate:function(){return!0},apply:function(e){var t=this,r=e.params;return We.create("Shape Representation",function(n){return ce(t,void 0,void 0,function(){return de(this,function(a){return[2,new ge.Shape.Provider({label:"Box",data:r,params:Lt.Params,getShape:function(i,o){var s=O3(Xt.create(r.bottomLeft,r.topRight),r.radius);return Rr.create("Box",o,s,function(){return o.color},function(){return 1},function(){return"Box"})},geometryUtils:Lt.Utils},{label:"Box"})]})})})}});function O3(e,t,r){var n=C.sub(C(),e.max,e.min),a=ue.fromTranslation(ue(),C.create(.5,.5,.5)),i=ue.fromScaling(ue(),n),o=ue.fromTranslation(ue(),e.min),s=ue.mul3(ue(),o,i,a),u=_t.createState(256,128,r);u.currentGroup=1,_t.addCage(u,s,BO(),t,2,20);var l=_t.getMesh(u),c=C.scaleAndAdd(C(),e.min,n,.5),d=C.distance(e.min,c);return l.setBoundingSphere(Ne.create(c,d)),l}var Xhe=Object.freeze(Object.defineProperty({__proto__:null,BoxShape3D:Whe,getBoxMesh:O3},Symbol.toStringTag,{value:"Module"})),kg=Ot.BuiltIn({name:"structure-representation-3d",display:"3D Representation",from:ge.Molecule.Structure,to:ge.Molecule.Structure.Representation3D,params:function(e,t){var r=t.representation.structure,n=r.registry,a=r.themes,i=n.get(n.default.name);if(!e){var o={help:function(l){var c=l.name,d=l.params,f=a.colorThemeRegistry.get(c),p=f.factory({},d);return{description:p.description,legend:p.legend}}};return{type:E.Mapped(n.default.name,n.types,function(l){return E.Group(n.get(l).getParams(a,Xe.Empty))}),colorTheme:E.Mapped(i.defaultColorTheme.name,a.colorThemeRegistry.types,function(l){return E.Group(a.colorThemeRegistry.get(l).getParams({structure:Xe.Empty}))},o),sizeTheme:E.Mapped(i.defaultSizeTheme.name,a.sizeThemeRegistry.types,function(l){return E.Group(a.sizeThemeRegistry.get(l).getParams({structure:Xe.Empty}))})}}var s={structure:e.data},u={help:function(l){var c=l.name,d=l.params,f=a.colorThemeRegistry.get(c),p=f.factory(s,d);return{description:p.description,legend:p.legend}}};return{type:E.Mapped(n.default.name,n.getApplicableTypes(e.data),function(l){return E.Group(n.get(l).getParams(a,e.data))}),colorTheme:E.Mapped(i.defaultColorTheme.name,a.colorThemeRegistry.getApplicableTypes(s),function(l){return E.Group(a.colorThemeRegistry.get(l).getParams(s))},u),sizeTheme:E.Mapped(i.defaultSizeTheme.name,a.sizeThemeRegistry.types,function(l){return E.Group(a.sizeThemeRegistry.get(l).getParams(s))})}}})({canAutoUpdate:function(e){var t=e.a,r=e.oldParams,n=e.newParams;return t.data.elementCount<1e4||r.type.name===n.type.name&&n.type.params.quality!=="custom"},apply:function(e,t){var r=this,n=e.a,a=e.params;return e.cache,We.create("Structure Representation",function(i){return ce(r,void 0,void 0,function(){var o,s,u,l,c,d,f;return de(this,function(p){switch(p.label){case 0:return o={runtime:i,assetManager:t.managers.asset},s=t.representation.structure.registry.get(a.type.name),u=((d=s.getData)===null||d===void 0?void 0:d.call(s,n.data,a.type.params))||n.data,s.ensureCustomProperties?[4,s.ensureCustomProperties.attach(o,u)]:[3,2];case 1:p.sent(),p.label=2;case 2:return l=s.factory(w({webgl:(f=t.canvas3d)===null||f===void 0?void 0:f.webgl},t.representation.structure.themes),s.getParams),[4,Yn.ensureDependencies(o,t.representation.structure.themes,{structure:u},a)];case 3:return p.sent(),l.setTheme(Yn.create(t.representation.structure.themes,{structure:u},a)),c=a.type.params||{},[4,l.createOrUpdate(c,u).runInContext(i)];case 4:return p.sent(),[2,new ge.Molecule.Structure.Representation3D({repr:l,sourceData:n.data},{label:s.label})]}})})})},update:function(e,t){var r=this,n=e.a,a=e.b,i=e.oldParams,o=e.newParams;return e.cache,We.create("Structure Representation",function(s){return ce(r,void 0,void 0,function(){var u,l,c,d,f,p;return de(this,function(h){switch(h.label){case 0:return o.type.name!==i.type.name?[2,ft.UpdateResult.Recreate]:(u=t.representation.structure.registry.get(o.type.name),!((f=u.mustRecreate)===null||f===void 0)&&f.call(u,i.type.params,o.type.params)?[2,ft.UpdateResult.Recreate]:(l=((p=u.getData)===null||p===void 0?void 0:p.call(u,n.data,o.type.params))||n.data,c={runtime:s,assetManager:t.managers.asset},u.ensureCustomProperties?[4,u.ensureCustomProperties.attach(c,l)]:[3,2]));case 1:h.sent(),h.label=2;case 2:return Yn.releaseDependencies(t.representation.structure.themes,{structure:a.data.sourceData},i),[4,Yn.ensureDependencies(c,t.representation.structure.themes,{structure:l},o)];case 3:return h.sent(),a.data.repr.setTheme(Yn.create(t.representation.structure.themes,{structure:l},o)),d=w(w({},a.data.repr.props),o.type.params),[4,a.data.repr.createOrUpdate(d,l).runInContext(s)];case 4:return h.sent(),a.data.sourceData=n.data,[2,ft.UpdateResult.Updated]}})})})},dispose:function(e,t){var r=e.b,n=e.params;if(!(!r||!n)){var a=r.data.sourceData,i=t.representation.structure.registry.get(n.type.name);i.ensureCustomProperties&&i.ensureCustomProperties.detach(a),Yn.releaseDependencies(t.representation.structure.themes,{structure:a},n)}},interpolate:function(e,t,r){if(e.colorTheme.name!=="uniform"||t.colorTheme.name!=="uniform")return r<=.5?e:t;var n=e.colorTheme.params.value,a=t.colorTheme.params.value,i=it.interpolate(n,a,r);return{type:r<=.5?e.type:t.type,colorTheme:{name:"uniform",params:{value:i}},sizeTheme:r<=.5?e.sizeTheme:t.sizeTheme}}}),Yhe=Ot.BuiltIn({name:"unwind-structure-assembly-representation-3d",display:"Unwind Assembly 3D Representation",from:ge.Molecule.Structure.Representation3D,to:ge.Molecule.Structure.Representation3DState,params:{t:E.Numeric(0,{min:0,max:1,step:.01})}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,r=e.params,n=t.data.sourceData,a=new yp(n);return p5(n,a,r.t),new ge.Molecule.Structure.Representation3DState({state:{unitTransforms:a},initialState:{unitTransforms:new yp(n)},info:n,repr:t.data.repr},{label:"Unwind T = "+r.t.toFixed(2)})},update:function(e){var t=e.a,r=e.b,n=e.newParams,a=e.oldParams,i=r.data.info;if(t.data.sourceData!==i||t.data.repr!==r.data.repr)return ft.UpdateResult.Recreate;if(a.t===n.t)return ft.UpdateResult.Unchanged;var o=r.data.state.unitTransforms;return p5(i,o,n.t),r.label="Unwind T = "+n.t.toFixed(2),r.data.repr=t.data.repr,ft.UpdateResult.Updated}}),Khe=Ot.BuiltIn({name:"explode-structure-representation-3d",display:"Explode 3D Representation",from:ge.Molecule.Structure.Representation3D,to:ge.Molecule.Structure.Representation3DState,params:{t:E.Numeric(0,{min:0,max:1,step:.01})}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,r=e.params,n=t.data.sourceData,a=new yp(n.root);return v5(n,a,r.t),new ge.Molecule.Structure.Representation3DState({state:{unitTransforms:a},initialState:{unitTransforms:new yp(n.root)},info:n.root,repr:t.data.repr},{label:"Explode T = "+r.t.toFixed(2)})},update:function(e){var t=e.a,r=e.b,n=e.newParams,a=e.oldParams,i=t.data.sourceData;if(r.data.info!==i.root||t.data.repr!==r.data.repr)return ft.UpdateResult.Recreate;if(a.t===n.t)return ft.UpdateResult.Unchanged;var o=r.data.state.unitTransforms;return v5(i.root,o,n.t),r.label="Explode T = "+n.t.toFixed(2),r.data.repr=t.data.repr,ft.UpdateResult.Updated}}),$he=Ot.BuiltIn({name:"spin-structure-representation-3d",display:"Spin 3D Representation",from:ge.Molecule.Structure.Representation3D,to:ge.Molecule.Structure.Representation3DState,params:w({t:E.Numeric(0,{min:0,max:1,step:.01})},mpe)})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,r=e.params,n=t.data.sourceData,a=new yp(n.root),i=m5(n.root,r),o=i.axis,s=i.origin;return b5(n,a,r.t,o,s),new ge.Molecule.Structure.Representation3DState({state:{unitTransforms:a},initialState:{unitTransforms:new yp(n.root)},info:n.root,repr:t.data.repr},{label:"Spin T = "+r.t.toFixed(2)})},update:function(e){var t=e.a,r=e.b,n=e.newParams,a=e.oldParams,i=t.data.sourceData;if(r.data.info!==i.root||t.data.repr!==r.data.repr)return ft.UpdateResult.Recreate;if(a.t===n.t&&a.axis===n.axis&&a.origin===n.origin)return ft.UpdateResult.Unchanged;var o=r.data.state.unitTransforms,s=m5(i.root,n),u=s.axis,l=s.origin;return b5(i.root,o,n.t,u,l),r.label="Spin T = "+n.t.toFixed(2),r.data.repr=t.data.repr,ft.UpdateResult.Updated}}),Qhe=Ot.BuiltIn({name:"overpaint-structure-representation-3d-from-script",display:"Overpaint 3D Representation",from:ge.Molecule.Structure.Representation3D,to:ge.Molecule.Structure.Representation3DState,params:function(){return{layers:E.ObjectList({script:E.Script(pa("(sel.atom.all)","mol-script")),color:E.Color(dr.blueviolet),clear:E.Boolean(!1)},function(e){return""+(e.clear?"Clear":it.toRgbString(e.color))},{defaultValue:[{script:pa("(sel.atom.all)","mol-script"),color:dr.blueviolet,clear:!1}]})}}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,r=e.params,n=t.data.sourceData,a=va.ofScript(r.layers,n);return new ge.Molecule.Structure.Representation3DState({state:{overpaint:a},initialState:{overpaint:va.Empty},info:n,repr:t.data.repr},{label:"Overpaint ("+a.layers.length+" Layers)"})},update:function(e){var t=e.a,r=e.b,n=e.newParams;e.oldParams;var a=r.data.info,i=t.data.sourceData;if(i!==a||t.data.repr!==r.data.repr)return ft.UpdateResult.Recreate;var o=r.data.state.overpaint,s=va.ofScript(n.layers,i);return va.areEqual(o,s)?ft.UpdateResult.Unchanged:(r.data.state.overpaint=s,r.data.repr=t.data.repr,r.label="Overpaint ("+s.layers.length+" Layers)",ft.UpdateResult.Updated)}}),Zhe=Ot.BuiltIn({name:"overpaint-structure-representation-3d-from-bundle",display:"Overpaint 3D Representation",from:ge.Molecule.Structure.Representation3D,to:ge.Molecule.Structure.Representation3DState,params:function(){return{layers:E.ObjectList({bundle:E.Value(Qr.Empty),color:E.Color(dr.blueviolet),clear:E.Boolean(!1)},function(e){return""+(e.clear?"Clear":it.toRgbString(e.color))},{defaultValue:[{bundle:Qr.Empty,color:dr.blueviolet,clear:!1}],isHidden:!0})}}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,r=e.params,n=t.data.sourceData,a=va.ofBundle(r.layers,n);return new ge.Molecule.Structure.Representation3DState({state:{overpaint:a},initialState:{overpaint:va.Empty},info:n,repr:t.data.repr},{label:"Overpaint ("+a.layers.length+" Layers)"})},update:function(e){var t=e.a,r=e.b,n=e.newParams;e.oldParams;var a=r.data.info,i=t.data.sourceData;if(i!==a||t.data.repr!==r.data.repr)return ft.UpdateResult.Recreate;var o=r.data.state.overpaint,s=va.ofBundle(n.layers,i);return va.areEqual(o,s)?ft.UpdateResult.Unchanged:(r.data.state.overpaint=s,r.data.repr=t.data.repr,r.label="Overpaint ("+s.layers.length+" Layers)",ft.UpdateResult.Updated)}}),Jhe=Ot.BuiltIn({name:"transparency-structure-representation-3d-from-script",display:"Transparency 3D Representation",from:ge.Molecule.Structure.Representation3D,to:ge.Molecule.Structure.Representation3DState,params:function(){return{layers:E.ObjectList({script:E.Script(pa("(sel.atom.all)","mol-script")),value:E.Numeric(.5,{min:0,max:1,step:.01},{label:"Transparency"})},function(e){return"Transparency ("+e.value+")"},{defaultValue:[{script:pa("(sel.atom.all)","mol-script"),value:.5}]})}}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,r=e.params,n=t.data.sourceData,a=ma.ofScript(r.layers,n);return new ge.Molecule.Structure.Representation3DState({state:{transparency:a},initialState:{transparency:ma.Empty},info:n,repr:t.data.repr},{label:"Transparency ("+a.layers.length+" Layers)"})},update:function(e){var t=e.a,r=e.b,n=e.newParams;e.oldParams;var a=r.data.info;if(t.data.sourceData!==a||t.data.repr!==r.data.repr)return ft.UpdateResult.Recreate;var i=r.data.state.transparency,o=ma.ofScript(n.layers,a);return ma.areEqual(i,o)?ft.UpdateResult.Unchanged:(r.data.state.transparency=o,r.data.repr=t.data.repr,r.label="Transparency ("+o.layers.length+" Layers)",ft.UpdateResult.Updated)}}),eve=Ot.BuiltIn({name:"transparency-structure-representation-3d-from-bundle",display:"Transparency 3D Representation",from:ge.Molecule.Structure.Representation3D,to:ge.Molecule.Structure.Representation3DState,params:function(){return{layers:E.ObjectList({bundle:E.Value(Qr.Empty),value:E.Numeric(.5,{min:0,max:1,step:.01},{label:"Transparency"})},function(e){return"Transparency ("+e.value+")"},{defaultValue:[{bundle:Qr.Empty,value:.5}],isHidden:!0})}}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,r=e.params,n=t.data.sourceData,a=ma.ofBundle(r.layers,n);return new ge.Molecule.Structure.Representation3DState({state:{transparency:a},initialState:{transparency:ma.Empty},info:n,repr:t.data.repr},{label:"Transparency ("+a.layers.length+" Layers)"})},update:function(e){var t=e.a,r=e.b,n=e.newParams;e.oldParams;var a=r.data.info;if(t.data.sourceData!==a||t.data.repr!==r.data.repr)return ft.UpdateResult.Recreate;var i=r.data.state.transparency,o=ma.ofBundle(n.layers,a);return ma.areEqual(i,o)?ft.UpdateResult.Unchanged:(r.data.state.transparency=o,r.data.repr=t.data.repr,r.label="Transparency ("+o.layers.length+" Layers)",ft.UpdateResult.Updated)}}),tve=Ot.BuiltIn({name:"clipping-structure-representation-3d-from-script",display:"Clipping 3D Representation",from:ge.Molecule.Structure.Representation3D,to:ge.Molecule.Structure.Representation3DState,params:function(){return{layers:E.ObjectList({script:E.Script(pa("(sel.atom.all)","mol-script")),groups:E.Converted(function(e){return en.Groups.toNames(e)},function(e){return en.Groups.fromNames(e)},E.MultiSelect(a1(en.Groups.Names),E.objectToOptions(en.Groups.Names)))},function(e){return en.Groups.toNames(e.groups).length+" group(s)"},{defaultValue:[{script:pa("(sel.atom.all)","mol-script"),groups:0}]})}}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,r=e.params,n=t.data.sourceData,a=en.ofScript(r.layers,n);return new ge.Molecule.Structure.Representation3DState({state:{clipping:a},initialState:{clipping:en.Empty},info:n,repr:t.data.repr},{label:"Clipping ("+a.layers.length+" Layers)"})},update:function(e){var t=e.a,r=e.b,n=e.newParams;e.oldParams;var a=r.data.info;if(t.data.sourceData!==a||t.data.repr!==r.data.repr)return ft.UpdateResult.Recreate;var i=r.data.state.clipping,o=en.ofScript(n.layers,a);return en.areEqual(i,o)?ft.UpdateResult.Unchanged:(r.data.state.clipping=o,r.data.repr=t.data.repr,r.label="Clipping ("+o.layers.length+" Layers)",ft.UpdateResult.Updated)}}),rve=Ot.BuiltIn({name:"clipping-structure-representation-3d-from-bundle",display:"Clipping 3D Representation",from:ge.Molecule.Structure.Representation3D,to:ge.Molecule.Structure.Representation3DState,params:function(){return{layers:E.ObjectList({bundle:E.Value(Qr.Empty),groups:E.Converted(function(e){return en.Groups.toNames(e)},function(e){return en.Groups.fromNames(e)},E.MultiSelect(a1(en.Groups.Names),E.objectToOptions(en.Groups.Names)))},function(e){return en.Groups.toNames(e.groups).length+" group(s)"},{defaultValue:[{bundle:Qr.Empty,groups:0}],isHidden:!0})}}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,r=e.params,n=t.data.sourceData,a=en.ofBundle(r.layers,n);return new ge.Molecule.Structure.Representation3DState({state:{clipping:a},initialState:{clipping:en.Empty},info:n,repr:t.data.repr},{label:"Clipping ("+a.layers.length+" Layers)"})},update:function(e){var t=e.a,r=e.b,n=e.newParams;e.oldParams;var a=r.data.info;if(t.data.sourceData!==a||t.data.repr!==r.data.repr)return ft.UpdateResult.Recreate;var i=r.data.state.clipping,o=en.ofBundle(n.layers,a);return en.areEqual(i,o)?ft.UpdateResult.Unchanged:(r.data.state.clipping=o,r.data.repr=t.data.repr,r.label="Clipping ("+o.layers.length+" Layers)",ft.UpdateResult.Updated)}}),Ou;(function(e){function t(a,i,o,s){var u=a.representation.volume.registry.get(i),l={volume:o},c=a.representation.volume.themes.colorThemeRegistry.get(u.defaultColorTheme.name).getParams(l),d=a.representation.volume.themes.sizeThemeRegistry.get(u.defaultSizeTheme.name).getParams(l),f=E.getDefaultValues(u.getParams(a.representation.volume.themes,o));return{type:{name:i,params:s?w(w({},f),s):f},colorTheme:{name:u.defaultColorTheme.name,params:E.getDefaultValues(c)},sizeTheme:{name:u.defaultSizeTheme.name,params:E.getDefaultValues(d)}}}e.getDefaultParams=t;function r(a,i,o,s,u,l,c){var d=a.representation.volume.registry.get(i),f=a.representation.volume.themes.colorThemeRegistry.get(s||d.defaultColorTheme.name),p=a.representation.volume.themes.sizeThemeRegistry.get(l||d.defaultSizeTheme.name);return{type:{name:i,params:o?w(w({},d.defaultValues),o):d.defaultValues},colorTheme:{name:d.defaultColorTheme.name,params:u?w(w({},f.defaultValues),u):f.defaultValues},sizeTheme:{name:d.defaultSizeTheme.name,params:c?w(w({},p.defaultValues),c):p.defaultValues}}}e.getDefaultParamsStatic=r;function n(a){var i,o,s,u;if(a.isoValue)return Ct.IsoValue.toString(a.isoValue);if(!((o=(i=a.renderMode)===null||i===void 0?void 0:i.params)===null||o===void 0)&&o.isoValue)return Ct.IsoValue.toString((u=(s=a.renderMode)===null||s===void 0?void 0:s.params)===null||u===void 0?void 0:u.isoValue)}e.getDescription=n})(Ou||(Ou={}));var nve=Ot.BuiltIn({name:"volume-representation-3d",display:"3D Representation",from:ge.Volume.Data,to:ge.Volume.Representation3D,params:function(e,t){var r=t.representation.volume,n=r.registry,a=r.themes,i=n.get(n.default.name);if(!e)return{type:E.Mapped(n.default.name,n.types,function(s){return E.Group(n.get(s).getParams(a,Ct.One))}),colorTheme:E.Mapped(i.defaultColorTheme.name,a.colorThemeRegistry.types,function(s){return E.Group(a.colorThemeRegistry.get(s).getParams({volume:Ct.One}))}),sizeTheme:E.Mapped(i.defaultSizeTheme.name,a.sizeThemeRegistry.types,function(s){return E.Group(a.sizeThemeRegistry.get(s).getParams({volume:Ct.One}))})};var o={volume:e.data};return{type:E.Mapped(n.default.name,n.types,function(s){return E.Group(n.get(s).getParams(a,e.data))}),colorTheme:E.Mapped(i.defaultColorTheme.name,a.colorThemeRegistry.getApplicableTypes(o),function(s){return E.Group(a.colorThemeRegistry.get(s).getParams(o))}),sizeTheme:E.Mapped(i.defaultSizeTheme.name,a.sizeThemeRegistry.types,function(s){return E.Group(a.sizeThemeRegistry.get(s).getParams(o))})}}})({canAutoUpdate:function(e){var t=e.oldParams,r=e.newParams;return t.type.name===r.type.name},apply:function(e,t){var r=this,n=e.a,a=e.params;return We.create("Volume Representation",function(i){return ce(r,void 0,void 0,function(){var o,s,u,l,c;return de(this,function(d){switch(d.label){case 0:return o={runtime:i,assetManager:t.managers.asset},s=t.representation.volume.registry.get(a.type.name),s.ensureCustomProperties?[4,s.ensureCustomProperties.attach(o,n.data)]:[3,2];case 1:d.sent(),d.label=2;case 2:return u=s.factory(w({webgl:(c=t.canvas3d)===null||c===void 0?void 0:c.webgl},t.representation.volume.themes),s.getParams),u.setTheme(Yn.create(t.representation.volume.themes,{volume:n.data},a)),l=a.type.params||{},[4,u.createOrUpdate(l,n.data).runInContext(i)];case 3:return d.sent(),[2,new ge.Volume.Representation3D({repr:u,sourceData:n.data},{label:s.label,description:Ou.getDescription(l)})]}})})})},update:function(e,t){var r=this,n=e.a,a=e.b,i=e.oldParams,o=e.newParams;return We.create("Volume Representation",function(s){return ce(r,void 0,void 0,function(){var u,l,c;return de(this,function(d){switch(d.label){case 0:return o.type.name!==i.type.name?(u=t.representation.volume.registry.get(i.type.name),(c=u.ensureCustomProperties)===null||c===void 0||c.detach(n.data),[2,ft.UpdateResult.Recreate]):(l=w(w({},a.data.repr.props),o.type.params),a.data.repr.setTheme(Yn.create(t.representation.volume.themes,{volume:n.data},o)),[4,a.data.repr.createOrUpdate(l,n.data).runInContext(s)]);case 1:return d.sent(),a.data.sourceData=n.data,a.description=Ou.getDescription(l),[2,ft.UpdateResult.Updated]}})})})}}),ave=Ot.BuiltIn({name:"shape-representation-3d",display:"3D Representation",from:ge.Shape.Provider,to:ge.Shape.Representation3D,params:function(e,t){return e?e.data.params:At.Params}})({canAutoUpdate:function(){return!0},apply:function(e,t){var r=this,n=e.a,a=e.params;return We.create("Shape Representation",function(i){return ce(r,void 0,void 0,function(){var o,s;return de(this,function(u){switch(u.label){case 0:return o=w(w({},E.getDefaultValues(n.data.params)),a),s=sa(n.data.getShape,n.data.geometryUtils),[4,s.createOrUpdate(o,n.data.data).runInContext(i)];case 1:return u.sent(),[2,new ge.Shape.Representation3D({repr:s,sourceData:n.data},{label:n.data.label})]}})})})},update:function(e,t){var r=this,n=e.a,a=e.b;e.oldParams;var i=e.newParams;return We.create("Shape Representation",function(o){return ce(r,void 0,void 0,function(){var s;return de(this,function(u){switch(u.label){case 0:return s=w(w({},a.data.repr.props),i),[4,a.data.repr.createOrUpdate(s,n.data.data).runInContext(o)];case 1:return u.sent(),a.data.sourceData=n.data,[2,ft.UpdateResult.Updated]}})})})}}),ive=Ot.BuiltIn({name:"model-unitcell-3d",display:"Model Unit Cell",from:ge.Molecule.Model,to:ge.Shape.Representation3D,params:function(){return w({},x5)}})({isApplicable:function(e){return!!qn.Provider.get(e.data)},canAutoUpdate:function(e){return e.oldParams,e.newParams,!0},apply:function(e,t){var r=this,n=e.a,a=e.params;return We.create("Model Unit Cell",function(i){return ce(r,void 0,void 0,function(){var o,s,u,l;return de(this,function(c){switch(c.label){case 0:return o=qn.Provider.get(n.data),o?(s=C5(n.data,o,a),u=Ape(w({webgl:(l=t.canvas3d)===null||l===void 0?void 0:l.webgl},t.representation.structure.themes),function(){return x5}),[4,u.createOrUpdate(a,s).runInContext(i)]):[2,Cn.Null];case 1:return c.sent(),[2,new ge.Shape.Representation3D({repr:u,sourceData:s},{label:"Unit Cell",description:o.spacegroup.name})]}})})})},update:function(e){var t=this,r=e.a,n=e.b,a=e.newParams;return We.create("Model Unit Cell",function(i){return ce(t,void 0,void 0,function(){var o,s,u;return de(this,function(l){switch(l.label){case 0:return o=qn.Provider.get(r.data),o?(s=w(w({},n.data.repr.props),a),u=C5(r.data,o,s),[4,n.data.repr.createOrUpdate(s,u).runInContext(i)]):[2,ft.UpdateResult.Null];case 1:return l.sent(),n.data.sourceData=u,[2,ft.UpdateResult.Updated]}})})})}}),ove=Ot.BuiltIn({name:"structure-bounding-box-3d",display:"Bounding Box",from:ge.Molecule.Structure,to:ge.Shape.Representation3D,params:w({radius:E.Numeric(.05,{min:.01,max:4,step:.01},{isEssential:!0}),color:E.Color(dr.red,{isEssential:!0})},Lt.Params)})({canAutoUpdate:function(){return!0},apply:function(e,t){var r=this,n=e.a,a=e.params;return We.create("Bounding Box",function(i){return ce(r,void 0,void 0,function(){var o;return de(this,function(s){switch(s.label){case 0:return o=sa(function(u,l,c,d){var f=O3(l.box,l.radius,d==null?void 0:d.geometry);return Rr.create("Bouding Box",l,f,function(){return l.color},function(){return 1},function(){return"Bounding Box"})},Lt.Utils),[4,o.createOrUpdate(a,{box:n.data.boundary.box,radius:a.radius,color:a.color}).runInContext(i)];case 1:return s.sent(),[2,new ge.Shape.Representation3D({repr:o,sourceData:n.data},{label:"Bounding Box"})]}})})})},update:function(e,t){var r=this,n=e.a,a=e.b;e.oldParams;var i=e.newParams;return We.create("Bounding Box",function(o){return ce(r,void 0,void 0,function(){return de(this,function(s){switch(s.label){case 0:return[4,a.data.repr.createOrUpdate(i,{box:n.data.boundary.box,radius:i.radius,color:i.color}).runInContext(o)];case 1:return s.sent(),a.data.sourceData=n.data,[2,ft.UpdateResult.Updated]}})})})}}),sve=Ot.BuiltIn({name:"structure-selections-distance-3d",display:"3D Distance",from:ge.Molecule.Structure.Selections,to:ge.Shape.Representation3D,params:function(){return w({},w5)}})({canAutoUpdate:function(e){return e.oldParams,e.newParams,!0},apply:function(e,t){var r=this,n=e.a,a=e.params;return We.create("Structure Distance",function(i){return ce(r,void 0,void 0,function(){var o,s,u;return de(this,function(l){switch(l.label){case 0:return o=A5(n.data),s=Npe(w({webgl:(u=t.canvas3d)===null||u===void 0?void 0:u.webgl},t.representation.structure.themes),function(){return w5}),[4,s.createOrUpdate(a,o).runInContext(i)];case 1:return l.sent(),[2,new ge.Shape.Representation3D({repr:s,sourceData:o},{label:"Distance"})]}})})})},update:function(e,t){var r=this,n=e.a,a=e.b;e.oldParams;var i=e.newParams;return We.create("Structure Distance",function(o){return ce(r,void 0,void 0,function(){var s,u;return de(this,function(l){switch(l.label){case 0:return s=w(w({},a.data.repr.props),i),u=A5(n.data),[4,a.data.repr.createOrUpdate(s,u).runInContext(o)];case 1:return l.sent(),a.data.sourceData=u,[2,ft.UpdateResult.Updated]}})})})}}),uve=Ot.BuiltIn({name:"structure-selections-angle-3d",display:"3D Angle",from:ge.Molecule.Structure.Selections,to:ge.Shape.Representation3D,params:function(){return w({},F5)}})({canAutoUpdate:function(e){return e.oldParams,e.newParams,!0},apply:function(e,t){var r=this,n=e.a,a=e.params;return We.create("Structure Angle",function(i){return ce(r,void 0,void 0,function(){var o,s,u;return de(this,function(l){switch(l.label){case 0:return o=P5(n.data),s=whe(w({webgl:(u=t.canvas3d)===null||u===void 0?void 0:u.webgl},t.representation.structure.themes),function(){return F5}),[4,s.createOrUpdate(a,o).runInContext(i)];case 1:return l.sent(),[2,new ge.Shape.Representation3D({repr:s,sourceData:o},{label:"Angle"})]}})})})},update:function(e,t){var r=this,n=e.a,a=e.b;e.oldParams;var i=e.newParams;return We.create("Structure Angle",function(o){return ce(r,void 0,void 0,function(){var s,u;return de(this,function(l){switch(l.label){case 0:return s=w(w({},a.data.repr.props),i),u=P5(n.data),[4,a.data.repr.createOrUpdate(s,u).runInContext(o)];case 1:return l.sent(),a.data.sourceData=u,[2,ft.UpdateResult.Updated]}})})})}}),lve=Ot.BuiltIn({name:"structure-selections-dihedral-3d",display:"3D Dihedral",from:ge.Molecule.Structure.Selections,to:ge.Shape.Representation3D,params:function(){return w({},k5)}})({canAutoUpdate:function(e){return e.oldParams,e.newParams,!0},apply:function(e,t){var r=this,n=e.a,a=e.params;return We.create("Structure Dihedral",function(i){return ce(r,void 0,void 0,function(){var o,s,u;return de(this,function(l){switch(l.label){case 0:return o=T5(n.data),s=jhe(w({webgl:(u=t.canvas3d)===null||u===void 0?void 0:u.webgl},t.representation.structure.themes),function(){return k5}),[4,s.createOrUpdate(a,o).runInContext(i)];case 1:return l.sent(),[2,new ge.Shape.Representation3D({repr:s,sourceData:o},{label:"Dihedral"})]}})})})},update:function(e,t){var r=this,n=e.a,a=e.b;e.oldParams;var i=e.newParams;return We.create("Structure Dihedral",function(o){return ce(r,void 0,void 0,function(){var s,u;return de(this,function(l){switch(l.label){case 0:return s=w(w({},a.data.repr.props),i),u=T5(n.data),[4,a.data.repr.createOrUpdate(s,u).runInContext(o)];case 1:return l.sent(),a.data.sourceData=u,[2,ft.UpdateResult.Updated]}})})})}}),cve=Ot.BuiltIn({name:"structure-selections-label-3d",display:"3D Label",from:ge.Molecule.Structure.Selections,to:ge.Shape.Representation3D,params:function(){return w({},M5)}})({canAutoUpdate:function(e){return e.oldParams,e.newParams,!0},apply:function(e,t){var r=this,n=e.a,a=e.params;return We.create("Structure Label",function(i){return ce(r,void 0,void 0,function(){var o,s,u;return de(this,function(l){switch(l.label){case 0:return o=E5(n.data),s=qpe(w({webgl:(u=t.canvas3d)===null||u===void 0?void 0:u.webgl},t.representation.structure.themes),function(){return M5}),[4,s.createOrUpdate(a,o).runInContext(i)];case 1:return l.sent(),[2,new ge.Shape.Representation3D({repr:s,sourceData:o},{label:"Label"})]}})})})},update:function(e,t){var r=this,n=e.a,a=e.b;e.oldParams;var i=e.newParams;return We.create("Structure Label",function(o){return ce(r,void 0,void 0,function(){var s,u;return de(this,function(l){switch(l.label){case 0:return s=w(w({},a.data.repr.props),i),u=E5(n.data),[4,a.data.repr.createOrUpdate(s,u).runInContext(o)];case 1:return l.sent(),a.data.sourceData=u,[2,ft.UpdateResult.Updated]}})})})}}),dve=Ot.BuiltIn({name:"structure-selections-orientation-3d",display:"3D Orientation",from:ge.Molecule.Structure.Selections,to:ge.Shape.Representation3D,params:function(){return w({},O5)}})({canAutoUpdate:function(e){return e.oldParams,e.newParams,!0},apply:function(e,t){var r=this,n=e.a,a=e.params;return We.create("Structure Orientation",function(i){return ce(r,void 0,void 0,function(){var o,s,u;return de(this,function(l){switch(l.label){case 0:return o=I5(n.data),s=che(w({webgl:(u=t.canvas3d)===null||u===void 0?void 0:u.webgl},t.representation.structure.themes),function(){return O5}),[4,s.createOrUpdate(a,o).runInContext(i)];case 1:return l.sent(),[2,new ge.Shape.Representation3D({repr:s,sourceData:o},{label:"Orientation"})]}})})})},update:function(e,t){var r=this,n=e.a,a=e.b;e.oldParams;var i=e.newParams;return We.create("Structure Orientation",function(o){return ce(r,void 0,void 0,function(){var s,u;return de(this,function(l){switch(l.label){case 0:return s=w(w({},a.data.repr.props),i),u=I5(n.data),[4,a.data.repr.createOrUpdate(s,u).runInContext(o)];case 1:return l.sent(),a.data.sourceData=u,[2,ft.UpdateResult.Updated]}})})})}}),fve=Object.freeze(Object.defineProperty({__proto__:null,StructureRepresentation3D:kg,ExplodeStructureRepresentation3D:Khe,SpinStructureRepresentation3D:$he,UnwindStructureAssemblyRepresentation3D:Yhe,OverpaintStructureRepresentation3DFromScript:Qhe,OverpaintStructureRepresentation3DFromBundle:Zhe,TransparencyStructureRepresentation3DFromScript:Jhe,TransparencyStructureRepresentation3DFromBundle:eve,ClippingStructureRepresentation3DFromScript:tve,ClippingStructureRepresentation3DFromBundle:rve,VolumeRepresentation3D:nve,get VolumeRepresentation3DHelpers(){return Ou},ShapeRepresentation3D:ave,ModelUnitcell3D:ive,StructureBoundingBox3D:ove,StructureSelectionsDistance3D:sve,StructureSelectionsAngle3D:uve,StructureSelectionsDihedral3D:lve,StructureSelectionsLabel3D:cve,StructureSelectionsOrientation3D:dve},Symbol.toStringTag,{value:"Module"})),rt={Data:$ne,Misc:Zne,Model:dde,Volume:_de,Representation:fve,Shape:Xhe},pve={H:"Hydrogen",HE:"Helium",LI:"Lithium",BE:"Beryllium",B:"Boron",C:"Carbon",N:"Nitrogen",O:"Oxygen",F:"Fluorine",NE:"Neon",NA:"Sodium",MG:"Magnesium",AL:"Aluminum",SI:"Silicon",P:"Phosphorus",S:"Sulfur",CL:"Chlorine",AR:"Argon",K:"Potassium",CA:"Calcium",SC:"Scandium",TI:"Titanium",V:"Vanadium",CR:"Chromium",MN:"Manganese",FE:"Iron",CO:"Cobalt",NI:"Nickel",CU:"Copper",ZN:"Zinc",GA:"Gallium",GE:"Germanium",AS:"Arsenic",SE:"Selenium",BR:"Bromine",KR:"Krypton",RB:"Rubidium",SR:"Strontium",Y:"Yttrium",ZR:"Zirconium",NB:"Niobium",MO:"Molybdenum",TC:"Technetium",RU:"Ruthenium",RH:"Rhodium",PD:"Palladium",AG:"Silver",CD:"Cadmium",IN:"Indium",SN:"Tin",SB:"Antimony",TE:"Tellurium",I:"Iodine",XE:"Xenon",CS:"Cesium",BA:"Barium",LA:"Lanthanum",CE:"Cerium",PR:"Praseodymium",ND:"Neodymium",PM:"Promethium",SM:"Samarium",EU:"Europium",GD:"Gadolinium",TB:"Terbium",DY:"Dysprosium",HO:"Holmium",ER:"Erbium",TM:"Thulium",YB:"Ytterbium",LU:"Lutetium",HF:"Hafnium",TA:"Tantalum",W:"Wolfram",RE:"Rhenium",OS:"Osmium",IR:"Iridium",PT:"Platinum",AU:"Gold",HG:"Mercury",TL:"Thallium",PB:"Lead",BI:"Bismuth",PO:"Polonium",AT:"Astatine",RN:"Radon",FR:"Francium",RA:"Radium",AC:"Actinium",TH:"Thorium",PA:"Protactinium",U:"Uranium",NP:"Neptunium",PU:"Plutonium",AM:"Americium",CM:"Curium",BK:"Berkelium",CF:"Californium",ES:"Einsteinium",FM:"Fermium",MD:"Mendelevium",NO:"Nobelium",LR:"Lawrencium",RF:"Rutherfordium",DB:"Dubnium",SG:"Seaborgium",BH:"Bohrium",HS:"Hassium",MT:"Meitnerium",DS:"Darmstadtium",RG:"Roentgenium",CN:"Copernicium",NH:"Nihonium",FL:"Flerovium",MC:"Moscovium",LV:"Livermorium",TS:"Tennessine",OG:"Oganesson"},hve=new Set(["LI","NA","K","RB","CS","FR"]);function vve(e){return hve.has(e)}var mve=new Set(["BE","MG","CA","SR","BA","RA"]);function gve(e){return mve.has(e)}var yve=new Set(["ZN","GA","CD","IN","SN","HG","TI","PB","BI","PO","CN"]);function bve(e){return yve.has(e)}var Sve=new Set(["F","CL","BR","I","AT"]);function xve(e){return Sve.has(e)}function Nk(e){var t=Dv(e);return t>=21&&t<=29||t>=39&&t<=47||t>=72&&t<=79||t>=104&&t<=108}function Cve(e){var t=Dv(e);return t>=57&&t<=71}function _ve(e){var t=Dv(e);return t>=89&&t<=103}function wve(e){return vve(e)||gve(e)||Cve(e)||_ve(e)||Nk(e)||bve(e)}var Lr;(function(e){e.Type="Type",e.Structure="Structure Property",e.Atom="Atom Property",e.Bond="Bond Property",e.Residue="Residue Property",e.AminoAcid="Amino Acid",e.NucleicBase="Nucleic Base",e.Manipulate="Manipulate Selection",e.Validation="Validation",e.Misc="Miscellaneous",e.Internal="Internal"})(Lr||(Lr={}));function Nr(e,t,r){var n;r===void 0&&(r={});var a;return{label:e,expression:t,description:r.description||"",category:(n=r.category)!==null&&n!==void 0?n:Lr.Misc,isHidden:!!r.isHidden,priority:r.priority||0,referencesCurrent:!!r.referencesCurrent,get query(){return a||(a=Ld(t)),a},ensureCustomProperties:r.ensureCustomProperties,getSelection:function(i,o,s){return ce(this,void 0,void 0,function(){var u,l;return de(this,function(c){switch(c.label){case 0:return u=i.managers.structure.selection.getStructure(s),l=u?mt.Sequence(s,[u]):mt.Empty(s),r.ensureCustomProperties?[4,r.ensureCustomProperties({runtime:o,assetManager:i.managers.asset},s)]:[3,2];case 1:c.sent(),c.label=2;case 2:return a||(a=Ld(t)),[2,a(new Qi(s,{currentSelection:l}))]}})})}}}var Ave=Nr("All",se.struct.generator.all(),{category:"",priority:1e3}),Pve=Nr("Current Selection",se.internal.generator.current(),{category:"",referencesCurrent:!0}),Tve=Nr("Polymer",se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":se.core.logic.and([se.core.rel.eq([se.ammp("entityType"),"polymer"]),se.core.str.match([se.re("(polypeptide|cyclic-pseudo-peptide|peptide-like|nucleotide|peptide nucleic acid)","i"),se.ammp("entitySubtype")])])})]),{category:Lr.Type}),Eve=Nr("Trace",se.struct.modifier.union([se.struct.combinator.merge([se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":se.core.rel.eq([se.ammp("entityType"),"polymer"]),"chain-test":se.core.set.has([se.set("sphere","gaussian"),se.ammp("objectPrimitive")])})]),se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":se.core.rel.eq([se.ammp("entityType"),"polymer"]),"chain-test":se.core.rel.eq([se.ammp("objectPrimitive"),"atomistic"]),"atom-test":se.core.set.has([se.set("CA","P"),se.ammp("label_atom_id")])})])])]),{category:Lr.Structure}),Lp=se.core.logic.and([se.core.rel.eq([se.ammp("entityType"),"polymer"]),se.core.str.match([se.re("(polypeptide|cyclic-pseudo-peptide|peptide-like)","i"),se.ammp("entitySubtype")])]),v1=se.core.logic.and([se.core.rel.eq([se.ammp("entityType"),"polymer"]),se.core.str.match([se.re("(nucleotide|peptide nucleic acid)","i"),se.ammp("entitySubtype")])]),zd=se.core.str.match([se.re("non-polymer|(amino|carboxy) terminus|peptide-like","i"),se.ammp("chemCompType")]),Ive=Nr("Backbone",se.struct.modifier.union([se.struct.combinator.merge([se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":Lp,"chain-test":se.core.rel.eq([se.ammp("objectPrimitive"),"atomistic"]),"residue-test":se.core.logic.not([zd]),"atom-test":se.core.set.has([se.set.apply(se,jn.toArray(Hu)),se.ammp("label_atom_id")])})]),se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":v1,"chain-test":se.core.rel.eq([se.ammp("objectPrimitive"),"atomistic"]),"residue-test":se.core.logic.not([zd]),"atom-test":se.core.set.has([se.set.apply(se,jn.toArray(Uy)),se.ammp("label_atom_id")])})])])]),{category:Lr.Structure}),Mve=Nr("Sidechain",se.struct.modifier.union([se.struct.combinator.merge([se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":Lp,"chain-test":se.core.rel.eq([se.ammp("objectPrimitive"),"atomistic"]),"residue-test":se.core.logic.not([zd]),"atom-test":se.core.logic.or([se.core.logic.not([se.core.set.has([se.set.apply(se,jn.toArray(Hu)),se.ammp("label_atom_id")])])])})]),se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":v1,"chain-test":se.core.rel.eq([se.ammp("objectPrimitive"),"atomistic"]),"residue-test":se.core.logic.not([zd]),"atom-test":se.core.logic.or([se.core.logic.not([se.core.set.has([se.set.apply(se,jn.toArray(Uy)),se.ammp("label_atom_id")])])])})])])]),{category:Lr.Structure}),Dve=Nr("Sidechain with Trace",se.struct.modifier.union([se.struct.combinator.merge([se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":Lp,"chain-test":se.core.rel.eq([se.ammp("objectPrimitive"),"atomistic"]),"residue-test":se.core.logic.not([zd]),"atom-test":se.core.logic.or([se.core.logic.not([se.core.set.has([se.set.apply(se,jn.toArray(Hu)),se.ammp("label_atom_id")])]),se.core.rel.eq([se.ammp("label_atom_id"),"CA"]),se.core.logic.and([se.core.rel.eq([se.ammp("auth_comp_id"),"PRO"]),se.core.rel.eq([se.ammp("label_atom_id"),"N"])])])})]),se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":v1,"chain-test":se.core.rel.eq([se.ammp("objectPrimitive"),"atomistic"]),"residue-test":se.core.logic.not([zd]),"atom-test":se.core.logic.or([se.core.logic.not([se.core.set.has([se.set.apply(se,jn.toArray(Uy)),se.ammp("label_atom_id")])]),se.core.rel.eq([se.ammp("label_atom_id"),"P"])])})])])]),{category:Lr.Structure}),Rve=Nr("Protein",se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":Lp})]),{category:Lr.Type}),Ove=Nr("Nucleic",se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":v1})]),{category:Lr.Type}),Fve=Nr("Helix",se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":Lp,"residue-test":se.core.flags.hasAny([se.ammp("secondaryStructureFlags"),se.core.type.bitflags([2])])})]),{category:Lr.Structure}),kve=Nr("Beta Strand/Sheet",se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":Lp,"residue-test":se.core.flags.hasAny([se.ammp("secondaryStructureFlags"),se.core.type.bitflags([4])])})]),{category:Lr.Structure}),Bve=Nr("Water",se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":se.core.rel.eq([se.ammp("entityType"),"water"])})]),{category:Lr.Type}),Lve=Nr("Ion",se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":se.core.rel.eq([se.ammp("entitySubtype"),"ion"])})]),{category:Lr.Type}),Nve=Nr("Lipid",se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":se.core.rel.eq([se.ammp("entitySubtype"),"lipid"])})]),{category:Lr.Type}),m1=Nr("Carbohydrate",se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":se.core.logic.or([se.core.rel.eq([se.ammp("entityType"),"branched"]),se.core.logic.and([se.core.rel.eq([se.ammp("entityType"),"non-polymer"]),se.core.str.match([se.re("oligosaccharide","i"),se.ammp("entitySubtype")])])])})]),{category:Lr.Type}),Uk=Nr("Carbohydrate with Connected",se.struct.modifier.union([se.struct.modifier.includeConnected({0:m1.expression,"layer-count":1,"as-whole-residues":!0})]),{category:Lr.Internal,isHidden:!0}),zk=Nr("Connected to Carbohydrate",se.struct.modifier.union([se.struct.modifier.exceptBy({0:Uk.expression,by:m1.expression})]),{category:Lr.Internal,isHidden:!0}),F3=Nr("Ligand",se.struct.modifier.union([se.struct.combinator.merge([se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":se.core.logic.and([se.core.logic.or([se.core.rel.eq([se.ammp("entityType"),"non-polymer"]),se.core.rel.neq([se.ammp("entityPrdId"),""])]),se.core.logic.not([se.core.str.match([se.re("(oligosaccharide|lipid|ion)","i"),se.ammp("entitySubtype")])])]),"chain-test":se.core.rel.eq([se.ammp("objectPrimitive"),"atomistic"]),"residue-test":se.core.logic.not([se.core.str.match([se.re("saccharide","i"),se.ammp("chemCompType")])])})]),se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":se.core.rel.eq([se.ammp("entityType"),"polymer"]),"chain-test":se.core.rel.eq([se.ammp("objectPrimitive"),"atomistic"]),"residue-test":zd})])])]),{category:Lr.Type}),Vk=Nr("Ligand with Connected",se.struct.modifier.union([se.struct.modifier.exceptBy({0:se.struct.modifier.union([se.struct.modifier.includeConnected({0:F3.expression,"layer-count":1,"as-whole-residues":!0,"bond-test":se.core.flags.hasAny([se.struct.bondProperty.flags(),se.core.type.bitflags([3])])})]),by:m1.expression})]),{category:Lr.Internal,isHidden:!0}),Hk=Nr("Connected to Ligand",se.struct.modifier.union([se.struct.modifier.exceptBy({0:Vk.expression,by:F3.expression})]),{category:Lr.Internal,isHidden:!0}),Uve=Nr("Connected to Ligand or Carbohydrate",se.struct.modifier.union([se.struct.combinator.merge([zk.expression,Hk.expression])]),{category:Lr.Internal,isHidden:!0}),zve=Nr("Disulfide Bridges",se.struct.modifier.union([se.struct.combinator.merge([se.struct.modifier.union([se.struct.modifier.wholeResidues([se.struct.filter.isConnectedTo({0:se.struct.generator.atomGroups({"residue-test":se.core.set.has([se.set("CYS"),se.ammp("auth_comp_id")]),"atom-test":se.core.set.has([se.set("SG"),se.ammp("label_atom_id")])}),target:se.struct.generator.atomGroups({"residue-test":se.core.set.has([se.set("CYS"),se.ammp("auth_comp_id")]),"atom-test":se.core.set.has([se.set("SG"),se.ammp("label_atom_id")])}),"bond-test":!0})])]),se.struct.modifier.union([se.struct.modifier.wholeResidues([se.struct.modifier.union([se.struct.generator.bondedAtomicPairs({0:se.core.flags.hasAny([se.struct.bondProperty.flags(),se.core.type.bitflags([8])])})])])])])]),{category:Lr.Bond}),Vve=Nr("NOS Bridges",se.struct.modifier.union([se.struct.modifier.wholeResidues([se.struct.filter.isConnectedTo({0:se.struct.generator.atomGroups({"residue-test":se.core.set.has([se.set("CSO","LYS"),se.ammp("auth_comp_id")]),"atom-test":se.core.set.has([se.set("OD","NZ"),se.ammp("label_atom_id")])}),target:se.struct.generator.atomGroups({"residue-test":se.core.set.has([se.set("CSO","LYS"),se.ammp("auth_comp_id")]),"atom-test":se.core.set.has([se.set("OD","NZ"),se.ammp("label_atom_id")])}),"bond-test":!0})])]),{category:Lr.Bond}),Hve=Nr("Non-standard Residues in Polymers",se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":se.core.rel.eq([se.ammp("entityType"),"polymer"]),"chain-test":se.core.rel.eq([se.ammp("objectPrimitive"),"atomistic"]),"residue-test":se.ammp("isNonStandard")})]),{category:Lr.Residue}),Gve=Nr("Coarse Elements",se.struct.modifier.union([se.struct.generator.atomGroups({"chain-test":se.core.set.has([se.set("sphere","gaussian"),se.ammp("objectPrimitive")])})]),{category:Lr.Type}),qve=Nr("Rings in Residues",se.struct.modifier.union([se.struct.generator.rings()]),{category:Lr.Residue}),jve=Nr("Aromatic Rings in Residues",se.struct.modifier.union([se.struct.generator.rings({"only-aromatic":!0})]),{category:Lr.Residue}),Wve=Nr("Surrounding Residues (5 \u212B) of Selection",se.struct.modifier.union([se.struct.modifier.exceptBy({0:se.struct.modifier.includeSurroundings({0:se.internal.generator.current(),radius:5,"as-whole-residues":!0}),by:se.internal.generator.current()})]),{description:"Select residues within 5 \u212B of the current selection.",category:Lr.Manipulate,referencesCurrent:!0}),Xve=Nr("Surrounding Ligands (5 \u212B) of Selection",se.struct.modifier.union([se.struct.modifier.surroundingLigands({0:se.internal.generator.current(),radius:5,"include-water":!0})]),{description:"Select ligand components within 5 \u212B of the current selection.",category:Lr.Manipulate,referencesCurrent:!0}),Yve=Nr("Inverse / Complement of Selection",se.struct.modifier.union([se.struct.modifier.exceptBy({0:se.struct.generator.all(),by:se.internal.generator.current()})]),{description:"Select everything not in the current selection.",category:Lr.Manipulate,referencesCurrent:!0}),Kve=Nr("Residues Covalently Bonded to Selection",se.struct.modifier.union([se.struct.modifier.includeConnected({0:se.internal.generator.current(),"layer-count":1,"as-whole-residues":!0})]),{description:"Select residues covalently bonded to current selection.",category:Lr.Manipulate,referencesCurrent:!0}),$ve=Nr("Covalently Bonded Component",se.struct.modifier.union([se.struct.modifier.includeConnected({0:se.internal.generator.current(),"fixed-point":!0})]),{description:"Select covalently bonded component based on current selection.",category:Lr.Manipulate,referencesCurrent:!0}),Qve=Nr("Residues with Cov. or Metallic Bond to Selection",se.struct.modifier.union([se.struct.modifier.includeConnected({0:se.internal.generator.current(),"layer-count":1,"as-whole-residues":!0,"bond-test":se.core.flags.hasAny([se.struct.bondProperty.flags(),se.core.type.bitflags([3])])})]),{description:"Select residues with covalent or metallic bond to current selection.",category:Lr.Manipulate,referencesCurrent:!0}),Zve=Nr("Whole Residues of Selection",se.struct.modifier.union([se.struct.modifier.wholeResidues({0:se.internal.generator.current()})]),{description:"Expand current selection to whole residues.",category:Lr.Manipulate,referencesCurrent:!0}),Jve=[[["HIS"],"Histidine"],[["ARG"],"Arginine"],[["LYS"],"Lysine"],[["ILE"],"Isoleucine"],[["PHE"],"Phenylalanine"],[["LEU"],"Leucine"],[["TRP"],"Tryptophan"],[["ALA"],"Alanine"],[["MET"],"Methionine"],[["PRO"],"Proline"],[["CYS"],"Cysteine"],[["ASN"],"Asparagine"],[["VAL"],"Valine"],[["GLY"],"Glycine"],[["SER"],"Serine"],[["GLN"],"Glutamine"],[["TYR"],"Tyrosine"],[["ASP"],"Aspartic Acid"],[["GLU"],"Glutamic Acid"],[["THR"],"Threonine"],[["SEC"],"Selenocysteine"],[["PYL"],"Pyrrolysine"],[["UNK"],"Unknown"]].sort(function(e,t){return e[1]<t[1]?-1:e[1]>t[1]?1:0}),eme=[[["A","DA"],"Adenosine"],[["C","DC"],"Cytidine"],[["T","DT"],"Thymidine"],[["G","DG"],"Guanosine"],[["I","DI"],"Inosine"],[["U","DU"],"Uridine"],[["N","DN"],"Unknown"]].sort(function(e,t){return e[1]<t[1]?-1:e[1]>t[1]?1:0});function SC(e,t,r){var n=e[0],a=e[1];r===void 0&&(r=0);var i=n.length===1&&!Gk.has(n[0])?"["+n[0]+"] "+a:a+" ("+n.join(", ")+")";return Nr(i,se.struct.modifier.union([se.struct.generator.atomGroups({"residue-test":se.core.set.has([se.set.apply(se,n),se.ammp("auth_comp_id")])})]),{category:t,priority:r,description:i})}function tme(e,t,r){var n=e[0],a=e[1],i=a+" ("+n.join(", ")+")";return Nr(i,se.struct.modifier.union([se.struct.generator.atomGroups({"atom-test":se.core.set.has([se.set.apply(se,n),se.acp("elementSymbol")])})]),{category:t,priority:r,description:i})}function rme(e,t,r){var n=e[0],a=e[1],i=""+a;return Nr(""+a,se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":se.core.list.equal([se.list.apply(se,n),se.ammp("entityDescription")])})]),{category:t,priority:r,description:i})}var Gk=jn.unionMany(J_,Hy,Gy,zy);function nme(e){for(var t=new Set,r=0,n=e;r<n.length;r++){var a=n[r];a.uniqueElementSymbols.forEach(function(o){return t.add(o)})}var i=[];return t.forEach(function(o){var s=pve[o]||o;i.push(tme([[o],s],"Element Symbol",0))}),i}function ame(e){for(var t=new Map,r=new Set,n=0,a=e;n<a.length;n++){var i=a[n];i.uniqueResidueNames.forEach(function(d){return r.add(d)});for(var o=function(d){i.uniqueResidueNames.forEach(function(f){var p=d.properties.chemicalComponentMap.get(f);p&&t.set(f,p.name)})},s=0,u=i.models;s<u.length;s++){var l=u[s];o(l)}}var c=[];return jn.difference(r,Gk).forEach(function(d){var f=t.get(d)||d;c.push(SC([[d],f],"Ligand/Non-standard Residue",200))}),c}function ime(e){for(var t=new Map,r=Ze.create(),n=0,a=e;n<a.length;n++){var i=a[n];r.structure=i;for(var o=0,s=i.unitSymmetryGroups;o<s.length;o++){var u=s[o];r.unit=u.units[0],r.element=u.elements[0];var l=ct.entity.type(r);if(l==="polymer"||l==="branched"){var c=ct.entity.pdbx_description(r);t.set(c.join(", "),c)}}}var d=[];return t.forEach(function(f,p){d.push(rme([f,p],"Polymer/Carbohydrate Entities",300))}),d}var Xn={all:Ave,current:Pve,polymer:Tve,trace:Eve,backbone:Ive,sidechain:Mve,sidechainWithTrace:Dve,protein:Rve,nucleic:Ove,helix:Fve,beta:kve,water:Bve,ion:Lve,lipid:Nve,branched:m1,branchedPlusConnected:Uk,branchedConnectedOnly:zk,ligand:F3,ligandPlusConnected:Vk,ligandConnectedOnly:Hk,connectedOnly:Uve,disulfideBridges:zve,nosBridges:Vve,nonStandardPolymer:Hve,coarse:Gve,ring:qve,aromaticRing:jve,surroundings:Wve,surroundingLigands:Xve,complement:Yve,covalentlyBonded:Kve,covalentlyOrMetallicBonded:Qve,covalentlyBondedComponent:$ve,wholeResidues:Zve},ome=function(){function e(){var t,r;this.list=[],this.options=[],this.version=1,(t=this.list).push.apply(t,Nt(Nt(Nt([],Object.values(Xn)),Jve.map(function(n){return SC(n,Lr.AminoAcid)})),eme.map(function(n){return SC(n,Lr.NucleicBase)}))),(r=this.options).push.apply(r,this.list.map(function(n){return[n,n.label,n.category]}))}return e.prototype.add=function(t){this.list.push(t),this.options.push([t,t.label,t.category]),this.version+=1},e.prototype.remove=function(t){var r=this.list.indexOf(t);r!==-1&&(this.list.splice(r,1),this.options.splice(r,1),this.version+=1)},e}(),sme=function(){function e(t,r){this.key=t,this.defaultValue=r}return e.prototype.toString=function(){return this.key},e.prototype.valueOf=function(){return this.key},e}();function Vn(e,t){return new sme(e,t)}var jr={item:Vn,General:{IsBusyTimeoutMs:Vn("plugin-config.is-busy-timeout",750),DisableAntialiasing:Vn("plugin-config.disable-antialiasing",!1),DisablePreserveDrawingBuffer:Vn("plugin-config.disable-preserve-drawing-buffer",!1),PixelScale:Vn("plugin-config.pixel-scale",1),PickScale:Vn("plugin-config.pick-scale",.25),EnableWboit:Vn("plugin-config.enable-wboit",!0)},State:{DefaultServer:Vn("plugin-state.server","https://webchem.ncbr.muni.cz/molstar-state"),CurrentServer:Vn("plugin-state.server","https://webchem.ncbr.muni.cz/molstar-state"),HistoryCapacity:Vn("history-capacity.server",5)},VolumeStreaming:{Enabled:Vn("volume-streaming.enabled",!0),DefaultServer:Vn("volume-streaming.server","https://ds.litemol.org"),CanStream:Vn("volume-streaming.can-stream",function(e,t){return e.models.length===1&&jt.probablyHasDensityMap(e.models[0])}),EmdbHeaderServer:Vn("volume-streaming.emdb-header-server","https://ftp.wwpdb.org/pub/emdb/structures")},Viewport:{ShowExpand:Vn("viewer.show-expand-button",!0),ShowControls:Vn("viewer.show-controls-button",!0),ShowSettings:Vn("viewer.show-settings-button",!0),ShowSelectionMode:Vn("viewer.show-selection-model-button",!0),ShowAnimation:Vn("viewer.show-animation-button",!0)},Download:{DefaultPdbProvider:Vn("download.default-pdb-provider","pdbe"),DefaultEmdbProvider:Vn("download.default-emdb-provider","pdbe")},Structure:{SizeThresholds:Vn("structure.size-thresholds",Xe.DefaultSizeThresholds),DefaultRepresentationPresetParams:Vn("structure.default-representation-preset-params",{})}},ume=function(){function e(t){var r=this;this._config=new Map,t&&t.forEach(function(n){var a=n[0],i=n[1];return r._config.set(a,i)})}return e.prototype.get=function(t){return this._config.has(t)?this._config.get(t):t.defaultValue},e.prototype.set=function(t,r){this._config.set(t,r)},e.prototype.delete=function(t){this._config.delete(t)},e}();function as(e,t,r,n){var a=0,i=t.webgl,o=new Ln,s=vl(),u=[],l=da.create(),c,d,f,p,h=Yn.createEmpty();function v(S,_){var A=this;return S===void 0&&(S={}),_&&_!==d&&(f=r(t,_),d=_,p||(p=E.getDefaultValues(f))),p=Object.assign({},p,S),We.create("Creating or updating ComplexRepresentation",function(T){return ce(A,void 0,void 0,function(){var I,M,O;return de(this,function(D){switch(D.label){case 0:return I=!1,c?!((O=c.mustRecreate)===null||O===void 0)&&O.call(c,d,p,i)&&(c.destroy(),c=n(s,d,p,i),I=!0):(c=n(s,d,p,i),I=!0),M=c.createOrUpdate({webgl:i,runtime:T},h,p,_),M?[4,M]:[3,2];case 1:D.sent(),D.label=2;case 2:return I&&y(l),u.length=0,c&&c.renderObject&&u.push(c.renderObject),o.next(a++),[2]}})})})}function m(S){return S===void 0?Xe.Loci(d.target):c?c.getLoci(S):Or}function g(S,_){if(!d||!Ii.is(l.markerActions,_))return!1;if(Xe.isLoci(S)||Re.is(S)||Ht.isLoci(S)){if(!Xe.areRootsEquivalent(S.structure,d))return!1;S=ir.remap(S,d)}else if(!Ao(S)&&!Yh(S))return!1;return ir.isEmpty(S)?!1:c?c.mark(S,_):!1}function y(S){if(da.update(l,S),S.visible!==void 0&&c&&c.setVisibility(S.visible&&(l.unitTransforms===null||l.unitTransforms.isIdentity)),S.alphaFactor!==void 0&&c&&c.setAlphaFactor(S.alphaFactor),S.pickable!==void 0&&c&&c.setPickable(S.pickable),S.overpaint!==void 0&&c){var _=va.remap(S.overpaint,d);c.setOverpaint(_)}if(S.transparency!==void 0&&c){var A=ma.remap(S.transparency,d);c.setTransparency(A)}if(S.clipping!==void 0&&c){var T=en.remap(S.clipping,d);c.setClipping(T)}S.transform!==void 0&&c&&c.setTransform(S.transform),S.unitTransforms!==void 0&&c&&c.setVisibility(l.visible&&(S.unitTransforms===null||S.unitTransforms.isIdentity))}function b(S){h=S}function x(){c&&c.destroy()}return{label:e,get groupCount(){return c?c.groupCount:0},get props(){return p},get params(){return f},get state(){return l},get theme(){return h},renderObjects:u,updated:o,createOrUpdate:v,setState:y,setTheme:b,getLoci:m,mark:g,destroy:x}}function qk(e,t,r){var n=t.elements,a=t.model;if(ke.indexOf(n,r)!==-1){for(var i=a.atomicHierarchy.residueAtomSegments,o=i.index,s=i.offsets,u=o[r],l=[],c=s[u],d=s[u+1];c<d;++c){var f=ke.indexOf(n,c);f!==-1&&l.push(f)}var p=ke.ofSortedArray(Je.ofSortedArray(l));return Re(e,[{unit:t,indices:p}])}return Or}function lme(e,t,r){var n=t.elements,a=t.model,i=a.atomicHierarchy.atoms.label_alt_id,o=i.value(r);if(ke.indexOf(n,r)!==-1){var s=a.atomicHierarchy.residueAtomSegments.index,u=s[r];return wv(e,t,u,o)}return Re(e,[])}function wv(e,t,r,n){for(var a=t.elements,i=t.model,o=i.atomicHierarchy.atoms.label_alt_id,s=i.atomicHierarchy.residueAtomSegments.offsets,u=[],l=s[r],c=s[r+1];l<c;++l){var d=ke.indexOf(a,l);if(d!==-1){var f=o.value(l);(n===f||f==="")&&u.push(d)}}var p=ke.ofSortedArray(Je.ofSortedArray(u));return Re(e,[{unit:t,indices:p}])}function jk(e,t,r){for(var n=e.structure.child,a=t&&n?e.group.units.filter(function(l){return n.unitMap.has(l.id)}):e.group.units,i=a.length,o=i*16,s=r&&r.aTransform.ref.value.length>=o?r.aTransform.ref.value:new Float32Array(o),u=0;u<i;u++)ue.toArray(a[u].conformation.operator.matrix,s,u*16);return X_(s,i,r)}var cme={atomic:{},spheres:{},gaussians:{}},dme=E.objectToOptions(cme);function fme(e,t){for(var r=0,n=e.length;r<n;++r)if(ze.isAtomic(t)&&e[r]==="atomic"||ze.isSpheres(t)&&e[r]==="spheres"||ze.isGaussians(t)&&e[r]==="gaussians")return!0;return!1}var Wk=5e8;function Xk(e,t,r){r===void 0&&(r=Wk);var n=Xt.size(C(),e);C.ceil(n,n),n.sort(function(s,u){return u-s});var a=Math.floor(Math.cbrt(r)*Math.cbrt(r)),i=n[0]*n[1],o=Math.ceil(i/(t*t));return{area:i,areaCells:o,maxAreaCells:a}}function ef(e,t,r){r===void 0&&(r=Wk);var n=Xk(e,t.resolution,r),a=n.area,i=n.areaCells,o=n.maxAreaCells,s=i>o?Math.sqrt(a/o):t.resolution;return w(w({},t),{resolution:s})}function pme(e){switch(e.kind){case 0:return e.model.atomicConformation;case 1:return e.model.coarseConformation.spheres;case 2:return e.model.coarseConformation.gaussians}}var g1={ignoreHydrogens:E.Boolean(!1,{description:"Whether or not to include hydrogen atoms in the surface calculation."}),traceOnly:E.Boolean(!1,{description:"Whether or not to only use trace atoms in the surface calculation."}),includeParent:E.Boolean(!1,{description:"Include elements of the parent structure in surface calculation to get a surface patch of the current structure."})};E.getDefaultValues(g1);var hme=C();function vme(e,t,r,n){return C.squaredDistance(C.set(hme,e,t,r),n)}function mme(e,t,r){for(var n=0,a=t.length,i=0,o=r.length;i<o;++i){var s=Je.indexOfInRange(t,r[i],n,a);s===-1?e[i]=-2:(e[i]=s,n=s)}}function y1(e,t,r){var n=r.ignoreHydrogens,a=r.traceOnly,i=r.includeParent,o=i?e.root.unitMap.get(t.id):t,s=pme(o),u=s.x,l=s.y,c=s.z,d=o.elements,f=t.boundary.sphere,p=f.center,h=f.radius,v=(2+1.5)*2,m=(h+v)*(h+v),g,y;if(n||a||i&&o!==t){for(var b=[],x=[],S=0,_=d.length;S<_;++S){var A=d[S];n&&Bg(o,A)||a&&!B3(o,A)||i&&vme(u[A],l[A],c[A],p)>m||(b.push(A),x.push(S))}g=Je.ofSortedArray(b),y=x}else g=d,y=Mo(new Int32Array(g.length));i&&o!==t&&mme(y,t.elements,g);var T={indices:g,x:u,y:l,z:c,id:y},I=t===o?t.boundary:hp(T),M=Ze.create(e,o),O=Lv({},{scale:1}),D=function(F){return M.element=F,O.size(M)};return{position:T,boundary:I,radius:D}}function k3(e,t,r){var n=Ze.create(e),a=Lv({},{scale:1}),i,o,s,u,l;if(t||r){for(var c=[],d=[],f=[],p=[],h=[],v=0,m=0,g=e.units.length;v<g;++v){var y=e.units[v],b=y.elements,x=y.conformation,S=x.x,_=x.y,A=x.z;n.unit=y;for(var T=0,I=b.length;T<I;++T){var M=b[T];t&&Bg(y,M)||r&&!B3(y,M)||(c.push(S(M)),d.push(_(M)),f.push(A(M)),n.element=M,p.push(a.size(n)),h.push(m+T))}m+=b.length}i=c,o=d,s=f,u=p,l=h}else{for(var O=e.elementCount,c=new Float32Array(O),d=new Float32Array(O),f=new Float32Array(O),p=new Float32Array(O),v=0,m=0,g=e.units.length;v<g;++v){var y=e.units[v],b=y.elements,D=y.conformation,S=D.x,_=D.y,A=D.z;n.unit=y;for(var T=0,I=b.length;T<I;++T){var M=b[T],F=m+T;c[F]=S(M),d[F]=_(M),f[F]=A(M),n.element=M,p[F]=a.size(n)}m+=b.length}i=c,o=d,s=f,u=p,l=Mo(new Uint32Array(O))}var G={indices:ke.ofRange(0,l.length),x:i,y:o,z:s,id:l},N=function(z){return u[z]};return{position:G,radius:N}}var Yk=Ny.H;function Bg(e,t){return ze.isCoarse(e)?!1:e.model.atomicHierarchy.derived.atom.atomicNumber[t]===Yk}function Lg(e,t){return e[t]===Yk}function B3(e,t){if(ze.isCoarse(e))return!0;var r=e.model.atomicHierarchy.atoms.label_atom_id.value(t);return r==="CA"||r==="BB"||r==="P"}function Np(e){if(ze.isAtomic(e))return 4;for(var t=0,r=e.elements,n=e.conformation.r,a=0,i=r.length;a<i;a++){var o=n(r[a]);o>t&&(t=o)}return t+1}function b1(e){for(var t=0,r=0,n=e.unitSymmetryGroups;r<n.length;r++){var a=n[r],i=Np(a.units[0]);i>t&&(t=i)}return t}function Nv(e){return E.MultiSelect(e,dme,{description:"For which kinds of units/chains to show the representation visuals."})}var Mi={unitKinds:Nv(["atomic","spheres"]),includeParent:E.Boolean(!1,{isHidden:!0})},Kk=w({},Lt.Params),gme=w({},xc.Params),$k=w({},Wi.Params),yme=w({},Ud.Params),Qk=w({},mn.Params),Zk=w({},Do.Params),Jk=w({},di.Params),eB=w({},ps.Params);function bme(e,t,r,n,a,i){var o=Ma.getUtils(t),s=o.createValues,u=o.createRenderableState,l=K_(),c=s(t,l,r,n,a),d=u(a);return kp(t.kind,c,d,i)}function Up(e,t){var r=e.defaultProps,n=e.createGeometry,a=e.createLocationIterator,i=e.getLoci,o=e.eachLocation,s=e.setUpdateState,u=e.mustRecreate,l=e.processValues,c=e.dispose,d=e.geometryUtils,f=d.updateValues,p=d.updateBoundingSphere,h=d.updateRenderableState,v=d.createPositionIterator,m=Ys.create(),g,y,b,x,S=Object.assign({},r),_=Yn.createEmpty(),A,T,I,M;function O(z,$,j){if(!j&&!A)throw new Error("missing structure");if(y=Object.assign({},S,$),b=z,x=j,Ys.reset(m),!g||!A){m.createNew=!0,m.createGeometry=!0;return}s(m,y,S,b,_,x,A),Xe.areEquivalent(x,A)||(m.createGeometry=!0),Xe.areHierarchiesEqual(x,A)||(m.updateTransform=!0,m.createGeometry=!0),Wu.areEqual(z.color,_.color)||(m.updateColor=!0),ku(y.unitKinds,S.unitKinds)||(m.createGeometry=!0),A.child!==x.child&&(m.createGeometry=!0),m.updateSize&&!("uSize"in g.values)&&(m.createGeometry=!0),m.createGeometry&&(m.updateColor=!0,m.updateSize=!0)}function D(z){if(m.createNew)if(I=a(x),z)g=bme(x,z,I,b,y,t),M=v(z,g.values);else throw new Error("expected geometry to be given");else{if(!g)throw new Error("expected renderObject to be available");if(m.updateTransform){I=a(x);var $=I.instanceCount,j=I.groupCount;Fo($*j,g.values)}if(m.createGeometry)if(z)k.updateIfChanged(g.values.drawCount,Ma.getDrawCount(z)),k.updateIfChanged(g.values.uVertexCount,Ma.getVertexCount(z));else throw new Error("expected geometry to be given");(m.updateTransform||m.createGeometry)&&(p(g.values,z||T),M=v(T,g.values)),m.updateSize&&"uSize"in g.values&&il(I,b.size,g.values),m.updateColor&&to(I,M,b.color,g.values),f(g.values,y),h(g.state,y)}S=y,_=b,A=x,z&&(T=z)}function F(z){return!!(Ao(z)||Xe.isLoci(z)&&Xe.areRootsEquivalent(z.structure,A)||Re.is(z)&&Xe.areRootsEquivalent(z.structure,A)&&Re.isWholeStructure(z))}function G(z,$,j){return F(z)?$(Ie.ofBounds(0,I.groupCount*I.instanceCount)):o(z,A,$,j)}function N(z){g&&(l==null||l(g.values,T,S,_,z.webgl))}return{get groupCount(){return I?I.count:0},get renderObject(){return I&&I.count?g:void 0},createOrUpdate:function(z,$,j,Z){if(j===void 0&&(j={}),O($,j,Z||A),m.createGeometry){var q=n(z,x,b,y,T);if(T3(q))return q.then(function(te){D(te),N(z)});D(q)}else D();N(z)},getLoci:function(z){return g?i(z,A,g.id):Or},mark:function(z,$){return Sr.mark(g,z,$,G)},setVisibility:function(z){Sr.setVisibility(g,z)},setAlphaFactor:function(z){Sr.setAlphaFactor(g,z)},setPickable:function(z){Sr.setPickable(g,z)},setColorOnly:function(z){Sr.setColorOnly(g,z)},setTransform:function(z,$){Sr.setTransform(g,z,$)},setOverpaint:function(z){Sr.setOverpaint(g,z,G,!0)},setTransparency:function(z){Sr.setTransparency(g,z,G,!0)},setClipping:function(z){Sr.setClipping(g,z,G,!0)},destroy:function(){c==null||c(T),g&&(g.state.disposed=!0,g=void 0)},mustRecreate:u}}var Uv=w(w({},Kk),Mi);function tf(e,t){return Up(w(w({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),ba.areEqual(i.size,o.size)||(r.createGeometry=!0)},geometryUtils:Lt.Utils}),t)}var Sme=w(w({},$k),Mi);function xme(e,t){return Up(w(w({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),ba.areEqual(i.size,o.size)||(r.updateSize=!0)},geometryUtils:Wi.Utils}),t)}var Cme=w(w({},Qk),Mi);function _me(e,t){return Up(w(w({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),ba.areEqual(i.size,o.size)||(r.updateSize=!0)},geometryUtils:mn.Utils}),t)}var wme=w(w({},Zk),Mi);function Ame(e,t){return Up(w(w({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),ba.areEqual(i.size,o.size)||(r.updateSize=!0),n.background!==a.background&&(r.createGeometry=!0),n.backgroundMargin!==a.backgroundMargin&&(r.createGeometry=!0),n.tether!==a.tether&&(r.createGeometry=!0),n.tetherLength!==a.tetherLength&&(r.createGeometry=!0),n.tetherBaseWidth!==a.tetherBaseWidth&&(r.createGeometry=!0),n.attachment!==a.attachment&&(r.createGeometry=!0),n.fontFamily!==a.fontFamily&&(r.createGeometry=!0),n.fontQuality!==a.fontQuality&&(r.createGeometry=!0),n.fontStyle!==a.fontStyle&&(r.createGeometry=!0),n.fontVariant!==a.fontVariant&&(r.createGeometry=!0),n.fontWeight!==a.fontWeight&&(r.createGeometry=!0)},geometryUtils:Do.Utils}),t)}var Pme=w(w({},Jk),Mi);function Tme(e,t){return Up(w(w({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),ba.areEqual(i.size,o.size)||(r.createGeometry=!0)},geometryUtils:di.Utils}),t)}var Eme=w(w({},eB),Mi);function Ime(e,t){return Up(w(w({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),ba.areEqual(i.size,o.size)||(r.createGeometry=!0)},geometryUtils:ps.Utils}),t)}function Un(e,t,r,n){var a=0,i=t.webgl,o=new Ln,s=vl(),u=[],l=da.create(),c=new Map,d,f,p,h,v=Yn.createEmpty();function m(A,T){var I=this;return A===void 0&&(A={}),T&&T!==d&&(p=r(t,T),h||(h=E.getDefaultValues(p))),h=Object.assign({},h,A),We.create("Creating or updating UnitsRepresentation",function(M){return ce(I,void 0,void 0,function(){var N,Z,j,q,O,N,Z,F,j,q,q,D,j,q,N,Z,F,j,q,q,G,N,z,$,j,Z,q,q,te,he,W;return de(this,function(K){switch(K.label){case 0:if(!(!d&&!T))return[3,1];throw new Error("missing structure");case 1:if(!(T&&!d))return[3,8];f=T.unitSymmetryGroups,N=0,K.label=2;case 2:return N<f.length?(Z=f[N],j=n(s,T,h,i),q=j.createOrUpdate({webgl:i,runtime:M},v,h,{group:Z,structure:T}),q?[4,q]:[3,4]):[3,7];case 3:K.sent(),K.label=4;case 4:return b(j,Z,l),c.set(Z.hashCode,{visual:j,group:Z}),M.shouldUpdate?[4,M.update({message:"Creating or updating UnitsVisual",current:N,max:f.length})]:[3,6];case 5:K.sent(),K.label=6;case 6:return N++,[3,2];case 7:return[3,43];case 8:if(!(T&&(!Xe.areUnitIdsAndIndicesEqual(T,d)||T.child!==d.child)))return[3,22];f=T.unitSymmetryGroups,O=c,c=new Map,N=0,K.label=9;case 9:return N<f.length?(Z=f[N],F=O.get(Z.hashCode),F?(j=F.visual,!((te=j.mustRecreate)===null||te===void 0)&&te.call(j,{group:Z,structure:T},h,i)?(j.destroy(),j=n(s,T,h,i),q=j.createOrUpdate({webgl:i,runtime:M},v,h,{group:Z,structure:T}),q?[4,q]:[3,11]):[3,12]):[3,15]):[3,21];case 10:K.sent(),K.label=11;case 11:return b(j,Z,l),[3,14];case 12:return q=j.createOrUpdate({webgl:i,runtime:M},v,h,{group:Z,structure:T}),q?[4,q]:[3,14];case 13:K.sent(),K.label=14;case 14:return c.set(Z.hashCode,{visual:j,group:Z}),O.delete(Z.hashCode),j.renderObject&&(D=j.renderObject.values.tMarker.ref.value.array,hs(D,Ie.ofBounds(0,D.length),tr.RemoveHighlight)),[3,18];case 15:return j=n(s,T,h,i),q=j.createOrUpdate({webgl:i,runtime:M},v,h,{group:Z,structure:T}),q?[4,q]:[3,17];case 16:K.sent(),K.label=17;case 17:b(j,Z,l),c.set(Z.hashCode,{visual:j,group:Z}),K.label=18;case 18:return M.shouldUpdate?[4,M.update({message:"Creating or updating UnitsVisual",current:N,max:f.length})]:[3,20];case 19:K.sent(),K.label=20;case 20:return N++,[3,9];case 21:return O.forEach(function(U){var H=U.visual;H.destroy()}),[3,43];case 22:if(!(T&&T!==d&&Xe.areUnitIdsAndIndicesEqual(T,d)))return[3,34];f=T.unitSymmetryGroups,N=0,K.label=23;case 23:return N<f.length?(Z=f[N],F=c.get(Z.hashCode),F?(j=F.visual,!((he=j.mustRecreate)===null||he===void 0)&&he.call(j,{group:Z,structure:T},h,t.webgl)?(j.destroy(),j=n(s,T,h,t.webgl),F.visual=j,q=j.createOrUpdate({webgl:i,runtime:M},v,h,{group:Z,structure:T}),q?[4,q]:[3,25]):[3,26]):[3,29]):[3,33];case 24:K.sent(),K.label=25;case 25:return b(j,Z,l),[3,28];case 26:return q=j.createOrUpdate({webgl:i,runtime:M},v,h,{group:Z,structure:T}),q?[4,q]:[3,28];case 27:K.sent(),K.label=28;case 28:return F.group=Z,[3,30];case 29:throw new Error("expected to find visual for hashCode "+Z.hashCode);case 30:return M.shouldUpdate?[4,M.update({message:"Creating or updating UnitsVisual",current:N,max:f.length})]:[3,32];case 31:K.sent(),K.label=32;case 32:return N++,[3,23];case 33:return[3,43];case 34:G=[],c.forEach(function(U){return G.push(U)}),N=0,z=G.length,K.label=35;case 35:return N<z?($=G[N],j=$.visual,Z=$.group,!((W=j.mustRecreate)===null||W===void 0)&&W.call(j,{group:Z,structure:d},h,t.webgl)?(j.destroy(),j=n(s,d,h,i),G[N].visual=j,q=j.createOrUpdate({webgl:i,runtime:M},v,h,{group:Z,structure:d}),q?[4,q]:[3,37]):[3,38]):[3,43];case 36:K.sent(),K.label=37;case 37:return b(j,Z,l),[3,40];case 38:return q=j.createOrUpdate({webgl:i,runtime:M},v,h),q?[4,q]:[3,40];case 39:K.sent(),K.label=40;case 40:return M.shouldUpdate?[4,M.update({message:"Creating or updating UnitsVisual",current:N,max:z})]:[3,42];case 41:K.sent(),K.label=42;case 42:return++N,[3,35];case 43:return u.length=0,c.forEach(function(U){var H=U.visual;H.renderObject&&u.push(H.renderObject)}),T&&(d=T),o.next(a++),[2]}})})})}function g(A){if(A===void 0)return Xe.Loci(d.target);var T=Or;return c.forEach(function(I){var M=I.visual,O=M.getLoci(A);ns(O)||(T=O)}),T}function y(A,T){if(!d||!Ii.is(l.markerActions,T))return!1;if(Xe.isLoci(A)||Re.is(A)||Ht.isLoci(A)){if(!Xe.areRootsEquivalent(A.structure,d))return!1;A=ir.remap(A,d)}else if(!Ao(A)&&!Yh(A))return!1;if(ir.isEmpty(A))return!1;var I=!1;return c.forEach(function(M){var O=M.visual;I=O.mark(A,T)||I}),I}function b(A,T,I){var M=I.visible,O=I.alphaFactor,D=I.pickable,F=I.overpaint,G=I.transparency,N=I.clipping,z=I.transform,$=I.unitTransforms;M!==void 0&&A.setVisibility(M),O!==void 0&&A.setAlphaFactor(O),D!==void 0&&A.setPickable(D),F!==void 0&&A.setOverpaint(F),G!==void 0&&A.setTransparency(G),N!==void 0&&A.setClipping(N),z!==void 0&&A.setTransform(z),$!==void 0&&($?A.setTransform(void 0,$.getSymmetryGroupTransforms(T)):A.setTransform(void 0,null))}function x(A){var T=A.visible,I=A.alphaFactor,M=A.pickable,O=A.overpaint,D=A.transparency,F=A.clipping,G=A.transform,N=A.unitTransforms,z=A.syncManually,$=A.markerActions,j={};T!==l.visible&&(j.visible=T),I!==l.alphaFactor&&(j.alphaFactor=I),M!==l.pickable&&(j.pickable=M),O!==void 0&&!va.areEqual(O,l.overpaint)&&d&&(j.overpaint=va.remap(O,d)),D!==void 0&&!ma.areEqual(D,l.transparency)&&d&&(j.transparency=ma.remap(D,d)),F!==void 0&&!en.areEqual(F,l.clipping)&&d&&(j.clipping=en.remap(F,d)),G!==void 0&&!ue.areEqual(G,l.transform,fn)&&(j.transform=G),(N!==l.unitTransforms||(N==null?void 0:N.version)!==A.unitTransformsVersion)&&(j.unitTransforms=N,l.unitTransformsVersion=N?N==null?void 0:N.version:-1),z!==l.syncManually&&(j.syncManually=z),$!==l.markerActions&&(j.markerActions=$),c.forEach(function(Z){var q=Z.visual,te=Z.group;return b(q,te,j)}),da.update(l,j)}function S(A){v=A}function _(){c.forEach(function(A){var T=A.visual;return T.destroy()}),c.clear()}return{label:e,get groupCount(){var A=0;return c.forEach(function(T){var I=T.visual;I.renderObject&&(A+=I.groupCount)}),A},get props(){return h},get params(){return p},get state(){return l},get theme(){return v},renderObjects:u,updated:o,createOrUpdate:m,setState:x,setTheme:S,getLoci:g,mark:y,destroy:_}}function Mme(e,t,r,n,a,i){var o=Ma.getUtils(t),s=o.createValues,u=o.createRenderableState,l=jk(e,a.includeParent),c=s(t,l,r,n,a),d=u(a);return kp(t.kind,c,d,i)}function rf(e,t){var r=e.defaultProps,n=e.createGeometry,a=e.createLocationIterator,i=e.getLoci,o=e.eachLocation,s=e.setUpdateState,u=e.mustRecreate,l=e.processValues,c=e.dispose,d=e.geometryUtils,f=d.createEmpty,p=d.updateValues,h=d.updateBoundingSphere,v=d.updateRenderableState,m=d.createPositionIterator,g=Ys.create(),y,b=Object.assign({},r),x=Yn.createEmpty(),S,_,A,T,I,M,O;function D(j,Z,q){if(!q&&!T)throw new Error("missing structureGroup");if(b=Z,x=j,S=q,Ys.reset(g),!y||!T){g.createNew=!0,g.createGeometry=!0;return}s(g,b,_,x,A,S,T),Xe.areHierarchiesEqual(T.structure,S.structure)||(g.updateTransform=!0,g.updateColor=!0,g.updateSize=!0),Wu.areEqual(x.color,A.color)||(g.updateColor=!0),T.structure.child!==S.structure.child&&(g.createGeometry=!0),ku(b.unitKinds,_.unitKinds)||(g.createGeometry=!0),S.group.transformHash!==T.group.transformHash&&(S.group.units.length!==T.group.units.length||g.updateColor?g.updateTransform=!0:g.updateMatrix=!0);var te=S.group.units[0],he=T.group.units[0];ze.areOperatorsEqual(te,he)||(g.updateTransform=!0),ze.areConformationsEqual(te,he)||(g.createGeometry=!0),g.updateTransform&&(g.updateMatrix=!0),g.updateSize&&!("uSize"in y.values)&&(g.createGeometry=!0),(g.createGeometry||g.updateTransform)&&(T.structure.hashCode!==S.structure.hashCode&&(g.updateColor=!0,g.updateSize=!0),(x.color.granularity.startsWith("vertex")||y.values.dColorType.ref.value.startsWith("vertex")||x.color.granularity.startsWith("volume")||y.values.dColorType.ref.value.startsWith("volume"))&&(g.updateColor=!0))}function F(j){if(g.createNew)if(M=a(S),j)y=Mme(S,j,M,x,b,t),O=m(j,y.values);else throw new Error("expected geometry to be given");else{if(!y)throw new Error("expected renderObject to be available");if(g.updateTransform){M=a(S);var Z=M.instanceCount,q=M.groupCount;Fo(Z*q,y.values)}if(g.updateMatrix&&jk(S,b.includeParent,y.values),g.createGeometry)if(j)k.updateIfChanged(y.values.drawCount,Ma.getDrawCount(j)),k.updateIfChanged(y.values.uVertexCount,Ma.getVertexCount(j));else throw new Error("expected geometry to be given");(g.updateTransform||g.createGeometry)&&(h(y.values,j||I),O=m(j||I,y.values)),g.updateSize&&"uSize"in y.values&&il(M,x.size,y.values),g.updateColor&&to(M,O,x.color,y.values),p(y.values,b),v(y.state,b)}_=b,A=x,T=S,j&&(I=j)}function G(j,Z,q,te,he,W){return fme(he.unitKinds,Z)?n(j,Z,q,te,he,W):f(W)}function N(j){return!!(Ao(j)||Xe.isLoci(j)&&Xe.areRootsEquivalent(j.structure,T.structure)||Re.is(j)&&Xe.areRootsEquivalent(j.structure,T.structure)&&Re.isWholeStructure(j))}function z(j,Z,q){return N(j)?Z(Ie.ofBounds(0,M.groupCount*M.instanceCount)):o(j,T,Z,q)}function $(j){y&&(l==null||l(y.values,I,_,A,j.webgl))}return{get groupCount(){return M?M.count:0},get renderObject(){return M&&M.count?y:void 0},createOrUpdate:function(j,Z,q,te){if(D(Z,q,te||T),g.createGeometry){var he=G(j,S.group.units[0],S.structure,x,b,I);if(T3(he))return he.then(function(W){F(W),$(j)});F(he)}else F();$(j)},getLoci:function(j){return y?i(j,T,y.id):Or},mark:function(j,Z){return Sr.mark(y,j,Z,z)},setVisibility:function(j){Sr.setVisibility(y,j)},setAlphaFactor:function(j){Sr.setAlphaFactor(y,j)},setPickable:function(j){Sr.setPickable(y,j)},setColorOnly:function(j){Sr.setColorOnly(y,j)},setTransform:function(j,Z){Sr.setTransform(y,j,Z)},setOverpaint:function(j){Sr.setOverpaint(y,j,z,!0)},setTransparency:function(j){Sr.setTransparency(y,j,z,!0)},setClipping:function(j){Sr.setClipping(y,j,z,!0)},destroy:function(){c==null||c(I),y&&(y.state.disposed=!0,y=void 0)},mustRecreate:u}}var Va=w(w({},Kk),Mi);function pi(e,t){return rf(w(w({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),ba.areEqual(i.size,o.size)||(r.createGeometry=!0)},geometryUtils:Lt.Utils}),t)}var tB=w(w({},gme),Mi);function rB(e,t){return rf(w(w({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),ba.areEqual(i.size,o.size)||(r.updateSize=!0)},geometryUtils:xc.Utils}),t)}var nB=w(w({},$k),Mi);function aB(e,t){return rf(w(w({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),ba.areEqual(i.size,o.size)||(r.updateSize=!0)},geometryUtils:Wi.Utils}),t)}var Dme=w(w({},yme),Mi);function Rme(e,t){return rf(w(w({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),ba.areEqual(i.size,o.size)||(r.updateSize=!0)},geometryUtils:Ud.Utils}),t)}var L3=w(w({},Qk),Mi);function N3(e,t){return rf(w(w({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),ba.areEqual(i.size,o.size)||(r.updateSize=!0)},geometryUtils:mn.Utils}),t)}w(w({},Zk),Mi);var Ome=w(w({},Jk),Mi);function Fme(e,t){return rf(w(w({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),ba.areEqual(i.size,o.size)||(r.createGeometry=!0)},geometryUtils:di.Utils}),t)}var kme=w(w({},eB),Mi);function Bme(e,t){return rf(w(w({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),ba.areEqual(i.size,o.size)||(r.createGeometry=!0)},geometryUtils:ps.Utils}),t)}var da={create:function(){return w(w({},or.createState()),{unitTransforms:null,unitTransformsVersion:-1})},update:function(e,t){or.updateState(e,t),t.unitTransforms!==void 0&&(e.unitTransforms=t.unitTransforms)}};function Br(e,t){return e.model.atomicHierarchy.atoms.type_symbol.value(e.elements[t])}function iB(e,t){return e.model.atomicHierarchy.atoms.pdbx_formal_charge.value(e.elements[t])}function Av(e,t){return e.model.atomicHierarchy.atoms.label_atom_id.value(e.elements[t])}function Ng(e,t){return e.model.atomicHierarchy.atoms.label_alt_id.value(e.elements[t])}function U3(e,t){return e.model.atomicHierarchy.atoms.label_comp_id.value(e.elements[t])}function Lme(e,t,r){for(var n=0,a=e.interUnitBonds.getEdgeIndices(r,t.id),i=0,o=a.length;i<o;++i){var s=e.interUnitBonds.edges[a[i]];kr.isCovalent(s.props.flag)&&(n+=1)}return n}function Nme(e,t){for(var r=0,n=e.bonds,a=n.offset,i=n.edgeProps.flags,o=a[t],s=a[t+1];o<s;++o)kr.isCovalent(i[o])&&(r+=1);return r}function Yu(e,t,r){return Lme(e,t,r)+Nme(t,r)}function li(e,t,r,n){var a=0;return Ro(e,t,r,function(i,o){Br(i,o)===n&&(a+=1)}),a}function Ume(e,t,r){var n=e.bonds,a=n.offset,i=n.b,o=n.edgeProps.flags;kr.is;for(var s=a[t],u=a[t+1];s<u;++s)if(i[s]===r&&kr.isCovalent(o[s]))return!0;return!1}function zme(e,t,r,n,a){var i=e.interUnitBonds.getEdge(r,t.id,a,n.id);return i&&kr.isCovalent(i.props.flag)}function Vme(e,t,r,n,a){return t===n?Ume(t,r,a):zme(e,t,r,n,a)}function Hme(e,t,r,n){for(var a=e.interUnitBonds.getEdgeIndices(r,t.id),i=0,o=a.length;i<o;++i){var s=e.interUnitBonds.edges[a[i]],u=e.unitMap.get(s.unitB);kr.isCovalent(s.props.flag)&&n(u,s.indexB)}}function Gme(e,t,r){for(var n=e.bonds,a=n.offset,i=n.b,o=n.edgeProps.flags,s=a[t],u=a[t+1];s<u;++s)kr.isCovalent(o[s])&&r(e,i[s])}function Ro(e,t,r,n){Hme(e,t,r,n),Gme(t,r,n)}function qme(e){switch(e){case 0:return"Spherical";case 1:return"Terminal";case 2:return"Linear";case 3:return"Trigonal";case 4:return"Tetrahedral";case 5:return"Trigonal Bi-Pyramidal";case 6:return"Octahedral";case 7:return"Square Planar";case 8:return"Unknown"}}function If(e){switch(e){case 0:return 0;case 1:return 1;case 2:return 2;case 3:return 3;case 4:return 4;default:return 8}}var B5=new Map([[2,Wr(180)],[3,Wr(120)],[4,Wr(109.4721)],[6,Wr(90)]]),Ug=C(),zg=C(),dd=C(),Vg=C(),Yf=C();function Hg(e,t,r,n,a){var i=[];return t.conformation.position(t.elements[r],dd),n.conformation.position(n.elements[a],Vg),C.sub(Ug,Vg,dd),Ro(e,t,r,function(o,s){Br(o,s)!=="H"&&(o.conformation.position(o.elements[s],Yf),C.sub(zg,Yf,dd),i.push(C.angle(Ug,zg)))}),i}function L5(e,t,r,n,a){t.conformation.position(t.elements[r],dd),n.conformation.position(n.elements[a],Vg),C.sub(Ug,Vg,dd);var i=[C(),C()],o=0,s,u;if(Ro(e,t,r,function(l,c){o>1||Br(l,c)!=="H"&&(s=l,u=c,l.conformation.position(l.elements[c],Yf),C.sub(i[o++],Yf,dd))}),o===1&&s&&u&&Ro(e,s,u,function(l,c){o>1||l===t&&c===r||Br(l,c)!=="H"&&(l.conformation.position(l.elements[c],Yf),C.sub(i[o++],Yf,dd))}),o===2)return C.cross(zg,i[0],i[1]),Math.abs(Math.PI/2-C.angle(zg,Ug))}var E2=new Ht.ElementBondIterator,I2=new Ht.ElementBondIterator;function jme(e,t,r){var n=Br(t,r),a=n==="O"||n==="N";if(a&&Yu(e,t,r)===4)return!1;for(E2.setElement(e,t,r);E2.hasNext;){var i=E2.move();if(i.order>1)return!0;if(a){var o=Br(i.otherUnit,i.otherIndex);for(I2.setElement(e,i.otherUnit,i.otherIndex);I2.hasNext;){var s=I2.move();if(s.order>1){if((o==="P"||o==="S")&&Br(s.otherUnit,s.otherIndex)==="O")continue;return!0}}}}return!1}function Wme(e,t,r){for(var n=0,a=t.bonds,i=a.offset,o=a.edgeProps,s=o.flags,u=o.order,l=i[r],c=i[r+1];l<c;++l)kr.isCovalent(s[l])&&(n+=u[l]);return e.interUnitBonds.getEdgeIndices(r,t.id).forEach(function(d){var f=e.interUnitBonds.edges[d];kr.isCovalent(f.props.flag)&&(n+=f.props.order)}),n}var Mf=new Ht.ElementBondIterator,M2=new Ht.ElementBondIterator;function Xme(e,t,r,n){var a=li(e,t,r,"H"),i=Br(t,r),o=iB(t,r),s=n.assignCharge==="always"||n.assignCharge==="auto"&&o===0,u=n.assignH==="always"||n.assignH==="auto"&&a===0,l=Yu(e,t,r),c=Wme(e,t,r),d=jme(e,t,r),f=c-l>0,p=0,h=8;switch(i){case"H":s&&(l===0?(o=1,h=0):l===1&&(o=0,h=1));break;case"C":s&&(o=0),u&&(p=Math.max(0,4-c-Math.abs(o))),h=If(l+p+Math.max(0,-o));break;case"N":if(s)if(!u)o=c-3;else if(d&&c<4)l-a===1&&c-a===2?o=1:o=0;else for(Mf.setElement(e,t,r);Mf.hasNext;){var v=Mf.move(),m=Br(v.otherUnit,v.otherIndex);if(m==="S"||wve(m)){o=0;break}else o=1}u&&(p=Math.max(0,3-c+o)),d&&!f?h=If(l+p-o):h=If(l+p+1-o);break;case"O":if(s&&(u||(o=c-2),c===1)){Mf.setElement(e,t,r);e:for(;Mf.hasNext;){var g=Mf.move();for(M2.setElement(e,g.otherUnit,g.otherIndex);M2.hasNext;){var y=M2.move();if(!(y.otherUnit===t&&y.otherIndex===r)&&Br(y.otherUnit,y.otherIndex)==="O"&&y.order===2){o=-1;break e}}}}u&&(p=Math.max(0,2-c+o)),d&&!f?h=If(l+p-o+1):h=If(l+p-o+2);break;case"S":s&&(u||(c<=3&&li(e,t,r,"O")===0?o=c-2:o=0)),u&&c<2&&(p=Math.max(0,2-c+o)),c<=3&&(h=If(l+p-o+2));break;case"F":case"CL":case"BR":case"I":case"AT":s&&(o=c-1);break;case"LI":case"NA":case"K":case"RB":case"CS":case"FR":s&&(o=1-c);break;case"BE":case"MG":case"CA":case"SR":case"BA":case"RA":s&&(o=2-c);break;default:Ir&&console.warn("Requested charge, protonation for an unhandled element",i)}return[o,p,p+a,h]}function Yme(e,t,r){var n=t.elements.length,a=new Int8Array(n),i=new Int8Array(n),o=new Int8Array(n),s=new Int8Array(n),u=!!e.parent,l;if(u){var c=e.root.unitMap.get(t.id);if(l=Je.indicesOf(c.elements,t.elements),l.length!==t.elements.length)throw new Error("expected to find an index for every element");t=c,e=e.root}for(var d=0;d<n;++d){var f=u?l[d]:d,p=Xme(e,t,f,r),h=p[0],v=p[1],m=p[2],g=p[3];a[d]=h,i[d]=v,o[d]=m,s[d]=g}return{charge:a,implicitH:i,totalH:o,idealGeometry:s}}var oB={assignCharge:E.Select("auto",[["always","always"],["auto","auto"],["never","never"]]),assignH:E.Select("auto",[["always","always"],["auto","auto"],["never","never"]])};function Kme(e,t,r){return ce(this,void 0,void 0,function(){var n,a,i,o,s,u;return de(this,function(l){for(n=w(w({},E.getDefaultValues(oB)),r),a=new Map,i=0,o=t.units.length;i<o;++i)s=t.units[i],ze.isAtomic(s)&&(u=Yme(t,s,n),a.set(s.id,u));return[2,a]})})}var D2=w({},oB),zv=yc.createProvider({label:"Valence Model",descriptor:Pi({name:"molstar_computed_valence_model"}),type:"local",defaultParams:D2,getParams:function(e){return D2},isApplicable:function(e){return!0},obtain:function(e,t,r){return ce(void 0,void 0,void 0,function(){var n,a;return de(this,function(i){switch(i.label){case 0:return n=w(w({},E.getDefaultValues(D2)),r),a={},[4,Kme(e.runtime,t,n)];case 1:return[2,(a.value=i.sent(),a)]}})})}}),yn;(function(e){function t(d,f,p,h){return C.set(d,h.x[p],h.y[p],h.z[p]),C.transformMat4(d,d,f.conformation.operator.matrix),d}e.setPosition=t;function r(d,f){for(var p=new Int32Array(f+1),h=new Int32Array(f),v=new Int32Array(f),m=d.members,g=d.count,y=d.offsets,b=0,x=y[g];b<x;++b)++v[m[b]];for(var S=0,b=0;b<f;b++)p[b]=S,S+=v[b];p[f]=S;for(var _=new Int32Array(S),b=0;b<g;++b)for(var A=y[b],T=y[b+1];A<T;++A){var I=m[A],M=p[I]+h[I];_[M]=b,++h[I]}return{indices:_,offsets:p}}e.createElementsIndex=r;function n(d,f){var p,h;return w(w({},f),{get lookup3d(){if(!p){var v={x:f.x,y:f.y,z:f.z,indices:ke.ofBounds(0,f.count)};p=Rd(v,hp(v))}return p},get elementsIndex(){return h||(h=r(f,d))},subset:function(v){return a(f,v)}})}e.create=n;function a(d,f){for(var p,h=d.count,v=d.types,m=[],g=0;g<h;++g)f.has(v[g])&&m.push(g);var y=Je.ofSortedArray(m);return{indices:y,get lookup3d(){if(!p){var b={x:d.x,y:d.y,z:d.z,indices:y};p=Rd(b,hp(b))}return p}}}e.createSubset=a;function i(d,f,p){var h=zv.get(d).value;if(!h||!h.has(f.id))throw new Error("valence model required");return{unit:f,types:p.types,feature:-1,x:p.x,y:p.y,z:p.z,members:p.members,offsets:p.offsets,idealGeometry:h.get(f.id).idealGeometry}}e.Info=i;function o(d,f){return C.set(d,f.x[f.feature],f.y[f.feature],f.z[f.feature]),C.transformMat4(d,d,f.unit.conformation.operator.matrix),d}e.position=o;var s=C(),u=C();function l(d,f){var p=d.members[d.offsets[d.feature]],h=f.members[f.offsets[f.feature]];return d.unit.conformation.position(d.unit.elements[p],s),f.unit.conformation.position(f.unit.elements[h],u),C.distance(s,u)}e.distance=l;function c(d,f){return{types:new Set(d),add:f}}e.Provider=c})(yn||(yn={}));var xC;(function(e){function t(r,n,a){r===void 0&&(r=2048),n===void 0&&(n=1024);var i=je.create(Float32Array,1,n,a?a.x:r),o=je.create(Float32Array,1,n,a?a.y:r),s=je.create(Float32Array,1,n,a?a.z:r),u=je.create(Uint8Array,1,n,a?a.types:r),l=je.create(Uint8Array,1,n,a?a.groups:r),c=je.create(Uint32Array,1,n,a?a.offsets:r),d=je.create(Uint32Array,1,n,a?a.members:r),f={x:0,y:0,z:0,offset:0,count:0};return{startState:function(){f.x=0,f.y=0,f.z=0,f.offset=d.elementCount,f.count=0},pushMember:function(p,h,v,m){je.add(d,m),f.x+=p,f.y+=h,f.z+=v,f.count+=1},finishState:function(p,h){var v=f.count;v!==0&&(je.add(u,p),je.add(l,h),je.add(i,f.x/v),je.add(o,f.y/v),je.add(s,f.z/v),je.add(c,f.offset))},add:function(p,h,v,m,g,y){je.add(u,p),je.add(l,h),je.add(i,v),je.add(o,m),je.add(s,g),je.add(c,d.elementCount),je.add(d,y)},getFeatures:function(p){je.add(c,d.elementCount);var h=je.compact(i,!0),v=je.compact(o,!0),m=je.compact(s,!0),g=i.elementCount;return yn.create(p,{x:h,y:v,z:m,count:g,types:je.compact(u,!0),groups:je.compact(l,!0),offsets:je.compact(c,!0),members:je.compact(d,!0)})}}}e.create=t})(xC||(xC={}));var CC;(function(e){function t(r,n,a){for(var i=new Int32Array(a+1),o=new Int32Array(a),s=new Int32Array(a),u=n.members,l=n.offsets,c=0,d=r.edgeCount*2;c<d;++c){var f=r.a[c],p=r.b[c];if(!(f>p)){for(var h=l[f],v=l[f+1];h<v;++h)++s[u[h]];for(var h=l[p],v=l[p+1];h<v;++h)++s[u[h]]}}for(var m=0,c=0;c<a;c++)i[c]=m,m+=s[c];i[a]=m;for(var g=new Int32Array(m),c=0,d=r.edgeCount*2;c<d;++c){var f=r.a[c],p=r.b[c];if(!(f>p)){for(var h=l[f],v=l[f+1];h<v;++h){var y=u[h],b=i[y]+o[y];g[b]=c,++o[y]}for(var h=l[p],v=l[p+1];h<v;++h){var y=u[h],b=i[y]+o[y];g[b]=c,++o[y]}}}return{indices:g,offsets:i}}e.createElementsIndex=t})(CC||(CC={}));var $me=function(e){Be(t,e);function t(r,n){var a=e.call(this,r)||this,i=0,o=new Map,s=function(u,l){var c=a.getElementKey(u,l),d=o.get(c);d===void 0?o.set(c,[i]):d.push(i)};return a.map.forEach(function(u){u.forEach(function(l){var c=l.unitA,d=l.connectedIndices;d.forEach(function(f){for(var p=n.get(c),h=p.offsets,v=p.members,m=h[f],g=h[f+1];m<g;++m)s(v[m],c);i+=1})})}),a.elementKeyIndex=o,a}return t.prototype.getContactIndicesForElement=function(r,n){return this.elementKeyIndex.get(this.getElementKey(r,n.id))||[]},t.prototype.getElementKey=function(r,n){return r+"|"+n},t}(Od);function N5(e){switch(e){case 4:return"Hydrogen Bond";case 6:return"Hydrophobic Contact";case 5:return"Halogen Bond";case 1:return"Ionic Interaction";case 7:return"Metal Coordination";case 2:return"Cation-Pi Interaction";case 3:return"Pi Stacking";case 8:return"Weak Hydrogen Bond";case 0:return"Unknown Interaction"}}function Qme(e){switch(e){case 0:return"None";case 1:return"Positive Charge";case 2:return"Negative Charge";case 3:return"Aromatic Ring";case 4:return"Hydrogen Donor";case 5:return"Hydrogen Acceptor";case 6:return"Halogen Donor";case 7:return"Halogen Acceptor";case 8:return"HydrophobicAtom";case 9:return"Weak Hydrogen Donor";case 10:return"Ionic Type Partner";case 11:return"Dative Bond Partner";case 12:return"Transition Metal";case 13:return"Ionic Type Metal"}}function Zme(e){switch(e){case 0:return"None";case 1:return"Quaternary Amine";case 2:return"Tertiary Amine";case 3:return"Sulfonium";case 4:return"Sulfonic Acid";case 5:return"Sulfate";case 6:return"Phosphate";case 7:return"Halocarbon";case 8:return"Guanidine";case 9:return"Acetamidine";case 10:return"Carboxylate"}}var _C;(function(e){function t(r,n){var a=[],i=[],o=[];return{add:function(s,u,l){a[a.length]=s,i[i.length]=u,o[o.length]=l},getContacts:function(){for(var s=new Ti.EdgeBuilder(r.count,a,i),u=new Int8Array(s.slotCount),l=new Int8Array(s.slotCount),c=0,d=s.edgeCount;c<d;c++)s.addNextEdge(),s.assignProperty(u,o[c]);var f=s.createGraph({type:u,flag:l}),p,h=Object.defineProperty(f,"elementsIndex",{get:function(){return p||(p=CC.createElementsIndex(f,r,n))}});return h}}}e.create=t})(_C||(_C={}));var wC;(function(e){function t(){var r=new Od.Builder;return{startUnitPair:function(n,a){r.startUnitPair(n.id,a.id)},finishUnitPair:function(){r.finishUnitPair()},add:function(n,a,i){r.add(n,a,{type:i,flag:0})},getContacts:function(n){return new $me(r.getMap(),n)}}}e.create=t})(wC||(wC={}));var Jme={lineOfSightDistFactor:E.Numeric(1,{min:0,max:3,step:.1})},e0e=3;function sB(e,t,r){var n=t.members[t.offsets[t.feature]],a=r.members[r.offsets[r.feature]];if(n===a&&t.unit===r.unit)return!1;var i=Ng(t.unit,n),o=Ng(r.unit,a);return!(i&&o&&i!==o||t.unit.residueIndex[t.unit.elements[n]]===r.unit.residueIndex[r.unit.elements[a]]&&t.unit===r.unit||Vme(e,t.unit,n,r.unit,a))}function U5(e,t,r,n){var a=Ng(e,t),i=Ng(r,n);return a&&i&&a!==i}function z5(e,t){for(var r=t.feature,n=t.offsets,a=t.members,i=n[r],o=n[r+1];i<o;++i)if(a[i]===e)return!0;return!1}var Tl=C(),R2=C(),O2=C(),t0e=$6();function uB(e,t,r,n){var a=t.feature,i=r.feature,o=t.members[t.offsets[a]],s=r.members[r.offsets[i]];yn.position(R2,t),yn.position(O2,r),C.scale(Tl,C.add(Tl,R2,O2),.5);var u=n*e0e,l=e.lookup3d.find(Tl[0],Tl[1],Tl[2],u,t0e),c=l.count,d=l.indices,f=l.units,p=l.squaredDistances;if(c===0)return!0;for(var h=0;h<c;++h){var v=d[h],m=f[h];if(!!ze.isAtomic(m)){var g=Br(m,v);if(g!=="H"){var y=Mv(g);if(!(y*y*n*n<=p[h])&&!(U5(m,v,t.unit,o)||U5(m,v,r.unit,s))&&!(t.unit===m&&z5(v,t)||r.unit===m&&z5(v,r))&&(m.conformation.position(m.elements[v],Tl),!(C.squaredDistance(Tl,R2)<1||C.squaredDistance(Tl,O2)<1)))return!1}}}return!0}function r0e(e,t,r,n,a,i){for(var o=0,s=a;o<s.length;o++){var u=s[o];n0e(e,t,r,n,u,i)}}function n0e(e,t,r,n,a,i){for(var o=r.x,s=r.y,u=r.z,l=r.subset(a.requiredFeatures),c=l.lookup3d,d=l.indices,f=yn.Info(e,t,r),p=w({},f),h=i.lineOfSightDistFactor,v=0,m=ke.size(d);v<m;++v){var g=ke.getAt(d,v),y=c.find(o[g],s[g],u[g],a.maxDistance),b=y.count,x=y.indices,S=y.squaredDistances;if(b!==0){f.feature=g;for(var _=0;_<b;++_){var A=ke.getAt(d,x[_]);if(!(A<=g)&&(p.feature=A,!!sB(e,f,p))){var T=a.getType(e,f,p,S[_]);T&&uB(e,f,p,h)&&n.add(g,A,T)}}}}}var a0e=ue();function i0e(e,t,r,n,a,i,o,s){var u=r.count,l=r.x,c=r.y,d=r.z,f=a.lookup3d,p=ue.mul(a0e,n.conformation.operator.inverse,t.conformation.operator.matrix),h=!ue.isIdentity(p),v=C(),m=Math.max.apply(Math,o.map(function(q){return q.maxDistance})),g=f.boundary.sphere,y=g.center,b=g.radius,x=(b+m)*(b+m),S=s.lineOfSightDistFactor,_=yn.Info(e,t,r),A=yn.Info(e,n,a);i.startUnitPair(t,n);for(var T=0;T<u;++T)if(C.set(v,l[T],c[T],d[T]),h&&C.transformMat4(v,v,p),!(C.squaredDistance(v,y)>x)){var I=f.find(v[0],v[1],v[2],m),M=I.indices,O=I.count,D=I.squaredDistances;if(O!==0){_.feature=T;for(var F=0;F<O;++F){var G=M[F];if(A.feature=G,!!sB(e,_,A))for(var N=D[F],z=0,$=o;z<$.length;z++){var j=$[z];if(N<j.maxDistance*j.maxDistance){var Z=j.getType(e,_,A,N);if(Z&&uB(e,_,A,S)){i.add(T,G,Z);break}}}}}}i.finishUnitPair()}var o0e={distanceMax:E.Numeric(4,{min:1,max:5,step:.1}),angleMax:E.Numeric(30,{min:0,max:60,step:1})},s0e=["CL","BR","I","AT"];function u0e(e,t,r){for(var n=t.elements,a=t.model.atomicConformation,i=a.x,o=a.y,s=a.z,u=0,l=n.length;u<l;++u){var c=Br(t,u);s0e.includes(c)&&r.add(6,0,i[n[u]],o[n[u]],s[n[u]],u)}}var l0e=["N","O","S"],c0e=["C","N","P","S"];function d0e(e,t,r){for(var n=t.elements,a=t.model.atomicConformation,i=a.x,o=a.y,s=a.z,u=function(d,f){var p=Br(t,d);if(l0e.includes(p)){var h=!1;Ro(e,t,d,function(v,m){c0e.includes(Br(v,m))&&(h=!0)}),h&&r.add(7,0,i[n[d]],o[n[d]],s[n[d]],d)}},l=0,c=n.length;l<c;++l)u(l)}function f0e(e,t){return e===7&&t===6||e===6&&t===7}var p0e=Wr(180),h0e=Wr(120);function v0e(e){return{angleMax:Wr(e.angleMax)}}function m0e(e,t,r,n){var a=t.types[t.feature],i=r.types[r.feature];if(!!f0e(a,i)){var o=a===6?[t,r]:[r,t],s=o[0],u=o[1],l=s.members[s.offsets[s.feature]],c=u.members[u.offsets[u.feature]],d=Hg(e,s.unit,l,u.unit,c);if(d.length===1&&!(p0e-d[0]>n.angleMax)){var f=Hg(e,u.unit,c,s.unit,l);if(f.length!==0&&!f.some(function(p){return h0e-p>n.angleMax}))return 5}}}var g0e=yn.Provider([6],u0e),y0e=yn.Provider([7],d0e),b0e={name:"halogen-bonds",params:o0e,createTester:function(e){var t=v0e(e);return{maxDistance:e.distanceMax,requiredFeatures:new Set([6,7]),getType:function(r,n,a){return m0e(r,n,a,t)}}}},lB={distanceMax:E.Numeric(3.5,{min:1,max:5,step:.1}),backbone:E.Boolean(!0,{description:"Include backbone-to-backbone hydrogen bonds"}),accAngleDevMax:E.Numeric(45,{min:0,max:180,step:1},{description:"Max deviation from ideal acceptor angle"}),donAngleDevMax:E.Numeric(45,{min:0,max:180,step:1},{description:"Max deviation from ideal donor angle"}),accOutOfPlaneAngleMax:E.Numeric(90,{min:0,max:180,step:1}),donOutOfPlaneAngleMax:E.Numeric(45,{min:0,max:180,step:1})},S0e=w(w({},lB),{water:E.Boolean(!1,{description:"Include water-to-water hydrogen bonds"}),sulfurDistanceMax:E.Numeric(4.1,{min:1,max:5,step:.1})}),x0e=w({},lB);function z3(e,t){var r=zv.get(e).value;if(!r)throw Error("expected valence model to be available");var n=r.get(t.id);if(!n)throw Error("expected valence model for unit to be available");return n}function C0e(e,t,r){for(var n=z3(e,t).totalH,a=t.elements,i=t.model.atomicConformation,o=i.x,s=i.y,u=i.z,l=t.rings.elementAromaticRingIndices,c=0,d=a.length;c<d;++c)if(!l.has(c)){var f=Br(t,c);(cB(t,c)||n[c]>0&&(f==="N"||f==="O"||f==="S"))&&r.add(4,0,o[a[c]],s[a[c]],u[a[c]],c)}}function _0e(e,t,r){for(var n=z3(e,t).totalH,a=t.elements,i=t.model.atomicConformation,o=i.x,s=i.y,u=i.z,l=0,c=a.length;l<c;++l)Br(t,l)==="C"&&n[l]>0&&(li(e,t,l,"N")>0||li(e,t,l,"O")>0||w0e(t,l))&&r.add(9,0,o[a[l]],s[a[l]],u[a[l]],l)}function w0e(e,t){var r=e.rings,n=r.elementAromaticRingIndices,a=r.all,i=n.get(t);if(i===void 0)return!1;for(var o=0,s=i.length;o<s;++o)for(var u=a[i[o]],l=0,c=u.length;l<c;++l){var d=Br(e,u[l]);if(d==="N"||d==="O")return!0}return!1}function A0e(e,t,r){for(var n=z3(e,t),a=n.charge,i=n.implicitH,o=n.idealGeometry,s=t.elements,u=t.model.atomicConformation,l=u.x,c=u.y,d=u.z,f=t.rings.elementAromaticRingIndices,p=function(x){r.add(5,0,l[s[x]],c[s[x]],d[s[x]],x)},h=0,v=s.length;h<v;++h)if(!f.has(h)){var m=Br(t,h);if(m==="O")p(h);else if(m==="N"){if(cB(t,h))p(h);else if(a[h]<1){var g=Yu(e,t,h)+i[h],y=o[h];(y===4&&g<4||y===3&&g<3||y===2&&g<2)&&p(h)}}else if(m==="S"){var b=U3(t,h);(b==="CYS"||b==="MET"||iB(t,h)===-1)&&p(h)}}}function V5(e,t){return e.model.atomicHierarchy.derived.residue.moleculeType[e.residueIndex[e.elements[t]]]===2}function H5(e,t){return Hu.has(Av(e,t))}function P0e(e,t){return e.rings.elementRingIndices.has(t)}function cB(e,t){return U3(e,t)==="HIS"&&Br(e,t)==="N"&&P0e(e,t)}function T0e(e,t,r,n){return H5(e,t)&&H5(r,n)}function E0e(e,t,r,n){return V5(e,t)&&V5(r,n)}function I0e(e,t){return e===5&&t===4||e===4&&t===5}function M0e(e,t){return e===9&&t===5||e===5&&t===9}function dB(e){return{includeBackbone:e.backbone,maxAccAngleDev:Wr(e.accAngleDevMax),maxDonAngleDev:Wr(e.donAngleDevMax),maxAccOutOfPlaneAngle:Wr(e.accOutOfPlaneAngleMax),maxDonOutOfPlaneAngle:Wr(e.donOutOfPlaneAngleMax)}}function D0e(e){return w(w({},dB(e)),{includeWater:e.water,maxSulfurDistSq:e.sulfurDistanceMax*e.sulfurDistanceMax,maxDistSq:e.distanceMax*e.distanceMax})}var G5=Wr(120);function fB(e,t,r,n){var a=t.members[t.offsets[t.feature]],i=r.members[r.offsets[r.feature]];if(!(!n.includeBackbone&&T0e(t.unit,a,r.unit,i))){var o=Hg(e,t.unit,a,r.unit,i),s=B5.get(t.idealGeometry[a])||G5;if(!o.some(function(d){return Math.abs(s-d)>n.maxDonAngleDev})){if(t.idealGeometry[a]===3){var u=L5(e,t.unit,a,r.unit,i);if(u!==void 0&&u>n.maxDonOutOfPlaneAngle)return}var l=Hg(e,r.unit,i,t.unit,a),c=B5.get(r.idealGeometry[i])||G5;if(!l.some(function(d){return c-d>n.maxAccAngleDev})){if(r.idealGeometry[i]===3){var u=L5(e,r.unit,i,t.unit,a);if(u!==void 0&&u>n.maxAccOutOfPlaneAngle)return}return!0}}}}function R0e(e,t,r,n,a){var i=t.types[t.feature],o=r.types[r.feature];if(!!I0e(i,o)){var s=o===5?[t,r]:[r,t],u=s[0],l=s[1],c=u.members[u.offsets[u.feature]],d=l.members[l.offsets[l.feature]],f=Br(u.unit,c)==="S"||Br(l.unit,d)==="S"?a.maxSulfurDistSq:a.maxDistSq;if(!(n>f)&&!(!a.includeWater&&E0e(u.unit,c,l.unit,d))&&!!fB(e,u,l,a))return 4}}function O0e(e,t,r,n,a){var i=t.types[t.feature],o=r.types[r.feature];if(!!M0e(i,o)){var s=o===5?[t,r]:[r,t],u=s[0],l=s[1];if(!!fB(e,u,l,a))return 8}}var F0e=yn.Provider([4],C0e),k0e=yn.Provider([9],_0e),B0e=yn.Provider([5],A0e),L0e={name:"hydrogen-bonds",params:S0e,createTester:function(e){var t=Math.max(e.distanceMax,e.sulfurDistanceMax),r=D0e(e);return{maxDistance:t,requiredFeatures:new Set([4,5]),getType:function(n,a,i,o){return R0e(n,a,i,o,r)}}}},N0e={name:"weak-hydrogen-bonds",params:x0e,createTester:function(e){var t=dB(e);return{maxDistance:e.distanceMax,requiredFeatures:new Set([9,5]),getType:function(r,n,a,i){return O0e(r,n,a,i,t)}}}};function U0e(e,t,r){return Br(t,r)==="S"&&li(e,t,r,"O")===3}function z0e(e,t,r){return Br(t,r)==="S"&&li(e,t,r,"O")===4}function q5(e,t,r){return Br(t,r)==="P"&&li(e,t,r,"O")===Yu(e,t,r)}function V0e(e,t,r){var n=0;return Br(t,r)==="C"&&li(e,t,r,"O")===2&&li(e,t,r,"C")===1&&Ro(e,t,r,function(a,i){Br(a,i)==="O"&&Yu(e,a,i)-li(e,a,i,"H")===1&&(n+=1)}),n===2}function H0e(e,t,r){var n=0;return Br(t,r)==="C"&&Yu(e,t,r)===3&&li(e,t,r,"N")===3&&Ro(e,t,r,function(a,i){Yu(e,a,i)-li(e,a,i,"H")===1&&(n+=1)}),n===2}function G0e(e,t,r){var n=0;return Br(t,r)==="C"&&Yu(e,t,r)===3&&li(e,t,r,"N")===2&&li(e,t,r,"C")===1&&Ro(e,t,r,function(a,i){Yu(e,a,i)-li(e,a,i,"H")===1&&(n+=1)}),n===2}var q0e={distanceMax:E.Numeric(5,{min:0,max:8,step:.1})},j0e={distanceMax:E.Numeric(5.5,{min:1,max:8,step:.1}),offsetMax:E.Numeric(2,{min:0,max:4,step:.1}),angleDevMax:E.Numeric(30,{min:0,max:180,step:1})},W0e={distanceMax:E.Numeric(6,{min:1,max:8,step:.1}),offsetMax:E.Numeric(2,{min:0,max:4,step:.1})},X0e=["ARG","HIS","LYS"],Y0e=["GLU","ASP"];function pB(e,t){var r=zv.get(e).value;if(!r)throw Error("expected valence model to be available");var n=r.get(t.id);if(!n)throw Error("expected valence model for unit to be available");return n}function K0e(e,t,r){for(var n=pB(e,t).charge,a=t.elements,i=t.model.atomicConformation,o=i.x,s=i.y,u=i.z,l=new Set,c=t.model.atomicHierarchy.atoms.label_comp_id,d=nr.transientSegments(t.model.atomicHierarchy.residueAtomSegments,a);d.hasNext;){var f=d.move(),p=f.index,h=f.start,v=f.end,m=c.value(t.model.atomicHierarchy.residueAtomSegments.offsets[p]);if(X0e.includes(m)){r.startState();for(var g=h;g<v;++g)Br(t,g)==="N"&&!Hu.has(Av(t,g))&&r.pushMember(o[a[g]],s[a[g]],u[a[g]],g);r.finishState(1,0)}else if(!Rv.has(m)){l.clear();for(var g=h;g<v;++g){var y=0;H0e(e,t,g)?y=8:G0e(e,t,g)&&(y=9),y&&(r.startState(),Ro(e,t,g,function(x,S){Br(t,S)==="N"&&(l.add(S),r.pushMember(o[a[S]],s[a[S]],u[a[S]],S))}),r.finishState(1,y))}for(var g=h;g<v;++g)n[g]>0&&!l.has(g)&&r.add(1,0,o[a[g]],s[a[g]],u[a[g]],g)}}}function $0e(e,t,r){for(var n=pB(e,t).charge,a=t.elements,i=t.model.atomicConformation,o=i.x,s=i.y,u=i.z,l=new Set,c=t.model.atomicHierarchy.atoms.label_comp_id,d=nr.transientSegments(t.model.atomicHierarchy.residueAtomSegments,a);d.hasNext;){var f=d.move(),p=f.index,h=f.start,v=f.end,m=c.value(t.model.atomicHierarchy.residueAtomSegments.offsets[p]);if(Y0e.includes(m)){r.startState();for(var g=h;g<v;++g)Br(t,g)==="O"&&!Hu.has(Av(t,g))&&r.pushMember(o[a[g]],s[a[g]],u[a[g]],g);r.finishState(2,0)}else if(qy.has(m))for(var g=h;g<v;++g)q5(e,t,g)&&(r.startState(),Ro(e,t,g,function(x,S){Br(t,S)==="O"&&r.pushMember(o[a[S]],s[a[S]],u[a[S]],S)}),r.finishState(2,6));else if(!Rv.has(m)){for(var g=h;g<v;++g){r.startState(),Br(t,g)==="N"&&!Hu.has(Av(t,g))&&r.pushMember(o[a[g]],s[a[g]],u[a[g]],g),r.finishState(2,0);var y=0;U0e(e,t,g)?y=4:q5(e,t,g)?y=6:z0e(e,t,g)?y=5:V0e(e,t,g)&&(y=10),y&&(r.startState(),Ro(e,t,g,function(x,S){Br(t,S)==="O"&&(l.add(S),r.pushMember(o[a[S]],s[a[S]],u[a[S]],S))}),r.finishState(2,y))}for(var g=h;g<v;++g)n[g]<0&&!l.has(g)&&r.add(2,0,o[a[g]],s[a[g]],u[a[g]],g)}}}function Q0e(e,t,r){for(var n=t.elements,a=t.model.atomicConformation,i=a.x,o=a.y,s=a.z,u=0,l=t.rings.aromaticRings;u<l.length;u++){var c=l[u],d=t.rings.all[c];r.startState();for(var f=0,p=d.length;f<p;++f){var h=d[f];r.pushMember(i[n[h]],o[n[h]],s[n[h]],h)}r.finishState(3,0)}}function Z0e(e,t){return e===2&&t===1||e===1&&t===2}function J0e(e,t){return e===3&&t===3}function ege(e,t){return e===3&&t===1||e===1&&t===3}var j5=C(),W5=C();function tge(e,t,r){for(var n=e.feature,a=e.offsets,i=e.members,o=t.feature,s=t.offsets,u=t.members,l=a[n],c=a[n+1];l<c;++l){var d=i[l];e.unit.conformation.position(e.unit.elements[d],j5);for(var f=s[o],p=s[o+1];f<p;++f){var h=u[f];if(t.unit.conformation.position(t.unit.elements[h],W5),C.squaredDistance(j5,W5)<r)return!0}}return!1}var Gg=C(),Kf=C(),qg=C(),qm=C();function AC(e,t){var r=t.unit,n=t.feature,a=t.offsets,i=t.members,o=r.elements,s=a[n];return t.unit.conformation.position(o[i[s]],Gg),t.unit.conformation.position(o[i[s+1]],Kf),t.unit.conformation.position(o[i[s+2]],qg),C.triangleNormal(e,Gg,Kf,qg)}var PC=function(e,t,r){return yn.position(Gg,e),yn.position(Kf,t),C.sub(qg,Gg,Kf),C.projectOnPlane(qm,qg,r),C.add(qm,qm,Kf),C.distance(qm,Kf)};function rge(e){return{distanceMaxSq:e.distanceMax*e.distanceMax}}function nge(e){return{offsetMax:e.offsetMax,angleDevMax:Wr(e.angleDevMax)}}function age(e){return{offsetMax:e.offsetMax}}var ige=Wr(180),X5=Wr(90),Kh=C(),F2=C();function oge(e,t,r,n,a){var i=t.types[t.feature],o=r.types[r.feature];if(Z0e(i,o)&&tge(t,r,a.distanceMaxSq))return 1}function sge(e,t,r,n,a){var i=t.types[t.feature],o=r.types[r.feature];if(J0e(i,o)){AC(Kh,t),AC(F2,r);var s=C.angle(Kh,F2),u=Math.min(PC(t,r,F2),PC(r,t,Kh));if(u<=a.offsetMax){if(s<=a.angleDevMax||s>=ige-a.angleDevMax)return 3;if(s<=a.angleDevMax+X5&&s>=X5-a.angleDevMax)return 3}}}function uge(e,t,r,n,a){var i=t.types[t.feature],o=r.types[r.feature];if(ege(i,o)){var s=i===3?[t,r]:[r,t],u=s[0],l=s[1];AC(Kh,u);var c=PC(l,u,Kh);if(c<=a.offsetMax)return 2}}var lge=yn.Provider([2],$0e),cge=yn.Provider([1],K0e),dge=yn.Provider([3],Q0e),fge={name:"ionic",params:q0e,createTester:function(e){var t=rge(e);return{maxDistance:e.distanceMax,requiredFeatures:new Set([2,1]),getType:function(r,n,a,i){return oge(r,n,a,i,t)}}}},pge={name:"pi-stacking",params:j0e,createTester:function(e){var t=nge(e);return{maxDistance:e.distanceMax,requiredFeatures:new Set([3]),getType:function(r,n,a,i){return sge(r,n,a,i,t)}}}},hge={name:"cation-pi",params:W0e,createTester:function(e){var t=age(e);return{maxDistance:e.distanceMax,requiredFeatures:new Set([3,1]),getType:function(r,n,a,i){return uge(r,n,a,i,t)}}}},vge={distanceMax:E.Numeric(4,{min:1,max:5,step:.1})};function mge(e,t,r){for(var n=t.elements,a=t.model.atomicConformation,i=a.x,o=a.y,s=a.z,u=function(d,f){var p=Br(t,d),h=!1;p==="C"?(h=!0,Ro(e,t,d,function(v,m){var g=Br(v,m);g!=="C"&&g!=="H"&&(h=!1)})):p==="F"&&(h=!0),h&&r.add(8,0,i[n[d]],o[n[d]],s[n[d]],d)},l=0,c=n.length;l<c;++l)u(l)}function gge(e,t){return e===8&&t===8}function yge(e,t,r,n){var a=t.types[t.feature],i=r.types[r.feature];if(!!gge(a,i)){var o=t.members[t.offsets[t.feature]],s=r.members[r.offsets[r.feature]];if(!(Br(t.unit,o)==="F"&&Br(r.unit,s)==="F"))return 6}}var bge=yn.Provider([8],mge),Sge={name:"hydrophobic",params:vge,createTester:function(e){return{maxDistance:e.distanceMax,requiredFeatures:new Set([8]),getType:function(t,r,n,a){return yge(t,r,n)}}}},xge={distanceMax:E.Numeric(3,{min:1,max:5,step:.1})},Cge=["LI","NA","K","RB","CS","MG","CA","SR","BA","AL","GA","IN","TL","SC","SN","PB","BI","SB","HG"];function _ge(e,t,r){for(var n=t.elements,a=t.model.atomicConformation,i=a.x,o=a.y,s=a.z,u=0,l=n.length;u<l;++u){var c=Br(t,u),d=0;Cge.includes(c)?d=13:(Nk(c)||c==="ZN"||c==="CD")&&(d=12),d&&r.add(d,0,i[n[u]],o[n[u]],s[n[u]],u)}}function Y5(e){return!Hu.has(e)}function wge(e){return Hu.has(e)}function Age(e){return Uy.has(e)}function Pge(e,t,r){for(var n=t.elements,a=t.model.atomicConformation,i=a.x,o=a.y,s=a.z,u=0,l=n.length;u<l;++u){var c=Br(t,u),d=U3(t,u),f=Av(t,u),p=!1,h=!1,v=Vy.has(d),m=qy.has(d);!v&&!m?xve(c)||c==="O"||c==="S"?(p=!0,h=!0):c==="N"&&(p=!0):v?c==="O"?(["ASP","GLU","SER","THR","TYR","ASN","GLN"].includes(d)&&Y5(f)||wge(f))&&(p=!0,h=!0):c==="S"&&(d==="CYS"||d==="MET")?(p=!0,h=!0):c==="N"&&d==="HIS"&&Y5(f)&&(p=!0):m&&(c==="O"&&Age(f)?(p=!0,h=!0):["N3","N4","N7"].includes(f)?p=!0:["O2","O4","O6"].includes(f)&&(p=!0,h=!0)),p&&r.add(11,0,i[n[u]],o[n[u]],s[n[u]],u),h&&r.add(10,0,i[n[u]],o[n[u]],s[n[u]],u)}}function K5(e,t){if(e===12)return t===11||t===12;if(e===13)return t===10}function Tge(e,t,r,n){var a=t.types[t.feature],i=r.types[r.feature];if(!(!K5(a,i)&&!K5(i,a)))return 7}var Ege=yn.Provider([13,12],_ge),Ige=yn.Provider([10,11],Pge),Mge={name:"metal-coordination",params:xge,createTester:function(e){return{maxDistance:e.distanceMax,requiredFeatures:new Set([13,12,10,11]),getType:function(t,r,n,a){return Tge(t,r,n)}}}};function Dge(e,t){for(var r=t.contacts,n=t.unitsContacts,a=t.unitsFeatures,i=[Rge(e,t),Oge(e,t),Fge(e,t),kge(e,t),Bge(e,t)],o=0,s=r.edgeCount;o<s;++o){var u=r.edges[o],l=e.unitMap.get(u.unitA),c=e.unitMap.get(u.unitB),d=yn.Info(e,l,a.get(u.unitA));d.feature=u.indexA;var f=yn.Info(e,c,a.get(u.unitB));f.feature=u.indexB;for(var p=0,h=i;p<h.length;p++){var v=h[p];v.isApplicable(u.props.type)&&v.handleInterContact(o,d,f)}}for(var m=n.keys();;){var g=m.next(),y=g.done,b=g.value;if(y)break;var x=n.get(b),S=a.get(b),_=e.unitMap.get(b);if(!!ze.isAtomic(_)){for(var d=yn.Info(e,_,S),f=yn.Info(e,_,S),A=0,T=i;A<T.length;A++){var v=T[A];v.startUnit(_,x,S)}for(var o=0,s=x.edgeCount*2;o<s;++o){d.feature=x.a[o],f.feature=x.b[o];for(var I=0,M=i;I<M.length;I++){var v=M[I];v.isApplicable(x.edgeProps.type[o])&&v.handleIntraContact(o,d,f)}}}}}function Rge(e,t){var r=t.contacts,n=function(l,c,d,f,p){var h=f.get(d)||[1/0,-1],v=h[0],m=h[1];l<v?(m!==-1&&p(m),f.set(d,[l,c])):p(c)};function a(l,c,d,f,p){var h=c.members[c.offsets[c.feature]],v=d.members[d.offsets[d.feature]],m=c.unit.getResidueIndex(h),g=d.unit.getResidueIndex(v),y=h+"|"+c.unit.id+"|"+g+"|"+d.unit.id+"|A",b=v+"|"+d.unit.id+"|"+m+"|"+c.unit.id+"|B",x=yn.distance(c,d);n(x,l,y,f,p),n(x,l,b,f,p)}var i=new Map,o=function(l){return r.edges[l].props.flag=1},s,u;return{isApplicable:function(l){return l===6},handleInterContact:function(l,c,d){a(l,c,d,i,o)},startUnit:function(l,c,d){s=new Map,u=function(f){return c.edgeProps.flag[f]=1}},handleIntraContact:function(l,c,d){a(l,c,d,s,u)}}}function Oge(e,t){var r=t.contacts,n=function(a,i){for(var o=a.types[a.feature]===9?i:a,s=o.members[o.offsets[o.feature]],u=t.unitsContacts.get(o.unit.id),l=u.edgeProps.type,c=u.elementsIndex,d=c.offsets,f=c.indices,p=d[s],h=d[s+1];p<h;++p)if(l[f[p]]===4)return!0;for(var v=r.getEdgeIndices(o.feature,o.unit.id),p=0,h=v.length;p<h;++p)if(r.edges[v[p]].props.type===4)return!0;return!1};return{isApplicable:function(a){return a===8},handleInterContact:function(a,i,o){n(i,o)&&(r.edges[a].props.flag=1)},startUnit:function(){},handleIntraContact:function(a,i,o){if(n(i,o)){var s=t.unitsContacts.get(i.unit.id).edgeProps.flag;s[a]=1}}}}function V3(e,t,r,n,a){for(var i=r.offsets,o=r.feature,s=n.offsets,u=n.feature,l=i[o],c=i[o+1];l<c;++l)for(var d=r.members[l],f=a.getContactIndicesForElement(d,r.unit),p=0,h=f.length;p<h;++p){var v=f[p];if(e.includes(a.edges[v].props.type))for(var m=s[u],g=s[u+1];m<g;++m){var y=n.members[m];if(a.getContactIndicesForElement(y,n.unit).includes(v)){a.edges[t].props.flag=1;return}}}}function H3(e,t,r,n,a){for(var i=a.edgeProps,o=i.type,s=i.flag,u=a.elementsIndex,l=u.offsets,c=u.indices,d=r.offsets,f=r.feature,p=n.offsets,h=n.feature,v=d[f],m=d[f+1];v<m;++v)for(var g=r.members[v],y=l[g],b=l[g+1];y<b;++y){var x=c[y];if(e.includes(o[x])){for(var S=p[h],_=p[h+1];S<_;++S)for(var A=n.members[S],T=l[A],I=l[A+1];T<I;++T)if(x===c[T]){s[t]=1;return}}}}function Fge(e,t){var r=t.contacts;return{isApplicable:function(n){return n===1},handleInterContact:function(n,a,i){V3([4,8],n,a,i,r)},startUnit:function(){},handleIntraContact:function(n,a,i){H3([4,8],n,a,i,t.unitsContacts.get(a.unit.id))}}}function kge(e,t){var r=t.contacts;return{isApplicable:function(n){return n===6||n===2},handleInterContact:function(n,a,i){V3([3],n,a,i,r)},startUnit:function(){},handleIntraContact:function(n,a,i){H3([3],n,a,i,t.unitsContacts.get(a.unit.id))}}}function Bge(e,t){var r=t.contacts;return{isApplicable:function(n){return n===1},handleInterContact:function(n,a,i){V3([7],n,a,i,r)},startUnit:function(){},handleIntraContact:function(n,a,i){H3([7],n,a,i,t.unitsContacts.get(a.unit.id))}}}var Ku;(function(e){function t(c,d,f,p,h,v){return t6("interactions",{structure:d,interactions:c},{unitA:f,indexA:p,unitB:h,indexB:v})}e.Location=t;function r(c){return!!c&&c.kind==="data-location"&&c.tag==="interactions"}e.isLocation=r;function n(c,d){return c.data.structure===d.data.structure&&c.data.interactions===d.data.interactions&&c.element.indexA===d.element.indexA&&c.element.indexB===d.element.indexB&&c.element.unitA===d.element.unitA&&c.element.unitB===d.element.unitB}e.areLocationsEqual=n;function a(c,d){var f=d.unitA,p=d.indexA,h=d.unitB,v=d.indexB,m=c.contacts,g=c.unitsContacts;if(f===h){var y=g.get(f.id),b=y.getDirectedEdgeIndex(p,v);return N5(y.edgeProps.type[b])}else{var b=m.getEdgeIndex(p,f.id,v,h.id);return N5(m.edges[b].props.type)}}function i(c){return a(c.data.interactions,c.element)}e.locationLabel=i;function o(c,d,f){return i1("interactions",{structure:c,interactions:d},f,function(p){return u(d,f,p)},function(){return l(c,d,f)})}e.Loci=o;function s(c){return!!c&&c.kind==="data-loci"&&c.tag==="interactions"}e.isLoci=s;function u(c,d,f){var p=c.unitsFeatures;return qu.fromPairProvider(d.length,function(h,v,m){var g=d[h];yn.setPosition(v,g.unitA,g.indexA,p.get(g.unitA.id)),yn.setPosition(m,g.unitB,g.indexB,p.get(g.unitB.id))},f)}e.getBoundingSphere=u;function l(c,d,f){var p=f[0];if(p===void 0)return"";var h=p.unitA,v=p.indexA,m=p.unitB,g=p.indexB,y=d.unitsFeatures,b=y.get(h.id),x=b.members,S=b.offsets,_=y.get(m.id),A=_.members,T=_.offsets,I={granularity:"element"};return(S[v+1]-S[v]>1||T[g+1]-T[g]>1)&&(I.granularity="residue"),[a(d,p),E3(Ht.Location(c,h,x[S[v]],c,m,A[T[g]]),I)].join("</br>")}e.getLabel=l})(Ku||(Ku={}));var Lge=[F0e,k0e,B0e,lge,cge,dge,g0e,y0e,bge,Ege,Ige],jg={ionic:fge,"pi-stacking":pge,"cation-pi":hge,"halogen-bonds":b0e,"hydrogen-bonds":L0e,"weak-hydrogen-bonds":N0e,hydrophobic:Sge,"metal-coordination":Mge};function Nge(e){e===void 0&&(e=[]);var t=Object.create(null);return Object.keys(jg).forEach(function(r){t[r]=E.MappedStatic(e.includes(r)?"on":"off",{on:E.Group(jg[r].params),off:E.Group({})},{cycle:!0})}),t}var Uge=Nge(["cation-pi","pi-stacking","hydrogen-bonds","halogen-bonds","metal-coordination"]),hB={providers:E.Group(Uge,{isFlat:!0}),contacts:E.Group(Jme,{label:"Advanced Options"})};function zge(e,t,r){return ce(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d,f,p,h,v,m,g,y;return de(this,function(b){switch(b.label){case 0:return n=w(w({},E.getDefaultValues(hB)),r),[4,zv.attach(e,t)];case 1:b.sent(),a=[],a1(jg).forEach(function(x){var S=n.providers[x],_=S.name,A=S.params;_==="on"&&a.push(jg[x].createTester(A))}),i=new Set,a.forEach(function(x){return jn.add(i,x.requiredFeatures)}),o=Lge.filter(function(x){return jn.areIntersecting(i,x.types)}),s=Eo.Mutable(),u=Eo.Mutable(),l=0,c=t.unitSymmetryGroups.length,b.label=2;case 2:return l<c?(d=t.unitSymmetryGroups[l],e.runtime.shouldUpdate?[4,e.runtime.update({message:"computing interactions",current:l,max:c})]:[3,4]):[3,6];case 3:b.sent(),b.label=4;case 4:for(f=Vge(t,d.units[0],o),p=Hge(t,d.units[0],f,a,n.contacts),h=0,v=d.units.length;h<v;++h)m=d.units[h],s.set(m.id,f),u.set(m.id,p);b.label=5;case 5:return++l,[3,2];case 6:return g=Gge(t,s,a,n.contacts),y={unitsFeatures:s,unitsContacts:u,contacts:g},Dge(t,y),[2,y]}})})}function Vge(e,t,r){var n=t.elements.length,a=xC.create(n,n/2);if(ze.isAtomic(t))for(var i=0,o=r;i<o.length;i++){var s=o[i];s.add(e,t,a)}return a.getFeatures(n)}function Hge(e,t,r,n,a){var i=_C.create(r,t.elements.length);return ze.isAtomic(t)&&r0e(e,t,r,i,n,a),i.getContacts()}function Gge(e,t,r,n){var a=wC.create();return Xe.eachUnitPair(e,function(i,o){var s=t.get(i.id),u=t.get(o.id);i0e(e,i,s,o,u,a,r,n)},{maxRadius:Math.max.apply(Math,r.map(function(i){return i.maxDistance})),validUnit:function(i){return ze.isAtomic(i)},validUnitPair:function(i,o){return Xe.validUnitPair(e,i,o)}}),a.getContacts(t)}var k2=w({},hB),Dn=yc.createProvider({label:"Interactions",descriptor:Pi({name:"molstar_computed_interactions"}),type:"local",defaultParams:k2,getParams:function(e){return k2},isApplicable:function(e){return!e.isCoarseGrained},obtain:function(e,t,r){return ce(void 0,void 0,void 0,function(){var n,a;return de(this,function(i){switch(i.label){case 0:return n=w(w({},E.getDefaultValues(k2)),r),a={},[4,zge(e,t,n)];case 1:return[2,(a.value=i.sent(),a)]}})})}}),jm=C(),Wm=C(),qc=C(),B2=je.add,$5=je.add3,Wg;(function(e){function t(r,n,a){r===void 0&&(r=2048),n===void 0&&(n=1024);var i=je.create(Float32Array,1,n,a?a.groupBuffer.ref.value:r),o=je.create(Float32Array,3,n,a?a.startBuffer.ref.value:r),s=je.create(Float32Array,3,n,a?a.endBuffer.ref.value:r),u=je.create(Float32Array,1,n,a?a.scaleBuffer.ref.value:r),l=je.create(Float32Array,1,n,a?a.capBuffer.ref.value:r),c=function(f,p,h,v,m,g,y,b,x,S){for(var _=0;_<6;++_)$5(o,f,p,h),$5(s,v,m,g),B2(i,S),B2(u,y),B2(l,(b?1:0)+(x?2:0))},d=function(f,p,h,v,m,g,y){var b=C.distance(f,p),x=Math.floor(h/2),S=1/h;C.sub(qc,p,f);for(var _=0;_<x;++_){var A=S*(_*2+1);C.setMagnitude(qc,qc,b*A),C.add(jm,f,qc),C.setMagnitude(qc,qc,b*S*((_+1)*2)),C.add(Wm,f,qc),c(jm[0],jm[1],jm[2],Wm[0],Wm[1],Wm[2],v,m,g,y)}};return{add:c,addFixedCountDashes:d,addFixedLengthDashes:function(f,p,h,v,m,g,y){var b=C.distance(f,p);d(f,p,b/h,v,m,g,y)},getCylinders:function(){var f=i.elementCount/6,p=je.compact(i,!0),h=je.compact(o,!0),v=je.compact(s,!0),m=je.compact(u,!0),g=je.compact(l,!0),y=a&&f<=a.cylinderCount?a.mappingBuffer.ref.value:new Float32Array(f*18),b=a&&f<=a.cylinderCount?a.indexBuffer.ref.value:new Uint32Array(f*12);return(!a||f>a.cylinderCount)&&qge(f,y,b),Wi.create(y,b,p,h,v,m,g,f,a)}}}e.create=t})(Wg||(Wg={}));function qge(e,t,r){for(var n=0;n<e;++n){var a=n*18;t[a]=-1,t[a+1]=1,t[a+2]=-1,t[a+3]=-1,t[a+4]=-1,t[a+5]=-1,t[a+6]=1,t[a+7]=1,t[a+8]=-1,t[a+9]=1,t[a+10]=1,t[a+11]=1,t[a+12]=1,t[a+13]=-1,t[a+14]=-1,t[a+15]=1,t[a+16]=-1,t[a+17]=1}for(var n=0;n<e;++n){var i=n*6,o=n*12;r[o]=i,r[o+1]=i+1,r[o+2]=i+2,r[o+3]=i+1,r[o+4]=i+4,r[o+5]=i+2,r[o+6]=i+2,r[o+7]=i+4,r[o+8]=i+3,r[o+9]=i+4,r[o+10]=i+5,r[o+11]=i+3}}var nf={linkScale:E.Numeric(.45,{min:0,max:1,step:.01}),linkSpacing:E.Numeric(1,{min:0,max:2,step:.01}),linkCap:E.Boolean(!1),dashCount:E.Numeric(4,{min:2,max:10,step:2}),dashScale:E.Numeric(.8,{min:0,max:2,step:.1}),dashCap:E.Boolean(!0),stubCap:E.Boolean(!0),radialSegments:E.Numeric(16,{min:2,max:56,step:2},At.CustomQualityParamInfo)};E.getDefaultValues(nf);var vB={linkScale:E.Numeric(.5,{min:0,max:1,step:.1}),linkSpacing:E.Numeric(.1,{min:0,max:2,step:.01}),dashCount:E.Numeric(4,{min:2,max:10,step:2})};E.getDefaultValues(vB);var An=C(),El=C(),uo=C(),jge=C.create(0,1,0);function G3(e,t,r,n){C.normalize(El,C.sub(El,t,r)),n!==null?C.sub(uo,t,n):C.copy(uo,t),C.normalize(uo,uo);var a=C.dot(El,uo);return 1-Math.abs(a)<1e-5&&(C.set(uo,1,0,0),a=C.dot(El,uo),1-Math.abs(a)<1e-5&&(C.set(uo,0,1,0),a=C.dot(El,uo))),C.setMagnitude(El,El,a),C.sub(uo,uo,El),C.normalize(e,uo)}var $o=C.scale,Hi=C.add,aa=C.sub,Fu=C.setMagnitude,Wge=C.dot;function af(e,t,r,n){var a=t.linkCount,i=t.referencePosition,o=t.position,s=t.style,u=t.radius,l=t.ignore,c=t.stub;if(!a)return Lt.createEmpty(n);for(var d=r.linkScale,f=r.linkSpacing,p=r.radialSegments,h=r.linkCap,v=r.dashCount,m=r.dashScale,g=r.dashCap,y=r.stubCap,b=p*2*a*2,x=_t.createState(b,b/4,n),S=C(),_=C(),A=C(),T={radiusTop:1,radiusBottom:1,radialSegments:p,topCap:h,bottomCap:h},I=v+1,M=0,O=a;M<O;++M)if(!(l&&l(M))){o(S,_,M),aa(An,_,S);var D=u(M),F=s?s(M):0,G=y&&(c?c(M):!1),N=Wge(An,jge)>0?[G,h]:[h,G],z=N[0],$=N[1];x.currentGroup=M;var j=4.5;if(F===0)T.radiusTop=T.radiusBottom=D,T.topCap=z,T.bottomCap=$,$a(x,S,_,.5,T);else if(F===1)T.radiusTop=T.radiusBottom=D*m,T.topCap=T.bottomCap=g,Xh(x,S,_,.5,I,T);else if(F===2||F===3||F===5||F===6){var Z=F===2?2:F===3?3:1.5,q=D*(d/(.5*Z)),te=(D-q)*f;G3(A,S,_,i?i(M):null),T.topCap=z,T.bottomCap=$,F===5||F===6?(T.radiusTop=T.radiusBottom=D,$a(x,S,_,.5,T),T.radiusTop=T.radiusBottom=D*d,T.topCap=T.bottomCap=g,Fu(A,A,te*j),aa(S,S,A),aa(_,_,A),Xh(x,S,_,.5,3,T),F===6&&(Fu(A,A,te*j*2),Hi(S,S,A),Hi(_,_,A),Xh(x,S,_,.5,3,T))):(Fu(A,A,te),T.radiusTop=T.radiusBottom=q,Z===3&&$a(x,S,_,.5,T),Cue(x,S,_,.5,A,T))}else F===4&&($o(An,An,.475),Hi(S,S,An),aa(_,_,An),T.radiusTop=T.radiusBottom=D,T.topCap=z,T.bottomCap=$,$a(x,S,_,.5,T))}return _t.getMesh(x)}function mB(e,t,r,n){var a=t.linkCount,i=t.referencePosition,o=t.position,s=t.style,u=t.radius,l=t.ignore,c=t.stub;if(!a)return Wi.createEmpty(n);for(var d=r.linkScale,f=r.linkSpacing,p=r.linkCap,h=r.dashCount,v=r.dashScale,m=r.dashCap,g=r.stubCap,y=a*2,b=Wg.create(y,y/4,n),x=C(),S=C(),_=C(),A=C(),T=h%2===1?h:h+1,I=.5-.5/2/T,M=3,O=.5-.5/2/M,D=4.5,F=0,G=a;F<G;++F)if(!(l&&l(F))){o(x,S,F);var N=u(F),z=s?s(F):0,$=g&&(c?c(F):!1);if(z===0)$o(_,Hi(_,x,S),.5),b.add(x[0],x[1],x[2],_[0],_[1],_[2],1,p,$,F);else if(z===1)$o(An,aa(An,S,x),I),aa(S,S,An),b.addFixedCountDashes(x,S,T,v,m,m,F);else if(z===2||z===3||z===5||z===6){var j=z===2?2:z===3?3:1.5,Z=d/(.5*j),q=(N-Z*N)*f;$o(_,Hi(_,x,S),.5),G3(A,x,S,i?i(F):null),z===5||z===6?(b.add(x[0],x[1],x[2],_[0],_[1],_[2],1,p,$,F),$o(An,aa(An,S,x),O),aa(S,S,An),Fu(A,A,q*D),aa(x,x,A),aa(S,S,A),b.addFixedCountDashes(x,S,M,d,m,m,F),z===6&&(Fu(A,A,q*D*2),Hi(x,x,A),Hi(S,S,A),b.addFixedCountDashes(x,S,M,d,m,m,F))):(Fu(A,A,q),j===3&&b.add(x[0],x[1],x[2],_[0],_[1],_[2],Z,p,!1,F),b.add(x[0]+A[0],x[1]+A[1],x[2]+A[2],_[0]+A[0],_[1]+A[1],_[2]+A[2],Z,p,$,F),b.add(x[0]-A[0],x[1]-A[1],x[2]-A[2],_[0]-A[0],_[1]-A[1],_[2]-A[2],Z,p,$,F))}else z===4&&($o(An,aa(An,S,x),.475),Hi(x,x,An),aa(S,S,An),b.add(x[0],x[1],x[2],S[0],S[1],S[2],1,p,$,F))}return b.getCylinders()}function gB(e,t,r,n){var a=t.linkCount,i=t.referencePosition,o=t.position,s=t.style,u=t.ignore;if(!a)return mn.createEmpty(n);for(var l=r.linkScale,c=r.linkSpacing,d=r.dashCount,f=a*2,p=Zi.create(f,f/4,n),h=C(),v=C(),m=C(),g=C(),y=d%2===1?d:d+1,b=.5-.5/2/y,x=3,S=.5-.5/2/x,_=4.5,A=0,T=a;A<T;++A)if(!(u&&u(A))){o(h,v,A);var I=s?s(A):0;if(I===0)$o(m,Hi(m,h,v),.5),p.add(h[0],h[1],h[2],m[0],m[1],m[2],A);else if(I===1)$o(An,aa(An,v,h),b),aa(v,v,An),p.addFixedCountDashes(h,v,y,A);else if(I===2||I===3||I===5||I===6){var M=I===2?2:I===3?3:1.5,O=1*(l/(.5*M)),D=(1-O)*c;$o(m,Hi(m,h,v),.5),G3(g,h,v,i?i(A):null),I===5||I===6?(p.add(h[0],h[1],h[2],m[0],m[1],m[2],A),$o(An,aa(An,v,h),S),aa(v,v,An),Fu(g,g,D*_),aa(h,h,g),aa(v,v,g),p.addFixedCountDashes(h,v,x,A),I===6&&(Fu(g,g,D*_*2),Hi(h,h,g),Hi(v,v,g),p.addFixedCountDashes(h,v,x,A))):(Fu(g,g,D),M===3&&p.add(h[0],h[1],h[2],m[0],m[1],m[2],A),p.add(h[0]+g[0],h[1]+g[1],h[2]+g[2],m[0]+g[0],m[1]+g[1],m[2]+g[2],A),p.add(h[0]-g[0],h[1]-g[1],h[2]-g[2],m[0]-g[0],m[1]-g[1],m[2]-g[2],A))}else I===4&&($o(An,aa(An,v,h),.475),Hi(h,h,An),aa(v,v,An),p.add(h[0],h[1],h[2],v[0],v[1],v[2],A))}return p.getLines()}function Xge(e,t,r,n,a,i){return ce(this,void 0,void 0,function(){var o,s,u,l,c,d,f,p,h,v,m,g,y,b,x,S,_,A,T;return de(this,function(I){return ze.isAtomic(t)?(o=r.child,s=o==null?void 0:o.unitMap.get(t.id),o&&!s?[2,Lt.createEmpty(i)]:(u=Ze.create(r,t),l=Dn.get(r).value,c=l.unitsFeatures.get(t.id),d=l.unitsContacts.get(t.id),f=c.x,p=c.y,h=c.z,v=c.members,m=c.offsets,g=d.edgeCount,y=d.a,b=d.b,x=d.edgeProps.flag,S=a.sizeFactor,g?(_={linkCount:g*2,position:function(M,O,D){C.set(M,f[y[D]],p[y[D]],h[y[D]]),C.set(O,f[b[D]],p[b[D]],h[b[D]])},style:function(M){return 1},radius:function(M){u.element=t.elements[v[m[y[M]]]];var O=n.size.size(u);u.element=t.elements[v[m[b[M]]]];var D=n.size.size(u);return Math.min(O,D)*S},ignore:function(M){return x[M]===1||!!s&&!Je.has(s.elements,t.elements[v[m[y[M]]]])}},A=af(e,_,a,i),T=Ne.expand(Ne(),(s!=null?s:t).boundary.sphere,1*S),A.setBoundingSphere(T),[2,A]):[2,Lt.createEmpty(i)])):[2,Lt.createEmpty(i)]})})}var yB=w(w(w({},Va),nf),{sizeFactor:E.Numeric(.3,{min:0,max:10,step:.01}),dashCount:E.Numeric(6,{min:2,max:10,step:2}),dashScale:E.Numeric(.4,{min:0,max:2,step:.1}),includeParent:E.Boolean(!1)});function Yge(e){return pi({defaultProps:E.getDefaultValues(yB),createGeometry:Xge,createLocationIterator:Qge,getLoci:Kge,eachLocation:$ge,setUpdateState:function(t,r,n,a,i,o,s){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.dashCount!==n.dashCount||r.dashScale!==n.dashScale||r.dashCap!==n.dashCap||r.radialSegments!==n.radialSegments;var u=Dn.get(o.structure).version;t.info.interactionsHash!==u&&(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.info.interactionsHash=u)}},e)}function Kge(e,t,r){var n=e.objectId,a=e.instanceId,i=e.groupId;if(r===n){var o=t.structure,s=t.group,u=o.unitMap.get(s.units[a].id),l=Dn.get(o).value,c=l.unitsContacts.get(u.id),d=c.a,f=c.b;return Ku.Loci(o,l,[{unitA:u,indexA:d[i],unitB:u,indexB:f[i]},{unitA:u,indexA:f[i],unitB:u,indexB:d[i]}])}return Or}function $ge(e,t,r,n){var a=!1;if(Ku.isLoci(e)){var i=t.structure,o=t.group;if(!Xe.areEquivalent(e.data.structure,i))return!1;var s=Dn.get(i).value;if(e.data.interactions!==s)return!1;for(var u=o.units[0],l=s.unitsContacts.get(u.id),c=l.edgeCount*2,d=0,f=e.elements;d<f.length;d++){var p=f[d];if(p.unitA===p.unitB){var h=o.unitIndexMap.get(p.unitA.id);if(h!==void 0){var v=l.getDirectedEdgeIndex(p.indexA,p.indexB);v!==-1&&r(Ie.ofSingleton(h*c+v))&&(a=!0)}}}}else if(Re.is(e)){var i=t.structure,o=t.group;if(!Xe.areEquivalent(e.structure,i))return!1;var s=Dn.get(i).value;if(!s)return!1;for(var u=o.units[0],l=s.unitsContacts.get(u.id),m=s.unitsFeatures.get(u.id),g=l.edgeCount*2,y=l.offset,b=m.elementsIndex,x=b.offsets,S=b.indices,_=function(G){var N=o.unitIndexMap.get(G.unit.id);if(N!==void 0||n&&ke.size(G.indices)===1)return"continue";ke.forEach(G.indices,function(z){for(var $=x[z],j=x[z+1];$<j;++$)for(var Z=S[$],q=y[Z],te=y[Z+1];q<te;++q)r(Ie.ofSingleton(N*g+q))&&(a=!0)})},A=0,T=e.elements;A<T.length;A++){var p=T[A];_(p)}}return a}function Qge(e){var t=e.structure,r=e.group,n=r.units[0],a=Dn.get(t).value,i=a.unitsContacts.get(n.id),o=i.edgeCount*2,s=r.units.length,u=Ku.Location(a,t),l=u.element,c=function(d,f){var p=r.units[f];return l.unitA=p,l.indexA=i.a[d],l.unitB=p,l.indexB=i.b[d],u};return pn(o,s,1,c)}function Zge(e,t,r,n,a){if(!t.hasAtomic)return Lt.createEmpty(a);var i=Ze.create(t),o=Dn.get(t).value,s=o.contacts,u=o.unitsFeatures,l=s.edgeCount,c=s.edges,d=n.sizeFactor;if(!l)return Lt.createEmpty(a);var f=t.child,p={linkCount:l,position:function(m,g,y){var b=c[y],x=b.unitA,S=b.indexA,_=b.unitB,A=b.indexB,T=u.get(x),I=u.get(_),M=t.unitMap.get(x),O=t.unitMap.get(_);C.set(m,T.x[S],T.y[S],T.z[S]),C.transformMat4(m,m,M.conformation.operator.matrix),C.set(g,I.x[A],I.y[A],I.z[A]),C.transformMat4(g,g,O.conformation.operator.matrix)},style:function(m){return 1},radius:function(m){var g=c[m],y=u.get(g.unitA);i.unit=t.unitMap.get(g.unitA),i.element=i.unit.elements[y.members[y.offsets[g.indexA]]];var b=r.size.size(i),x=u.get(g.unitB);i.unit=t.unitMap.get(g.unitB),i.element=i.unit.elements[x.members[x.offsets[g.indexB]]];var S=r.size.size(i);return Math.min(b,S)*d},ignore:function(m){if(c[m].props.flag===1)return!0;if(f){var g=c[m],y=f.unitMap.get(g.unitA);if(!y)return!0;var b=t.unitMap.get(g.unitA),x=u.get(g.unitA),S=b.elements[x.members[x.offsets[g.indexA]]];if(!Je.has(y.elements,S))return!0}return!1}},h=af(e,p,n,a),v=Ne.expand(Ne(),(f!=null?f:t).boundary.sphere,1*d);return h.setBoundingSphere(v),h}var bB=w(w(w({},Uv),nf),{sizeFactor:E.Numeric(.3,{min:0,max:10,step:.01}),dashCount:E.Numeric(6,{min:2,max:10,step:2}),dashScale:E.Numeric(.4,{min:0,max:2,step:.1}),includeParent:E.Boolean(!1)});function Jge(e){return tf({defaultProps:E.getDefaultValues(bB),createGeometry:Zge,createLocationIterator:rye,getLoci:eye,eachLocation:tye,setUpdateState:function(t,r,n,a,i,o,s){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.dashCount!==n.dashCount||r.dashScale!==n.dashScale||r.dashCap!==n.dashCap||r.radialSegments!==n.radialSegments;var u=Dn.get(o).version;t.info.interactionsHash!==u&&(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.info.interactionsHash=u)}},e)}function eye(e,t,r){var n=e.objectId,a=e.groupId;if(r===n){var i=Dn.get(t).value,o=i.contacts.edges[a],s=t.unitMap.get(o.unitA),u=t.unitMap.get(o.unitB);return Ku.Loci(t,i,[{unitA:s,indexA:o.indexA,unitB:u,indexB:o.indexB},{unitA:u,indexA:o.indexB,unitB:s,indexB:o.indexA}])}return Or}function tye(e,t,r,n){var a,i=!1;if(Ku.isLoci(e)){if(!Xe.areEquivalent(e.data.structure,t))return!1;var o=Dn.get(t).value;if(e.data.interactions!==o)return!1;for(var s=o.contacts,u=0,l=e.elements;u<l.length;u++){var c=l[u],d=s.getEdgeIndex(c.indexA,c.unitA.id,c.indexB,c.unitB.id);d!==-1&&r(Ie.ofSingleton(d))&&(i=!0)}}else if(Re.is(e)){if(!Xe.areEquivalent(e.structure,t)||n&&e.elements.length===1)return!1;var f=(a=Dn.get(t).value)===null||a===void 0?void 0:a.contacts;if(!f)return!1;for(var p=function(g){var y=g.unit;if(!ze.isAtomic(y)||n&&ke.size(g.indices)===1)return"continue";ke.forEach(g.indices,function(b){for(var x=0,S=f.getContactIndicesForElement(b,y);x<S.length;x++){var _=S[x];r(Ie.ofSingleton(_))&&(i=!0)}})},h=0,v=e.elements;h<v.length;h++){var m=v[h];p(m)}}return i}function rye(e){var t=Dn.get(e).value,r=t.contacts,n=r.edgeCount,a=1,i=Ku.Location(t,e),o=i.element,s=function(u){var l=r.edges[u];return o.unitA=e.unitMap.get(l.unitA),o.indexA=l.indexA,o.unitB=e.unitMap.get(l.unitB),o.indexB=l.indexB,i};return pn(n,a,1,s,!0)}var SB={"intra-unit":function(e,t){return Un("Intra-unit interactions cylinder",e,t,Yge)},"inter-unit":function(e,t){return as("Inter-unit interactions cylinder",e,t,Jge)}},xB=w(w(w({},yB),bB),{unitKinds:Nv(["atomic"]),sizeFactor:E.Numeric(.2,{min:.01,max:1,step:.01}),visuals:E.MultiSelect(["intra-unit","inter-unit"],E.objectToOptions(SB))});function nye(e,t){return E.clone(xB)}function aye(e,t){return or.createMulti("Interactions",e,t,da,SB)}var Xg={name:"interactions",label:"Non-covalent Interactions",description:"Displays non-covalent interactions as dashed cylinders.",factory:aye,getParams:nye,defaultValues:E.getDefaultValues(xB),defaultColorTheme:{name:"interaction-type"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.elementCount>0&&Dn.isApplicable(e)},ensureCustomProperties:{attach:function(e,t){return Dn.attach(e,t,void 0,!0)},detach:function(e){return Dn.ref(e,!1)}},getData:function(e,t){return t.includeParent?e.asParent():e},mustRecreate:function(e,t){return e.includeParent!==t.includeParent}},TC=it(13421772),iye="Assigns colors according the interaction type of a link.",Wa={HydrogenBond:2851770,Hydrophobic:8421504,HalogenBond:4259775,Ionic:15779860,MetalCoordination:9191577,CationPi:16744448,PiStacking:9220966,WeakHydrogenBond:12967404},oye=[["Hydrogen Bond",Wa.HydrogenBond],["Hydrophobic",Wa.Hydrophobic],["Halogen Bond",Wa.HalogenBond],["Ionic",Wa.Ionic],["Metal Coordination",Wa.MetalCoordination],["Cation Pi",Wa.CationPi],["Pi Stacking",Wa.PiStacking],["Weak HydrogenBond",Wa.WeakHydrogenBond]];function Q5(e){switch(e){case 4:return Wa.HydrogenBond;case 6:return Wa.Hydrophobic;case 5:return Wa.HalogenBond;case 1:return Wa.Ionic;case 7:return Wa.MetalCoordination;case 2:return Wa.CationPi;case 3:return Wa.PiStacking;case 8:return Wa.WeakHydrogenBond;case 0:return TC}}var CB={};function sye(e){return CB}function _B(e,t){var r,n=e.structure?Dn.get(e.structure):void 0,a=n?jd(n.id,n.version):-1;return n&&n.value?r=function(i){if(Ku.isLocation(i)){var o=i.data.interactions,s=o.unitsContacts,u=o.contacts,l=i.element,c=l.unitA,d=l.unitB,f=l.indexA,p=l.indexB;if(c===d){var h=s.get(c.id),v=h.getDirectedEdgeIndex(f,p);return Q5(h.edgeProps.type[v])}else{var v=u.getEdgeIndex(f,c.id,p,d.id);return Q5(u.edges[v].props.type)}}return TC}:r=function(){return TC},{factory:_B,granularity:"group",color:r,props:t,contextHash:a,description:iye,legend:Pc(oye)}}var EC={name:"interaction-type",label:"Interaction Type",category:"Miscellaneous",factory:_B,getParams:sye,defaultValues:E.getDefaultValues(CB),isApplicable:function(e){return!!e.structure},ensureCustomProperties:{attach:function(e,t){return t.structure?Dn.attach(e,t.structure,void 0,!0):Promise.resolve()},detach:function(e){return e.structure&&Dn.ref(e.structure,!1)}}};function O0(e,t,r){r===void 0&&(r={});var n=r;return typeof n.type=="string"||typeof n.color=="string"||typeof n.size=="string"?lye(e,t||Xe.Empty,r):wB(e,t||Xe.Empty,r)}function uye(e,t){var r=e.representation.structure.themes;return t?r.colorThemeRegistry.getApplicableTypes({structure:t}):r.colorThemeRegistry.types}function IC(e,t,r,n,a){var i=e.representation.structure,o=i.registry,s=i.themes,u=o.get(r||o.default.name),l=s.colorThemeRegistry.get(n||u.defaultColorTheme.name),c=E.getDefaultValues(l.getParams({structure:t||Xe.Empty}));return l.name===u.defaultColorTheme.name&&Object.assign(c,u.defaultColorTheme.props),{name:l.name,params:Object.assign(c,a)}}function Z5(e,t,r,n,a){var i=e.representation.structure,o=i.registry,s=i.themes,u=o.get(r||o.default.name),l=s.sizeThemeRegistry.get(n||u.defaultSizeTheme.name),c=E.getDefaultValues(l.getParams({structure:t||Xe.Empty}));return l.name===u.defaultSizeTheme.name&&Object.assign(c,u.defaultSizeTheme.props),{name:l.name,params:Object.assign(c,a)}}function lye(e,t,r){var n=r.type&&e.representation.structure.registry.get(r.type)||e.representation.structure.registry.default.provider,a=r.color&&e.representation.structure.themes.colorThemeRegistry.get(r.color)||e.representation.structure.themes.colorThemeRegistry.get(n.defaultColorTheme.name),i=r.size&&e.representation.structure.themes.sizeThemeRegistry.get(r.size)||e.representation.structure.themes.sizeThemeRegistry.get(n.defaultSizeTheme.name);return wB(e,t,{type:n,typeParams:r.typeParams,color:a,colorParams:r.colorParams,size:i,sizeParams:r.sizeParams})}function wB(e,t,r){r===void 0&&(r={});var n=e.representation.structure.themes,a={structure:t},i=r.type||e.representation.structure.registry.default.provider,o=E.getDefaultValues(i.getParams(n,t)),s=Object.assign(o,r.typeParams),u=r.color||n.colorThemeRegistry.get(i.defaultColorTheme.name),l=E.getDefaultValues(u.getParams(a));u.name===i.defaultColorTheme.name&&Object.assign(l,i.defaultColorTheme.props);var c=Object.assign(l,r.colorParams),d=r.size||n.sizeThemeRegistry.get(i.defaultSizeTheme.name),f=E.getDefaultValues(d.getParams(a));d.name===i.defaultSizeTheme.name&&Object.assign(f,i.defaultSizeTheme.props);var p=Object.assign(f,r.sizeParams);return{type:{name:i.name,params:s},colorTheme:{name:u.name,params:c},sizeTheme:{name:d.name,params:p}}}var Mr;(function(e){var t=function(c){Be(d,c);function d(){return c!==null&&c.apply(this,arguments)||this}return d}(ge.Create({name:"Root",typeClass:"Root"}));e.Root=t;var r=function(c){Be(d,c);function d(){return c!==null&&c.apply(this,arguments)||this}return d}(ge.Create({name:"Category",typeClass:"Object"}));e.Category=r;var n=function(c){Be(d,c);function d(){return c!==null&&c.apply(this,arguments)||this}return d}(ge.CreateBehavior({name:"Behavior"}));e.Behavior=n,e.Categories={common:"Common",representation:"Representation",interaction:"Interaction","custom-props":"Custom Properties",misc:"Miscellaneous"},e.CreateCategory=Ot.BuiltIn({name:"create-behavior-category",display:{name:"Behavior Category"},from:t,to:r,params:{label:E.Text("",{isHidden:!0})}})({apply:function(c){var d=c.params;return new r({},{label:d.label})}});var a=new Map;function i(c){return a.get(c.id)}e.getCategoryId=i;function o(c){var d=Ot.CreateBuiltIn({name:c.name,display:c.display,from:[t],to:[n],params:c.params,apply:function(f,p){var h=f.params,v=c.label?c.label(h):{label:c.display.name,description:c.display.description};return new n(new c.ctor(p,h),v)},update:function(f){var p=this,h=f.b,v=f.newParams;return We.create("Update Behavior",function(){return ce(p,void 0,void 0,function(){var m;return de(this,function(g){switch(g.label){case 0:return h.data.update?[4,h.data.update(v)]:[2,ft.UpdateResult.Unchanged];case 1:return m=g.sent(),[2,m?ft.UpdateResult.Updated:ft.UpdateResult.Unchanged]}})})})},canAutoUpdate:c.canAutoUpdate});return a.set(d.id,c.category),d}e.create=o;function s(c,d){return function(){function f(p){this.ctx=p,this.sub=void 0}return f.prototype.register=function(){var p=this;this.sub=c.subscribe(this.ctx,function(h){return d(h,p.ctx)})},f.prototype.unregister=function(){this.sub&&this.sub.unsubscribe(),this.sub=void 0},f}()}e.simpleCommandHandler=s;var u=function(){function c(d,f){this.ctx=d,this.params=f,this.subs=[]}return c.prototype.subscribeCommand=function(d,f){this.subs.push(d.subscribe(this.ctx,f))},c.prototype.subscribeObservable=function(d,f){this.subs.push(d.subscribe(f))},c.prototype.track=function(d){this.subs.push(d)},c.prototype.unregister=function(){for(var d=0,f=this.subs;d<f.length;d++){var p=f[d];p.unsubscribe()}this.subs=[]},c.prototype.update=function(d){return lp(d,this.params)?!1:(this.params=d,!0)},c}();e.Handler=u;var l=function(){function c(d,f){this.plugin=d,this.params=f,this.subs=[]}return c.prototype.subscribeCommand=function(d,f){this.subs.push(d.subscribe(this.plugin,f))},c.prototype.subscribeObservable=function(d,f){this.subs.push(d.subscribe(f))},c.prototype.unregister=function(){for(var d=0,f=this.subs;d<f.length;d++){var p=f[d];p.unsubscribe()}this.subs=[]},c}();e.WithSubscribers=l})(Mr||(Mr={}));var Vv=function(){function e(){this.subs=void 0}return e.prototype.subscribe=function(t,r){var n=this;typeof this.subs=="undefined"&&(this.subs=[]);var a=t.subscribe(r);return this.subs.push(a),{unsubscribe:function(){a&&n.subs&&yd(n.subs,a)&&(a.unsubscribe(),a=void 0)}}},Object.defineProperty(e.prototype,"ev",{get:function(){return this._ev||(this._ev=zu.create())},enumerable:!1,configurable:!0}),e.prototype.dispose=function(){if(this._ev&&this._ev.dispose(),this.subs){for(var t=0,r=this.subs;t<r.length;t++){var n=r[t];n.unsubscribe()}this.subs=void 0}},e}(),gl=function(e){Be(t,e);function t(r){var n=e.call(this)||this;return n._state=r,n}return t.prototype.updateState=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var a=this.state,i=kW(a,r);return i!==a?(this._state=i,!0):!1},Object.defineProperty(t.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),t}(Vv),MC="2.2.0",cye=new Date(typeof __MOLSTAR_DEBUG_TIMESTAMP__!="undefined"?__MOLSTAR_DEBUG_TIMESTAMP__:1627737258743),Yg=function(e){Be(t,e);function t(r){var n=e.call(this,{current:void 0,entries:Nn.exports.List(),isPlaying:!1,nextSnapshotDelayInMs:t.DefaultNextSnapshotDelayInMs})||this;return n.plugin=r,n.entryMap=new Map,n.events={changed:n.ev()},n.timeoutHandle=void 0,n.next=function(){return ce(n,void 0,void 0,function(){var a,i,o;return de(this,function(s){switch(s.label){case 0:return this.timeoutHandle=void 0,a=this.getNextId(this.state.current,1),!a||a===this.state.current?(this.stop(),[2]):(i=this.setCurrent(a),[4,this.plugin.state.setSnapshot(i)]);case 1:return s.sent(),o=typeof i.durationInMs!="undefined"?i.durationInMs:this.state.nextSnapshotDelayInMs,this.state.isPlaying&&(this.timeoutHandle=setTimeout(this.next,o)),[2]}})})},n}return t.prototype.getIndex=function(r){return this.state.entries.indexOf(r)},t.prototype.getEntry=function(r){if(!!r)return this.entryMap.get(r)},t.prototype.remove=function(r){var n=this.entryMap.get(r);!n||(this.entryMap.delete(r),this.updateState({current:this.state.current===r?void 0:this.state.current,entries:this.state.entries.delete(this.getIndex(n))}),this.events.changed.next())},t.prototype.add=function(r){this.entryMap.set(r.snapshot.id,r),this.updateState({current:r.snapshot.id,entries:this.state.entries.push(r)}),this.events.changed.next()},t.prototype.replace=function(r,n){var a=this.getEntry(r);if(!!a){var i=this.getIndex(a),o=t.Entry(n,{name:a.name,description:a.description});this.entryMap.set(n.id,o),this.updateState({current:o.snapshot.id,entries:this.state.entries.set(i,o)}),this.events.changed.next()}},t.prototype.move=function(r,n){var a=this.state.entries.size;if(!(a<2)){var i=this.getEntry(r);if(!!i){var o=this.getIndex(i),s=(o+n)%a;s<0&&(s+=a);var u=this.state.entries.get(s),l=this.state.entries.asMutable();l.set(s,i),l.set(o,u),this.updateState({current:i.snapshot.id,entries:l.asImmutable()}),this.events.changed.next()}}},t.prototype.clear=function(){this.state.entries.size!==0&&(this.entryMap.clear(),this.updateState({current:void 0,entries:Nn.exports.List()}),this.events.changed.next())},t.prototype.setCurrent=function(r){var n=this.getEntry(r);return n&&(this.updateState({current:r}),this.events.changed.next()),n&&n.snapshot},t.prototype.getNextId=function(r,n){var a=this.state.entries.size;if(!r){if(a===0)return;var i=n===-1?a-1:0;return this.state.entries.get(i).snapshot.id}var o=this.getEntry(r);if(!!o){var s=this.getIndex(o);if(!(s<0))return s=(s+n)%a,s<0&&(s+=a),this.state.entries.get(s).snapshot.id}},t.prototype.setStateSnapshot=function(r){return ce(this,void 0,void 0,function(){var n,a,i,o,s,u,l;return de(this,function(c){switch(c.label){case 0:for(r.version,this.clear(),n=Nn.exports.List().asMutable(),a=0,i=r.entries;a<i.length;a++)o=i[a],this.entryMap.set(o.snapshot.id,o),n.push(o);return s=r.current?r.current:r.entries.length>0?r.entries[0].snapshot.id:void 0,this.updateState({current:s,entries:n.asImmutable(),isPlaying:!1,nextSnapshotDelayInMs:r.playback?r.playback.nextSnapshotDelayInMs:t.DefaultNextSnapshotDelayInMs}),this.events.changed.next(),s?(u=this.getEntry(s),l=u&&u.snapshot,l?[4,this.plugin.state.setSnapshot(l)]:[2]):[2];case 1:return c.sent(),r.playback&&r.playback.isPlaying&&this.play(!0),[2,l]}})})},t.prototype.syncCurrent=function(r){var n=this.plugin.state.getSnapshot(r==null?void 0:r.params);this.state.entries.size===0||!this.state.current?this.add(t.Entry(n,{name:r==null?void 0:r.name,description:r==null?void 0:r.description})):this.replace(this.state.current,n)},t.prototype.getStateSnapshot=function(r){return this.syncCurrent(r),{timestamp:+new Date,version:MC,name:r&&r.name,description:r&&r.description,current:this.state.current,playback:{isPlaying:!!(r&&r.playOnLoad),nextSnapshotDelayInMs:this.state.nextSnapshotDelayInMs},entries:this.state.entries.valueSeq().toArray()}},t.prototype.serialize=function(r){return ce(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d,f,p,h,v,m,g;return de(this,function(y){switch(y.label){case 0:return n=JSON.stringify(this.getStateSnapshot({params:r==null?void 0:r.params}),null,2),!(r!=null&&r.type)||r.type==="json"||r.type==="molj"?[2,new Blob([n],{type:"application/json;charset=utf-8"})]:[3,1];case 1:a=new Uint8Array(ng(n)),qf(a,0,n),i={"state.json":a},o=[],s=0,u=this.plugin.managers.asset.assets,y.label=2;case 2:return s<u.length?(l=u[s],c=l.asset,d=l.file,o.push([c.id,c]),f=i,p="assets/"+c.id,h=Uint8Array.bind,[4,d.arrayBuffer()]):[3,5];case 3:f[p]=new(h.apply(Uint8Array,[void 0,y.sent()])),y.label=4;case 4:return s++,[3,2];case 5:return o.length>0&&(v=JSON.stringify(o,null,2),m=new Uint8Array(ng(v)),qf(m,0,v),i["assets.json"]=m),[4,this.plugin.runTask(pX(i))];case 6:return g=y.sent(),[2,new Blob([g],{type:"application/zip"})]}})})},t.prototype.open=function(r){return ce(this,void 0,void 0,function(){var n,a,g,a,i,o,s,u,l,c,d,f,p,h,v,m,g,y;return de(this,function(b){switch(b.label){case 0:return b.trys.push([0,8,,9]),n=r.name.toLowerCase(),n.endsWith("json")||n.endsWith("molj")?[4,this.plugin.runTask(ec(r,"string"))]:[3,2];case 1:return a=b.sent(),g=JSON.parse(a),t.isStateSnapshot(g)?[2,this.setStateSnapshot(g)]:t.isStateSnapshot(g.data)?[2,this.setStateSnapshot(g.data)]:(this.plugin.state.setSnapshot(g),[3,7]);case 2:return[4,this.plugin.runTask(ec(r,"zip"))];case 3:return a=b.sent(),i=Object.create(null),cs(a,function(x,S){if(!(S==="state.json"||S==="assets.json")){var _=S.substring(S.indexOf("/")+1);i[_]=new File([x],_)}}),o=new File([a["state.json"]],"state.json"),[4,this.plugin.runTask(ec(o,"string"))];case 4:return s=b.sent(),a["assets.json"]?(u=new File([a["assets.json"]],"assets.json"),d=(c=JSON).parse,[4,this.plugin.runTask(ec(u,"string"))]):[3,6];case 5:for(l=d.apply(c,[b.sent()]),f=0,p=l;f<p.length;f++)h=p[f],v=h[0],m=h[1],this.plugin.managers.asset.set(m,i[v]);b.label=6;case 6:return g=JSON.parse(s),[2,this.setStateSnapshot(g)];case 7:return[3,9];case 8:return y=b.sent(),this.plugin.log.error("Reading state: "+y),[3,9];case 9:return[2]}})})},t.prototype.play=function(r){if(r===void 0&&(r=!1),this.updateState({isPlaying:!0}),r){var n=this.getEntry(this.state.current);if(!n){this.next();return}this.events.changed.next();var a=n.snapshot,i=typeof a.durationInMs!="undefined"?a.durationInMs:this.state.nextSnapshotDelayInMs;this.timeoutHandle=setTimeout(this.next,i)}else this.next()},t.prototype.stop=function(){this.updateState({isPlaying:!1}),typeof this.timeoutHandle!="undefined"&&clearTimeout(this.timeoutHandle),this.timeoutHandle=void 0,this.events.changed.next()},t.prototype.togglePlay=function(){this.state.isPlaying?(this.stop(),this.plugin.managers.animation.stop()):this.play()},t.DefaultNextSnapshotDelayInMs=1500,t}(gl);(function(e){function t(n,a){return w({timestamp:+new Date,snapshot:n},a)}e.Entry=t;function r(n){var a=n;return!!a&&!!a.timestamp&&!!a.entries}e.isStateSnapshot=r})(Yg||(Yg={}));function dye(e){return e.toISOString().replace(/T/," ").replace(/\..+/,"")}function fye(){var e=new Date,t=e.getFullYear(),r=e.getMonth()+1,n=e.getDate(),a=e.getHours(),i=e.getMinutes(),o=e.getSeconds();return t+"-"+r+"-"+n+"-"+a+"-"+i+"-"+o}function pye(e){var t=window.open(e,"_blank");t||(window.location.href=e)}function J5(e){try{e.dispatchEvent(new MouseEvent("click"))}catch{var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}function AB(e,t){if(t===void 0&&(t="download"),!!e)if("download"in HTMLAnchorElement.prototype){var r=document.createElement("a");r.download=t,r.rel="noopener",typeof e=="string"?(r.href=e,J5(r)):(r.href=URL.createObjectURL(e),setTimeout(function(){return URL.revokeObjectURL(r.href)},4e4),setTimeout(function(){return J5(r)}))}else if(typeof navigator!="undefined"&&navigator.msSaveOrOpenBlob)navigator.msSaveOrOpenBlob(e,t);else{var n=window.navigator.userAgent,a=/Safari/i.test(n),i=/CriOS\/[\d]+/.test(n),o=function(l){pye(i?l:l.replace(/^data:[^;]*;/,"data:attachment/file;"))};if((a||i)&&FileReader)if(e instanceof Blob){var s=new FileReader;s.onloadend=function(){return o(s.result)},s.readAsDataURL(e)}else o(e);else{var u=URL.createObjectURL(e);location.href=u,setTimeout(function(){return URL.revokeObjectURL(u)},4e4)}}}function S1(e,t){return""+e+(e[e.length-1]==="/"||t[0]==="/"?"":"/")+t}function vn(){var e=function(t,r){return t.commands.dispatch(e,r||{})};return e.subscribe=function(t,r){return t.commands.subscribe(e,r)},e.id=un.create22(),e}var hye=function(){function e(){this.subs=new Map,this.disposing=!1}return e.prototype.subscribe=function(t,r){var n=this,a=this.subs.get(t.id);return a||(a=[],this.subs.set(t.id,a)),a.push(r),{unsubscribe:function(){var i=n.subs.get(t.id);if(!!i){var o=i.indexOf(r);if(!(o<0)){for(var s=o+1;s<i.length;s++)i[s-1]=i[s];i.pop()}}}}},e.prototype.dispatch=function(t,r){var n=this;return new Promise(function(a,i){if(n.disposing){i("disposed");return}var o=n.subs.get(t.id);if(!o){a();return}n.resolve({cmd:t,params:r,resolve:a,reject:i})})},e.prototype.dispose=function(){this.subs.clear()},e.prototype.resolve=function(t){return ce(this,void 0,void 0,function(){var r,n,a,i,o;return de(this,function(s){switch(s.label){case 0:if(r=this.subs.get(t.cmd.id),!r)return t.resolve(),[2];s.label=1;case 1:s.trys.push([1,6,,7]),n=0,a=r,s.label=2;case 2:return n<a.length?(i=a[n],[4,i(t.params)]):[3,5];case 3:s.sent(),s.label=4;case 4:return n++,[3,2];case 5:return t.resolve(),[3,7];case 6:return o=s.sent(),t.reject(o),[3,7];case 7:return[2]}})})},e}(),wt={State:{SetCurrentObject:vn(),ApplyAction:vn(),Update:vn(),RemoveObject:vn(),ToggleExpanded:vn(),ToggleVisibility:vn(),Snapshots:{Add:vn(),Replace:vn(),Move:vn(),Remove:vn(),Apply:vn(),Clear:vn(),Upload:vn(),Fetch:vn(),DownloadToFile:vn(),OpenFile:vn(),OpenUrl:vn()}},Interactivity:{Object:{Highlight:vn()},Structure:{Highlight:vn(),Select:vn()},ClearHighlights:vn()},Layout:{Update:vn()},Toast:{Show:vn(),Hide:vn()},Camera:{Reset:vn(),SetSnapshot:vn(),Focus:vn()},Canvas3D:{SetSettings:vn(),ResetSettings:vn()}};function vye(e){PB(e),TB(e),EB(e),IB(e),MB(e),DB(e),RB(e),OB(e),FB(e),kB(e)}function PB(e){e.state.events.object.created.subscribe(function(t){!ge.isBehavior(t.obj)||t.obj.data.register(t.ref)}),e.state.events.object.removed.subscribe(function(t){!ge.isBehavior(t.obj)||t.obj.data.unregister()}),e.state.events.object.updated.subscribe(function(t){t.action==="recreate"&&(t.oldObj&&ge.isBehavior(t.oldObj)&&t.oldObj.data.unregister(),t.obj&&ge.isBehavior(t.obj)&&t.obj.data.register(t.ref))})}function TB(e){wt.State.SetCurrentObject.subscribe(e,function(t){var r=t.state,n=t.ref;return r.setCurrent(n)})}function EB(e){wt.State.Update.subscribe(e,function(t){var r=t.state,n=t.tree,a=t.options;return e.runTask(r.updateTree(n,a))})}function IB(e){wt.State.ApplyAction.subscribe(e,function(t){var r=t.state,n=t.action,a=t.ref;return e.runTask(r.applyAction(n.action,n.params,a))})}function MB(e){function t(r,n){var a=r.build().delete(n);return e.runTask(r.updateTree(a))}wt.State.RemoveObject.subscribe(e,function(r){var n=r.state,a=r.ref,i=r.removeParentGhosts;if(i){var o=n.tree,s=o.transforms.get(a);if(s.parent===a)return t(n,a);for(;;){var u=o.children.get(s.parent);if(s.parent===s.ref||u.size>1)return t(n,s.ref);var l=o.transforms.get(s.parent);if(!l.state.isGhost)return t(n,s.ref);s=l}}else return t(n,a)})}function DB(e){wt.State.ToggleExpanded.subscribe(e,function(t){var r=t.state,n=t.ref;return r.updateCellState(n,function(a){var i=a.isCollapsed;return{isCollapsed:!i}})})}function RB(e){wt.State.ToggleVisibility.subscribe(e,function(t){var r=t.state,n=t.ref;return Vd(r,n,!r.cells.get(n).state.isHidden)})}function Vd(e,t,r){Hn.doPreOrder(e.tree,e.transforms.get(t),{state:e,value:r},mye)}function mye(e,t,r){r.state.updateCellState(e.ref,{isHidden:r.value})}function OB(e){wt.Interactivity.Object.Highlight.subscribe(e,function(t){var r=t.state,n=t.ref;if(!(!e.canvas3d||e.isBusy)){e.managers.interactivity.lociHighlights.clearHighlights();for(var a=typeof n=="string"?[n]:n,i=0,o=a;i<o.length;i++){var s=o[i],u=r.cells.get(s);if(!!u){if(ge.Molecule.Structure.is(u.obj))e.managers.interactivity.lociHighlights.highlight({loci:Xe.Loci(u.obj.data)},!1);else if(u&&ge.isRepresentation3D(u.obj)){var l=u.obj.data.repr;e.managers.interactivity.lociHighlights.highlight({loci:l.getLoci(),repr:l},!1)}else if(ge.Molecule.Structure.Selections.is(u.obj))for(var c=0,d=u.obj.data;c<d.length;c++){var f=d[c];e.managers.interactivity.lociHighlights.highlight({loci:f.loci},!1)}}}}})}function FB(e){wt.Interactivity.ClearHighlights.subscribe(e,function(){e.managers.interactivity.lociHighlights.clearHighlights()})}function kB(e){var t=this;e.config.set(jr.State.CurrentServer,e.config.get(jr.State.DefaultServer)),wt.State.Snapshots.Clear.subscribe(e,function(){e.managers.snapshot.clear()}),wt.State.Snapshots.Remove.subscribe(e,function(r){var n=r.id;e.managers.snapshot.remove(n)}),wt.State.Snapshots.Add.subscribe(e,function(r){var n=r.name,a=r.description,i=r.params,o=Yg.Entry(e.state.getSnapshot(i),{name:n,description:a});e.managers.snapshot.add(o)}),wt.State.Snapshots.Replace.subscribe(e,function(r){var n=r.id,a=r.params;e.managers.snapshot.replace(n,e.state.getSnapshot(a))}),wt.State.Snapshots.Move.subscribe(e,function(r){var n=r.id,a=r.dir;e.managers.snapshot.move(n,a)}),wt.State.Snapshots.Apply.subscribe(e,function(r){var n=r.id,a=e.managers.snapshot.setCurrent(n);if(!!a)return e.state.setSnapshot(a)}),wt.State.Snapshots.Upload.subscribe(e,function(r){var n=r.name,a=r.description,i=r.playOnLoad,o=r.serverUrl;return r.params,fetch(S1(o,"set?name="+encodeURIComponent(n||"")+"&description="+encodeURIComponent(a||"")),{method:"POST",mode:"cors",referrer:"no-referrer",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify(e.managers.snapshot.getStateSnapshot({name:n,description:a,playOnLoad:i}))})}),wt.State.Snapshots.Fetch.subscribe(e,function(r){var n=r.url;return ce(t,void 0,void 0,function(){var a;return de(this,function(i){switch(i.label){case 0:return[4,e.runTask(e.fetch({url:n,type:"json"}))];case 1:return a=i.sent(),[4,e.managers.snapshot.setStateSnapshot(a.data)];case 2:return i.sent(),[2]}})})}),wt.State.Snapshots.DownloadToFile.subscribe(e,function(r){var n=r.name,a=r.type,i=r.params;return ce(t,void 0,void 0,function(){var o,s;return de(this,function(u){switch(u.label){case 0:return o="mol-star_state_"+(n||fye())+"."+(a==="json"?"molj":"molx"),[4,e.managers.snapshot.serialize({type:a,params:i})];case 1:return s=u.sent(),AB(s,""+o),[2]}})})}),wt.State.Snapshots.OpenFile.subscribe(e,function(r){var n=r.file;return e.managers.snapshot.open(n)}),wt.State.Snapshots.OpenUrl.subscribe(e,function(r){var n=r.url,a=r.type;return ce(t,void 0,void 0,function(){var i;return de(this,function(o){switch(o.label){case 0:return[4,e.runTask(e.fetch({url:n,type:"binary"}))];case 1:return i=o.sent(),[2,e.managers.snapshot.open(new File([i],"state."+a))]}})})})}var gye=Object.freeze(Object.defineProperty({__proto__:null,registerDefault:vye,SyncBehaviors:PB,SetCurrentObject:TB,Update:EB,ApplyAction:IB,RemoveObject:MB,ToggleExpanded:DB,ToggleVisibility:RB,setSubtreeVisibility:Vd,Highlight:OB,ClearHighlights:FB,Snapshots:kB},Symbol.toStringTag,{value:"Module"}));function yye(e){BB(e),LB(e),NB(e)}function BB(e){var t=e.state.data.events;t.object.created.subscribe(function(r){var n;!ge.isRepresentation3D(r.obj)||(DC(r.state.cells.get(r.ref),r.obj.data.repr),r.obj.data.repr.setState({syncManually:!0}),(n=e.canvas3d)===null||n===void 0||n.add(r.obj.data.repr))}),t.object.updated.subscribe(function(r){var n,a;r.oldObj&&ge.isRepresentation3D(r.oldObj)&&((n=e.canvas3d)===null||n===void 0||n.remove(r.oldObj.data.repr),r.oldObj.data.repr.destroy()),ge.isRepresentation3D(r.obj)&&(DC(r.state.cells.get(r.ref),r.obj.data.repr),r.action==="recreate"&&r.obj.data.repr.setState({syncManually:!0}),(a=e.canvas3d)===null||a===void 0||a.add(r.obj.data.repr))}),t.object.removed.subscribe(function(r){var n;!ge.isRepresentation3D(r.obj)||((n=e.canvas3d)===null||n===void 0||n.remove(r.obj.data.repr),r.obj.data.repr.destroy())})}function LB(e){var t=e.state.data.events;t.object.created.subscribe(function(r){var n;if(!!ge.Molecule.Structure.Representation3DState.is(r.obj)){var a=r.obj.data;a.repr.setState(a.state),(n=e.canvas3d)===null||n===void 0||n.update(a.repr)}}),t.object.updated.subscribe(function(r){var n;if(!!ge.Molecule.Structure.Representation3DState.is(r.obj)){var a=r.obj.data;a.repr.setState(a.state),(n=e.canvas3d)===null||n===void 0||n.update(a.repr)}}),t.object.removed.subscribe(function(r){var n;if(!!ge.Molecule.Structure.Representation3DState.is(r.obj)){var a=r.obj.data;a.repr.setState(a.initialState),(n=e.canvas3d)===null||n===void 0||n.update(a.repr)}})}function NB(e){e.state.data.events.cell.stateUpdated.subscribe(function(t){var r,n=t.state.cells.get(t.ref);!ge.isRepresentation3D(n.obj)||DC(n,n.obj.data.repr)&&((r=e.canvas3d)===null||r===void 0||r.syncVisibility())})}function DC(e,t){return t.state.visible===e.state.isHidden?(t.setState({visible:!e.state.isHidden}),!0):!1}var bye=Object.freeze(Object.defineProperty({__proto__:null,registerDefault:yye,SyncRepresentationToCanvas:BB,SyncStructureRepresentation3DState:LB,UpdateRepresentationVisibility:NB},Symbol.toStringTag,{value:"Module"}));function Sye(e){UB(e),VB(e),zB(e)}function UB(e){wt.Camera.Reset.subscribe(e,function(t){e.managers.camera.reset(t==null?void 0:t.snapshot,t==null?void 0:t.durationMs)})}function zB(e){wt.Camera.SetSnapshot.subscribe(e,function(t){var r=t.snapshot,n=t.durationMs;e.managers.camera.setSnapshot(r,n)})}function VB(e){wt.Camera.Focus.subscribe(e,function(t){var r=t.center,n=t.radius,a=t.durationMs;e.managers.camera.focusSphere({center:r,radius:n},{durationMs:a}),e.events.canvas3d.settingsUpdated.next()})}var xye=Object.freeze(Object.defineProperty({__proto__:null,registerDefault:Sye,Reset:UB,SetSnapshot:zB,Focus:VB},Symbol.toStringTag,{value:"Module"}));function fd(e){if(typeof e=="object"){if("buttons"in e)return e.buttons;if("which"in e){var t=e.which;if(t===2)return 4;if(t===3)return 2;if(t>0)return 1<<t-1}}return 0}function $f(e){if(typeof e=="object"&&"button"in e){var t=e.button;if(t===1)return 4;if(t===2)return 2;if(t>=0)return 1<<t}return 0}function Xm(e){return{alt:"altKey"in e?e.altKey:!1,shift:"shiftKey"in e?e.shiftKey:!1,control:"ctrlKey"in e?e.ctrlKey:!1,meta:"metaKey"in e?e.metaKey:!1}}var eI={noScroll:!0,noMiddleClickScroll:!0,noContextMenu:!0,noPinchZoom:!0,noTextSelect:!0,mask:function(e,t){return!0},pixelScale:1},is;(function(e){e.None=n();function t(a,i){return a.shift===i.shift&&a.alt===i.alt&&a.control===i.control&&a.meta===i.meta}e.areEqual=t;function r(a){if(!a)return 0;var i=0;return a.shift&&i++,a.alt&&i++,a.control&&i++,a.meta&&i++,i}e.size=r;function n(a){return a===void 0&&(a={}),{shift:!!a.shift,alt:!!a.alt,control:!!a.control,meta:!!a.meta}}e.create=n})(is||(is={}));var Hd;(function(e){e.has=ka.has,e.create=ka.create})(Hd||(Hd={}));function tI(){return{drag:new Ln,interactionEnd:new Ln,click:new Ln,move:new Ln,wheel:new Ln,pinch:new Ln,resize:new Ln,leave:new Ln,enter:new Ln,modifiers:new Ln,key:new Ln}}var Cye=["Backspace","Delete"],RC;(function(e){function t(n){n===void 0&&(n={});var a=w(w({},eI),n),i=a.noScroll,o=a.noContextMenu;return w(w({noScroll:i,noContextMenu:o,width:0,height:0,pixelRatio:1},tI()),{dispose:ql})}e.create=t;function r(n,a){a===void 0&&(a={});var i=w(w({},eI),a),o=i.noScroll,s=i.noMiddleClickScroll,u=i.noContextMenu,l=i.noPinchZoom,c=i.noTextSelect,d=i.mask,f=i.pixelScale,p=n.clientWidth*_(),h=n.clientHeight*_(),v=0,m=Ge(),g=Ge(),y=Ge(),b=Ge(),x=Ge(),S={shift:!1,alt:!1,control:!1,meta:!1};function _(){return window.devicePixelRatio*f}function A(){return w({},S)}var T=0,I=!1,M=Hd.create(0),O=0,D=!1,F=tI(),G=F.drag,N=F.interactionEnd,z=F.wheel,$=F.pinch,j=F.click,Z=F.move,q=F.leave,te=F.enter,he=F.resize,W=F.modifiers,K=F.key;return U(),w(w({get noScroll(){return o},set noScroll(Oe){o=Oe},get noContextMenu(){return u},set noContextMenu(Oe){u=Oe},get width(){return p},get height(){return h},get pixelRatio(){return _()}},F),{dispose:H});function U(){n.addEventListener("contextmenu",J,!1),n.addEventListener("wheel",Ye,!1),n.addEventListener("mousedown",R,!1),window.addEventListener("mousemove",V,!1),window.addEventListener("mouseup",pe,!1),n.addEventListener("mouseenter",lt,!1),n.addEventListener("mouseleave",Le,!1),n.addEventListener("touchstart",xe,!1),n.addEventListener("touchmove",oe,!1),n.addEventListener("touchend",ae,!1),window.addEventListener("blur",Q),window.addEventListener("keyup",le,!1),window.addEventListener("keydown",ee,!1),window.addEventListener("keypress",ye,!1),window.addEventListener("resize",Qe,!1)}function H(){I||(I=!0,n.removeEventListener("contextmenu",J,!1),n.removeEventListener("wheel",Ye,!1),n.removeEventListener("mousedown",R,!1),window.removeEventListener("mousemove",V,!1),window.removeEventListener("mouseup",pe,!1),n.removeEventListener("mouseenter",lt,!1),n.removeEventListener("mouseleave",Le,!1),n.removeEventListener("touchstart",xe,!1),n.removeEventListener("touchmove",oe,!1),n.removeEventListener("touchend",ae,!1),window.removeEventListener("blur",Q),window.removeEventListener("keyup",le,!1),window.removeEventListener("keydown",ee,!1),window.removeEventListener("keypress",ye,!1),window.removeEventListener("resize",Qe,!1))}function J(Oe){!d(Oe.clientX,Oe.clientY)||u&&Oe.preventDefault()}function X(Oe){S.alt=Oe.altKey,S.shift=Oe.shiftKey,S.control=Oe.ctrlKey,S.meta=Oe.metaKey}function Q(){(M||S.shift||S.alt||S.meta||S.control)&&(M=0,S.shift=S.alt=S.control=S.meta=!1)}function ee(Oe){var Me=!1;!S.alt&&Oe.altKey&&(Me=!0,S.alt=!0),!S.shift&&Oe.shiftKey&&(Me=!0,S.shift=!0),!S.control&&Oe.ctrlKey&&(Me=!0,S.control=!0),!S.meta&&Oe.metaKey&&(Me=!0,S.meta=!0),Me&&D&&W.next(A())}function le(Oe){var Me=!1;S.alt&&!Oe.altKey&&(Me=!0,S.alt=!1),S.shift&&!Oe.shiftKey&&(Me=!0,S.shift=!1),S.control&&!Oe.ctrlKey&&(Me=!0,S.control=!1),S.meta&&!Oe.metaKey&&(Me=!0,S.meta=!1),Me&&D&&W.next(A()),Cye.includes(Oe.key)&&ye(Oe)}function ye(Oe){K.next({key:Oe.key,modifiers:A()})}function be(Oe){var Me=Oe.touches[0],Ke=Oe.touches[1];return{clientX:(Me.clientX+Ke.clientX)/2,clientY:(Me.clientY+Ke.clientY)/2,pageX:(Me.pageX+Ke.pageX)/2,pageY:(Me.pageY+Ke.pageY)/2}}function Ae(Oe){var Me=Oe.touches[0].pageX-Oe.touches[1].pageX,Ke=Oe.touches[0].pageY-Oe.touches[1].pageY;return Math.sqrt(Me*Me+Ke*Ke)}function xe(Oe){if(Oe.touches.length===1)M=O=1,Ee(Oe.touches[0]);else if(Oe.touches.length===2){M=0,O=2,Ee(be(Oe));var Me=Ae(Oe);v=Me,$.next({distance:Me,fraction:1,delta:0,isStart:!0,buttons:M,button:O,modifiers:A()})}else Oe.touches.length===3&&(M=O=8,Ee(be(Oe)))}function ae(Oe){_e()}function oe(Oe){if(O=0,l&&(Oe.preventDefault(),Oe.stopPropagation(),Oe.originalEvent&&(Oe.originalEvent.preventDefault(),Oe.originalEvent.stopPropagation())),Oe.touches.length===1)M=1,He(Oe.touches[0]);else if(Oe.touches.length===2){var Me=Ae(Oe),Ke=v-Me;Math.abs(Ke)<4?(M=2,He(be(Oe))):(M=4,X(Oe),$.next({delta:Ke,fraction:v/Me,distance:Me,isStart:!1,buttons:M,button:O,modifiers:A()})),v=Me}else Oe.touches.length===3&&(M=8,He(be(Oe)))}function R(Oe){X(Oe),M=fd(Oe),O=$f(Oe),s&&M===4&&Oe.preventDefault,Ee(Oe)}function V(Oe){X(Oe),M=fd(Oe),O=0,He(Oe)}function pe(Oe){X(Oe),M=fd(Oe),O=$f(Oe),Ve(Oe),_e()}function _e(){N.next()}function Ee(Oe){!d(Oe.clientX,Oe.clientY)||(dt(g,Oe),Ge.copy(m,g),at(g)&&(T=1))}function Ve(Oe){if(T=0,!!d(Oe.clientX,Oe.clientY)&&(dt(y,Oe),Ge.distance(y,m)<4)){var Me=Oe.pageX,Ke=Oe.pageY,tt=y[0],St=y[1];j.next({x:tt,y:St,pageX:Me,pageY:Ke,buttons:M,button:O,modifiers:A()})}}function He(Oe){var Me;dt(y,Oe);var Ke=Oe.pageX,tt=Oe.pageY,St=y[0],ht=y[1],ut=at(y);if(Z.next({x:St,y:ht,pageX:Ke,pageY:tt,buttons:M,button:O,modifiers:A(),inside:ut}),T!==0&&(c&&((Me=Oe.preventDefault)===null||Me===void 0||Me.call(Oe)),Ge.div(b,Ge.sub(b,y,g),ot(x)),!(Ge.magnitude(b)<fn))){var fe=T===1;if(!(fe&&!d(Oe.clientX,Oe.clientY))){var me=b[0],we=b[1];G.next({x:St,y:ht,dx:me,dy:we,pageX:Ke,pageY:tt,buttons:M,button:O,modifiers:A(),isStart:fe}),Ge.copy(g,y),T=2}}}function Ye(Oe){if(!!d(Oe.clientX,Oe.clientY)){dt(y,Oe);var Me=Oe.pageX,Ke=Oe.pageY,tt=y[0],St=y[1];o&&Oe.preventDefault();var ht=1;switch(Oe.deltaMode){case 0:ht=1;break;case 1:ht=40;break;case 2:ht=800;break}var ut=(Oe.deltaX||0)*ht,fe=(Oe.deltaY||0)*ht,me=(Oe.deltaZ||0)*ht;M=O=4,(ut||fe||me)&&z.next({x:tt,y:St,pageX:Me,pageY:Ke,dx:ut,dy:fe,dz:me,buttons:M,button:O,modifiers:A()})}}function lt(Oe){D=!0,te.next()}function Le(Oe){D=!1,q.next()}function Qe(Oe){he.next()}function at(Oe){if(n instanceof Window||n instanceof Document||n===document.body)return!0;var Me=n.getBoundingClientRect();return Oe[0]>=0&&Oe[1]>=0&&Oe[0]<Me.width&&Oe[1]<Me.height}function ot(Oe){return Oe[0]=n.clientWidth,Oe[1]=n.clientHeight,Oe}function dt(Oe,Me){p=n.clientWidth*_(),h=n.clientHeight*_();var Ke=Me.clientX||0,tt=Me.clientY||0,St=n.getBoundingClientRect();return Oe[0]=Ke-St.left,Oe[1]=tt-St.top,Oe}}e.fromElement=r})(RC||(RC={}));function ga(){return ga.zero()}(function(e){function t(){return{x:0,y:0,width:0,height:0}}e.zero=t;function r(u,l,c,d){return{x:u,y:l,width:c,height:d}}e.create=r;function n(u){return w({},u)}e.clone=n;function a(u,l){return Object.assign(u,l)}e.copy=a;function i(u,l,c,d,f){return u.x=l,u.y=c,u.width=d,u.height=f,u}e.set=i;function o(u,l){return u[0]=l.x,u[1]=l.y,u[2]=l.width,u[3]=l.height,u}e.toVec4=o;function s(u,l){return u.x===l.x&&u.y===l.y&&u.width===l.width&&u.height===l.height}e.equals=s})(ga||(ga={}));var rI=0,nI=1,Ps=Cr();function _ye(e,t,r,n){var a=r.x,i=r.y,o=r.width,s=r.height;Cr.set(Ps,t[0],t[1],t[2],1),Cr.transformMat4(Ps,Ps,n);var u=Ps[3];return u!==0&&(Ps[0]/=u,Ps[1]/=u,Ps[2]/=u),e[0]=a+o/2*Ps[0]+(0+o/2),e[1]=i+s/2*Ps[1]+(0+s/2),e[2]=(nI-rI)/2*Ps[2]+(nI+rI)/2,e[3]=u===0?0:1/u,e}function F0(e,t,r,n){var a=r.x,i=r.y,o=r.width,s=r.height,u=t[0]-a,l=s-t[1]-1-i,c=t[2];return e[0]=2*u/o-1,e[1]=2*l/s-1,e[2]=2*c-1,C.transformMat4(e,e,n)}var OC={backgroundColor:E.Color(it(0),{description:"Background color of the 3D canvas"}),pickingAlphaThreshold:E.Numeric(.5,{min:0,max:1,step:.01},{description:"The minimum opacity value needed for an object to be pickable."}),interiorDarkening:E.Numeric(.5,{min:0,max:1,step:.01}),interiorColorFlag:E.Boolean(!0,{label:"Use Interior Color"}),interiorColor:E.Color(it.fromNormalizedRgb(.3,.3,.3)),highlightColor:E.Color(it.fromNormalizedRgb(1,.4,.6)),selectColor:E.Color(it.fromNormalizedRgb(.2,1,.1)),xrayEdgeFalloff:E.Numeric(1,{min:0,max:3,step:.1}),style:E.MappedStatic("matte",{custom:E.Group({lightIntensity:E.Numeric(.6,{min:0,max:1,step:.01}),ambientIntensity:E.Numeric(.4,{min:0,max:1,step:.01}),metalness:E.Numeric(0,{min:0,max:1,step:.01}),roughness:E.Numeric(1,{min:0,max:1,step:.01}),reflectivity:E.Numeric(.5,{min:0,max:1,step:.01})},{isExpanded:!0}),flat:E.Group({}),matte:E.Group({}),glossy:E.Group({}),metallic:E.Group({}),plastic:E.Group({})},{label:"Lighting",description:"Style in which the 3D scene is rendered/lighted"}),clip:E.Group({variant:E.Select("instance",E.arrayToOptions(["instance","pixel"])),objects:E.ObjectList({type:E.Select("plane",E.objectToOptions(en.Type,function(e){return ji(e)})),invert:E.Boolean(!1),position:E.Vec3(C()),rotation:E.Group({axis:E.Vec3(C.create(1,0,0)),angle:E.Numeric(0,{min:-180,max:180,step:1},{description:"Angle in Degrees"})},{isExpanded:!0}),scale:E.Vec3(C.create(1,1,1))},function(e){return ji(e.type)})})};function aI(e){switch(e.name){case"custom":return e.params;case"flat":return{lightIntensity:0,ambientIntensity:1,metalness:0,roughness:.4,reflectivity:.5};case"matte":return{lightIntensity:.7,ambientIntensity:.3,metalness:0,roughness:1,reflectivity:.5};case"glossy":return{lightIntensity:.7,ambientIntensity:.3,metalness:0,roughness:.4,reflectivity:.5};case"metallic":return{lightIntensity:.7,ambientIntensity:.7,metalness:.6,roughness:.6,reflectivity:.5};case"plastic":return{lightIntensity:.7,ambientIntensity:.3,metalness:0,roughness:.2,reflectivity:.5}}}var wye=In();function iI(e,t){for(var r=(t==null?void 0:t.objects)||{type:new Array(5).fill(1),invert:new Array(5).fill(!1),position:new Array(15).fill(0),rotation:new Array(20).fill(0),scale:new Array(15).fill(1)},n=r.type,a=r.invert,i=r.position,o=r.rotation,s=r.scale,u=0,l=e.objects.length;u<l;++u){var c=e.objects[u];n[u]=en.Type[c.type],a[u]=c.invert,C.toArray(c.position,i,u*3),In.toArray(In.setAxisAngle(wye,c.rotation.axis,Wr(c.rotation.angle)),o,u*4),C.toArray(c.scale,s,u*3)}return{variant:e.variant,objects:{count:e.objects.length,type:n,invert:a,position:i,rotation:o,scale:s}}}var FC;(function(e){function t(r,n){n===void 0&&(n={});var a=r.gl,i=r.state,o=r.stats,s=r.extensions.fragDepth,u=E.merge(OC,E.getDefaultValues(OC),n),l=aI(u.style),c=iI(u.clip),d=ga(),f=Ge.create(a.drawingBufferWidth,a.drawingBufferHeight),p=it.toVec3Normalized(C(),u.backgroundColor),h=!1,v=Jy(a),m=[["tDepth",v]],g=ue(),y=ue(),b=ue(),x=ue(),S=ue(),_=ue(),A=ue(),T=C(),I=Ge(),M={uModel:k.create(ue.identity()),uView:k.create(g),uInvView:k.create(y),uModelView:k.create(b),uInvModelView:k.create(x),uInvProjection:k.create(S),uProjection:k.create(ue()),uModelViewProjection:k.create(_),uInvModelViewProjection:k.create(A),uIsOrtho:k.create(1),uViewOffset:k.create(I),uPixelRatio:k.create(r.pixelRatio),uViewportHeight:k.create(d.height),uViewport:k.create(ga.toVec4(Cr(),d)),uDrawingBufferSize:k.create(f),uCameraPosition:k.create(C()),uCameraDir:k.create(T),uNear:k.create(1),uFar:k.create(1e4),uFogNear:k.create(1),uFogFar:k.create(1e4),uFogColor:k.create(p),uRenderWboit:k.create(!1),uTransparentBackground:k.create(!1),uClipObjectType:k.create(c.objects.type),uClipObjectInvert:k.create(c.objects.invert),uClipObjectPosition:k.create(c.objects.position),uClipObjectRotation:k.create(c.objects.rotation),uClipObjectScale:k.create(c.objects.scale),uLightIntensity:k.create(l.lightIntensity),uAmbientIntensity:k.create(l.ambientIntensity),uMetalness:k.create(l.metalness),uRoughness:k.create(l.roughness),uReflectivity:k.create(l.reflectivity),uPickingAlphaThreshold:k.create(u.pickingAlphaThreshold),uInteriorDarkening:k.create(u.interiorDarkening),uInteriorColorFlag:k.create(u.interiorColorFlag),uInteriorColor:k.create(it.toVec3Normalized(C(),u.interiorColor)),uHighlightColor:k.create(it.toVec3Normalized(C(),u.highlightColor)),uSelectColor:k.create(it.toVec3Normalized(C(),u.selectColor)),uXrayEdgeFalloff:k.create(u.xrayEdgeFalloff)},O=Object.entries(M),D=!0,F=function(U,H){if(!(U.state.disposed||!U.state.visible||!U.state.pickable&&H[0]==="p")){var J=!1;U.state.noClip?U.values.dClipObjectCount.ref.value!==0&&(k.update(U.values.dClipObjectCount,0),J=!0):(U.values.dClipObjectCount.ref.value!==c.objects.count&&(k.update(U.values.dClipObjectCount,c.objects.count),J=!0),U.values.dClipVariant.ref.value!==c.variant&&(k.update(U.values.dClipVariant,c.variant),J=!0)),J&&U.update();var X=U.getProgram(H);i.currentProgramId!==X.id&&(D=!0,X.use()),D&&(X.setUniforms(O),D=!1),U.values.dRenderMode?(i.disable(a.CULL_FACE),i.frontFace(a.CCW),H==="colorBlended"&&(U.values.dRenderMode.ref.value==="volume"||!s?(i.disable(a.DEPTH_TEST),i.depthMask(!1)):(i.enable(a.DEPTH_TEST),i.depthMask(U.values.uAlpha.ref.value===1)))):(U.values.dDoubleSided?U.values.dDoubleSided.ref.value||U.values.hasReflection.ref.value?i.disable(a.CULL_FACE):i.enable(a.CULL_FACE):i.disable(a.CULL_FACE),U.values.dFlipSided&&U.values.dFlipSided.ref.value?(i.frontFace(a.CW),i.cullFace(a.FRONT)):(i.frontFace(a.CCW),i.cullFace(a.BACK))),U.render(H,m)}},G=function(U){k.update(M.uView,U.view),k.update(M.uInvView,ue.invert(y,U.view)),k.update(M.uProjection,U.projection),k.update(M.uInvProjection,ue.invert(S,U.projection)),k.updateIfChanged(M.uIsOrtho,U.state.mode==="orthographic"?1:0),k.update(M.uViewOffset,U.viewOffset.enabled?Ge.set(I,U.viewOffset.offsetX*16,U.viewOffset.offsetY*16):Ge.set(I,0,0)),k.update(M.uCameraPosition,U.state.position),k.update(M.uCameraDir,C.normalize(T,C.sub(T,U.state.target,U.state.position))),k.updateIfChanged(M.uFar,U.far),k.updateIfChanged(M.uNear,U.near),k.updateIfChanged(M.uFogFar,U.fogFar),k.updateIfChanged(M.uFogNear,U.fogNear),k.updateIfChanged(M.uTransparentBackground,h)},N=function(U,H,J,X){IX(m,"tDepth",J||v),k.update(M.uModel,U.view),k.update(M.uModelView,ue.mul(b,U.view,H.view)),k.update(M.uInvModelView,ue.invert(x,b)),k.update(M.uModelViewProjection,ue.mul(_,b,H.projection)),k.update(M.uInvModelViewProjection,ue.invert(A,_)),k.updateIfChanged(M.uRenderWboit,X),i.enable(a.SCISSOR_TEST),i.colorMask(!0,!0,!0,!0);var Q=d.x,ee=d.y,le=d.width,ye=d.height;a.viewport(Q,ee,le,ye),a.scissor(Q,ee,le,ye),D=!0,i.currentRenderItemId=-1},z=function(U,H,J,X){i.disable(a.BLEND),i.enable(a.DEPTH_TEST),i.depthMask(!0),N(U,H,X,!1);for(var Q=U.renderables,ee=0,le=Q.length;ee<le;++ee)Q[ee].state.colorOnly||F(Q[ee],J)},$=function(U,H,J){i.disable(a.BLEND),i.enable(a.DEPTH_TEST),i.depthMask(!0),N(U,H,J,!1);for(var X=U.renderables,Q=0,ee=X.length;Q<ee;++Q)F(X[Q],"depth")},j=function(U,H,J){Z(U,H,J),q(U,H,J)},Z=function(U,H,J){i.disable(a.BLEND),i.enable(a.DEPTH_TEST),i.depthMask(!0),N(U,H,J,!1);for(var X=U.renderables,Q=0,ee=X.length;Q<ee;++Q){var le=X[Q];le.state.opaque&&F(le,"colorBlended")}},q=function(U,H,J){i.enable(a.DEPTH_TEST),N(U,H,J,!1);var X=U.renderables;h?i.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA):i.blendFuncSeparate(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA),i.enable(a.BLEND),i.depthMask(!0);for(var Q=0,ee=X.length;Q<ee;++Q){var le=X[Q];!le.state.opaque&&le.state.writeDepth&&F(le,"colorBlended")}i.depthMask(!1);for(var Q=0,ee=X.length;Q<ee;++Q){var le=X[Q];!le.state.opaque&&!le.state.writeDepth&&F(le,"colorBlended")}},te=function(U,H,J){var X;i.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA),i.enable(a.BLEND),N(U,H,J,!1);for(var Q=U.renderables,ee=0,le=Q.length;ee<le;++ee){var ye=Q[ee],be=Ka(ye.values.alpha.ref.value*ye.state.alphaFactor,0,1);be===1&&ye.values.transparencyAverage.ref.value!==1&&!(!((X=ye.values.dXrayShaded)===null||X===void 0)&&X.ref.value)&&F(ye,"colorBlended")}},he=function(U,H,J){var X;i.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA),i.enable(a.BLEND),N(U,H,J,!1);for(var Q=U.renderables,ee=0,le=Q.length;ee<le;++ee){var ye=Q[ee],be=Ka(ye.values.alpha.ref.value*ye.state.alphaFactor,0,1);(be<1||ye.values.transparencyAverage.ref.value>0||((X=ye.values.dXrayShaded)===null||X===void 0?void 0:X.ref.value))&&F(ye,"colorBlended")}},W=function(U,H,J){var X,Q,ee;i.disable(a.BLEND),i.enable(a.DEPTH_TEST),i.depthMask(!0),N(U,H,J,!1);for(var le=U.renderables,ye=0,be=le.length;ye<be;++ye){var Ae=le[ye],xe=Ka(Ae.values.alpha.ref.value*Ae.state.alphaFactor,0,1);xe===1&&Ae.values.transparencyAverage.ref.value!==1&&((X=Ae.values.dRenderMode)===null||X===void 0?void 0:X.ref.value)!=="volume"&&!(!((Q=Ae.values.dPointFilledCircle)===null||Q===void 0)&&Q.ref.value)&&!(!((ee=Ae.values.dXrayShaded)===null||ee===void 0)&&ee.ref.value)&&F(Ae,"colorWboit")}},K=function(U,H,J){var X,Q,ee;N(U,H,J,!0);for(var le=U.renderables,ye=0,be=le.length;ye<be;++ye){var Ae=le[ye],xe=Ka(Ae.values.alpha.ref.value*Ae.state.alphaFactor,0,1);(xe<1||Ae.values.transparencyAverage.ref.value>0||((X=Ae.values.dRenderMode)===null||X===void 0?void 0:X.ref.value)==="volume"||((Q=Ae.values.dPointFilledCircle)===null||Q===void 0?void 0:Q.ref.value)||!!Ae.values.uBackgroundColor||((ee=Ae.values.dXrayShaded)===null||ee===void 0?void 0:ee.ref.value))&&F(Ae,"colorWboit")}};return{clear:function(U){i.enable(a.SCISSOR_TEST),i.enable(a.DEPTH_TEST),i.colorMask(!0,!0,!0,!0),i.depthMask(!0),h?i.clearColor(0,0,0,0):U?i.clearColor(p[0],p[1],p[2],1):i.clearColor(1,1,1,1),a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT)},clearDepth:function(){i.enable(a.SCISSOR_TEST),i.enable(a.DEPTH_TEST),i.depthMask(!0),a.clear(a.DEPTH_BUFFER_BIT)},update:G,renderPick:z,renderDepth:$,renderBlended:j,renderBlendedOpaque:Z,renderBlendedTransparent:q,renderBlendedVolumeOpaque:te,renderBlendedVolumeTransparent:he,renderWboitOpaque:W,renderWboitTransparent:K,setProps:function(U){U.backgroundColor!==void 0&&U.backgroundColor!==u.backgroundColor&&(u.backgroundColor=U.backgroundColor,it.toVec3Normalized(p,u.backgroundColor),k.update(M.uFogColor,C.copy(M.uFogColor.ref.value,p))),U.pickingAlphaThreshold!==void 0&&U.pickingAlphaThreshold!==u.pickingAlphaThreshold&&(u.pickingAlphaThreshold=U.pickingAlphaThreshold,k.update(M.uPickingAlphaThreshold,u.pickingAlphaThreshold)),U.interiorDarkening!==void 0&&U.interiorDarkening!==u.interiorDarkening&&(u.interiorDarkening=U.interiorDarkening,k.update(M.uInteriorDarkening,u.interiorDarkening)),U.interiorColorFlag!==void 0&&U.interiorColorFlag!==u.interiorColorFlag&&(u.interiorColorFlag=U.interiorColorFlag,k.update(M.uInteriorColorFlag,u.interiorColorFlag)),U.interiorColor!==void 0&&U.interiorColor!==u.interiorColor&&(u.interiorColor=U.interiorColor,k.update(M.uInteriorColor,it.toVec3Normalized(M.uInteriorColor.ref.value,u.interiorColor))),U.highlightColor!==void 0&&U.highlightColor!==u.highlightColor&&(u.highlightColor=U.highlightColor,k.update(M.uHighlightColor,it.toVec3Normalized(M.uHighlightColor.ref.value,u.highlightColor))),U.selectColor!==void 0&&U.selectColor!==u.selectColor&&(u.selectColor=U.selectColor,k.update(M.uSelectColor,it.toVec3Normalized(M.uSelectColor.ref.value,u.selectColor))),U.xrayEdgeFalloff!==void 0&&U.xrayEdgeFalloff!==u.xrayEdgeFalloff&&(u.xrayEdgeFalloff=U.xrayEdgeFalloff,k.update(M.uXrayEdgeFalloff,u.xrayEdgeFalloff)),U.style!==void 0&&(u.style=U.style,Object.assign(l,aI(U.style)),k.updateIfChanged(M.uLightIntensity,l.lightIntensity),k.updateIfChanged(M.uAmbientIntensity,l.ambientIntensity),k.updateIfChanged(M.uMetalness,l.metalness),k.updateIfChanged(M.uRoughness,l.roughness),k.updateIfChanged(M.uReflectivity,l.reflectivity)),U.clip!==void 0&&!ku(U.clip,u.clip)&&(u.clip=U.clip,Object.assign(c,iI(U.clip,c)),k.update(M.uClipObjectPosition,c.objects.position),k.update(M.uClipObjectRotation,c.objects.rotation),k.update(M.uClipObjectScale,c.objects.scale),k.update(M.uClipObjectType,c.objects.type))},setViewport:function(U,H,J,X){a.viewport(U,H,J,X),a.scissor(U,H,J,X),(U!==d.x||H!==d.y||J!==d.width||X!==d.height)&&(ga.set(d,U,H,J,X),k.update(M.uViewportHeight,X),k.update(M.uViewport,Cr.set(M.uViewport.ref.value,U,H,J,X)))},setTransparentBackground:function(U){h=U},setDrawingBufferSize:function(U,H){(U!==f[0]||H!==f[1])&&k.update(M.uDrawingBufferSize,Ge.set(f,U,H))},props:u,get stats(){return{programCount:r.stats.resourceCounts.program,shaderCount:r.stats.resourceCounts.shader,attributeCount:r.stats.resourceCounts.attribute,elementsCount:r.stats.resourceCounts.elements,framebufferCount:r.stats.resourceCounts.framebuffer,renderbufferCount:r.stats.resourceCounts.renderbuffer,textureCount:r.stats.resourceCounts.texture,vertexArrayCount:r.stats.resourceCounts.vertexArray,drawCount:o.drawCount,instanceCount:o.instanceCount,instancedDrawCount:o.instancedDrawCount}},dispose:function(){}}}e.create=t})(FC||(FC={}));function fr(e,t,r){return t===void 0&&(t=""),r===void 0&&(r=""),fr.create(e,t,r)}(function(e){function t(s,u,l){return u===void 0&&(u=""),l===void 0&&(l=""),{triggers:s,action:u,description:l}}e.create=t,e.Empty={triggers:[],action:"",description:""};function r(s){return s.triggers.length===0||s.triggers.every(function(u){return u.buttons===void 0&&u.modifiers===void 0})}e.isEmpty=r;function n(s,u,l){return s.triggers.some(function(c){return o.match(c,u,l)})}e.match=n;function a(s){return s.triggers.map(o.format).join(" or ")}e.formatTriggers=a;function i(s,u){u===void 0&&(u="");var l=s.description||ji(u);return QH(l,{triggers:"<i>"+a(s)+"</i>"})}e.format=i;function o(s,u){return o.create(s,u)}e.Trigger=o,function(s){function u(d,f){return{buttons:d,modifiers:f}}s.create=u,s.Empty={};function l(d,f,p){var h=d.buttons,v=d.modifiers;return h!==void 0&&(h===f||Hd.has(h,f))&&(!v||is.areEqual(v,p))}s.match=l;function c(d){var f=[],p=Aye(d.buttons);p&&f.push(p);var h=Pye(d.modifiers);return h&&f.push(h),f.join(" + ")}s.format=c}(o=e.Trigger||(e.Trigger={}))})(fr||(fr={}));var Ym=Hd;function Aye(e){var t=[];return e===void 0?t.push("any mouse button"):e===0?t.push("mouse hover"):(Ym.has(e,1)&&t.push("left mouse button"),Ym.has(e,2)&&t.push("right mouse button"),Ym.has(e,4)&&t.push("wheel/middle mouse button"),Ym.has(e,8)&&t.push("three fingers")),t.join(" + ")}function Pye(e,t){var r=[];return e?(e.alt&&r.push("alt key"),e.control&&r.push("control key"),e.meta&&r.push("meta/command key"),e.shift&&r.push("shift key"),t&&r.length===0&&r.push("no key")):t&&r.push("any key"),r.join(" + ")}var Il=is,Ml=fr.Trigger,Tye={dragRotate:fr([Ml(1,Il.create())],"Rotate","Drag using ${triggers}"),dragRotateZ:fr([Ml(1,Il.create({shift:!0}))],"Rotate around z-axis","Drag using ${triggers}"),dragPan:fr([Ml(2,Il.create()),Ml(1,Il.create({control:!0}))],"Pan","Drag using ${triggers}"),dragZoom:fr.Empty,dragFocus:fr([Ml(8,Il.create())],"Focus","Drag using ${triggers}"),dragFocusZoom:fr([Ml(4,Il.create())],"Focus and zoom","Drag using ${triggers}"),scrollZoom:fr([Ml(4,Il.create())],"Zoom","Scroll using ${triggers}"),scrollFocus:fr([Ml(4,Il.create({shift:!0}))],"Clip","Scroll using ${triggers}"),scrollFocusZoom:fr.Empty},HB={noScroll:E.Boolean(!0,{isHidden:!0}),rotateSpeed:E.Numeric(5,{min:1,max:10,step:1}),zoomSpeed:E.Numeric(7,{min:1,max:15,step:1}),panSpeed:E.Numeric(1,{min:.1,max:5,step:.1}),spin:E.Boolean(!1,{description:"Spin the 3D scene around the x-axis in view space"}),spinSpeed:E.Numeric(1,{min:-20,max:20,step:1}),staticMoving:E.Boolean(!0,{isHidden:!0}),dynamicDampingFactor:E.Numeric(.2,{},{isHidden:!0}),minDistance:E.Numeric(.01,{},{isHidden:!0}),maxDistance:E.Numeric(1e150,{},{isHidden:!0}),bindings:E.Value(Tye,{isHidden:!0}),autoAdjustMinMaxDistance:E.MappedStatic("on",{off:E.EmptyGroup(),on:E.Group({minDistanceFactor:E.Numeric(0),minDistancePadding:E.Numeric(5),maxDistanceFactor:E.Numeric(10),maxDistanceMin:E.Numeric(20)})},{isHidden:!0})},kC;(function(e){function t(r,n,a){a===void 0&&(a={});var i=w(w({},E.getDefaultValues(HB)),a),o=ga.clone(n.viewport),s=!1,u=r.drag.subscribe(V),l=r.interactionEnd.subscribe(pe),c=r.wheel.subscribe(_e),d=r.pinch.subscribe(Ee),f=!1,p=C(),h=C(),v=Ge(),m=Ge(),g=C(),y=0,b=Ge(),x=Ge(),S=0,_=Ge(),A=Ge(),T=Ge(),I=Ge(),M=Ge(),O=Ge(),D=C.clone(n.target),F=C.clone(n.position),G=C.clone(n.up),N=Ge();function z(Le,Qe){return Ge.set(N,(Le-o.x)/o.width,(Qe-o.y)/o.height)}var $=Ge();function j(Le,Qe){return Ge.set($,(Le-o.width*.5-o.x)/(o.width*.5),(o.height+2*(o.y-Qe))/o.width)}var Z=C(),q=In(),te=C(),he=C(),W=C(),K=C();function U(){var Le=m[0]-v[0],Qe=m[1]-v[1];C.set(K,Le,Qe,0);var at=r.width/r.height,ot=C.magnitude(K)*i.rotateSpeed*r.pixelRatio*at;ot?(C.sub(h,n.position,n.target),C.normalize(te,h),C.normalize(he,n.up),C.normalize(W,C.cross(W,he,te)),C.setMagnitude(he,he,Qe),C.setMagnitude(W,W,Le),C.add(K,he,W),C.normalize(Z,C.cross(Z,K,h)),In.setAxisAngle(q,Z,ot),C.transformQuat(h,h,q),C.transformQuat(n.up,n.up,q),C.copy(g,Z),y=ot):!i.staticMoving&&y&&(y*=Math.sqrt(1-i.dynamicDampingFactor),C.sub(h,n.position,n.target),In.setAxisAngle(q,g,y),C.transformQuat(h,h,q),C.transformQuat(n.up,n.up,q)),Ge.copy(v,m)}var H=In();function J(){var Le=x[0]-b[0],Qe=x[1]-b[1],at=i.rotateSpeed*(-Le+Qe)*-.05;at?(C.sub(h,n.position,n.target),In.setAxisAngle(H,h,at),C.transformQuat(n.up,n.up,H),S=at):!i.staticMoving&&S&&(S*=Math.sqrt(1-i.dynamicDampingFactor),C.sub(h,n.position,n.target),In.setAxisAngle(H,h,S),C.transformQuat(n.up,n.up,H)),Ge.copy(b,x)}function X(){var Le=1+(A[1]-_[1])*i.zoomSpeed;Le!==1&&Le>0&&C.scale(h,h,Le),i.staticMoving?Ge.copy(_,A):_[1]+=(A[1]-_[1])*i.dynamicDampingFactor}function Q(){var Le=(I[1]-T[1])*i.zoomSpeed;if(Le!==0){var Qe=Math.max(1,n.state.radius+n.state.radius*Le);n.setState({radius:Qe})}i.staticMoving?Ge.copy(T,I):T[1]+=(I[1]-T[1])*i.dynamicDampingFactor}var ee=Ge(),le=C(),ye=C();function be(){if(Ge.sub(ee,Ge.copy(ee,O),M),Ge.squaredMagnitude(ee)){var Le=r.pixelRatio*i.panSpeed;ee[0]*=1/n.zoom*n.viewport.width*Le,ee[1]*=1/n.zoom*n.viewport.height*Le,C.cross(ye,C.copy(ye,h),n.up),C.setMagnitude(ye,ye,ee[0]),C.setMagnitude(le,n.up,ee[1]),C.add(ye,ye,le),C.add(n.position,n.position,ye),C.add(n.target,n.target,ye),i.staticMoving?Ge.copy(M,O):(Ge.sub(ee,O,M),Ge.scale(ee,ee,i.dynamicDampingFactor),Ge.add(M,M,ee))}}function Ae(){var Le=Math.min(Math.max(n.state.radiusMax*1e3,.01),i.maxDistance);C.squaredMagnitude(h)>Le*Le&&(C.setMagnitude(h,h,Le),C.add(n.position,n.target,h),Ge.copy(_,A),Ge.copy(T,I)),C.squaredMagnitude(h)<i.minDistance*i.minDistance&&(C.setMagnitude(h,h,i.minDistance),C.add(n.position,n.target,h),Ge.copy(_,A),Ge.copy(T,I))}function xe(Le,Qe){return Le*=r.pixelRatio,Qe*=r.pixelRatio,Le>o.x+o.width||r.height-Qe>o.y+o.height||Le<o.x||r.height-Qe<o.y}var ae=-1;function oe(Le){ae!==Le&&(i.spin&&ae>0&&Ye(Le-ae),C.sub(h,n.position,n.target),U(),J(),X(),Q(),be(),C.add(n.position,n.target,h),Ae(),C.squaredDistance(p,n.position)>fn&&C.copy(p,n.position),ae=Le)}function R(){C.copy(n.target,D),C.copy(n.position,F),C.copy(n.up,G),C.sub(h,n.position,n.target),C.copy(p,n.position)}function V(Le){var Qe=Le.x,at=Le.y,ot=Le.pageX,dt=Le.pageY,Oe=Le.buttons,Me=Le.modifiers,Ke=Le.isStart,tt=xe(Qe,at);if(!(Ke&&tt)&&!(!Ke&&!f)){f=!0;var St=fr.match(i.bindings.dragRotate,Oe,Me),ht=fr.match(i.bindings.dragRotateZ,Oe,Me),ut=fr.match(i.bindings.dragPan,Oe,Me),fe=fr.match(i.bindings.dragZoom,Oe,Me),me=fr.match(i.bindings.dragFocus,Oe,Me),we=fr.match(i.bindings.dragFocusZoom,Oe,Me);if(j(ot,dt),z(ot,dt),Ke&&(St&&(Ge.copy(m,$),Ge.copy(v,m)),ht&&(Ge.copy(x,$),Ge.copy(b,x)),(fe||we)&&(Ge.copy(_,N),Ge.copy(A,_)),me&&(Ge.copy(T,N),Ge.copy(I,T)),ut&&(Ge.copy(M,N),Ge.copy(O,M))),St&&Ge.copy(m,$),ht&&Ge.copy(x,$),(fe||we)&&Ge.copy(A,N),me&&Ge.copy(I,N),we){var $e=C.distance(n.state.position,n.state.target);n.setState({radius:$e/5})}ut&&Ge.copy(O,N)}}function pe(){f=!1}function _e(Le){var Qe=Le.x,at=Le.y,ot=Le.dx,dt=Le.dy,Oe=Le.dz,Me=Le.buttons,Ke=Le.modifiers;if(!xe(Qe,at)){var tt=qH(ot,dt,Oe);fr.match(i.bindings.scrollZoom,Me,Ke)&&(A[1]+=tt*1e-4),fr.match(i.bindings.scrollFocus,Me,Ke)&&(I[1]+=tt*1e-4)}}function Ee(Le){var Qe=Le.fraction,at=Le.buttons,ot=Le.modifiers;fr.match(i.bindings.scrollZoom,at,ot)&&(f=!0,A[1]+=(Qe-1)*.1)}function Ve(){s||(s=!0,u.unsubscribe(),c.unsubscribe(),d.unsubscribe(),l.unsubscribe())}var He=Ge.create(.005,0);function Ye(Le){if(i.spinSpeed!==0){var Qe=(i.spinSpeed||0)/1e3;He[0]=60*Math.min(Math.abs(Le),1e3/8)/1e3*Qe,f||Ge.add(m,v,He)}}function lt(Le){ae=-1,oe(Le)}return{viewport:o,get props(){return i},setProps:function(Le){Object.assign(i,Le)},start:lt,update:oe,reset:R,dispose:Ve}}e.create=t})(kC||(kC={}));var Kg;(function(e){function t(){return{view:ue.identity(),position:C.create(0,0,0),direction:C.create(0,0,-1),up:C.create(0,1,0)}}e.create=t;var r=C.zero();function n(a){C.add(r,a.position,a.direction),ue.lookAt(a.view,a.position,r,a.up)}e.update=n})(Kg||(Kg={}));var Eye=function(){function e(){this.removeList=yx(),this.removeMap=new Map,this.addList=yx(),this.addMap=new Map}return Object.defineProperty(e.prototype,"isEmpty",{get:function(){return this.removeList.count===0&&this.addList.count===0},enumerable:!1,configurable:!0}),e.prototype.add=function(t){if(this.removeMap.has(t)){var r=this.removeMap.get(t);this.removeMap.delete(t),this.removeList.remove(r)}if(!this.addMap.has(t)){var n=this.addList.addLast(t);this.addMap.set(t,n)}},e.prototype.remove=function(t){if(this.addMap.has(t)){var r=this.addMap.get(t);this.addMap.delete(t),this.addList.remove(r)}if(!this.removeMap.has(t)){var n=this.removeList.addLast(t);this.removeMap.set(t,n)}},e.prototype.tryGetRemove=function(){var t=this.removeList.removeFirst();return t&&this.removeMap.delete(t),t},e.prototype.tryGetAdd=function(){var t=this.addList.removeFirst();return t&&this.addMap.delete(t),t},e}(),ah=new eo("98");function oI(e,t,r){ah.reset();for(var n=0,a=e.length;n<a;++n)if(!(r&&!e[n].state.visible)){var i=e[n].values.boundingSphere.ref.value;!i.radius||ah.includeSphere(i)}ah.finishedIncludeStep();for(var n=0,a=e.length;n<a;++n)if(!(r&&!e[n].state.visible)){var o=e[n].values.boundingSphere.ref.value;!o.radius||ah.radiusSphere(o)}return ah.getSphere(t)}function Iye(e,t){var r=e.getProgram("colorBlended").id,n=t.getProgram("colorBlended").id,a=e.materialId,i=t.materialId;return r!==n?r-n:a!==i?a-i:e.id-t.id}var bp;(function(e){function t(r){var n=new Map,a=[],i=Ne(),o=Ne(),s=[],u=[],l=!0,c=!0,d=Kg.create(),f=d.view,p=d.position,h=d.direction,v=d.up;function m(T){if(n.has(T))return console.warn("RenderObject with id '"+T.id+"' already present"),n.get(T);var I=ile(r,T);return a.push(I),T.type==="direct-volume"?u.push(I):s.push(I),n.set(T,I),l=!0,c=!0,I}function g(T){var I=n.get(T);I&&(I.dispose(),yd(a,I),yd(s,I),yd(u,I),n.delete(T),l=!0,c=!0)}var y=100;function b(T){for(var I=xn(),M=0;;){var O=x.tryGetRemove();if(!O)break;if(g(O),++M%y===0&&xn()-I>T)return!1}for(;;){var O=x.tryGetAdd();if(!O)break;if(m(O),++M%y===0&&xn()-I>T)return!1}return a.sort(Iye),!0}var x=new Eye,S=-1;function _(){for(var T=23,I=0,M=a.length;I<M;++I)!a[I].state.visible||(T=31*T+a[I].id|0);return T=aR(T),T===-1&&(T=0),T}function A(){var T=_();return T!==S?(c=!0,!0):!1}return{view:f,position:p,direction:h,up:v,renderables:a,primitives:{view:f,position:p,direction:h,up:v,renderables:s},volumes:{view:f,position:p,direction:h,up:v,renderables:u},syncVisibility:A,update:function(T,I){var M;if(Kg.update(d),T)for(var O=0,D=T.length;O<D;++O)(M=n.get(T[O]))===null||M===void 0||M.update();else for(var O=0,D=a.length;O<D;++O)a[O].update();I?A():(l=!0,c=!0)},add:function(T){return x.add(T)},remove:function(T){return x.remove(T)},commit:function(T){return T===void 0&&(T=Number.MAX_VALUE),b(T)},get needsCommit(){return!x.isEmpty},has:function(T){return n.has(T)},clear:function(){for(var T=0,I=a.length;T<I;++T)a[T].dispose();a.length=0,n.clear(),l=!0,c=!0},forEach:function(T){n.forEach(T)},get count(){return a.length},get boundingSphere(){return l&&(oI(a,i,!1),l=!1),i},get boundingSphereVisible(){return c&&(oI(a,o,!0),c=!1,S=_()),o}}}e.create=t})(bp||(bp={}));var BC=function(){function e(t){this.camera=t,this.t=0,this.func=e.defaultTransition,this.start=0,this.inTransition=!1,this.durationMs=0,this._source=Gn.createDefaultSnapshot(),this._target=Gn.createDefaultSnapshot(),this._current=Gn.createDefaultSnapshot()}return Object.defineProperty(e.prototype,"source",{get:function(){return this._source},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){return this._target},enumerable:!1,configurable:!0}),e.prototype.apply=function(t,r,n){if(r===void 0&&(r=0),(!this.inTransition||r>0)&&Gn.copySnapshot(this._source,this.camera.state),this.inTransition||Gn.copySnapshot(this._target,this.camera.state),Gn.copySnapshot(this._target,t),this._target.radius>this._target.radiusMax&&(this._target.radius=this._target.radiusMax),this._target.radius<.01&&(this._target.radius=.01),this._target.radiusMax<.01&&(this._target.radiusMax=.01),!this.inTransition&&r<=0||typeof t.mode!="undefined"&&t.mode!==this.camera.state.mode){this.finish(this._target);return}this.inTransition=!0,this.func=n||e.defaultTransition,(!this.inTransition||r>0)&&(this.start=this.t,this.durationMs=r)},e.prototype.tick=function(t){this.t=t,this.update()},e.prototype.finish=function(t){Gn.copySnapshot(this.camera.state,t),this.inTransition=!1},e.prototype.update=function(){if(!!this.inTransition){var t=Math.min((this.t-this.start)/this.durationMs,1);if(t===1){this.finish(this._target);return}this.func(this._current,t,this._source,this._target),Gn.copySnapshot(this.camera.state,this._current)}},e}();(function(e){var t=In.identity();function r(n,a,i,o){Gn.copySnapshot(n,o),In.slerp(t,In.Identity,In.rotationTo(t,i.up,o.up),a),C.transformQuat(n.up,i.up,t),C.lerp(n.target,i.target,o.target,a),C.lerp(n.position,i.position,o.position,a),n.radius=Gi(i.radius,o.radius,a),n.radiusMax=Gi(i.radiusMax,o.radiusMax,a),n.fov=Gi(i.fov,o.fov,a),n.fog=Gi(i.fog,o.fog,a)}e.defaultTransition=r})(BC||(BC={}));var Gn=function(){function e(t,r,n){r===void 0&&(r=ga.create(0,0,128,128)),n===void 0&&(n={}),this.view=ue.identity(),this.projection=ue.identity(),this.projectionView=ue.identity(),this.inverseProjectionView=ue.identity(),this.state=e.createDefaultSnapshot(),this.viewOffset=e.ViewOffset(),this.near=1,this.far=1e4,this.fogNear=5e3,this.fogFar=1e4,this.zoom=1,this.transition=new BC(this),this.stateChanged=new tc(this.state),this.prevProjection=ue.identity(),this.prevView=ue.identity(),this.deltaDirection=C(),this.newPosition=C(),this.viewport=r,this.pixelScale=n.pixelScale||1,e.copySnapshot(this.state,t)}return Object.defineProperty(e.prototype,"pixelRatio",{get:function(){var t=typeof window!="undefined"?window.devicePixelRatio:1;return t*this.pixelScale},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"position",{get:function(){return this.state.position},set:function(t){C.copy(this.state.position,t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"up",{get:function(){return this.state.up},set:function(t){C.copy(this.state.up,t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){return this.state.target},set:function(t){C.copy(this.state.target,t)},enumerable:!1,configurable:!0}),e.prototype.update=function(){var t=this.state;if(t.radiusMax===0)return!1;var r=2*Math.tan(t.fov/2)*C.distance(t.position,t.target);switch(this.zoom=this.viewport.height/r,Rye(this),this.state.mode){case"orthographic":Mye(this);break;case"perspective":Dye(this);break;default:throw new Error("unknown camera mode")}var n=!ue.areEqual(this.projection,this.prevProjection,fn)||!ue.areEqual(this.view,this.prevView,fn);if(n){if(ue.mul(this.projectionView,this.projection,this.view),!ue.tryInvert(this.inverseProjectionView,this.projectionView))return ue.copy(this.view,this.prevView),ue.copy(this.projection,this.prevProjection),ue.mul(this.projectionView,this.projection,this.view),!1;ue.copy(this.prevView,this.view),ue.copy(this.prevProjection,this.projection)}return n},e.prototype.setState=function(t,r){this.transition.apply(t,r),this.stateChanged.next(t)},e.prototype.getSnapshot=function(){return e.copySnapshot(e.createDefaultSnapshot(),this.state)},e.prototype.getTargetDistance=function(t){return e.targetDistance(t,this.state.fov,this.viewport.width,this.viewport.height)},e.prototype.getFocus=function(t,r,n,a){var i=Math.max(r,.01),o=this.getTargetDistance(i);C.sub(this.deltaDirection,this.target,this.position),a&&C.matchDirection(this.deltaDirection,a,this.deltaDirection),C.setMagnitude(this.deltaDirection,this.deltaDirection,o),C.sub(this.newPosition,t,this.deltaDirection);var s=e.copySnapshot(e.createDefaultSnapshot(),this.state);return s.target=C.clone(t),s.radius=i,s.position=C.clone(this.newPosition),n&&C.matchDirection(s.up,n,s.up),s},e.prototype.getInvariantFocus=function(t,r,n,a){var i=Math.max(r,.01),o=this.getTargetDistance(i);C.copy(this.deltaDirection,a),C.setMagnitude(this.deltaDirection,this.deltaDirection,o),C.sub(this.newPosition,t,this.deltaDirection);var s=e.copySnapshot(e.createDefaultSnapshot(),this.state);return s.target=C.clone(t),s.radius=i,s.position=C.clone(this.newPosition),C.copy(s.up,n),s},e.prototype.focus=function(t,r,n,a,i){r>0&&this.setState(this.getFocus(t,r,a,i),n)},e.prototype.project=function(t,r){return _ye(t,r,this.viewport,this.projectionView)},e.prototype.unproject=function(t,r){return F0(t,r,this.viewport,this.inverseProjectionView)},e}();(function(e){function t(){return{enabled:!1,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}}e.ViewOffset=t;function r(u,l,c,d,f,p,h){u.fullWidth=l,u.fullHeight=c,u.offsetX=d,u.offsetY=f,u.width=p,u.height=h}e.setViewOffset=r;function n(u,l){u.enabled=l.enabled,u.fullWidth=l.fullWidth,u.fullHeight=l.fullHeight,u.offsetX=l.offsetX,u.offsetY=l.offsetY,u.width=l.width,u.height=l.height}e.copyViewOffset=n;function a(u,l,c,d){var f=Math.max(u,.01),p=c/d,h=d<c?1:p;return Math.abs(f/h/Math.sin(l/2))}e.targetDistance=a;function i(){return{mode:"perspective",fov:Math.PI/4,position:C.create(0,0,100),up:C.create(0,1,0),target:C.create(0,0,0),radius:0,radiusMax:10,fog:50,clipFar:!0}}e.createDefaultSnapshot=i;function o(u,l){return l&&(typeof l.mode!="undefined"&&(u.mode=l.mode),typeof l.fov!="undefined"&&(u.fov=l.fov),typeof l.position!="undefined"&&C.copy(u.position,l.position),typeof l.up!="undefined"&&C.copy(u.up,l.up),typeof l.target!="undefined"&&C.copy(u.target,l.target),typeof l.radius!="undefined"&&(u.radius=l.radius),typeof l.radiusMax!="undefined"&&(u.radiusMax=l.radiusMax),typeof l.fog!="undefined"&&(u.fog=l.fog),typeof l.clipFar!="undefined"&&(u.clipFar=l.clipFar)),u}e.copySnapshot=o;function s(u,l){return u.mode===l.mode&&u.fov===l.fov&&u.radius===l.radius&&u.radiusMax===l.radiusMax&&u.fog===l.fog&&u.clipFar===l.clipFar&&C.exactEquals(u.position,l.position)&&C.exactEquals(u.up,l.up)&&C.exactEquals(u.target,l.target)}e.areSnapshotsEqual=s})(Gn||(Gn={}));function Mye(e){var t=e.viewport,r=e.zoom,n=e.near,a=e.far,i=e.viewOffset,o=-t.width/2,s=t.width/2,u=t.height/2,l=-t.height/2,c=(s-o)/(2*r),d=(u-l)/(2*r),f=(s+o)/2,p=(u+l)/2,h=f-c,v=f+c,m=p+d,g=p-d;if(i.enabled){var y=r/(i.width/i.fullWidth),b=r/(i.height/i.fullHeight),x=(s-o)/i.width,S=(u-l)/i.height;h+=x*(i.offsetX/y),v=h+x*(i.width/y),m-=S*(i.offsetY/b),g=m-S*(i.height/b)}ue.ortho(e.projection,h,v,m,g,n,a),ue.lookAt(e.view,e.position,e.target,e.up)}function Dye(e){var t=e.viewport.width/e.viewport.height,r=e.near,n=e.far,a=e.viewOffset,i=r*Math.tan(.5*e.state.fov),o=2*i,s=t*o,u=-.5*s;a.enabled&&(u+=a.offsetX*s/a.fullWidth,i-=a.offsetY*o/a.fullHeight,s*=a.width/a.fullWidth,o*=a.height/a.fullHeight),ue.perspective(e.projection,u,u+s,i,i-o,r,n),ue.lookAt(e.view,e.position,e.target,e.up)}function Rye(e){var t=e.state,r=t.radius,n=t.radiusMax,a=t.mode,i=t.fog,o=t.clipFar;r<.01&&(r=.01);var s=o?r:n,u=C.distance(e.position,e.target),l=u-r,c=u+s,d=-(50-i)/50,f=u-s*d,p=c;l=Math.max(Math.min(n,5),l),c=Math.max(5,c),l===c&&(c=l+.01),e.near=l,e.far=2*c,e.fogNear=f,e.fogFar=p}var q3={sceneBoundingSpheres:E.Boolean(!1,{description:"Show full scene bounding spheres."}),visibleSceneBoundingSpheres:E.Boolean(!1,{description:"Show visible scene bounding spheres."}),objectBoundingSpheres:E.Boolean(!1,{description:"Show bounding spheres of visible render objects."}),instanceBoundingSpheres:E.Boolean(!1,{description:"Show bounding spheres of visible instances."})},Oye=function(){function e(t,r,n){this.objectsData=new Map,this.instancesData=new Map,this.scene=bp.create(t),this.parent=r,this._props=w(w({},E.getDefaultValues(q3)),n)}return e.prototype.update=function(){var t=this,r=Km(this.scene,this.parent.boundingSphere,this.sceneData,dr.lightgrey,kye);r&&(this.sceneData=r);var n=Km(this.scene,this.parent.boundingSphereVisible,this.visibleSceneData,dr.black,Bye);n&&(this.visibleSceneData=n),this.parent.forEach(function(a,i){var o=t.objectsData.get(i),s=Km(t.scene,a.values.boundingSphere.ref.value,o,dr.tomato,Lye);s&&t.objectsData.set(i,s);var u=t.instancesData.get(i),l=Km(t.scene,a.values.invariantBoundingSphere.ref.value,u,dr.skyblue,Nye,{aTransform:i.values.aTransform,matrix:i.values.matrix,transform:i.values.transform,extraTransform:i.values.extraTransform,uInstanceCount:i.values.uInstanceCount,instanceCount:i.values.instanceCount,aInstance:i.values.aInstance,hasReflection:i.values.hasReflection});l&&t.instancesData.set(i,l)}),this.objectsData.forEach(function(a,i){t.parent.has(i)||(t.scene.remove(a.renderObject),t.objectsData.delete(i))}),this.instancesData.forEach(function(a,i){t.parent.has(i)||(t.scene.remove(a.renderObject),t.instancesData.delete(i))}),this.scene.update(void 0,!1),this.scene.commit()},e.prototype.syncVisibility=function(){var t=this;this.sceneData&&(this.sceneData.renderObject.state.visible=this._props.sceneBoundingSpheres),this.visibleSceneData&&(this.visibleSceneData.renderObject.state.visible=this._props.visibleSceneBoundingSpheres),this.parent.forEach(function(r,n){var a=t.objectsData.get(n);a&&(a.renderObject.state.visible=n.state.visible&&t._props.objectBoundingSpheres);var i=t.instancesData.get(n);i&&(i.renderObject.state.visible=n.state.visible&&t._props.instanceBoundingSpheres)})},e.prototype.clear=function(){this.sceneData=void 0,this.objectsData.clear(),this.scene.clear()},Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this._props.sceneBoundingSpheres||this._props.visibleSceneBoundingSpheres||this._props.objectBoundingSpheres||this._props.instanceBoundingSpheres},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"props",{get:function(){return this._props},enumerable:!1,configurable:!0}),e.prototype.setProps=function(t){Object.assign(this._props,t),this.isEnabled&&this.update()},e}();function Km(e,t,r,n,a,i){if(!r||!Ne.equals(r.boundingSphere,t)){var o=Fye(t,r&&r.mesh),s=r?r.renderObject:Uye(o,n,a,i);return r?k.updateIfChanged(s.values.drawCount,Ma.getDrawCount(o)):e.add(s),{boundingSphere:Ne.clone(t),renderObject:s,mesh:o}}}function Fye(e,t){var r=2,n=e1(r),a=_t.createState(n,n/2,t);if(e.radius&&(la(a,e.center,e.radius,r),Ne.hasExtrema(e)))for(var i=0,o=e.extrema;i<o.length;i++){var s=o[i];la(a,s,1,0)}return _t.getMesh(a)}var kye=vl(),Bye=vl(),Lye=vl(),Nye=vl();function Uye(e,t,r,n){var a=Lt.Utils.createValuesSimple(e,{alpha:.1,doubleSided:!1},t,1,n);return kp("mesh",a,{disposed:!1,visible:!0,alphaFactor:1,pickable:!1,colorOnly:!1,opaque:!1,writeDepth:!1,noClip:!1},r)}var zye=function(){function e(t,r,n,a,i){var o=this;i===void 0&&(i=30),this.canvasIdentify=t,this.getLoci=r,this.input=n,this.camera=a,this.maxFps=i,this.ev=zu.create(),this.events={hover:this.ev(),drag:this.ev(),click:this.ev()},this.startX=-1,this.startY=-1,this.endX=-1,this.endY=-1,this.id=void 0,this.position=void 0,this.currentIdentifyT=0,this.isInteracting=!1,this.prevLoci=or.Loci.Empty,this.prevT=0,this.inside=!1,this.buttons=Hd.create(0),this.button=Hd.create(0),this.modifiers=is.None,n.drag.subscribe(function(s){var u=s.x,l=s.y,c=s.buttons,d=s.button,f=s.modifiers;o.isInteracting=!0,o.drag(u,l,c,d,f)}),n.move.subscribe(function(s){var u=s.x,l=s.y,c=s.inside,d=s.buttons,f=s.button,p=s.modifiers;!c||o.isInteracting||o.move(u,l,d,f,p)}),n.leave.subscribe(function(){o.leave()}),n.click.subscribe(function(s){var u=s.x,l=s.y,c=s.buttons,d=s.button,f=s.modifiers;o.outsideViewport(u,l)||o.click(u,l,c,d,f)}),n.interactionEnd.subscribe(function(){o.isInteracting=!1}),n.modifiers.subscribe(function(s){o.modify(s)})}return e.prototype.identify=function(t,r){var n=this.startX!==this.endX||this.startY!==this.endY;if(t===2){n&&!or.Loci.isEmpty(this.prevLoci)&&(this.events.drag.next({current:this.prevLoci,buttons:this.buttons,button:this.button,modifiers:this.modifiers,pageStart:Ge.create(this.startX,this.startY),pageEnd:Ge.create(this.endX,this.endY)}),this.startX=this.endX,this.startY=this.endY);return}if(n){var a=this.canvasIdentify(this.endX,this.endY);this.id=a==null?void 0:a.id,this.position=a==null?void 0:a.position,this.startX=this.endX,this.startY=this.endY}if(t===1){var i=this.getLoci(this.id);this.events.click.next({current:i,buttons:this.buttons,button:this.button,modifiers:this.modifiers,page:Ge.create(this.endX,this.endY),position:this.position}),this.prevLoci=i;return}if(!(!this.inside||this.currentIdentifyT!==r||!n||this.outsideViewport(this.endX,this.endY))){var o=this.getLoci(this.id);this.events.hover.next({current:o,buttons:this.buttons,button:this.button,modifiers:this.modifiers,page:Ge.create(this.endX,this.endY),position:this.position}),this.prevLoci=o}},e.prototype.tick=function(t){this.inside&&t-this.prevT>1e3/this.maxFps&&(this.prevT=t,this.currentIdentifyT=t,this.identify(this.isInteracting?2:0,t))},e.prototype.leave=function(){this.inside=!1,or.Loci.isEmpty(this.prevLoci)||(this.prevLoci=or.Loci.Empty,this.events.hover.next({current:this.prevLoci,buttons:this.buttons,button:this.button,modifiers:this.modifiers}))},e.prototype.move=function(t,r,n,a,i){this.inside=!0,this.buttons=n,this.button=a,this.modifiers=i,this.endX=t,this.endY=r},e.prototype.click=function(t,r,n,a,i){this.endX=t,this.endY=r,this.buttons=n,this.button=a,this.modifiers=i,this.identify(1,0)},e.prototype.drag=function(t,r,n,a,i){this.endX=t,this.endY=r,this.buttons=n,this.button=a,this.modifiers=i,this.identify(2,0)},e.prototype.modify=function(t){is.areEqual(t,this.modifiers)||(this.modifiers=t,this.events.hover.next({current:this.prevLoci,buttons:this.buttons,button:this.button,modifiers:this.modifiers,page:Ge.create(this.endX,this.endY),position:this.position}))},e.prototype.outsideViewport=function(t,r){var n=this,a=n.input,i=n.camera.viewport;return t*=a.pixelRatio,r*=a.pixelRatio,t>i.x+i.width||a.height-r>i.y+i.height||t<i.x||a.height-r<i.y},e.prototype.dispose=function(){this.ev.dispose()},e}(),Di=`
precision highp float;

attribute vec2 aPosition;
uniform vec2 uQuadScale;

void main(void) {
    vec2 position = aPosition * uQuadScale - vec2(1.0, 1.0) + uQuadScale;
    gl_Position = vec4(position, 0.0, 1.0);
}
`,Vye=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tDepth;
uniform vec2 uTexSize;

uniform float uNear;
uniform float uFar;

uniform float uMaxPossibleViewZDiff;

#include common

float getViewZ(const in float depth) {
    #if dOrthographic == 1
        return orthographicDepthToViewZ(depth, uNear, uFar);
    #else
        return perspectiveDepthToViewZ(depth, uNear, uFar);
    #endif
}

float getDepth(const in vec2 coords) {
    return unpackRGBAToDepth(texture2D(tDepth, coords));
}

bool isBackground(const in float depth) {
    return depth == 1.0;
}

void main(void) {
    float backgroundViewZ = uFar + 3.0 * uMaxPossibleViewZDiff;

    vec2 coords = gl_FragCoord.xy / uTexSize;
    vec2 invTexSize = 1.0 / uTexSize;

    float selfDepth = getDepth(coords);
    float selfViewZ = isBackground(selfDepth) ? backgroundViewZ : getViewZ(getDepth(coords));

    float outline = 1.0;
    float bestDepth = 1.0;

    for (int y = -1; y <= 1; y++) {
        for (int x = -1; x <= 1; x++) {
            vec2 sampleCoords = coords + vec2(float(x), float(y)) * invTexSize;
            float sampleDepth = getDepth(sampleCoords);
            float sampleViewZ = isBackground(sampleDepth) ? backgroundViewZ : getViewZ(sampleDepth);

            if (abs(selfViewZ - sampleViewZ) > uMaxPossibleViewZDiff && selfDepth > sampleDepth && sampleDepth <= bestDepth) {
                outline = 0.0;
                bestDepth = sampleDepth;
            }
        }
    }

    gl_FragColor = vec4(outline, packUnitIntervalToRG(bestDepth), 0.0);
}
`,Hye=`
precision highp float;
precision highp int;
precision highp sampler2D;

#include common

uniform sampler2D tDepth;
uniform vec2 uTexSize;
uniform vec4 uBounds;

uniform vec3 uSamples[dNSamples];

uniform mat4 uProjection;
uniform mat4 uInvProjection;

uniform float uRadius;
uniform float uBias;

float smootherstep(float edge0, float edge1, float x) {
    x = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);
    return x * x * x * (x * (x * 6.0 - 15.0) + 10.0);
}

float noise(const in vec2 coords) {
    float a = 12.9898;
    float b = 78.233;
    float c = 43758.5453;
    float dt = dot(coords, vec2(a,b));
    float sn = mod(dt, PI);
    return abs(fract(sin(sn) * c)); // is abs necessary?
}

vec2 getNoiseVec2(const in vec2 coords) {
    return vec2(noise(coords), noise(coords + vec2(PI, 2.71828)));
}

bool isBackground(const in float depth) {
    return depth == 1.0;
}

bool outsideBounds(const in vec2 p) {
    return p.x < uBounds.x || p.y < uBounds.y || p.x > uBounds.z || p.y > uBounds.w;
}

float getDepth(const in vec2 coords) {
    return outsideBounds(coords) ? 1.0 : unpackRGBAToDepth(texture2D(tDepth, coords));
}

vec3 normalFromDepth(const in float depth, const in float depth1, const in float depth2, vec2 offset1, vec2 offset2) {
    vec3 p1 = vec3(offset1, depth1 - depth);
    vec3 p2 = vec3(offset2, depth2 - depth);

    vec3 normal = cross(p1, p2);
    normal.z = -normal.z;

    return normalize(normal);
}

// StarCraft II Ambient Occlusion by [Filion and McNaughton 2008]
void main(void) {
    vec2 invTexSize = 1.0 / uTexSize;
    vec2 selfCoords = gl_FragCoord.xy * invTexSize;

    float selfDepth = getDepth(selfCoords);
    vec2 selfPackedDepth = packUnitIntervalToRG(selfDepth);

    if (isBackground(selfDepth)) {
        gl_FragColor = vec4(packUnitIntervalToRG(0.0), selfPackedDepth);
        return;
    }

    vec2 offset1 = vec2(0.0, invTexSize.y);
    vec2 offset2 = vec2(invTexSize.x, 0.0);

    float selfDepth1 = getDepth(selfCoords + offset1);
    float selfDepth2 = getDepth(selfCoords + offset2);

    vec3 selfViewNormal = normalFromDepth(selfDepth, selfDepth1, selfDepth2, offset1, offset2);
    vec3 selfViewPos = screenSpaceToViewSpace(vec3(selfCoords, selfDepth), uInvProjection);

    vec3 randomVec = normalize(vec3(getNoiseVec2(selfCoords) * 2.0 - 1.0, 0.0));

    vec3 tangent = normalize(randomVec - selfViewNormal * dot(randomVec, selfViewNormal));
    vec3 bitangent = cross(selfViewNormal, tangent);
    mat3 TBN = mat3(tangent, bitangent, selfViewNormal);

    float occlusion = 0.0;
    for(int i = 0; i < dNSamples; i++){
        vec3 sampleViewPos = TBN * uSamples[i];
        sampleViewPos = selfViewPos + sampleViewPos * uRadius;

        vec4 offset = vec4(sampleViewPos, 1.0);
        offset = uProjection * offset;
        offset.xyz = (offset.xyz / offset.w) * 0.5 + 0.5;

        float sampleViewZ = screenSpaceToViewSpace(vec3(offset.xy, getDepth(offset.xy)), uInvProjection).z;

        occlusion += step(sampleViewPos.z + 0.025, sampleViewZ) * smootherstep(0.0, 1.0, uRadius / abs(selfViewPos.z - sampleViewZ));
    }
    occlusion = 1.0 - (uBias * occlusion / float(dNSamples));

    vec2 packedOcclusion = packUnitIntervalToRG(occlusion);

    gl_FragColor = vec4(packedOcclusion, selfPackedDepth);
}
`,Gye=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tSsaoDepth;
uniform vec2 uTexSize;
uniform vec4 uBounds;

uniform float uKernel[dOcclusionKernelSize];

uniform float uBlurDirectionX;
uniform float uBlurDirectionY;

uniform float uMaxPossibleViewZDiff;

uniform float uNear;
uniform float uFar;

#include common

float getViewZ(const in float depth) {
    #if dOrthographic == 1
        return orthographicDepthToViewZ(depth, uNear, uFar);
    #else
        return perspectiveDepthToViewZ(depth, uNear, uFar);
    #endif
}

bool isBackground(const in float depth) {
    return depth == 1.0;
}

bool outsideBounds(const in vec2 p) {
    return p.x < uBounds.x || p.y < uBounds.y || p.x > uBounds.z || p.y > uBounds.w;
}

void main(void) {
    vec2 coords = gl_FragCoord.xy / uTexSize;

    vec2 packedDepth = texture2D(tSsaoDepth, coords).zw;

    if (outsideBounds(coords)) {
        gl_FragColor = vec4(packUnitIntervalToRG(1.0), packedDepth);
        return;
    }

    float selfDepth = unpackRGToUnitInterval(packedDepth);
    // if background and if second pass
    if (isBackground(selfDepth) && uBlurDirectionY != 0.0) {
        gl_FragColor = vec4(packUnitIntervalToRG(1.0), packedDepth);
        return;
    }

    float selfViewZ = getViewZ(selfDepth);

    vec2 offset = vec2(uBlurDirectionX, uBlurDirectionY) / uTexSize;

    float sum = 0.0;
    float kernelSum = 0.0;
    // only if kernelSize is odd
    for (int i = -dOcclusionKernelSize / 2; i <= dOcclusionKernelSize / 2; i++) {
        vec2 sampleCoords = coords + float(i) * offset;
        if (outsideBounds(sampleCoords)) {
            continue;
        }

        vec4 sampleSsaoDepth = texture2D(tSsaoDepth, sampleCoords);

        float sampleDepth = unpackRGToUnitInterval(sampleSsaoDepth.zw);
        if (isBackground(sampleDepth)) {
            continue;
        }

        if (abs(float(i)) > 1.0) { // abs is not defined for int in webgl1
            float sampleViewZ = getViewZ(sampleDepth);
            if (abs(selfViewZ - sampleViewZ) > uMaxPossibleViewZDiff) {
                continue;
            }
        }

        float kernel = uKernel[int(abs(float(i)))]; // abs is not defined for int in webgl1
        float sampleValue = unpackRGToUnitInterval(sampleSsaoDepth.xy);

        sum += kernel * sampleValue;
        kernelSum += kernel;
    }

    gl_FragColor = vec4(packUnitIntervalToRG(sum / kernelSum), packedDepth);
}
`,qye=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tSsaoDepth;
uniform sampler2D tColor;
uniform sampler2D tDepth;
uniform sampler2D tOutlines;
uniform vec2 uTexSize;

uniform float uNear;
uniform float uFar;
uniform float uFogNear;
uniform float uFogFar;
uniform vec3 uFogColor;
uniform bool uTransparentBackground;

uniform float uOcclusionBias;
uniform float uOcclusionRadius;

uniform float uMaxPossibleViewZDiff;

const vec3 occlusionColor = vec3(0.0);

#include common

float getViewZ(const in float depth) {
    #if dOrthographic == 1
        return orthographicDepthToViewZ(depth, uNear, uFar);
    #else
        return perspectiveDepthToViewZ(depth, uNear, uFar);
    #endif
}

float getDepth(const in vec2 coords) {
    return unpackRGBAToDepth(texture2D(tDepth, coords));
}

bool isBackground(const in float depth) {
    return depth == 1.0;
}

float getOutline(const in vec2 coords, out float closestTexel) {
    float backgroundViewZ = uFar + 3.0 * uMaxPossibleViewZDiff;
    vec2 invTexSize = 1.0 / uTexSize;

    float selfDepth = getDepth(coords);
    float selfViewZ = isBackground(selfDepth) ? backgroundViewZ : getViewZ(selfDepth);

    float outline = 1.0;
    closestTexel = 1.0;
    for (int y = -dOutlineScale; y <= dOutlineScale; y++) {
        for (int x = -dOutlineScale; x <= dOutlineScale; x++) {
            if (x * x + y * y > dOutlineScale * dOutlineScale) {
                continue;
            }

            vec2 sampleCoords = coords + vec2(float(x), float(y)) * invTexSize;

            vec4 sampleOutlineCombined = texture2D(tOutlines, sampleCoords);
            float sampleOutline = sampleOutlineCombined.r;
            float sampleOutlineDepth = unpackRGToUnitInterval(sampleOutlineCombined.gb);

            if (sampleOutline == 0.0 && sampleOutlineDepth < closestTexel && abs(selfViewZ - sampleOutlineDepth) > uMaxPossibleViewZDiff) {
                outline = 0.0;
                closestTexel = sampleOutlineDepth;
            }
        }
    }
    return outline;
}

float getSsao(vec2 coords) {
    float rawSsao = unpackRGToUnitInterval(texture2D(tSsaoDepth, coords).xy);
    if (rawSsao > 0.999) {
        return 1.0;
    } else if (rawSsao > 0.001) {
        return rawSsao;
    }
    // treat values close to 0.0 as errors and return no occlusion
    return 1.0;
}

void main(void) {
    vec2 coords = gl_FragCoord.xy / uTexSize;
    vec4 color = texture2D(tColor, coords);

    float viewDist;
    float fogFactor;

    #ifdef dOcclusionEnable
        float depth = getDepth(coords);
        if (!isBackground(depth)) {
            viewDist = abs(getViewZ(depth));
            fogFactor = smoothstep(uFogNear, uFogFar, viewDist);
            float occlusionFactor = getSsao(coords);
            if (!uTransparentBackground) {
                color.rgb = mix(mix(occlusionColor, uFogColor, fogFactor), color.rgb, occlusionFactor);
            } else {
                color.rgb = mix(occlusionColor * (1.0 - fogFactor), color.rgb, occlusionFactor);
            }
        }
    #endif

    // outline needs to be handled after occlusion to keep them clean
    #ifdef dOutlineEnable
        float closestTexel;
        float outline = getOutline(coords, closestTexel);

        if (outline == 0.0) {
            color.rgb *= outline;
            viewDist = abs(getViewZ(closestTexel));
            fogFactor = smoothstep(uFogNear, uFogFar, viewDist);
            if (!uTransparentBackground) {
                color.rgb = mix(color.rgb, uFogColor, fogFactor);
            } else {
                color.a = 1.0 - fogFactor;
            }
        }
    #endif

    gl_FragColor = color;
}
`,jye=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tColor;
uniform vec2 uTexSizeInv;

// adapted from https://github.com/kosua20/Rendu
// MIT License Copyright (c) 2017 Simon Rodriguez

#define QUALITY(q) ((q) < 5 ? 1.0 : ((q) > 5 ? ((q) < 10 ? 2.0 : ((q) < 11 ? 4.0 : 8.0)) : 1.5))

float rgb2luma(vec3 rgb){
    return sqrt(dot(rgb, vec3(0.299, 0.587, 0.114)));
}

float sampleLuma(vec2 uv) {
    return rgb2luma(texture2D(tColor, uv).rgb);
}

float sampleLuma(vec2 uv, float uOffset, float vOffset) {
    uv += uTexSizeInv * vec2(uOffset, vOffset);
    return sampleLuma(uv);
}

void main(void) {
    vec2 coords = gl_FragCoord.xy * uTexSizeInv;
    vec2 inverseScreenSize = uTexSizeInv;

    vec4 colorCenter = texture2D(tColor, coords);

    // Luma at the current fragment
    float lumaCenter = rgb2luma(colorCenter.rgb);

    // Luma at the four direct neighbours of the current fragment.
    float lumaDown = sampleLuma(coords, 0.0, -1.0);
    float lumaUp = sampleLuma(coords, 0.0, 1.0);
    float lumaLeft = sampleLuma(coords, -1.0, 0.0);
    float lumaRight = sampleLuma(coords, 1.0, 0.0);

    // Find the maximum and minimum luma around the current fragment.
    float lumaMin = min(lumaCenter, min(min(lumaDown, lumaUp), min(lumaLeft, lumaRight)));
    float lumaMax = max(lumaCenter, max(max(lumaDown, lumaUp), max(lumaLeft, lumaRight)));

    // Compute the delta.
    float lumaRange = lumaMax - lumaMin;

    // If the luma variation is lower that a threshold (or if we are in a really dark area),
    // we are not on an edge, don't perform any AA.
    if (lumaRange < max(dEdgeThresholdMin, lumaMax * dEdgeThresholdMax)) {
        gl_FragColor = colorCenter;
        return;
    }

    // Query the 4 remaining corners lumas.
    float lumaDownLeft = sampleLuma(coords, -1.0, -1.0);
    float lumaUpRight = sampleLuma(coords, 1.0, 1.0);
    float lumaUpLeft = sampleLuma(coords, -1.0, 1.0);
    float lumaDownRight = sampleLuma(coords, 1.0, -1.0);

    // Combine the four edges lumas (using intermediary variables for future computations
    // with the same values).
    float lumaDownUp = lumaDown + lumaUp;
    float lumaLeftRight = lumaLeft + lumaRight;

    // Same for corners
    float lumaLeftCorners = lumaDownLeft + lumaUpLeft;
    float lumaDownCorners = lumaDownLeft + lumaDownRight;
    float lumaRightCorners = lumaDownRight + lumaUpRight;
    float lumaUpCorners = lumaUpRight + lumaUpLeft;

    // Compute an estimation of the gradient along the horizontal and vertical axis.
    float edgeHorizontal = abs(-2.0 * lumaLeft + lumaLeftCorners) + abs(-2.0 * lumaCenter + lumaDownUp) * 2.0 + abs(-2.0 * lumaRight + lumaRightCorners);
    float edgeVertical = abs(-2.0 * lumaUp + lumaUpCorners) + abs(-2.0 * lumaCenter + lumaLeftRight) * 2.0 + abs(-2.0 * lumaDown + lumaDownCorners);

    // Is the local edge horizontal or vertical ?
    bool isHorizontal = (edgeHorizontal >= edgeVertical);

    // Choose the step size (one pixel) accordingly.
    float stepLength = isHorizontal ? inverseScreenSize.y : inverseScreenSize.x;

    // Select the two neighboring texels lumas in the opposite direction to the local edge.
    float luma1 = isHorizontal ? lumaDown : lumaLeft;
    float luma2 = isHorizontal ? lumaUp : lumaRight;
    // Compute gradients in this direction.
    float gradient1 = luma1 - lumaCenter;
    float gradient2 = luma2 - lumaCenter;

    // Which direction is the steepest ?
    bool is1Steepest = abs(gradient1) >= abs(gradient2);

    // Gradient in the corresponding direction, normalized.
    float gradientScaled = 0.25 * max(abs(gradient1), abs(gradient2));

    // Average luma in the correct direction.
    float lumaLocalAverage = 0.0;
    if(is1Steepest){
        // Switch the direction
        stepLength = -stepLength;
        lumaLocalAverage = 0.5 * (luma1 + lumaCenter);
    } else {
        lumaLocalAverage = 0.5 * (luma2 + lumaCenter);
    }

    // Shift UV in the correct direction by half a pixel.
    vec2 currentUv = coords;
    if(isHorizontal){
        currentUv.y += stepLength * 0.5;
    } else {
        currentUv.x += stepLength * 0.5;
    }

    // Compute offset (for each iteration step) in the right direction.
    vec2 offset = isHorizontal ? vec2(inverseScreenSize.x, 0.0) : vec2(0.0, inverseScreenSize.y);
    // Compute UVs to explore on each side of the edge, orthogonally.
    // The QUALITY allows us to step faster.
    vec2 uv1 = currentUv - offset * QUALITY(0);
    vec2 uv2 = currentUv + offset * QUALITY(0);

    // Read the lumas at both current extremities of the exploration segment,
    // and compute the delta wrt to the local average luma.
    float lumaEnd1 = sampleLuma(uv1);
    float lumaEnd2 = sampleLuma(uv2);
    lumaEnd1 -= lumaLocalAverage;
    lumaEnd2 -= lumaLocalAverage;

    // If the luma deltas at the current extremities is larger than the local gradient,
    // we have reached the side of the edge.
    bool reached1 = abs(lumaEnd1) >= gradientScaled;
    bool reached2 = abs(lumaEnd2) >= gradientScaled;
    bool reachedBoth = reached1 && reached2;

    // If the side is not reached, we continue to explore in this direction.
    if(!reached1){
        uv1 -= offset * QUALITY(1);
    }
    if(!reached2){
        uv2 += offset * QUALITY(1);
    }

    // If both sides have not been reached, continue to explore.
    if(!reachedBoth){
        for(int i = 2; i < dIterations; i++){
            // If needed, read luma in 1st direction, compute delta.
            if(!reached1){
                lumaEnd1 = sampleLuma(uv1);
                lumaEnd1 = lumaEnd1 - lumaLocalAverage;
            }
            // If needed, read luma in opposite direction, compute delta.
            if(!reached2){
                lumaEnd2 = sampleLuma(uv2);
                lumaEnd2 = lumaEnd2 - lumaLocalAverage;
            }
            // If the luma deltas at the current extremities is larger than the local gradient,
            // we have reached the side of the edge.
            reached1 = abs(lumaEnd1) >= gradientScaled;
            reached2 = abs(lumaEnd2) >= gradientScaled;
            reachedBoth = reached1 && reached2;

            // If the side is not reached, we continue to explore in this direction,
            // with a variable quality.
            if(!reached1){
                uv1 -= offset * QUALITY(i);
            }
            if(!reached2){
                uv2 += offset * QUALITY(i);
            }

            // If both sides have been reached, stop the exploration.
            if(reachedBoth){
                break;
            }
        }
    }

    // Compute the distances to each side edge of the edge (!).
    float distance1 = isHorizontal ? (coords.x - uv1.x) : (coords.y - uv1.y);
    float distance2 = isHorizontal ? (uv2.x - coords.x) : (uv2.y - coords.y);

    // In which direction is the side of the edge closer ?
    bool isDirection1 = distance1 < distance2;
    float distanceFinal = min(distance1, distance2);

    // Thickness of the edge.
    float edgeThickness = (distance1 + distance2);

    // Is the luma at center smaller than the local average ?
    bool isLumaCenterSmaller = lumaCenter < lumaLocalAverage;

    // If the luma at center is smaller than at its neighbour,
    // the delta luma at each end should be positive (same variation).
    bool correctVariation1 = (lumaEnd1 < 0.0) != isLumaCenterSmaller;
    bool correctVariation2 = (lumaEnd2 < 0.0) != isLumaCenterSmaller;

    // Only keep the result in the direction of the closer side of the edge.
    bool correctVariation = isDirection1 ? correctVariation1 : correctVariation2;

    // UV offset: read in the direction of the closest side of the edge.
    float pixelOffset = - distanceFinal / edgeThickness + 0.5;

    // If the luma variation is incorrect, do not offset.
    float finalOffset = correctVariation ? pixelOffset : 0.0;

    // Sub-pixel shifting
    // Full weighted average of the luma over the 3x3 neighborhood.
    float lumaAverage = (1.0 / 12.0) * (2.0 * (lumaDownUp + lumaLeftRight) + lumaLeftCorners + lumaRightCorners);
    // Ratio of the delta between the global average and the center luma,
    // over the luma range in the 3x3 neighborhood.
    float subPixelOffset1 = clamp(abs(lumaAverage - lumaCenter) / lumaRange, 0.0, 1.0);
    float subPixelOffset2 = (-2.0 * subPixelOffset1 + 3.0) * subPixelOffset1 * subPixelOffset1;
    // Compute a sub-pixel offset based on this delta.
    float subPixelOffsetFinal = subPixelOffset2 * subPixelOffset2 * float(dSubpixelQuality);

    // Pick the biggest of the two offsets.
    finalOffset = max(finalOffset, subPixelOffsetFinal);

    // Compute the final UV coordinates.
    vec2 finalUv = coords;
    if(isHorizontal){
        finalUv.y += finalOffset * stepLength;
    } else {
        finalUv.x += finalOffset * stepLength;
    }

    // Read the color at the new UV coordinates, and use it.
    gl_FragColor = texture2D(tColor, finalUv);
}
`,Wye={edgeThresholdMin:E.Numeric(.0312,{min:.0312,max:.0833,step:1e-4},{description:"Trims the algorithm from processing darks."}),edgeThresholdMax:E.Numeric(.063,{min:.063,max:.333,step:.001},{description:"The minimum amount of local contrast required to apply algorithm."}),iterations:E.Numeric(12,{min:0,max:16,step:1},{description:"Number of edge exploration steps."}),subpixelQuality:E.Numeric(.3,{min:0,max:1,step:.01},{description:"Choose the amount of sub-pixel aliasing removal."})},Xye=function(){function e(t,r){this.webgl=t,this.renderable=$ye(t,r)}return e.prototype.updateState=function(t){var r=this.webgl,n=r.gl,a=r.state;a.enable(n.SCISSOR_TEST),a.disable(n.BLEND),a.disable(n.DEPTH_TEST),a.depthMask(!1);var i=t.x,o=t.y,s=t.width,u=t.height;n.viewport(i,o,s,u),n.scissor(i,o,s,u),a.clearColor(0,0,0,1),n.clear(n.COLOR_BUFFER_BIT)},e.prototype.setSize=function(t,r){k.update(this.renderable.values.uTexSizeInv,Ge.set(this.renderable.values.uTexSizeInv.ref.value,1/t,1/r))},e.prototype.update=function(t,r){var n=this.renderable.values,a=r.edgeThresholdMin,i=r.edgeThresholdMax,o=r.iterations,s=r.subpixelQuality,u=!1;n.tColor.ref.value!==t&&(k.update(this.renderable.values.tColor,t),u=!0),n.dEdgeThresholdMin.ref.value!==a&&(u=!0),k.updateIfChanged(n.dEdgeThresholdMin,a),n.dEdgeThresholdMax.ref.value!==i&&(u=!0),k.updateIfChanged(n.dEdgeThresholdMax,i),n.dIterations.ref.value!==o&&(u=!0),k.updateIfChanged(n.dIterations,o),n.dSubpixelQuality.ref.value!==s&&(u=!0),k.updateIfChanged(n.dSubpixelQuality,s),u&&this.renderable.update()},e.prototype.render=function(t,r){r?r.bind():this.webgl.unbindFramebuffer(),this.updateState(t),this.renderable.render()},e}(),Yye=w(w({},Ua),{tColor:ur("texture","rgba","ubyte","linear"),uTexSizeInv:qe("v2"),dEdgeThresholdMin:$t("number"),dEdgeThresholdMax:$t("number"),dIterations:$t("number"),dSubpixelQuality:$t("number")}),Kye=_n("fxaa",Di,jye);function $ye(e,t){var r=t.getWidth(),n=t.getHeight(),a=w(w({},za),{tColor:k.create(t),uTexSizeInv:k.create(Ge.create(1/r,1/n)),dEdgeThresholdMin:k.create(.0312),dEdgeThresholdMax:k.create(.125),dIterations:k.create(12),dSubpixelQuality:k.create(.3)}),i=w({},Yye),o=Ca(e,"triangles",Kye,i,a);return xa(o,a)}var Qye=`
precision highp float;

attribute vec2 aPosition;
uniform vec2 uQuadScale;

uniform vec2 uTexSizeInv;
uniform vec4 uViewport;

varying vec2 vUv;
varying vec4 vOffset[2];

void SMAANeighborhoodBlendingVS(vec2 texCoord) {
    vOffset[0] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-1.0, 0.0, 0.0, 1.0); // WebGL port note: Changed sign in W component
    vOffset[1] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(1.0, 0.0, 0.0, -1.0); // WebGL port note: Changed sign in W component
}

void main() {
    vec2 scale = uViewport.zw * uTexSizeInv;
    vec2 shift = uViewport.xy * uTexSizeInv;
    vUv = (aPosition + 1.0) * 0.5 * scale + shift;
    SMAANeighborhoodBlendingVS(vUv);
    vec2 position = aPosition * uQuadScale - vec2(1.0, 1.0) + uQuadScale;
    gl_Position = vec4(position, 0.0, 1.0);
}
`,Zye=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tWeights;
uniform sampler2D tColor;
uniform vec2 uTexSizeInv;

varying vec2 vUv;
varying vec4 vOffset[2];

vec4 SMAANeighborhoodBlendingPS(vec2 texCoord, vec4 offset[2], sampler2D colorTex, sampler2D blendTex) {
    // Fetch the blending weights for current pixel:
    vec4 a;
    a.xz = texture2D(blendTex, texCoord).xz;
    a.y = texture2D(blendTex, offset[1].zw).g;
    a.w = texture2D(blendTex, offset[1].xy).a;

    // Is there any blending weight with a value greater than 0.0?
    if (dot(a, vec4(1.0, 1.0, 1.0, 1.0)) < 1e-5) {
        return texture2D(colorTex, texCoord, 0.0);
    } else {
        // Up to 4 lines can be crossing a pixel (one through each edge). We
        // favor blending by choosing the line with the maximum weight for each
        // direction:
        vec2 offset;
        offset.x = a.a > a.b ? a.a : -a.b; // left vs. right
        offset.y = a.g > a.r ? -a.g : a.r; // top vs. bottom // WebGL port note: Changed signs

        // Then we go in the direction that has the maximum weight:
        if (abs(offset.x) > abs(offset.y)) { // horizontal vs. vertical
            offset.y = 0.0;
        } else {
            offset.x = 0.0;
        }

        // Fetch the opposite color and lerp by hand:
        vec4 C = texture2D(colorTex, texCoord, 0.0);
        texCoord += sign(offset) * uTexSizeInv;
        vec4 Cop = texture2D(colorTex, texCoord, 0.0);
        float s = abs(offset.x) > abs(offset.y) ? abs(offset.x) : abs(offset.y);

        // WebGL port note: Added gamma correction
        C.xyz = pow(C.xyz, vec3(2.2));
        Cop.xyz = pow(Cop.xyz, vec3(2.2));
        vec4 mixed = mix(C, Cop, s);
        mixed.xyz = pow(mixed.xyz, vec3(1.0 / 2.2));

        return mixed;
    }
}

void main() {
    gl_FragColor = SMAANeighborhoodBlendingPS(vUv, vOffset, tColor, tWeights);
}
`,Jye=`
precision highp float;

attribute vec2 aPosition;
uniform vec2 uQuadScale;

uniform vec2 uTexSizeInv;
uniform vec4 uViewport;

varying vec2 vUv;
varying vec4 vOffset[3];
varying vec2 vPixCoord;

void SMAABlendingWeightCalculationVS(vec2 texCoord) {
    vPixCoord = texCoord / uTexSizeInv;

    // We will use these offsets for the searches later on (see @PSEUDO_GATHER4):
    vOffset[0] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-0.25, 0.125, 1.25, 0.125); // WebGL port note: Changed sign in Y and W components
    vOffset[1] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-0.125, 0.25, -0.125, -1.25); // WebGL port note: Changed sign in Y and W components

    // And these for the searches, they indicate the ends of the loops:
    vOffset[2] = vec4(vOffset[0].xz, vOffset[1].yw) + vec4(-2.0, 2.0, -2.0, 2.0) * uTexSizeInv.xxyy * float(dMaxSearchSteps);
}

void main() {
    vec2 scale = uViewport.zw * uTexSizeInv;
    vec2 shift = uViewport.xy * uTexSizeInv;
    vUv = (aPosition + 1.0) * 0.5 * scale + shift;
    SMAABlendingWeightCalculationVS(vUv);
    vec2 position = aPosition * uQuadScale - vec2(1.0, 1.0) + uQuadScale;
    gl_Position = vec4(position, 0.0, 1.0);
}
`,e1e=`
precision highp float;
precision highp int;
precision highp sampler2D;

#define SMAASampleLevelZeroOffset(tex, coord, offset) texture2D(tex, coord + float(offset) * uTexSizeInv, 0.0)

#define SMAA_AREATEX_MAX_DISTANCE 16
#define SMAA_AREATEX_PIXEL_SIZE (1.0 / vec2(160.0, 560.0))
#define SMAA_AREATEX_SUBTEX_SIZE (1.0 / 7.0)

uniform sampler2D tEdges;
uniform sampler2D tArea;
uniform sampler2D tSearch;
uniform vec2 uTexSizeInv;

varying vec2 vUv;
varying vec4 vOffset[3];
varying vec2 vPixCoord;

#if __VERSION__ == 100
    vec2 round(vec2 x) {
        return sign(x) * floor(abs(x) + 0.5);
    }
#endif

float SMAASearchLength(sampler2D searchTex, vec2 e, float bias, float scale) {
    // Not required if searchTex accesses are set to point:
    // float2 SEARCH_TEX_PIXEL_SIZE = 1.0 / float2(66.0, 33.0);
    // e = float2(bias, 0.0) + 0.5 * SEARCH_TEX_PIXEL_SIZE +
    //     e * float2(scale, 1.0) * float2(64.0, 32.0) * SEARCH_TEX_PIXEL_SIZE;
    e.r = bias + e.r * scale;
    return 255.0 * texture2D(searchTex, e, 0.0).r;
}

float SMAASearchXLeft(sampler2D edgesTex, sampler2D searchTex, vec2 texCoord, float end) {
    /**
     * @PSEUDO_GATHER4
     * This texCoord has been offset by (-0.25, -0.125) in the vertex shader to
     * sample between edge, thus fetching four edges in a row.
     * Sampling with different offsets in each direction allows to disambiguate
     * which edges are active from the four fetched ones.
     */
    vec2 e = vec2(0.0, 1.0);

    for (int i = 0; i < dMaxSearchSteps; i++) { // WebGL port note: Changed while to for
        e = texture2D( edgesTex, texCoord, 0.0).rg;
        texCoord -= vec2(2.0, 0.0) * uTexSizeInv;
        if (!(texCoord.x > end && e.g > 0.8281 && e.r == 0.0)) break;
    }

    // We correct the previous (-0.25, -0.125) offset we applied:
    texCoord.x += 0.25 * uTexSizeInv.x;

    // The searches are bias by 1, so adjust the coords accordingly:
    texCoord.x += uTexSizeInv.x;

    // Disambiguate the length added by the last step:
    texCoord.x += 2.0 * uTexSizeInv.x; // Undo last step
    texCoord.x -= uTexSizeInv.x * SMAASearchLength(searchTex, e, 0.0, 0.5);

    return texCoord.x;
}

float SMAASearchXRight(sampler2D edgesTex, sampler2D searchTex, vec2 texCoord, float end) {
    vec2 e = vec2( 0.0, 1.0 );

    for (int i = 0; i < dMaxSearchSteps; i++) { // WebGL port note: Changed while to for
        e = texture2D(edgesTex, texCoord, 0.0).rg;
        texCoord += vec2(2.0, 0.0) * uTexSizeInv;
        if (!(texCoord.x < end && e.g > 0.8281 && e.r == 0.0)) break;
    }

    texCoord.x -= 0.25 * uTexSizeInv.x;
    texCoord.x -= uTexSizeInv.x;
    texCoord.x -= 2.0 * uTexSizeInv.x;
    texCoord.x += uTexSizeInv.x * SMAASearchLength( searchTex, e, 0.5, 0.5 );

    return texCoord.x;
}

float SMAASearchYUp(sampler2D edgesTex, sampler2D searchTex, vec2 texCoord, float end) {
    vec2 e = vec2( 1.0, 0.0 );

    for (int i = 0; i < dMaxSearchSteps; i++) { // WebGL port note: Changed while to for
        e = texture2D(edgesTex, texCoord, 0.0).rg;
        texCoord += vec2(0.0, 2.0) * uTexSizeInv; // WebGL port note: Changed sign
        if (!(texCoord.y > end && e.r > 0.8281 && e.g == 0.0)) break;
    }

    texCoord.y -= 0.25 * uTexSizeInv.y; // WebGL port note: Changed sign
    texCoord.y -= uTexSizeInv.y; // WebGL port note: Changed sign
    texCoord.y -= 2.0 * uTexSizeInv.y; // WebGL port note: Changed sign
    texCoord.y += uTexSizeInv.y * SMAASearchLength(searchTex, e.gr, 0.0, 0.5); // WebGL port note: Changed sign

    return texCoord.y;
}

float SMAASearchYDown(sampler2D edgesTex, sampler2D searchTex, vec2 texCoord, float end) {
    vec2 e = vec2( 1.0, 0.0 );

    for (int i = 0; i < dMaxSearchSteps; i++) { // WebGL port note: Changed while to for
        e = texture2D(edgesTex, texCoord, 0.0).rg;
        texCoord -= vec2( 0.0, 2.0 ) * uTexSizeInv; // WebGL port note: Changed sign
        if (!(texCoord.y < end && e.r > 0.8281 && e.g == 0.0)) break;
    }

    texCoord.y += 0.25 * uTexSizeInv.y; // WebGL port note: Changed sign
    texCoord.y += uTexSizeInv.y; // WebGL port note: Changed sign
    texCoord.y += 2.0 * uTexSizeInv.y; // WebGL port note: Changed sign
    texCoord.y -= uTexSizeInv.y * SMAASearchLength(searchTex, e.gr, 0.5, 0.5); // WebGL port note: Changed sign

    return texCoord.y;
}

vec2 SMAAArea(sampler2D areaTex, vec2 dist, float e1, float e2, float offset) {
    // Rounding prevents precision errors of bilinear filtering:
    vec2 texCoord = float(SMAA_AREATEX_MAX_DISTANCE) * round(4.0 * vec2(e1, e2)) + dist;

    // We do a scale and bias for mapping to texel space:
    texCoord = SMAA_AREATEX_PIXEL_SIZE * texCoord + (0.5 * SMAA_AREATEX_PIXEL_SIZE);

    // Move to proper place, according to the subpixel offset:
    texCoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;

    return texture2D(areaTex, texCoord, 0.0).rg;
}

vec4 SMAABlendingWeightCalculationPS(vec2 texCoord, vec2 pixCoord, vec4 offset[3], sampler2D edgesTex, sampler2D areaTex, sampler2D searchTex, ivec4 subsampleIndices) {
    vec4 weights = vec4(0.0, 0.0, 0.0, 0.0);

    vec2 e = texture2D(edgesTex, texCoord).rg;

    if (e.g > 0.0) { // Edge at north
        vec2 d;

        // Find the distance to the left:
        vec2 coords;
        coords.x = SMAASearchXLeft(edgesTex, searchTex, offset[0].xy, offset[2].x );
        coords.y = offset[1].y; // offset[1].y = texCoord.y - 0.25 * uTexSizeInv.y (@CROSSING_OFFSET)
        d.x = coords.x;

        // Now fetch the left crossing edges, two at a time using bilinear
        // filtering. Sampling at -0.25 (see @CROSSING_OFFSET) enables to
        // discern what value each edge has:
        float e1 = texture2D(edgesTex, coords, 0.0).r;

        // Find the distance to the right:
        coords.x = SMAASearchXRight(edgesTex, searchTex, offset[0].zw, offset[2].y);
        d.y = coords.x;

        // We want the distances to be in pixel units (doing this here allow to
        // better interleave arithmetic and memory accesses):
        d = d / uTexSizeInv.x - pixCoord.x;

        // SMAAArea below needs a sqrt, as the areas texture is compressed
        // quadratically:
        vec2 sqrt_d = sqrt(abs(d));

        // Fetch the right crossing edges:
        coords.y -= 1.0 * uTexSizeInv.y; // WebGL port note: Added
        float e2 = SMAASampleLevelZeroOffset(edgesTex, coords, ivec2(1, 0)).r;

        // Ok, we know how this pattern looks like, now it is time for getting
        // the actual area:
        weights.rg = SMAAArea(areaTex, sqrt_d, e1, e2, float(subsampleIndices.y));
    }

    if (e.r > 0.0) { // Edge at west
        vec2 d;

        // Find the distance to the top:
        vec2 coords;

        coords.y = SMAASearchYUp(edgesTex, searchTex, offset[1].xy, offset[2].z );
        coords.x = offset[0].x; // offset[1].x = texCoord.x - 0.25 * uTexSizeInv.x;
        d.x = coords.y;

        // Fetch the top crossing edges:
        float e1 = texture2D(edgesTex, coords, 0.0).g;

        // Find the distance to the bottom:
        coords.y = SMAASearchYDown(edgesTex, searchTex, offset[1].zw, offset[2].w);
        d.y = coords.y;

        // We want the distances to be in pixel units:
        d = d / uTexSizeInv.y - pixCoord.y;

        // SMAAArea below needs a sqrt, as the areas texture is compressed
        // quadratically:
        vec2 sqrt_d = sqrt(abs(d));

        // Fetch the bottom crossing edges:
        coords.y -= 1.0 * uTexSizeInv.y; // WebGL port note: Added
        float e2 = SMAASampleLevelZeroOffset(edgesTex, coords, ivec2(0, 1)).g;

        // Get the area for this direction:
        weights.ba = SMAAArea(areaTex, sqrt_d, e1, e2, float(subsampleIndices.x));
    }

    return weights;
}

void main() {
    gl_FragColor = SMAABlendingWeightCalculationPS(vUv, vPixCoord, vOffset, tEdges, tArea, tSearch, ivec4(0.0));
}
`,t1e=`
precision highp float;

attribute vec2 aPosition;
uniform vec2 uQuadScale;

uniform vec2 uTexSizeInv;
uniform vec4 uViewport;

varying vec2 vUv;
varying vec4 vOffset[3];

void SMAAEdgeDetectionVS(vec2 texCoord) {
    vOffset[0] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-1.0, 0.0, 0.0, 1.0); // WebGL port note: Changed sign in W component
    vOffset[1] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(1.0, 0.0, 0.0, -1.0); // WebGL port note: Changed sign in W component
    vOffset[2] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-2.0, 0.0, 0.0, 2.0); // WebGL port note: Changed sign in W component
}

void main() {
    vec2 scale = uViewport.zw * uTexSizeInv;
    vec2 shift = uViewport.xy * uTexSizeInv;
    vUv = (aPosition + 1.0) * 0.5 * scale + shift;
    SMAAEdgeDetectionVS(vUv);
    vec2 position = aPosition * uQuadScale - vec2(1.0, 1.0) + uQuadScale;
    gl_Position = vec4(position, 0.0, 1.0);
}
`,r1e=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tColor;
uniform vec2 uTexSizeInv;

varying vec2 vUv;
varying vec4 vOffset[3];

vec4 SMAAColorEdgeDetectionPS(vec2 texcoord, vec4 offset[3], sampler2D colorTex) {
    vec2 threshold = vec2(dEdgeThreshold, dEdgeThreshold);

    // Calculate color deltas:
    vec4 delta;
    vec3 C = texture2D(colorTex, texcoord).rgb;

    vec3 Cleft = texture2D(colorTex, offset[0].xy).rgb;
    vec3 t = abs(C - Cleft);
    delta.x = max(max(t.r, t.g), t.b);

    vec3 Ctop = texture2D(colorTex, offset[0].zw).rgb;
    t = abs(C - Ctop);
    delta.y = max(max(t.r, t.g), t.b);

    // We do the usual threshold:
    vec2 edges = step(threshold, delta.xy);

    // Then discard if there is no edge:
    if (dot(edges, vec2(1.0, 1.0 )) == 0.0)
        discard;

    // Calculate right and bottom deltas:
    vec3 Cright = texture2D(colorTex, offset[1].xy).rgb;
    t = abs( C - Cright );
    delta.z = max(max(t.r, t.g), t.b);

    vec3 Cbottom  = texture2D(colorTex, offset[1].zw).rgb;
    t = abs(C - Cbottom);
    delta.w = max(max(t.r, t.g), t.b);

    // Calculate the maximum delta in the direct neighborhood:
    float maxDelta = max(max(max(delta.x, delta.y), delta.z), delta.w );

    // Calculate left-left and top-top deltas:
    vec3 Cleftleft  = texture2D(colorTex, offset[2].xy).rgb;
    t = abs( C - Cleftleft );
    delta.z = max(max(t.r, t.g), t.b);

    vec3 Ctoptop = texture2D(colorTex, offset[2].zw).rgb;
    t = abs(C - Ctoptop);
    delta.w = max(max(t.r, t.g), t.b);

    // Calculate the final maximum delta:
    maxDelta = max(max(maxDelta, delta.z), delta.w);

    // Local contrast adaptation in action:
    edges.xy *= step(0.5 * maxDelta, delta.xy);

    return vec4(edges, 0.0, 0.0);
}

void main() {
    gl_FragColor = SMAAColorEdgeDetectionPS(vUv, vOffset, tColor);
}
`,n1e={edgeThreshold:E.Numeric(.1,{min:.05,max:.15,step:.01}),maxSearchSteps:E.Numeric(16,{min:0,max:32,step:1})},a1e=function(){function e(t,r){if(this.webgl=t,this._supported=!1,typeof HTMLImageElement=="undefined"){Ir&&console.log('Missing "HTMLImageElement" required for "SMAA"');return}var n=r.getWidth(),a=r.getHeight();this.edgesTarget=t.createRenderTarget(n,a,!1,"uint8","linear"),this.weightsTarget=t.createRenderTarget(n,a,!1,"uint8","linear"),this.edgesRenderable=s1e(t,r),this.weightsRenderable=c1e(t,this.edgesTarget.texture),this.blendRenderable=p1e(t,r,this.weightsTarget.texture),this._supported=!0}return Object.defineProperty(e.prototype,"supported",{get:function(){return this._supported},enumerable:!1,configurable:!0}),e.prototype.updateState=function(t){var r=this.webgl,n=r.gl,a=r.state;a.enable(n.SCISSOR_TEST),a.disable(n.BLEND),a.disable(n.DEPTH_TEST),a.depthMask(!1);var i=t.x,o=t.y,s=t.width,u=t.height;n.viewport(i,o,s,u),n.scissor(i,o,s,u),a.clearColor(0,0,0,1),n.clear(n.COLOR_BUFFER_BIT),k.update(this.edgesRenderable.values.uViewport,ga.toVec4(this.edgesRenderable.values.uViewport.ref.value,t)),k.update(this.weightsRenderable.values.uViewport,ga.toVec4(this.weightsRenderable.values.uViewport.ref.value,t)),k.update(this.blendRenderable.values.uViewport,ga.toVec4(this.blendRenderable.values.uViewport.ref.value,t))},e.prototype.setSize=function(t,r){var n=this.edgesTarget.getWidth(),a=this.edgesTarget.getHeight();(t!==n||r!==a)&&(this.edgesTarget.setSize(t,r),this.weightsTarget.setSize(t,r),k.update(this.edgesRenderable.values.uTexSizeInv,Ge.set(this.edgesRenderable.values.uTexSizeInv.ref.value,1/t,1/r)),k.update(this.weightsRenderable.values.uTexSizeInv,Ge.set(this.weightsRenderable.values.uTexSizeInv.ref.value,1/t,1/r)),k.update(this.blendRenderable.values.uTexSizeInv,Ge.set(this.blendRenderable.values.uTexSizeInv.ref.value,1/t,1/r)))},e.prototype.update=function(t,r){var n=!1;this.edgesRenderable.values.tColor.ref.value!==t&&(k.update(this.edgesRenderable.values.tColor,t),n=!0),this.edgesRenderable.values.dEdgeThreshold.ref.value!==r.edgeThreshold&&(k.update(this.edgesRenderable.values.dEdgeThreshold,r.edgeThreshold),n=!0),n&&this.edgesRenderable.update(),this.weightsRenderable.values.dMaxSearchSteps.ref.value!==r.maxSearchSteps&&(k.update(this.weightsRenderable.values.dMaxSearchSteps,r.maxSearchSteps),this.weightsRenderable.update()),this.blendRenderable.values.tColor.ref.value!==t&&(k.update(this.blendRenderable.values.tColor,t),this.blendRenderable.update())},e.prototype.render=function(t,r){this.edgesTarget.bind(),this.updateState(t),this.edgesRenderable.render(),this.weightsTarget.bind(),this.updateState(t),this.weightsRenderable.render(),r?r.bind():this.webgl.unbindFramebuffer(),this.updateState(t),this.blendRenderable.render()},e}(),i1e=w(w({},Ua),{tColor:ur("texture","rgba","ubyte","linear"),uTexSizeInv:qe("v2"),uViewport:qe("v4"),dEdgeThreshold:$t("number")}),o1e=_n("smaa-edges",t1e,r1e);function s1e(e,t){var r=t.getWidth(),n=t.getHeight(),a=w(w({},za),{tColor:k.create(t),uTexSizeInv:k.create(Ge.create(1/r,1/n)),uViewport:k.create(Cr()),dEdgeThreshold:k.create(.1)}),i=w({},i1e),o=Ca(e,"triangles",o1e,i,a);return xa(o,a)}var u1e=w(w({},Ua),{tEdges:ur("texture","rgba","ubyte","linear"),tArea:ur("texture","rgb","ubyte","linear"),tSearch:ur("texture","rgba","ubyte","nearest"),uTexSizeInv:qe("v2"),uViewport:qe("v4"),dMaxSearchSteps:$t("number")}),l1e=_n("smaa-weights",Jye,e1e);function c1e(e,t){var r=t.getWidth(),n=t.getHeight(),a=Wx(e.gl,e.extensions,"image-uint8","rgb","ubyte","linear"),i=Wx(e.gl,e.extensions,"image-uint8","rgba","ubyte","nearest"),o=w(w({},za),{tEdges:k.create(t),tArea:k.create(a),tSearch:k.create(i),uTexSizeInv:k.create(Ge.create(1/r,1/n)),uViewport:k.create(Cr()),dMaxSearchSteps:k.create(8)});cE(h1e(),o.tArea,a),cE(v1e(),o.tSearch,i);var s=w({},u1e),u=Ca(e,"triangles",l1e,s,o);return xa(u,o)}var d1e=w(w({},Ua),{tColor:ur("texture","rgba","ubyte","linear"),tWeights:ur("texture","rgba","ubyte","linear"),uTexSizeInv:qe("v2"),uViewport:qe("v4")}),f1e=_n("smaa-blend",Qye,Zye);function p1e(e,t,r){var n=t.getWidth(),a=t.getHeight(),i=w(w({},za),{tColor:k.create(t),tWeights:k.create(r),uTexSizeInv:k.create(Ge.create(1/n,1/a)),uViewport:k.create(Cr())}),o=w({},d1e),s=Ca(e,"triangles",f1e,o,i);return xa(s,i)}function h1e(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKAAAAIwCAIAAACOVPcQAACBeklEQVR42u39W4xlWXrnh/3WWvuciIzMrKxrV8/0rWbY0+SQFKcb4owIkSIFCjY9AC1BT/LYBozRi+EX+cV+8IMsYAaCwRcBwjzMiw2jAWtgwC8WR5Q8mDFHZLNHTarZGrLJJllt1W2qKrsumZWZcTvn7L3W54e1vrXX3vuciLPPORFR1XE2EomorB0nVuz//r71re/y/1eMvb4Cb3N11xV/PP/2v4UBAwJG/7H8urx6/25/Gf8O5hypMQ0EEEQwAqLfoN/Z+97f/SW+/NvcgQk4sGBJK6H7N4PFVL+K+e0N11yNfkKvwUdwdlUAXPHHL38oa15f/i/46Ih6SuMSPmLAYAwyRKn7dfMGH97jaMFBYCJUgotIC2YAdu+LyW9vvubxAP8kAL8H/koAuOKP3+q6+xGnd5kdYCeECnGIJViwGJMAkQKfDvB3WZxjLKGh8VSCCzhwEWBpMc5/kBbjawT4HnwJfhr+pPBIu7uu+OOTo9vsmtQcniMBGkKFd4jDWMSCRUpLjJYNJkM+IRzQ+PQvIeAMTrBS2LEiaiR9b/5PuT6Ap/AcfAFO4Y3dA3DFH7/VS+M8k4baEAQfMI4QfbVDDGIRg7GKaIY52qAjTAgTvGBAPGIIghOCYAUrGFNgzA7Q3QhgCwfwAnwe5vDejgG44o/fbm1C5ZlYQvQDARPAIQGxCWBM+wWl37ZQESb4gImexGMDouhGLx1Cst0Saa4b4AqO4Hk4gxo+3DHAV/nx27p3JziPM2pVgoiia5MdEzCGULprIN7gEEeQ5IQxEBBBQnxhsDb5auGmAAYcHMA9eAAz8PBol8/xij9+C4Djlim4gJjWcwZBhCBgMIIYxGAVIkH3ZtcBuLdtRFMWsPGoY9rN+HoBji9VBYdwD2ZQg4cnO7OSq/z4rU5KKdwVbFAjNojCQzTlCLPFSxtamwh2jMUcEgg2Wm/6XgErIBhBckQtGN3CzbVacERgCnfgLswhnvqf7QyAq/z4rRZm1YglYE3affGITaZsdIe2FmMIpnOCap25I6jt2kCwCW0D1uAD9sZctNGXcQIHCkINDQgc78aCr+zjtw3BU/ijdpw3zhCwcaONwBvdeS2YZKkJNJsMPf2JKEvC28RXxxI0ASJyzQCjCEQrO4Q7sFArEzjZhaFc4cdv+/JFdKULM4px0DfUBI2hIsy06BqLhGTQEVdbfAIZXYMPesq6VoCHICzUyjwInO4Y411//LYLs6TDa9wvg2CC2rElgAnpTBziThxaL22MYhzfkghz6GAs2VHbbdM91VZu1MEEpupMMwKyVTb5ij9+u4VJG/5EgEMMmFF01cFai3isRbKbzb+YaU/MQbAm2XSMoUPAmvZzbuKYRIFApbtlrfFuUGd6vq2hXNnH78ZLh/iFhsQG3T4D1ib7k5CC6vY0DCbtrohgLEIClXiGtl10zc0CnEGIhhatLBva7NP58Tvw0qE8yWhARLQ8h4+AhQSP+I4F5xoU+VilGRJs6wnS7ruti/4KvAY/CfdgqjsMy4pf8fodQO8/gnuX3f/3xi3om1/h7THr+co3x93PP9+FBUfbNUjcjEmhcrkT+8K7ml7V10Jo05mpIEFy1NmCJWx9SIKKt+EjAL4Ez8EBVOB6havuT/rByPvHXK+9zUcfcbb254+9fydJknYnRr1oGfdaiAgpxu1Rx/Rek8KISftx3L+DfsLWAANn8Hvw0/AFeAGO9DFV3c6D+CcWbL8Dj9e7f+T1k8AZv/d7+PXWM/Z+VvdCrIvuAKO09RpEEQJM0Ci6+B4xhTWr4cZNOvhktabw0ta0rSJmqz3Yw5/AKXwenod7cAhTmBSPKf6JBdvH8IP17h95pXqw50/+BFnj88fev4NchyaK47OPhhtI8RFSvAfDSNh0Ck0p2gLxGkib5NJj/JWCr90EWQJvwBzO4AHcgztwAFN1evHPUVGwfXON+0debT1YeGON9Yy9/63X+OguiwmhIhQhD7l4sMqlG3D86Suc3qWZ4rWjI1X7u0Ytw6x3rIMeIOPDprfe2XzNgyj6PahhBjO4C3e6puDgXrdg+/5l948vF3bqwZetZ+z9Rx9zdIY5pInPK4Nk0t+l52xdK2B45Qd87nM8fsD5EfUhIcJcERw4RdqqH7Yde5V7m1vhNmtedkz6EDzUMF/2jJYWbC+4fzzA/Y+/8PPH3j9dcBAPIRP8JLXd5BpAu03aziOL3VVHZzz3CXWDPWd+SH2AnxIqQoTZpo9Ckc6HIrFbAbzNmlcg8Ag8NFDDAhbJvTBZXbC94P7t68EXfv6o+21gUtPETU7bbkLxvNKRFG2+KXzvtObonPP4rBvsgmaKj404DlshFole1Glfh02fE7bYR7dZ82oTewIBGn1Md6CG6YUF26X376oevOLzx95vhUmgblI6LBZwTCDY7vMq0op5WVXgsObOXJ+1x3qaBl9j1FeLxbhU9w1F+Wiba6s1X/TBz1LnUfuYDi4r2C69f1f14BWfP+p+W2GFKuC9phcELMYRRLur9DEZTUdEH+iEqWdaM7X4WOoPGI+ZYD2+wcQ+y+ioHUZ9dTDbArzxmi/bJI9BND0Ynd6lBdve/butBw8+f/T9D3ABa3AG8W3VPX4hBin+bj8dMMmSpp5pg7fJ6xrBFE2WQQEWnV8Qg3FbAWzYfM1rREEnmvkN2o1+acG2d/9u68GDzx91v3mAjb1zkpqT21OipPKO0b9TO5W0nTdOmAQm0TObts3aBKgwARtoPDiCT0gHgwnbArzxmtcLc08HgF1asN0C4Ms/fvD5I+7PhfqyXE/b7RbbrGyRQRT9ARZcwAUmgdoz0ehJ9Fn7QAhUjhDAQSw0bV3T3WbNa59jzmiP6GsWbGXDX2ytjy8+f9T97fiBPq9YeLdBmyuizZHaqXITnXiMUEEVcJ7K4j3BFPurtB4bixW8wTpweL8DC95szWMOqucFYGsWbGU7p3TxxxefP+r+oTVktxY0v5hbq3KiOKYnY8ddJVSBxuMMVffNbxwIOERShst73HZ78DZrHpmJmH3K6sGz0fe3UUj0eyRrSCGTTc+rjVNoGzNSv05srAxUBh8IhqChiQgVNIIBH3AVPnrsnXQZbLTm8ammv8eVXn/vWpaTem5IXRlt+U/LA21zhSb9cye6jcOfCnOwhIAYXAMVTUNV0QhVha9xjgA27ODJbLbmitt3tRN80lqG6N/khgot4ZVlOyO4WNg3OIMzhIZQpUEHieg2im6F91hB3I2tubql6BYNN9Hj5S7G0G2tahslBWKDnOiIvuAEDzakDQKDNFQT6gbn8E2y4BBubM230YIpBnDbMa+y3dx0n1S0BtuG62lCCXwcY0F72T1VRR3t2ONcsmDjbmzNt9RFs2LO2hQNyb022JisaI8rAWuw4HI3FuAIhZdOGIcdjLJvvObqlpqvWTJnnQbyi/1M9O8UxWhBs//H42I0q1Yb/XPGONzcmm+ri172mHKvZBpHkJaNJz6v9jxqiklDj3U4CA2ugpAaYMWqNXsdXbmJNd9egCnJEsphXNM+MnK3m0FCJ5S1kmJpa3DgPVbnQnPGWIDspW9ozbcO4K/9LkfaQO2KHuqlfFXSbdNzcEcwoqNEFE9zcIXu9/6n/ym/BC/C3aJLzEKPuYVlbFnfhZ8kcWxV3dbv4bKl28566wD+8C53aw49lTABp9PWbsB+knfc/Li3eVizf5vv/xmvnPKg5ihwKEwlrcHqucuVcVOxEv8aH37E3ZqpZypUulrHEtIWKUr+txHg+ojZDGlwnqmkGlzcVi1dLiNSJiHjfbRNOPwKpx9TVdTn3K05DBx4psIk4Ei8aCkJahRgffk4YnEXe07T4H2RR1u27E6wfQsBDofUgjFUFnwC2AiVtA+05J2zpiDK2Oa0c5fmAecN1iJzmpqFZxqYBCYhFTCsUNEmUnIcZ6aEA5rQVhEywG6w7HSW02XfOoBlQmjwulOFQAg66SvJblrTEX1YtJ3uG15T/BH1OfOQeuR8g/c0gdpT5fx2SKbs9EfHTKdM8A1GaJRHLVIwhcGyydZsbifAFVKl5EMKNU2Hryo+06BeTgqnxzYjThVySDikbtJPieco75lYfKAJOMEZBTjoITuWHXXZVhcUDIS2hpiXHV9Ku4u44bN5OYLDOkJo8w+xJSMbhBRHEdEs9JZUCkQrPMAvaHyLkxgkEHxiNkx/x2YB0mGsQ8EUWj/stW5YLhtS5SMu+/YBbNPDCkGTUybN8krRLBGPlZkVOA0j+a1+rkyQKWGaPHPLZOkJhioQYnVZ2hS3zVxMtgC46KuRwbJNd9nV2PHgb36F194ecf/Yeu2vAFe5nm/bRBFrnY4BauE8ERmZRFUn0k8hbftiVYSKMEme2dJCJSCGYAlNqh87bXOPdUkGy24P6d1ll21MBqqx48Fvv8ZHH8HZFY7j/uAq1xMJUFqCSUlJPmNbIiNsmwuMs/q9CMtsZsFO6SprzCS1Z7QL8xCQClEelpjTduDMsmWD8S1PT152BtvmIGvUeDA/yRn83u/x0/4qxoPHjx+PXY9pqX9bgMvh/Nz9kpP4pOe1/fYf3axUiMdHLlPpZCNjgtNFAhcHEDxTumNONhHrBduW+vOyY++70WWnPXj98eA4kOt/mj/5E05l9+O4o8ePx67HFqyC+qSSnyselqjZGaVK2TadbFLPWAQ4NBhHqDCCV7OTpo34AlSSylPtIdd2AJZlyzYQrDJ5lcWGNceD80CunPLGGzsfD+7wRb95NevJI5docQ3tgCyr5bGnyaPRlmwNsFELViOOx9loebGNq2moDOKpHLVP5al2cymWHbkfzGXL7kfRl44H9wZy33tvt+PB/Xnf93e+nh5ZlU18wCiRUa9m7kib9LYuOk+hudQNbxwm0AQqbfloimaB2lM5fChex+ylMwuTbfmXQtmWlenZljbdXTLuOxjI/fDDHY4Hjx8/Hrse0zXfPFxbUN1kKqSCCSk50m0Ajtx3ub9XHBKHXESb8iO6E+qGytF4nO0OG3SXzbJlhxBnKtKyl0NwybjvYCD30aMdjgePHz8eu56SVTBbgxJMliQ3Oauwg0QHxXE2Ez/EIReLdQj42Gzb4CLS0YJD9xUx7bsi0vJi5mUbW1QzL0h0PFk17rtiIPfJk52MB48fPx67npJJwyrBa2RCCQRTbGZSPCxTPOiND4G2pYyOQ4h4jINIJh5wFU1NFZt+IsZ59LSnDqBjZ2awbOku+yInunLcd8VA7rNnOxkPHj9+PGY9B0MWJJNozOJmlglvDMXDEozdhQWbgs/U6oBanGzLrdSNNnZFjOkmbi5bNt1lX7JLLhn3vXAg9/h4y/Hg8ePHI9dzQMEkWCgdRfYykYKnkP7D4rIujsujaKPBsB54vE2TS00ccvFY/Tth7JXeq1hz+qgVy04sAJawTsvOknHfCwdyT062HA8eP348Zj0vdoXF4pilKa2BROed+9fyw9rWRXeTFXESMOanvDZfJuJaSXouQdMdDJZtekZcLLvEeK04d8m474UDuaenW44Hjx8/Xns9YYqZpszGWB3AN/4VHw+k7WSFtJ3Qicuqb/NlVmgXWsxh570xg2UwxUw3WfO6B5nOuO8aA7lnZxuPB48fPx6znm1i4bsfcbaptF3zNT78eFPtwi1OaCNOqp1x3zUGcs/PN++AGD1+fMXrSVm2baTtPhPahbPhA71wIHd2bXzRa69nG+3CraTtPivahV/55tXWg8fyRY/9AdsY8VbSdp8V7cKrrgdfM//z6ILQFtJ2nxHtwmuoB4/kf74+gLeRtvvMaBdeSz34+vifx0YG20jbfTa0C6+tHrwe//NmOG0L8EbSdp8R7cLrrQe/996O+ai3ujQOskpTNULa7jOjXXj99eCd8lHvoFiwsbTdZ0a78PrrwTvlo966pLuRtB2fFe3Cm6oHP9kNH/W2FryxtN1nTLvwRurBO+Kj3pWXHidtx2dFu/Bm68Fb81HvykuPlrb7LGkX3mw9eGs+6h1Y8MbSdjegXcguQLjmevDpTQLMxtJ2N6NdyBZu9AbrwVvwUW+LbteULUpCdqm0HTelXbhNPe8G68Gb8lFvVfYfSNuxvrTdTWoXbozAzdaDZzfkorOj1oxVxlIMlpSIlpLrt8D4hrQL17z+c3h6hU/wv4Q/utps4+bm+6P/hIcf0JwQ5oQGPBL0eKPTYEXTW+eL/2DKn73J9BTXYANG57hz1cEMviVf/4tf5b/6C5pTQkMIWoAq7hTpOJjtAM4pxKu5vg5vXeUrtI09/Mo/5H+4z+Mp5xULh7cEm2QbRP2tFIKR7WM3fPf/jZ3SWCqLM2l4NxID5zB72HQXv3jj/8mLR5xXNA5v8EbFQEz7PpRfl1+MB/hlAN65qgDn3wTgH13hK7T59bmP+NIx1SHHU84nLOITt3iVz8mNO+lPrjGAnBFqmioNn1mTyk1ta47R6d4MrX7tjrnjYUpdUbv2rVr6YpVfsGG58AG8Ah9eyUN8CX4WfgV+G8LVWPDGb+Zd4cU584CtqSbMKxauxTg+dyn/LkVgA+IR8KHtejeFKRtTmLLpxN6mYVLjYxwXf5x2VofiZcp/lwKk4wGOpYDnoIZPdg/AAbwMfx0+ge9dgZvYjuqKe4HnGnykYo5TvJbG0Vj12JagRhwKa44H95ShkZa5RyLGGdfYvG7aw1TsF6iapPAS29mNS3NmsTQZCmgTzFwgL3upCTgtBTRwvGMAKrgLn4evwin8+afJRcff+8izUGUM63GOOuAs3tJkw7J4kyoNreqrpO6cYLQeFUd7TTpr5YOTLc9RUUogUOVJQ1GYJaFLAW0oTmKyYS46ZooP4S4EON3xQ5zC8/CX4CnM4c1PE8ApexpoYuzqlP3d4S3OJP8ZDK7cKWNaTlqmgDiiHwl1YsE41w1zT4iRTm3DBqxvOUsbMKKDa/EHxagtnta072ejc3DOIh5ojvh8l3tk1JF/AV6FU6jh3U8HwEazLgdCLYSQ+MYiAI2ltomkzttUb0gGHdSUUgsIYjTzLG3mObX4FBRaYtpDVNZrih9TgTeYOBxsEnN1gOCTM8Bsw/ieMc75w9kuAT6A+/AiHGvN/+Gn4KRkiuzpNNDYhDGFndWRpE6SVfm8U5bxnSgVV2jrg6JCKmneqey8VMFgq2+AM/i4L4RUbfSi27lNXZ7R7W9RTcq/q9fk4Xw3AMQd4I5ifAZz8FcVtm9SAom/dyN4lczJQW/kC42ZrHgcCoIf1oVMKkVItmMBi9cOeNHGLqOZk+QqQmrbc5YmYgxELUUN35z2iohstgfLIFmcMV7s4CFmI74L9+EFmGsi+tGnAOD4Yk9gIpo01Y4cA43BWGygMdr4YZekG3OBIUXXNukvJS8tqa06e+lSDCtnqqMFu6hWHXCF+WaYt64m9QBmNxi7Ioy7D+fa1yHw+FMAcPt7SysFLtoG4PXAk7JOA3aAxBRqUiAdU9Yp5lK3HLSRFtOim0sa8euEt08xvKjYjzeJ2GU7YawexrnKI9tmobInjFXCewpwriY9+RR4aaezFhMhGCppKwom0ChrgFlKzyPKkGlTW1YQrE9HJqu8hKGgMc6hVi5QRq0PZxNfrYNgE64utmRv6KKHRpxf6VDUaOvNP5jCEx5q185My/7RKz69UQu2im5k4/eownpxZxNLwiZ1AZTO2ZjWjkU9uaB2HFn6Q3u0JcsSx/qV9hTEApRzeBLDJQXxYmTnq7bdLa3+uqFrxLJ5w1TehnNHx5ECvCh2g2c3hHH5YsfdaSKddztfjQ6imKFGSyFwlLzxEGPp6r5IevVjk1AMx3wMqi1NxDVjLBiPs9tbsCkIY5we5/ML22zrCScFxnNtzsr9Wcc3CnD+pYO+4VXXiDE0oc/vQQ/fDK3oPESJMYXNmJa/DuloJZkcTpcYE8lIH8Dz8DJMiynNC86Mb2lNaaqP/+L7f2fcE/yP7/Lde8xfgSOdMxvOixZf/9p3+M4hT1+F+zApxg9XfUvYjc8qX2lfOOpK2gNRtB4flpFu9FTKCp2XJRgXnX6olp1zyYjTKJSkGmLE2NjUr1bxFM4AeAAHBUFIeSLqXR+NvH/M9fOnfHzOD2vCSyQJKzfgsCh+yi/Mmc35F2fUrw7miW33W9hBD1vpuUojFphIyvg7aTeoymDkIkeW3XLHmguMzbIAJejN6B5MDrhipE2y6SoFRO/AK/AcHHZHNIfiWrEe/C6cr3f/yOvrQKB+zMM55/GQdLDsR+ifr5Fiuu+/y+M78LzOE5dsNuXC3PYvYWd8NXvphLSkJIasrlD2/HOqQ+RjcRdjKTGWYhhVUm4yxlyiGPuMsZR7sMCHUBeTuNWA7if+ifXgc/hovftHXs/DV+Fvwe+f8shzMiMcweFgBly3//vwJfg5AN4450fn1Hd1Rm1aBLu22Dy3y3H2+OqMemkbGZ4jozcDjJf6596xOLpC0eMTHbKnxLxH27uZ/bMTGs2jOaMOY4m87CfQwF0dw53oa1k80JRuz/XgS+8fX3N9Af4qPIMfzKgCp4H5TDGe9GGeFPzSsZz80SlPTxXjgwJmC45njzgt2vbQ4b4OAdUK4/vWhO8d8v6EE8fMUsfakXbPpFJeLs2ubM/qdm/la3WP91uWhxXHjoWhyRUq2iJ/+5mA73zwIIo+LoZ/SgvIRjAd1IMvvn98PfgOvAJfhhm8scAKVWDuaRaK8aQ9f7vuPDH6Bj47ZXau7rqYJ66mTDwEDU6lLbCjCK0qTXyl5mnDoeNRxanj3FJbaksTk0faXxHxLrssgPkWB9LnA/MFleXcJozzjwsUvUG0X/QCve51qkMDXp9mtcyOy3rwBfdvVJK7D6/ACSzg3RoruIq5UDeESfEmVclDxnniU82vxMLtceD0hGZWzBNPMM/jSPne2OVatiTKUpY5vY7gc0LdUAWeWM5tH+O2I66AOWw9xT2BuyRVLGdoDHUsVRXOo/c+ZdRXvFfnxWyIV4upFLCl9eAL7h8Zv0QH8Ry8pA2cHzQpGesctVA37ZtklBTgHjyvdSeKY/RZw/kJMk0Y25cSNRWSigQtlULPTw+kzuJPeYEkXjQRpoGZobYsLF79pyd1dMRHInbgFTZqNLhDqiIsTNpoex2WLcy0/X6rHcdMMQvFSd5dWA++4P7xv89deACnmr36uGlL69bRCL6BSZsS6c0TU2TKK5gtWCzgAOOwQcurqk9j8whvziZSMLcq5hbuwBEsYjopUBkqw1yYBGpLA97SRElEmx5MCInBY5vgLk94iKqSWmhIGmkJ4Bi9m4L645J68LyY4wsFYBfUg5feP/6gWWm58IEmKQM89hq7KsZNaKtP5TxxrUZZVkNmMJtjbKrGxLNEbHPJxhqy7lAmbC32ZqeF6lTaknRWcYaFpfLUBh/rwaQycCCJmW15Kstv6jRHyJFry2C1ahkkIW0LO75s61+owxK1y3XqweX9m5YLM2DPFeOjn/iiqCKJ+yKXF8t5Yl/kNsqaSCryxPq5xWTFIaP8KSW0RYxqupaUf0RcTNSSdJZGcKYdYA6kdtrtmyBckfKXwqk0pHpUHlwWaffjNRBYFPUDWa8e3Lt/o0R0CdisKDM89cX0pvRHEfM8ca4t0s2Xx4kgo91MPQJ/0c9MQYq0co8MBh7bz1fio0UUHLR4aAIOvOmoYO6kwlEVODSSTliWtOtH6sPkrtctF9ZtJ9GIerBskvhdVS5cFNv9s1BU0AbdUgdK4FG+dRnjFmDTzniRMdZO1QhzMK355vigbdkpz9P6qjUGE5J2qAcXmwJ20cZUiAD0z+pGMx6xkzJkmEf40Hr4qZfVg2XzF9YOyoV5BjzVkUJngKf8lgNYwKECEHrCNDrWZzMlflS3yBhr/InyoUgBc/lKT4pxVrrC6g1YwcceK3BmNxZcAtz3j5EIpqguh9H6wc011YN75cKDLpFDxuwkrPQmUwW4KTbj9mZTwBwLq4aQMUZbHm1rylJ46dzR0dua2n3RYCWZsiHROeywyJGR7mXKlpryyCiouY56sFkBWEnkEB/raeh/Sw4162KeuAxMQpEkzy5alMY5wamMsWKKrtW2WpEWNnReZWONKWjrdsKZarpFjqCslq773PLmEhM448Pc3+FKr1+94vv/rfw4tEcu+lKTBe4kZSdijBrykwv9vbCMPcLQTygBjzVckSLPRVGslqdunwJ4oegtFOYb4SwxNgWLCmD7T9kVjTv5YDgpo0XBmN34Z/rEHp0sgyz7lngsrm4lvMm2Mr1zNOJYJ5cuxuQxwMGJq/TP5emlb8fsQBZviK4t8hFL+zbhtlpwaRSxQRWfeETjuauPsdGxsBVdO7nmP4xvzSoT29pRl7kGqz+k26B3Oy0YNV+SXbbQas1ctC/GarskRdFpKczVAF1ZXnLcpaMuzVe6lZ2g/1ndcvOVgRG3sdUAY1bKD6achijMPdMxV4muKVorSpiDHituH7rSTs7n/4y5DhRXo4FVBN4vO/zbAcxhENzGbHCzU/98Mcx5e7a31kWjw9FCe/zNeYyQjZsWb1uc7U33pN4Mji6hCLhivqfa9Ss6xLg031AgfesA/l99m9fgvnaF9JoE6bYKmkGNK3aPbHB96w3+DnxFm4hs0drLsk7U8kf/N/CvwQNtllna0rjq61sH8L80HAuvwH1tvBy2ChqWSCaYTaGN19sTvlfzFD6n+iKTbvtayfrfe9ueWh6GJFoxLdr7V72a5ZpvHcCPDzma0wTO4EgbLyedxstO81n57LYBOBzyfsOhUKsW1J1BB5vr/tz8RyqOFylQP9Tvst2JALsC5lsH8PyQ40DV4ANzYa4dedNiKNR1s+x2wwbR7q4/4cTxqEk4LWDebfisuo36JXLiWFjOtLrlNWh3K1rRS4xvHcDNlFnNmWBBAl5SWaL3oPOfnvbr5pdjVnEaeBJSYjuLEkyLLsWhKccadmOphZkOPgVdalj2QpSmfOsADhMWE2ZBu4+EEJI4wKTAuCoC4xwQbWXBltpxbjkXJtKxxabo9e7tyhlgb6gNlSbUpMh+l/FaqzVwewGu8BW1Zx7pTpQDJUjb8tsUTW6+GDXbMn3mLbXlXJiGdggxFAoUrtPS3wE4Nk02UZG2OOzlk7fRs7i95QCLo3E0jtrjnM7SR3uS1p4qtS2nJ5OwtQVHgOvArLBFijZUV9QtSl8dAY5d0E0hM0w3HS2DpIeB6m/A1+HfhJcGUq4sOxH+x3f5+VO+Ds9rYNI7zPXOYWPrtf8bYMx6fuOAX5jzNR0PdsuON+X1f7EERxMJJoU6GkTEWBvVolVlb5lh3tKCg6Wx1IbaMDdJ+9sUCc5KC46hKGCk3IVOS4TCqdBNfUs7Kd4iXf2RjnT/LLysJy3XDcHLh/vde3x8DoGvwgsa67vBk91G5Pe/HbOe7xwym0NXbtiuuDkGO2IJDh9oQvJ4cY4vdoqLDuoH9Zl2F/ofsekn8lkuhIlhQcffUtSjytFyp++p6NiE7Rqx/lodgKVoceEp/CP4FfjrquZaTtj2AvH5K/ywpn7M34K/SsoYDAdIN448I1/0/wveW289T1/lX5xBzc8N5IaHr0XMOQdHsIkDuJFifj20pBm5jzwUv9e2FhwRsvhAbalCIuIw3bhJihY3p6nTFFIZgiSYjfTf3aXuOjmeGn4bPoGvwl+CFzTRczBIuHBEeImHc37/lGfwZR0cXzVDOvaKfNHvwe+suZ771K/y/XcBlsoN996JpBhoE2toYxOznNEOS5TJc6Id5GEXLjrWo+LEWGNpPDU4WAwsIRROu+1vM+0oW37z/MBN9kqHnSArwPfgFJ7Cq/Ai3Ie7g7ncmI09v8sjzw9mzOAEXoIHxURueaAce5V80f/DOuuZwHM8vsMb5wBzOFWM7wymTXPAEvm4vcFpZ2ut0VZRjkiP2MlmLd6DIpbGSiHOjdnUHN90hRYmhTnmvhzp1iKDNj+b7t5hi79lWGwQ+HN9RsfFMy0FXbEwhfuczKgCbyxYwBmcFhhvo/7a44v+i3XWcwDP86PzpGQYdWh7csP5dBvZ1jNzdxC8pBGuxqSW5vw40nBpj5JhMwvOzN0RWqERHMr4Lv1kWX84xLR830G3j6yqZ1a8UstTlW+qJPOZ+sZ7xZPKTJLhiNOAFd6tk+jrTH31ncLOxid8+nzRb128HhUcru/y0Wn6iT254YPC6FtVSIMoW2sk727AhvTtrWKZTvgsmckfXYZWeNRXx/3YQ2OUxLDrbHtN11IwrgXT6c8dATDwLniYwxzO4RzuQqTKSC5gAofMZ1QBK3zQ4JWobFbcvJm87FK+6JXrKahLn54m3p+McXzzYtP8VF/QpJuh1OwieElEoI1pRxPS09FBrkq2tWCU59+HdhNtTIqKm8EBrw2RTOEDpG3IKo2Y7mFdLm3ZeVjYwVw11o/oznceMve4CgMfNym/utA/d/ILMR7gpXzRy9eDsgLcgbs8O2Va1L0zzIdwGGemTBuwROHeoMShkUc7P+ISY3KH5ZZeWqO8mFTxQYeXTNuzvvK5FGPdQfuu00DwYFY9dyhctEt+OJDdnucfpmyhzUJzfsJjr29l8S0bXBfwRS9ZT26tmMIdZucch5ZboMz3Nio3nIOsYHCGoDT4kUA9MiXEp9Xsui1S8th/kbWIrMBxDGLodWUQIWcvnXy+9M23xPiSMOiRPqM+YMXkUN3gXFrZJwXGzUaMpJfyRS9ZT0lPe8TpScuRlbMHeUmlaKDoNuy62iWNTWNFYjoxFzuJs8oR+RhRx7O4SVNSXpa0ZJQ0K1LAHDQ+D9IepkMXpcsq5EVCvClBUIzDhDoyKwDw1Lc59GbTeORivugw1IcuaEOaGWdNm+Ps5fQ7/tm0DjMegq3yM3vb5j12qUId5UZD2oxDSEWOZMSqFl/W+5oynWDa/aI04tJRQ2eTXusg86SQVu/nwSYwpW6wLjlqIzwLuxGIvoAvul0PS+ZNz0/akp/pniO/8JDnGyaCkzbhl6YcqmK/69prxPqtpx2+Km9al9sjL+rwMgHw4jE/C8/HQ3m1vBuL1fldbzd8mOueVJ92syqdEY4KJjSCde3mcRw2TA6szxedn+zwhZMps0XrqEsiUjnC1hw0TELC2Ek7uAAdzcheXv1BYLagspxpzSAoZZUsIzIq35MnFQ9DOrlNB30jq3L4pkhccKUAA8/ocvN1Rzx9QyOtERs4CVsJRK/DF71kPYrxYsGsm6RMh4cps5g1DOmM54Ly1ii0Hd3Y/BMk8VWFgBVmhqrkJCPBHAolwZaWzLR9Vb7bcWdX9NyUYE+uB2BKfuaeBUcjDljbYVY4DdtsVWvzRZdWnyUzDpjNl1Du3aloAjVJTNDpcIOVVhrHFF66lLfJL1zJr9PQ2nFJSBaKoDe+sAvLufZVHVzYh7W0h/c6AAZ+7Tvj6q9j68G/cTCS/3n1vLKHZwNi+P+pS0WkZNMBMUl+LDLuiE4omZy71r3UFMwNJV+VJ/GC5ixVUkBStsT4gGKh0Gm4Oy3qvq7Lbmq24nPdDuDR9deR11XzP4vFu3TYzfnIyiSVmgizUYGqkIXNdKTY9pgb9D2Ix5t0+NHkVzCdU03suWkkVZAoCONCn0T35gAeW38de43mf97sMOpSvj4aa1KYUm58USI7Wxxes03bAZdRzk6UtbzMaCQ6IxO0dy7X+XsjoD16hpsBeGz9dfzHj+R/Hp8nCxZRqkEDTaCKCSywjiaoMJ1TITE9eg7Jqnq8HL6gDwiZb0u0V0Rr/rmvqjxKuaLCX7ZWXTvAY+uvm3z8CP7nzVpngqrJpZKwWnCUjIviYVlirlGOzPLI3SMVyp/elvBUjjDkNhrtufFFErQ8pmdSlbK16toBHlt/HV8uHMX/vEGALkV3RJREiSlopxwdMXOZPLZ+ix+kAHpMKIk8UtE1ygtquttwxNhphrIZ1IBzjGF3IIGxGcBj6q8bHJBG8T9vdsoWrTFEuebEZuVxhhClH6P5Zo89OG9fwHNjtNQTpD0TG9PJLEYqvEY6Rlxy+ZZGfL0Aj62/bnQCXp//eeM4KzfQVJbgMQbUjlMFIm6TpcfWlZje7NBSV6IsEVmumWIbjiloUzQX9OzYdo8L1wjw2PrrpimONfmfNyzKklrgnEkSzT5QWYQW40YShyzqsRmMXbvVxKtGuYyMKaU1ugenLDm5Ily4iT14fP11Mx+xJv+zZ3MvnfdFqxU3a1W/FTB4m3Qfsyc1XUcdVhDeUDZXSFHHLQj/Y5jtC7ZqM0CXGwB4bP11i3LhOvzPGygYtiUBiwQV/4wFO0majijGsafHyRLu0yG6q35cL1rOpVxr2s5cM2jJYMCdc10Aj6q/blRpWJ//+dmm5psMl0KA2+AFRx9jMe2WbC4jQxnikd4DU8TwUjRVacgdlhmr3bpddzuJ9zXqr2xnxJfzP29RexdtjDVZqzkqa6PyvcojGrfkXiJ8SEtml/nYskicv0ivlxbqjemwUjMw5evdg8fUX9nOiC/lf94Q2i7MURk9nW1MSj5j8eAyV6y5CN2S6qbnw3vdA1Iwq+XOSCl663udN3IzLnrt+us25cI1+Z83SXQUldqQq0b5XOT17bGpLd6ssN1VMPf8c+jG8L3NeCnMdF+Ra3fRa9dft39/LuZ/3vwHoHrqGmQFafmiQw6eyzMxS05K4bL9uA+SKUQzCnSDkqOGokXyJvbgJ/BHI+qvY69//4rl20NsmK2ou2dTsyIALv/91/8n3P2Aao71WFGi8KKv1fRC5+J67Q/507/E/SOshqN5TsmYIjVt+kcjAx98iz/4SaojbIV1rexE7/C29HcYD/DX4a0rBOF5VTu7omsb11L/AWcVlcVZHSsqGuXLLp9ha8I//w3Mv+T4Ew7nTBsmgapoCrNFObIcN4pf/Ob/mrvHTGqqgAupL8qWjWPS9m/31jAe4DjA+4+uCoQoT/zOzlrNd3qd4SdphFxsUvYwGWbTWtISc3wNOWH+kHBMfc6kpmpwPgHWwqaSUG2ZWWheYOGQGaHB+eQ/kn6b3pOgLV+ODSn94wDvr8Bvb70/LLuiPPEr8OGVWfDmr45PZyccEmsVXZGe1pRNX9SU5+AVQkNTIVPCHF/jGmyDC9j4R9LfWcQvfiETmgMMUCMN1uNCakkweZsowdYobiMSlnKA93u7NzTXlSfe+SVbfnPQXmg9LpYAQxpwEtONyEyaueWM4FPjjyjG3uOaFmBTWDNgBXGEiQpsaWhnAqIijB07Dlsy3fUGeP989xbWkyf+FF2SNEtT1E0f4DYYVlxFlbaSMPIRMk/3iMU5pME2SIWJvjckciebkQuIRRyhUvkHg/iUljG5kzVog5hV7vIlCuBrmlhvgPfNHQM8lCf+FEGsYbMIBC0qC9a0uuy2wLXVbLBaP5kjHokCRxapkQyzI4QEcwgYHRZBp+XEFTqXFuNVzMtjXLJgX4gAid24Hjwc4N3dtVSe+NNiwTrzH4WVUOlDobUqr1FuAgYllc8pmzoVrELRHSIW8ViPxNy4xwjBpyR55I6J220qQTZYR4guvUICJiSpr9gFFle4RcF/OMB7BRiX8sSfhpNSO3lvEZCQfLUVTKT78Ek1LRLhWN+yLyTnp8qWUZ46b6vxdRGXfHVqx3eI75YaLa4iNNiK4NOW7wPW6lhbSOF9/M9qw8e/aoB3d156qTzxp8pXx5BKAsYSTOIIiPkp68GmTq7sZtvyzBQaRLNxIZ+paozHWoLFeExIhRBrWitHCAHrCF7/thhD8JhYz84wg93QRV88wLuLY8zF8sQ36qF1J455bOlgnELfshKVxYOXKVuKx0jaj22sczTQqPqtV/XDgpswmGTWWMSDw3ssyUunLLrVPGjYRsH5ggHeHSWiV8kT33ycFSfMgkoOK8apCye0J6VW6GOYvffgU9RWsukEi2kUV2nl4dOYUzRik9p7bcA4ggdJ53LxKcEe17B1R8eqAd7dOepV8sTXf5lhejoL85hUdhDdknPtKHFhljOT+bdq0hxbm35p2nc8+Ja1Iw+tJykgp0EWuAAZYwMVwac5KzYMslhvgHdHRrxKnvhTYcfKsxTxtTETkjHO7rr3zjoV25lAQHrqpV7bTiy2aXMmUhTBnKS91jhtR3GEoF0oLnWhWNnYgtcc4N0FxlcgT7yz3TgNIKkscx9jtV1ZKpWW+Ub1tc1eOv5ucdgpx+FJy9pgbLE7xDyXb/f+hLHVGeitHOi6A7ybo3sF8sS7w7cgdk0nJaOn3hLj3uyD0Zp5pazFIUXUpuTTU18d1EPkDoX8SkmWTnVIozEdbTcZjoqxhNHf1JrSS/AcvHjZ/SMHhL/7i5z+POsTUh/8BvNfYMTA8n+yU/MlTZxSJDRStqvEuLQKWwDctMTQogUDyQRoTQG5Kc6oQRE1yV1jCA7ri7jdZyK0sYTRjCR0Hnnd+y7nHxNgTULqw+8wj0mQKxpYvhjm9uSUxg+TTy7s2GtLUGcywhXSKZN275GsqlclX90J6bRI1aouxmgL7Q0Nen5ziM80SqMIo8cSOo+8XplT/5DHNWsSUr/6lLN/QQ3rDyzLruEW5enpf7KqZoShEduuSFOV7DLX7Ye+GmXb6/hnNNqKsVXuMDFpb9Y9eH3C6NGEzuOuI3gpMH/I6e+zDiH1fXi15t3vA1czsLws0TGEtmPEJdiiFPwlwKbgLHAFk4P6ZyPdymYYHGE0dutsChQBl2JcBFlrEkY/N5bQeXQ18gjunuMfMfsBlxJSx3niO485fwO4fGD5T/+3fPQqkneWVdwnw/3bMPkW9Wbqg+iC765Zk+xcT98ibKZc2EdgHcLoF8cSOo/Oc8fS+OyEULF4g4sJqXVcmfMfsc7A8v1/yfGXmL9I6Fn5pRwZhsPv0TxFNlAfZCvG+Oohi82UC5f/2IsJo0cTOm9YrDoKhFPEUr/LBYTUNht9zelHXDqwfPCIw4owp3mOcIQcLttWXFe3VZ/j5H3cIc0G6oPbCR+6Y2xF2EC5cGUm6wKC5tGEzhsWqw5hNidUiKX5gFWE1GXh4/Qplw4sVzOmx9QxU78g3EF6wnZlEN4FzJ1QPSLEZz1KfXC7vd8ssGdIbNUYpVx4UapyFUHzJoTOo1McSkeNn1M5MDQfs4qQuhhX5vQZFw8suwWTcyYTgioISk2YdmkhehG4PkE7w51inyAGGaU+uCXADabGzJR1fn3lwkty0asIo8cROm9Vy1g0yDxxtPvHDAmpu+PKnM8Ix1wwsGw91YJqhteaWgjYBmmQiebmSpwKKzE19hx7jkzSWOm66oPbzZ8Yj6kxVSpYjVAuvLzYMCRo3oTQecOOjjgi3NQ4l9K5/hOGhNTdcWVOTrlgYNkEXINbpCkBRyqhp+LdRB3g0OU6rMfW2HPCFFMV9nSp+uB2woepdbLBuJQyaw/ZFysXrlXwHxI0b0LovEkiOpXGA1Ijagf+KUNC6rKNa9bQnLFqYNkEnMc1uJrg2u64ELPBHpkgWbmwKpJoDhMwNbbGzAp7Yg31wS2T5rGtzit59PrKhesWG550CZpHEzpv2NGRaxlNjbMqpmEIzygJqQfjypycs2pg2cS2RY9r8HUqkqdEgKTWtWTKoRvOBPDYBltja2SO0RGjy9UHtxwRjA11ujbKF+ti5cIR9eCnxUg6owidtyoU5tK4NLji5Q3HCtiyF2IqLGYsHViOXTXOYxucDqG0HyttqYAKqYo3KTY1ekyDXRAm2AWh9JmsVh/ccg9WJ2E8YjG201sPq5ULxxX8n3XLXuMInbft2mk80rRGjCGctJ8/GFdmEQ9Ug4FlE1ll1Y7jtiraqm5Fe04VV8lvSVBL8hiPrfFVd8+7QH3Qbu2ipTVi8cvSGivc9cj8yvH11YMHdNSERtuOslM97feYFOPKzGcsI4zW0YGAbTAOaxCnxdfiYUmVWslxiIblCeAYr9VYR1gM7GmoPrilunSxxeT3DN/2eBQ9H11+nk1adn6VK71+5+Jfct4/el10/7KBZfNryUunWSCPxPECk1rdOv1WVSrQmpC+Tl46YD3ikQYcpunSQgzVB2VHFhxHVGKDgMEY5GLlQnP7FMDzw7IacAWnO6sBr12u+XanW2AO0wQ8pknnFhsL7KYIqhkEPmEXFkwaN5KQphbkUmG72wgw7WSm9RiL9QT925hkjiVIIhphFS9HKI6/8QAjlpXqg9W2C0apyaVDwKQwrwLY3j6ADR13ZyUNByQXHQu6RY09Hu6zMqXRaNZGS/KEJs0cJEe9VH1QdvBSJv9h09eiRmy0V2uJcqHcShcdvbSNg5fxkenkVprXM9rDVnX24/y9MVtncvbKY706anNl3ASll9a43UiacVquXGhvq4s2FP62NGKfQLIQYu9q1WmdMfmUrDGt8eDS0cXozH/fjmUH6Jruvm50hBDSaEU/2Ru2LEN/dl006TSc/g7tfJERxGMsgDUEr104pfWH9lQaN+M4KWQjwZbVc2rZVNHsyHal23wZtIs2JJqtIc/WLXXRFCpJkfE9jvWlfFbsNQ9pP5ZBS0zKh4R0aMFj1IjTcTnvi0Zz2rt7NdvQb2mgbju1plsH8MmbnEk7KbK0b+wC2iy3aX3szW8xeZvDwET6hWZYwqTXSSG+wMETKum0Dq/q+x62gt2ua2ppAo309TRk9TPazfV3qL9H8z7uhGqGqxNVg/FKx0HBl9OVUORn8Q8Jx9gFttGQUDr3tzcXX9xGgN0EpzN9mdZ3GATtPhL+CjxFDmkeEU6x56kqZRusLzALXVqkCN7zMEcqwjmywDQ6OhyUe0Xao1Qpyncrg6wKp9XfWDsaZplElvQ/b3sdweeghorwBDlHzgk1JmMc/wiERICVy2VJFdMjFuLQSp3S0W3+sngt2njwNgLssFGVQdJ0tu0KH4ky1LW4yrbkuaA6Iy9oz/qEMMXMMDWyIHhsAyFZc2peV9hc7kiKvfULxCl9iddfRK1f8kk9qvbdOoBtOg7ZkOZ5MsGrSHsokgLXUp9y88smniwWyuFSIRVmjplga3yD8Uij5QS1ZiM4U3Qw5QlSm2bXjFe6jzzBFtpg+/YBbLAWG7OPynNjlCw65fukGNdkJRf7yM1fOxVzbxOJVocFoYIaGwH22mIQkrvu1E2nGuebxIgW9U9TSiukPGU+Lt++c3DJPKhyhEEbXCQLUpae2exiKy6tMPe9mDRBFCEMTWrtwxN8qvuGnt6MoihKWS5NSyBhbH8StXoAz8PLOrRgLtOT/+4vcu+7vDLnqNvztOq7fmd8sMmY9Xzn1zj8Dq8+XVdu2Nv0IIySgEdQo3xVHps3Q5i3fLFsV4aiqzAiBhbgMDEd1uh8qZZ+lwhjkgokkOIv4xNJmyncdfUUzgB4oFMBtiu71Xumpz/P+cfUP+SlwFExwWW62r7b+LSPxqxn/gvMZ5z9C16t15UbNlq+jbGJtco7p8wbYlL4alSyfWdeuu0j7JA3JFNuVAwtst7F7FhWBbPFNKIUORndWtLraFLmMu7KFVDDOzqkeaiN33YAW/r76wR4XDN/yN1z7hejPau06EddkS/6XThfcz1fI/4K736fO48vlxt2PXJYFaeUkFS8U15XE3428xdtn2kc8GQlf1vkIaNRRnOMvLTWrZbElEHeLWi1o0dlKPAh1MVgbbVquPJ5+Cr8LU5/H/+I2QlHIU2ClXM9G8v7Rr7oc/hozfUUgsPnb3D+I+7WF8kNO92GY0SNvuxiE+2Bt8prVJTkzE64sfOstxuwfxUUoyk8VjcTlsqe2qITSFoSj6Epd4KsT6BZOWmtgE3hBfir8IzZDwgV4ZTZvD8VvPHERo8v+vL1DASHTz/i9OlKueHDjK5Rnx/JB1Vb1ioXdBra16dmt7dgik10yA/FwJSVY6XjA3oy4SqM2frqDPPSRMex9qs3XQtoWxMj7/Er8GWYsXgjaVz4OYumP2+9kbxvny/6kvWsEBw+fcb5bInc8APdhpOSs01tEqIkoiZjbAqKMruLbJYddHuHFRIyJcbdEdbl2sVLaySygunutBg96Y2/JjKRCdyHV+AEFtTvIpbKIXOamknYSiB6KV/0JetZITgcjjk5ZdaskBtWO86UF0ap6ozGXJk2WNiRUlCPFir66lzdm/SLSuK7EUdPz8f1z29Skq6F1fXg8+5UVR6bszncP4Tn4KUkkdJ8UFCY1zR1i8RmL/qQL3rlei4THG7OODlnKko4oI01kd3CaM08Ia18kC3GNoVaO9iDh+hWxSyTXFABXoau7Q6q9OxYg/OVEMw6jdbtSrJ9cBcewGmaZmg+bvkUnUUaGr+ZfnMH45Ivevl61hMcXsxYLFTu1hTm2zViCp7u0o5l+2PSUh9bDj6FgYypufBDhqK2+oXkiuHFHR3zfj+9PtA8oR0xnqX8qn+sx3bFODSbbF0X8EUvWQ8jBIcjo5bRmLOljDNtcqNtOe756h3l0VhKa9hDd2l1eqmsnh0MNMT/Cqnx6BInumhLT8luljzQ53RiJeA/0dxe5NK0o2fA1+GLXr6eNQWHNUOJssQaTRlGpLHKL9fD+IrQzTOMZS9fNQD4AnRNVxvTdjC+fJdcDDWQcyB00B0t9BDwTxXgaAfzDZ/DBXzRnfWMFRwuNqocOmX6OKNkY63h5n/fFcB28McVHqnXZVI27K0i4rDLNE9lDKV/rT+udVbD8dFFu2GGZ8mOt0kAXcoX3ZkIWVtw+MNf5NjR2FbivROHmhV1/pj2egv/fMGIOWTIWrV3Av8N9imV9IWml36H6cUjqEWNv9aNc+veb2sH46PRaHSuMBxvtW+twxctq0z+QsHhux8Q7rCY4Ct8lqsx7c6Sy0dl5T89rIeEuZKoVctIk1hNpfavER6yyH1Vvm3MbsUHy4ab4hWr/OZPcsRBphnaV65/ZcdYPNNwsjN/djlf9NqCw9U5ExCPcdhKxUgLSmfROpLp4WSUr8ojdwbncbvCf+a/YzRaEc6QOvXcGO256TXc5Lab9POvB+AWY7PigWYjzhifbovuunzRawsO24ZqQQAqguBtmpmPB7ysXJfyDDaV/aPGillgz1MdQg4u5MYaEtBNNHFjkRlSpd65lp4hd2AVPTfbV7FGpyIOfmNc/XVsPfg7vzaS/3nkvLL593ANLvMuRMGpQIhiF7kUEW9QDpAUbTWYBcbp4WpacHHY1aacqQyjGZS9HI3yCBT9kUZJhVOD+zUDvEH9ddR11fzPcTDQ5TlgB0KwqdXSavk9BC0pKp0WmcuowSw07VXmXC5guzSa4p0UvRw2lbDiYUx0ExJJRzWzi6Gm8cnEkfXXsdcG/M/jAJa0+bmCgdmQ9CYlNlSYZOKixmRsgiFxkrmW4l3KdFKv1DM8tk6WxPYJZhUUzcd8Kdtgrw/gkfXXDT7+avmfVak32qhtkg6NVdUS5wgkru1YzIkSduTW1FDwVWV3JQVJVuieTc0y4iDpFwc7/BvSalvKdQM8sv662cevz/+8sQVnjVAT0W2wLllw1JiMhJRxgDjCjLQsOzSFSgZqx7lAW1JW0e03yAD3asC+GD3NbQhbe+mN5GXH1F83KDOM4n/e5JIuH4NpdQARrFPBVptUNcjj4cVMcFSRTE2NpR1LEYbYMmfWpXgP9KejaPsLUhuvLCsVXznAG9dfx9SR1ud/3hZdCLHb1GMdPqRJgqDmm76mHbvOXDtiO2QPUcKo/TWkQ0i2JFXpBoo7vij1i1Lp3ADAo+qvG3V0rM//vFnnTE4hxd5Ka/Cor5YEdsLVJyKtDgVoHgtW11pWSjolPNMnrlrVj9Fv2Qn60twMwKPqr+N/wvr8z5tZcDsDrv06tkqyzESM85Ycv6XBWA2birlNCXrI6VbD2lx2L0vQO0QVTVVLH4SE67fgsfVXv8n7sz7/85Z7cMtbE6f088wSaR4kCkCm10s6pKbJhfqiUNGLq+0gLWC6eUAZFPnLjwqtKd8EwGvWX59t7iPW4X/eAN1svgRVSY990YZg06BD1ohLMtyFTI4pKTJsS9xREq9EOaPWiO2gpms7397x6nQJkbh+Fz2q/rqRROX6/M8bJrqlVW4l6JEptKeUFuMYUbtCQ7CIttpGc6MY93x1r1vgAnRXvY5cvwWPqb9uWQm+lP95QxdNMeWhOq1x0Db55C7GcUv2ZUuN6n8iKzsvOxibC//Yfs9Na8r2Rlz02vXXDT57FP/zJi66/EJSmsJKa8QxnoqW3VLQ+jZVUtJwJ8PNX1NQCwfNgdhhHD9on7PdRdrdGPF28rJr1F+3LBdeyv+8yYfLoMYet1vX4upNAjVvwOUWnlNXJXlkzk5Il6kqeoiL0C07qno+/CYBXq/+utlnsz7/Mzvy0tmI4zm4ag23PRN3t/CWryoUVJGm+5+K8RJ0V8Hc88/XHUX/HfiAq7t+BH+x6v8t438enWmdJwFA6ZINriLGKv/95f8lT9/FnyA1NMVEvQyaXuu+gz36f/DD73E4pwqpLcvm/o0Vle78n//+L/NPvoefp1pTJye6e4A/D082FERa5/opeH9zpvh13cNm19/4v/LDe5xMWTi8I0Ta0qKlK27AS/v3/r+/x/2GO9K2c7kVMonDpq7//jc5PKCxeNPpFVzaRr01wF8C4Pu76hXuX18H4LduTr79guuFD3n5BHfI+ZRFhY8w29TYhbbLi/bvBdqKE4fUgg1pBKnV3FEaCWOWyA+m3WpORZr/j+9TKJtW8yBTF2/ZEODI9/QavHkVdGFp/Pjn4Q+u5hXapsP5sOH+OXXA1LiKuqJxiMNbhTkbdJTCy4llEt6NnqRT4dhg1V3nbdrm6dYMecA1yTOL4PWTE9L5VzPFlLBCvlG58AhehnN4uHsAYinyJ+AZ/NkVvELbfOBUuOO5syBIEtiqHU1k9XeISX5bsimrkUUhnGDxourN8SgUsCZVtKyGbyGzHXdjOhsAvOAswSRyIBddRdEZWP6GZhNK/yjwew9ehBo+3jEADu7Ay2n8mDc+TS7awUHg0OMzR0LABhqLD4hJEh/BEGyBdGlSJoXYXtr+3HS4ijzVpgi0paWXtdruGTknXBz+11qT1Q2inxaTzQCO46P3lfLpyS4fou2PH/PupwZgCxNhGlj4IvUuWEsTkqMWm6i4xCSMc9N1RDQoCVcuGItJ/MRWefais+3synowi/dESgJjkilnWnBTGvRWmaw8oR15257t7CHmCf8HOn7cwI8+NQBXMBEmAa8PMRemrNCEhLGEhDQKcGZWS319BX9PFBEwGTbRBhLbDcaV3drFcDqk5kCTd2JF1Wp0HraqBx8U0wwBTnbpCadwBA/gTH/CDrcCs93LV8E0YlmmcyQRQnjBa8JESmGUfIjK/7fkaDJpmD2QptFNVJU1bbtIAjjWQizepOKptRjbzR9Kag6xZmMLLjHOtcLT3Tx9o/0EcTT1XN3E45u24AiwEypDJXihKjQxjLprEwcmRKclaDNZCVqr/V8mYWyFADbusiY5hvgFoU2vio49RgJLn5OsReRFN6tabeetiiy0V7KFHT3HyZLx491u95sn4K1QQSPKM9hNT0wMVvAWbzDSVdrKw4zRjZMyJIHkfq1VAVCDl/bUhNKlGq0zGr05+YAceXVPCttVk0oqjVwMPt+BBefx4yPtGVkUsqY3CHDPiCM5ngupUwCdbkpd8kbPrCWHhkmtIKLEetF2499eS1jZlIPGYnlcPXeM2KD9vLS0bW3ktYNqUllpKLn5ZrsxlIzxvDu5eHxzGLctkZLEY4PgSOg2IUVVcUONzUDBEpRaMoXNmUc0tFZrTZquiLyKxrSm3DvIW9Fil+AkhXu5PhEPx9mUNwqypDvZWdKlhIJQY7vn2OsnmBeOWnYZ0m1iwbbw1U60by5om47iHRV6fOgzjMf/DAZrlP40Z7syxpLK0lJ0gqaAK1c2KQKu7tabTXkLFz0sCftuwX++MyNeNn68k5Buq23YQhUh0SNTJa1ioQ0p4nUG2y0XilF1JqODqdImloPS4Bp111DEWT0jJjVv95uX9BBV7eB3bUWcu0acSVM23YZdd8R8UbQUxJ9wdu3oMuhdt929ME+mh6JXJ8di2RxbTi6TbrDquqV4aUKR2iwT6aZbyOwEXN3DUsWr8Hn4EhwNyHuXHh7/pdaUjtR7vnDh/d8c9xD/s5f501eQ1+CuDiCvGhk1AN/4Tf74RfxPwD3toLarR0zNtsnPzmS64KIRk861dMWCU8ArasG9T9H0ZBpsDGnjtAOM2+/LuIb2iIUGXNgl5ZmKD/Tw8TlaAuihaFP5yrw18v4x1898zIdP+DDAX1bM3GAMvPgRP/cJn3zCW013nrhHkrITyvYuwOUkcHuKlRSW5C6rzIdY4ppnF7J8aAJbQepgbJYBjCY9usGXDKQxq7RZfh9eg5d1UHMVATRaD/4BHK93/1iAgYZ/+jqPn8Dn4UExmWrpa3+ZOK6MvM3bjwfzxNWA2dhs8+51XHSPJiaAhGSpWevEs5xHLXcEGFXYiCONySH3fPWq93JIsBiSWvWyc3CAN+EcXoT7rCSANloPPoa31rt/5PUA/gp8Q/jDD3hyrjzlR8VkanfOvB1XPubt17vzxAfdSVbD1pzAnfgyF3ycadOTOTXhpEUoLC1HZyNGW3dtmjeXgr2r56JNmRwdNNWaQVBddd6rh4MhviEB9EFRD/7RGvePvCbwAL4Mx/D6M541hHO4D3e7g6PafdcZVw689z7NGTwo5om7A8sPhccT6qKcl9NJl9aM/9kX+e59Hh1yPqGuCCZxuITcsmNaJ5F7d0q6J3H48TO1/+M57085q2icdu2U+W36Ldllz9Agiv4YGljoEN908EzvDOrBF98/vtJwCC/BF2AG75xxEmjmMIcjxbjoaxqOK3/4hPOZzhMPBpYPG44CM0dTVm1LjLtUWWVz1Bcf8tEx0zs8O2A2YVHRxKYOiy/aOVoAaMu0i7ubu43njjmd4ibMHU1sIDHaQNKrZND/FZYdk54oCXetjq7E7IVl9eAL7t+oHnwXXtLx44czzoRFHBztYVwtH1d+NOMkupZ5MTM+gUmq90X+Bh9zjRlmaQ+m7YMqUL/veemcecAtOJ0yq1JnVlN27di2E0+Klp1tAJ4KRw1eMI7aJjsO3R8kPSI3fUFXnIOfdQe86sIIVtWDL7h//Ok6vj8vwDk08NEcI8zz7OhBy+WwalzZeZ4+0XniRfst9pAJqQHDGLzVQ2pheZnnv1OWhwO43/AgcvAEXEVVpa4db9sGvNK8wjaENHkfFQ4Ci5i7dqnQlPoLQrHXZDvO3BIXZbJOBrOaEbML6sFL798I4FhKihjHMsPjBUZYCMFr6nvaArxqXPn4lCa+cHfSa2cP27g3Z3ziYTRrcbQNGLQmGF3F3cBdzzzX7AILx0IB9rbwn9kx2G1FW3Inic+ZLIsVvKR8Zwfj0l1fkqo8LWY1M3IX14OX3r9RKTIO+d9XzAI8qRPGPn/4NC2n6o4rN8XJ82TOIvuVA8zLKUHRFgBCetlDZlqR1gLKjS39xoE7Bt8UvA6BxuEDjU3tFsEijgA+615tmZkXKqiEENrh41iLDDZNq4pKTWR3LZfnos81LOuNa15cD956vLMsJd1rqYp51gDUQqMYm2XsxnUhD2jg1DM7SeuJxxgrmpfISSXVIJIS5qJJSvJPEQ49DQTVIbYWJ9QWa/E2+c/oPK1drmC7WSfJRNKBO5Yjvcp7Gc3dmmI/Xh1kDTEuiSnWqQf37h+fTMhGnDf6dsS8SQfQWlqqwXXGlc/PEZ/SC5mtzIV0nAshlQdM/LvUtYutrEZ/Y+EAFtq1k28zQhOwLr1AIeANzhF8t9qzTdZf2qRKO6MWE9ohBYwibbOmrFtNmg3mcS+tB28xv2uKd/agYCvOP+GkSc+0lr7RXzyufL7QbkUpjLjEWFLqOIkAGu2B0tNlO9Eau2W1qcOUvVRgKzypKIQZ5KI3q0MLzqTNRYqiZOqmtqloIRlmkBHVpHmRYV6/HixbO6UC47KOFJnoMrVyr7wYz+SlW6GUaghYbY1I6kkxA2W1fSJokUdSh2LQ1GAimRGm0MT+uu57H5l7QgOWxERpO9moLRPgTtquWCfFlGlIjQaRly9odmzMOWY+IBO5tB4sW/0+VWGUh32qYk79EidWKrjWuiLpiVNGFWFRJVktyeXWmbgBBzVl8anPuXyNJlBJOlKLTgAbi/EYHVHxWiDaVR06GnHQNpJcWcK2jJtiCfG2sEHLzuI66sGrMK47nPIInPnu799935aOK2cvmvubrE38ZzZjrELCmXM2hM7UcpXD2oC3+ECVp7xtIuxptJ0jUr3sBmBS47TVxlvJ1Sqb/E0uLdvLj0lLr29ypdd/eMX3f6lrxGlKwKQxEGvw0qHbkbwrF3uHKwVENbIV2wZ13kNEF6zD+x24aLNMfDTCbDPnEikZFyTNttxWBXDaBuM8KtI2rmaMdUY7cXcUPstqTGvBGSrFWIpNMfbdea990bvAOC1YX0qbc6smDS1mPxSJoW4fwEXvjMmhlijDRq6qale6aJEuFGoppYDoBELQzLBuh/mZNx7jkinv0EtnUp50lO9hbNK57lZaMAWuWR5Yo9/kYwcYI0t4gWM47Umnl3YmpeBPqSyNp3K7s2DSAS/39KRuEN2bS4xvowV3dFRMx/VFcp2Yp8w2nTO9hCXtHG1kF1L4KlrJr2wKfyq77R7MKpFKzWlY9UkhYxyHWW6nBWPaudvEAl3CGcNpSXPZ6R9BbBtIl6cHL3gIBi+42CYXqCx1gfGWe7Ap0h3luyXdt1MKy4YUT9xSF01G16YEdWsouW9mgDHd3veyA97H+Ya47ZmEbqMY72oPztCGvK0onL44AvgC49saZKkWRz4veWljE1FHjbRJaWv6ZKKtl875h4CziFCZhG5rx7tefsl0aRT1bMHZjm8dwL/6u7wCRysaQblQoG5yAQN5zpatMNY/+yf8z+GLcH/Qn0iX2W2oEfXP4GvwQHuIL9AYGnaO3zqAX6946nkgqZNnUhx43DIdQtMFeOPrgy/y3Yd85HlJWwjLFkU3kFwq28xPnuPhMWeS+tDLV9Otllq7pQCf3uXJDN9wFDiUTgefHaiYbdfi3b3u8+iY6TnzhgehI1LTe8lcd7s1wJSzKbahCRxKKztTLXstGAiu3a6rPuQs5pk9TWAan5f0BZmGf7Ylxzzk/A7PAs4QPPPAHeFQ2hbFHszlgZuKZsJcUmbDC40sEU403cEjczstOEypa+YxevL4QBC8oRYqWdK6b7sK25tfE+oDZgtOQ2Jg8T41HGcBE6fTWHn4JtHcu9S7uYgU5KSCkl/mcnq+5/YBXOEr6lCUCwOTOM1taOI8mSxx1NsCXBEmLKbMAg5MkwbLmpBaFOPrNSlO2HnLiEqW3tHEwd8AeiQLmn+2gxjC3k6AxREqvKcJbTEzlpLiw4rNZK6oJdidbMMGX9FULKr0AkW+2qDEPBNNm5QAt2Ik2nftNWHetubosHLo2nG4vQA7GkcVCgVCgaDixHqo9UUn1A6OshapaNR/LPRYFV8siT1cCtJE0k/3WtaNSuUZYKPnsVIW0xXWnMUxq5+En4Kvw/MqQmVXnAXj9Z+9zM98zM/Agy7F/qqj2Nh67b8HjFnPP3iBn/tkpdzwEJX/whIcQUXOaikeliCRGUk7tiwF0rItwMEhjkZ309hikFoRAmLTpEXWuHS6y+am/KB/fM50aLEhGnSMwkpxzOov4H0AvgovwJ1iGzDLtJn/9BU+fAINfwUe6FHSLhu83viV/+/HrOePX+STT2B9uWGbrMHHLldRBlhS/CJQmcRxJFqZica01XixAZsYiH1uolZxLrR/SgxVIJjkpQP4PE9sE59LKLr7kltSBogS5tyszzH8Fvw8/AS8rNOg0xUS9fIaHwb+6et8Q/gyvKRjf5OusOzGx8evA/BP4IP11uN/grca5O0lcsPLJ5YjwI4QkJBOHa0WdMZYGxPbh2W2nR9v3WxEWqgp/G3+6VZbRLSAAZ3BhdhAaUL33VUSw9yjEsvbaQ9u4A/gGXwZXoEHOuU1GSj2chf+Mo+f8IcfcAxfIKVmyunRbYQVnoevwgfw3TXXcw++xNuP4fhyueEUNttEduRVaDttddoP0eSxLe2LENk6itYxlrxBNBYrNNKSQmeaLcm9c8UsaB5WyO6675yyQIAWSDpBVoA/gxmcwEvwoDv0m58UE7gHn+fJOa8/Ywan8EKRfjsopF83eCglX/Sfr7OeaRoQfvt1CGvIDccH5BCvw1sWIzRGC/66t0VTcLZQZtm6PlAasbOJ9iwWtUo7biktTSIPxnR24jxP1ZKaqq+2RcXM9OrBAm/AAs7hDJ5bNmGb+KIfwCs8a3jnjBrOFeMjHSCdbKr+2uOLfnOd9eiA8Hvvwwq54VbP2OqwkB48Ytc4YEOiH2vTXqodabfWEOzso4qxdbqD5L6tbtNPECqbhnA708DZH4QOJUXqScmUlks7Ot6FBuZw3n2mEbaUX7kDzxHOOQk8nKWMzAzu6ZZ8sOFw4RK+6PcuXo9tB4SbMz58ApfKDXf3szjNIIbGpD5TKTRxGkEMLjLl+K3wlWXBsCUxIDU+jbOiysESqAy1MGUJpXgwbTWzNOVEziIXZrJ+VIztl1PUBxTSo0dwn2bOmfDRPD3TRTGlfbCJvO9KvuhL1hMHhB9wPuPRLGHcdOWG2xc0U+5bQtAJT0nRTewXL1pgk2+rZAdeWmz3jxAqfNQQdzTlbF8uJ5ecEIWvTkevAHpwz7w78QujlD/Lr491bD8/1vhM2yrUQRrWXNQY4fGilfctMWYjL72UL/qS9eiA8EmN88nbNdour+PBbbAjOjIa4iBhfFg6rxeKdEGcL6p3EWR1Qq2Qkhs2DrnkRnmN9tG2EAqmgPw6hoL7Oza7B+3SCrR9tRftko+Lsf2F/mkTndN2LmzuMcKTuj/mX2+4Va3ki16+nnJY+S7MefpkidxwnV+4wkXH8TKnX0tsYzYp29DOOoSW1nf7nTh2akYiWmcJOuTidSaqESrTYpwjJJNVGQr+rLI7WsqerHW6Kp/oM2pKuV7T1QY9gjqlZp41/WfKpl56FV/0kvXQFRyeQ83xaTu5E8p5dNP3dUF34ihyI3GSpeCsywSh22ZJdWto9winhqifb7VRvgktxp13vyjrS0EjvrRfZ62uyqddSWaWYlwTPAtJZ2oZ3j/Sgi/mi+6vpzesfAcWNA0n8xVyw90GVFGuZjTXEQy+6GfLGLMLL523f5E0OmxVjDoOuRiH91RKU+vtoCtH7TgmvBLvtFXWLW15H9GTdVw8ow4IlRLeHECN9ym1e9K0I+Cbnhgv4Yu+aD2HaQJ80XDqOzSGAV4+4yCqBxrsJAX6ZTIoX36QnvzhhzzMfFW2dZVLOJfo0zbce5OvwXMFaZ81mOnlTVXpDZsQNuoYWveketKb5+6JOOsgX+NTm7H49fUTlx+WLuWL7qxnOFh4BxpmJx0p2gDzA/BUARuS6phR+pUsY7MMboAHx5xNsSVfVZcYSwqCKrqon7zM+8ecCkeS4nm3rINuaWvVNnMRI1IRpxTqx8PZUZ0Br/UEduo3B3hNvmgZfs9gQPj8vIOxd2kndir3awvJ6BLvoUuOfFWNYB0LR1OQJoUySKb9IlOBx74q1+ADC2G6rOdmFdJcD8BkfualA+BdjOOzP9uUhGUEX/TwhZsUduwRr8wNuXKurCixLBgpQI0mDbJr9dIqUuV+92ngkJZ7xduCk2yZKbfWrH1VBiTg9VdzsgRjW3CVXCvAwDd+c1z9dWw9+B+8MJL/eY15ZQ/HqvTwVdsZn5WQsgRRnMaWaecu3jFvMBEmgg+FJFZsnSl0zjB9OqPYaBD7qmoVyImFvzi41usesV0julaAR9dfR15Xzv9sEruRDyk1nb+QaLU67T885GTls6YgcY+UiMa25M/pwGrbCfzkvR3e0jjtuaFtnwuagHTSb5y7boBH119HXhvwP487jJLsLJ4XnUkHX5sLbS61dpiAXRoZSCrFJ+EjpeU3puVfitngYNo6PJrAigKktmwjyQdZpfq30mmtulaAx9Zfx15Xzv+cyeuiBFUs9zq8Kq+XB9a4PVvph3GV4E3y8HENJrN55H1X2p8VyqSKwVusJDKzXOZzplWdzBUFK9e+B4+uv468xvI/b5xtSAkBHQaPvtqWzllVvEOxPbuiE6+j2pvjcKsbvI7txnRErgfH7LdXqjq0IokKzga14GzQ23SSbCQvO6r+Or7SMIr/efOkkqSdMnj9mBx2DRsiY29Uj6+qK9ZrssCKaptR6HKURdwUYeUWA2kPzVKQO8ku2nU3Anhs/XWkBx3F/7wJtCTTTIKftthue1ty9xvNYLY/zo5KSbIuKbXpbEdSyeRyYdAIwKY2neyoc3+k1XUaufYga3T9daMUx/r8z1s10ITknIO0kuoMt+TB8jK0lpayqqjsJ2qtXAYwBU932zinimgmd6mTRDnQfr88q36NAI+tv24E8Pr8zxtasBqx0+xHH9HhlrwsxxNUfKOHQaZBITNf0uccj8GXiVmXAuPEAKSdN/4GLHhs/XWj92dN/uetNuBMnVR+XWDc25JLjo5Mg5IZIq226tmCsip2zZliL213YrTlL2hcFjpCduyim3M7/eB16q/blQsv5X/esDRbtJeabLIosWy3ycavwLhtxdWzbMmHiBTiVjJo6lCLjXZsi7p9PEPnsq6X6wd4bP11i0rD5fzPm/0A6brrIsllenZs0lCJlU4abakR59enZKrKe3BZihbTxlyZ2zl1+g0wvgmA166/bhwDrcn/7Ddz0eWZuJvfSESug6NzZsox3Z04FIxz0mUjMwVOOVTq1CQ0AhdbBGVdjG/CgsfUX7esJl3K/7ytWHRv683praW/8iDOCqWLLhpljDY1ZpzK75QiaZoOTpLKl60auHS/97oBXrv+umU9+FL+5+NtLFgjqVLCdbmj7pY5zPCPLOHNCwXGOcLquOhi8CmCWvbcuO73XmMUPab+ug3A6/A/78Bwe0bcS2+tgHn4J5pyS2WbOck0F51Vq3LcjhLvZ67p1ABbaL2H67bg78BfjKi/jr3+T/ABV3ilLmNXTI2SpvxWBtt6/Z//D0z/FXaGbSBgylzlsEGp+5//xrd4/ae4d8DUUjlslfIYS3t06HZpvfQtvv0N7AHWqtjP2pW08QD/FLy//da38vo8PNlKHf5y37Dxdfe/oj4kVIgFq3koLReSR76W/bx//n9k8jonZxzWTANVwEniDsg87sOSd/z7//PvMp3jQiptGVWFX2caezzAXwfgtzYUvbr0iozs32c3Uge7varH+CNE6cvEYmzbPZ9hMaYDdjK4V2iecf6EcEbdUDVUARda2KzO/JtCuDbNQB/iTeL0EG1JSO1jbXS+nLxtPMDPw1fh5+EPrgSEKE/8Gry5A73ui87AmxwdatyMEBCPNOCSKUeRZ2P6Myb5MRvgCHmA9ywsMifU+AYXcB6Xa5GibUC5TSyerxyh0j6QgLVpdyhfArRTTLqQjwe4HOD9s92D4Ap54odXAPBWLAwB02igG5Kkc+piN4lvODIFGAZgT+EO4Si1s7fjSR7vcQETUkRm9O+MXyo9OYhfe4xt9STQ2pcZRLayCV90b4D3jR0DYAfyxJ+eywg2IL7NTMXna7S/RpQ63JhWEM8U41ZyQGjwsVS0QBrEKLu8xwZsbi4wLcCT+OGidPIOCe1PiSc9Qt+go+vYqB7cG+B9d8cAD+WJPz0Am2gxXgU9IneOqDpAAXOsOltVuMzpdakJXrdPCzXiNVUpCeOos5cxnpQT39G+XVLhs1osQVvJKPZyNq8HDwd4d7pNDuWJPxVX7MSzqUDU6gfadKiNlUFTzLeFHHDlzO4kpa7aiKhBPGKwOqxsBAmYkOIpipyXcQSPlRTf+Tii0U3EJGaZsDER2qoB3h2hu0qe+NNwUooYU8y5mILbJe6OuX+2FTKy7bieTDAemaQyQ0CPthljSWO+xmFDIYiESjM5xKd6Ik5lvLq5GrQ3aCMLvmCA9wowLuWJb9xF59hVVP6O0CrBi3ZjZSNOvRy+I6klNVRJYRBaEzdN+imiUXQ8iVF8fsp+W4JXw7WISW7fDh7lptWkCwZ4d7QTXyBPfJMYK7SijjFppGnlIVJBJBYj7eUwtiP1IBXGI1XCsjNpbjENVpSAJ2hq2LTywEly3hUYazt31J8w2+aiLx3g3fohXixPfOMYm6zCGs9LVo9MoW3MCJE7R5u/WsOIjrqBoHUO0bJE9vxBpbhsd3+Nb4/vtPCZ4oZYCitNeYuC/8UDvDvy0qvkiW/cgqNqRyzqSZa/s0mqNGjtKOoTm14zZpUauiQgVfqtQiZjq7Q27JNaSK5ExRcrGCXO1FJYh6jR6CFqK7bZdQZ4t8g0rSlPfP1RdBtqaa9diqtzJkQ9duSryi2brQXbxDwbRUpFMBHjRj8+Nt7GDKgvph9okW7LX47gu0SpGnnFQ1S1lYldOsC7hYteR574ZuKs7Ei1lBsfdz7IZoxzzCVmmVqaSySzQbBVAWDek+N4jh9E/4VqZrJjPwiv9BC1XcvOWgO8275CVyBPvAtTVlDJfZkaZGU7NpqBogAj/xEHkeAuJihWYCxGN6e8+9JtSegFXF1TrhhLGP1fak3pebgPz192/8gB4d/6WT7+GdYnpH7hH/DJzzFiYPn/vjW0SgNpTNuPIZoAEZv8tlGw4+RLxy+ZjnKa5NdFoC7UaW0aduoYse6+bXg1DLg6UfRYwmhGEjqPvF75U558SANrElK/+MdpXvmqBpaXOa/MTZaa1DOcSiLaw9j0NNNst3c+63c7EKTpkvKHzu6bPbP0RkuHAVcbRY8ijP46MIbQeeT1mhA+5PV/inyDdQipf8LTvMXbwvoDy7IruDNVZKTfV4CTSRUYdybUCnGU7KUTDxLgCknqUm5aAW6/1p6eMsOYsphLzsHrE0Y/P5bQedx1F/4yPHnMB3/IOoTU9+BL8PhtjuFKBpZXnYNJxTuv+2XqolKR2UQgHhS5novuxVySJhBNRF3SoKK1XZbbXjVwWNyOjlqWJjrWJIy+P5bQedyldNScP+HZ61xKSK3jyrz+NiHG1hcOLL/+P+PDF2gOkekKGiNWKgJ+8Z/x8Iv4DdQHzcpZyF4v19I27w9/yPGDFQvmEpKtqv/TLiWMfn4sofMm9eAH8Ao0zzh7h4sJqYtxZd5/D7hkYPneDzl5idlzNHcIB0jVlQ+8ULzw/nc5/ojzl2juE0apD7LRnJxe04dMz2iOCFNtGFpTuXA5AhcTRo8mdN4kz30nVjEC4YTZQy4gpC7GlTlrePKhGsKKgeXpCYeO0MAd/GH7yKQUlXPLOasOH3FnSphjHuDvEu4gB8g66oNbtr6eMbFIA4fIBJkgayoXriw2XEDQPJrQeROAlY6aeYOcMf+IVYTU3XFlZufMHinGywaW3YLpObVBAsbjF4QJMsVUSayjk4voPsHJOQfPWDhCgDnmDl6XIRerD24HsGtw86RMHOLvVSHrKBdeVE26gKB5NKHzaIwLOmrqBWJYZDLhASG16c0Tn+CdRhWDgWXnqRZUTnPIHuMJTfLVpkoYy5CzylHVTGZMTwkGAo2HBlkQplrJX6U+uF1wZz2uwS1SQ12IqWaPuO4baZaEFBdukksJmkcTOm+YJSvoqPFzxFA/YUhIvWxcmSdPWTWwbAKVp6rxTtPFUZfKIwpzm4IoMfaYQLWgmlG5FME2gdBgm+J7J+rtS/XBbaVLsR7bpPQnpMFlo2doWaVceHk9+MkyguZNCJ1He+kuHTWyQAzNM5YSUg/GlTk9ZunAsg1qELVOhUSAK0LABIJHLKbqaEbHZLL1VA3VgqoiOKXYiS+HRyaEKgsfIqX64HYWbLRXy/qWoylIV9gudL1OWBNgBgTNmxA6b4txDT4gi3Ri7xFSLxtXpmmYnzAcWDZgY8d503LFogz5sbonDgkKcxGsWsE1OI+rcQtlgBBCSOKD1mtqYpIU8cTvBmAT0yZe+zUzeY92fYjTtGipXLhuR0ePoHk0ofNWBX+lo8Z7pAZDk8mEw5L7dVyZZoE/pTewbI6SNbiAL5xeygW4xPRuLCGbhcO4RIeTMFYHEJkYyEO9HmJfXMDEj/LaH781wHHZEtqSQ/69UnGpzH7LKIAZEDSPJnTesJTUa+rwTepI9dLJEawYV+ZkRn9g+QirD8vF8Mq0jFQ29js6kCS3E1+jZIhgPNanHdHFqFvPJLHqFwQqbIA4jhDxcNsOCCQLDomaL/dr5lyJaJU6FxPFjO3JOh3kVMcROo8u+C+jo05GjMF3P3/FuDLn5x2M04xXULPwaS6hBYki+MrMdZJSgPHlcB7nCR5bJ9Kr5ACUn9jk5kivdd8tk95SOGrtqu9lr2IhK65ZtEl7ZKrp7DrqwZfRUSN1el7+7NJxZbywOC8neNKTch5vsTEMNsoCCqHBCqIPRjIPkm0BjvFODGtto99rCl+d3wmHkW0FPdpZtC7MMcVtGFQjJLX5bdQ2+x9ypdc313uj8xlsrfuLgWXz1cRhZvJYX0iNVBRcVcmCXZs6aEf3RQF2WI/TcCbKmGU3IOoDJGDdDub0+hYckt6PlGu2BcxmhbTdj/klhccLGJMcqRjMJP1jW2ETqLSWJ/29MAoORluJ+6LPffBZbi5gqi5h6catQpmOT7/OFf5UorRpLzCqcMltBLhwd1are3kztrSzXO0LUbXRQcdLh/RdSZ+swRm819REDrtqzC4es6Gw4JCKlSnjYVpo0xeq33PrADbFLL3RuCmObVmPN+24kfa+AojDuM4umKe2QwCf6EN906HwjujaitDs5o0s1y+k3lgbT2W2i7FJdnwbLXhJUBq/9liTctSmFC/0OqUinb0QddTWamtjbHRFuWJJ6NpqZ8vO3fZJ37Db+2GkaPYLGHs7XTTdiFQJ68SkVJFVmY6McR5UycflNCsccHFaV9FNbR4NttLxw4pQ7wJd066Z0ohVbzihaxHVExd/ay04oxUKWt+AsdiQ9OUyZ2krzN19IZIwafSTFgIBnMV73ADj7V/K8u1MaY2sJp2HWm0f41tqwajEvdHWOJs510MaAqN4aoSiPCXtN2KSi46dUxHdaMquar82O1x5jqhDGvqmoE9LfxcY3zqA7/x3HA67r9ZG4O6Cuxu12/+TP+eLP+I+HErqDDCDVmBDO4larujNe7x8om2rMug0MX0rL1+IWwdwfR+p1TNTyNmVJ85ljWzbWuGv8/C7HD/izjkHNZNYlhZcUOKVzKFUxsxxN/kax+8zPWPSFKw80rJr9Tizyj3o1gEsdwgWGoxPezDdZ1TSENE1dLdNvuKL+I84nxKesZgxXVA1VA1OcL49dFlpFV5yJMhzyCmNQ+a4BqusPJ2bB+xo8V9u3x48VVIEPS/mc3DvAbXyoYr6VgDfh5do5hhHOCXMqBZUPhWYbWZECwVJljLgMUWOCB4MUuMaxGNUQDVI50TQ+S3kFgIcu2qKkNSHVoM0SHsgoZxP2d5HH8B9woOk4x5bPkKtAHucZsdykjxuIpbUrSILgrT8G7G5oCW+K0990o7E3T6AdW4TilH5kDjds+H64kS0mz24grtwlzDHBJqI8YJQExotPvoC4JBq0lEjjQkyBZ8oH2LnRsQ4Hu1QsgDTJbO8fQDnllitkxuVskoiKbRF9VwzMDvxHAdwB7mD9yCplhHFEyUWHx3WtwCbSMMTCUCcEmSGlg4gTXkHpZXWQ7kpznK3EmCHiXInqndkQjunG5kxTKEeGye7jWz9cyMR2mGiFQ15ENRBTbCp+Gh86vAyASdgmJq2MC6hoADQ3GosP0QHbnMHjyBQvQqfhy/BUbeHd5WY/G/9LK/8Ka8Jd7UFeNWEZvzPb458Dn8DGLOe3/wGL/4xP+HXlRt+M1PE2iLhR8t+lfgxsuh7AfO2AOf+owWhSZRYQbd622hbpKWKuU+XuvNzP0OseRDa+mObgDHJUSc/pKx31QdKffQ5OIJpt8GWjlgTwMc/w5MPCR/yl1XC2a2Yut54SvOtMev55Of45BOat9aWG27p2ZVORRvnEk1hqWMVUmqa7S2YtvlIpspuF1pt0syuZS2NV14mUidCSfzQzg+KqvIYCMljIx2YK2AO34fX4GWdu5xcIAb8MzTw+j/lyWM+Dw/gjs4GD6ehNgA48kX/AI7XXM/XAN4WHr+9ntywqoCakCqmKP0rmQrJJEErG2Upg1JObr01lKQy4jskWalKYfJ/EDLMpjNSHFEUAde2fltaDgmrNaWQ9+AAb8I5vKjz3L1n1LriB/BXkG/wwR9y/oRX4LlioHA4LzP2inzRx/DWmutRweFjeP3tNeSGlaE1Fde0OS11yOpmbIp2u/jF1n2RRZviJM0yBT3IZl2HWImKjQOxIyeU325b/qWyU9Moj1o07tS0G7qJDoGHg5m8yeCxMoEH8GU45tnrNM84D2l297DQ9t1YP7jki/7RmutRweEA77/HWXOh3HCxkRgldDQkAjNTMl2Iloc1qN5JfJeeTlyTRzxURTdn1Ixv2uKjs12AbdEWlBtmVdk2k7FFwj07PCZ9XAwW3dG+8xKzNFr4EnwBZpy9Qzhh3jDXebBpYcpuo4fQ44u+fD1dweEnHzI7v0xuuOALRUV8rXpFyfSTQYkhd7IHm07jpyhlkCmI0ALYqPTpUxXS+z4jgDj1Pflvmz5ecuItpIBxyTHpSTGWd9g1ApfD/bvwUhL4nT1EzqgX7cxfCcNmb3mPL/qi9SwTHJ49oj5ZLjccbTG3pRmlYi6JCG0mQrAt1+i2UXTZ2dv9IlQpN5naMYtviaXlTrFpoMsl3bOAFEa8sqPj2WCMrx3Yjx99qFwO59Aw/wgx+HlqNz8oZvA3exRDvuhL1jMQHPaOJ0+XyA3fp1OfM3qObEVdhxjvynxNMXQV4+GJyvOEFqeQBaIbbO7i63rpxCltdZShPFxkjM2FPVkn3TG+Rp9pO3l2RzFegGfxGDHIAh8SteR0C4HopXzRF61nheDw6TFN05Ebvq8M3VKKpGjjO6r7nhudTEGMtYM92HTDaR1FDMXJ1eThsbKfywyoWwrzRSXkc51flG3vIid62h29bIcFbTGhfV+faaB+ohj7dPN0C2e2lC96+XouFByen9AsunLDJZ9z7NExiUc0OuoYW6UZkIyx2YUR2z6/TiRjyKMx5GbbjLHvHuf7YmtKghf34LJfx63Yg8vrvN2zC7lY0x0tvKezo4HmGYDU+Gab6dFL+KI761lDcNifcjLrrr9LWZJctG1FfU1uwhoQE22ObjdfkSzY63CbU5hzs21WeTddH2BaL11Gi7lVdlxP1nkxqhnKhVY6knS3EPgVGg1JpN5cP/hivujOelhXcPj8HC/LyI6MkteVjlolBdMmF3a3DbsuAYhL44dxzthWSN065xxUd55Lmf0wRbOYOqH09/o9WbO2VtFdaMb4qBgtFJoT1SqoN8wPXMoXLb3p1PUEhxfnnLzGzBI0Ku7FxrKsNJj/8bn/H8fPIVOd3rfrklUB/DOeO+nkghgSPzrlPxluCMtOnDL4Yml6dK1r3vsgMxgtPOrMFUZbEUbTdIzii5beq72G4PD0DKnwjmBULUVFmy8t+k7fZ3pKc0Q4UC6jpVRqS9Umv8bxw35flZVOU1X7qkjnhZlsMbk24qQ6Hz7QcuL6sDC0iHHki96Uh2UdvmgZnjIvExy2TeJdMDZNSbdZyAHe/Yd1xsQhHiKzjh7GxQ4yqMPaywPkjMamvqrYpmO7Knad+ZQC5msCuAPWUoxrxVhrGv7a+KLXFhyONdTMrZ7ke23qiO40ZJUyzgYyX5XyL0mV7NiUzEs9mjtbMN0dERqwyAJpigad0B3/zRV7s4PIfXSu6YV/MK7+OrYe/JvfGMn/PHJe2fyUdtnFrKRNpXV0Y2559aWPt/G4BlvjTMtXlVIWCnNyA3YQBDmYIodFz41PvXPSa6rq9lWZawZ4dP115HXV/M/tnFkkrBOdzg6aP4pID+MZnTJ1SuuB6iZlyiox4HT2y3YBtkUKWooacBQUDTpjwaDt5poBHl1/HXltwP887lKKXxNUEyPqpGTyA699UqY/lt9yGdlUKra0fFWS+36iylVWrAyd7Uw0CZM0z7xKTOduznLIjG2Hx8cDPLb+OvK6Bv7n1DYci4CxUuRxrjBc0bb4vD3rN5Zz36ntLb83eVJIB8LiIzCmn6SMPjlX+yNlTjvIGjs+QzHPf60Aj62/jrzG8j9vYMFtm1VoRWCJdmw7z9N0t+c8cxZpPeK4aTRicS25QhrVtUp7U578chk4q04Wx4YoQSjFryUlpcQ1AbxZ/XVMknIU//OGl7Q6z9Zpxi0+3yFhSkjUDpnCIUhLWVX23KQ+L9vKvFKI0ZWFQgkDLvBoylrHNVmaw10zwCPrr5tlodfnf94EWnQ0lFRWy8pW9LbkLsyUVDc2NSTHGDtnD1uMtchjbCeb1mpxFP0YbcClhzdLu6lfO8Bj6q+bdT2sz/+8SZCV7VIxtt0DUn9L7r4cLYWDSXnseEpOGFuty0qbOVlS7NNzs5FOGJUqQpl2Q64/yBpZf90sxbE+//PGdZ02HSipCbmD6NItmQ4Lk5XUrGpDMkhbMm2ZVheNYV+VbUWTcv99+2NyX1VoafSuC+AN6q9bFIMv5X/eagNWXZxEa9JjlMwNWb00akGUkSoepp1/yRuuqHGbUn3UdBSTxBU6SEVklzWRUkPndVvw2PrrpjvxOvzPmwHc0hpmq82npi7GRro8dXp0KXnUQmhZbRL7NEVp1uuZmO45vuzKsHrktS3GLWXODVjw+vXXLYx4Hf7njRPd0i3aoAGX6W29GnaV5YdyDj9TFkakje7GHYzDoObfddHtOSpoi2SmzJHrB3hM/XUDDEbxP2/oosszcRlehWXUvzHv4TpBVktHqwenFo8uLVmy4DKLa5d3RtLrmrM3aMFr1183E4sewf+85VWeg1c5ag276NZrM9IJVNcmLEvDNaV62aq+14IAOGFsBt973Ra8Xv11YzXwNfmft7Jg2oS+XOyoC8/cwzi66Dhmgk38kUmP1CUiYWOX1bpD2zWXt2FCp7uq8703APAa9dfNdscR/M/bZLIyouVxqJfeWvG9Je+JVckHQ9+CI9NWxz+blX/KYYvO5n2tAP/vrlZ7+8/h9y+9qeB/Hnt967e5mevX10rALDWK//FaAT5MXdBXdP0C/BAes792c40H+AiAp1e1oH8HgH94g/Lttx1gp63op1eyoM/Bvw5/G/7xFbqJPcCXnmBiwDPb/YKO4FX4OjyCb289db2/Noqicw4i7N6TVtoz8tNwDH+8x/i6Ae7lmaQVENzJFb3Di/BFeAwz+Is9SjeQySpPqbLFlNmyz47z5a/AF+AYFvDmHqibSXTEzoT4Gc3OALaqAP4KPFUJ6n+1x+rGAM6Zd78bgJ0a8QN4GU614vxwD9e1Amy6CcskNrczLx1JIp6HE5UZD/DBHrFr2oNlgG4Odv226BodoryjGJ9q2T/AR3vQrsOCS0ctXZi3ruLlhpFDJYl4HmYtjQCP9rhdn4suySLKDt6wLcC52h8xPlcjju1fn+yhuw4LZsAGUuo2b4Fx2UwQu77uqRHXGtg92aN3tQCbFexc0uk93vhTXbct6y7MulLycoUljx8ngDMBg1tvJjAazpEmOtxlzclvj1vQf1Tx7QlPDpGpqgtdSKz/d9/hdy1vTfFHSmC9dGDZbLiezz7Ac801HirGZsWjydfZyPvHXL/Y8Mjzg8BxTZiuwKz4Eb8sBE9zznszmjvFwHKPIWUnwhqfVRcd4Ck0K6ate48m1oOfrX3/yOtvAsJ8zsPAM89sjnddmuLuDPjX9Bu/L7x7xpMzFk6nWtyQfPg278Gn4Aekz2ZgOmU9eJ37R14vwE/BL8G3aibCiWMWWDQ0ZtkPMnlcGeAu/Ag+8ZyecU5BPuy2ILD+sQqyZhAKmn7XZd+jIMTN9eBL7x95xVLSX4On8EcNlXDqmBlqS13jG4LpmGbkF/0CnOi3H8ETOIXzmnmtb0a16Tzxj1sUvQCBiXZGDtmB3KAefPH94xcUa/6vwRn80GOFyjEXFpba4A1e8KQfFF+259tx5XS4egYn8fQsLGrqGrHbztr+uByTahWuL1NUGbDpsnrwBfePPwHHIf9X4RnM4Z2ABWdxUBlqQ2PwhuDxoS0vvqB1JzS0P4h2nA/QgTrsJFn+Y3AOjs9JFC07CGWX1oNX3T/yHOzgDjwPn1PM3g9Jk9lZrMEpxnlPmBbjyo2+KFXRU52TJM/2ALcY57RUzjObbjqxVw++4P6RAOf58pcVsw9Daje3htriYrpDOonre3CudSe6bfkTEgHBHuDiyu5MCsc7BHhYDx7ePxLjqigXZsw+ijMHFhuwBmtoTPtOxOrTvYJDnC75dnUbhfwu/ZW9AgYd+peL68HD+0emKquiXHhWjJg/UrkJYzuiaL3E9aI/ytrCvAd4GcYZMCkSQxfUg3v3j8c4e90j5ZTPdvmJJGHnOCI2nHS8081X013pHuBlV1gB2MX1YNmWLHqqGN/TWmG0y6clJWthxNUl48q38Bi8vtMKyzzpFdSDhxZ5WBA5ZLt8Jv3895DduBlgbPYAj8C4B8hO68FDkoh5lydC4FiWvBOVqjYdqjiLv92t8yPDjrDaiHdUD15qkSURSGmXJwOMSxWAXYwr3zaAufJ66l+94vv3AO+vPcD7aw/w/toDvL/2AO+vPcD7aw/wHuD9tQd4f+0B3l97gPfXHuD9tQd4f+0B3l97gG8LwP8G/AL8O/A5OCq0Ys2KIdv/qOIXG/4mvFAMF16gZD+2Xvu/B8as5+8bfllWyg0zaNO5bfXj6vfhhwD86/Aq3NfRS9t9WPnhfnvCIw/CT8GLcFTMnpntdF/z9V+PWc/vWoIH+FL3Znv57PitcdGP4R/C34avw5fgRVUInCwbsn1yyA8C8zm/BH8NXoXnVE6wVPjdeCI38kX/3+Ct9dbz1pTmHFRu+Hm4O9Ch3clr99negxfwj+ER/DR8EV6B5+DuQOnTgUw5rnkY+FbNU3gNXh0o/JYTuWOvyBf9FvzX663HH/HejO8LwAl8Hl5YLTd8q7sqA3wbjuExfAFegQdwfyDoSkWY8swzEf6o4Qyewefg+cHNbqMQruSL/u/WWc+E5g7vnnEXgDmcDeSGb/F4cBcCgT+GGRzDU3hZYburAt9TEtHgbM6JoxJ+6NMzzTcf6c2bycv2+KK/f+l6LBzw5IwfqZJhA3M472pWT/ajKxnjv4AFnMEpnBTPND6s2J7qHbPAqcMK74T2mZ4VGB9uJA465It+/eL1WKhYOD7xHOkr1ajK7d0C4+ke4Hy9qXZwpgLr+Znm/uNFw8xQOSy8H9IzjUrd9+BIfenYaylf9FsXr8fBAadnPIEDna8IBcwlxnuA0/Wv6GAWPd7dDIKjMdSWueAsBj4M7TOd06qBbwDwKr7oleuxMOEcTuEZTHWvDYUO7aHqAe0Bbq+HEFRzOz7WVoTDQkVds7A4sIIxfCQdCefFRoIOF/NFL1mPab/nvOakSL/Q1aFtNpUb/nFOVX6gzyg/1nISyDfUhsokIzaBR9Kxm80s5mK+6P56il1jXic7nhQxsxSm3OwBHl4fFdLqi64nDQZvqE2at7cWAp/IVvrN6/BFL1mPhYrGMBfOi4PyjuSGf6wBBh7p/FZTghCNWGgMzlBbrNJoPJX2mW5mwZfyRffXo7OFi5pZcS4qZUrlViptrXtw+GQoyhDPS+ANjcGBNRiLCQDPZPMHuiZfdFpPSTcQwwKYdRNqpkjm7AFeeT0pJzALgo7g8YYGrMHS0iocy+YTm2vyRUvvpXCIpQ5pe666TJrcygnScUf/p0NDs/iAI/nqDHC8TmQT8x3NF91l76oDdQGwu61Z6E0ABv7uO1dbf/37Zlv+Zw/Pbh8f1s4Avur6657/+YYBvur6657/+YYBvur6657/+YYBvur6657/+aYBvuL6657/+VMA8FXWX/f8zzcN8BXXX/f8zzcNMFdbf93zP38KLPiK6697/uebtuArrr/u+Z9vGmCusP6653/+1FjwVdZf9/zPN7oHX339dc//fNMu+irrr3v+50+Bi+Zq6697/uebA/jz8Pudf9ht/fWv517J/XUzAP8C/BAeX9WCDrUpZ3/dEMBxgPcfbtTVvsYV5Yn32u03B3Ac4P3b8I+vxNBKeeL9dRMAlwO83959qGO78sT769oB7g3w/vGVYFzKE++v6wV4OMD7F7tckFkmT7y/rhHgpQO8b+4Y46XyxPvrugBeNcB7BRiX8sT767oAvmCA9woAHsoT76+rBJjLBnh3txOvkifeX1dswZcO8G6N7sXyxPvr6i340gHe3TnqVfLE++uKAb50gHcXLnrX8sR7gNdPRqwzwLu7Y/FO5Yn3AK9jXCMGeHdgxDuVJ75VAI8ljP7PAb3/RfjcZfePHBB+79dpfpH1CanN30d+mT1h9GqAxxJGM5LQeeQ1+Tb+EQJrElLb38VHQ94TRq900aMIo8cSOo+8Dp8QfsB8zpqE1NO3OI9Zrj1h9EV78PqE0WMJnUdeU6E+Jjyk/hbrEFIfeWbvId8H9oTRFwdZaxJGvziW0Hn0gqYB/wyZ0PwRlxJST+BOw9m77Amj14ii1yGM/txYQudN0qDzGe4EqfA/5GJCagsHcPaEPWH0esekSwmjRxM6b5JEcZ4ww50ilvAOFxBSx4yLW+A/YU8YvfY5+ALC6NGEzhtmyZoFZoarwBLeZxUhtY4rc3bKnjB6TKJjFUHzJoTOozF2YBpsjcyxDgzhQ1YRUse8+J4wenwmaylB82hC5w0zoRXUNXaRBmSMQUqiWSWkLsaVqc/ZE0aPTFUuJWgeTei8SfLZQeMxNaZSIzbII4aE1Nmr13P2hNHjc9E9guYNCZ032YlNwESMLcZiLQHkE4aE1BFg0yAR4z1h9AiAGRA0jyZ03tyIxWMajMPWBIsxYJCnlITU5ShiHYdZ94TR4wCmSxg9jtB5KyPGYzymAYexWEMwAPIsAdYdV6aObmNPGD0aYLoEzaMJnTc0Ygs+YDw0GAtqxBjkuP38bMRWCHn73xNGjz75P73WenCEJnhwyVe3AEe8TtKdJcYhBl97wuhNAObK66lvD/9J9NS75v17wuitAN5fe4D31x7g/bUHeH/tAd5fe4D3AO+vPcD7aw/w/toDvL/2AO+vPcD7aw/w/toDvAd4f/24ABzZ8o+KLsSLS+Pv/TqTb3P4hKlQrTGh+fbIBT0Axqznnb+L/V2mb3HkN5Mb/nEHeK7d4IcDld6lmDW/iH9E+AH1MdOw/Jlu2T1xNmY98sv4wHnD7D3uNHu54WUuOsBTbQuvBsPT/UfzNxGYzwkP8c+Yz3C+r/i6DcyRL/rZ+utRwWH5PmfvcvYEt9jLDS/bg0/B64DWKrQM8AL8FPwS9beQCe6EMKNZYJol37jBMy35otdaz0Bw2H/C2Smc7+WGB0HWDELBmOByA3r5QONo4V+DpzR/hFS4U8wMW1PXNB4TOqYz9urxRV++ntWCw/U59Ty9ebdWbrgfRS9AYKKN63ZokZVygr8GZ/gfIhZXIXPsAlNjPOLBby5c1eOLvmQ9lwkOy5x6QV1j5TYqpS05JtUgUHUp5toHGsVfn4NX4RnMCe+AxTpwmApTYxqMxwfCeJGjpXzRF61nbcHhUBPqWze9svwcHJ+S6NPscKrEjug78Dx8Lj3T8D4YxGIdxmJcwhi34fzZUr7olevZCw5vkOhoClq5zBPZAnygD/Tl9EzDh6kl3VhsHYcDEb+hCtJSvuiV69kLDm+WycrOTArHmB5/VYyP6jOVjwgGawk2zQOaTcc1L+aLXrKeveDwZqlKrw8U9Y1p66uK8dEzdYwBeUQAY7DbyYNezBfdWQ97weEtAKYQg2xJIkuveAT3dYeLGH+ShrWNwZgN0b2YL7qznr3g8JYAo5bQBziPjx7BPZ0d9RCQp4UZbnFdzBddor4XHN4KYMrB2qHFRIzzcLAHQZ5the5ovui94PCWAPefaYnxIdzRwdHCbuR4B+tbiy96Lzi8E4D7z7S0mEPd+eqO3cT53Z0Y8SV80XvB4Z0ADJi/f7X113f+7p7/+UYBvur6657/+YYBvur6657/+aYBvuL6657/+aYBvuL6657/+aYBvuL6657/+aYBvuL6657/+VMA8FXWX/f8z58OgK+y/rrnf75RgLna+uue//lTA/CV1V/3/M837aKvvv6653++UQvmauuve/7nTwfAV1N/3fM/fzr24Cuuv+75nz8FFnxl9dc9//MOr/8/glixwRuUfM4AAAAASUVORK5CYII="}function v1e(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAAAhCAAAAABIXyLAAAAAOElEQVRIx2NgGAWjYBSMglEwEICREYRgFBZBqDCSLA2MGPUIVQETE9iNUAqLR5gIeoQKRgwXjwAAGn4AtaFeYLEAAAAASUVORK5CYII="}var m1e=w(w({},Ua),{tDepth:ur("texture","rgba","ubyte","nearest"),uTexSize:qe("v2"),dOrthographic:$t("number"),uNear:qe("f"),uFar:qe("f"),uMaxPossibleViewZDiff:qe("f")});function g1e(e,t){var r=w(w({},za),{tDepth:k.create(t),uTexSize:k.create(Ge.create(t.getWidth(),t.getHeight())),dOrthographic:k.create(0),uNear:k.create(1),uFar:k.create(1e4),uMaxPossibleViewZDiff:k.create(.5)}),n=w({},m1e),a=_n("outlines",Di,Vye),i=Ca(e,"triangles",a,n,r);return xa(i,r)}var y1e=w(w({},Ua),{tDepth:ur("texture","rgba","ubyte","nearest"),uSamples:qe("v3[]"),dNSamples:$t("number"),uProjection:qe("m4"),uInvProjection:qe("m4"),uBounds:qe("v4"),uTexSize:qe("v2"),uRadius:qe("f"),uBias:qe("f")});function b1e(e,t){var r=w(w({},za),{tDepth:k.create(t),uSamples:k.create([0,0,1]),dNSamples:k.create(1),uProjection:k.create(ue.identity()),uInvProjection:k.create(ue.identity()),uBounds:k.create(Cr()),uTexSize:k.create(Ge.create(e.gl.drawingBufferWidth,e.gl.drawingBufferHeight)),uRadius:k.create(8),uBias:k.create(.025)}),n=w({},y1e),a=_n("ssao",Di,Hye),i=Ca(e,"triangles",a,n,r);return xa(i,r)}var S1e=w(w({},Ua),{tSsaoDepth:ur("texture","rgba","ubyte","nearest"),uTexSize:qe("v2"),uKernel:qe("f[]"),dOcclusionKernelSize:$t("number"),uBlurDirectionX:qe("f"),uBlurDirectionY:qe("f"),uMaxPossibleViewZDiff:qe("f"),uNear:qe("f"),uFar:qe("f"),uBounds:qe("v4"),dOrthographic:$t("number")});function sI(e,t,r){var n=w(w({},za),{tSsaoDepth:k.create(t),uTexSize:k.create(Ge.create(t.getWidth(),t.getHeight())),uKernel:k.create([0]),dOcclusionKernelSize:k.create(1),uBlurDirectionX:k.create(r==="horizontal"?1:0),uBlurDirectionY:k.create(r==="vertical"?1:0),uMaxPossibleViewZDiff:k.create(.5),uNear:k.create(0),uFar:k.create(1e4),uBounds:k.create(Cr()),dOrthographic:k.create(0)}),a=w({},S1e),i=_n("ssao_blur",Di,Gye),o=Ca(e,"triangles",i,a,n);return xa(o,n)}function x1e(e){for(var t=e/3,r=Math.floor((e+1)/2),n=[],a=0;a<r;a++)n.push(1/(Math.sqrt(2*Math.PI)*t)*Math.exp(-a*a/(2*t*t)));return n}function C1e(e,t){for(var r=[],n=0;n<t;n++){var a=(n*n+2*n+1)/(t*t);a=.1+a*(1-.1),r.push(e[n][0]*a),r.push(e[n][1]*a),r.push(e[n][2]*a)}return r}var _1e=w(w({},Ua),{tSsaoDepth:ur("texture","rgba","ubyte","nearest"),tColor:ur("texture","rgba","ubyte","nearest"),tDepth:ur("texture","rgba","ubyte","nearest"),tOutlines:ur("texture","rgba","ubyte","nearest"),uTexSize:qe("v2"),dOrthographic:$t("number"),uNear:qe("f"),uFar:qe("f"),uFogNear:qe("f"),uFogFar:qe("f"),uFogColor:qe("v3"),uTransparentBackground:qe("b"),uMaxPossibleViewZDiff:qe("f"),dOcclusionEnable:$t("boolean"),dOutlineEnable:$t("boolean"),dOutlineScale:$t("number"),uOutlineThreshold:qe("f")});function w1e(e,t,r,n,a){var i=w(w({},za),{tSsaoDepth:k.create(a),tColor:k.create(t),tDepth:k.create(r),tOutlines:k.create(n),uTexSize:k.create(Ge.create(t.getWidth(),t.getHeight())),dOrthographic:k.create(0),uNear:k.create(1),uFar:k.create(1e4),uFogNear:k.create(1e4),uFogFar:k.create(1e4),uFogColor:k.create(C.create(1,1,1)),uTransparentBackground:k.create(!1),uMaxPossibleViewZDiff:k.create(.5),dOcclusionEnable:k.create(!1),dOutlineEnable:k.create(!1),dOutlineScale:k.create(1),uOutlineThreshold:k.create(.33)}),o=w({},_1e),s=_n("postprocessing",Di,qye),u=Ca(e,"triangles",s,o,i);return xa(u,i)}var GB={occlusion:E.MappedStatic("on",{on:E.Group({samples:E.Numeric(32,{min:1,max:256,step:1}),radius:E.Numeric(5,{min:0,max:10,step:.1},{description:"Final radius is 2^x."}),bias:E.Numeric(.8,{min:0,max:3,step:.1}),blurKernelSize:E.Numeric(15,{min:1,max:25,step:2})}),off:E.Group({})},{cycle:!0,description:"Darken occluded crevices with the ambient occlusion effect"}),outline:E.MappedStatic("off",{on:E.Group({scale:E.Numeric(1,{min:1,max:5,step:1}),threshold:E.Numeric(.33,{min:.01,max:1,step:.01})}),off:E.Group({})},{cycle:!0,description:"Draw outline around 3D objects"}),antialiasing:E.MappedStatic("smaa",{fxaa:E.Group(Wye),smaa:E.Group(n1e),off:E.Group({})},{options:[["fxaa","FXAA"],["smaa","SMAA"],["off","Off"]],description:"Smooth pixel edges"})},bu=function(){function e(t,r){this.webgl=t,this.ssaoScale=this.calcSsaoScale();var n=r.colorTarget,a=r.depthTexture,i=n.getWidth(),o=n.getHeight();this.nSamples=1,this.blurKernelSize=1,this.target=t.createRenderTarget(i,o,!1,"uint8","linear"),this.outlinesTarget=t.createRenderTarget(i,o,!1),this.outlinesRenderable=g1e(t,a),this.randomHemisphereVector=[];for(var s=0;s<256;s++){var u=C();u[0]=Math.random()*2-1,u[1]=Math.random()*2-1,u[2]=Math.random(),C.normalize(u,u),C.scale(u,u,Math.random()),this.randomHemisphereVector.push(u)}this.ssaoFramebuffer=t.resources.framebuffer(),this.ssaoBlurFirstPassFramebuffer=t.resources.framebuffer(),this.ssaoBlurSecondPassFramebuffer=t.resources.framebuffer();var l=Math.floor(i*this.ssaoScale),c=Math.floor(o*this.ssaoScale);this.ssaoDepthTexture=t.resources.texture("image-uint8","rgba","ubyte","nearest"),this.ssaoDepthTexture.define(l,c),this.ssaoDepthTexture.attachFramebuffer(this.ssaoFramebuffer,"color0"),this.ssaoDepthBlurProxyTexture=t.resources.texture("image-uint8","rgba","ubyte","nearest"),this.ssaoDepthBlurProxyTexture.define(l,c),this.ssaoDepthBlurProxyTexture.attachFramebuffer(this.ssaoBlurFirstPassFramebuffer,"color0"),this.ssaoDepthTexture.attachFramebuffer(this.ssaoBlurSecondPassFramebuffer,"color0"),this.ssaoRenderable=b1e(t,a),this.ssaoBlurFirstPassRenderable=sI(t,this.ssaoDepthTexture,"horizontal"),this.ssaoBlurSecondPassRenderable=sI(t,this.ssaoDepthBlurProxyTexture,"vertical"),this.renderable=w1e(t,n.texture,a,this.outlinesTarget.texture,this.ssaoDepthTexture)}return e.isEnabled=function(t){return t.occlusion.name==="on"||t.outline.name==="on"},e.prototype.calcSsaoScale=function(){return Math.min(1,1/this.webgl.pixelRatio)},e.prototype.setSize=function(t,r){var n=this.renderable.values.uTexSize.ref.value,a=n[0],i=n[1],o=this.calcSsaoScale();if(t!==a||r!==i||this.ssaoScale!==o){this.ssaoScale=o;var s=Math.floor(t*this.ssaoScale),u=Math.floor(r*this.ssaoScale);this.target.setSize(t,r),this.outlinesTarget.setSize(t,r),this.ssaoDepthTexture.define(s,u),this.ssaoDepthBlurProxyTexture.define(s,u),k.update(this.renderable.values.uTexSize,Ge.set(this.renderable.values.uTexSize.ref.value,t,r)),k.update(this.outlinesRenderable.values.uTexSize,Ge.set(this.outlinesRenderable.values.uTexSize.ref.value,t,r)),k.update(this.ssaoRenderable.values.uTexSize,Ge.set(this.ssaoRenderable.values.uTexSize.ref.value,s,u)),k.update(this.ssaoBlurFirstPassRenderable.values.uTexSize,Ge.set(this.ssaoBlurFirstPassRenderable.values.uTexSize.ref.value,s,u)),k.update(this.ssaoBlurSecondPassRenderable.values.uTexSize,Ge.set(this.ssaoBlurSecondPassRenderable.values.uTexSize.ref.value,s,u))}},e.prototype.updateState=function(t,r,n,a){var i=!1,o=!1,s=!1,u=t.state.mode==="orthographic"?1:0,l=a.outline.name==="on",c=a.occlusion.name==="on",d=ue.identity();if(ue.invert(d,t.projection),a.occlusion.name==="on"){k.update(this.ssaoRenderable.values.uProjection,t.projection),k.update(this.ssaoRenderable.values.uInvProjection,d);var f=this.renderable.values.uTexSize.ref.value,p=f[0],h=f[1],v=this.ssaoRenderable.values.uBounds,m=t.viewport,g=this.ssaoScale;if(Cr.set(v.ref.value,Math.floor(m.x*g)/(p*g),Math.floor(m.y*g)/(h*g),Math.ceil((m.x+m.width)*g)/(p*g),Math.ceil((m.y+m.height)*g)/(h*g)),k.update(v,v.ref.value),k.update(this.ssaoBlurFirstPassRenderable.values.uBounds,v.ref.value),k.update(this.ssaoBlurSecondPassRenderable.values.uBounds,v.ref.value),k.updateIfChanged(this.ssaoBlurFirstPassRenderable.values.uNear,t.near),k.updateIfChanged(this.ssaoBlurSecondPassRenderable.values.uNear,t.near),k.updateIfChanged(this.ssaoBlurFirstPassRenderable.values.uFar,t.far),k.updateIfChanged(this.ssaoBlurSecondPassRenderable.values.uFar,t.far),this.ssaoBlurFirstPassRenderable.values.dOrthographic.ref.value!==u&&(s=!0),k.updateIfChanged(this.ssaoBlurFirstPassRenderable.values.dOrthographic,u),k.updateIfChanged(this.ssaoBlurSecondPassRenderable.values.dOrthographic,u),this.nSamples!==a.occlusion.params.samples&&(o=!0,this.nSamples=a.occlusion.params.samples,k.update(this.ssaoRenderable.values.uSamples,C1e(this.randomHemisphereVector,this.nSamples)),k.updateIfChanged(this.ssaoRenderable.values.dNSamples,this.nSamples)),k.updateIfChanged(this.ssaoRenderable.values.uRadius,Math.pow(2,a.occlusion.params.radius)),k.updateIfChanged(this.ssaoRenderable.values.uBias,a.occlusion.params.bias),this.blurKernelSize!==a.occlusion.params.blurKernelSize){s=!0,this.blurKernelSize=a.occlusion.params.blurKernelSize;var y=x1e(this.blurKernelSize);k.update(this.ssaoBlurFirstPassRenderable.values.uKernel,y),k.update(this.ssaoBlurSecondPassRenderable.values.uKernel,y),k.updateIfChanged(this.ssaoBlurFirstPassRenderable.values.dOcclusionKernelSize,this.blurKernelSize),k.updateIfChanged(this.ssaoBlurSecondPassRenderable.values.dOcclusionKernelSize,this.blurKernelSize)}}if(a.outline.name==="on"){var b=a.outline.params.threshold;t.state.mode==="orthographic"&&(b/=5);var x=Math.pow(1e3,b)/1e3,S=x*t.state.radiusMax,_=a.outline.params.scale-1;k.updateIfChanged(this.outlinesRenderable.values.uNear,t.near),k.updateIfChanged(this.outlinesRenderable.values.uFar,t.far),k.updateIfChanged(this.outlinesRenderable.values.uMaxPossibleViewZDiff,S),k.updateIfChanged(this.renderable.values.uMaxPossibleViewZDiff,S),this.renderable.values.dOutlineScale.ref.value!==_&&(i=!0),k.updateIfChanged(this.renderable.values.dOutlineScale,_)}k.updateIfChanged(this.renderable.values.uFar,t.far),k.updateIfChanged(this.renderable.values.uNear,t.near),k.updateIfChanged(this.renderable.values.uFogFar,t.fogFar),k.updateIfChanged(this.renderable.values.uFogNear,t.fogNear),k.update(this.renderable.values.uFogColor,it.toVec3Normalized(this.renderable.values.uFogColor.ref.value,n)),k.updateIfChanged(this.renderable.values.uTransparentBackground,r),this.renderable.values.dOrthographic.ref.value!==u&&(i=!0),k.updateIfChanged(this.renderable.values.dOrthographic,u),this.renderable.values.dOutlineEnable.ref.value!==l&&(i=!0),k.updateIfChanged(this.renderable.values.dOutlineEnable,l),this.renderable.values.dOcclusionEnable.ref.value!==c&&(i=!0),k.updateIfChanged(this.renderable.values.dOcclusionEnable,c),o&&this.ssaoRenderable.update(),s&&(this.ssaoBlurFirstPassRenderable.update(),this.ssaoBlurSecondPassRenderable.update()),i&&this.renderable.update();var A=this.webgl,T=A.gl,I=A.state;I.enable(T.SCISSOR_TEST),I.disable(T.BLEND),I.disable(T.DEPTH_TEST),I.depthMask(!1);var M=t.viewport,O=M.x,D=M.y,F=M.width,G=M.height;T.viewport(O,D,F,G),T.scissor(O,D,F,G)},e.prototype.render=function(t,r,n,a,i){if(this.updateState(t,n,a,i),i.outline.name==="on"&&(this.outlinesTarget.bind(),this.outlinesRenderable.render()),i.occlusion.name==="on"){var o=t.viewport,s=o.x,u=o.y,l=o.width,c=o.height,d=Math.floor(s*this.ssaoScale),f=Math.floor(u*this.ssaoScale),p=Math.ceil(l*this.ssaoScale),h=Math.ceil(c*this.ssaoScale);this.webgl.gl.viewport(d,f,p,h),this.webgl.gl.scissor(d,f,p,h),this.ssaoFramebuffer.bind(),this.ssaoRenderable.render(),this.ssaoBlurFirstPassFramebuffer.bind(),this.ssaoBlurFirstPassRenderable.render(),this.ssaoBlurSecondPassFramebuffer.bind(),this.ssaoBlurSecondPassRenderable.render(),this.webgl.gl.viewport(s,u,l,c),this.webgl.gl.scissor(s,u,l,c)}r?this.webgl.unbindFramebuffer():this.target.bind();var v=this.webgl,m=v.gl,g=v.state;g.clearColor(0,0,0,1),m.clear(m.COLOR_BUFFER_BIT),this.renderable.render()},e}(),L2=function(){function e(t,r){this.drawPass=r;var n=r.colorTarget,a=n.getWidth(),i=n.getHeight();this.target=t.createRenderTarget(a,i,!1),this.fxaa=new Xye(t,this.target.texture),this.smaa=new a1e(t,this.target.texture)}return e.isEnabled=function(t){return t.antialiasing.name!=="off"},e.prototype.setSize=function(t,r){var n=this.target.texture.getWidth(),a=this.target.texture.getHeight();(t!==n||r!==a)&&(this.target.setSize(t,r),this.fxaa.setSize(t,r),this.smaa.supported&&this.smaa.setSize(t,r))},e.prototype._renderFxaa=function(t,r,n){if(n.antialiasing.name==="fxaa"){var a=bu.isEnabled(n)?this.drawPass.postprocessing.target.texture:this.drawPass.colorTarget.texture;this.fxaa.update(a,n.antialiasing.params),this.fxaa.render(t.viewport,r?void 0:this.target)}},e.prototype._renderSmaa=function(t,r,n){if(n.antialiasing.name==="smaa"){var a=bu.isEnabled(n)?this.drawPass.postprocessing.target.texture:this.drawPass.colorTarget.texture;this.smaa.update(a,n.antialiasing.params),this.smaa.render(t.viewport,r?void 0:this.target)}},e.prototype.render=function(t,r,n){if(n.antialiasing.name!=="off"){if(n.antialiasing.name==="fxaa")this._renderFxaa(t,r,n);else if(n.antialiasing.name==="smaa"){if(!this.smaa.supported)throw new Error('SMAA not supported, missing "HTMLImageElement"');this._renderSmaa(t,r,n)}}},e}(),A1e=`
precision highp float;
precision highp sampler2D;

uniform sampler2D tColor;
uniform vec2 uTexSize;
uniform float uWeight;

void main() {
    vec2 coords = gl_FragCoord.xy / uTexSize;
    gl_FragColor = texture2D(tColor, coords) * uWeight;
}
`,P1e=w(w({},Ua),{tColor:ur("texture","rgba","ubyte","nearest"),uTexSize:qe("v2"),uWeight:qe("f")}),T1e=_n("compose",Di,A1e);function E1e(e,t){var r=w(w({},za),{tColor:k.create(t),uTexSize:k.create(Ge.create(t.getWidth(),t.getHeight())),uWeight:k.create(1)}),n=w({},P1e),a=Ca(e,"triangles",T1e,n,r);return xa(a,r)}var qB={mode:E.Select("off",[["off","Off"],["on","On"],["temporal","Temporal"]]),sampleLevel:E.Numeric(2,{min:0,max:5,step:1})},$g=function(){function e(t,r){this.webgl=t,this.drawPass=r;var n=t.extensions,a=n.colorBufferFloat,i=n.textureFloat,o=n.colorBufferHalfFloat,s=n.textureHalfFloat,u=r.colorTarget.getWidth(),l=r.colorTarget.getHeight();this.colorTarget=t.createRenderTarget(u,l,!1);var c=o&&s?"fp16":a&&i?"float32":"uint8";this.composeTarget=t.createRenderTarget(u,l,!1,c),this.holdTarget=t.createRenderTarget(u,l,!1),this.compose=E1e(t,r.colorTarget.texture)}return e.isEnabled=function(t){return t.mode!=="off"},e.prototype.syncSize=function(){var t=this.drawPass.colorTarget.getWidth(),r=this.drawPass.colorTarget.getHeight(),n=this.compose.values.uTexSize.ref.value,a=n[0],i=n[1];(t!==a||r!==i)&&(this.colorTarget.setSize(t,r),this.composeTarget.setSize(t,r),this.holdTarget.setSize(t,r),k.update(this.compose.values.uTexSize,Ge.set(this.compose.values.uTexSize.ref.value,t,r)))},e.prototype.render=function(t,r,n,a,i,o,s,u){return u.multiSample.mode==="temporal"?this.renderTemporalMultiSample(t,r,n,a,i,o,s,u):(this.renderMultiSample(r,n,a,i,o,s,u),t)},e.prototype.bindOutputTarget=function(t){t?this.webgl.unbindFramebuffer():this.colorTarget.bind()},e.prototype.renderMultiSample=function(t,r,n,a,i,o,s){var u=this,l=u.compose,c=u.composeTarget,d=u.drawPass,f=u.webgl,p=f.gl,h=f.state,v=LC[Math.max(0,Math.min(s.multiSample.sampleLevel,5))],m=r.viewport,g=m.x,y=m.y,b=m.width,x=m.height,S=1/v.length,_=1/32;r.viewOffset.enabled=!0,k.update(l.values.tColor,d.getColorTarget(s.postprocessing).texture),l.update();for(var A=0;A<v.length;++A){var T=v[A];Gn.setViewOffset(r.viewOffset,b,x,T[0],T[1],b,x),r.update();var I=-.5+(A+.5)/v.length,M=S+_*I;k.update(l.values.uWeight,M),d.render(t,r,n,a,!1,o,s.postprocessing),c.bind(),h.enable(p.BLEND),h.blendEquationSeparate(p.FUNC_ADD,p.FUNC_ADD),h.blendFuncSeparate(p.ONE,p.ONE,p.ONE,p.ONE),h.disable(p.DEPTH_TEST),h.depthMask(!1),p.viewport(g,y,b,x),p.scissor(g,y,b,x),A===0&&(h.clearColor(0,0,0,0),p.clear(p.COLOR_BUFFER_BIT)),l.render()}k.update(l.values.uWeight,1),k.update(l.values.tColor,c.texture),l.update(),this.bindOutputTarget(i),p.viewport(g,y,b,x),p.scissor(g,y,b,x),h.disable(p.BLEND),l.render(),r.viewOffset.enabled=!1,r.update()},e.prototype.renderTemporalMultiSample=function(t,r,n,a,i,o,s,u){var l=this,c=l.compose,d=l.composeTarget,f=l.holdTarget,p=l.drawPass,h=l.webgl,v=h.gl,m=h.state,g=LC[Math.max(0,Math.min(u.multiSample.sampleLevel,5))];if(t===-2||t>=g.length)return-2;var y=n.viewport,b=y.x,x=y.y,S=y.width,_=y.height,A=1/g.length;if(t===-1)p.render(r,n,a,i,!1,s,u.postprocessing),k.update(c.values.uWeight,1),k.update(c.values.tColor,p.getColorTarget(u.postprocessing).texture),c.update(),f.bind(),m.disable(v.BLEND),m.disable(v.DEPTH_TEST),m.depthMask(!1),v.viewport(b,x,S,_),v.scissor(b,x,S,_),c.render(),t+=1;else{n.viewOffset.enabled=!0,k.update(c.values.tColor,p.getColorTarget(u.postprocessing).texture),k.update(c.values.uWeight,A),c.update();for(var T=Math.pow(2,Math.max(0,u.multiSample.sampleLevel-2)),I=0;I<T;++I){var M=g[t];if(Gn.setViewOffset(n.viewOffset,S,_,M[0],M[1],S,_),n.update(),p.render(r,n,a,i,!1,s,u.postprocessing),d.bind(),m.enable(v.BLEND),m.blendEquationSeparate(v.FUNC_ADD,v.FUNC_ADD),m.blendFuncSeparate(v.ONE,v.ONE,v.ONE,v.ONE),m.disable(v.DEPTH_TEST),m.depthMask(!1),v.viewport(b,x,S,_),v.scissor(b,x,S,_),t===0&&(m.clearColor(0,0,0,0),v.clear(v.COLOR_BUFFER_BIT)),c.render(),t+=1,t>=g.length)break}}this.bindOutputTarget(o),v.viewport(b,x,S,_),v.scissor(b,x,S,_);var O=t*A;return O>0&&(k.update(c.values.uWeight,1),k.update(c.values.tColor,d.texture),c.update(),m.disable(v.BLEND),c.render()),O<1&&(k.update(c.values.uWeight,1-O),k.update(c.values.tColor,f.texture),c.update(),O===0?m.disable(v.BLEND):m.enable(v.BLEND),c.render()),n.viewOffset.enabled=!1,n.update(),t>=g.length?-2:t},e}(),LC=[[[0,0]],[[4,4],[-4,-4]],[[-2,-6],[6,-2],[-6,2],[2,6]],[[1,-3],[-1,3],[5,1],[-3,-5],[-5,5],[-7,-1],[3,7],[7,-7]],[[1,1],[-1,-3],[-3,2],[4,-1],[-5,-2],[2,5],[5,3],[3,-5],[-2,6],[0,-7],[-4,-6],[-6,4],[-8,0],[7,-4],[6,7],[-7,-8]],[[-4,-7],[-7,-5],[-3,-5],[-5,-4],[-1,-4],[-2,-2],[-6,-1],[-4,0],[-7,1],[-1,2],[-6,3],[-3,3],[-7,6],[-3,6],[-5,7],[-1,7],[5,-7],[1,-6],[6,-5],[4,-4],[2,-3],[7,-2],[1,-1],[4,-1],[2,1],[6,2],[0,4],[4,4],[2,5],[7,5],[5,6],[3,7]]];LC.forEach(function(e){e.forEach(function(t){t[0]*=.0625,t[1]*=.0625})});var jB=function(){function e(t){this.multiSamplePass=t,this.sampleIndex=-2}return e.prototype.update=function(t,r){return t&&(this.sampleIndex=-1),r.mode==="temporal"?this.sampleIndex!==-2:!1},e.prototype.render=function(t,r,n,a,i,o,s){this.sampleIndex=this.multiSamplePass.render(this.sampleIndex,t,r,n,a,i,o,s)},e}(),WB={eyeSeparation:E.Numeric(.064,{min:.01,max:.5,step:.001}),focus:E.Numeric(10,{min:1,max:100,step:.01})},I1e=E.getDefaultValues(WB),Sp=function(){function e(t,r){r===void 0&&(r={}),this.parent=t,this.left=new uI,this.right=new uI,this.props=w(w({},I1e),r)}return Object.defineProperty(e.prototype,"viewport",{get:function(){return this.parent.viewport},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"viewOffset",{get:function(){return this.parent.viewOffset},enumerable:!1,configurable:!0}),e.prototype.setProps=function(t){Object.assign(this.props,t)},e.prototype.update=function(){this.parent.update(),M1e(this.parent,this.props,this.left,this.right)},e}();(function(e){function t(r){return"left"in r&&"right"in r}e.is=t})(Sp||(Sp={}));var uI=function(){function e(){this.viewport=ga.create(0,0,0,0),this.view=ue(),this.projection=ue(),this.projectionView=ue(),this.inverseProjectionView=ue(),this.state=Gn.createDefaultSnapshot(),this.viewOffset=Gn.ViewOffset(),this.far=0,this.near=0,this.fogFar=0,this.fogNear=0}return e}(),lI=ue.identity(),cI=ue.identity();function M1e(e,t,r,n){ga.copy(r.viewport,e.viewport),ue.copy(r.view,e.view),ue.copy(r.projection,e.projection),Gn.copySnapshot(r.state,e.state),Gn.copyViewOffset(r.viewOffset,e.viewOffset),r.far=e.far,r.near=e.near,r.fogFar=e.fogFar,r.fogNear=e.fogNear,ga.copy(n.viewport,e.viewport),ue.copy(n.view,e.view),ue.copy(n.projection,e.projection),Gn.copySnapshot(n.state,e.state),Gn.copyViewOffset(n.viewOffset,e.viewOffset),n.far=e.far,n.near=e.near,n.fogFar=e.fogFar,n.fogNear=e.fogNear;var a=Math.floor(e.viewport.width/2),i=a/e.viewport.height;r.viewport.width=a,n.viewport.x+=a,n.viewport.width-=a;var o=t.eyeSeparation/2,s=o*e.near/t.focus,u=e.near*Math.tan(e.state.fov*.5),l,c;lI[12]=-o,cI[12]=o,l=-u*i+s,c=u*i+s,r.projection[0]=2*e.near/(c-l),r.projection[8]=(c+l)/(c-l),ue.mul(r.view,r.view,lI),ue.mul(r.projectionView,r.projection,r.view),ue.invert(r.inverseProjectionView,r.projectionView),l=-u*i-s,c=u*i-s,n.projection[0]=2*e.near/(c-l),n.projection[8]=(c+l)/(c-l),ue.mul(n.view,n.view,cI),ue.mul(n.projectionView,n.projection,n.view),ue.invert(n.inverseProjectionView,n.projectionView)}var N2=Math.pow(2,24)-2,D1e=function(){function e(t,r,n){this.webgl=t,this.drawPass=r,this.pickBaseScale=n;var a=n/t.pixelRatio;this.pickWidth=Math.ceil(r.colorTarget.getWidth()*a),this.pickHeight=Math.ceil(r.colorTarget.getHeight()*a),this.objectPickTarget=t.createRenderTarget(this.pickWidth,this.pickHeight),this.instancePickTarget=t.createRenderTarget(this.pickWidth,this.pickHeight),this.groupPickTarget=t.createRenderTarget(this.pickWidth,this.pickHeight),this.depthPickTarget=t.createRenderTarget(this.pickWidth,this.pickHeight)}return Object.defineProperty(e.prototype,"drawingBufferHeight",{get:function(){return this.drawPass.colorTarget.getHeight()},enumerable:!1,configurable:!0}),e.prototype.syncSize=function(){var t=this.pickBaseScale/this.webgl.pixelRatio,r=Math.ceil(this.drawPass.colorTarget.getWidth()*t),n=Math.ceil(this.drawPass.colorTarget.getHeight()*t);(r!==this.pickWidth||n!==this.pickHeight)&&(this.pickWidth=r,this.pickHeight=n,this.objectPickTarget.setSize(this.pickWidth,this.pickHeight),this.instancePickTarget.setSize(this.pickWidth,this.pickHeight),this.groupPickTarget.setSize(this.pickWidth,this.pickHeight),this.depthPickTarget.setSize(this.pickWidth,this.pickHeight))},e.prototype.renderVariant=function(t,r,n,a,i){var o=this.drawPass.depthTexturePrimitives;t.clear(!1),t.update(r),t.renderPick(n.primitives,r,i,null),t.renderPick(n.volumes,r,i,o),t.renderPick(a.handle.scene,r,i,null),a.camera.isEnabled&&(a.camera.update(r),t.update(a.camera.camera),t.renderPick(a.camera.scene,a.camera.camera,i,null))},e.prototype.render=function(t,r,n,a){this.objectPickTarget.bind(),this.renderVariant(t,r,n,a,"pickObject"),this.instancePickTarget.bind(),this.renderVariant(t,r,n,a,"pickInstance"),this.groupPickTarget.bind(),this.renderVariant(t,r,n,a,"pickGroup"),this.depthPickTarget.bind(),this.renderVariant(t,r,n,a,"depth")},e}(),R1e=function(){function e(t,r,n,a,i,o){this.webgl=t,this.renderer=r,this.scene=n,this.helper=a,this.pickPass=i,this.dirty=!0,this.viewport=ga(),this.setViewport(o.x,o.y,o.width,o.height)}return e.prototype.setupBuffers=function(){var t=this.pickWidth*this.pickHeight*4;(!this.objectBuffer||this.objectBuffer.length!==t)&&(this.objectBuffer=new Uint8Array(t),this.instanceBuffer=new Uint8Array(t),this.groupBuffer=new Uint8Array(t),this.depthBuffer=new Uint8Array(t))},e.prototype.setViewport=function(t,r,n,a){ga.set(this.viewport,t,r,n,a),this.pickScale=this.pickPass.pickBaseScale/this.webgl.pixelRatio,this.pickX=Math.ceil(t*this.pickScale),this.pickY=Math.ceil(r*this.pickScale);var i=Math.floor(n*this.pickScale),o=Math.floor(a*this.pickScale);(i!==this.pickWidth||o!==this.pickHeight)&&(this.pickWidth=i,this.pickHeight=o,this.halfPickWidth=Math.floor(this.pickWidth/2),this.setupBuffers())},e.prototype.syncBuffers=function(){var t=this,r=t.pickX,n=t.pickY,a=t.pickWidth,i=t.pickHeight;this.pickPass.objectPickTarget.bind(),this.webgl.readPixels(r,n,a,i,this.objectBuffer),this.pickPass.instancePickTarget.bind(),this.webgl.readPixels(r,n,a,i,this.instanceBuffer),this.pickPass.groupPickTarget.bind(),this.webgl.readPixels(r,n,a,i,this.groupBuffer),this.pickPass.depthPickTarget.bind(),this.webgl.readPixels(r,n,a,i,this.depthBuffer)},e.prototype.getBufferIdx=function(t,r){return(r*this.pickWidth+t)*4},e.prototype.getDepth=function(t,r){var n=this.getBufferIdx(t,r),a=this.depthBuffer;return Eae(a[n],a[n+1],a[n+2],a[n+3])},e.prototype.getId=function(t,r,n){var a=this.getBufferIdx(t,r);return h3(n[a],n[a+1],n[a+2])},e.prototype.render=function(t){var r=this,n=r.pickX,a=r.pickY,i=r.pickWidth,o=r.pickHeight,s=r.halfPickWidth,u=this,l=u.renderer,c=u.scene,d=u.helper;l.setTransparentBackground(!1),l.setDrawingBufferSize(this.pickPass.objectPickTarget.getWidth(),this.pickPass.objectPickTarget.getHeight()),Sp.is(t)?(l.setViewport(n,a,s,o),this.pickPass.render(l,t.left,c,d),l.setViewport(n+s,a,i-s,o),this.pickPass.render(l,t.right,c,d)):(l.setViewport(n,a,i,o),this.pickPass.render(l,t,c,d)),this.dirty=!1},e.prototype.identify=function(t,r,n){var a=this,i=a.webgl,o=a.pickScale;if(!i.isContextLost){t*=i.pixelRatio,r*=i.pixelRatio,r=this.pickPass.drawingBufferHeight-r;var s=this.viewport;if(!(t<s.x||r<s.y||t>s.x+s.width||r>s.y+s.height)){this.dirty&&(this.render(n),this.syncBuffers());var u=t-s.x,l=r-s.y,c=Math.floor(u*o),d=Math.floor(l*o),f=this.getId(c,d,this.objectBuffer);if(!(f===-1||f===N2)){var p=this.getId(c,d,this.instanceBuffer);if(!(p===-1||p===N2)){var h=this.getId(c,d,this.groupBuffer);if(!(h===-1||h===N2)){var v=this.getDepth(c,d),m=C.create(t,s.height-r,v);if(Sp.is(n)){var g=Math.floor(s.width/2);t>s.x+g?(m[0]=s.x+(u-g)*2,F0(m,m,s,n.right.inverseProjectionView)):(m[0]=s.x+u*2,F0(m,m,s,n.left.inverseProjectionView))}else F0(m,m,s,n.inverseProjectionView);return{id:{objectId:f,instanceId:p,groupId:h},position:m}}}}}}},e}(),O1e=`
precision highp float;
precision highp sampler2D;

uniform sampler2D tDepthPrimitives;
uniform sampler2D tDepthVolumes;
uniform vec2 uTexSize;

#include common

float getDepth(const in vec2 coords, sampler2D tDepth) {
    #ifdef dPackedDepth
        return unpackRGBAToDepth(texture2D(tDepth, coords));
    #else
        return texture2D(tDepth, coords).r;
    #endif
}

void main() {
    vec2 coords = gl_FragCoord.xy / uTexSize;
    float depth = min(getDepth(coords, tDepthPrimitives), getDepth(coords, tDepthVolumes));
    gl_FragColor = packDepthToRGBA(depth);
}
`,F1e=`
precision highp float;
precision highp sampler2D;

uniform sampler2D tColor;
uniform vec2 uTexSize;

void main() {
    vec2 coords = gl_FragCoord.xy / uTexSize;
    gl_FragColor = texture2D(tColor, coords);
}
`,k1e=`
precision highp float;

uniform sampler2D tWboitA;
uniform sampler2D tWboitB;
uniform vec2 uTexSize;

void main() {
    vec2 coords = gl_FragCoord.xy / uTexSize;

    vec4 accum = texture2D(tWboitA, coords);
    float r = 1.0 - accum.a;

    accum.a = texture2D(tWboitB, coords).r;
    // divisor needs to allow very small values for nice fading
    gl_FragColor = vec4(accum.rgb / clamp(accum.a, 0.00000001, 50000.0), r);
}
`,B1e=w(w({},Ua),{tWboitA:ur("texture","rgba","float","nearest"),tWboitB:ur("texture","rgba","float","nearest"),uTexSize:qe("v2")}),L1e=_n("evaluate-wboit",Di,k1e);function N1e(e,t,r){var n=w(w({},za),{tWboitA:k.create(t),tWboitB:k.create(r),uTexSize:k.create(Ge.create(t.getWidth(),t.getHeight()))}),a=w({},B1e),i=Ca(e,"triangles",L1e,a,n);return xa(i,n)}var U1e=function(){function e(t,r,n){if(this.webgl=t,this._supported=!1,!!e.isSupported(t)){var a=t.resources;this.textureA=a.texture("image-float32","rgba","float","nearest"),this.textureA.define(r,n),this.textureB=a.texture("image-float32","rgba","float","nearest"),this.textureB.define(r,n),this.renderable=N1e(t,this.textureA,this.textureB),this.framebuffer=a.framebuffer(),this._supported=!0,this._init()}}return Object.defineProperty(e.prototype,"supported",{get:function(){return this._supported},enumerable:!1,configurable:!0}),e.prototype.bind=function(){var t=this.webgl,r=t.state,n=t.gl;this.framebuffer.bind(),r.clearColor(0,0,0,1),n.clear(n.COLOR_BUFFER_BIT),r.disable(n.DEPTH_TEST),r.blendFuncSeparate(n.ONE,n.ONE,n.ZERO,n.ONE_MINUS_SRC_ALPHA),r.enable(n.BLEND)},e.prototype.render=function(){var t=this.webgl,r=t.state,n=t.gl;r.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA),r.enable(n.BLEND),this.renderable.update(),this.renderable.render()},e.prototype.setSize=function(t,r){var n=this.renderable.values.uTexSize.ref.value,a=n[0],i=n[1];(t!==a||r!==i)&&(this.textureA.define(t,r),this.textureB.define(t,r),k.update(this.renderable.values.uTexSize,Ge.set(this.renderable.values.uTexSize.ref.value,t,r)))},e.prototype.reset=function(){this._supported&&this._init()},e.prototype._init=function(){var t=this.webgl.extensions.drawBuffers;this.framebuffer.bind(),t.drawBuffers([t.COLOR_ATTACHMENT0,t.COLOR_ATTACHMENT1]),this.textureA.attachFramebuffer(this.framebuffer,"color0"),this.textureB.attachFramebuffer(this.framebuffer,"color1")},e.isSupported=function(t){var r=t.extensions,n=r.drawBuffers,a=r.textureFloat,i=r.colorBufferFloat,o=r.depthTexture;if(!a||!i||!o||!n){if(Ir){var s=[];a||s.push("textureFloat"),i||s.push("colorBufferFloat"),o||s.push("depthTexture"),n||s.push("drawBuffers"),console.log('Missing "'+s.join('", "')+'" extensions required for "wboit"')}return!1}else return!0},e}(),z1e=w(w({},Ua),{tDepthPrimitives:ur("texture","depth","ushort","nearest"),tDepthVolumes:ur("texture","depth","ushort","nearest"),uTexSize:qe("v2"),dPackedDepth:$t("boolean")}),V1e=_n("depth-merge",Di,O1e);function H1e(e,t,r,n){var a=w(w({},za),{tDepthPrimitives:k.create(t),tDepthVolumes:k.create(r),uTexSize:k.create(Ge.create(t.getWidth(),t.getHeight())),dPackedDepth:k.create(n)}),i=w({},z1e),o=Ca(e,"triangles",V1e,i,a);return xa(o,a)}var G1e=w(w({},Ua),{tColor:ur("texture","rgba","ubyte","nearest"),uTexSize:qe("v2")}),q1e=_n("copy",Di,F1e);function dI(e,t){var r=w(w({},za),{tColor:k.create(t),uTexSize:k.create(Ge.create(t.getWidth(),t.getHeight()))}),n=w({},G1e),a=Ca(e,"triangles",q1e,n,r);return xa(a,r)}var XB=function(){function e(t,r,n,a){this.webgl=t;var i=t.extensions,o=t.resources,s=t.isWebGL2;this.drawTarget=dse(t.gl),this.colorTarget=t.createRenderTarget(r,n,!0,"uint8","linear"),this.packedDepth=!i.depthTexture,this.depthTarget=t.createRenderTarget(r,n),this.depthTexture=this.depthTarget.texture,this.depthTargetPrimitives=this.packedDepth?t.createRenderTarget(r,n):null,this.depthTargetVolumes=this.packedDepth?t.createRenderTarget(r,n):null,this.depthTexturePrimitives=this.depthTargetPrimitives?this.depthTargetPrimitives.texture:o.texture("image-depth","depth",s?"float":"ushort","nearest"),this.depthTextureVolumes=this.depthTargetVolumes?this.depthTargetVolumes.texture:o.texture("image-depth","depth",s?"float":"ushort","nearest"),this.packedDepth||(this.depthTexturePrimitives.define(r,n),this.depthTextureVolumes.define(r,n)),this.depthMerge=H1e(t,this.depthTexturePrimitives,this.depthTextureVolumes,this.packedDepth),this.wboit=a?new U1e(t,r,n):void 0,this.postprocessing=new bu(t,this),this.antialiasing=new L2(t,this),this.copyFboTarget=dI(t,this.colorTarget.texture),this.copyFboPostprocessing=dI(t,this.postprocessing.target.texture)}return Object.defineProperty(e.prototype,"wboitEnabled",{get:function(){var t;return!!(!((t=this.wboit)===null||t===void 0)&&t.supported)},enumerable:!1,configurable:!0}),e.prototype.reset=function(){var t;(t=this.wboit)===null||t===void 0||t.reset()},e.prototype.setSize=function(t,r){var n,a=this.colorTarget.getWidth(),i=this.colorTarget.getHeight();(t!==a||r!==i)&&(this.colorTarget.setSize(t,r),this.depthTarget.setSize(t,r),this.depthTargetPrimitives?this.depthTargetPrimitives.setSize(t,r):this.depthTexturePrimitives.define(t,r),this.depthTargetVolumes?this.depthTargetVolumes.setSize(t,r):this.depthTextureVolumes.define(t,r),k.update(this.depthMerge.values.uTexSize,Ge.set(this.depthMerge.values.uTexSize.ref.value,t,r)),k.update(this.copyFboTarget.values.uTexSize,Ge.set(this.copyFboTarget.values.uTexSize.ref.value,t,r)),k.update(this.copyFboPostprocessing.values.uTexSize,Ge.set(this.copyFboPostprocessing.values.uTexSize.ref.value,t,r)),!((n=this.wboit)===null||n===void 0)&&n.supported&&this.wboit.setSize(t,r),this.postprocessing.setSize(t,r),this.antialiasing.setSize(t,r))},e.prototype._depthMerge=function(){var t=this.webgl,r=t.state,n=t.gl;this.depthMerge.update(),this.depthTarget.bind(),r.disable(n.BLEND),r.disable(n.DEPTH_TEST),r.disable(n.CULL_FACE),r.depthMask(!1),r.clearColor(1,1,1,1),n.clear(n.COLOR_BUFFER_BIT),this.depthMerge.render()},e.prototype._renderWboit=function(t,r,n,a,i){var o;if(!(!((o=this.wboit)===null||o===void 0)&&o.supported))throw new Error("expected wboit to be supported");this.colorTarget.bind(),t.clear(!0),this.depthTexturePrimitives.attachFramebuffer(this.colorTarget.framebuffer,"depth"),this.colorTarget.bind(),t.clearDepth(),t.renderWboitOpaque(n.primitives,r,null),this.depthTextureVolumes.attachFramebuffer(this.colorTarget.framebuffer,"depth"),this.colorTarget.bind(),t.clearDepth(),t.renderWboitOpaque(n.volumes,r,this.depthTexturePrimitives),this._depthMerge(),bu.isEnabled(i)&&this.postprocessing.render(r,!1,a,t.props.backgroundColor,i),this.wboit.bind(),t.renderWboitTransparent(n.primitives,r,this.depthTexture),t.renderWboitTransparent(n.volumes,r,this.depthTexture),bu.isEnabled(i)?(this.depthTexturePrimitives.attachFramebuffer(this.postprocessing.target.framebuffer,"depth"),this.postprocessing.target.bind()):(this.depthTexturePrimitives.attachFramebuffer(this.colorTarget.framebuffer,"depth"),this.colorTarget.bind()),this.wboit.render()},e.prototype._renderBlended=function(t,r,n,a,i,o){if(a?this.drawTarget.bind():(this.colorTarget.bind(),this.packedDepth||this.depthTexturePrimitives.attachFramebuffer(this.colorTarget.framebuffer,"depth")),t.clear(!0),t.renderBlendedOpaque(n.primitives,r,null),!a){this.depthTargetPrimitives&&(this.depthTargetPrimitives.bind(),t.clear(!1),t.renderDepth(n.primitives,r,null),this.colorTarget.bind()),this.packedDepth||(this.depthTextureVolumes.attachFramebuffer(this.colorTarget.framebuffer,"depth"),t.clearDepth()),t.renderBlendedVolumeOpaque(n.volumes,r,this.depthTexturePrimitives),this.depthTargetVolumes&&(this.depthTargetVolumes.bind(),t.clear(!1),t.renderDepth(n.volumes,r,this.depthTexturePrimitives),this.colorTarget.bind()),this._depthMerge(),this.colorTarget.bind(),bu.isEnabled(o)&&this.postprocessing.render(r,!1,i,t.props.backgroundColor,o),t.renderBlendedVolumeTransparent(n.volumes,r,this.depthTexturePrimitives);var s=bu.isEnabled(o)?this.postprocessing.target:this.colorTarget;this.packedDepth||this.depthTexturePrimitives.attachFramebuffer(s.framebuffer,"depth"),s.bind()}t.renderBlendedTransparent(n.primitives,r,null)},e.prototype._render=function(t,r,n,a,i,o,s){var u=n.volumes.renderables.length>0,l=bu.isEnabled(s),c=L2.isEnabled(s),d=r.viewport,f=d.x,p=d.y,h=d.width,v=d.height;t.setViewport(f,p,h,v),t.update(r),o&&!c&&i&&(this.drawTarget.bind(),t.clear(!1)),this.wboitEnabled?this._renderWboit(t,r,n,o,s):this._renderBlended(t,r,n,!u&&!l&&!c&&i,o,s),l?this.postprocessing.target.bind():!i||u||this.wboitEnabled?this.colorTarget.bind():this.drawTarget.bind(),a.debug.isEnabled&&(a.debug.syncVisibility(),t.renderBlended(a.debug.scene,r,null)),a.handle.isEnabled&&t.renderBlended(a.handle.scene,r,null),a.camera.isEnabled&&(a.camera.update(r),t.update(a.camera.camera),t.renderBlended(a.camera.scene,a.camera.camera,null)),c?this.antialiasing.render(r,i,s):i&&(this.drawTarget.bind(),this.webgl.state.disable(this.webgl.gl.DEPTH_TEST),l?this.copyFboPostprocessing.render():(u||this.wboitEnabled)&&this.copyFboTarget.render()),this.webgl.gl.flush()},e.prototype.render=function(t,r,n,a,i,o,s){t.setTransparentBackground(o),t.setDrawingBufferSize(this.colorTarget.getWidth(),this.colorTarget.getHeight()),Sp.is(r)?(this._render(t,r.left,n,a,i,o,s),this._render(t,r.right,n,a,i,o,s)):this._render(t,r,n,a,i,o,s)},e.prototype.getColorTarget=function(t){return L2.isEnabled(t)?this.antialiasing.target:bu.isEnabled(t)?this.postprocessing.target:this.colorTarget},e}(),j1e=w(w({},Lt.Params),{alpha:w(w({},Lt.Params.alpha),{defaultValue:.51}),ignoreLight:w(w({},Lt.Params.ignoreLight),{defaultValue:!0}),colorX:E.Color(dr.red,{isEssential:!0}),colorY:E.Color(dr.green,{isEssential:!0}),colorZ:E.Color(dr.blue,{isEssential:!0}),scale:E.Numeric(.33,{min:.1,max:2,step:.1},{isEssential:!0})}),x1={axes:E.MappedStatic("on",{on:E.Group(j1e),off:E.Group({})},{cycle:!0,description:"Show camera orientation axes"})},YB=function(){function e(t,r){var n=this;r===void 0&&(r={}),this.webgl=t,this.props={axes:{name:"off",params:{}}},this.eachGroup=function(a,i){if(!n.renderObject||!NC(a))return!1;for(var o=!1,s=n.renderObject.values.uGroupCount.ref.value,u=a.elements,l=0,c=u;l<c.length;l++){var d=c[l],f=d.groupId,p=d.instanceId,h=p*s+f;i(Ie.ofSingleton(h))&&(o=!0)}return o},this.scene=bp.create(t),this.camera=new Gn,C.set(this.camera.up,0,1,0),C.set(this.camera.target,0,0,0),this.setProps(r)}return e.prototype.setProps=function(t){var r=this;this.props=Vu(this.props,function(n){if(t.axes!==void 0&&(n.axes.name=t.axes.name,t.axes.name==="on")){r.scene.clear();var a=w(w({},t.axes.params),{scale:t.axes.params.scale*r.webgl.pixelRatio});r.renderObject=Q1e(a),r.renderObject.state.noClip=!0,r.scene.add(r.renderObject),r.scene.commit(),C.set(r.camera.position,0,0,a.scale*200),ue.lookAt(r.camera.view,r.camera.position,r.camera.target,r.camera.up),n.axes.params=w({},t.axes.params)}})},Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this.props.axes.name==="on"},enumerable:!1,configurable:!0}),e.prototype.getLoci=function(t){var r=t.objectId,n=t.groupId,a=t.instanceId;return!this.renderObject||r!==this.renderObject.id||n===0?Or:X1e(this,n,a)},e.prototype.mark=function(t,r){return!Ii.is(Ii.Highlighting,r)||!NC(t)||t.data!==this?!1:Sr.mark(this.renderObject,t,r,this.eachGroup)},e.prototype.update=function(t){if(!!this.renderObject){Y1e(this.camera,t.viewport,t.viewOffset),ue.extractRotation(this.scene.view,t.view);var r=this.renderObject.values.boundingSphere.ref.value.radius;ue.setTranslation(this.scene.view,C.create(-t.viewport.width/2+r,-t.viewport.height/2+r,0))}},e}();function W1e(e){switch(e){case 1:return"X Axis";case 2:return"Y Axis";case 3:return"Z Axis";case 4:return"XY Plane";case 5:return"XZ Plane";case 6:return"YZ Plane";default:return"Axes"}}function X1e(e,t,r){return i1("camera-axes",e,[{groupId:t,instanceId:r}],void 0,function(){return W1e(t)})}function NC(e){return e.kind==="data-loci"&&e.tag==="camera-axes"}function Y1e(e,t,r){var n=e.near,a=e.far,i=-t.width/2,o=t.width/2,s=t.height/2,u=-t.height/2,l=(o-i)/2,c=(s-u)/2,d=(o+i)/2,f=(s+u)/2,p=d-l,h=d+l,v=f+c,m=f-c;if(r.enabled){var g=(o-i)/r.width,y=(s-u)/r.height;p+=g*r.offsetX,h=p+g*r.width,v-=y*r.offsetY,m=v-y*r.height}ue.ortho(e.projection,p,h,v,m,n,a)}function K1e(e,t){var r=_t.createState(512,256,t),n=.075*e,a=C.scale(C(),C.unitX,e),i=C.scale(C(),C.unitY,e),o=C.scale(C(),C.unitZ,e),s={radiusTop:n,radiusBottom:n,radialSegments:32};r.currentGroup=0,la(r,C.origin,n,2),r.currentGroup=1,la(r,a,n,2),$a(r,C.origin,a,1,s),r.currentGroup=2,la(r,i,n,2),$a(r,C.origin,i,1,s),r.currentGroup=3,la(r,o,n,2),$a(r,C.origin,o,1,s),C.scale(a,a,.5),C.scale(i,i,.5),C.scale(o,o,.5),r.currentGroup=4,_t.addTriangle(r,C.origin,a,i),_t.addTriangle(r,C.origin,i,a);var u=C.add(C(),a,i);_t.addTriangle(r,u,a,i),_t.addTriangle(r,u,i,a),r.currentGroup=5,_t.addTriangle(r,C.origin,a,o),_t.addTriangle(r,C.origin,o,a);var l=C.add(C(),a,o);_t.addTriangle(r,l,a,o),_t.addTriangle(r,l,o,a),r.currentGroup=6,_t.addTriangle(r,C.origin,i,o),_t.addTriangle(r,C.origin,o,i);var c=C.add(C(),i,o);return _t.addTriangle(r,c,i,o),_t.addTriangle(r,c,o,i),_t.getMesh(r)}function $1e(e,t){var r=100*e.scale,n=K1e(r,t==null?void 0:t.geometry);n.setBoundingSphere(Ne.create(C.create(r/2,r/2,r/2),r+r/4));var a=function(i){switch(i){case 1:return e.colorX;case 2:return e.colorY;case 3:return e.colorZ;default:return dr.grey}};return Rr.create("axes",{},n,a,function(){return 1},function(){return""})}function Q1e(e){var t=$1e(e);return Rr.createRenderObject(t,e)}var Z1e={transparentBackground:E.Boolean(!1),multiSample:E.Group(qB),postprocessing:E.Group(GB),cameraHelper:E.Group(x1)},J1e=function(){function e(t,r,n,a,i,o,s){this.webgl=t,this.renderer=r,this.scene=n,this.camera=a,this._width=0,this._height=0,this._camera=new Gn,this.props=w(w({},E.getDefaultValues(Z1e)),s),this.drawPass=new XB(t,128,128,o),this.multiSamplePass=new $g(t,this.drawPass),this.multiSampleHelper=new jB(this.multiSamplePass),this.helper={camera:new YB(t,this.props.cameraHelper),debug:i.debug,handle:i.handle},this.setSize(1024,768)}return Object.defineProperty(e.prototype,"colorTarget",{get:function(){return this._colorTarget},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),e.prototype.setSize=function(t,r){t===this._width&&r===this._height||(this._width=t,this._height=r,this.drawPass.setSize(t,r),this.multiSamplePass.syncSize())},e.prototype.setProps=function(t){t===void 0&&(t={}),Object.assign(this.props,t),t.cameraHelper&&this.helper.camera.setProps(t.cameraHelper)},e.prototype.render=function(){Gn.copySnapshot(this._camera.state,this.camera.state),ga.set(this._camera.viewport,0,0,this._width,this._height),this._camera.update(),$g.isEnabled(this.props.multiSample)?(this.multiSampleHelper.render(this.renderer,this._camera,this.scene,this.helper,!1,this.props.transparentBackground,this.props),this._colorTarget=this.multiSamplePass.colorTarget):(this.drawPass.render(this.renderer,this._camera,this.scene,this.helper,!1,this.props.transparentBackground,this.props.postprocessing),this._colorTarget=this.drawPass.getColorTarget(this.props.postprocessing))},e.prototype.getImageData=function(t,r,n){var a,i;this.setSize(t,r),this.render(),this.colorTarget.bind();var o=(a=n==null?void 0:n.width)!==null&&a!==void 0?a:t,s=(i=n==null?void 0:n.height)!==null&&i!==void 0?i:r,u=new Uint8Array(o*s*4);n?this.webgl.readPixels(n.x,r-n.y-n.height,o,s,u):this.webgl.readPixels(0,0,o,s,u);var l=Cd.create(u,o,s);return Cd.flipY(l),Cd.divideByAlpha(l),new ImageData(new Uint8ClampedArray(u),o,s)},e}(),ebe=w(w({},Lt.Params),{alpha:w(w({},Lt.Params.alpha),{defaultValue:1}),ignoreLight:w(w({},Lt.Params.ignoreLight),{defaultValue:!0}),colorX:E.Color(dr.red,{isEssential:!0}),colorY:E.Color(dr.green,{isEssential:!0}),colorZ:E.Color(dr.blue,{isEssential:!0}),scale:E.Numeric(.33,{min:.1,max:2,step:.1},{isEssential:!0})}),KB={handle:E.MappedStatic("off",{on:E.Group(ebe),off:E.Group({})},{cycle:!0,description:"Show handle tool"})},tbe=function(){function e(t,r){var n=this;r===void 0&&(r={}),this.webgl=t,this.props={handle:{name:"off",params:{}}},this._transform=ue(),this.eachGroup=function(a,i){if(!n.renderObject||!fI(a))return!1;for(var o=!1,s=n.renderObject.values.uGroupCount.ref.value,u=a.elements,l=0,c=u;l<c.length;l++){var d=c[l],f=d.groupId,p=d.instanceId,h=p*s+f;i(Ie.ofSingleton(h))&&(o=!0)}return o},this.scene=bp.create(t),this.setProps(r)}return e.prototype.getBoundingSphere=function(t,r){return this.renderObject&&(Ne.copy(t,this.renderObject.values.invariantBoundingSphere.ref.value),ue.fromArray(this._transform,this.renderObject.values.aTransform.ref.value,r*16),Ne.transform(t,t,this._transform)),t},e.prototype.setProps=function(t){var r=this;this.props=Vu(this.props,function(n){if(t.handle!==void 0&&(n.handle.name=t.handle.name,t.handle.name==="on")){r.scene.clear();var a=w(w({},t.handle.params),{scale:t.handle.params.scale*r.webgl.pixelRatio});r.renderObject=ibe(a),r.renderObject.state.noClip=!0,r.scene.add(r.renderObject),r.scene.commit(),n.handle.params=w({},t.handle.params)}})},Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this.props.handle.name==="on"},enumerable:!1,configurable:!0}),e.prototype.update=function(t,r,n){!this.renderObject||(ue.setTranslation(this.renderObject.values.aTransform.ref.value,r),ue.fromMat3(this.renderObject.values.aTransform.ref.value,n),k.update(this.renderObject.values.aTransform,this.renderObject.values.aTransform.ref.value),this.scene.update([this.renderObject],!0))},e.prototype.getLoci=function(t){var r=t.objectId,n=t.groupId,a=t.instanceId;return!this.renderObject||r!==this.renderObject.id?Or:nbe(this,n,a)},e.prototype.mark=function(t,r){return!Ii.is(Ii.Highlighting,r)||!fI(t)||t.data!==this?!1:Sr.mark(this.renderObject,t,r,this.eachGroup)},e}();function rbe(e,t){var r=_t.createState(512,256,t),n=.05*e,a=C.scale(C(),C.unitX,e),i=C.scale(C(),C.unitY,e),o=C.scale(C(),C.unitZ,e),s={radiusTop:n,radiusBottom:n,radialSegments:32};return r.currentGroup=pd.TranslateScreenXY,la(r,C.origin,n*3,2),r.currentGroup=pd.TranslateObjectX,la(r,a,n,2),$a(r,C.origin,a,1,s),r.currentGroup=pd.TranslateObjectY,la(r,i,n,2),$a(r,C.origin,i,1,s),r.currentGroup=pd.TranslateObjectZ,la(r,o,n,2),$a(r,C.origin,o,1,s),_t.getMesh(r)}var pd={None:0,TranslateScreenXY:1,TranslateObjectX:3,TranslateObjectY:4,TranslateObjectZ:5};function nbe(e,t,r){return i1("handle",e,[{groupId:t,instanceId:r}],function(n){return e.getBoundingSphere(n,r)},function(){return"Handle Helper | Group Id "+t+" | Instance Id "+r})}function fI(e){return e.kind==="data-loci"&&e.tag==="handle"}function abe(e,t){var r=10*e.scale,n=rbe(r,t==null?void 0:t.geometry);n.setBoundingSphere(Ne.create(C.create(r/2,r/2,r/2),r+r/4));var a=function(i){switch(i){case pd.TranslateObjectX:return e.colorX;case pd.TranslateObjectY:return e.colorY;case pd.TranslateObjectZ:return e.colorZ;default:return dr.grey}};return Rr.create("handle",{},n,a,function(){return 1},function(){return""})}function ibe(e){var t=abe(e);return Rr.createRenderObject(t,e)}var obe={debug:E.Group(q3),camera:E.Group({helper:E.Group(x1)}),handle:E.Group(KB)},sbe=E.getDefaultValues(obe),ube=function(){function e(t,r,n){n===void 0&&(n={});var a=w(w({},sbe),n);this.debug=new Oye(t,r,a.debug),this.camera=new YB(t,a.camera.helper),this.handle=new tbe(t,a.handle)}return e}(),lbe=function(){function e(t,r){r===void 0&&(r={}),this.webgl=t;var n=t.gl;this.draw=new XB(t,n.drawingBufferWidth,n.drawingBufferHeight,r.enableWboit||!1),this.pick=new D1e(t,this.draw,r.pickScale||.25),this.multiSample=new $g(t,this.draw)}return e.prototype.updateSize=function(){var t=this.webgl.gl;this.draw.setSize(t.drawingBufferWidth,t.drawingBufferHeight),this.pick.syncSize(),this.multiSample.syncSize()},e}(),vo={camera:E.Group({mode:E.Select("perspective",E.arrayToOptions(["perspective","orthographic"]),{label:"Camera"}),helper:E.Group(x1,{isFlat:!0}),stereo:E.MappedStatic("off",{on:E.Group(WB),off:E.Group({})},{cycle:!0,hideIf:function(e){return(e==null?void 0:e.mode)!=="perspective"}}),manualReset:E.Boolean(!1,{isHidden:!0})},{pivot:"mode"}),cameraFog:E.MappedStatic("on",{on:E.Group({intensity:E.Numeric(15,{min:1,max:100,step:1})}),off:E.Group({})},{cycle:!0,description:"Show fog in the distance"}),cameraClipping:E.Group({radius:E.Numeric(100,{min:0,max:99,step:1},{label:"Clipping",description:"How much of the scene to show."}),far:E.Boolean(!0,{description:"Hide scene in the distance"})},{pivot:"radius"}),viewport:E.MappedStatic("canvas",{canvas:E.Group({}),"static-frame":E.Group({x:E.Numeric(0),y:E.Numeric(0),width:E.Numeric(128),height:E.Numeric(128)}),"relative-frame":E.Group({x:E.Numeric(.33,{min:0,max:1,step:.01}),y:E.Numeric(.33,{min:0,max:1,step:.01}),width:E.Numeric(.5,{min:.01,max:1,step:.01}),height:E.Numeric(.5,{min:.01,max:1,step:.01})})}),cameraResetDurationMs:E.Numeric(250,{min:0,max:1e3,step:1},{description:"The time it takes to reset the camera."}),transparentBackground:E.Boolean(!1),multiSample:E.Group(qB),postprocessing:E.Group(GB),renderer:E.Group(OC),trackball:E.Group(HB),debug:E.Group(q3),handle:E.Group(KB)},j3=E.getDefaultValues(vo),UC;(function(e){e.DefaultAttribs={antialias:!0,preserveDrawingBuffer:!0,pixelScale:1,pickScale:.25,enableWboit:!0};function t(r,n){n===void 0&&(n={});var a=w(w({},e.DefaultAttribs),n),i=a.antialias,o=a.preserveDrawingBuffer,s=a.pixelScale,u=fse(r,{antialias:i,preserveDrawingBuffer:o,alpha:!0,depth:!0,premultipliedAlpha:!0});if(u===null)throw new Error("Could not create a WebGL rendering context");var l=RC.fromElement(r,{pixelScale:s}),c=gse(u,{pixelScale:s}),d=new lbe(c,n);if(Ir){var f=u.getExtension("WEBGL_lose_context");f&&r.addEventListener("mousedown",function(m){c.isContextLost||!m.shiftKey||!m.ctrlKey||!m.altKey||(Ir&&console.log("lose context"),f.loseContext(),setTimeout(function(){!c.isContextLost||(Ir&&console.log("restore context"),f.restoreContext())},1e3))},!1)}var p=new tc(0),h=function(m){c.setContextLost(),m.preventDefault(),Ir&&console.log("context lost"),p.next(xn())},v=function(){!c.isContextLost||(c.handleContextRestored(function(){d.draw.reset()}),Ir&&console.log("context restored"))};return r.addEventListener("webglcontextlost",h,!1),r.addEventListener("webglcontextrestored",v,!1),{canvas:r,webgl:c,input:l,passes:d,attribs:a,contextLost:p,contextRestored:c.contextRestored,dispose:function(m){l.dispose(),r.removeEventListener("webglcontextlost",h,!1),r.removeEventListener("webglcontextrestored",v,!1),c.destroy(m)}}}e.fromCanvas=t})(UC||(UC={}));var cbe=typeof window!="undefined"?window.requestAnimationFrame:function(e){return setImmediate(function(){return e(Date.now())})},dbe=typeof window!="undefined"?window.cancelAnimationFrame:function(e){return clearImmediate(e)},zC;(function(e){function t(r,n){var a=r.webgl,i=r.input,o=r.passes,s=r.attribs;n===void 0&&(n={});var u=w(w({},j3),n),l=new Map,c=new Map,d=new tc(0),f=xn(),p=new tc(0),h=new tc(0),v=a.gl,m=a.contextRestored,g=0,y=0,b=128,x=128;dt();var S=bp.create(a),_=new Gn({position:C.create(0,0,100),mode:u.camera.mode,fog:u.cameraFog.name==="on"?u.cameraFog.params.intensity:0,clipFar:u.cameraClipping.far},{x:g,y,width:b,height:x},{pixelScale:s.pixelScale}),A=new Sp(_,u.camera.stereo.params),T=kC.create(i,_,u.trackball),I=FC.create(a,u.renderer),M=new ube(a,S,u),O=new R1e(a,I,S,M,o.pick,{x:g,y,width:b,height:x}),D=new zye(Ae,Z,i,_),F=new jB(o.multiSample),G=!1,N=void 0,z=void 0,$=!1,j=!0;function Z(Me){var Ke=Or,tt=or.Empty;if(Me){var St=M.camera.getLoci(Me);if(St!==Or)return{loci:St,repr:tt};Ke=M.handle.getLoci(Me),l.forEach(function(ht,ut){var fe=ut.getLoci(Me);ns(fe)||(ns(Ke)||console.warn("found another loci, this should not happen"),Ke=fe,tt=ut)})}return{loci:Ke,repr:tt}}function q(Me,Ke){var tt=Me.repr,St=Me.loci,ht=!1;if(tt?ht=tt.mark(St,Ke):(ht=M.handle.mark(St,Ke),ht=M.camera.mark(St,Ke)||ht,l.forEach(function(fe,me){ht=me.mark(St,Ke)||ht})),ht){S.update(void 0,!0),M.handle.scene.update(void 0,!0),M.camera.scene.update(void 0,!0);var ut=O.dirty;H(!0),O.dirty=ut}}function te(Me){if(a.isContextLost)return!1;var Ke=!1;if($&&(ot(!1),$=!1,Ke=!0),g>v.drawingBufferWidth||g+b<0||y>v.drawingBufferHeight||y+x<0)return!1;var tt=!1;T.update(K);var St=_.update(),ht=Me||St||Ke||he;he=!1;var ut=F.update(ht,u.multiSample);if(ht||ut){var fe=_;u.camera.stereo.name==="on"&&(A.update(),fe=A),$g.isEnabled(u.multiSample)?F.render(I,fe,S,M,!0,u.transparentBackground,u):o.draw.render(I,fe,S,M,!0,u.transparentBackground,u.postprocessing),O.dirty=!0,tt=!0}return tt}var he=!1,W=!1,K=0,U=!1;function H(Me){U||te(!!Me)&&j&&p.next(xn()-f)}function J(Me){he=he||!!Me}var X=0;function Q(Me,Ke){K=Me,xe(Ke==null?void 0:Ke.isSynchronous),_.transition.tick(K),!(Ke!=null&&Ke.manualDraw)&&(H(!1),!_.transition.inTransition&&!a.isContextLost&&D.tick(K))}function ee(){Q(xn()),X=cbe(ee)}function le(Me){f=Me,T.start(Me)}function ye(){U=!1,T.start(xn()),X===0&&ee()}function be(Me){Me===void 0&&(Me=!1),U=Me,dbe(X),X=0}function Ae(Me,Ke){var tt=u.camera.stereo.name==="on"?A:_;return a.isContextLost?void 0:O.identify(Me,Ke,tt)}function xe(Me){Me===void 0&&(Me=!1);var Ke=_e(Me);Ke&&(ae(),W&&(M.debug.isEnabled&&M.debug.update(),H(!0),W=!1),h.next(xn()))}function ae(){if(!!G){var Me=S.boundingSphereVisible,Ke=Me.center,tt=Me.radius,St=T.props.autoAdjustMinMaxDistance;if(St.name==="on"){var ht=St.params.minDistanceFactor*tt+St.params.minDistancePadding,ut=Math.max(St.params.maxDistanceFactor*tt,St.params.maxDistanceMin);T.setProps({minDistance:ht,maxDistance:ut})}if(tt>0){var fe=N===void 0?u.cameraResetDurationMs:N,me=_.getFocus(Ke,tt),we=typeof z=="function"?z(S,_):z,$e=we?w(w({},me),we):me;_.setState(w(w({},$e),{radiusMax:S.boundingSphere.radius}),fe)}N=void 0,z=void 0,G=!1}}var oe=Ne(),R=Ne();function V(){if(_.state.radiusMax===0)return!0;if(_.transition.inTransition||z)return!1;var Me=!0;Ne.set(R,_.state.target,_.state.radius);for(var Ke=0,tt=S.renderables;Ke<tt.length;Ke++){var St=tt[Ke];if(!!St.state.visible){var ht=St.values.boundingSphere.ref.value;if(!!ht.radius){var ut=C.distance(R.center,ht.center);if((ut>R.radius||ut>ht.radius||ht.radius>_.state.radiusMax)&&!Ne.includes(oe,ht))return!0;Ne.overlaps(R,ht)&&(Me=!1)}}}return Me}var pe=250;function _e(Me){return S.needsCommit?(Ne.copy(oe,S.boundingSphereVisible),S.commit(Me?void 0:pe)?(M.debug.isEnabled&&M.debug.update(),!u.camera.manualReset&&(d.value===0||V())&&(G=!0),oe.radius===0&&(N=0),_.setState({radiusMax:S.boundingSphere.radius},0),d.next(l.size),Ir&&Ee(),!0):!1):!0}function Ee(){console.table(S.renderables.map(function(ht){return{drawCount:ht.values.drawCount.ref.value,instanceCount:ht.values.instanceCount.ref.value,materialId:ht.materialId,renderItemId:ht.id}})),console.log(a.stats);var Me=a.resources.getByteCounts(),Ke=Me.texture,tt=Me.attribute,St=Me.elements;console.log({texture:(Ke/1024/1024).toFixed(3)+" MiB",attribute:(tt/1024/1024).toFixed(3)+" MiB",elements:(St/1024/1024).toFixed(3)+" MiB"})}function Ve(Me){Ye(Me);var Ke=l.get(Me),tt=new Set;Me.renderObjects.forEach(function(St){return tt.add(St)}),Ke?jn.areEqual(tt,Ke)||(tt.forEach(function(St){Ke.has(St)||S.add(St)}),Ke.forEach(function(St){tt.has(St)||S.remove(St)})):Me.renderObjects.forEach(function(St){return S.add(St)}),l.set(Me,tt),S.update(Me.renderObjects,!1),W=!0,Ir&&Ee()}function He(Me){lt(Me);var Ke=l.get(Me);Ke&&(Ke.forEach(function(tt){return S.remove(tt)}),l.delete(Me),W=!0,Ir&&Ee())}function Ye(Me){c.has(Me)||c.set(Me,Me.updated.subscribe(function(Ke){Me.state.syncManually||Ve(Me)}))}function lt(Me){var Ke=c.get(Me);Ke&&(Ke.unsubscribe(),c.delete(Me))}function Le(){var Me=S.boundingSphere.radius>0?100-Math.round(_.transition.target.radius/S.boundingSphere.radius*100):0;return{camera:{mode:_.state.mode,helper:w({},M.camera.props),stereo:w({},u.camera.stereo),manualReset:!!u.camera.manualReset},cameraFog:_.state.fog>0?{name:"on",params:{intensity:_.state.fog}}:{name:"off",params:{}},cameraClipping:{far:_.state.clipFar,radius:Me},cameraResetDurationMs:u.cameraResetDurationMs,transparentBackground:u.transparentBackground,viewport:u.viewport,postprocessing:w({},u.postprocessing),multiSample:w({},u.multiSample),renderer:w({},I.props),trackball:w({},T.props),debug:w({},M.debug.props),handle:w({},M.handle.props)}}var Qe=m.subscribe(function(){O.dirty=!0,H(!0),H(!0)}),at=new tc(0);function ot(Me){Me===void 0&&(Me=!0),o.updateSize(),dt(),Oe(),Me&&J(!0),at.next(+new Date)}return{webgl:a,add:Ve,remove:He,commit:xe,update:function(Me,Ke){if(Me){if(!l.has(Me))return;S.update(Me.renderObjects,!!Ke)}else S.update(void 0,!!Ke);W=!0},clear:function(){c.forEach(function(Me){return Me.unsubscribe()}),c.clear(),l.clear(),S.clear(),M.debug.clear(),J(!0),d.next(l.size)},syncVisibility:function(){_.state.radiusMax===0&&(G=!0,N=0),S.syncVisibility()&&M.debug.isEnabled&&M.debug.update(),J(!0)},requestDraw:J,tick:Q,animate:ye,resetTime:le,pause:be,resume:function(){U=!1},identify:Ae,mark:q,getLoci:Z,handleResize:ot,requestResize:function(){$=!0},requestCameraReset:function(Me){N=Me==null?void 0:Me.durationMs,z=Me==null?void 0:Me.snapshot,G=!0},camera:_,boundingSphere:S.boundingSphere,boundingSphereVisible:S.boundingSphereVisible,get notifyDidDraw(){return j},set notifyDidDraw(Me){j=Me},didDraw:p,commited:h,reprCount:d,resized:at,setProps:function(Me,Ke){var tt,St,ht;Ke===void 0&&(Ke=!1);var ut=typeof Me=="function"?Vu(Le(),Me):Me,fe=Object.create(null);if(ut.camera&&ut.camera.mode!==void 0&&ut.camera.mode!==_.state.mode&&(fe.mode=ut.camera.mode),ut.cameraFog!==void 0&&ut.cameraFog.params){var me=ut.cameraFog.name==="on"?ut.cameraFog.params.intensity:0;me!==_.state.fog&&(fe.fog=me)}if(ut.cameraClipping!==void 0&&(ut.cameraClipping.far!==void 0&&ut.cameraClipping.far!==_.state.clipFar&&(fe.clipFar=ut.cameraClipping.far),ut.cameraClipping.radius!==void 0)){var we=S.boundingSphere.radius/100*(100-ut.cameraClipping.radius);we>0&&we!==fe.radius&&(fe.radius=Math.max(we,.01))}if(Object.keys(fe).length>0&&_.setState(fe),!((tt=ut.camera)===null||tt===void 0)&&tt.helper&&M.camera.setProps(ut.camera.helper),((St=ut.camera)===null||St===void 0?void 0:St.manualReset)!==void 0&&(u.camera.manualReset=ut.camera.manualReset),((ht=ut.camera)===null||ht===void 0?void 0:ht.stereo)!==void 0&&Object.assign(u.camera.stereo,ut.camera.stereo),ut.cameraResetDurationMs!==void 0&&(u.cameraResetDurationMs=ut.cameraResetDurationMs),ut.transparentBackground!==void 0&&(u.transparentBackground=ut.transparentBackground),ut.viewport!==void 0){var $e=u.viewport===ut.viewport||u.viewport.name===ut.viewport.name&&Y0(u.viewport.params,ut.viewport.params);$e||(u.viewport=ut.viewport,dt(),Oe())}ut.postprocessing&&Object.assign(u.postprocessing,ut.postprocessing),ut.multiSample&&Object.assign(u.multiSample,ut.multiSample),ut.renderer&&I.setProps(ut.renderer),ut.trackball&&T.setProps(ut.trackball),ut.debug&&M.debug.setProps(ut.debug),ut.handle&&M.handle.setProps(ut.handle),fe.mode==="orthographic"&&(u.camera.stereo.name="off"),Ke||J(!0)},getImagePass:function(Me){return Me===void 0&&(Me={}),new J1e(a,I,S,_,M,o.draw.wboitEnabled,Me)},getRenderObjects:function(){var Me=[];return S.forEach(function(Ke,tt){return Me.push(tt)}),Me},get props(){return Le()},get input(){return i},get stats(){return I.stats},get interaction(){return D.events},dispose:function(){Qe.unsubscribe(),S.clear(),M.debug.clear(),T.dispose(),I.dispose(),D.dispose()}};function dt(){var Me=g,Ke=y,tt=b,St=x;u.viewport.name==="canvas"?(g=0,y=0,b=v.drawingBufferWidth,x=v.drawingBufferHeight):u.viewport.name==="static-frame"?(g=u.viewport.params.x*a.pixelRatio,x=u.viewport.params.height*a.pixelRatio,y=v.drawingBufferHeight-x-u.viewport.params.y*a.pixelRatio,b=u.viewport.params.width*a.pixelRatio):u.viewport.name==="relative-frame"&&(g=Math.round(u.viewport.params.x*v.drawingBufferWidth),x=Math.round(u.viewport.params.height*v.drawingBufferHeight),y=Math.round(v.drawingBufferHeight-x-u.viewport.params.y*v.drawingBufferHeight),b=Math.round(u.viewport.params.width*v.drawingBufferWidth)),(Me!==g||Ke!==y||tt!==b||St!==x)&&(he=!0)}function Oe(){O.setViewport(g,y,b,x),I.setViewport(g,y,b,x),ga.set(_.viewport,g,y,b,x),ga.set(T.viewport,g,y,b,x)}}e.create=t})(zC||(zC={}));function fbe(e){$B(e)}function $B(e){wt.Canvas3D.ResetSettings.subscribe(e,function(){var t;(t=e.canvas3d)===null||t===void 0||t.setProps(j3),e.events.canvas3d.settingsUpdated.next()}),wt.Canvas3D.SetSettings.subscribe(e,function(t){var r;!e.canvas3d||((r=e.canvas3d)===null||r===void 0||r.setProps(t.settings),e.events.canvas3d.settingsUpdated.next())})}var pbe=Object.freeze(Object.defineProperty({__proto__:null,registerDefault:fbe,Canvas3DSetSettings:$B},Symbol.toStringTag,{value:"Module"})),cc=is,Ad=fr.Trigger,hbe={hoverHighlightOnly:fr([Ad(0)],"Highlight","Hover element using ${triggers}"),hoverHighlightOnlyExtend:fr([Ad(0,cc.create({shift:!0}))],"Extend highlight","From selected to hovered element along polymer using ${triggers}")},vbe={bindings:E.Value(hbe,{isHidden:!0}),ignore:E.Value([],{isHidden:!0}),mark:E.Boolean(!0)},mbe=Mr.create({name:"representation-highlight-loci",category:"interaction",ctor:function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.lociMarkProvider=function(n,a){!r.ctx.canvas3d||!r.params.mark||r.ctx.canvas3d.mark(n,a)},r}return t.prototype.register=function(){var r=this;this.subscribeObservable(this.ctx.behaviors.interaction.hover,function(n){var a,i=n.current,o=n.buttons,s=n.modifiers;if(!(!r.ctx.canvas3d||r.ctx.isBusy)){if(((a=r.params.ignore)===null||a===void 0?void 0:a.indexOf(i.loci.kind))>=0){r.ctx.managers.interactivity.lociHighlights.highlightOnly({repr:i.repr,loci:Or});return}var u=!1;fr.match(r.params.bindings.hoverHighlightOnly,o,s)&&(r.ctx.managers.interactivity.lociHighlights.highlightOnly({loci:i.loci}),u=!0),fr.match(r.params.bindings.hoverHighlightOnlyExtend,o,s)&&(r.ctx.managers.interactivity.lociHighlights.highlightOnlyExtend({loci:i.loci}),u=!0),u||r.ctx.managers.interactivity.lociHighlights.highlightOnly({repr:i.repr,loci:Or})}}),this.ctx.managers.interactivity.lociHighlights.addProvider(this.lociMarkProvider)},t.prototype.unregister=function(){this.ctx.managers.interactivity.lociHighlights.removeProvider(this.lociMarkProvider)},t}(Mr.Handler),params:function(){return vbe},display:{name:"Highlight Loci on Canvas"}}),gbe={clickSelect:fr.Empty,clickToggleExtend:fr([Ad(1,cc.create({shift:!0}))],"Toggle extended selection","${triggers} to extend selection along polymer"),clickSelectOnly:fr.Empty,clickToggle:fr([Ad(1,cc.create())],"Toggle selection","${triggers} on element"),clickDeselect:fr.Empty,clickDeselectAllOnEmpty:fr([Ad(1,cc.create())],"Deselect all","Click on nothing using ${triggers}")},ybe={bindings:E.Value(gbe,{isHidden:!0}),ignore:E.Value([],{isHidden:!0}),mark:E.Boolean(!0)},QB=Mr.create({name:"representation-select-loci",category:"interaction",ctor:function(e){Be(t,e);function t(r,n){var a=e.call(this,r,n)||this;return a.lociMarkProvider=function(i,o){!a.ctx.canvas3d||!a.params.mark||a.ctx.canvas3d.mark({loci:i.loci},o)},a.spine=new dv.Impl(r.state.data.cells),a}return t.prototype.applySelectMark=function(r,n){var a=this.ctx.state.data.cells.get(r);if(a&&ge.isRepresentation3D(a.obj)){this.spine.current=a;var i=this.spine.getRootOfType(ge.Molecule.Structure);if(i){n&&this.lociMarkProvider({loci:Xe.Loci(i.data)},tr.Deselect);var o=this.ctx.managers.structure.selection.getLoci(i.data);this.lociMarkProvider({loci:o},tr.Select)}}},t.prototype.register=function(){var r=this,n=function(o){return ir.isEmpty(o.loci)},a=function(o){return!ir.isEmpty(o.loci)},i=[["clickSelect",function(o){return r.ctx.managers.interactivity.lociSelects.select(o)},a],["clickToggle",function(o){return r.ctx.managers.interactivity.lociSelects.toggle(o)},a],["clickToggleExtend",function(o){return r.ctx.managers.interactivity.lociSelects.toggleExtend(o)},a],["clickSelectOnly",function(o){return r.ctx.managers.interactivity.lociSelects.selectOnly(o)},a],["clickDeselect",function(o){return r.ctx.managers.interactivity.lociSelects.deselect(o)},a],["clickDeselectAllOnEmpty",function(){return r.ctx.managers.interactivity.lociSelects.deselectAll()},n]];i.sort(function(o,s){var u=r.params.bindings[o[0]],l=r.params.bindings[s[0]],c=u.triggers.length===0?0:Gs(u.triggers.map(function(f){return cc.size(f.modifiers)})),d=l.triggers.length===0?0:Gs(l.triggers.map(function(f){return cc.size(f.modifiers)}));return d-c}),this.subscribeObservable(this.ctx.behaviors.interaction.click,function(o){var s,u=o.current,l=o.button,c=o.modifiers;if(!(!r.ctx.canvas3d||r.ctx.isBusy||!r.ctx.selectionMode)&&!(((s=r.params.ignore)===null||s===void 0?void 0:s.indexOf(u.loci.kind))>=0))for(var d=0,f=i;d<f.length;d++){var p=f[d],h=p[0],v=p[1],m=p[2];if(fr.match(r.params.bindings[h],l,c)&&(!m||m(u))){v(u);break}}}),this.ctx.managers.interactivity.lociSelects.addProvider(this.lociMarkProvider),this.subscribeObservable(this.ctx.state.events.object.created,function(o){var s=o.ref;return r.applySelectMark(s)}),this.subscribeObservable(this.ctx.state.events.object.updated,function(o){var s=o.ref,u=o.obj,l=o.oldObj,c=o.oldData,d=o.action,f=r.ctx.state.data.cells.get(s);if(f&&ge.Molecule.Structure.is(f.obj)){var p=u.data,h=d==="recreate"?l==null?void 0:l.data:d==="in-place"?c:void 0;if(h&&Xe.areEquivalent(p,h)&&Xe.areHierarchiesEqual(p,h))return;for(var v=r.ctx.state.data.select(ar.Generators.ofType(ge.Molecule.Structure.Representation3D,s)),m=0,g=v;m<g.length;m++){var y=g[m];r.applySelectMark(y.transform.ref,!0)}}})},t.prototype.unregister=function(){this.ctx.managers.interactivity.lociSelects.removeProvider(this.lociMarkProvider)},t}(Mr.Handler),params:function(){return ybe},display:{name:"Select Loci on Canvas"}}),bbe=Mr.create({name:"default-loci-label-provider",category:"interaction",ctor:function(){function e(t){this.ctx=t,this.f={label:function(r){var n=[];if(Re.is(r)&&r.elements.length===1){var a=r.elements[0].unit,i=Ze.create(r.structure,a,a.elements[0]),o=ct.entity.pdbx_description(i).join(", ");n.push(o)}return n.push(Cc(r)),n.filter(function(s){return!!s}).join("</br>")},group:function(r){return r.toString().replace(/Model [0-9]+/g,"Models")},priority:100}}return e.prototype.register=function(){this.ctx.managers.lociLabels.addProvider(this.f)},e.prototype.unregister=function(){this.ctx.managers.lociLabels.removeProvider(this.f)},e}(),display:{name:"Provide Default Loci Label"}}),Sbe={clickFocus:fr([Ad(1,cc.create())],"Representation Focus","Click element using ${triggers}"),clickFocusAdd:fr([Ad(1,cc.create({shift:!0}))],"Representation Focus Add","Click element using ${triggers}"),clickFocusSelectMode:fr([],"Representation Focus","Click element using ${triggers}"),clickFocusAddSelectMode:fr([],"Representation Focus Add","Click element using ${triggers}")},xbe={bindings:E.Value(Sbe,{isHidden:!0})},C1=Mr.create({name:"representation-focus-loci",category:"interaction",ctor:function(e){Be(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.register=function(){var r=this;this.subscribeObservable(this.ctx.behaviors.interaction.click,function(n){var a,i=n.current,o=n.button,s=n.modifiers,u=r.params.bindings,l=u.clickFocus,c=u.clickFocusAdd,d=u.clickFocusSelectMode,f=u.clickFocusAddSelectMode,p=r.ctx.managers.interactivity.props.granularity;if(!(p!=="residue"&&p!=="element")){var h=r.ctx.selectionMode?d:l,v=fr.match(h,o,s),m=r.ctx.selectionMode?f:c,g=fr.match(m,o,s);if(!(!v&&!g)){var y=ir.normalize(i.loci,"residue"),b=r.ctx.managers.structure.focus.current;if(b&&ir.areEqual(b.loci,y))r.ctx.managers.structure.focus.clear();else if(v)r.ctx.managers.structure.focus.setFromLoci(y);else{r.ctx.managers.structure.focus.addFromLoci(y);var x=(a=r.ctx.managers.structure.focus.current)===null||a===void 0?void 0:a.loci;x&&r.ctx.managers.camera.focusLoci(x)}}}})},t}(Mr.Handler),params:function(){return xbe},display:{name:"Representation Focus Loci on Canvas"}}),Cbe=Object.freeze(Object.defineProperty({__proto__:null,HighlightLoci:mbe,SelectLoci:QB,DefaultLociLabelProvider:bbe,FocusLoci:C1},Symbol.toStringTag,{value:"Module"})),ih=is,oh=fr.Trigger,_be={clickCenterFocus:fr([oh(1,ih.create()),oh(2,ih.create()),oh(1,ih.create({control:!0}))],"Camera center and focus","Click element using ${triggers}"),clickCenterFocusSelectMode:fr([oh(2,ih.create()),oh(1,ih.create({control:!0}))],"Camera center and focus","Click element using ${triggers}")},wbe={minRadius:E.Numeric(8,{min:1,max:50,step:1}),extraRadius:E.Numeric(4,{min:1,max:50,step:1},{description:"Value added to the bounding-sphere radius of the Loci"}),durationMs:E.Numeric(250,{min:0,max:1e3,step:1},{description:"Camera transition duration"}),bindings:E.Value(_be,{isHidden:!0})},Abe=Mr.create({name:"camera-focus-loci",category:"interaction",ctor:function(e){Be(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.register=function(){var r=this;this.subscribeObservable(this.ctx.behaviors.interaction.click,function(n){var a=n.current,i=n.button,o=n.modifiers;if(!!r.ctx.canvas3d){var s=r.ctx.selectionMode?r.params.bindings.clickCenterFocusSelectMode:r.params.bindings.clickCenterFocus;if(fr.match(s,i,o)){if(ir.isEmpty(a.loci)){wt.Camera.Reset(r.ctx,{});return}var u=ir.normalize(a.loci,r.ctx.managers.interactivity.props.granularity);r.ctx.managers.camera.focusLoci(u,r.params)}}})},t}(Mr.Handler),params:function(){return wbe},display:{name:"Camera Focus Loci on Canvas"}}),Pbe=Mr.create({name:"camera-axis-helper",category:"interaction",ctor:function(e){Be(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.register=function(){var r=this,n=0,a=0;this.subscribeObservable(this.ctx.behaviors.interaction.click,function(i){var o=i.current;if(!(!r.ctx.canvas3d||!NC(o.loci))){var s=o.loci.elements[0].groupId;if(s===0){n=0,a=0;return}var u=r.ctx.canvas3d.camera,l,c;if(s>=1&&s<=3){n=0,a=0;var d=C.sub(C(),u.target,u.position),f=C.cross(C(),d,u.up);c=C(),c[s-1]=1,l=C.cross(C(),c,f),C.magnitude(l)===0&&(l=d)}else n===s?a=(a+1)%2:(n=s,a=0),s===4?(c=a?C.unitX:C.unitY,l=C.negUnitZ):s===5?(c=a?C.unitX:C.unitZ,l=C.negUnitY):(c=a?C.unitY:C.unitZ,l=C.negUnitX);r.ctx.canvas3d.requestCameraReset({snapshot:function(p,h){return h.getInvariantFocus(p.boundingSphereVisible.center,p.boundingSphereVisible.radius,c,l)}})}})},t}(Mr.Handler),params:function(){return{}},display:{name:"Camera Axis Helper"}}),Tbe=Object.freeze(Object.defineProperty({__proto__:null,FocusLoci:Abe,CameraAxisHelper:Pbe},Symbol.toStringTag,{value:"Module"})),Ebe=Mr.create({name:"structure-info-prop",category:"custom-props",display:{name:"Structure Info"},ctor:function(e){Be(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return Object.defineProperty(t.prototype,"maxModelIndex",{get:function(){for(var r,n,a=-1,i=this.ctx.state.data.select(ar.Generators.rootsOfType(ge.Molecule.Model)),o=0,s=i;o<s.length;o++){var u=s[o],l=((r=u.obj)===null||r===void 0?void 0:r.data)&&jt.Index.get((n=u.obj)===null||n===void 0?void 0:n.data).value;l!==void 0&&l>a&&(a=l)}return a},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxStructureIndex",{get:function(){for(var r,n,a=-1,i=this.ctx.state.data.select(ar.Generators.rootsOfType(ge.Molecule.Structure)),o=0,s=i;o<s.length;o++){var u=s[o],l=((r=u.obj)===null||r===void 0?void 0:r.data)&&Xe.Index.get((n=u.obj)===null||n===void 0?void 0:n.data).value;l!==void 0&&l>a&&(a=l)}return a},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"asymIdOffset",{get:function(){for(var r,n=0,a=0,i=this.ctx.state.data.select(ar.Generators.rootsOfType(ge.Molecule.Model)),o=0,s=i;o<s.length;o++){var u=s[o],l=(r=u.obj)===null||r===void 0?void 0:r.data;if(l){var c=jt.AsymIdCount.get(l),d=jt.AsymIdOffset.get(l).value;c!==void 0&&d!==void 0&&(n=Math.max(n,d.auth+c.auth),a=Math.max(a,d.label+c.label))}}return{auth:n,label:a}},enumerable:!1,configurable:!0}),t.prototype.handleModel=function(r,n){if(jt.Index.get(r).value===void 0){var a=n&&jt.Index.get(n).value,i=a!=null?a:this.maxModelIndex+1;jt.Index.set(r,{value:i})}if(jt.AsymIdOffset.get(r).value===void 0){var o=n&&jt.AsymIdOffset.get(n).value,i=o!=null?o:w({},this.asymIdOffset);jt.AsymIdOffset.set(r,{value:i})}},t.prototype.handleStructure=function(r,n){if(r.parent===void 0&&Xe.Index.get(r).value===void 0){var a=n&&Xe.Index.get(n).value,i=a!=null?a:this.maxStructureIndex+1;Xe.Index.set(r,{value:i})}},t.prototype.handle=function(r,n,a){if(ge.Molecule.Structure.is(n)){var i=this.ctx.state.data.tree.transforms.get(r);!i.transformer.definition.isDecorator&&n.data.parent===void 0&&this.handleStructure(n.data,a==null?void 0:a.data)}else if(ge.Molecule.Model.is(n)){var i=this.ctx.state.data.tree.transforms.get(r);i.transformer.definition.isDecorator||this.handleModel(n.data,a==null?void 0:a.data)}},t.prototype.register=function(){var r=this;this.ctx.customModelProperties.register(jt.AsymIdOffset,!0),this.ctx.customModelProperties.register(jt.Index,!0),this.ctx.customStructureProperties.register(Xe.Index,!0),this.subscribeObservable(this.ctx.state.data.events.object.created,function(n){r.handle(n.ref,n.obj)}),this.subscribeObservable(this.ctx.state.data.events.object.updated,function(n){r.handle(n.ref,n.obj,n.oldObj)})},t.prototype.unregister=function(){this.ctx.customModelProperties.unregister(jt.AsymIdOffset.descriptor.name),this.ctx.customModelProperties.unregister(jt.Index.descriptor.name),this.ctx.customStructureProperties.unregister(Xe.Index.descriptor.name)},t}(Mr.Handler)}),ic=[-1,1.76,1.87,1.65,1.5,1.4,1.85,1.8,1.6,1.4],ZB={ALA:121,ARG:265,ASN:187,ASP:187,CYS:148,GLU:214,GLN:214,GLY:97,HIS:216,ILE:195,LEU:191,LYS:230,MET:203,PHE:228,PRO:154,SER:143,THR:163,TRP:264,TYR:255,VAL:165},Ibe=121;function Mbe(e){var t=ct.residue.key,r=ct.atom,n=r.type_symbol,a=r.label_atom_id,i=r.label_comp_id,o=e.structure,s=e.atomRadiusType,u=e.serialResidueIndex,l=Ze.create(o),c=0,d=0,f=-1;l.structure=o;for(var p=0,h=0,v=o.units.length;p<v;++p){var m=o.units[p],g=m.elements;l.unit=m,c=-1;for(var y=0,b=g.length;y<b;++y){var x=g[y],S=h+y;l.element=x,d=t(l),c!==d&&++f,c=d;var _=n(l),A=pp(_);if(bv(A)){s[S]=0,u[S]=-1;continue}var T=a(l),I=r3(m,x);if(I===2||!e.nonPolymer&&!t3(I)){s[S]=0,u[S]=-1;continue}var M=i(l);if(e.traceOnly&&(T!=="CA"&&T!=="BB"||!ZB[M])){s[S]=0,u[S]=f;continue}$s(I)?s[S]=Rbe(T,_):I===5?s[S]=Dbe(T,_,M):s[S]=W3(_),u[S]=f}h+=g.length}}function Dbe(e,t,r){switch(t){case"O":return 5;case"S":return 6;case"N":return e==="NZ"?4:3;case"C":switch(e){case"C":case"CE1":case"CE2":case"CE3":case"CH2":case"CZ":case"CZ2":case"CZ3":return 1;case"CA":case"CB":case"CE":case"CG1":case"CG2":return 2;default:switch(r){case"PHE":case"TRP":case"TYR":case"HIS":case"ASP":case"ASN":return 1;case"PRO":case"LYS":case"ARG":case"MET":case"ILE":case"LEU":return 2;case"GLU":case"GLN":return e==="CD"?1:2}}}return W3(t)}function Rbe(e,t,r){switch(t){case"C":return 7;case"N":return 8;case"P":return 9;case"O":return 5}return W3(t)}function W3(e){var t=Mv(e),r=ic.indexOf(t);return r===-1&&(r=ic.length,ic[r]=t),r}var pI=5e3;function Obe(e,t){return ce(this,void 0,void 0,function(){var r,n;return de(this,function(a){switch(a.label){case 0:r=t.atomRadiusType,n=0,a.label=1;case 1:return n<r.length?e.shouldUpdate?[4,e.update({message:"Computing per residue surface accessibility...",current:n,max:r.length})]:[3,3]:[3,5];case 2:a.sent(),a.label=3;case 3:Fbe(t,n,Math.min(n+pI,r.length)),a.label=4;case 4:return n+=pI,[3,1];case 5:return[2]}})})}function Fbe(e,t,r){for(var n=e.structure,a=e.atomRadiusType,i=e.serialResidueIndex,o=e.area,s=e.spherePoints,u=e.scalingConstant,l=e.maxLookupRadius,c=e.probeSize,d=n.lookup3d,f=n.serialMapping,p=n.unitIndexMap,h=n.units,v=f.cumulativeUnitElementCount,m=f.elementIndices,g=f.unitIndices,y=t;y<r;++y){var b=ic[a[y]];if(b===ic[0])continue;for(var x=h[g[y]],S=m[y],_=x.conformation.x(S),A=x.conformation.y(S),T=x.conformation.z(S),I=d.find(_,A,T,l),M=I.count,O=I.units,D=I.indices,F=I.squaredDistances,G=c+b,N=c+G,z=[],$=0;$<M;++$){var j=O[$],Z=v[p.get(j.id)]+D[$],q=m[Z],te=ic[a[Z]];if(!(x===j&&S===q||te===ic[0])){var he=c+te;if(F[$]<(N+te)*(N+te)){var W=m[Z];z[z.length]=[F[$],(F[$]+G*G-he*he)/(2*G),j.conformation.x(W)-_,j.conformation.y(W)-A,j.conformation.z(W)-T]}}}z.sort(function(oe,R){return oe[0]-R[0]});var K=0;e:for(var U=0;U<s.length;++U){for(var H=s[U],J=H[0],X=H[1],Q=H[2],ee=0;ee<z.length;++ee){var le=z[ee],ye=le[1],be=le[2],Ae=le[3],xe=le[4],ae=J*be+X*Ae+Q*xe;if(ae>ye)continue e}++K}o[i[y]]+=u*K*G*G}}var JB={numberOfSpherePoints:E.Numeric(92,{min:12,max:360,step:1},{description:"Number of sphere points to sample per atom: 92 (original paper), 960 (BioJava), 3000 (EPPIC) - see Shrake A, Rupley JA: Environment and exposure to solvent of protein atoms. Lysozyme and insulin. J Mol Biol 1973."}),probeSize:E.Numeric(1.4,{min:.1,max:4,step:.01},{description:"Corresponds to the size of a water molecule: 1.4 (original paper), 1.5 (occassionally used)"}),nonPolymer:E.Boolean(!1,{description:"Include non-polymer atoms as occluders."}),traceOnly:E.Boolean(!1,{description:"Compute only using alpha-carbons, if true increase probeSize accordingly (e.g., 4 A). Considers only canonical amino acids."})},xp;(function(e){function t(l,c){var d=this;c===void 0&&(c={});var f=w(w({},E.getDefaultValues(JB)),c);return We.create("Compute Accessible Surface Area",function(p){return ce(d,void 0,void 0,function(){return de(this,function(h){switch(h.label){case 0:return[4,r(p,l,f)];case 1:return[2,h.sent()]}})})})}e.compute=t;function r(l,c,d){return ce(this,void 0,void 0,function(){var f,p,h;return de(this,function(v){switch(v.label){case 0:return f=n(c,d),Mbe(f),[4,Obe(l,f)];case 1:return v.sent(),p=f.area,h=f.serialResidueIndex,[2,{area:p,serialResidueIndex:h}]}})})}function n(l,c){var d=l.elementCount,f=l.atomicResidueCount,p=c.probeSize,h=c.nonPolymer,v=c.traceOnly,m=c.numberOfSpherePoints;return{structure:l,probeSize:p,nonPolymer:h,traceOnly:v,spherePoints:a(m),scalingConstant:4*Math.PI/m,maxLookupRadius:2*c.probeSize+2*ic[2],atomRadiusType:new Int8Array(d),serialResidueIndex:new Int32Array(d),area:new Float32Array(f)}}function a(l){for(var c=[],d=Math.PI*(3-Math.sqrt(5)),f=2/l,p=0;p<l;++p){var h=p*f-1+f/2,v=Math.sqrt(1-h*h),m=p*d;c[c.length]=C.create(Math.cos(m)*v,h,Math.sin(m)*v)}return c}function i(l,c){var d=ZB[l]||Ibe;return c/d}e.normalize=i;function o(l,c){var d=c.area,f=c.serialResidueIndex,p=f[Je.indexOf(Je.ofSortedArray(l.structure.root.serialMapping.elementIndices),l.element)];return p===-1?-1:d[p]}e.getValue=o;function s(l,c){var d=o(l,c);return d===-1?-1:i(ct.atom.label_comp_id(l),d)}e.getNormalizedValue=s;function u(l,c){var d=s(l,c);return d===-1?0:d<.16?1:2}e.getFlag=u})(xp||(xp={}));var U2=w({},JB),X3={isBuried:mp.Dynamic(LP("computed","accessible-surface-area.is-buried",De.Bool),function(e){if(!ze.isAtomic(e.element.unit))return!1;var t=Co.get(e.element.structure).value;return t?xp.getFlag(e.element,t)===1:!1}),isAccessible:mp.Dynamic(LP("computed","accessible-surface-area.is-accessible",De.Bool),function(e){if(!ze.isAtomic(e.element.unit))return!1;var t=Co.get(e.element.structure).value;return t?xp.getFlag(e.element,t)===2:!1})},Co=yc.createProvider({label:"Accessible Surface Area",descriptor:Pi({name:"molstar_accessible_surface_area",symbols:X3}),type:"root",defaultParams:U2,getParams:function(e){return U2},isApplicable:function(e){return!0},obtain:function(e,t,r){return ce(void 0,void 0,void 0,function(){var n,a;return de(this,function(i){switch(i.label){case 0:return n=w(w({},E.getDefaultValues(U2)),r),a={},[4,xp.compute(t,n).runInContext(e.runtime)];case 1:return[2,(a.value=i.sent(),a)]}})})}}),z2=it(16448250),kbe="Assigns a color based on the relative accessible surface area of a residue.",eL={list:E.ColorList("rainbow",{presetKind:"scale"})};function Bbe(e){return eL}function tL(e,t){var r,n=us.create({listOrName:t.list.colors,minLabel:"buried",maxLabel:"exposed",domain:[0,1]}),a=e.structure&&Co.get(e.structure),i=a?jd(a.id,a.version):-1;if((a==null?void 0:a.value)&&e.structure){var o=Ze.create(e.structure),s=a.value,u=function(l){var c=xp.getNormalizedValue(l,s);return c===-1?z2:n.color(c)};r=function(l){return Ze.is(l)&&ze.isAtomic(l.unit)?u(l):Ht.isLocation(l)?(o.unit=l.aUnit,o.element=l.aUnit.elements[l.aIndex],u(o)):z2}}else r=function(){return z2};return{factory:tL,granularity:"group",preferSmoothing:!0,color:r,props:t,contextHash:i,description:kbe,legend:n?n.legend:void 0}}var hI={name:"accessible-surface-area",label:"Accessible Surface Area",category:"Residue Property",factory:tL,getParams:Bbe,defaultValues:E.getDefaultValues(eL),isApplicable:function(e){return!!e.structure},ensureCustomProperties:{attach:function(e,t){return t.structure?Co.attach(e,t.structure,void 0,!0):Promise.resolve()},detach:function(e){return e.structure&&Co.ref(e.structure,!1)}}},Lbe=Mr.create({name:"computed-accessible-surface-area-prop",category:"custom-props",display:{name:"Accessible Surface Area"},ctor:function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.provider=Co,r.labelProvider={label:function(n){if(!!r.params.showTooltip)return Nbe(n)}},r}return t.prototype.update=function(r){var n=this.params.autoAttach!==r.autoAttach||this.params.showTooltip!==r.showTooltip;return this.params.autoAttach=r.autoAttach,this.params.showTooltip=r.showTooltip,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),n},t.prototype.register=function(){_g.addCustomProp(this.provider.descriptor),this.ctx.customStructureProperties.register(this.provider,this.params.autoAttach),this.ctx.representation.structure.themes.colorThemeRegistry.add(hI),this.ctx.managers.lociLabels.addProvider(this.labelProvider),this.ctx.query.structure.registry.add(vI),this.ctx.query.structure.registry.add(mI)},t.prototype.unregister=function(){_g.removeCustomProp(this.provider.descriptor),this.ctx.customStructureProperties.unregister(this.provider.descriptor.name),this.ctx.representation.structure.themes.colorThemeRegistry.remove(hI),this.ctx.managers.lociLabels.removeProvider(this.labelProvider),this.ctx.query.structure.registry.remove(vI),this.ctx.query.structure.registry.remove(mI)},t}(Mr.Handler),params:function(){return{autoAttach:E.Boolean(!1),showTooltip:E.Boolean(!0)}}});function Nbe(e){if(e.kind==="element-loci"){if(e.elements.length===0)return;var t=Co.get(e.structure).value;if(!t||e.structure.customPropertyDescriptors.hasReference(Co.descriptor))return;for(var r=e.structure.root.serialMapping.getSerialIndex,n=t.area,a=t.serialResidueIndex,i=new Set,o=0,s=function(h,v){var m=v.elements;ke.forEach(h,function(g){var y=a[r(v,m[g])];y!==-1&&!i.has(y)&&(o+=n[y],i.add(y))})},u=0,l=e.elements;u<l.length;u++){var c=l[u],d=c.indices,f=c.unit;s(d,f)}if(i.size===0)return;var p="<small>("+i.size+" "+(i.size>1?"Residues sum":"Residue")+")</small>";return"Accessible Surface Area "+p+": "+o.toFixed(2)+" \u212B<sup>2</sup>"}else if(e.kind==="structure-loci"){var t=Co.get(e.structure).value;return!t||e.structure.customPropertyDescriptors.hasReference(Co.descriptor)?void 0:"Accessible Surface Area <small>(Whole Structure)</small>: "+Hh(t.area).toFixed(2)+" \u212B<sup>2</sup>"}}var vI=Nr("Buried Protein Residues",se.struct.modifier.union([se.struct.modifier.wholeResidues([se.struct.modifier.union([se.struct.generator.atomGroups({"chain-test":se.core.rel.eq([se.ammp("objectPrimitive"),"atomistic"]),"residue-test":X3.isBuried.symbol()})])])]),{description:"Select buried protein residues.",category:Lr.Residue,ensureCustomProperties:function(e,t){return Co.attach(e,t)}}),mI=Nr("Accessible Protein Residues",se.struct.modifier.union([se.struct.modifier.wholeResidues([se.struct.modifier.union([se.struct.generator.atomGroups({"chain-test":se.core.rel.eq([se.ammp("objectPrimitive"),"atomistic"]),"residue-test":X3.isAccessible.symbol()})])])]),{description:"Select accessible protein residues.",category:Lr.Residue,ensureCustomProperties:function(e,t){return Co.attach(e,t)}}),Ube=Mr.create({name:"computed-interactions-prop",category:"custom-props",display:{name:"Interactions"},ctor:function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.provider=Dn,r.labelProvider={label:function(n){if(!!r.params.showTooltip)switch(n.kind){case"element-loci":if(n.elements.length===0)return;for(var a=[],i=r.getStructures(n.structure),o=0,s=i;o<s.length;o++){var u=s[o],l=r.provider.get(u).value;if(!!l){var c=Re.remap(n,u);if(c.elements.length===1){var d=c.elements[0];if(ke.size(d.indices)===1){var f=l.unitsFeatures.get(d.unit.id);if(!!f){for(var p=[],h=[],v=[],m=ke.start(d.indices),g=f.types,y=f.groups,b=f.elementsIndex,x=b.indices,S=b.offsets,_=S[m],A=S[m+1];_<A;++_){var T=x[_],I=g[T],M=y[T];I&&p.push(Qme(I)),M&&h.push(Zme(M))}p.length&&v.push("<small>Types</small> "+p.join(", ")),h.length&&v.push("<small>Groups</small> "+h.join(", ")),v.length&&a.push("Interaction Feature: "+v.join(" | "))}}}}}return a.length?a.join("<br/>"):void 0;default:return}}},r}return t.prototype.getStructures=function(r){var n=[],a=this.ctx.helpers.substructureParent.get(r);if(a)for(var i=this.ctx.state.data,o=i.select(ar.Generators.ofType(ge.Molecule.Structure,a.transform.ref)),s=0,u=o;s<u.length;s++){var l=u[s];l.obj&&Xa(n,l.obj.data)}return n},t.prototype.update=function(r){var n=this.params.autoAttach!==r.autoAttach||this.params.showTooltip!==r.showTooltip;return this.params.autoAttach=r.autoAttach,this.params.showTooltip=r.showTooltip,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),n},t.prototype.register=function(){this.ctx.customStructureProperties.register(this.provider,this.params.autoAttach),this.ctx.representation.structure.themes.colorThemeRegistry.add(EC),this.ctx.managers.lociLabels.addProvider(this.labelProvider),this.ctx.representation.structure.registry.add(Xg)},t.prototype.unregister=function(){this.ctx.customStructureProperties.unregister(this.provider.descriptor.name),this.ctx.representation.structure.themes.colorThemeRegistry.remove(EC),this.ctx.managers.lociLabels.removeProvider(this.labelProvider),this.ctx.representation.structure.registry.remove(Xg)},t}(Mr.Handler),params:function(){return{autoAttach:E.Boolean(!1),showTooltip:E.Boolean(!0)}}}),zbe=Mr.create({name:"computed-secondary-structure-prop",category:"custom-props",display:{name:"Secondary Structure"},ctor:function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.provider=Xs,r}return t.prototype.update=function(r){var n=this.params.autoAttach!==r.autoAttach;return this.params.autoAttach=r.autoAttach,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),n},t.prototype.register=function(){this.ctx.customStructureProperties.register(this.provider,this.params.autoAttach)},t.prototype.unregister=function(){this.ctx.customStructureProperties.unregister(this.provider.descriptor.name)},t}(Mr.Handler),params:function(){return{autoAttach:E.Boolean(!1)}}}),Vbe=Mr.create({name:"computed-valence-model-prop",category:"custom-props",display:{name:"Valence Model"},ctor:function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.provider=zv,r.labelProvider={label:function(n){if(!!r.params.showTooltip)switch(n.kind){case"element-loci":if(n.elements.length===0)return;for(var a=[],i=r.getStructures(n.structure),o=0,s=i;o<s.length;o++){var u=s[o],l=r.provider.get(u).value;if(!!l){var c=Re.remap(n,u);if(c.elements.length===1){var d=c.elements[0];if(ke.size(d.indices)===1){var f=l.get(d.unit.id);if(!!f){var p=ke.start(d.indices),h=f.charge[p],v=f.idealGeometry[p],m=f.implicitH[p],g=f.totalH[p];a.push("Valence Model: <small>Charge</small> "+h+" | <small>Ideal Geometry</small> "+qme(v)+" | <small>Implicit H</small> "+m+" | <small>Total H</small> "+g)}}}}}return a.length?a.join("<br/>"):void 0;default:return}}},r}return t.prototype.getStructures=function(r){var n=[],a=this.ctx.helpers.substructureParent.get(r);if(a)for(var i=this.ctx.state.data,o=i.select(ar.Generators.ofType(ge.Molecule.Structure,a.transform.ref)),s=0,u=o;s<u.length;s++){var l=u[s];l.obj&&Xa(n,l.obj.data)}return n},t.prototype.update=function(r){var n=this.params.autoAttach!==r.autoAttach||this.params.showTooltip!==r.showTooltip;return this.params.autoAttach=r.autoAttach,this.params.showTooltip=r.showTooltip,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),n},t.prototype.register=function(){this.ctx.customStructureProperties.register(this.provider,this.params.autoAttach),this.ctx.managers.lociLabels.addProvider(this.labelProvider)},t.prototype.unregister=function(){this.ctx.customStructureProperties.unregister(this.provider.descriptor.name),this.ctx.managers.lociLabels.removeProvider(this.labelProvider)},t}(Mr.Handler),params:function(){return{autoAttach:E.Boolean(!1),showTooltip:E.Boolean(!0)}}}),os;(function(e){var t=this;e.Provider=Bd.createProvider({label:"Best Database Sequence Mapping",descriptor:Pi({name:"molstar_best_database_sequence_mapping"}),type:"static",defaultParams:{},getParams:function(){return{}},isApplicable:function(i){var o,s;return Jr.is(i.sourceData)&&((s=(o=i.sourceData.data.frame.categories)===null||o===void 0?void 0:o.atom_site)===null||s===void 0?void 0:s.fieldNames.indexOf("db_name"))>=0},obtain:function(i,o){return ce(t,void 0,void 0,function(){return de(this,function(s){return[2,{value:a(o)}]})})}});function r(i){var o=i.unit.model,s=e.Provider.get(o).value;if(!s)return"";var u=i.unit.elements[i.element],l=o.atomicHierarchy.residueAtomSegments.offsets[u];return s.accession[l]}e.getKey=r;function n(i){var o=i.unit.model,s=e.Provider.get(o).value;if(!!s){var u=i.unit.elements[i.element],l=o.atomicHierarchy.residueAtomSegments.offsets[u],c=s.dbName[l];if(!!c)return c+" "+s.accession[l]+" "+s.num[l]+" "+s.residue[l]}}e.getLabel=n;function a(i){if(!!Jr.is(i.sourceData)){var o=i.sourceData.data.frame.categories.atom_site,s=o.getField("db_name"),u=o.getField("db_acc"),l=o.getField("db_num"),c=o.getField("db_res");if(!(!s||!u||!l||!c)){for(var d=i.atomicHierarchy.atomSourceIndex,f=i.atomicHierarchy.residueAtomSegments,p=f.count,h=f.offsets,v=new Array(p),m=new Array(p),g=new Array(p),y=new Array(p),b=0;b<p;b++){var x=d.value(h[b]);if(s.valueKind(x)!==0){v[x]="",m[x]="",g[x]=0,y[x]="";continue}v[x]=s.str(x),m[x]=u.str(x),g[x]=l.int(x),y[x]=c.str(x)}return{dbName:v,accession:m,num:g,residue:y}}}}})(os||(os={}));var V2=it(16448250),Hbe="Assigns a color based on best dababase sequence mapping.",sh=new Map,rL=w({},ro({type:"colors",colorList:"set-1"}));function Gbe(e){return rL}function nL(e,t){var r;if(e.structure){for(var n=0,a=e.structure.models;n<a.length;n++){var i=a[n],o=os.Provider.get(i).value;if(!!o)for(var s=0,u=o.accession;s<u.length;s++){var l=u[s];!l||sh.has(l)||sh.set(l,sh.size)}}var c=Ze.create(e.structure),d=ko(sh.size+1,t,{valueLabel:function(h){return""+h}}),f=new Map,p=function(h){var v=os.getKey(h);if(!v)return V2;if(f.has(v))return f.get(v);var m=d.color(sh.get(v));return f.set(v,m),m};r=function(h){return Ze.is(h)&&ze.isAtomic(h.unit)?p(h):Ht.isLocation(h)?(c.unit=h.aUnit,c.element=h.aUnit.elements[h.aIndex],p(c)):V2}}else r=function(){return V2};return{factory:nL,granularity:"group",preferSmoothing:!0,color:r,props:t,description:Hbe}}var gI={name:"best-sequence-database-mapping",label:"Best Database Sequence Mapping",category:"Residue Property",factory:nL,getParams:Gbe,defaultValues:E.getDefaultValues(rL),isApplicable:function(e){var t;return!!(!((t=e.structure)===null||t===void 0)&&t.models.some(function(r){return os.Provider.isApplicable(r)}))},ensureCustomProperties:{attach:function(e,t){return ce(void 0,void 0,void 0,function(){var r,n,a;return de(this,function(i){switch(i.label){case 0:if(!t.structure)return[2];r=0,n=t.structure.models,i.label=1;case 1:return r<n.length?(a=n[r],[4,os.Provider.attach(e,a,void 0,!0)]):[3,4];case 2:i.sent(),i.label=3;case 3:return r++,[3,1];case 4:return[2]}})})},detach:function(e){if(!!e.structure)for(var t=0,r=e.structure.models;t<r.length;t++){var n=r[t];os.Provider.ref(n,!1)}}}},qbe=Mr.create({name:"best-sequence-database-mapping-prop",category:"custom-props",display:{name:"Best Database Sequence Mapping"},ctor:function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.provider=os.Provider,r.labelProvider={label:function(n){if(!!r.params.showTooltip)return jbe(n)}},r}return t.prototype.update=function(r){var n=this.params.autoAttach!==r.autoAttach||this.params.showTooltip!==r.showTooltip;return this.params.autoAttach=r.autoAttach,this.params.showTooltip=r.showTooltip,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),n},t.prototype.register=function(){this.ctx.customModelProperties.register(this.provider,this.params.autoAttach),this.ctx.representation.structure.themes.colorThemeRegistry.add(gI),this.ctx.managers.lociLabels.addProvider(this.labelProvider)},t.prototype.unregister=function(){this.ctx.customModelProperties.unregister(this.provider.descriptor.name),this.ctx.representation.structure.themes.colorThemeRegistry.remove(gI),this.ctx.managers.lociLabels.removeProvider(this.labelProvider)},t}(Mr.Handler),params:function(){return{autoAttach:E.Boolean(!0),showTooltip:E.Boolean(!0)}}});function jbe(e){if(e.kind==="element-loci"){if(e.elements.length===0)return;var t=e.elements[0],r=t.unit,n=Ze.create(e.structure,r,r.elements[ke.getAt(t.indices,0)]);return os.getLabel(n)}}var $u;(function(e){e.Descriptor={name:"ihm_cross_link_restraint"},e.Provider=ds.create(e.Descriptor);function t(r,n){var a={entity_id:r.entity_id_1,asym_id:r.asym_id_1,seq_id:r.seq_id_1,atom_id:r.atom_id_1},i={entity_id:r.entity_id_2,asym_id:r.asym_id_2,seq_id:r.seq_id_2,atom_id:r.atom_id_2};function o(h,v,m){var g=h.get(v);g?g.push(m):h.set(v,[m])}function s(h,v){var m=v.entity_id.value(h),g=v.asym_id.value(h),y=v.seq_id.value(h);if(r.model_granularity.value(h)==="by-atom"){var b=n.atomicHierarchy.index.findAtom({auth_seq_id:y,label_asym_id:g,label_atom_id:v.atom_id.value(h),label_entity_id:m});b>=0&&o(l,b,h)}else if(n.coarseHierarchy.isDefined){var x=n.coarseHierarchy.spheres.findSequenceKey(m,g,y);if(x>=0)o(c,x,h);else{var S=n.coarseHierarchy.gaussians.findSequenceKey(m,g,y);S>=0&&o(d,S,h)}}}function u(h){switch(h){case 0:return l;case 1:return c;case 2:return d}}for(var l=new Map,c=new Map,d=new Map,f=[],p=0;p<r._rowCount;++p)s(p,a),s(p,i);return{getIndicesByElement:function(h,v){var m=u(v),g=m.get(h);return g!==void 0?g:f},data:r}}e.fromTable=t})($u||($u={}));var Wbe=[];function yI(e,t,r,n){return e+"|"+t.id+"|"+r+"|"+n.id}var bI=function(){function e(t){this.pairs=t;var r=new Map;this.pairs.forEach(function(n,a){var i=yI(n.indexA,n.unitA,n.indexB,n.unitB),o=r.get(i);o?o.push(a):r.set(i,[a])}),this.count=t.length,this.pairKeyIndices=r}return e.prototype.getPairIndices=function(t,r,n,a){var i=yI(t,r,n,a);return this.pairKeyIndices.get(i)||Wbe},e.prototype.getPairs=function(t,r,n,a){var i=this,o=this.getPairIndices(t,r,n,a);return o.map(function(s){return i.pairs[s]})},e}(),Qu=yc.createProvider({label:"Cross Link Restraint",descriptor:Pi({name:"integrative-cross-link-restraint"}),type:"local",defaultParams:{},getParams:function(e){return{}},isApplicable:function(e){return e.models.some(function(t){return!!$u.Provider.get(t)})},obtain:function(e,t,r){return ce(void 0,void 0,void 0,function(){return de(this,function(n){return[2,{value:Kbe(t)}]})})}}),ss;(function(e){(function(h){h.CrossLinkRestraint="cross-link-restraint"})(e.Tag||(e.Tag={}));function t(h){return h.models.some(function(v){return!!$u.Provider.get(v)})}e.isApplicable=t;var r=C(),n=C();function a(h){return h.unitA.conformation.position(h.unitA.elements[h.indexA],r),h.unitB.conformation.position(h.unitB.elements[h.indexB],n),C.distance(r,n)}e.distance=a;function i(h,v,m){return t6("cross-link-restraints",{structure:v,crossLinkRestraints:h},m)}e.Location=i;function o(h){return!!h&&h.kind==="data-location"&&h.tag==="cross-link-restraints"}e.isLocation=o;function s(h,v){return h.data.structure===v.data.structure&&h.data.crossLinkRestraints===v.data.crossLinkRestraints&&h.element===v.element}e.areLocationsEqual=s;function u(h,v){var m=h.pairs[v];return"Cross Link Restraint | Type: "+m.restraintType+" | Threshold: "+m.distanceThreshold+" \u212B | Psi: "+m.psi+" | Sigma 1: "+m.sigma1+" | Sigma 2: "+m.sigma2+" | Distance: "+a(m).toFixed(2)+" \u212B"}function l(h){return u(h.data.crossLinkRestraints,h.element)}e.locationLabel=l;function c(h,v,m){return i1("cross-link-restraints",{structure:h,crossLinkRestraints:v},m,function(g){return f(v,m,g)},function(){return p(h,v,m)})}e.Loci=c;function d(h){return!!h&&h.kind==="data-loci"&&h.tag==="interactions"}e.isLoci=d;function f(h,v,m){return qu.fromPairProvider(v.length,function(g,y,b){var x=h.pairs[v[g]];x.unitA.conformation.position(x.unitA.elements[x.indexA],y),x.unitB.conformation.position(x.unitB.elements[x.indexB],b)},m)}e.getBoundingSphere=f;function p(h,v,m){var g=m[0];if(g===void 0)return"";var y=v.pairs[g];return[u(v,g),E3(Ht.Location(h,y.unitA,y.indexA,h,y.unitB,y.indexB))].join("</br>")}e.getLabel=p})(ss||(ss={}));function SI(e,t,r){for(var n=t.elements,a=n.length,i=t.kind,o=function(u){var l=n[u];r.getIndicesByElement(l,i).forEach(function(c){return e.set(c,u)})},s=0;s<a;s++)o(s)}function Xbe(e,t,r){if(t.model===r.model&&t.model.sourceData.kind==="mmCIF"){var n=$u.Provider.get(t.model);if(!!n){var a=new Map,i=new Map;SI(a,t,n),SI(i,r,n),a.forEach(function(o,s){var u=i.get(s);u!==void 0&&e.push(Qg(t,o,r,u,n,s),Qg(r,u,t,o,n,s))})}}}function Ybe(e,t){if(t.model.sourceData.kind==="mmCIF"){var r=$u.Provider.get(t.model);if(!!r){for(var n=t.elements,a=n.length,i=t.kind,o=new Map,s=function(l){var c=n[l];r.getIndicesByElement(c,i).forEach(function(d){var f=o.get(d);f?f.push(l):o.set(d,[l])})},u=0;u<a;u++)s(u);o.forEach(function(l,c){if(!(l.length<2)){var d=l[0],f=l[1];e.push(Qg(t,d,t,f,r,c),Qg(t,f,t,d,r,c))}})}}}function Qg(e,t,r,n,a,i){return{unitA:e,indexA:t,unitB:r,indexB:n,restraintType:a.data.restraint_type.value(i),distanceThreshold:a.data.distance_threshold.value(i),psi:a.data.psi.value(i),sigma1:a.data.sigma_1.value(i),sigma2:a.data.sigma_2.value(i)}}function Kbe(e){var t=[];if(!e.models.some(function(s){return $u.Provider.get(s)}))return new bI(t);for(var r=e.units.length,n=0;n<r;++n){var a=e.units[n];Ybe(t,a);for(var i=n+1;i<r;++i){var o=e.units[i];a.model===o.model&&Xbe(t,a,o)}}return new bI(t)}function $be(e,t,r,n,a){var i=Qu.get(t).value;if(!i.count)return Lt.createEmpty(a);var o=n.sizeFactor,s=Ze.create(t),u={linkCount:i.count,position:function(l,c,d){var f=i.pairs[d],p=f.unitA,h=f.unitB;p.conformation.position(p.elements[f.indexA],l),h.conformation.position(h.elements[f.indexB],c)},radius:function(l){var c=i.pairs[l];return s.unit=c.unitA,s.element=c.unitA.elements[c.indexA],r.size.size(s)*o}};return af(e,u,n,a)}var aL=w(w(w({},Uv),nf),{sizeFactor:E.Numeric(.5,{min:0,max:10,step:.1})});function Qbe(e){return tf({defaultProps:E.getDefaultValues(aL),createGeometry:$be,createLocationIterator:Zbe,getLoci:Jbe,eachLocation:e2e,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.radialSegments!==n.radialSegments||r.linkCap!==n.linkCap}},e)}function Zbe(e){var t=Qu.get(e).value,r=t.pairs,n=r.length,a=1,i=ss.Location(t,e),o=function(s){return i.element=s,i};return pn(n,a,1,o,!0)}function Jbe(e,t,r){var n=e.objectId,a=e.groupId;if(r===n){var i=Qu.get(t).value,o=i.pairs[a];if(o)return ss.Loci(t,i,[a])}return Or}function e2e(e,t,r){var n=!1;if(ss.isLoci(e)){if(!Xe.areEquivalent(e.data.structure,t))return!1;var a=Qu.get(t).value;if(e.data.crossLinkRestraints!==a)return!1;for(var i=0,o=e.elements;i<o.length;i++){var s=o[i];r(Ie.ofSingleton(s))&&(n=!0)}}return n}var t2e={"cross-link-restraint":function(e,t){return as("Cross-link restraint",e,t,Qbe)}},iL=w({},aL);function r2e(e,t){return E.clone(iL)}function n2e(e,t){return or.createMulti("CrossLinkRestraint",e,t,da,t2e)}var xI={name:ss.Tag.CrossLinkRestraint,label:"Cross Link Restraint",description:"Displays cross-link restraints.",factory:n2e,getParams:r2e,defaultValues:E.getDefaultValues(iL),defaultColorTheme:{name:ss.Tag.CrossLinkRestraint},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return ss.isApplicable(e)},ensureCustomProperties:{attach:function(e,t){return Qu.attach(e,t,void 0,!0)},detach:function(e){return Qu.ref(e,!1)}}},CI=it(13421772),a2e="Colors cross-links by the deviation of the observed distance versus the modeled distance (e.g. modeled / `ihm_cross_link_restraint.distance_threshold`).",oL={domain:E.Interval([.5,1.5],{step:.01}),list:E.ColorList("red-grey",{presetKind:"scale"})};function i2e(e){return oL}function sL(e,t){var r,n=void 0,a=e.structure&&Qu.get(e.structure).value;if(a){n=us.create({domain:t.domain,listOrName:t.list.colors});var i=n.color;r=function(o){if(ss.isLocation(o)){var s=a.pairs[o.element];if(s)return i(ss.distance(s)/s.distanceThreshold)}return CI}}else r=function(){return CI};return{factory:sL,granularity:"group",color:r,props:t,description:a2e,legend:n?n.legend:void 0}}var _I={name:"cross-link",label:"Cross Link",category:"Miscellaneous",factory:sL,getParams:i2e,defaultValues:E.getDefaultValues(oL),isApplicable:function(e){return!!e.structure&&ss.isApplicable(e.structure)},ensureCustomProperties:{attach:function(e,t){return t.structure?Qu.attach(e,t.structure,void 0,!0):Promise.resolve()},detach:function(e){return e.structure&&Qu.ref(e.structure,!1)}}},o2e=Mr.create({name:"integrative-cross-link-restraint",category:"custom-props",display:{name:"Cross Link Restraint"},ctor:function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.provider=$u.Provider,r}return t.prototype.register=function(){this.provider.formatRegistry.add("mmCIF",s2e),this.ctx.representation.structure.themes.colorThemeRegistry.add(_I),this.ctx.representation.structure.registry.add(xI)},t.prototype.unregister=function(){this.provider.formatRegistry.remove("mmCIF"),this.ctx.representation.structure.themes.colorThemeRegistry.remove(_I),this.ctx.representation.structure.registry.remove(xI)},t}(Mr.Handler)});function s2e(e){if(!!Jr.is(e.sourceData)){var t=e.sourceData.data.db.ihm_cross_link_restraint;if(t._rowCount!==0)return $u.fromTable(t,e)}}var u2e=Object.freeze(Object.defineProperty({__proto__:null,StructureInfo:Ebe,AccessibleSurfaceArea:Lbe,Interactions:Ube,SecondaryStructure:zbe,ValenceModel:Vbe,BestDatabaseSequenceMapping:qbe,CrossLinkRestraint:o2e},Symbol.toStringTag,{value:"Module"})),$m={State:gye,Representation:bye,Camera:xye,Misc:pbe},Ni={Representation:Cbe,Camera:Tbe,CustomProps:u2e},l2e=function(e){var t=rt.Representation.StructureRepresentation3D.definition.params(void 0,e);return{expandRadius:E.Numeric(5,{min:1,max:10,step:1}),targetParams:E.Group(t,{label:"Target",customDefault:O0(e,void 0,{type:"ball-and-stick",size:"physical",typeParams:{sizeFactor:.26,alpha:.51}})}),surroundingsParams:E.Group(t,{label:"Surroundings",customDefault:O0(e,void 0,{type:"ball-and-stick",size:"physical",typeParams:{sizeFactor:.16}})}),nciParams:E.Group(t,{label:"Non-covalent Int.",customDefault:O0(e,void 0,{type:Xg,color:EC,size:ba.BuiltIn.uniform})}),components:E.MultiSelect(wI,E.arrayToOptions(wI)),excludeTargetFromSurroundings:E.Boolean(!1,{label:"Exclude Target",description:'Exclude the focus "target" from the surroudings component.'}),ignoreHydrogens:E.Boolean(!1)}},wI=["target","surroundings","interactions"],nn;(function(e){e.TargetSel="structure-focus-target-sel",e.TargetRepr="structure-focus-target-repr",e.SurrSel="structure-focus-surr-sel",e.SurrRepr="structure-focus-surr-repr",e.SurrNciRepr="structure-focus-surr-nci-repr"})(nn||(nn={}));var c2e=new Set([nn.TargetSel,nn.TargetRepr,nn.SurrSel,nn.SurrRepr,nn.SurrNciRepr]),d2e=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.currentSource=void 0,r}return Object.defineProperty(t.prototype,"surrLabel",{get:function(){return"[Focus] Surroundings ("+this.params.expandRadius+" \xC5)"},enumerable:!1,configurable:!0}),t.prototype.getReprParams=function(r){return w(w({},this.params.targetParams),{type:{name:r.type.name,params:w(w({},r.type.params),{ignoreHydrogens:this.params.ignoreHydrogens})}})},t.prototype.ensureShape=function(r){var n,a=this.plugin.state.data,i=a.tree,o=a.build(),s=ar.findUniqueTagsInSubtree(i,r.transform.ref,c2e);s[nn.TargetSel]||(s[nn.TargetSel]=o.to(r).apply(rt.Model.StructureSelectionFromBundle,{bundle:Qr.Empty,label:"[Focus] Target"},{tags:nn.TargetSel}).ref),s[nn.SurrSel]||(s[nn.SurrSel]=o.to(r).apply(rt.Model.StructureSelectionFromExpression,{expression:se.struct.generator.empty(),label:this.surrLabel},{tags:nn.SurrSel}).ref);var u=this.params.components;return u.indexOf("target")>=0&&!s[nn.TargetRepr]&&(s[nn.TargetRepr]=o.to(s[nn.TargetSel]).apply(rt.Representation.StructureRepresentation3D,this.getReprParams(this.params.targetParams),{tags:nn.TargetRepr}).ref),u.indexOf("surroundings")>=0&&!s[nn.SurrRepr]&&(s[nn.SurrRepr]=o.to(s[nn.SurrSel]).apply(rt.Representation.StructureRepresentation3D,this.getReprParams(this.params.surroundingsParams),{tags:nn.SurrRepr}).ref),u.indexOf("interactions")>=0&&!s[nn.SurrNciRepr]&&r.obj&&Xg.isApplicable((n=r.obj)===null||n===void 0?void 0:n.data)&&(s[nn.SurrNciRepr]=o.to(s[nn.SurrSel]).apply(rt.Representation.StructureRepresentation3D,this.params.nciParams,{tags:nn.SurrNciRepr}).ref),{state:a,builder:o,refs:s}},t.prototype.clear=function(r){var n=this.plugin.state.data;this.currentSource=void 0;var a=n.select(ar.Generators.byRef(r).subtree().withTag(nn.TargetSel)),i=n.select(ar.Generators.byRef(r).subtree().withTag(nn.SurrSel));if(!(a.length===0&&i.length===0)){for(var o=n.build(),s=Qr.Empty,u=0,l=a;u<l.length;u++){var c=l[u];o.to(c).update(rt.Model.StructureSelectionFromBundle,function(v){return w(w({},v),{bundle:s})})}for(var d=se.struct.generator.empty(),f=0,p=i;f<p.length;f++){var h=p[f];o.to(h).update(rt.Model.StructureSelectionFromExpression,function(v){return w(w({},v),{expression:d})})}return wt.State.Update(this.plugin,{state:n,tree:o,options:{doNotLogTiming:!0,doNotUpdateCurrent:!0}})}},t.prototype.focus=function(r){return ce(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d,f,p=this;return de(this,function(h){switch(h.label){case 0:return n=this.plugin.helpers.substructureParent.get(r.structure),!n||!n.obj?[2]:(this.currentSource=r,a=Re.remap(r,n.obj.data),i=Re.extendToWholeResidues(a),o=Qr.fromLoci(i),s=Qr.toExpression(o),u=se.struct.modifier.includeSurroundings({0:s,radius:this.params.expandRadius,"as-whole-residues":!0}),this.params.excludeTargetFromSurroundings&&(u=se.struct.modifier.exceptBy({0:u,by:s})),l=this.ensureShape(n),c=l.state,d=l.builder,f=l.refs,d.to(f[nn.TargetSel]).update(rt.Model.StructureSelectionFromBundle,function(v){return w(w({},v),{bundle:o})}),d.to(f[nn.SurrSel]).update(rt.Model.StructureSelectionFromExpression,function(v){return w(w({},v),{expression:u,label:p.surrLabel})}),[4,wt.State.Update(this.plugin,{state:c,tree:d,options:{doNotLogTiming:!0,doNotUpdateCurrent:!0}})]);case 1:return h.sent(),[2]}})})},t.prototype.register=function(r){var n=this;this.subscribeObservable(this.plugin.managers.structure.focus.behaviors.current,function(a){a?n.focus(a.loci):n.clear(cr.RootRef)})},t.prototype.update=function(r){return ce(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,v,d,f,v,p,h,v;return de(this,function(m){switch(m.label){case 0:if(n=this.params,this.params=r,n.excludeTargetFromSurroundings!==r.excludeTargetFromSurroundings)return this.currentSource&&this.focus(this.currentSource),[2,!0];for(a=this.plugin.state.data,i=a.build(),o=ar.Generators.root.subtree(),s=this.params.components,u=s.indexOf("target")>=0,l=0,c=a.select(o.withTag(nn.TargetRepr));l<c.length;l++)v=c[l],u?i.to(v).update(this.getReprParams(this.params.targetParams)):i.delete(v.transform.ref);for(u=s.indexOf("surroundings")>=0,d=0,f=a.select(o.withTag(nn.SurrRepr));d<f.length;d++)v=f[d],u?i.to(v).update(this.getReprParams(this.params.surroundingsParams)):i.delete(v.transform.ref);for(u=s.indexOf("interactions")>=0,p=0,h=a.select(o.withTag(nn.SurrNciRepr));p<h.length;p++)v=h[p],u?i.to(v).update(this.params.nciParams):i.delete(v.transform.ref);return[4,wt.State.Update(this.plugin,{state:a,tree:i,options:{doNotLogTiming:!0,doNotUpdateCurrent:!0}})];case 1:return m.sent(),r.expandRadius!==n.expandRadius?(this.currentSource&&this.focus(this.currentSource),[2,!0]):[2,!0]}})})},t}(Mr.WithSubscribers),Y3=Mr.create({name:"create-structure-focus-representation",display:{name:"Structure Focus Representation"},category:"interaction",ctor:d2e,params:function(e,t){return l2e(t)}});function fi(e){return e}(function(e){e.CommonParams={ignoreHydrogens:E.Optional(E.Boolean(!1)),quality:E.Optional(E.Select("auto",Z_)),theme:E.Optional(E.Group({globalName:E.Optional(E.Text("")),carbonColor:E.Optional(E.Select("chain-id",E.arrayToOptions(["chain-id","operator-name","element-symbol"]))),symmetryColor:E.Optional(E.Text("")),focus:E.Optional(E.Group({name:E.Optional(E.Text("")),params:E.Optional(E.Value({}))}))}))};function t(i){return i==="chain-id"?{name:i,params:AF.defaultValues}:i==="operator-name"?{name:i,params:P3.defaultValues}:{name:i,params:{}}}function r(i){return i.units.some(function(o){return!o.conformation.operator.assembly&&o.conformation.operator.spgrOp>=0})}function n(i,o,s){var u,l,c,d,f,p,h=i.state.data.build(),v=i.builders.structure.representation,m={quality:i.managers.structure.component.state.options.visualQuality,ignoreHydrogens:!i.managers.structure.component.state.options.showHydrogens};o.quality&&o.quality!=="auto"&&(m.quality=o.quality),o.ignoreHydrogens!==void 0&&(m.ignoreHydrogens=!!o.ignoreHydrogens);var g=!((u=o.theme)===null||u===void 0)&&u.globalName?(l=o.theme)===null||l===void 0?void 0:l.globalName:void 0,y=((c=o.theme)===null||c===void 0?void 0:c.carbonColor)!==void 0?{carbonColor:t((d=o.theme)===null||d===void 0?void 0:d.carbonColor)}:{},b=s&&((f=o.theme)===null||f===void 0?void 0:f.symmetryColor)&&r(s)?(p=o.theme)===null||p===void 0?void 0:p.symmetryColor:g;return{update:h,builder:v,color:g,symmetryColor:b,typeParams:m,ballAndStickColor:y}}e.reprBuilder=n;function a(i,o,s,u){return i.state.updateBehavior(Y3,function(l){var c=IC(i,o,"ball-and-stick",s||"element-symbol",u);l.surroundingsParams.colorTheme=c,l.targetParams.colorTheme=c})}e.updateFocusRepr=a})(fi||(fi={}));var zp=fi.CommonParams,Hv=fi.reprBuilder,_1=fi.updateFocusRepr,f2e=fi({id:"preset-structure-representation-auto",display:{name:"Automatic",description:"Show representations based on the size of the structure. Smaller structures are shown with more detail than larger ones, ranging from atomistic display to coarse surfaces."},params:function(){return zp},apply:function(e,t,r){var n,a,i=(a=(n=ua.resolveAndCheck(r.state.data,e))===null||n===void 0?void 0:n.obj)===null||a===void 0?void 0:a.data;if(!i)return{};var o=r.config.get(jr.Structure.SizeThresholds)||Xe.DefaultSizeThresholds,s=Xe.getSize(i,o),u=i.polymerResidueCount/i.polymerGapCount;switch(s){case Xe.Size.Gigantic:case Xe.Size.Huge:return lL.apply(e,t,r);case Xe.Size.Large:return cL.apply(e,t,r);case Xe.Size.Medium:if(u>3)return uL.apply(e,t,r);case Xe.Size.Small:return dL.apply(e,w(w({},t),{showCarbohydrateSymbol:!0}),r);default:yC()}}}),p2e=fi({id:"preset-structure-representation-empty",display:{name:"Empty",description:"Removes all existing representations."},apply:function(e,t,r){return ce(this,void 0,void 0,function(){return de(this,function(n){return[2,{}]})})}}),Gv="Basic",uL=fi({id:"preset-structure-representation-polymer-and-ligand",display:{name:"Polymer & Ligand",group:Gv,description:"Shows polymers as Cartoon, ligands as Ball & Stick, carbohydrates as 3D-SNFG and water molecules semi-transparent."},params:function(){return zp},apply:function(e,t,r){var n,a,i,o,s,u,l,c,d,f;return ce(this,void 0,void 0,function(){var p,h,v,m,g,y,b,x,S,_,A,T,I,M,O;return de(this,function(D){switch(D.label){case 0:return p=ua.resolveAndCheck(r.state.data,e),p?(O={},[4,zi(r,p,"polymer")]):[2,{}];case 1:return O.polymer=D.sent(),[4,zi(r,p,"ligand")];case 2:return O.ligand=D.sent(),[4,zi(r,p,"non-standard")];case 3:return O.nonStandard=D.sent(),[4,zi(r,p,"branched",{label:"Carbohydrate"})];case 4:return O.branched=D.sent(),[4,zi(r,p,"water")];case 5:return O.water=D.sent(),[4,zi(r,p,"ion")];case 6:return O.ion=D.sent(),[4,zi(r,p,"lipid")];case 7:return O.lipid=D.sent(),[4,zi(r,p,"coarse")];case 8:return h=(O.coarse=D.sent(),O),v=p.obj.data,m={sizeFactor:v.isCoarseGrained?.8:.2},g=(((i=(a=(n=h.water)===null||n===void 0?void 0:n.obj)===null||a===void 0?void 0:a.data)===null||i===void 0?void 0:i.elementCount)||0)>5e4?"line":"ball-and-stick",y=(((u=(s=(o=h.lipid)===null||o===void 0?void 0:o.obj)===null||s===void 0?void 0:s.data)===null||u===void 0?void 0:u.elementCount)||0)>2e4?"line":"ball-and-stick",b=Hv(r,t,v),x=b.update,S=b.builder,_=b.typeParams,A=b.color,T=b.symmetryColor,I=b.ballAndStickColor,M={polymer:S.buildRepresentation(x,h.polymer,{type:"cartoon",typeParams:w(w({},_),m),color:T},{tag:"polymer"}),ligand:S.buildRepresentation(x,h.ligand,{type:"ball-and-stick",typeParams:_,color:A,colorParams:I},{tag:"ligand"}),nonStandard:S.buildRepresentation(x,h.nonStandard,{type:"ball-and-stick",typeParams:_,color:A,colorParams:I},{tag:"non-standard"}),branchedBallAndStick:S.buildRepresentation(x,h.branched,{type:"ball-and-stick",typeParams:w(w({},_),{alpha:.3}),color:A,colorParams:I},{tag:"branched-ball-and-stick"}),branchedSnfg3d:S.buildRepresentation(x,h.branched,{type:"carbohydrate",typeParams:_,color:A},{tag:"branched-snfg-3d"}),water:S.buildRepresentation(x,h.water,{type:g,typeParams:w(w({},_),{alpha:.6}),color:A,colorParams:{carbonColor:{name:"element-symbol",params:{}}}},{tag:"water"}),ion:S.buildRepresentation(x,h.ion,{type:"ball-and-stick",typeParams:_,color:A,colorParams:{carbonColor:{name:"element-symbol",params:{}}}},{tag:"ion"}),lipid:S.buildRepresentation(x,h.lipid,{type:y,typeParams:w(w({},_),{alpha:.6}),color:A,colorParams:{carbonColor:{name:"element-symbol",params:{}}}},{tag:"lipid"}),coarse:S.buildRepresentation(x,h.coarse,{type:"spacefill",typeParams:_,color:A||"chain-id"},{tag:"coarse"})},[4,x.commit({revertOnError:!1})];case 9:return D.sent(),[4,_1(r,v,(c=(l=t.theme)===null||l===void 0?void 0:l.focus)===null||c===void 0?void 0:c.name,(f=(d=t.theme)===null||d===void 0?void 0:d.focus)===null||f===void 0?void 0:f.params)];case 10:return D.sent(),[2,{components:h,representations:M}]}})})}}),h2e=fi({id:"preset-structure-representation-protein-and-nucleic",display:{name:"Protein & Nucleic",group:Gv,description:"Shows proteins as Cartoon and RNA/DNA as Gaussian Surface."},params:function(){return zp},apply:function(e,t,r){var n,a,i,o;return ce(this,void 0,void 0,function(){var s,u,l,c,d,f,p,h,v,m,g,y;return de(this,function(b){switch(b.label){case 0:return s=ua.resolveAndCheck(r.state.data,e),s?(y={},[4,AI(r,s,"protein")]):[2,{}];case 1:return y.protein=b.sent(),[4,AI(r,s,"nucleic")];case 2:return u=(y.nucleic=b.sent(),y),l=s.obj.data,c={sizeFactor:l.isCoarseGrained?.8:.2},d={radiusOffset:l.isCoarseGrained?2:0,smoothness:l.isCoarseGrained?1:1.5},f=Hv(r,t,l),p=f.update,h=f.builder,v=f.typeParams,m=f.symmetryColor,g={protein:h.buildRepresentation(p,u.protein,{type:"cartoon",typeParams:w(w({},v),c),color:m},{tag:"protein"}),nucleic:h.buildRepresentation(p,u.nucleic,{type:"gaussian-surface",typeParams:w(w({},v),d),color:m},{tag:"nucleic"})},[4,p.commit({revertOnError:!0})];case 3:return b.sent(),[4,_1(r,l,(a=(n=t.theme)===null||n===void 0?void 0:n.focus)===null||a===void 0?void 0:a.name,(o=(i=t.theme)===null||i===void 0?void 0:i.focus)===null||o===void 0?void 0:o.params)];case 4:return b.sent(),[2,{components:u,representations:g}]}})})}}),lL=fi({id:"preset-structure-representation-coarse-surface",display:{name:"Coarse Surface",group:Gv,description:"Shows polymers and lipids as coarse Gaussian Surface."},params:function(){return zp},apply:function(e,t,r){var n,a,i,o;return ce(this,void 0,void 0,function(){var s,u,l,c,d,f,p,h,v,m,g,y;return de(this,function(b){switch(b.label){case 0:return s=ua.resolveAndCheck(r.state.data,e),s?(y={},[4,zi(r,s,"polymer")]):[2,{}];case 1:return y.polymer=b.sent(),[4,zi(r,s,"lipid")];case 2:return u=(y.lipid=b.sent(),y),l=s.obj.data,c=Xe.getSize(l),d=Object.create(null),c===Xe.Size.Gigantic?Object.assign(d,{traceOnly:!l.isCoarseGrained,radiusOffset:2,smoothness:1,visuals:["structure-gaussian-surface-mesh"]}):c===Xe.Size.Huge?Object.assign(d,{radiusOffset:l.isCoarseGrained?2:0,smoothness:1}):l.isCoarseGrained&&Object.assign(d,{radiusOffset:2,smoothness:1}),f=Hv(r,t,l),p=f.update,h=f.builder,v=f.typeParams,m=f.symmetryColor,g={polymer:h.buildRepresentation(p,u.polymer,{type:"gaussian-surface",typeParams:w(w({},v),d),color:m},{tag:"polymer"}),lipid:h.buildRepresentation(p,u.lipid,{type:"gaussian-surface",typeParams:w(w({},v),d),color:m},{tag:"lipid"})},[4,p.commit({revertOnError:!0})];case 3:return b.sent(),[4,_1(r,l,(a=(n=t.theme)===null||n===void 0?void 0:n.focus)===null||a===void 0?void 0:a.name,(o=(i=t.theme)===null||i===void 0?void 0:i.focus)===null||o===void 0?void 0:o.params)];case 4:return b.sent(),[2,{components:u,representations:g}]}})})}}),cL=fi({id:"preset-structure-representation-polymer-cartoon",display:{name:"Polymer Cartoon",group:Gv,description:"Shows polymers as Cartoon."},params:function(){return zp},apply:function(e,t,r){var n,a,i,o;return ce(this,void 0,void 0,function(){var s,u,l,c,d,f,p,h,v,m,g;return de(this,function(y){switch(y.label){case 0:return s=ua.resolveAndCheck(r.state.data,e),s?(g={},[4,zi(r,s,"polymer")]):[2,{}];case 1:return u=(g.polymer=y.sent(),g),l=s.obj.data,c={sizeFactor:l.isCoarseGrained?.8:.2},d=Hv(r,t,l),f=d.update,p=d.builder,h=d.typeParams,v=d.symmetryColor,m={polymer:p.buildRepresentation(f,u.polymer,{type:"cartoon",typeParams:w(w({},h),c),color:v},{tag:"polymer"})},[4,f.commit({revertOnError:!0})];case 2:return y.sent(),[4,_1(r,l,(a=(n=t.theme)===null||n===void 0?void 0:n.focus)===null||a===void 0?void 0:a.name,(o=(i=t.theme)===null||i===void 0?void 0:i.focus)===null||o===void 0?void 0:o.params)];case 3:return y.sent(),[2,{components:u,representations:m}]}})})}}),dL=fi({id:"preset-structure-representation-atomic-detail",display:{name:"Atomic Detail",group:Gv,description:"Shows everything in atomic detail with Ball & Stick."},params:function(){return w(w({},zp),{showCarbohydrateSymbol:E.Boolean(!1)})},apply:function(e,t,r){return ce(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d,f,p,h,v,m,g,y,b,x,S,_,A,T;return de(this,function(I){switch(I.label){case 0:return n=ua.resolveAndCheck(r.state.data,e),n?(A={},[4,zi(r,n,"all")]):[2,{}];case 1:return a=(A.all=I.sent(),A.branched=void 0,A),i=n.obj.data,o=i.elementCount>1e5,s=i.atomicResidueCount&&i.elementCount>1e3&&i.atomicResidueCount/i.elementCount<3,u=i.models[0],l=!!Ba.Provider.get(u)||Ws.isExhaustive(u),c="ball-and-stick",i.isCoarseGrained?c=i.elementCount>1e6?"point":"spacefill":s&&!l?c="spacefill":o&&(c="line"),d=t.showCarbohydrateSymbol&&!o&&!s,d?(p=(f=Object).assign,h=[a],T={},[4,zi(r,n,"branched",{label:"Carbohydrate"})]):[3,3];case 2:p.apply(f,h.concat([(T.branched=I.sent(),T)])),I.label=3;case 3:return v=Hv(r,t,i),m=v.update,g=v.builder,y=v.typeParams,b=v.color,x=v.ballAndStickColor,S=s&&!l?{carbonColor:{name:"element-symbol",params:{}}}:x,_={all:g.buildRepresentation(m,a.all,{type:c,typeParams:y,color:b,colorParams:S},{tag:"all"})},d&&Object.assign(_,{snfg3d:g.buildRepresentation(m,a.branched,{type:"carbohydrate",typeParams:w(w({},y),{alpha:.4,visuals:["carbohydrate-symbol"]}),color:b},{tag:"snfg-3d"})}),[4,m.commit({revertOnError:!0})];case 4:return I.sent(),[2,{components:a,representations:_}]}})})}});function zi(e,t,r,n){return e.builders.structure.tryCreateComponentStatic(t,r,n)}function AI(e,t,r,n){return e.builders.structure.tryCreateComponentFromSelection(t,Xn[r],"selection-"+r,n)}var tp={empty:p2e,auto:f2e,"atomic-detail":dL,"polymer-cartoon":cL,"polymer-and-ligand":uL,"protein-and-nucleic":h2e,"coarse-surface":lL};function K3(e,t){if(e.ext==="bcif")try{if(D6(t).encoder.startsWith("VolumeServer"))return"dscif"}catch{}else if(e.ext==="cif"){var r=t;if(r.startsWith(`data_SERVER
#
_density_server_result`))return"dscif";if(r.includes("atom_site_fract_x")||r.includes("atom_site.fract_x"))return"coreCif"}return-1}var yl="Trajectory";function bl(e,t){return e.builders.structure.hierarchy.applyPreset(t.trajectory,"default")}var v2e={label:"mmCIF",description:"mmCIF",category:yl,stringExtensions:["cif","mmcif","mcif"],binaryExtensions:["bcif"],isApplicable:function(e,t){return e.ext==="mmcif"||e.ext==="mcif"?!0:e.ext==="cif"||e.ext==="bcif"?K3(e,t)===-1:!1},parse:function(e,t,r){return ce(void 0,void 0,void 0,function(){var n,a,i,o,s;return de(this,function(u){switch(u.label){case 0:return n=e.state.data,a=n.build().to(t).apply(rt.Data.ParseCif,void 0,{state:{isGhost:!0}}),[4,a.apply(rt.Model.TrajectoryFromMmCif,void 0,{tags:r==null?void 0:r.trajectoryTags}).commit({revertOnError:!0})];case 1:return i=u.sent(),(((s=(o=a.selector.cell)===null||o===void 0?void 0:o.obj)===null||s===void 0?void 0:s.data.blocks.length)||0)>1&&e.state.data.updateCellState(a.ref,{isGhost:!1}),[2,{trajectory:i}]}})})},visuals:bl},m2e={label:"cifCore",description:"CIF Core",category:yl,stringExtensions:["cif"],isApplicable:function(e,t){return e.ext==="cif"?K3(e,t)==="coreCif":!1},parse:function(e,t,r){return ce(void 0,void 0,void 0,function(){var n,a,i,o,s;return de(this,function(u){switch(u.label){case 0:return n=e.state.data,a=n.build().to(t).apply(rt.Data.ParseCif,void 0,{state:{isGhost:!0}}),[4,a.apply(rt.Model.TrajectoryFromCifCore,void 0,{tags:r==null?void 0:r.trajectoryTags}).commit({revertOnError:!0})];case 1:return i=u.sent(),(((s=(o=a.selector.cell)===null||o===void 0?void 0:o.obj)===null||s===void 0?void 0:s.data.blocks.length)||0)>1&&e.state.data.updateCellState(a.ref,{isGhost:!1}),[2,{trajectory:i}]}})})},visuals:bl};function of(e,t){var r=this;return function(n,a,i){return ce(r,void 0,void 0,function(){var o,s;return de(this,function(u){switch(u.label){case 0:return o=n.state.data,[4,o.build().to(a).apply(e,t,{tags:i==null?void 0:i.trajectoryTags}).commit({revertOnError:!0})];case 1:return s=u.sent(),[2,{trajectory:s}]}})})}}var g2e={label:"PDB",description:"PDB",category:yl,stringExtensions:["pdb","ent"],parse:of(rt.Model.TrajectoryFromPDB),visuals:bl},y2e={label:"PDBQT",description:"PDBQT",category:yl,stringExtensions:["pdbqt"],parse:of(rt.Model.TrajectoryFromPDB,{isPdbqt:!0}),visuals:bl},b2e={label:"XYZ",description:"XYZ",category:yl,stringExtensions:["xyz"],parse:of(rt.Model.TrajectoryFromXYZ),visuals:bl},S2e={label:"GRO",description:"GRO",category:yl,stringExtensions:["gro"],binaryExtensions:[],parse:of(rt.Model.TrajectoryFromGRO),visuals:bl},x2e={label:"MOL",description:"MOL",category:yl,stringExtensions:["mol"],parse:of(rt.Model.TrajectoryFromMOL),visuals:bl},C2e={label:"SDF",description:"SDF",category:yl,stringExtensions:["sdf","sd"],parse:of(rt.Model.TrajectoryFromSDF),visuals:bl},_2e={label:"MOL2",description:"MOL2",category:yl,stringExtensions:["mol2"],parse:of(rt.Model.TrajectoryFromMOL2),visuals:bl},fL=[["mmcif",v2e],["cifCore",m2e],["pdb",g2e],["pdbqt",y2e],["gro",S2e],["xyz",b2e],["mol",x2e],["sdf",C2e],["mol2",_2e]],w2e=function(e){return E.Group({type:wd.getParams(void 0,"auto").type,representation:E.Select(tp.auto.id,e.builders.structure.representation.getPresets().map(function(t){return[t.id,t.display.name,t.display.group]}),{description:"Which representation preset to use."}),representationParams:E.Group(fi.CommonParams,{isHidden:!0}),asTrajectory:E.Optional(E.Boolean(!1,{description:"Load all entries into a single trajectory."}))},{isExpanded:!1})},$3={rcsb:E.Group({encoding:E.Select("bcif",[["cif","cif"],["bcif","bcif"]])},{label:"RCSB PDB",isFlat:!0}),pdbe:E.Group({variant:E.Select("updated-bcif",[["updated-bcif","Updated (bcif)"],["updated","Updated"],["archival","Archival"]])},{label:"PDBe",isFlat:!0})},VC=Ai.build({from:ge.Root,display:{name:"Download Structure",description:"Load a structure from the provided source and create its representation."},params:function(e,t){var r=w2e(t),n=t.config.get(jr.Download.DefaultPdbProvider)||"pdbe";return{source:E.MappedStatic("pdb",{pdb:E.Group({provider:E.Group({id:E.Text("1tqn",{label:"PDB Id(s)",description:"One or more comma/space separated PDB ids."}),server:E.MappedStatic(n,$3)},{pivot:"id"}),options:r},{isFlat:!0,label:"PDB"}),"pdb-dev":E.Group({provider:E.Group({id:E.Text("PDBDEV_00000001",{label:"PDBDev Id(s)",description:"One or more comma/space separated ids."}),encoding:E.Select("bcif",[["cif","cif"],["bcif","bcif"]])},{pivot:"id"}),options:r},{isFlat:!0,label:"PDBDEV"}),swissmodel:E.Group({id:E.Text("Q9Y2I8",{label:"UniProtKB AC(s)",description:"One or more comma/space separated ACs."}),options:r},{isFlat:!0,label:"SWISS-MODEL",description:"Loads the best homology model or experimental structure"}),pubchem:E.Group({id:E.Text("2244,2245",{label:"PubChem ID",description:"One or more comma/space separated IDs."}),options:r},{isFlat:!0,label:"PubChem",description:"Loads 3D conformer from PubChem."}),url:E.Group({url:E.Url(""),format:E.Select("mmcif",E.arrayToOptions(fL.map(function(a){return a[0]}),function(a){return a})),isBinary:E.Boolean(!1),options:r},{isFlat:!0,label:"URL"})})}}})(function(e,t){var r=e.params,n=e.state;return We.create("Download Structure",function(a){return ce(void 0,void 0,void 0,function(){var i,o,s,u,l,c,d;return de(this,function(f){switch(f.label){case 0:switch(t.behaviors.layout.leftPanelTabName.next("data"),i=r.source,s=!1,u="mmcif",i.name){case"url":o=[{url:i.params.url,isBinary:i.params.isBinary}],u=i.params.format;break;case"pdb":o=i.params.provider.server.name==="pdbe"?i.params.provider.server.params.variant==="updated"?Dl(i.params.provider.id,function(p){return"https://www.ebi.ac.uk/pdbe/static/entry/"+p.toLowerCase()+"_updated.cif"},function(p){return"PDBe: "+p+" (updated cif)"},!1):i.params.provider.server.params.variant==="updated-bcif"?Dl(i.params.provider.id,function(p){return"https://www.ebi.ac.uk/pdbe/entry-files/download/"+p.toLowerCase()+".bcif"},function(p){return"PDBe: "+p+" (updated cif)"},!0):Dl(i.params.provider.id,function(p){return"https://www.ebi.ac.uk/pdbe/static/entry/"+p.toLowerCase()+".cif"},function(p){return"PDBe: "+p+" (cif)"},!1):i.params.provider.server.params.encoding==="cif"?Dl(i.params.provider.id,function(p){return"https://files.rcsb.org/download/"+p.toUpperCase()+".cif"},function(p){return"RCSB: "+p+" (cif)"},!1):Dl(i.params.provider.id,function(p){return"https://models.rcsb.org/"+p.toUpperCase()+".bcif"},function(p){return"RCSB: "+p+" (bcif)"},!0),s=!!i.params.options.asTrajectory;break;case"pdb-dev":o=Dl(i.params.provider.id,function(p){var h=p.toUpperCase().startsWith("PDBDEV_")?p:"PDBDEV_"+p.padStart(8,"0");return i.params.provider.encoding==="bcif"?"https://pdb-dev.wwpdb.org/bcif/"+h.toUpperCase()+".bcif":"https://pdb-dev.wwpdb.org/cif/"+h.toUpperCase()+".cif"},function(p){return p.toUpperCase().startsWith("PDBDEV_")?p:"PDBDEV_"+p.padStart(8,"0")},i.params.provider.encoding==="bcif"),s=!!i.params.options.asTrajectory;break;case"swissmodel":o=Dl(i.params.id,function(p){return"https://swissmodel.expasy.org/repository/uniprot/"+p.toUpperCase()+".pdb"},function(p){return"SWISS-MODEL: "+p},!1),s=!!i.params.options.asTrajectory,u="pdb";break;case"pubchem":o=Dl(i.params.id,function(p){return"https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/CID/"+p.trim()+"/record/SDF/?record_type=3d"},function(p){return"PubChem: "+p},!1),s=!!i.params.options.asTrajectory,u="mol";break;default:throw new Error(i.name+" not supported.")}return l=r.source.params.options.representation||tp.auto.id,c=l!==tp.empty.id,d=i.params.options.type.name==="auto"?void 0:i.params.options.type,[4,n.transaction(function(){return ce(void 0,void 0,void 0,function(){var p,y,h,v,m,g,y;return de(this,function(b){switch(b.label){case 0:return o.length>0&&s?[4,t.builders.data.downloadBlob({sources:o.map(function(x,S){return{id:""+S,url:x.url,isBinary:x.isBinary}}),maxConcurrency:6},{state:{isGhost:!0}})]:[3,4];case 1:return p=b.sent(),[4,t.builders.structure.parseTrajectory(p,{formats:o.map(function(x,S){return{id:""+S,format:"cif"}})})];case 2:return y=b.sent(),[4,t.builders.structure.hierarchy.applyPreset(y,"default",{structure:d,showUnitcell:c,representationPreset:l,representationPresetParams:r.source.params.options.representationParams})];case 3:return b.sent(),[3,10];case 4:h=0,v=o,b.label=5;case 5:return h<v.length?(m=v[h],[4,t.builders.data.download(m,{state:{isGhost:!0}})]):[3,10];case 6:return g=b.sent(),[4,t.builders.structure.parseTrajectory(g,u)];case 7:return y=b.sent(),[4,t.builders.structure.hierarchy.applyPreset(y,"default",{structure:d,showUnitcell:c,representationPreset:l,representationPresetParams:r.source.params.options.representationParams})];case 8:b.sent(),b.label=9;case 9:return h++,[3,5];case 10:return[2]}})})}).runInContext(a)];case 1:return f.sent(),[2]}})})})});function Dl(e,t,r,n){for(var a=e.split(/[,\s]/).map(function(l){return l.trim()}).filter(function(l){return!!l&&(l.length>=4||/^[1-9][0-9]*$/.test(l))}),i=[],o=0,s=a;o<s.length;o++){var u=s[o];i.push({url:gn.Url(t(u)),isBinary:n,label:r(u)})}return i}var k0=Ai.build({display:{name:"Update Trajectory"},params:{action:E.Select("advance",[["advance","Advance"],["reset","Reset"]]),by:E.Optional(E.Numeric(1,{min:-1,max:1,step:1}))}})(function(e){var t=e.params,r=e.state,n=r.selectQ(function(d){return d.ofTransformer(rt.Model.ModelFromTrajectory)}),a=r.build();if(t.action==="reset")for(var i=0,o=n;i<o.length;i++){var s=o[i];a.to(s).update({modelIndex:0})}else for(var u=function(d){var f=ar.findAncestorOfType(r.tree,r.cells,d.transform.ref,ge.Molecule.Trajectory);if(!f||!f.obj)return"continue";var p=f.obj;a.to(d).update(function(h){var v=(h.modelIndex+t.by)%p.data.frameCount;return v<0&&(v+=p.data.frameCount),{modelIndex:v}})},l=0,c=n;l<c.length;l++){var s=c[l];u(s)}return r.updateTree(a)}),A2e=Ai.build({display:{name:"Custom Model Properties",description:"Enable parameters for custom properties of the model."},from:ge.Molecule.Model,params:function(e,t){return t.customModelProperties.getParams(e==null?void 0:e.data)},isApplicable:function(e,t,r){return t.transformer!==mF}})(function(e,t){var r=e.ref,n=e.params;return t.builders.structure.insertModelProperties(r,n)}),P2e=Ai.build({display:{name:"Custom Structure Properties",description:"Enable parameters for custom properties of the structure."},from:ge.Molecule.Structure,params:function(e,t){return t.customStructureProperties.getParams(e==null?void 0:e.data)},isApplicable:function(e,t,r){return t.transformer!==gF}})(function(e,t){var r=e.ref,n=e.params;return t.builders.structure.insertStructureProperties(r,n)}),T2e=Ai.build({display:{name:"Add Trajectory",description:"Add trajectory from existing model/topology and coordinates."},from:ge.Root,params:function(e,t){var r=t.state.data,n=Nt(Nt([],r.selectQ(function(s){return s.rootsOfType(ge.Molecule.Model)})),r.selectQ(function(s){return s.rootsOfType(ge.Molecule.Topology)})),a=n.map(function(s){return[s.transform.ref,s.obj.label]}),i=r.selectQ(function(s){return s.rootsOfType(ge.Molecule.Coordinates)}),o=i.map(function(s){return[s.transform.ref,s.obj.label]});return{model:E.Select(a.length?a[0][0]:"",a),coordinates:E.Select(o.length?o[0][0]:"",o)}}})(function(e,t){var r=e.params,n=e.state;return We.create("Add Trajectory",function(a){return n.transaction(function(){return ce(void 0,void 0,void 0,function(){var i,o,s;return de(this,function(u){switch(u.label){case 0:return i=[r.model,r.coordinates],o=n.build().toRoot().apply(hF,{modelRef:r.model,coordinatesRef:r.coordinates},{dependsOn:i}).apply(rt.Model.ModelFromTrajectory,{modelIndex:0}),[4,n.updateTree(o).runInContext(a)];case 1:return u.sent(),[4,t.builders.structure.createStructure(o.selector)];case 2:return s=u.sent(),[4,t.builders.structure.representation.applyPreset(s,"auto")];case 3:return u.sent(),[2]}})})}).runInContext(a)})}),E2e=Object.freeze(Object.defineProperty({__proto__:null,PdbDownloadProvider:$3,DownloadStructure:VC,UpdateTrajectory:k0,EnableModelCustomProps:A2e,EnableStructureCustomProps:P2e,AddTrajectory:T2e},Symbol.toStringTag,{value:"Module"})),Jt=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.hide=function(){return r.props.onSelect(void 0)},r}return t.prototype.render=function(){var r=this.props,n=L(I2e,{items:r.items,onSelect:r.onSelect,current:r.current,multiselect:this.props.multiselect,noOffset:this.props.noOffset,noAccent:this.props.noAccent},void 0);return Te("div",w({className:"msp-action-menu-options"+(r.header?"":" msp-action-menu-options-no-header")},{children:[r.header&&L(Pu,w({header:r.header,title:r.title,initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.hide,topRightIcon:Au},{children:n}),void 0),!r.header&&n]}),void 0)},t}(kt.exports.PureComponent);(function(e){function t(l,c){return c?w({kind:"header",label:l},c):{kind:"header",label:l}}e.Header=t;function r(l,c,d){return w({kind:"item",label:l,value:c},d)}e.Item=r;function n(l,c){for(var d=c||{},f=d.label,p=d.value,h=d.category,v=d.selected,m=d.icon,g=d.addOn,y=d.description,b=void 0,x=[],S=0;S<l.length;S++){var _=l[S];if(!((c==null?void 0:c.filter)&&!c.filter(_))){var A=h==null?void 0:h(_),T=f?f(_):""+_,I=p?p(_):_,M=y?y(_):typeof _=="string"?_:void 0,O=void 0;A?(b||(b=new Map),O=b.get(A),O||(O=[e.Header(A,{description:A})],b.set(A,O),x.push(O))):O=x;var D=g==null?void 0:g(_);O.push({kind:"item",label:T,value:I,icon:m?m(_):void 0,selected:v?v(_):void 0,addOn:D,description:M})}}return x}e.createItems=n;var a={value:function(l){return l[0]},label:function(l){return l[1]},category:function(l){return l[2]}};function i(l,c){return n(l,c?w(w({},a),c):a)}e.createItemsFromSelectOptions=i;function o(l){if(Cu(l))return!1;if(rp(l))return!!l.selected;for(var c=0,d=l;c<d.length;c++){var f=d[c],p=o(f);if(p)return!0}return!1}e.hasSelectedItem=o;function s(l,c){if(!Cu(l)){if(rp(l))return l.value===c?l:void 0;for(var d=0,f=l;d<f.length;d++){var p=f[d],h=s(p,c);if(h)return h}}}e.findItem=s;function u(l){if(!Cu(l)){if(rp(l))return l;for(var c=0,d=l;c<d.length;c++){var f=d[c],p=u(f);if(p)return p}}}e.getFirstItem=u})(Jt||(Jt={}));var I2e=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state=t.createState(r.props),r.toggleExpanded=function(n){r.setState({isExpanded:!r.state.isExpanded}),n.currentTarget.blur()},r.selectAll=function(){var n=HC(r.props.items,[]).filter(function(a){return!a.selected});r.props.onSelect(n)},r.selectNone=function(){var n=HC(r.props.items,[]).filter(function(a){return!!a.selected});r.props.onSelect(n)},r}return t.createState=function(r,n){var a=H2(r.items)&&Cu(r.items[0])?r.items[0]:void 0,i=a!=null&&a.isIndependent?!1:r.multiselect?Jt.hasSelectedItem(r.items):!!r.current&&!!Jt.findItem(r.items,r.current.value)||Jt.hasSelectedItem(r.items);return{header:a,hasCurrent:i,isExpanded:i||(n!=null?n:!!(a!=null&&a.initiallyExpanded))}},t.prototype.componentDidUpdate=function(r){if(this.props.items!==r.items||this.props.current!==r.current){var n=H2(this.props.items)&&H2(r.items)&&Cu(this.props.items[0])&&Cu(r.items[0])&&this.props.items[0].label===r.items[0].label?this.state.isExpanded:void 0;this.setState(t.createState(this.props,n))}},Object.defineProperty(t.prototype,"multiselectHeader",{get:function(){var r=this.state,n=r.header,a=r.hasCurrent;return Te("div",w({className:"msp-flex-row msp-control-group-header"},{children:[L(pr,w({icon:this.state.isExpanded?Lu:Nu,flex:!0,noOverflow:!0,onClick:this.toggleExpanded,title:"Click to "+(this.state.isExpanded?"collapse":"expand")+"."+(n!=null&&n.description?" "+(n==null?void 0:n.description):"")},{children:a?L("b",{children:n==null?void 0:n.label},void 0):n==null?void 0:n.label}),void 0),L(pr,w({icon:wp,flex:!0,onClick:this.selectAll,style:{flex:"0 0 50px",textAlign:"right"}},{children:"All"}),void 0),L(pr,w({icon:Au,flex:!0,onClick:this.selectNone,style:{flex:"0 0 50px",textAlign:"right"}},{children:"None"}),void 0)]}),void 0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"basicHeader",{get:function(){var r=this.state,n=r.header,a=r.hasCurrent;return L("div",w({className:"msp-control-group-header",style:{marginTop:"1px"}},{children:L(pr,w({noOverflow:!0,icon:this.state.isExpanded?Lu:Nu,onClick:this.toggleExpanded,title:"Click to "+(this.state.isExpanded?"collapse":"expand")+". "+(n!=null&&n.description?n==null?void 0:n.description:"")},{children:a?L("b",{children:n==null?void 0:n.label},void 0):n==null?void 0:n.label}),void 0)}),void 0)},enumerable:!1,configurable:!0}),t.prototype.render=function(){var r=this,n=this.props,a=n.items,i=n.onSelect,o=n.current;if(Cu(a))return null;if(rp(a))return L(PI,{item:a,onSelect:i,current:o,multiselect:this.props.multiselect},void 0);var s=this.state.header;return Te(Rt,{children:[s&&(this.props.multiselect&&this.state.isExpanded?this.multiselectHeader:this.basicHeader),L("div",w({className:this.props.noOffset?void 0:this.props.noAccent?"msp-control-offset":"msp-accent-offset"},{children:(!s||this.state.isExpanded)&&a.map(function(u,l){return Cu(u)?null:rp(u)?L(PI,{item:u,onSelect:i,current:o,multiselect:r.props.multiselect},l):L(t,{items:u,onSelect:i,current:o,multiselect:r.props.multiselect,noAccent:!0},l)})}),void 0)]},void 0)},t}(kt.exports.PureComponent),PI=function(e){var t=e.item,r=e.onSelect,n=e.current,a=e.multiselect,i=n===t,o=t.addOn?{position:"relative"}:void 0;return Te(pr,w({icon:t.icon,noOverflow:!0,className:"msp-action-menu-button",onClick:function(s){return r(a?[t]:t,s)},disabled:t.disabled,style:o,title:t.description},{children:[i||t.selected?L("b",{children:t.label},void 0):t.label,t.addOn]}),void 0)};function H2(e){return!!e&&Array.isArray(e)}function rp(e){var t=e;return t&&t.kind==="item"}function Cu(e){var t=e;return t&&t.kind==="header"}function HC(e,t){if(Cu(e))return t;if(rp(e))return t.push(e),t;for(var r=0,n=e;r<n.length;r++){var a=n[r];HC(a,t)}return t}var Q3=[["black",0],["gray",8421504],["white",16777215],["red",13840661],["orange",14840576],["yellow",16565248],["green",6863872],["cyan",1484197],["blue",40160],["purple",8086783],["magenta",16394495],["violet",8200583]],M2e=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!!r.props.param.isExpanded,lightness:0},r.toggleExpanded=function(n){r.setState({isExpanded:!r.state.isExpanded}),n.currentTarget.blur()},r.onClickSwatch=function(n){var a=it(+(n.currentTarget.getAttribute("data-color")||"0"));a!==r.props.value&&(r.props.param.isExpanded||r.setState({isExpanded:!1}),r.update(a))},r.onR=function(n){var a=it.toRgb(r.props.value),i=a[1],o=a[2],s=it.fromRgb(n,i,o);s!==r.props.value&&r.update(s)},r.onG=function(n){var a=it.toRgb(r.props.value),i=a[0],o=a[2],s=it.fromRgb(i,n,o);s!==r.props.value&&r.update(s)},r.onB=function(n){var a=it.toRgb(r.props.value),i=a[0],o=a[1],s=it.fromRgb(i,o,n);s!==r.props.value&&r.update(s)},r.onLighten=function(){r.update(it.lighten(r.props.value,.1))},r.onDarken=function(){r.update(it.darken(r.props.value,.1))},r}return t.prototype.update=function(r){this.props.onChange({param:this.props.param,name:this.props.name,value:r})},t.prototype.swatch=function(){var r=this;return L("div",w({className:"msp-combined-color-swatch"},{children:Q3.map(function(n){return L(pr,{inline:!0,"data-color":n[1],onClick:r.onClickSwatch,style:{background:it.toStyle(n[1])}},n[1])})}),void 0)},t.prototype.render=function(){var r=this.props.param.label||Za(this.props.name),n=it.toRgb(this.props.value),a=n[0],i=n[1],o=n[2];return Te(Rt,{children:[L(Io,{title:this.props.param.description,label:r,control:L(pr,{onClick:this.toggleExpanded,inline:!0,className:"msp-combined-color-button",style:{background:it.toStyle(this.props.value)}},void 0)},void 0),this.state.isExpanded&&Te("div",w({className:"msp-control-offset"},{children:[this.swatch(),L(Io,{label:"RGB",className:"msp-control-label-short",control:Te("div",w({style:{display:"flex",textAlignLast:"center",left:"80px"}},{children:[L(Du,{onChange:this.onR,numeric:!0,value:a,delayMs:250,style:{order:1,flex:"1 1 auto",minWidth:0},className:"msp-form-control",onEnter:this.props.onEnter,blurOnEnter:!0,blurOnEscape:!0},void 0),L(Du,{onChange:this.onG,numeric:!0,value:i,delayMs:250,style:{order:2,flex:"1 1 auto",minWidth:0},className:"msp-form-control",onEnter:this.props.onEnter,blurOnEnter:!0,blurOnEscape:!0},void 0),L(Du,{onChange:this.onB,numeric:!0,value:o,delayMs:250,style:{order:3,flex:"1 1 auto",minWidth:0},className:"msp-form-control",onEnter:this.props.onEnter,blurOnEnter:!0,blurOnEscape:!0},void 0)]}),void 0)},void 0),Te("div",w({style:{display:"flex",textAlignLast:"center"}},{children:[L(pr,w({onClick:this.onLighten,style:{order:1,flex:"1 1 auto",minWidth:0},className:"msp-form-control"},{children:"Lighten"}),void 0),L(pr,w({onClick:this.onDarken,style:{order:1,flex:"1 1 auto",minWidth:0},className:"msp-form-control"},{children:"Darken"}),void 0)]}),void 0)]}),void 0)]},void 0)},t}(kt.exports.PureComponent),Qm=void 0;function D2e(){return Qm||(Qm=L(Rt,{children:Q3.map(function(e){return L("option",w({value:e[1],style:{background:""+it.toStyle(e[1])}},{children:ji(e[0])}),e[1])})},void 0),Qm)}var R2e=function(){for(var e=new Map,t=0,r=Q3;t<r.length;t++){var n=r[t];e.set(n[1],n[0])}return e}();function O2e(e){return R2e.has(e)?null:L("option",w({value:e,style:{background:""+it.toStyle(e)}},{children:it.toRgbString(e)}),it.toHexString(e))}function F2e(e){switch(e.kind){case"scale-legend":return k2e;case"table-legend":return B2e;default:var t=e;console.warn(t+" has no associated UI component");return}}var k2e=function(e){Be(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.render=function(){var r=this.props.legend,n=r.colors.map(function(a){return Array.isArray(a)?it.toStyle(a[0])+" "+100*a[1]+"%":it.toStyle(a)}).join(", ");return L("div",w({className:"msp-scale-legend"},{children:Te("div",w({style:{background:"linear-gradient(to right, "+n+")"}},{children:[L("span",w({style:{float:"left"}},{children:r.minLabel}),void 0),L("span",w({style:{float:"right"}},{children:r.maxLabel}),void 0)]}),void 0)}),void 0)},t}(kt.exports.PureComponent),B2e=function(e){Be(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.render=function(){var r=this.props.legend;return L("div",w({className:"msp-table-legend"},{children:r.table.map(function(n,a){var i=n[0],o=n[1];return Te("div",{children:[L("div",{className:"msp-table-legend-color",style:{backgroundColor:it.toStyle(o)}},void 0),L("div",w({className:"msp-table-legend-text"},{children:i}),void 0)]},a)})}),void 0)},t}(kt.exports.PureComponent),L2e=function(e){Be(t,e);function t(r){var n=e.call(this,r)||this;return n.state={show:!1},n.handleHover=n.handleHover.bind(n),n.handleHoverOff=n.handleHoverOff.bind(n),n.deletePoint=n.deletePoint.bind(n),n}return t.prototype.handleHover=function(){this.setState({show:!0});var r=Ge.create(this.props.nX,this.props.nY);this.props.onmouseover(r)},t.prototype.handleHoverOff=function(){this.setState({show:!1}),this.props.onmouseover(void 0)},t.prototype.deletePoint=function(){this.props.delete(this.props.id)},t.prototype.render=function(){return[L("circle",{r:"10",id:""+this.props.id,cx:this.props.x,cy:this.props.y,onClick:this.props.onclick,onDoubleClick:this.props.delete(this.props.id),onMouseEnter:this.handleHover,onMouseLeave:this.handleHoverOff,onMouseDown:this.props.onmousedown,fill:"black"},this.props.id+"circle")]},t}(kt.exports.Component),N2e=function(e){Be(t,e);function t(r){var n=e.call(this,r)||this;n.handleKeyDown=function(s){},n.handleKeyUp=function(s){},n.handleClick=function(s){return function(u){}},n.handleMouseDown=function(s){return function(u){if(!(s===0||s===n.state.points.length-1)&&!n.state.canSelectMultiple){var l=n.normalizePoint(Ge.create(n.state.points[s][0],n.state.points[s][1]));n.ghostPoints.push(document.createElementNS(n.namespace,"circle")),n.ghostPoints[0].setAttribute("r","10"),n.ghostPoints[0].setAttribute("fill","orange"),n.ghostPoints[0].setAttribute("cx",""+l[0]),n.ghostPoints[0].setAttribute("cy",""+l[1]),n.ghostPoints[0].setAttribute("style","display: none"),n.gElement.appendChild(n.ghostPoints[0]),n.updatedX=l[0],n.updatedY=l[1],n.selected=[s]}}},n.deletePoint=function(s){return function(u){if(!(s===0||s===n.state.points.length-1)){var l=n.state.points.filter(function(c,d){return d!==s});l.sort(function(c,d){return c[0]===d[0]?c[0]===0?c[1]-d[1]:c[1]===1?d[1]-c[1]:c[1]-d[1]:c[0]-d[0]}),n.setState({points:l}),n.change(l),u.stopPropagation()}}},n.myRef=kt.exports.createRef(),n.state={points:[Ge.create(0,0),Ge.create(1,0)],copyPoint:void 0,canSelectMultiple:!1},n.height=400,n.width=600,n.padding=70,n.selected=void 0,n.ghostPoints=[],n.namespace="http://www.w3.org/2000/svg";for(var a=0,i=n.props.data;a<i.length;a++){var o=i[a];n.state.points.push(o)}return n.state.points.sort(function(s,u){return s[0]===u[0]?s[0]===0?s[1]-u[1]:s[1]===1?u[1]-s[1]:s[1]-u[1]:s[0]-u[0]}),n.handleDrag=n.handleDrag.bind(n),n.handleMultipleDrag=n.handleMultipleDrag.bind(n),n.handleDoubleClick=n.handleDoubleClick.bind(n),n.refCallBack=n.refCallBack.bind(n),n.handlePointUpdate=n.handlePointUpdate.bind(n),n.change=n.change.bind(n),n.handleKeyUp=n.handleKeyUp.bind(n),n.handleLeave=n.handleLeave.bind(n),n.handleEnter=n.handleEnter.bind(n),n}return t.prototype.render=function(){var r=this.renderPoints(),n=this.renderLines();return[L("div",{children:Te("svg",w({className:"msp-canvas",ref:this.refCallBack,viewBox:"0 0 "+(this.width+this.padding)+" "+(this.height+this.padding),onMouseMove:this.handleDrag,onMouseUp:this.handlePointUpdate,onMouseLeave:this.handleLeave,onMouseEnter:this.handleEnter,tabIndex:0,onKeyDown:this.handleKeyDown,onKeyUp:this.handleKeyUp,onDoubleClick:this.handleDoubleClick},{children:[Te("g",w({stroke:"black",fill:"black"},{children:[n,r]}),void 0),L("g",{className:"ghost-points",stroke:"black",fill:"black"},void 0)]}),void 0)},"LineGraph"),L("div",{id:"modal-root"},"modal")]},t.prototype.componentDidMount=function(){this.gElement=document.getElementsByClassName("ghost-points")[0]},t.prototype.change=function(r){var n=r.slice();n.shift(),n.pop(),this.props.onChange(n)},t.prototype.handleDrag=function(r){if(this.selected!==void 0){var n=this.myRef.createSVGPoint(),a,i=this.padding/2;n.x=r.clientX,n.y=r.clientY;var o=n.matrixTransform(this.myRef.getScreenCTM().inverse());a=Ge.create(o.x,o.y),(o.x<i||o.x>this.width+i)&&(o.y>this.height+i||o.y<i)?a=Ge.create(this.updatedX,this.updatedY):o.x<i?a=Ge.create(i,o.y):o.x>this.width+i?a=Ge.create(this.width+i,o.y):o.y>this.height+i?a=Ge.create(o.x,this.height+i):o.y<i?a=Ge.create(o.x,i):a=Ge.create(o.x,o.y),this.updatedX=a[0],this.updatedY=a[1];var s=this.unNormalizePoint(a);this.ghostPoints[0].setAttribute("style","display: visible"),this.ghostPoints[0].setAttribute("cx",""+a[0]),this.ghostPoints[0].setAttribute("cy",""+a[1]),this.props.onDrag(s)}},t.prototype.handleMultipleDrag=function(){},t.prototype.handlePointUpdate=function(r){var n=this.selected;if(!this.state.canSelectMultiple){if(n===void 0||n[0]===0||n[0]===this.state.points.length-1){this.setState({copyPoint:void 0});return}this.selected=void 0;var a=this.unNormalizePoint(Ge.create(this.updatedX,this.updatedY)),i=this.state.points.filter(function(o,s){return s!==n[0]});i.push(a),i.sort(function(o,s){return o[0]===s[0]?o[0]===0?o[1]-s[1]:o[1]===1?s[1]-o[1]:o[1]-s[1]:o[0]-s[0]}),this.setState({points:i}),this.change(i),this.gElement.innerHTML="",this.ghostPoints=[],document.removeEventListener("mousemove",this.handleDrag,!0),document.removeEventListener("mouseup",this.handlePointUpdate,!0)}},t.prototype.handleDoubleClick=function(r){var n,a=this.myRef.createSVGPoint();a.x=r.clientX,a.y=r.clientY;var i=a.matrixTransform(this.myRef.getScreenCTM().inverse()),o=this.state.points,s=this.padding/2;i.x<s||i.x>this.width+s||i.y>this.height+s||i.y<this.padding/2||(n=this.unNormalizePoint(Ge.create(i.x,i.y)),o.push(n),o.sort(function(u,l){return u[0]===l[0]?u[0]===0?u[1]-l[1]:u[1]===1?l[1]-u[1]:u[1]-l[1]:u[0]-l[0]}),this.setState({points:o}),this.change(o))},t.prototype.handleLeave=function(){this.selected!==void 0&&(document.addEventListener("mousemove",this.handleDrag,!0),document.addEventListener("mouseup",this.handlePointUpdate,!0))},t.prototype.handleEnter=function(){document.removeEventListener("mousemove",this.handleDrag,!0),document.removeEventListener("mouseup",this.handlePointUpdate,!0)},t.prototype.normalizePoint=function(r){var n=this.padding/2,a=this.width+n,i=this.height+n,o=r[0]*(a-n)+n,s=r[1]*(i-n)+n,u=this.height+this.padding-s,l=Ge.create(o,u);return l},t.prototype.unNormalizePoint=function(r){var n=this.padding/2,a=this.width+n,i=this.height+n,o=(r[0]-n)/(a-n),s=(this.height+this.padding-r[1]-n)/(i-n);return Ge.create(o,s)},t.prototype.refCallBack=function(r){r&&(this.myRef=r)},t.prototype.renderPoints=function(){for(var r=[],n,a=0;a<this.state.points.length;a++)a!==0&&a!==this.state.points.length-1&&(n=this.normalizePoint(this.state.points[a]),r.push(L(L2e,{id:a,x:n[0],y:n[1],nX:this.state.points[a][0],nY:this.state.points[a][1],selected:!1,delete:this.deletePoint,onmouseover:this.props.onHover,onmousedown:this.handleMouseDown(a),onclick:this.handleClick(a)},a)));return r},t.prototype.renderLines=function(){for(var r=[],n=[],a,i,o,s,u,l,c=0,d=this.state.points;c<d.length;c++){var f=d[c];a=this.padding/2,i=this.width+a,o=this.height+a,s=f[0]*(i-a)+a,u=f[1]*(o-a)+a,l=this.height+this.padding-u,r.push(Ge.create(s,l))}for(var p=r,h=p.length,v=0;v<h-1;v++){var m=p[v][0],g=p[v][1],y=p[v+1][0],b=p[v+1][1];n.push(L("line",{x1:m,x2:y,y1:g,y2:b,stroke:"#cec9ba",strokeWidth:"5"},"lineOf"+v))}return n},t}(kt.exports.Component),pL=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isChanging:!1,current:0},r.begin=function(){r.setState({isChanging:!0})},r.end=function(n){r.setState({isChanging:!1}),r.props.onChange(n)},r.updateCurrent=function(n){var a,i;r.setState({current:n}),(i=(a=r.props).onChangeImmediate)===null||i===void 0||i.call(a,n)},r.updateManually=function(n){r.setState({isChanging:!0});var a=n;r.props.step===1&&(a=Math.round(a)),a<r.props.min&&(a=r.props.min),a>r.props.max&&(a=r.props.max),r.setState({current:a,isChanging:!0})},r.onManualBlur=function(){r.setState({isChanging:!1}),r.props.onChange(r.state.current)},r}return t.getDerivedStateFromProps=function(r,n){return n.isChanging||r.value===n.current?null:{current:r.value}},t.prototype.render=function(){var r=this.props.step;return r===void 0&&(r=1),Te("div",w({className:"msp-slider"},{children:[L("div",{children:L(hL,{min:this.props.min,max:this.props.max,step:r,value:this.state.current,disabled:this.props.disabled,onBeforeChange:this.begin,onChange:this.updateCurrent,onAfterChange:this.end},void 0)},void 0),L("div",{children:L(Du,{numeric:!0,delayMs:50,value:this.state.current,blurOnEnter:!0,onBlur:this.onManualBlur,isDisabled:this.props.disabled,onChange:this.updateManually},void 0)},void 0)]}),void 0)},t}(kt.exports.Component),U2e=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isChanging:!1,current:[0,1]},r.begin=function(){r.setState({isChanging:!0})},r.end=function(n){r.setState({isChanging:!1}),r.props.onChange(n)},r.updateCurrent=function(n){r.setState({current:n})},r.updateMax=function(n){var a=n;r.props.step===1&&(a=Math.round(a)),a<r.state.current[0]?a=r.state.current[0]:a<r.props.min&&(a=r.props.min),a>r.props.max&&(a=r.props.max),r.props.onChange([r.state.current[0],a])},r.updateMin=function(n){var a=n;r.props.step===1&&(a=Math.round(a)),a<r.props.min&&(a=r.props.min),a>r.state.current[1]?a=r.state.current[1]:a>r.props.max&&(a=r.props.max),r.props.onChange([a,r.state.current[1]])},r}return t.getDerivedStateFromProps=function(r,n){return n.isChanging||r.value[0]===n.current[0]&&r.value[1]===n.current[1]?null:{current:r.value}},t.prototype.render=function(){var r=this.props.step;return r===void 0&&(r=1),Te("div",w({className:"msp-slider2"},{children:[L("div",{children:L(Du,{numeric:!0,delayMs:50,value:this.state.current[0],onEnter:this.props.onEnter,blurOnEnter:!0,isDisabled:this.props.disabled,onChange:this.updateMin},void 0)},void 0),L("div",{children:L(hL,{min:this.props.min,max:this.props.max,step:r,value:this.state.current,disabled:this.props.disabled,onBeforeChange:this.begin,onChange:this.updateCurrent,onAfterChange:this.end,range:!0,allowCross:!0},void 0)},void 0),L("div",{children:L(Du,{numeric:!0,delayMs:50,value:this.state.current[1],onEnter:this.props.onEnter,blurOnEnter:!0,isDisabled:this.props.disabled,onChange:this.updateMax},void 0)},void 0)]}),void 0)},t}(kt.exports.Component);function GC(e){for(var t=[],r={}.hasOwnProperty,n=0;n<arguments.length;n++){var a=arguments[n];if(!!a){var i=typeof a;if(i==="string"||i==="number")t.push(a);else if(Array.isArray(a))t.push(GC.apply(null,a));else if(i==="object")for(var o in a)r.call(a,o)&&a[o]&&t.push(o)}}return t.join(" ")}function TI(e){return e.touches.length>1||e.type.toLowerCase()==="touchend"&&e.touches.length>0}function EI(e,t){return e?t.touches[0].clientY:t.touches[0].pageX}function II(e,t){return e?t.clientY:t.pageX}function MI(e,t){var r=t.getBoundingClientRect();return e?r.top+r.height*.5:r.left+r.width*.5}function G2(e){e.stopPropagation(),e.preventDefault()}var z2e=function(e){Be(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.render=function(){var r=this.props,n=r.className,a=r.tipFormatter,i=r.vertical,o=r.offset,s=r.value,u=r.index,l=i?{bottom:o+"%"}:{left:o+"%"};return L("div",{className:n,style:l,title:a(s,u)},void 0)},t}(kt.exports.Component),hL=function(e){Be(t,e);function t(r){var n=e.call(this,r)||this;n.sliderElement=kt.exports.createRef(),n.handleElements=[],n.dragOffset=0,n.startPosition=0,n.startValue=0,n._getPointsCache=void 0,n.onMouseDown=function(f){if(f.button===0){var p=II(n.props.vertical,f);if(!n.isEventFromHandle(f))n.dragOffset=0;else{var h=MI(n.props.vertical,f.target);n.dragOffset=p-h,p=h}n.onStart(p),n.addDocumentEvents("mouse"),G2(f)}},n.onTouchMove=function(f){if(TI(f)){n.end("touch");return}var p=EI(n.props.vertical,f);n.onMove(f,p-n.dragOffset)},n.onTouchStart=function(f){if(!TI(f)){var p=EI(n.props.vertical,f);if(!n.isEventFromHandle(f))n.dragOffset=0;else{var h=MI(n.props.vertical,f.target);n.dragOffset=p-h,p=h}n.onStart(p),n.addDocumentEvents("touch"),G2(f)}},n.eventHandlers={touchmove:function(f){return n.onTouchMove(f)},touchend:function(f){return n.end("touch")},mousemove:function(f){return n.onMouseMove(f)},mouseup:function(f){return n.end("mouse")}},n.calcOffset=function(f){var p=n.props,h=p.min,v=p.max,m=(f-h)/(v-h);return m*100};var a=r.range,i=r.min,o=r.max,s=a?Array.apply(null,Array(+a+1)).map(function(){return i}):i,u="defaultValue"in r?r.defaultValue:s,l=r.value!==void 0?r.value:u,c=(a?l:[i,l]).map(function(f){return n.trimAlignValue(f)}),d;return a&&c[0]===c[c.length-1]&&c[0]===o?d=0:d=c.length-1,n.state={handle:null,recent:d,bounds:c},n}return t.prototype.componentDidUpdate=function(r){var n=this;if("value"in this.props||"min"in this.props||"max"in this.props){var a=this.state.bounds;if(r.range){var i=this.props.value||a,o=i.map(function(u){return n.trimAlignValue(u,n.props)});if(o.every(function(u,l){return u===a[l]}))return;this.setState({bounds:o}),a.some(function(u){return n.isValueOutOfBounds(u,n.props)})&&this.props.onChange(o)}else{var i=this.props.value!==void 0?this.props.value:a[1],s=this.trimAlignValue(i,this.props);if(s===a[1]&&a[0]===r.min)return;this.setState({bounds:[r.min,s]}),this.isValueOutOfBounds(a[1],this.props)&&this.props.onChange(s)}}},t.prototype.onChange=function(r){var n=this.props,a=!("value"in n);a?this.setState(r):r.handle!==void 0&&this.setState({handle:r.handle});var i=w(w({},this.state),r),o=n.range?i.bounds:i.bounds[1];n.onChange(o)},t.prototype.onMouseMove=function(r){var n=II(this.props.vertical,r);this.onMove(r,n-this.dragOffset)},t.prototype.onMove=function(r,n){G2(r);var a=this.props,i=this.state,o=n-this.startPosition;o=this.props.vertical?-o:o;var s=o/this.getSliderLength()*(a.max-a.min),u=this.trimAlignValue(this.startValue+s),l=i.bounds[i.handle];if(u!==l){var c=Nt([],i.bounds);c[i.handle]=u;var d=i.handle;if(a.pushable){var f=i.bounds[d];this.pushSurroundingHandles(c,d,f)}else a.allowCross&&(c.sort(function(p,h){return p-h}),d=c.indexOf(u));this.onChange({handle:d,bounds:c})}},t.prototype.onStart=function(r){var n=this.props;n.onBeforeChange(this.getValue());var a=this.calcValueByPos(r);this.startValue=a,this.startPosition=r;var i=this.state,o=i.bounds,s=1;if(this.props.range){for(var u=0,l=1;l<o.length-1;++l)a>o[l]&&(u=l);Math.abs(o[u+1]-a)<Math.abs(o[u]-a)&&(u=u+1),s=u;var c=o[u+1]===o[u];c&&(s=i.recent),c&&a!==o[u+1]&&(s=a<o[u+1]?u:u+1)}this.setState({handle:s,recent:s});var d=i.bounds[s];if(a!==d){var f=Nt([],i.bounds);f[s]=a,this.onChange({bounds:f})}},t.prototype.getPoints=function(){var r=this.props,n=r.marks,a=r.step,i=r.min,o=r.max,s=this._getPointsCache;if(!s||s.marks!==n||s.step!==a){var u=w({},n);if(a!==null)for(var l=i;l<=o;l+=a)u[l]=l;var c=Object.keys(u).map(parseFloat);c.sort(function(d,f){return d-f}),this._getPointsCache={marks:n,step:a,points:c}}return this._getPointsCache.points},t.prototype.getPrecision=function(r){var n=r.toString(),a=0;return n.indexOf(".")>=0&&(a=n.length-n.indexOf(".")-1),a},t.prototype.getSliderLength=function(){var r=this.sliderElement.current;return r?this.props.vertical?r.clientHeight:r.clientWidth:0},t.prototype.getSliderStart=function(){var r=this.sliderElement.current,n=r.getBoundingClientRect();return this.props.vertical?n.top:n.left},t.prototype.getValue=function(){var r=this.state.bounds;return this.props.range?r:r[1]},t.prototype.addDocumentEvents=function(r){r==="touch"?(document.addEventListener("touchmove",this.eventHandlers.touchmove),document.addEventListener("touchend",this.eventHandlers.touchend)):r==="mouse"&&(document.addEventListener("mousemove",this.eventHandlers.mousemove),document.addEventListener("mouseup",this.eventHandlers.mouseup))},t.prototype.calcValue=function(r){var n=this.props,a=n.vertical,i=n.min,o=n.max,s=Math.abs(r/this.getSliderLength()),u=a?(1-s)*(o-i)+i:s*(o-i)+i;return u},t.prototype.calcValueByPos=function(r){var n=r-this.getSliderStart(),a=this.trimAlignValue(this.calcValue(n));return a},t.prototype.end=function(r){this.removeEvents(r),this.props.onAfterChange(this.getValue()),this.setState({handle:null})},t.prototype.isEventFromHandle=function(r){for(var n=0,a=this.handleElements;n<a.length;n++){var i=a[n];if(i.current===r.target)return!0}return!1},t.prototype.isValueOutOfBounds=function(r,n){return r<n.min||r>n.max},t.prototype.pushHandle=function(r,n,a,i){for(var o=r[n],s=r[n];a*(s-o)<i;){if(!this.pushHandleOnePoint(r,n,a))return r[n]=o,!1;s=r[n]}return!0},t.prototype.pushHandleOnePoint=function(r,n,a){var i=this.getPoints(),o=i.indexOf(r[n]),s=o+a;if(s>=i.length||s<0)return!1;var u=n+a,l=i[s],c=this.props.pushable,d=a*(r[u]-l);return this.pushHandle(r,u,a,+c-d)?(r[n]=l,!0):!1},t.prototype.pushSurroundingHandles=function(r,n,a){var i=this.props.pushable,o=r[n],s=0;if(r[n+1]-o<i?s=1:o-r[n-1]<i&&(s=-1),s!==0){var u=n+s,l=s*(r[u]-o);this.pushHandle(r,u,s,+i-l)||(r[n]=a)}},t.prototype.removeEvents=function(r){r==="touch"?(document.removeEventListener("touchmove",this.eventHandlers.touchmove),document.removeEventListener("touchend",this.eventHandlers.touchend)):r==="mouse"&&(document.removeEventListener("mousemove",this.eventHandlers.mousemove),document.removeEventListener("mouseup",this.eventHandlers.mouseup))},t.prototype.trimAlignValue=function(r,n){var a=this.state||{},i=a.handle,o=a.bounds,s=w(w({},this.props),n||{}),u=s.marks,l=s.step,c=s.min,d=s.max,f=s.allowCross,p=r;p<=c&&(p=c),p>=d&&(p=d),!f&&i!=null&&i>0&&p<=o[i-1]&&(p=o[i-1]),!f&&i!=null&&i<o.length-1&&p>=o[i+1]&&(p=o[i+1]);var h=Object.keys(u).map(parseFloat);if(l!==null){var v=Math.round((p-c)/l)*l+c;h.push(v)}var m=h.map(function(y){return Math.abs(p-y)}),g=h[m.indexOf(Math.min.apply(Math,m))];return l!==null?parseFloat(g.toFixed(this.getPrecision(l))):g},t.prototype.render=function(){var r,n=this,a=this.state,i=a.handle,o=a.bounds,s=this.props,u=s.className,l=s.prefixCls,c=s.disabled,d=s.vertical,f=s.range,p=s.step,h=s.marks,v=s.tipFormatter,m=this.props.handle,g=o.map(this.calcOffset),y=l+"-handle",b=o.map(function(I,M){var O;return GC((O={},O[y]=!0,O[y+"-"+(M+1)]=!0,O[y+"-lower"]=M===0,O[y+"-upper"]=M===o.length-1,O))}),x=p===null||v===null,S={prefixCls:l,noTip:x,tipFormatter:v,vertical:d};if(this.handleElements.length!==o.length){this.handleElements=[];for(var _=0;_<o.length;_++)this.handleElements.push(kt.exports.createRef())}var A=o.map(function(I,M){return kt.exports.cloneElement(m,w(w({},S),{className:b[M],value:I,offset:g[M],dragging:i===M,index:M,key:M,ref:n.handleElements[M]}))});f||A.shift();var T=GC((r={},r[l]=!0,r[l+"-with-marks"]=Object.keys(h).length,r[l+"-disabled"]=c,r[l+"-vertical"]=this.props.vertical,r[u]=!!u,r));return Te("div",w({ref:this.sliderElement,className:T,onTouchStart:c?ql:this.onTouchStart,onMouseDown:c?ql:this.onMouseDown},{children:[L("div",{className:l+"-rail"},void 0),A]}),void 0)},t.defaultProps={prefixCls:"msp-slider-base",className:"",min:0,max:100,step:1,marks:{},handle:L(z2e,{className:"",vertical:!1,offset:0,tipFormatter:function(r){return r},value:0,index:0},void 0),onBeforeChange:ql,onChange:ql,onAfterChange:ql,tipFormatter:function(r,n){return r},disabled:!1,range:!1,vertical:!1,allowCross:!0,pushable:!1},t}(kt.exports.Component),Pn=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onChange=function(n){var a,i,o;if((o=(i=r.props).onChange)===null||o===void 0||o.call(i,n,r.props.values),r.props.onChangeValues){var s=w(w({},r.props.values),(a={},a[n.name]=n.value,a));r.props.onChangeValues(s,r.props.values)}},r.paramGroups=bc(function(n){return H2e(n)}),r}return t.prototype.renderGroup=function(r){var n;if(r.length===0)return null;for(var a=this.props.values,i=null,o=void 0,s=0,u=r;s<u.length;s++){var l=u[s],c=l[0],d=l[1],f=l[2];!((n=d.hideIf)===null||n===void 0)&&n.call(d,a)||(i||(i=[]),o=d.category,i.push(L(f,{param:d,onChange:this.onChange,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled,name:c,value:a[c]},c)))}return i?o?[L(ls,w({header:o},{children:i}),o)]:i:null},t.prototype.renderPart=function(r){for(var n=null,a=0,i=r;a<i.length;a++){var o=i[a],s=this.renderGroup(o);if(!!s){n||(n=[]);for(var u=0,l=s;u<l.length;u++){var c=l[u];n.push(c)}}}return n},t.prototype.render=function(){var r=this.paramGroups(this.props.params),n=this.renderPart(r.essentials),a=this.renderPart(r.advanced);return n&&a?Te(Rt,{children:[n,L(ls,w({header:"Advanced Options"},{children:a}),void 0)]},void 0):n||a},t}(kt.exports.PureComponent),V2e=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.setSettings=function(n,a){var i,o=w(w({},a),(i={},i[n.name]=n.value,i)),s=r.props.mapping.update(o,r.plugin);r.props.mapping.apply(s,r.plugin)},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.events.canvas3d.settingsUpdated,function(){return r.forceUpdate()})},t.prototype.render=function(){var r=this.props.mapping.getTarget(this.plugin),n=this.props.mapping.getValues(r,this.plugin),a=this.props.mapping.params(this.plugin);return L(Pn,{params:a,values:n,onChange:this.setSettings},void 0)},t}(hr);function H2e(e){function t(c,d,f){var p=qv(d);if(!!p)if(!d.category)f.params[0].push([c,d,p]);else{f.map||(f.map=new Map);var h=f.map.get(d.category);h||(h=[],f.map.set(d.category,h),f.params.push(h)),h.push([c,d,p])}}function r(c,d){var f=c[0],p=d[0];return!f||!f[1].category?-1:!p||!p[1].category?1:f[1].category<p[1].category?-1:1}for(var n=Object.keys(e),a={params:[[]],map:void 0},i={params:[[]],map:void 0},o=0,s=n;o<s.length;o++){var u=s[o],l=e[u];l.isHidden||(l.isEssential?t(u,l,a):t(u,l,i))}return a.params.sort(r),i.params.sort(r),{essentials:a.params,advanced:i.params}}function qv(e){switch(e.type){case"value":return;case"boolean":return Z3;case"number":return typeof e.min!="undefined"&&typeof e.max!="undefined"?W2e:j2e;case"converted":return fSe;case"conditioned":return dSe;case"multi-select":return uSe;case"color":return M2e;case"color-list":return e.offsets?rSe:tSe;case"vec3":return nSe;case"mat4":return aSe;case"url":return iSe;case"file":return oSe;case"file-list":return sSe;case"select":return J3;case"value-ref":return Y2e;case"data-ref":return;case"text":return X2e;case"interval":return typeof e.min!="undefined"&&typeof e.max!="undefined"?$2e:K2e;case"group":return mL;case"mapped":return lSe;case"line-graph":return q2e;case"script":return pSe;case"object-list":return tw;default:var t=e;console.warn(t+" has no associated UI component");return}}var G2e=function(e){Be(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.render=function(){var r=this.props,n=r.legend,a=r.description,i=n&&F2e(n);return L("div",w({className:"msp-help-text"},{children:Te("div",{children:[Te("div",w({className:"msp-help-description"},{children:[L(tn,{svg:Hs,inline:!0},void 0),a]}),void 0),i&&L("div",w({className:"msp-help-legend"},{children:L(i,{legend:n},void 0)}),void 0)]},void 0)}),void 0)},t}(kt.exports.PureComponent);function sf(e){var t=e.props,r=e.state,n=e.control,a=e.toggleHelp,i=e.addOn,o=[];t.param.shortLabel&&o.push("msp-control-label-short"),t.param.twoColumns&&o.push("msp-control-col-2");var s=o.join(" "),u=t.param.label||Za(t.name),l=t.param.help?t.param.help(t.value):{description:t.param.description,legend:t.param.legend},c=l.description||l.legend,d=u+(c?". Click for help.":"");return Te(Rt,{children:[L(Io,{className:s,title:d,label:Te(Rt,{children:[u,c&&L("button",w({className:"msp-help msp-btn-link msp-btn-icon msp-control-group-expander",onClick:a,title:d||(r.showHelp?"Hide":"Show")+" help",style:{background:"transparent",textAlign:"left",padding:"0"}},{children:L(tn,{svg:Hs},void 0)}),void 0)]},void 0),control:n},void 0),c&&r.showHelp&&L("div",w({className:"msp-control-offset"},{children:L(G2e,{legend:l.legend,description:l.description},void 0)}),void 0),i]},void 0)}var uf=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={showHelp:!1},r.toggleHelp=function(){return r.setState({showHelp:!r.state.showHelp})},r}return t.prototype.update=function(r){this.props.onChange({param:this.props.param,name:this.props.name,value:r})},t.prototype.renderAddOn=function(){return null},t.prototype.render=function(){return sf({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:this.renderAddOn()})},t}(kt.exports.PureComponent),Z3=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onClick=function(n){r.update(!r.props.value),n.currentTarget.blur()},r}return t.prototype.renderControl=function(){return Te("button",w({onClick:this.onClick,disabled:this.props.isDisabled},{children:[L(tn,{svg:this.props.value?wp:yR},void 0),this.props.value?"On":"Off"]}),void 0)},t}(uf),q2e=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!1,isOverPoint:!1,message:r.props.param.defaultValue.length+" points"},r.onHover=function(n){if(r.setState({isOverPoint:!r.state.isOverPoint}),n){r.setState({message:"("+n[0].toFixed(2)+", "+n[1].toFixed(2)+")"});return}r.setState({message:r.props.value.length+" points"})},r.onDrag=function(n){r.setState({message:"("+n[0].toFixed(2)+", "+n[1].toFixed(2)+")"})},r.onChange=function(n){r.props.onChange({name:r.props.name,param:r.props.param,value:n})},r.toggleExpanded=function(n){r.setState({isExpanded:!r.state.isExpanded}),n.currentTarget.blur()},r}return t.prototype.render=function(){var r=this.props.param.label||Za(this.props.name);return Te(Rt,{children:[L(Io,{label:r,control:L("button",w({onClick:this.toggleExpanded,disabled:this.props.isDisabled},{children:""+this.state.message}),void 0)},void 0),L("div",w({className:"msp-control-offset",style:{display:this.state.isExpanded?"block":"none"}},{children:L(N2e,{data:this.props.param.defaultValue,onChange:this.onChange,onHover:this.onHover,onDrag:this.onDrag},void 0)}),void 0)]},void 0)},t}(kt.exports.PureComponent),j2e=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={value:"0"},r.update=function(n){var a=hg(r.props.param.step||.01);n=parseFloat(n.toFixed(a)),r.props.onChange({param:r.props.param,name:r.props.name,value:n})},r}return t.prototype.render=function(){var r=this.props.param.label||Za(this.props.name),n=this.props.param.label||Za(this.props.name),a=hg(this.props.param.step||.01);return L(Io,{title:this.props.param.description,label:n,control:L(Du,{numeric:!0,value:parseFloat(this.props.value.toFixed(a)),onEnter:this.props.onEnter,placeholder:r,isDisabled:this.props.isDisabled,onChange:this.update},void 0)},void 0)},t}(kt.exports.PureComponent),W2e=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onChange=function(n){r.update(n)},r}return t.prototype.renderControl=function(){var r=typeof this.props.value=="undefined"?this.props.param.defaultValue:this.props.value;return L(pL,{value:r,min:this.props.param.min,max:this.props.param.max,step:this.props.param.step,onChange:this.onChange,onChangeImmediate:this.props.param.immediateUpdate?this.onChange:void 0,disabled:this.props.isDisabled,onEnter:this.props.onEnter},void 0)},t}(uf),X2e=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onChange=function(n){var a=n.target.value;a!==r.props.value&&r.update(a)},r.onKeyPress=function(n){(n.keyCode===13||n.charCode===13||n.key==="Enter")&&r.props.onEnter&&r.props.onEnter(),n.stopPropagation()},r}return t.prototype.renderControl=function(){var r=this.props.param.label||Za(this.props.name);return L("input",{type:"text",value:this.props.value||"",placeholder:r,onChange:this.onChange,onKeyPress:this.props.onEnter?this.onKeyPress:void 0,disabled:this.props.isDisabled},void 0)},t}(uf),Hf=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onChange=function(n){typeof r.props.param.defaultValue=="number"?r.update(parseInt(n.target.value,10)):r.update(n.target.value)},r}return t.prototype.update=function(r){this.props.onChange({param:this.props.param,name:this.props.name,value:r})},t.prototype.render=function(){var r=this,n=this.props.value!==void 0&&!this.props.param.options.some(function(a){return a[0]===r.props.value});return Te("select",w({className:"msp-form-control",title:this.props.title,value:this.props.value!==void 0?this.props.value:this.props.param.defaultValue,onChange:this.onChange,disabled:this.props.isDisabled},{children:[n&&L("option",w({value:this.props.value},{children:"[Invalid] "+this.props.value}),this.props.value),this.props.param.options.map(function(a){var i=a[0],o=a[1];return L("option",w({value:i},{children:o}),i)})]}),void 0)},t}(kt.exports.PureComponent),J3=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={showHelp:!1,showOptions:!1},r.onSelect=function(n){!n||n.value===r.props.value?r.setState({showOptions:!1}):r.setState({showOptions:!1},function(){r.props.onChange({param:r.props.param,name:r.props.name,value:n.value})})},r.toggle=function(){return r.setState({showOptions:!r.state.showOptions})},r.cycle=function(){var n=r.props.param.options,a=n.findIndex(function(o){return o[0]===r.props.value}),i=a===n.length-1?0:a+1;r.props.onChange({param:r.props.param,name:r.props.name,value:n[i][0]})},r.items=bc(function(n){return Jt.createItemsFromSelectOptions(n.options)}),r.toggleHelp=function(){return r.setState({showHelp:!r.state.showHelp})},r}return t.prototype.renderControl=function(){var r,n=this.items(this.props.param),a=this.props.value!==void 0?Jt.findItem(n,this.props.value):void 0,i=a?a.label:typeof this.props.value=="undefined"?(((r=Jt.getFirstItem(n))===null||r===void 0?void 0:r.label)||"")+" [Default]":"[Invalid] "+this.props.value,o=this.props.param.cycle?this.cycle:this.toggle,s=this.props.param.cycle?"center":"left",u=this.props.param.cycle?this.props.value==="on"?wp:this.props.value==="off"?yR:void 0:void 0;return L(oa,{disabled:this.props.isDisabled,style:{textAlign:s,overflow:"hidden",textOverflow:"ellipsis"},label:i,title:i,icon:u,toggle:o,isSelected:this.state.showOptions},void 0)},t.prototype.renderAddOn=function(){if(!this.state.showOptions)return null;var r=this.items(this.props.param),n=Jt.findItem(r,this.props.value);return L(Jt,{items:r,current:n,onSelect:this.onSelect},void 0)},t.prototype.render=function(){return sf({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:this.renderAddOn()})},t}(kt.exports.PureComponent),Y2e=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={showHelp:!1,showOptions:!1},r.onSelect=function(n){!n||n.value===r.props.value?r.setState({showOptions:!1}):r.setState({showOptions:!1},function(){r.props.onChange({param:r.props.param,name:r.props.name,value:{ref:n.value}})})},r.toggle=function(){return r.setState({showOptions:!r.state.showOptions})},r.items=bc(function(n){return Jt.createItemsFromSelectOptions(n.getOptions())}),r.toggleHelp=function(){return r.setState({showHelp:!r.state.showHelp})},r}return t.prototype.renderControl=function(){var r,n=this.items(this.props.param),a=this.props.value.ref?Jt.findItem(n,this.props.value.ref):void 0,i=a?a.label:"[Ref] "+((r=this.props.value.ref)!==null&&r!==void 0?r:"");return L(oa,{disabled:this.props.isDisabled,style:{textAlign:"left",overflow:"hidden",textOverflow:"ellipsis"},label:i,title:i,toggle:this.toggle,isSelected:this.state.showOptions},void 0)},t.prototype.renderAddOn=function(){if(!this.state.showOptions)return null;var r=this.items(this.props.param),n=Jt.findItem(r,this.props.value.ref);return L(Jt,{items:r,current:n,onSelect:this.onSelect},void 0)},t.prototype.render=function(){return sf({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:this.renderAddOn()})},t}(kt.exports.PureComponent),K2e=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!1},r.components={0:E.Numeric(0,{step:r.props.param.step},{label:"Min"}),1:E.Numeric(0,{step:r.props.param.step},{label:"Max"})},r.componentChange=function(n){var a=n.name,i=n.value,o=Nt([],r.props.value);o[+a]=i,r.change(o)},r.toggleExpanded=function(n){r.setState({isExpanded:!r.state.isExpanded}),n.currentTarget.blur()},r}return t.prototype.change=function(r){this.props.onChange({name:this.props.name,param:this.props.param,value:r})},t.prototype.render=function(){var r=this.props.value,n=this.props.param.label||Za(this.props.name),a=hg(this.props.param.step||.01),i="["+r[0].toFixed(a)+", "+r[1].toFixed(a)+"]";return Te(Rt,{children:[L(Io,{label:n,control:L("button",w({onClick:this.toggleExpanded,disabled:this.props.isDisabled},{children:i}),void 0)},void 0),this.state.isExpanded&&L("div",w({className:"msp-control-offset"},{children:L(Pn,{params:this.components,values:r,onChange:this.componentChange,onEnter:this.props.onEnter},void 0)}),void 0)]},void 0)},t}(kt.exports.PureComponent),$2e=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onChange=function(n){r.update(n)},r}return t.prototype.renderControl=function(){return L(U2e,{value:this.props.value,min:this.props.param.min,max:this.props.param.max,step:this.props.param.step,onChange:this.onChange,disabled:this.props.isDisabled,onEnter:this.props.onEnter},void 0)},t}(uf);(function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onChange=function(n){r.update(it(parseInt(n.target.value)))},r}return t.prototype.stripStyle=function(){return{background:it.toStyle(this.props.value),position:"absolute",bottom:"0",height:"4px",right:"0",left:"0"}},t.prototype.renderControl=function(){return Te("div",w({style:{position:"relative"}},{children:[Te("select",w({value:this.props.value,onChange:this.onChange},{children:[O2e(this.props.value),D2e()]}),void 0),L("div",{style:this.stripStyle()},void 0)]}),void 0)},t})(uf);function Dh(e,t){return t===void 0&&(t=!1),Array.isArray(e)?t?it.toStyle(e[0])+" "+(100*e[1]).toFixed(2)+"%":it.toStyle(e[0]):it.toStyle(e)}var Q2e=$y(function(e){var t=e.map(function(r){return Dh(r,!0)});return"linear-gradient(to right, "+t.join(", ")+")"}),Z2e=$y(function(e){for(var t=e.length,r=[Dh(e[0])+" "+100*(1/t)+"%"],n=1,a=t-1;n<a;++n)r.push(Dh(e[n])+" "+100*(n/t)+"%",Dh(e[n])+" "+100*((n+1)/t)+"%");return r.push(Dh(e[t-1])+" "+100*((t-1)/t)+"%"),"linear-gradient(to right, "+r.join(", ")+")"});function ew(e,t){return t===void 0&&(t="0"),{background:J2e(e.colors,e.kind==="set"),position:"absolute",bottom:"0",height:"4px",right:t,left:"0"}}function J2e(e,t){return t?Z2e(e):Q2e(e)}function eSe(){var e=function(t){var r=To(t[0]);return L("div",{style:ew({kind:r.type!=="qualitative"?"interpolate":"set",colors:r.list})},void 0)};return{ColorPresets:{all:Jt.createItemsFromSelectOptions(w_,{addOn:e}),scale:Jt.createItemsFromSelectOptions(JH,{addOn:e}),set:Jt.createItemsFromSelectOptions(eG,{addOn:e})},ColorsParam:E.ObjectList({color:E.Color(0)},function(t){var r=t.color;return it.toHexString(r).toUpperCase()}),OffsetColorsParam:E.ObjectList({color:E.Color(0),offset:E.Numeric(0,{min:0,max:1,step:.01})},function(t){var r=t.color,n=t.offset;return it.toHexString(r).toUpperCase()+" ["+n.toFixed(2)+"]"}),IsInterpolatedParam:E.Boolean(!1,{label:"Interpolated"})}}var Zm;function vL(){return Zm||(Zm=eSe(),Zm)}var tSe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={showHelp:!1,show:void 0},r.toggleEdit=function(){return r.setState({show:r.state.show==="edit"?void 0:"edit"})},r.togglePresets=function(){return r.setState({show:r.state.show==="presets"?void 0:"presets"})},r.selectPreset=function(n){if(!!n){r.setState({show:void 0});var a=To(n.value);r.update({kind:a.type!=="qualitative"?"interpolate":"set",colors:a.list})}},r.colorsChanged=function(n){var a=n.value;r.update({kind:r.props.value.kind,colors:a.map(function(i){return i.color})})},r.isInterpolatedChanged=function(n){var a=n.value;r.update({kind:a?"interpolate":"set",colors:r.props.value.colors})},r.toggleHelp=function(){return r.setState({showHelp:!r.state.showHelp})},r}return t.prototype.update=function(r){this.props.onChange({param:this.props.param,name:this.props.name,value:r})},t.prototype.renderControl=function(){var r=this.props.value;return Te(Rt,{children:[Te("button",w({onClick:this.toggleEdit,style:{position:"relative",paddingRight:"33px"}},{children:[r.colors.length===1?"1 color":r.colors.length+" colors",L("div",{style:ew(r,"33px")},void 0)]}),void 0),L(Gt,{svg:My,onClick:this.togglePresets,toggleState:this.state.show==="presets",title:"Color Presets",style:{padding:0,position:"absolute",right:0,top:0,width:"32px"}},void 0)]},void 0)},t.prototype.renderColors=function(){if(!this.state.show)return null;var r=vL(),n=r.ColorPresets,a=r.ColorsParam,i=r.IsInterpolatedParam,o=n[this.props.param.presetKind];if(this.state.show==="presets")return L(Jt,{items:o,onSelect:this.selectPreset},void 0);var s=this.props.value.colors.map(function(u){return{color:u}});return Te("div",w({className:"msp-control-offset"},{children:[L(tw,{name:"colors",param:a,value:s,onChange:this.colorsChanged,isDisabled:this.props.isDisabled,onEnter:this.props.onEnter},void 0),L(Z3,{name:"isInterpolated",param:i,value:this.props.value.kind==="interpolate",onChange:this.isInterpolatedChanged,isDisabled:this.props.isDisabled,onEnter:this.props.onEnter},void 0)]}),void 0)},t.prototype.render=function(){return sf({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:this.renderColors()})},t}(kt.exports.PureComponent),rSe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={showHelp:!1,show:void 0},r.toggleEdit=function(){return r.setState({show:r.state.show==="edit"?void 0:"edit"})},r.togglePresets=function(){return r.setState({show:r.state.show==="presets"?void 0:"presets"})},r.selectPreset=function(n){if(!!n){r.setState({show:void 0});var a=To(n.value);r.update({kind:a.type!=="qualitative"?"interpolate":"set",colors:a.list})}},r.colorsChanged=function(n){var a=n.value,i=a.map(function(o){return[o.color,o.offset]});i.sort(function(o,s){return o[1]-s[1]}),r.update({kind:r.props.value.kind,colors:i})},r.isInterpolatedChanged=function(n){var a=n.value;r.update({kind:a?"interpolate":"set",colors:r.props.value.colors})},r.toggleHelp=function(){return r.setState({showHelp:!r.state.showHelp})},r}return t.prototype.update=function(r){this.props.onChange({param:this.props.param,name:this.props.name,value:r})},t.prototype.renderControl=function(){var r=this.props.value;return Te(Rt,{children:[Te("button",w({onClick:this.toggleEdit,style:{position:"relative",paddingRight:"33px"}},{children:[r.colors.length===1?"1 color":r.colors.length+" colors",L("div",{style:ew(r,"33px")},void 0)]}),void 0),L(Gt,{svg:My,onClick:this.togglePresets,toggleState:this.state.show==="presets",title:"Color Presets",style:{padding:0,position:"absolute",right:0,top:0,width:"32px"}},void 0)]},void 0)},t.prototype.renderColors=function(){if(!this.state.show)return null;var r=vL(),n=r.ColorPresets,a=r.OffsetColorsParam,i=r.IsInterpolatedParam,o=n[this.props.param.presetKind];if(this.state.show==="presets")return L(Jt,{items:o,onSelect:this.selectPreset},void 0);var s=this.props.value.colors,u=s.map(function(l,c){return Array.isArray(l)?{color:l[0],offset:l[1]}:{color:l,offset:c/s.length}});return u.sort(function(l,c){return l.offset-c.offset}),Te("div",w({className:"msp-control-offset"},{children:[L(tw,{name:"colors",param:a,value:u,onChange:this.colorsChanged,isDisabled:this.props.isDisabled,onEnter:this.props.onEnter},void 0),L(Z3,{name:"isInterpolated",param:i,value:this.props.value.kind==="interpolate",onChange:this.isInterpolatedChanged,isDisabled:this.props.isDisabled,onEnter:this.props.onEnter},void 0)]}),void 0)},t.prototype.render=function(){return sf({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:this.renderColors()})},t}(kt.exports.PureComponent),nSe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!1},r.components={0:E.Numeric(0,{step:r.props.param.step},{label:r.props.param.fieldLabels&&r.props.param.fieldLabels.x||"X"}),1:E.Numeric(0,{step:r.props.param.step},{label:r.props.param.fieldLabels&&r.props.param.fieldLabels.y||"Y"}),2:E.Numeric(0,{step:r.props.param.step},{label:r.props.param.fieldLabels&&r.props.param.fieldLabels.z||"Z"})},r.componentChange=function(n){var a=n.name,i=n.value,o=C.copy(C.zero(),r.props.value);o[+a]=i,r.change(o)},r.toggleExpanded=function(n){r.setState({isExpanded:!r.state.isExpanded}),n.currentTarget.blur()},r}return t.prototype.change=function(r){this.props.onChange({name:this.props.name,param:this.props.param,value:r})},t.prototype.render=function(){var r=this.props.value,n=this.props.param.label||Za(this.props.name),a=hg(this.props.param.step||.01),i="["+r[0].toFixed(a)+", "+r[1].toFixed(a)+", "+r[2].toFixed(a)+"]";return Te(Rt,{children:[L(Io,{label:n,control:L("button",w({onClick:this.toggleExpanded,disabled:this.props.isDisabled},{children:i}),void 0)},void 0),this.state.isExpanded&&L("div",w({className:"msp-control-offset"},{children:L(Pn,{params:this.components,values:r,onChange:this.componentChange,onEnter:this.props.onEnter},void 0)}),void 0)]},void 0)},t}(kt.exports.PureComponent),aSe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!1},r.components={json:E.Text(JSON.stringify(ue()),{description:"JSON array with 4x4 matrix in a column major (j * 4 + i indexing) format"})},r.componentChange=function(n){var a=n.name,i=n.value,o=ue.copy(ue(),r.props.value);a==="json"?ue.copy(o,JSON.parse(i)):o[+a]=i,r.change(o)},r.toggleExpanded=function(n){r.setState({isExpanded:!r.state.isExpanded}),n.currentTarget.blur()},r}return t.prototype.change=function(r){this.props.onChange({name:this.props.name,param:this.props.param,value:r})},t.prototype.changeValue=function(r){var n=this;return function(a){var i=ue.copy(ue(),n.props.value);i[r]=a,n.change(i)}},Object.defineProperty(t.prototype,"grid",{get:function(){for(var r=this.props.value,n=[],a=0;a<4;a++){for(var i=[],o=0;o<4;o++)i.push(L(Du,{numeric:!0,delayMs:50,value:ue.getValue(r,a,o),onChange:this.changeValue(4*o+a),className:"msp-form-control",blurOnEnter:!0,isDisabled:this.props.isDisabled},o));n.push(L("div",w({className:"msp-flex-row"},{children:i}),a))}return L("div",w({className:"msp-parameter-matrix"},{children:n}),void 0)},enumerable:!1,configurable:!0}),t.prototype.render=function(){var r={json:JSON.stringify(this.props.value)},n=this.props.param.label||Za(this.props.name);return Te(Rt,{children:[L(Io,{label:n,control:L("button",w({onClick:this.toggleExpanded,disabled:this.props.isDisabled},{children:"4\xD74 Matrix"}),void 0)},void 0),this.state.isExpanded&&Te("div",w({className:"msp-control-offset"},{children:[this.grid,L(Pn,{params:this.components,values:r,onChange:this.componentChange,onEnter:this.props.onEnter},void 0)]}),void 0)]},void 0)},t}(kt.exports.PureComponent),iSe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onChange=function(n){var a=n.target.value;a!==gn.getUrl(r.props.value||"")&&r.update(gn.Url(a))},r.onKeyPress=function(n){(n.keyCode===13||n.charCode===13||n.key==="Enter")&&r.props.onEnter&&r.props.onEnter(),n.stopPropagation()},r}return t.prototype.renderControl=function(){var r=this.props.param.label||Za(this.props.name);return L("input",{type:"text",value:gn.getUrl(this.props.value||""),placeholder:r,onChange:this.onChange,onKeyPress:this.props.onEnter?this.onKeyPress:void 0,disabled:this.props.isDisabled},void 0)},t}(uf),oSe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={showHelp:!1},r.onChangeFile=function(n){r.change(n.target.files[0])},r.toggleHelp=function(){return r.setState({showHelp:!r.state.showHelp})},r}return t.prototype.change=function(r){this.props.onChange({name:this.props.name,param:this.props.param,value:gn.File(r)})},t.prototype.renderControl=function(){var r=this.props.value;return Te("div",w({className:"msp-btn msp-btn-block msp-btn-action msp-loader-msp-btn-file",style:{marginTop:"1px"}},{children:[r?r.name:"Select a file..."," ",L("input",{disabled:this.props.isDisabled,onChange:this.onChangeFile,type:"file",multiple:!1,accept:this.props.param.accept},void 0)]}),void 0)},t.prototype.render=function(){return this.props.param.label?sf({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:null}):this.renderControl()},t}(kt.exports.PureComponent),sSe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={showHelp:!1},r.onChangeFileList=function(n){r.change(n.target.files)},r.toggleHelp=function(){return r.setState({showHelp:!r.state.showHelp})},r}return t.prototype.change=function(r){var n=[];if(r)for(var a=0,i=r.length;a<i;++a)n.push(gn.File(r[a]));this.props.onChange({name:this.props.name,param:this.props.param,value:n})},t.prototype.renderControl=function(){var r=this.props.value,n=[];if(r)for(var a=0,i=r;a<i.length;a++){var o=i[a];n.push(o.name)}var s=n.length===0?"Select files...":n.length===1?n[0]:n.length+" files selected";return Te("div",w({className:"msp-btn msp-btn-block msp-btn-action msp-loader-msp-btn-file",style:{marginTop:"1px"}},{children:[s," ",L("input",{disabled:this.props.isDisabled,onChange:this.onChangeFileList,type:"file",multiple:!0,accept:this.props.param.accept},void 0)]}),void 0)},t.prototype.render=function(){return this.props.param.label?sf({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:null}):this.renderControl()},t}(kt.exports.PureComponent),uSe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!1},r.toggleExpanded=function(n){r.setState({isExpanded:!r.state.isExpanded}),n.currentTarget.blur()},r}return t.prototype.change=function(r){this.props.onChange({name:this.props.name,param:this.props.param,value:r})},t.prototype.toggle=function(r){var n=this;return function(a){n.props.value.indexOf(r)<0?n.change(n.props.value.concat(r)):n.change(n.props.value.filter(function(i){return i!==r})),a.currentTarget.blur()}},t.prototype.render=function(){var r=this,n=this.props.value,a=this.props.param.emptyValue,i=this.props.param.label||Za(this.props.name);return Te(Rt,{children:[L(Io,{label:i,control:L("button",w({onClick:this.toggleExpanded,disabled:this.props.isDisabled},{children:n.length===0&&a?a:n.length+" of "+this.props.param.options.length}),void 0)},void 0),this.state.isExpanded&&L("div",w({className:"msp-control-offset"},{children:this.props.param.options.map(function(o){var s=o[0],u=o[1],l=n.indexOf(s)>=0;return L(pr,w({onClick:r.toggle(s),disabled:r.props.isDisabled,style:{marginTop:"1px"}},{children:L("span",w({style:{float:l?"left":"right"}},{children:l?"\u2713 "+u:u+" \u2717"}),void 0)}),s)})}),void 0)]},void 0)},t}(kt.exports.PureComponent),mL=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!!r.props.param.isExpanded,showHelp:!1},r.onChangeParam=function(n){var a;r.change(w(w({},r.props.value),(a={},a[n.name]=n.value,a)))},r.toggleExpanded=function(){return r.setState({isExpanded:!r.state.isExpanded})},r}return t.prototype.change=function(r){this.props.onChange({name:this.props.name,param:this.props.param,value:r})},t.prototype.pivoted=function(){var r=this.props.param.pivot,n=this.props.param.params,a=n[r],i=qv(a),o=L(i,{name:r,param:a,value:this.props.value[r],onChange:this.onChangeParam,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled},void 0);if(!this.state.isExpanded)return Te("div",w({className:"msp-mapped-parameter-group"},{children:[o,L(Gt,{svg:Ed,onClick:this.toggleExpanded,toggleState:this.state.isExpanded,title:"More Options"},void 0)]}),void 0);for(var s=Object.create(null),u=0,l=Object.keys(n);u<l.length;u++){var c=l[u];c!==r&&(s[c]=n[c])}return Te("div",w({className:"msp-mapped-parameter-group"},{children:[o,L(Gt,{svg:Ed,onClick:this.toggleExpanded,toggleState:this.state.isExpanded,title:"More Options"},void 0),L("div",w({className:"msp-control-offset"},{children:L(Pn,{params:s,onEnter:this.props.onEnter,values:this.props.value,onChange:this.onChangeParam,isDisabled:this.props.isDisabled},void 0)}),void 0)]}),void 0)},t.prototype.render=function(){var r=this.props.param.params;if(Object.keys(r).length===0)return null;if(this.props.param.pivot)return this.pivoted();var n=this.props.param.label||Za(this.props.name),a=L(Pn,{params:r,onChange:this.onChangeParam,values:this.props.value,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled},void 0);return this.props.inMapped?L("div",w({className:"msp-control-offset"},{children:a}),void 0):this.props.param.isFlat?a:Te("div",w({className:"msp-control-group-wrapper"},{children:[L("div",w({className:"msp-control-group-header"},{children:Te("button",w({className:"msp-btn msp-form-control msp-btn-block",onClick:this.toggleExpanded},{children:[L(tn,{svg:this.state.isExpanded?Lu:Nu},void 0),n]}),void 0)}),void 0),this.state.isExpanded&&L("div",w({className:"msp-control-offset"},{children:a}),void 0)]}),void 0)},t}(kt.exports.PureComponent),lSe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!1},r.valuesCache={},r.onChangeName=function(n){r.change({name:n.value,params:r.getValues(n.value)})},r.onChangeParam=function(n){r.setValues(r.props.value.name,n.value),r.change({name:r.props.value.name,params:n.value})},r.toggleExpanded=function(){return r.setState({isExpanded:!r.state.isExpanded})},r}return t.prototype.setValues=function(r,n){this.valuesCache[r]=n},t.prototype.getValues=function(r){return r in this.valuesCache?this.valuesCache[r]:this.props.param.map(r).defaultValue},t.prototype.change=function(r){this.props.onChange({name:this.props.name,param:this.props.param,value:r})},t.prototype.areParamsEmpty=function(r){for(var n=0,a=Object.keys(r);n<a.length;n++){var i=a[n];if(!r[i].isHidden)return!1}return!0},t.prototype.render=function(){var r=this,n=this.props.value||this.props.param.defaultValue,a=this.props.param.map(n.name),i=this.props.param.label||Za(this.props.name),o=qv(a),s=this.props.param.help,u=s?w(w({},this.props.param.select),{help:function(c){return s({name:c,params:r.getValues(c)})}}):this.props.param.select,l=L(J3,{param:u,isDisabled:this.props.isDisabled,onChange:this.onChangeName,onEnter:this.props.onEnter,name:i,value:n.name},void 0);return o?a.type==="group"&&!a.isFlat?this.areParamsEmpty(a.params)?l:Te("div",w({className:"msp-mapped-parameter-group"},{children:[l,L(Gt,{svg:Ed,onClick:this.toggleExpanded,toggleState:this.state.isExpanded,title:i+" Properties"},void 0),this.state.isExpanded&&L(mL,{inMapped:!0,param:a,value:n.params,name:n.name,onChange:this.onChangeParam,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled},void 0)]}),void 0):Te(Rt,{children:[l,L(o,{param:a,value:n.params,name:n.name,onChange:this.onChangeParam,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled},void 0)]},void 0):l},t}(kt.exports.PureComponent),gL=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={current:r.props.value},r.onChangeParam=function(n){var a;r.setState({current:w(w({},r.state.current),(a={},a[n.name]=n.value,a))})},r.apply=function(){r.props.apply(r.state.current)},r}return t.prototype.componentDidUpdate=function(r){(this.props.params!==r.params||this.props.value!==r.value)&&this.setState({current:this.props.value})},t.prototype.render=function(){return Te(Rt,{children:[L(Pn,{params:this.props.params,onChange:this.onChangeParam,values:this.state.current,onEnter:this.apply,isDisabled:this.props.isDisabled},void 0),L("button",w({className:"msp-btn msp-btn-block msp-form-control msp-control-top-offset",onClick:this.apply,disabled:this.props.isDisabled},{children:this.props.isUpdate?"Update":"Add"}),void 0)]},void 0)},t}(kt.exports.PureComponent),cSe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!1},r.update=function(n){r.props.actions.update(n,r.props.index)},r.moveUp=function(){r.props.actions.move(r.props.index,-1)},r.moveDown=function(){r.props.actions.move(r.props.index,1)},r.remove=function(){r.setState({isExpanded:!1}),r.props.actions.remove(r.props.index)},r.toggleExpanded=function(n){r.setState({isExpanded:!r.state.isExpanded}),n.currentTarget.blur()},r}return t.prototype.render=function(){return Te(Rt,{children:[Te("div",w({className:"msp-param-object-list-item"},{children:[Te("button",w({className:"msp-btn msp-btn-block msp-form-control",onClick:this.toggleExpanded},{children:[L("span",{children:this.props.index+1+": "},void 0),this.props.param.getLabel(this.props.value)]}),void 0),Te("div",{children:[L(Gt,{svg:Ey,title:"Move Up",onClick:this.moveUp,small:!0},void 0),L(Gt,{svg:Iy,title:"Move Down",onClick:this.moveDown,small:!0},void 0),L(Gt,{svg:Oo,title:"Remove",onClick:this.remove,small:!0},void 0)]},void 0)]}),void 0),this.state.isExpanded&&L("div",w({className:"msp-control-offset"},{children:L(gL,{params:this.props.param.element,apply:this.update,value:this.props.value,isUpdate:!0,isDisabled:this.props.isDisabled},void 0)}),void 0)]},void 0)},t}(kt.exports.PureComponent),tw=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!1},r.add=function(n){r.change(Nt(Nt([],r.props.value),[n]))},r.actions={update:function(n,a){var i=r.props.value.slice(0);i[a]=n,r.change(i)},move:function(n,a){var i=r.props.value;if(i.length!==1){var o=(n+a)%i.length;o<0&&(o+=i.length),i=i.slice(0);var s=i[n];i[n]=i[o],i[o]=s,r.change(i)}},remove:function(n){for(var a=r.props.value,i=[],o=0;o<a.length;o++)n!==o&&i.push(a[o]);r.change(i)}},r.toggleExpanded=function(n){r.setState({isExpanded:!r.state.isExpanded}),n.currentTarget.blur()},r}return t.prototype.change=function(r){this.props.onChange({name:this.props.name,param:this.props.param,value:r})},t.prototype.render=function(){var r=this,n=this.props.value,a=this.props.param.label||Za(this.props.name),i=n.length+" item"+(n.length!==1?"s":"");return Te(Rt,{children:[L(Io,{label:a,control:L("button",w({onClick:this.toggleExpanded,disabled:this.props.isDisabled},{children:i}),void 0)},void 0),this.state.isExpanded&&Te("div",w({className:"msp-control-offset"},{children:[this.props.value.map(function(o,s){return L(cSe,{param:r.props.param,value:o,index:s,actions:r.actions,isDisabled:r.props.isDisabled},s)}),L(Pu,w({header:"New Item"},{children:L(gL,{params:this.props.param.element,apply:this.add,value:this.props.param.ctor(),isDisabled:this.props.isDisabled},void 0)}),void 0)]}),void 0)]},void 0)},t}(kt.exports.PureComponent),dSe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onChangeCondition=function(n){r.change(r.props.param.conditionedValue(r.props.value,n.value))},r.onChangeParam=function(n){r.change(n.value)},r}return t.prototype.change=function(r){this.props.onChange({name:this.props.name,param:this.props.param,value:r})},t.prototype.render=function(){var r=this.props.value,n=this.props.param.conditionForValue(r),a=this.props.param.conditionParams[n],i=this.props.param.label||Za(this.props.name),o=qv(a),s=L(J3,{param:this.props.param.select,isDisabled:this.props.isDisabled,onChange:this.onChangeCondition,onEnter:this.props.onEnter,name:i+" Kind",value:n},void 0);return o?Te(Rt,{children:[s,L(o,{param:a,value:r,name:i,onChange:this.onChangeParam,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled},void 0)]},void 0):s},t}(kt.exports.PureComponent),fSe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onChange=function(n){r.props.onChange({name:r.props.name,param:r.props.param,value:r.props.param.toValue(n.value)})},r}return t.prototype.render=function(){var r=this.props.param.fromValue(this.props.value),n=qv(this.props.param.converted);return n?L(n,{param:this.props.param.converted,value:r,name:this.props.name,onChange:this.onChange,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled},void 0):null},t}(kt.exports.PureComponent),pSe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onChange=function(n){var a=n.target.value;a!==r.props.value.expression&&r.update({language:r.props.value.language,expression:a})},r.onKeyPress=function(n){(n.keyCode===13||n.charCode===13||n.key==="Enter")&&r.props.onEnter&&r.props.onEnter(),n.stopPropagation()},r}return t.prototype.renderControl=function(){var r=this.props.param.label||Za(this.props.name);return L("input",{type:"text",value:this.props.value.expression||"",placeholder:r,onChange:this.onChange,onKeyPress:this.props.onEnter?this.onKeyPress:void 0,disabled:this.props.isDisabled},void 0)},t}(uf),hSe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.updateParams=function(n){var a;r.plugin.managers.animation.updateParams((a={},a[n.name]=n.value,a))},r.updateCurrentParams=function(n){var a;r.plugin.managers.animation.updateCurrentParams((a={},a[n.name]=n.value,a))},r.startOrStop=function(){var n=r.plugin.managers.animation;n.state.animationState==="playing"?n.stop():(r.props.onStart&&r.props.onStart(),n.start())},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.animation.events.updated,function(){return r.forceUpdate()})},t.prototype.render=function(){var r,n,a=this.plugin.managers.animation;if(a.isEmpty)return null;var i=a.state.animationState==="playing",o=(n=(r=a.current.anim).canApply)===null||n===void 0?void 0:n.call(r,this.plugin);return Te(Rt,{children:[L(Pn,{params:a.getParams(),values:a.state.params,onChange:this.updateParams,isDisabled:i},void 0),L(Pn,{params:a.current.params,values:a.current.paramValues,onChange:this.updateCurrentParams,isDisabled:i},void 0),L("div",w({className:"msp-flex-row"},{children:L(pr,w({icon:a.state.animationState!=="playing"?void 0:xR,onClick:this.startOrStop,disabled:o!==void 0&&o.canApply===!1},{children:a.state.animationState==="playing"?"Stop":o===void 0||o.canApply?"Start":o.reason||"Start"}),void 0)}),void 0)]},void 0)},t}(hr),yL="overpaint-controls";function DI(e,t,r,n,a){return ce(this,void 0,void 0,function(){var i=this;return de(this,function(o){switch(o.label){case 0:return[4,vSe(e,t,function(s,u,l){return ce(i,void 0,void 0,function(){var c,d,f,p,h,h;return de(this,function(v){switch(v.label){case 0:return a&&a.length>0&&!a.includes(u.params.values.type.name)?[2]:(c=u.obj.data.sourceData,[4,n(c.root)]);case 1:return d=v.sent(),ir.isEmpty(d)?[2]:(f={bundle:Qr.fromLoci(d),color:r===-1?it(0):r,clear:r===-1},l?(p=Nt(Nt([],l.params.values.layers),[f]),h=RI(p,c),s.to(l).update(va.toBundle(h))):(h=RI([f],c),s.to(u.transform.ref).apply(rt.Representation.OverpaintStructureRepresentation3DFromBundle,va.toBundle(h),{tags:yL})),[2])}})})})];case 1:return o.sent(),[2]}})})}function vSe(e,t,r){return ce(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d;return de(this,function(f){switch(f.label){case 0:n=e.state.data,a=n.build(),i=0,o=t,f.label=1;case 1:if(!(i<o.length))return[3,6];s=o[i],u=0,l=s.representations,f.label=2;case 2:return u<l.length?(c=l[u],d=n.select(ar.Generators.ofTransformer(rt.Representation.OverpaintStructureRepresentation3DFromBundle,c.cell.transform.ref).withTag(yL)),[4,r(a,c.cell,d[0])]):[3,5];case 3:f.sent(),f.label=4;case 4:return u++,[3,2];case 5:return i++,[3,1];case 6:return[2,a.commit({doNotUpdateCurrent:!0})]}})})}function RI(e,t){var r=va.ofBundle(e,t.root),n=va.merge(r);return va.filter(n,t)}var bL="clipping-controls";function mSe(e,t,r,n,a){return ce(this,void 0,void 0,function(){var i=this;return de(this,function(o){switch(o.label){case 0:return[4,gSe(e,t,function(s,u,l){return ce(i,void 0,void 0,function(){var c,d,f,p,h,h;return de(this,function(v){switch(v.label){case 0:return a&&a.length>0&&!a.includes(u.params.values.type.name)?[2]:(c=u.obj.data.sourceData,[4,n(c.root)]);case 1:return d=v.sent(),ir.isEmpty(d)?[2]:(f={bundle:Qr.fromLoci(d),groups:r},l?(p=Nt(Nt([],l.params.values.layers),[f]),h=OI(p,c),s.to(l).update(en.toBundle(h))):(h=OI([f],c),s.to(u.transform.ref).apply(rt.Representation.ClippingStructureRepresentation3DFromBundle,en.toBundle(h),{tags:bL})),[2])}})})})];case 1:return o.sent(),[2]}})})}function gSe(e,t,r){return ce(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d;return de(this,function(f){switch(f.label){case 0:n=e.state.data,a=n.build(),i=0,o=t,f.label=1;case 1:if(!(i<o.length))return[3,6];s=o[i],u=0,l=s.representations,f.label=2;case 2:return u<l.length?(c=l[u],d=n.select(ar.Generators.ofTransformer(rt.Representation.ClippingStructureRepresentation3DFromBundle,c.cell.transform.ref).withTag(bL)),[4,r(a,c.cell,d[0])]):[3,5];case 3:f.sent(),f.label=4;case 4:return u++,[3,2];case 5:return i++,[3,1];case 6:return[2,a.commit({doNotUpdateCurrent:!0})]}})})}function OI(e,t){var r=en.ofBundle(e,t.root),n=en.merge(r);return en.filter(n,t)}var SL="transparency-controls";function ySe(e,t,r,n,a){return ce(this,void 0,void 0,function(){var i=this;return de(this,function(o){switch(o.label){case 0:return[4,bSe(e,t,function(s,u,l){return ce(i,void 0,void 0,function(){var c,d,f,p,h,h;return de(this,function(v){switch(v.label){case 0:return a&&a.length>0&&!a.includes(u.params.values.type.name)?[2]:(c=u.obj.data.sourceData,[4,n(c.root)]);case 1:return d=v.sent(),ir.isEmpty(d)?[2]:(f={bundle:Qr.fromLoci(d),value:r},l?(p=Nt(Nt([],l.params.values.layers),[f]),h=FI(p,c),s.to(l).update(ma.toBundle(h))):(h=FI([f],c),s.to(u.transform.ref).apply(rt.Representation.TransparencyStructureRepresentation3DFromBundle,ma.toBundle(h),{tags:SL})),[2])}})})})];case 1:return o.sent(),[2]}})})}function bSe(e,t,r){return ce(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d;return de(this,function(f){switch(f.label){case 0:n=e.state.data,a=n.build(),i=0,o=t,f.label=1;case 1:if(!(i<o.length))return[3,6];s=o[i],u=0,l=s.representations,f.label=2;case 2:return u<l.length?(c=l[u],d=n.select(ar.Generators.ofTransformer(rt.Representation.TransparencyStructureRepresentation3DFromBundle,c.cell.transform.ref).withTag(SL)),[4,r(a,c.cell,d[0])]):[3,5];case 3:f.sent(),f.label=4;case 4:return u++,[3,2];case 5:return i++,[3,1];case 6:return[2,a.commit({doNotUpdateCurrent:!0})]}})})}function FI(e,t){var r=ma.ofBundle(e,t.root),n=ma.merge(r);return ma.filter(n,t)}var Gd=function(e){Be(t,e);function t(r){var n=e.call(this,{options:E.getDefaultValues(t.OptionsParams)})||this;return n.plugin=r,n.events={optionsUpdated:n.ev()},n}return Object.defineProperty(t.prototype,"currentStructures",{get:function(){return this.plugin.managers.structure.hierarchy.selection.structures},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pivotStructure",{get:function(){return this.currentStructures[0]},enumerable:!1,configurable:!0}),t.prototype.setOptions=function(r){return ce(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d=this;return de(this,function(f){for(n=r.interactions!==this.state.options.interactions,this.updateState({options:r}),this.events.optionsUpdated.next(),a=this.dataState.build(),i=0,o=this.currentStructures;i<o.length;i++)for(s=o[i],u=0,l=s.components;u<l.length;u++)c=l[u],this.updateReprParams(a,c);return[2,this.plugin.dataTransaction(function(){return ce(d,void 0,void 0,function(){return de(this,function(p){switch(p.label){case 0:return[4,a.commit()];case 1:return p.sent(),[4,this.plugin.state.updateBehavior(Y3,function(h){h.ignoreHydrogens=!r.showHydrogens})];case 2:return p.sent(),n?[4,this.updateInterationProps()]:[3,4];case 3:p.sent(),p.label=4;case 4:return[2]}})})})]})})},t.prototype.updateReprParams=function(r,n){for(var a=this.state.options,i=a.showHydrogens,o=a.visualQuality,s=!i,u=0,l=n.representations;u<l.length;u++){var c=l[u];if(c.cell.transform.transformer===kg){var d=c.cell.transform.params;(!!d.type.params.ignoreHydrogens!==s||d.type.params.quality!==o)&&r.to(c.cell).update(function(f){f.type.params.ignoreHydrogens=s,f.type.params.quality=o})}}},t.prototype.updateInterationProps=function(){var r,n,a;return ce(this,void 0,void 0,function(){var i,o,s,u,l,c,d,f=this;return de(this,function(p){switch(p.label){case 0:i=0,o=this.currentStructures,p.label=1;case 1:return i<o.length?(s=o[i],u=Dn.getParams((r=s.cell.obj)===null||r===void 0?void 0:r.data),s.properties?(l=(n=s.properties.cell.transform.params)===null||n===void 0?void 0:n.properties[Dn.descriptor.name],E.areEqual(u,l,this.state.options.interactions)?[3,5]:[4,this.dataState.build().to(s.properties.cell).update(function(h){h.properties[Dn.descriptor.name]=f.state.options.interactions}).commit()]):[3,3]):[3,6];case 2:return p.sent(),[3,5];case 3:return c=this.plugin.customStructureProperties.getParams((a=s.cell.obj)===null||a===void 0?void 0:a.data),d=E.getDefaultValues(c),E.areEqual(u,d.properties[Dn.descriptor.name],this.state.options.interactions)?[3,5]:(d.properties[Dn.descriptor.name]=this.state.options.interactions,[4,this.plugin.builders.structure.insertStructureProperties(s.cell,d)]);case 4:p.sent(),p.label=5;case 5:return i++,[3,1];case 6:return[2]}})})},t.prototype.applyPreset=function(r,n,a){var i=this;return this.plugin.dataTransaction(function(){return ce(i,void 0,void 0,function(){var o,s,u,l;return de(this,function(c){switch(c.label){case 0:o=0,s=r,c.label=1;case 1:return o<s.length?(u=s[o],[4,this.plugin.builders.structure.representation.applyPreset(u.cell,n,a)]):[3,5];case 2:return l=c.sent(),[4,this.syncPreset(u,l)];case 3:c.sent(),c.label=4;case 4:return o++,[3,1];case 5:return[2]}})})},{canUndo:"Preset"})},t.prototype.syncPreset=function(r,n){if(!n||!n.components)return this.clearComponents([r]);var a=new Set;if(cs(n.components,function(y){y&&a.add(y.ref)}),n.representations&&cs(n.representations,function(y){y&&a.add(y.ref)}),a.size===0)return this.clearComponents([r]);for(var i=!1,o=this.dataState.build(),s=function(y){a.has(y.cell.transform.ref)||(i=!0,o.delete(y.cell))},u=0,l=r.components;u<l.length;u++){var c=l[u];s(c);for(var d=0,f=c.representations;d<f.length;d++){var p=f[d];s(p)}if(c.genericRepresentations)for(var h=0,v=c.genericRepresentations;h<v.length;h++){var p=v[h];s(p)}}if(r.genericRepresentations)for(var m=0,g=r.genericRepresentations;m<g.length;m++){var p=g[m];s(p)}if(i)return o.commit()},t.prototype.clear=function(r){return this.clearComponents(r)},t.prototype.selectThis=function(r){var n,a=this.plugin.managers.structure.selection;a.clear();for(var i=0,o=r;i<o.length;i++){var s=o[i],u=Xe.toSubStructureElementLoci(s.structure.cell.obj.data,(n=s.cell.obj)===null||n===void 0?void 0:n.data);a.fromLoci("set",u)}},t.prototype.canBeModified=function(r){return this.plugin.builders.structure.isComponentTransform(r.cell)},t.prototype.modifyByCurrentSelection=function(r,n){var a=this;return this.plugin.runTask(We.create("Modify Component",function(i){return ce(a,void 0,void 0,function(){var o,s,u,l,c;return de(this,function(d){switch(d.label){case 0:for(o=this.dataState.build(),s=0,u=r;s<u.length;s++)l=u[s],this.canBeModified(l)&&(c=this.plugin.managers.structure.selection.getStructure(l.structure.cell.obj.data),!(!c||c.elementCount===0)&&this.modifyComponent(o,l,c,n));return[4,this.dataState.updateTree(o,{canUndo:"Modify Selection"}).runInContext(i)];case 1:return d.sent(),[2]}})})}))},t.prototype.toggleVisibility=function(r,n){if(r.length!==0)if(n)for(var u=r[0].representations.indexOf(n),a=!n.cell.state.isHidden,l=0,c=r;l<c.length;l++){var s=c[l],d=s.representations[u];!d||Vd(this.dataState,d.cell.transform.ref,a)}else for(var a=!r[0].cell.state.isHidden,i=0,o=r;i<o.length;i++){var s=o[i];Vd(this.dataState,s.cell.transform.ref,a)}},t.prototype.removeRepresentations=function(r,n){if(r.length!==0){var a=[];if(n){var i=r[0].representations.indexOf(n);if(i<0)return;for(var o=0,s=r;o<s.length;o++){var u=s[o];u.representations[i]&&a.push(u.representations[i])}}else for(var l=0,c=r;l<c.length;l++)for(var u=c[l],d=0,f=u.representations;d<f.length;d++){var p=f[d];a.push(p)}return this.plugin.managers.structure.hierarchy.remove(a,!0)}},t.prototype.updateRepresentations=function(r,n,a){if(r.length===0)return Promise.resolve();var i=r[0].representations.indexOf(n);if(i<0)return Promise.resolve();for(var o=this.dataState.build(),s=0,u=r;s<u.length;s++){var l=u[s],c=l.representations[i];!c||c.cell.transform.transformer===n.cell.transform.transformer&&o.to(c.cell).update(a)}return o.commit({canUndo:"Update Representation"})},t.prototype.updateRepresentationsTheme=function(r,n){var a,i,o,s;if(r.length!==0){for(var u=this.dataState.build(),l=0,c=r;l<c.length;l++)for(var d=c[l],f=function(g){var y=g.cell.transform.params,b=typeof n=="function"?n(d,g):n,x=b.color==="default"?IC(p.plugin,(a=d.structure.cell.obj)===null||a===void 0?void 0:a.data,y==null?void 0:y.type.name):b.color?IC(p.plugin,(i=d.structure.cell.obj)===null||i===void 0?void 0:i.data,y==null?void 0:y.type.name,b.color,b.colorParams):void 0,S=b.size==="default"?Z5(p.plugin,(o=d.structure.cell.obj)===null||o===void 0?void 0:o.data,y==null?void 0:y.type.name):b.color?Z5(p.plugin,(s=d.structure.cell.obj)===null||s===void 0?void 0:s.data,y==null?void 0:y.type.name,b.size,b.sizeParams):void 0;(x||S)&&u.to(g.cell).update(function(_){x&&(_.colorTheme=x),S&&(_.sizeTheme=S)})},p=this,h=0,v=d.representations;h<v.length;h++){var m=v[h];f(m)}return u.commit({canUndo:"Update Theme"})}},t.prototype.addRepresentation=function(r,n){var a=this;if(r.length!==0){var i=this.state.options,o=i.showHydrogens,s=i.visualQuality,u=!o,l={ignoreHydrogens:u,quality:s};return this.plugin.dataTransaction(function(){return ce(a,void 0,void 0,function(){var c,d,f;return de(this,function(p){switch(p.label){case 0:c=0,d=r,p.label=1;case 1:return c<d.length?(f=d[c],[4,this.plugin.builders.structure.representation.addRepresentation(f.cell,{type:this.plugin.representation.structure.registry.get(n),typeParams:l})]):[3,4];case 2:p.sent(),p.label=3;case 3:return c++,[3,1];case 4:return[2]}})})},{canUndo:"Add Representation"})}},t.prototype.tryFindComponent=function(r,n){var a=this;if(r.components.length!==0)return this.plugin.runTask(We.create("Find Component",function(i){return ce(a,void 0,void 0,function(){var o,s,u,l,c,d,f,p,h,v;return de(this,function(m){switch(m.label){case 0:return o=(h=r.cell.obj)===null||h===void 0?void 0:h.data,o?(l=(u=mt).unionStructure,[4,n.getSelection(this.plugin,i,o)]):[2];case 1:for(s=l.apply(u,[m.sent()]),c=0,d=r.components;c<d.length;c++)if(f=d[c],p=(v=f.cell.obj)===null||v===void 0?void 0:v.data,!(!p||!f.cell.parent)&&$J(s,p))return[2,f.cell];return[2]}})})}))},t.prototype.add=function(r,n){return ce(this,void 0,void 0,function(){var a=this;return de(this,function(i){return[2,this.plugin.dataTransaction(function(){return ce(a,void 0,void 0,function(){var o,s,u,l,c,d,f,p,h,v,m;return de(this,function(g){switch(g.label){case 0:if(o=n||this.currentStructures,o.length===0)return[2];s=this.state.options,u=s.showHydrogens,l=s.visualQuality,c=!u,d={ignoreHydrogens:c,quality:l},f=un.create22(),p=0,h=o,g.label=1;case 1:return p<h.length?(v=h[p],m=void 0,r.options.checkExisting?[4,this.tryFindComponent(v,r.selection)]:[3,3]):[3,8];case 2:m=g.sent(),g.label=3;case 3:return m?[3,5]:[4,this.plugin.builders.structure.tryCreateComponentFromSelection(v.cell,r.selection,f,{label:r.options.label||(r.selection===Xn.current?"Custom Selection":"")})];case 4:m=g.sent(),g.label=5;case 5:return r.representation==="none"||!m?[3,7]:[4,this.plugin.builders.structure.representation.addRepresentation(m,{type:this.plugin.representation.structure.registry.get(r.representation),typeParams:d})];case 6:g.sent(),g.label=7;case 7:return p++,[3,1];case 8:return[2]}})})},{canUndo:"Add Selection"})]})})},t.prototype.applyTheme=function(r,n){return ce(this,void 0,void 0,function(){var a=this;return de(this,function(i){return[2,this.plugin.dataTransaction(function(o){return ce(a,void 0,void 0,function(){var s,u,l,c,d,f,f,f,p=this;return de(this,function(h){switch(h.label){case 0:if(s=n||this.currentStructures,s.length===0)return[2];u=function(v){return ce(p,void 0,void 0,function(){var m,g;return de(this,function(y){switch(y.label){case 0:return g=(m=mt).toLociWithSourceUnits,[4,r.selection.getSelection(this.plugin,o,v)];case 1:return[2,g.apply(m,[y.sent()])]}})})},l=0,c=s,h.label=1;case 1:return l<c.length?(d=c[l],r.action.name!=="reset"?[3,3]:[4,DI(this.plugin,d.components,-1,u,r.representations)]):[3,10];case 2:return h.sent(),[3,9];case 3:return r.action.name!=="color"?[3,5]:(f=r.action.params,[4,DI(this.plugin,d.components,f.color,u,r.representations)]);case 4:return h.sent(),[3,9];case 5:return r.action.name!=="transparency"?[3,7]:(f=r.action.params,[4,ySe(this.plugin,d.components,f.value,u,r.representations)]);case 6:return h.sent(),[3,9];case 7:return r.action.name!=="clipping"?[3,9]:(f=r.action.params,[4,mSe(this.plugin,d.components,en.Groups.fromNames(f.excludeGroups),u,r.representations)]);case 8:h.sent(),h.label=9;case 9:return l++,[3,1];case 10:return[2]}})})},{canUndo:"Apply Theme"})]})})},t.prototype.modifyComponent=function(r,n,a,i){var o,s,u,l=(o=n.cell.obj)===null||o===void 0?void 0:o.data;if(!!l&&!((i==="subtract"||i==="intersect")&&!Yy(l,a))){var c=(s=n.structure.cell.obj)===null||s===void 0?void 0:s.data,d=i==="union"?Sv(c,[l,a]):i==="intersect"?Q6(l,a):l3(l,a);if(d.elementCount===0)r.delete(n.cell.transform.ref);else{var f=Qr.fromSubStructure(c,d),p={type:{name:"bundle",params:f},nullIfEmpty:!0,label:(u=n.cell.obj)===null||u===void 0?void 0:u.label};r.to(n.cell).update(p)}}},t.prototype.updateLabel=function(r,n){var a,i,o={type:(a=r.cell.params)===null||a===void 0?void 0:a.values.type,nullIfEmpty:(i=r.cell.params)===null||i===void 0?void 0:i.values.nullIfEmpty,label:n};this.dataState.build().to(r.cell).update(o).commit()},Object.defineProperty(t.prototype,"dataState",{get:function(){return this.plugin.state.data},enumerable:!1,configurable:!0}),t.prototype.clearComponents=function(r){for(var n=this.dataState.build(),a=0,i=r;a<i.length;a++)for(var o=i[a],s=0,u=o.components;s<u.length;s++){var l=u[s];n.delete(l.cell.transform.ref)}return n.commit({canUndo:"Clear Selections"})},t}(gl);(function(e){e.OptionsParams={showHydrogens:E.Boolean(!0,{description:"Toggle display of hydrogen atoms in representations"}),visualQuality:E.Select("auto",Z_,{description:"Control the visual/rendering quality of representations"}),interactions:E.Group(Dn.defaultParams,{label:"Non-covalent Interactions"})};function t(i,o){var s=i.query.structure.registry.options;return o=w({pivot:i.managers.structure.component.pivotStructure,allowNone:!0,hideSelection:!1,checkExisting:!1},o),{selection:E.Select(s[1][0],s,{isHidden:o==null?void 0:o.hideSelection}),representation:a(i,o==null?void 0:o.pivot,o!=null&&o.allowNone?[["none","< Create Later >"]]:[]),options:E.Group({label:E.Text(""),checkExisting:E.Boolean(!!(o!=null&&o.checkExisting),{help:function(){return{description:"Checks if a selection with the specifield elements already exists to avoid creating duplicate components."}}})})}}e.getAddParams=t;function r(i,o){var s=i.query.structure.registry.options;return{selection:E.Select(s[1][0],s,{isHidden:!1}),action:E.MappedStatic("color",{color:E.Group({color:E.Color(dr.blue,{isExpanded:!0})},{isFlat:!0}),reset:E.EmptyGroup({label:"Reset Color"}),transparency:E.Group({value:E.Numeric(.5,{min:0,max:1,step:.01})},{isFlat:!0}),clipping:E.Group({excludeGroups:E.MultiSelect([],E.objectToOptions(en.Groups.Names))},{isFlat:!0})}),representations:E.MultiSelect([],n(i,o),{emptyValue:"All"})}}e.getThemeParams=r;function n(i,o){var s,u;return!((s=o==null?void 0:o.cell.obj)===null||s===void 0)&&s.data?i.representation.structure.registry.getApplicableTypes((u=o.cell.obj)===null||u===void 0?void 0:u.data):i.representation.structure.registry.types}e.getRepresentationTypes=n;function a(i,o,s,u){var l=Nt(Nt([],s),n(i,o));return E.Select(l[0][0],l,{label:u})}})(Gd||(Gd={}));var $h;(function(e){function t(i,o){return{key:i,data:o}}function r(i){return{entries:yx(),capacity:Math.max(1,i)}}e.create=r;function n(i,o){for(var s=i.entries.first;s;s=s.next)if(s.value.key===o)return i.entries.remove(s),i.entries.addLast(s.value),s.value.data}e.get=n;function a(i,o,s){var u=void 0;if(i.entries.count>=i.capacity){var l=i.entries.first;u=l.value.data,i.entries.remove(l)}return i.entries.addLast(t(o,s)),u}e.set=a})($h||($h={}));var Qa=function(e){Be(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t}(ge.CreateBehavior({name:"Volume Streaming"}));(function(e){e.RootTag="volume-streaming-info";function t(o,s,u,l,c){var d,f,p,h;return c===void 0&&(c={}),E.Group({isoValue:Ct.createIsoValueParam((d=c.isoValue)!==null&&d!==void 0?d:u,l),color:E.Color((f=c.color)!==null&&f!==void 0?f:s),wireframe:E.Boolean((p=c.wireframe)!==null&&p!==void 0?p:!1),opacity:E.Numeric((h=c.opacity)!==null&&h!==void 0?h:.3,{min:0,max:1,step:.01})},{label:o,isExpanded:!0})}var r={byteOffset:0,rate:1,sampleCount:[1,1,1],valuesInfo:[{mean:0,min:-1,max:1,sigma:.1},{mean:0,min:-1,max:1,sigma:.1}]};function n(o){o===void 0&&(o={});var s=o.data,u=o.defaultView,l=o.channelParams,c=new Map;s&&s.entries.forEach(function(p){return c.set(p.dataId,p)});var d=s?s.entries.map(function(p){return[p.dataId,p.dataId]}):[],f=s?s.entries[0].dataId:"";return{entry:E.Mapped(f,d,function(p){return E.Group(a({entryData:c.get(p),defaultView:u,structure:s&&s.structure,channelParams:l}))})}}e.createParams=n;function a(o){var s=o.entryData,u=o.defaultView,l=o.structure,c=o.channelParams,d=c===void 0?{}:c,f=s||{kind:"em",header:{sampling:[r],availablePrecisions:[{precision:0,maxVoxels:0}]},emDefaultContourLevel:Ct.IsoValue.relative(0)},p=l&&l.boundary.box||Xt();return{view:E.MappedStatic(u||(f.kind==="em"?"cell":"selection-box"),{off:E.Group({}),box:E.Group({bottomLeft:E.Vec3(p.min),topRight:E.Vec3(p.max)},{description:"Static box defined by cartesian coords.",isFlat:!0}),"selection-box":E.Group({radius:E.Numeric(5,{min:0,max:50,step:.5},{description:"Radius in \u212B within which the volume is shown."}),bottomLeft:E.Vec3(C.create(0,0,0),{},{isHidden:!0}),topRight:E.Vec3(C.create(0,0,0),{},{isHidden:!0})},{description:"Box around focused element.",isFlat:!0}),cell:E.Group({}),auto:E.Group({radius:E.Numeric(5,{min:0,max:50,step:.5},{description:"Radius in \u212B within which the volume is shown."}),selectionDetailLevel:E.Select(Math.min(6,f.header.availablePrecisions.length-1),f.header.availablePrecisions.map(function(h,v){return[v,v+1+" [ "+(Math.pow(h.maxVoxels,1/3)|0)+"^3 cells ]"]}),{label:"Selection Detail",description:"Determines the maximum number of voxels. Depending on the size of the volume options are in the range from 0 (0.52M voxels) to 6 (25.17M voxels)."}),isSelection:E.Boolean(!1,{isHidden:!0}),bottomLeft:E.Vec3(p.min,{},{isHidden:!0}),topRight:E.Vec3(p.max,{},{isHidden:!0})},{description:"Box around focused element.",isFlat:!0})},{options:e.ViewTypeOptions,description:'Controls what of the volume is displayed. "Off" hides the volume alltogether. "Bounded box" shows the volume inside the given box. "Around Interaction" shows the volume around the focused element/atom. "Whole Structure" shows the volume for the whole structure.'}),detailLevel:E.Select(Math.min(3,f.header.availablePrecisions.length-1),f.header.availablePrecisions.map(function(h,v){return[v,v+1+" [ "+(Math.pow(h.maxVoxels,1/3)|0)+"^3 cells ]"]}),{description:"Determines the maximum number of voxels. Depending on the size of the volume options are in the range from 0 (0.52M voxels) to 6 (25.17M voxels)."}),channels:f.kind==="em"?E.Group({em:t("EM",it(6524815),f.emDefaultContourLevel||Ct.IsoValue.relative(1),f.header.sampling[0].valuesInfo[0],d.em)},{isFlat:!0}):E.Group({"2fo-fc":t("2Fo-Fc",it(3367602),Ct.IsoValue.relative(1.5),f.header.sampling[0].valuesInfo[0],d["2fo-fc"]),"fo-fc(+ve)":t("Fo-Fc(+ve)",it(3390259),Ct.IsoValue.relative(3),f.header.sampling[0].valuesInfo[1],d["fo-fc(+ve)"]),"fo-fc(-ve)":t("Fo-Fc(-ve)",it(12268339),Ct.IsoValue.relative(-3),f.header.sampling[0].valuesInfo[1],d["fo-fc(-ve)"])},{isFlat:!0})}}e.createEntryParams=a,e.ViewTypeOptions=[["off","Off"],["box","Bounded Box"],["selection-box","Around Focus"],["cell","Whole Structure"],["auto","Auto"]],e.ChannelTypeOptions=[["em","em"],["2fo-fc","2fo-fc"],["fo-fc(+ve)","fo-fc(+ve)"],["fo-fc(-ve)","fo-fc(-ve)"]];var i=function(o){Be(s,o);function s(u,l){var c=o.call(this,u,{})||this;return c.plugin=u,c.data=l,c.cache=$h.create(25),c.params={},c.lastLoci=Or,c.ref="",c.channels={},c._invTransform=ue(),c.infoMap=new Map,c.data.entries.forEach(function(d){return c.infoMap.set(d.dataId,d)}),c}return Object.defineProperty(s.prototype,"info",{get:function(){return this.infoMap.get(this.params.entry.name)},enumerable:!1,configurable:!0}),s.prototype.queryData=function(u){return ce(this,void 0,void 0,function(){var l,c,d,f,p,h,v,m,g;return de(this,function(y){switch(y.label){case 0:return l=S1(this.data.serverUrl,this.info.kind+"/"+this.info.dataId.toLowerCase()),u?(c=u.min,d=u.max,l+="/box"+("/"+c.map(function(b){return Math.round(1e3*b)/1e3}).join(","))+("/"+d.map(function(b){return Math.round(1e3*b)/1e3}).join(","))):l+="/cell",f=this.params.entry.params.detailLevel,this.params.entry.params.view.name==="auto"&&this.params.entry.params.view.params.isSelection&&(f=this.params.entry.params.view.params.selectionDetailLevel),l+="?detail="+f,p=$h.get(this.cache,l),p?[2,p.data]:(h=gn.getUrlAsset(this.plugin.managers.asset,l),[4,this.plugin.runTask(this.plugin.managers.asset.resolve(h,"binary"))]);case 1:return v=y.sent(),[4,this.parseCif(v.data)];case 2:return m=y.sent(),m?(g=$h.set(this.cache,l,{data:m,asset:v}),g&&g.asset.dispose(),[2,m]):[2]}})})},s.prototype.parseCif=function(u){return ce(this,void 0,void 0,function(){var l,c,d,f,p,h;return de(this,function(v){switch(v.label){case 0:return[4,this.plugin.runTask(Gu.parseBinary(u))];case 1:if(l=v.sent(),l.isError)return this.plugin.log.error("VolumeStreaming, parsing CIF: "+l.toString()),[2];if(l.result.blocks.length<2)return this.plugin.log.error("VolumeStreaming: Invalid data."),[2];c={},d=1,v.label=2;case 2:return d<l.result.blocks.length?(f=l.result.blocks[d],p=Gu.schema.densityServer(f),[4,this.plugin.runTask(yF(p))]):[3,5];case 3:h=v.sent(),c[f.header]=h,v.label=4;case 4:return d++,[3,2];case 5:return[2,c]}})})},s.prototype.updateSelectionBoxParams=function(u){if(this.params.entry.params.view.name==="selection-box"){var l=this.plugin.state.data,c=w(w({},this.params),{entry:{name:this.params.entry.name,params:w(w({},this.params.entry.params),{view:{name:"selection-box",params:{radius:this.params.entry.params.view.params.radius,bottomLeft:u.min,topRight:u.max}}})}}),d=l.build().to(this.ref).update(c);wt.State.Update(this.plugin,{state:l,tree:d,options:{doNotUpdateCurrent:!0}})}},s.prototype.updateAutoParams=function(u,l){if(this.params.entry.params.view.name==="auto"){var c=this.plugin.state.data,d=w(w({},this.params),{entry:{name:this.params.entry.name,params:w(w({},this.params.entry.params),{view:{name:"auto",params:{radius:this.params.entry.params.view.params.radius,selectionDetailLevel:this.params.entry.params.view.params.selectionDetailLevel,isSelection:l,bottomLeft:(u==null?void 0:u.min)||C.zero(),topRight:(u==null?void 0:u.max)||C.zero()}}})}}),f=c.build().to(this.ref).update(d);wt.State.Update(this.plugin,{state:c,tree:f,options:{doNotUpdateCurrent:!0}})}},s.prototype.getStructureRoot=function(){return this.plugin.state.data.select(ar.Generators.byRef(this.ref).rootOfType(ge.Molecule.Structure))[0]},s.prototype.register=function(u){var l=this;this.ref=u,this.subscribeObservable(this.plugin.state.events.object.removed,function(c){!ge.Molecule.Structure.is(c.obj)||!Re.is(l.lastLoci)||l.lastLoci.structure===c.obj.data&&(l.lastLoci=Or)}),this.subscribeObservable(this.plugin.state.events.object.updated,function(c){!ge.Molecule.Structure.is(c.oldObj)||!Re.is(l.lastLoci)||l.lastLoci.structure===c.oldObj.data&&(l.lastLoci=Or)}),this.subscribeObservable(this.plugin.managers.structure.focus.behaviors.current,function(c){if(!!l.plugin.state.data.tree.children.has(l.ref)){var d=c?c.loci:Or;switch(l.params.entry.params.view.name){case"auto":l.updateAuto(d);break;case"selection-box":l.updateSelectionBox(d);break;default:l.lastLoci=d;break}}})},s.prototype.unregister=function(){for(var u=this.cache.entries.first;u;)u.value.data.asset.dispose(),u=u.next},s.prototype.getBoxFromLoci=function(u){var l,c,d;if(ir.isEmpty(u))return Xt();var f=this.plugin.helpers.substructureParent.get(u.structure,!0);if(!f)return Xt();var p=this.getStructureRoot();if(!p||((l=p.obj)===null||l===void 0?void 0:l.data)!==((c=f.obj)===null||c===void 0?void 0:c.data))return Xt();var h=Sd.get((d=p.obj)===null||d===void 0?void 0:d.data.models[0]);h&&ue.invert(this._invTransform,h);var v=Re.extendToWholeResidues(u),m=Re.getBoundary(v,h&&!Number.isNaN(this._invTransform[0])?this._invTransform:void 0).box;return Re.size(v)===1&&Xt.expand(m,m,C.create(1,1,1)),m},s.prototype.updateAuto=function(u){if(this.lastLoci=u,ns(u)){this.updateAutoParams(this.info.kind==="x-ray"?this.data.structure.boundary.box:void 0,!1);return}var l=this.getBoxFromLoci(u);this.updateAutoParams(l,!0)},s.prototype.updateSelectionBox=function(u){if(ir.areEqual(this.lastLoci,u)){this.lastLoci=Or,this.updateSelectionBoxParams(Xt());return}if(this.lastLoci=u,ns(u)){this.updateSelectionBoxParams(Xt());return}var l=this.getBoxFromLoci(u);this.updateSelectionBoxParams(l)},s.prototype.update=function(u){return ce(this,void 0,void 0,function(){var l,c,d,f,f,p,h,v;return de(this,function(m){switch(m.label){case 0:switch(l=u.entry.params.view.name==="selection-box"&&this.params&&this.params.entry&&this.params.entry.params&&this.params.entry.params.view&&this.params.entry.params.view.name!=="selection-box",this.params=u,c=void 0,d=!1,u.entry.params.view.name){case"off":d=!0;break;case"box":c=Xt.create(u.entry.params.view.params.bottomLeft,u.entry.params.view.params.topRight),d=Xt.volume(c)<1e-4;break;case"selection-box":{l?c=this.getBoxFromLoci(this.lastLoci)||Xt():c=Xt.create(C.clone(u.entry.params.view.params.bottomLeft),C.clone(u.entry.params.view.params.topRight)),f=u.entry.params.view.params.radius,d=Xt.volume(c)<1e-4,Xt.expand(c,c,C.create(f,f,f));break}case"cell":c=this.info.kind==="x-ray"?this.data.structure.boundary.box:void 0;break;case"auto":c=u.entry.params.view.params.isSelection||this.info.kind==="x-ray"?Xt.create(C.clone(u.entry.params.view.params.bottomLeft),C.clone(u.entry.params.view.params.topRight)):void 0,c&&(d=Xt.volume(c)<1e-4,u.entry.params.view.params.isSelection&&(f=u.entry.params.view.params.radius,Xt.expand(c,c,C.create(f,f,f))));break}return d?(h={},[3,3]):[3,1];case 1:return[4,this.queryData(c)];case 2:h=m.sent(),m.label=3;case 3:return p=h,p?(v=u.entry.params.channels,this.info.kind==="x-ray"?(this.channels["2fo-fc"]=this.createChannel(p["2FO-FC"]||Ct.One,v["2fo-fc"],this.info.header.sampling[0].valuesInfo[0]),this.channels["fo-fc(+ve)"]=this.createChannel(p["FO-FC"]||Ct.One,v["fo-fc(+ve)"],this.info.header.sampling[0].valuesInfo[1]),this.channels["fo-fc(-ve)"]=this.createChannel(p["FO-FC"]||Ct.One,v["fo-fc(-ve)"],this.info.header.sampling[0].valuesInfo[1])):this.channels.em=this.createChannel(p.EM||Ct.One,v.em,this.info.header.sampling[0].valuesInfo[0]),[2,!0]):[2,!1]}})})},s.prototype.createChannel=function(u,l,c){var d=l;return{data:u,color:d.color,wireframe:d.wireframe,opacity:d.opacity,isoValue:d.isoValue.kind==="relative"?d.isoValue:Ct.IsoValue.toRelative(d.isoValue,c)}},s.prototype.getDescription=function(){return this.params.entry.params.view.name==="selection-box"?"Selection":this.params.entry.params.view.name==="box"?"Static Box":this.params.entry.params.view.name==="cell"?"Cell":""},s}(Mr.WithSubscribers);e.Behavior=i})(Qa||(Qa={}));function SSe(e,t){var r=DSe(e,t||rw());return kSe(e.tree,r),t&&t.refs.forEach(OSe,r),{hierarchy:r.hierarchy,added:r.added,changed:r.changed}}function rw(){return{trajectories:[],models:[],structures:[],refs:new Map}}function xSe(e){return{kind:"trajectory",cell:e,version:e.transform.version,models:[]}}function kI(e,t){return{kind:"model",cell:e,version:e.transform.version,trajectory:t,structures:[]}}function CSe(e,t){return{kind:"model-properties",cell:e,version:e.transform.version,model:t}}function _Se(e,t){return{kind:"model-unitcell",cell:e,version:e.transform.version,model:t}}function BI(e,t){return{kind:"structure",cell:e,version:e.transform.version,model:t,components:[]}}function wSe(e,t){return{kind:"structure-properties",cell:e,version:e.transform.version,structure:t}}function ASe(e,t){return{kind:"structure-transform",cell:e,version:e.transform.version,structure:t}}function PSe(e,t){return{kind:"structure-volume-streaming",cell:e,version:e.transform.version,structure:t}}function TSe(e){return e.transform.tags?Nt([],e.transform.tags).sort().join():e.transform.ref}function ESe(e,t){return{kind:"structure-component",cell:e,version:e.transform.version,structure:t,key:TSe(e),representations:[]}}function ISe(e,t){return{kind:"structure-representation",cell:e,version:e.transform.version,component:t}}function MSe(e,t){return{kind:"generic-representation",cell:e,version:e.transform.version,parent:t}}function DSe(e,t){return{state:e,oldHierarchy:t,hierarchy:rw(),changed:!1,added:new Set}}function Df(e,t,r,n){for(var a=[],i=4;i<arguments.length;i++)a[i-4]=arguments[i];var o=n.apply(void 0,a);r.push(o),e.hierarchy.refs.set(t.transform.ref,o);var s=e.oldHierarchy.refs.get(t.transform.ref);return s?s.version!==t.transform.version&&(e.changed=!0):(e.added.add(o.cell.transform.ref),e.changed=!0),o}function jc(e,t,r){for(var n=[],a=3;a<arguments.length;a++)n[a-3]=arguments[a];var i=r.apply(void 0,n);e.hierarchy.refs.set(t.transform.ref,i);var o=e.oldHierarchy.refs.get(t.transform.ref);return o?o.version!==t.transform.version&&(e.changed=!0):(e.added.add(i.cell.transform.ref),e.changed=!0),i}function LI(e){return function(t){return e.is(t.obj)}}function NI(e,t){return function(r,n){return!t(n)&&e.is(r.obj)}}function Jm(e){return function(t){return t.transform.transformer===e}}function Wc(){}var RSe=[[LI(ge.Molecule.Trajectory),function(e,t){e.currentTrajectory=Df(e,t,e.hierarchy.trajectories,xSe,t)},function(e){return e.currentTrajectory=void 0}],[NI(ge.Molecule.Model,function(e){return e.currentModel}),function(e,t){e.currentTrajectory?e.currentModel=Df(e,t,e.currentTrajectory.models,kI,t,e.currentTrajectory):e.currentModel=jc(e,t,kI,t),e.hierarchy.models.push(e.currentModel)},function(e){return e.currentModel=void 0}],[Jm(rt.Model.CustomModelProperties),function(e,t){if(!e.currentModel)return!1;e.currentModel.properties=jc(e,t,CSe,t,e.currentModel)},Wc],[Jm(rt.Representation.ModelUnitcell3D),function(e,t){if(!e.currentModel)return!1;e.currentModel.unitcell=jc(e,t,_Se,t,e.currentModel)},Wc],[NI(ge.Molecule.Structure,function(e){return e.currentStructure}),function(e,t){e.currentModel?e.currentStructure=Df(e,t,e.currentModel.structures,BI,t,e.currentModel):e.currentStructure=jc(e,t,BI,t),e.hierarchy.structures.push(e.currentStructure)},function(e){return e.currentStructure=void 0}],[Jm(rt.Model.CustomStructureProperties),function(e,t){if(!e.currentStructure)return!1;e.currentStructure.properties=jc(e,t,wSe,t,e.currentStructure)},Wc],[Jm(rt.Model.TransformStructureConformation),function(e,t){if(!e.currentStructure)return!1;e.currentStructure.transform=jc(e,t,ASe,t,e.currentStructure)},Wc],[LI(Qa),function(e,t){return e.currentStructure&&(e.currentStructure.volumeStreaming=jc(e,t,PSe,t,e.currentStructure)),!1},Wc],[function(e,t){return t.currentComponent||!t.currentStructure||e.transform.transformer.definition.isDecorator?!1:ge.Molecule.Structure.is(e.obj)},function(e,t){e.currentStructure&&(e.currentComponent=Df(e,t,e.currentStructure.components,ESe,t,e.currentStructure))},function(e){return e.currentComponent=void 0}],[function(e,t){return!e.state.isGhost&&!!t.currentComponent&&ge.Molecule.Structure.Representation3D.is(e.obj)},function(e,t){return e.currentComponent&&Df(e,t,e.currentComponent.representations,ISe,t,e.currentComponent),!1},Wc],[function(e){return!e.state.isGhost&&ge.isRepresentation3D(e.obj)},function(e,t){var r=e.currentComponent||e.currentStructure||e.currentModel;r&&(r.genericRepresentations||(r.genericRepresentations=[]),Df(e,t,r.genericRepresentations,MSe,t,r))},Wc]];function xL(e){if(!e||!(e!=null&&e.parent)||!e.parent.cells.has(e.transform.ref))return!1;var t=e.obj;return!(!t||t===Cn.Null||e.status!=="ok"&&e.status!=="error")}function OSe(e){var t=e.cell;xL(t)||(this.changed=!0)}function FSe(e){CL(this,this.tree.transforms.get(e))}function CL(e,t){var r=e.state,n=r.state.cells.get(t.ref);if(!!xL(n)){for(var a=void 0,i=!1,o=0,s=RSe;o<s.length;o++){var u=s[o],l=u[0],c=u[1],d=u[2];if(l(n,r)){var f=c(r,n);if(f===!1){i=!0;break}a=d;break}}if(!i){var p=e.tree.children.get(t.ref);p&&p.size&&p.forEach(FSe,e),a&&a(r)}}}function kSe(e,t){var r={tree:e,state:t};return CL(r,e.root),r.state}var Pv=function(e){Be(t,e);function t(r){var n=e.call(this)||this;return n.plugin=r,n.state={syncedTree:n.dataState.tree,notified:!1,hierarchy:rw(),selection:{trajectories:[],models:[],structures:[]}},n.behaviors={selection:n.ev.behavior({hierarchy:n.current,trajectories:n.selection.trajectories,models:n.selection.models,structures:n.selection.structures})},n._currentComponentGroups=void 0,n._currentSelectionSet=void 0,n.subscribe(r.state.data.events.changed,function(a){a.inTransaction||r.behaviors.state.isAnimating.value||n.sync(!0)}),n.subscribe(r.behaviors.state.isAnimating,function(a){!a&&!r.behaviors.state.isUpdating.value&&n.sync(!0)}),n}return Object.defineProperty(t.prototype,"dataState",{get:function(){return this.plugin.state.data},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentComponentGroups",{get:function(){return this._currentComponentGroups?this._currentComponentGroups:(this._currentComponentGroups=t.getComponentGroups(this.selection.structures),this._currentComponentGroups)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"seletionSet",{get:function(){if(this._currentSelectionSet)return this._currentSelectionSet;this._currentSelectionSet=new Set;for(var r=0,n=this.selection.trajectories;r<n.length;r++){var a=n[r];this._currentSelectionSet.add(a.cell.transform.ref)}for(var i=0,o=this.selection.models;i<o.length;i++){var a=o[i];this._currentSelectionSet.add(a.cell.transform.ref)}for(var s=0,u=this.selection.structures;s<u.length;s++){var a=u[s];this._currentSelectionSet.add(a.cell.transform.ref)}return this._currentSelectionSet},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"current",{get:function(){return this.sync(!1),this.state.hierarchy},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"selection",{get:function(){return this.sync(!1),this.state.selection},enumerable:!1,configurable:!0}),t.prototype.getStructuresWithSelection=function(){for(var r=this.plugin.managers.structure.hierarchy.current.structures,n=[],a=0,i=r;a<i.length;a++){var o=i[a];this.plugin.managers.structure.selection.structureHasSelection(o)&&n.push(o)}return n},t.prototype.syncCurrent=function(r,n){for(var a=this.seletionSet,i=[],o=0,s=r;o<s.length;o++){var u=s[o],l=u.cell.transform.ref;(a.has(l)||n.has(l))&&i.push(u)}return i.length===0?r.length>0?[r[0]]:[]:i},t.prototype.sync=function(r){if(!(!r&&this.dataState.inUpdate)){if(this.state.syncedTree===this.dataState.tree){r&&!this.state.notified&&(this.state.notified=!0,this.behaviors.selection.next(w({hierarchy:this.state.hierarchy},this.state.selection)));return}this.state.syncedTree=this.dataState.tree;var n=SSe(this.plugin.state.data,this.current);if(!!n.changed){var a=n.hierarchy,i=this.syncCurrent(a.trajectories,n.added),o=this.syncCurrent(a.models,n.added),s=this.syncCurrent(a.structures,n.added);this._currentComponentGroups=void 0,this._currentSelectionSet=void 0,this.state.hierarchy=a,this.state.selection.trajectories=i,this.state.selection.models=o,this.state.selection.structures=s,r?(this.state.notified=!0,this.behaviors.selection.next({hierarchy:a,trajectories:i,models:o,structures:s})):this.state.notified=!1}}},t.prototype.updateCurrent=function(r,n){for(var a=this.current,i=n==="add"?jn.union(this.seletionSet,new Set(r.map(function(y){return y.cell.transform.ref}))):jn.difference(this.seletionSet,new Set(r.map(function(y){return y.cell.transform.ref}))),o=[],s=[],u=[],l=0,c=a.trajectories;l<c.length;l++){var d=c[l];i.has(d.cell.transform.ref)&&o.push(d)}for(var f=0,p=a.models;f<p.length;f++){var h=p[f];i.has(h.cell.transform.ref)&&s.push(h)}for(var v=0,m=a.structures;v<m.length;v++){var g=m[v];i.has(g.cell.transform.ref)&&u.push(g)}this._currentComponentGroups=void 0,this._currentSelectionSet=void 0,this.state.selection.trajectories=o,this.state.selection.models=s,this.state.selection.structures=u,this.behaviors.selection.next({hierarchy:a,trajectories:o,models:s,structures:u})},t.prototype.remove=function(r,n){if(r.length!==0){for(var a=this.plugin.state.data.build(),i=0,o=r;i<o.length;i++){var s=o[i];a.delete(typeof s=="string"?s:s.cell.transform.ref)}return a.commit({canUndo:n?"Remove":!1})}},t.prototype.toggleVisibility=function(r,n){if(r.length!==0)for(var a=n!==void 0?n!=="show":!r[0].cell.state.isHidden,i=0,o=r;i<o.length;i++){var s=o[i];Vd(this.dataState,s.cell.transform.ref,a)}},t.prototype.applyPreset=function(r,n,a){var i=this;return this.plugin.dataTransaction(function(){return ce(i,void 0,void 0,function(){var o,s,u;return de(this,function(l){switch(l.label){case 0:o=0,s=r,l.label=1;case 1:return o<s.length?(u=s[o],u.models.length>0?[4,this.clearTrajectory(u)]:[3,3]):[3,6];case 2:l.sent(),l.label=3;case 3:return[4,this.plugin.builders.structure.hierarchy.applyPreset(u.cell,n,a)];case 4:l.sent(),l.label=5;case 5:return o++,[3,1];case 6:return[2]}})})})},t.prototype.updateStructure=function(r,n){return ce(this,void 0,void 0,function(){var a=this;return de(this,function(i){switch(i.label){case 0:return[4,this.plugin.dataTransaction(function(){return ce(a,void 0,void 0,function(){var o,s;return de(this,function(u){switch(u.label){case 0:return o=Hn.getDecoratorRoot(this.dataState.tree,r.cell.transform.ref),s=this.dataState.tree.children.get(o).toArray(),[4,this.remove(s,!1)];case 1:return u.sent(),[4,this.plugin.state.updateTransform(this.plugin.state.data,r.cell.transform.ref,n,"Structure Type")];case 2:return u.sent(),[4,this.plugin.builders.structure.representation.applyPreset(r.cell.transform.ref,"auto")];case 3:return u.sent(),[2]}})})},{canUndo:"Structure Type"})];case 1:return i.sent(),wt.Camera.Reset(this.plugin),[2]}})})},t.prototype.clearTrajectory=function(r){for(var n=this.dataState.build(),a=0,i=r.models;a<i.length;a++){var o=i[a];n.delete(o.cell)}return n.commit()},t}(Vv);(function(e){function t(n){if(!n.length)return[];if(n.length===1)return n[0].components.map(function(h){return[h]});for(var a=[],i=new Map,o=0,s=n;o<s.length;o++)for(var u=s[o],l=0,c=u.components;l<c.length;l++){var d=c[l],f=d.key;if(!!f){var p=i.get(f);p||(p=[],i.set(f,p),a.push(p)),p.push(d)}}return a}e.getComponentGroups=t;function r(n){var a,i,o,s,u,l,c,d,f,p=n.managers.structure.hierarchy.selection.structures;if(p.length===0)return"";if(p.length===1){var h=p[0],v=(a=h.cell.obj)===null||a===void 0?void 0:a.data;if(!v)return((i=h.cell.obj)===null||i===void 0?void 0:i.label)||"Structure";var m=v.models[0]||v.representativeModel||v.masterModel;if(!m)return((o=h.cell.obj)===null||o===void 0?void 0:o.label)||"Structure";var g=m.entryId;return((u=(s=h.model)===null||s===void 0?void 0:s.trajectory)===null||u===void 0?void 0:u.models)&&h.model.trajectory.models.length===1?g:h.model?((l=h.model.cell.obj)===null||l===void 0?void 0:l.label)+" | "+g:g}for(var y=p[0],b=(c=y==null?void 0:y.model)===null||c===void 0?void 0:c.trajectory,x=!0,S=0,_=p;S<_.length;S++){var h=_[S];if(((d=h==null?void 0:h.model)===null||d===void 0?void 0:d.trajectory)!==b){x=!1;break}}return x&&b?((f=b.cell.obj)===null||f===void 0?void 0:f.label)+" | "+p.length+" structures":p.length+" structures"}e.getSelectedStructuresDescription=r})(Pv||(Pv={}));var qd=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onChange=function(n){var a,i=n.name,o=n.value,s=w(w({},r.props.params),(a={},a[i]=o,a));r.props.events.onChange(s,r.areInitial(s),r.validate(s))},r}return t.prototype.validate=function(r){},t.prototype.areInitial=function(r){return E.areEqual(this.props.info.params,r,this.props.info.initialValues)},t.prototype.render=function(){return L(Pn,{params:this.props.info.params,values:this.props.params,onChange:this.onChange,onEnter:this.props.events.onEnter,isDisabled:this.props.isDisabled},void 0)},t}(Sa);(function(e){function t(a){for(var i=Object.keys(a),o=0,s=i;o<s.length;o++){var u=s[o];if(!a[u].isHidden)return!1}return!0}function r(a,i,o,s){var u=i.cells.get(s).obj,l=o.definition.params?o.definition.params(u,a):{},c=E.getDefaultValues(l);return{initialValues:c,params:l,isEmpty:t(l)}}e.infoFromAction=r;function n(a,i,o){var s=i.cells.get(o.ref),u=s.params&&s.params.definition||{},l=s.params&&s.params.values||{};return{initialValues:l,params:u,isEmpty:t(u)}}e.infoFromTransform=n})(qd||(qd={}));var _L=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.busy=new Ln,r.onEnter=function(){r.state.error||r.apply()},r.autoApplyHandle=void 0,r.events={onEnter:r.onEnter,onChange:function(n,a,i){r.clearAutoApply(),r.setState({params:n,isInitial:a,error:i&&i[0]},function(){!a&&!r.state.error&&r.canAutoApply(n)&&(r.clearAutoApply(),r.autoApplyHandle=setTimeout(r.apply,50))})}},r.apply=function(){return ce(r,void 0,void 0,function(){var n,a;return de(this,function(i){switch(i.label){case 0:this.clearAutoApply(),this.setState({busy:!0}),i.label=1;case 1:return i.trys.push([1,3,4,5]),[4,this.applyAction()];case 2:return i.sent(),[3,5];case 3:return i.sent(),[3,5];case 4:return(a=(n=this.props).onApply)===null||a===void 0||a.call(n),this.busy.next(!1),[7];case 5:return[2]}})})},r.refresh=function(){r.setState({params:r.getInfo().initialValues,isInitial:!0,error:void 0})},r.setDefault=function(){var n=r.getInfo(),a=E.getDefaultValues(n.params);r.setState({params:a,isInitial:E.areEqual(n.params,a,n.initialValues),error:void 0})},r.toggleExpanded=function(){r.setState({isCollapsed:!r.state.isCollapsed})},r}return t.prototype.clearAutoApply=function(){this.autoApplyHandle!==void 0&&(clearTimeout(this.autoApplyHandle),this.autoApplyHandle=void 0)},t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.behaviors.state.isBusy,function(n){r.state.busy!==n&&r.busy.next(n)}),this.subscribe(this.busy,function(n){r.state.busy!==n&&r.setState({busy:n})})},t.prototype.renderApply=function(){var r=this.canApply();return this.props.autoHideApply&&(!r||this.canAutoApply(this.state.params))?null:Te("div",w({className:"msp-transform-apply-wrap"},{children:[L(Gt,{svg:ax,className:"msp-transform-default-params",onClick:this.setDefault,disabled:this.state.busy,title:"Set default params"},void 0),L("div",w({className:"msp-transform-apply-wider"},{children:L(pr,w({icon:r?wp:void 0,className:"msp-btn-commit msp-btn-commit-"+(r?"on":"off"),onClick:this.apply,disabled:!r},{children:this.props.applyLabel||this.applyText()}),void 0)}),void 0)]}),void 0)},t.prototype.renderDefault=function(){var r=this.getInfo(),n=r.isEmpty&&this.isUpdate(),a=this.getHeader(),i=this.getTransformerId(),o=this.plugin.customParamEditors.has(i)?this.plugin.customParamEditors.get(i):qd,s=this.state.isCollapsed?"msp-transform-wrapper msp-transform-wrapper-collapsed":"msp-transform-wrapper",u=null;if(!n&&!this.state.isCollapsed){var l=this.getSourceAndTarget(),c=l.a,d=l.b,f=l.bCell,p=this.renderApply();u=Te(Rt,{children:[L(o,{info:r,a:c,b:d,bCell:f,events:this.events,params:this.state.params,isDisabled:this.state.busy},void 0),p]},void 0)}var h=Te("div",w({className:s,style:{marginBottom:this.props.noMargin?0:void 0}},{children:[a!=="none"&&!this.props.wrapInExpander&&L("div",w({className:"msp-transform-header"},{children:Te(pr,w({onClick:this.toggleExpanded,title:a.description},{children:[!n&&L(tn,{svg:this.state.isCollapsed?Nu:Lu},void 0),a.name]}),void 0)}),void 0),u]}),void 0);return n||!this.props.wrapInExpander?h:L(ls,w({header:this.isUpdate()?"Update "+(a==="none"?"":a.name):"Apply "+(a==="none"?"":a.name),headerLeftMargin:this.props.expanderHeaderLeftMargin},{children:h}),void 0)},t.prototype.renderSimple=function(){var r,n,a,i=this.getInfo(),o=this.canApply(),s=Te("div",w({className:"msp-flex-row"},{children:[L(pr,w({icon:(r=this.props.simpleApply)===null||r===void 0?void 0:r.icon,title:(n=this.props.simpleApply)===null||n===void 0?void 0:n.title,disabled:this.state.busy||!o,onClick:this.apply,className:"msp-btn-apply-simple"},{children:(a=this.props.simpleApply)===null||a===void 0?void 0:a.header}),void 0),!i.isEmpty&&L(oa,{icon:Id,label:"",title:"Options",toggle:this.toggleExpanded,isSelected:!this.state.isCollapsed,disabled:this.state.busy,style:{flex:"0 0 40px",padding:0}},void 0)]}),void 0);if(this.state.isCollapsed)return s;var u=this.getTransformerId(),l=this.plugin.customParamEditors.has(u)?this.plugin.customParamEditors.get(u):qd,c=this.getSourceAndTarget(),d=c.a,f=c.b,p=c.bCell;return Te(Rt,{children:[s,L(l,{info:i,a:d,b:f,bCell:p,events:this.events,params:this.state.params,isDisabled:this.state.busy},void 0)]},void 0)},t.prototype.render=function(){return this.props.simpleApply?this.renderSimple():this.renderDefault()},t}(Sa),Zu=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r._getInfo=bc(function(n){return qd.infoFromTransform(r.plugin,r.props.state,n)}),r.state={error:void 0,isInitial:!0,params:r.getInfo().initialValues,busy:!1,isCollapsed:r.props.initiallyCollapsed},r}return t.prototype.applyAction=function(){return this.props.customUpdate?this.props.customUpdate(this.state.params):this.plugin.state.updateTransform(this.props.state,this.props.transform.ref,this.state.params)},t.prototype.getInfo=function(){return this._getInfo(this.props.transform)},t.prototype.getTransformerId=function(){return this.props.transform.transformer.id},t.prototype.getHeader=function(){return this.props.customHeader||this.props.transform.transformer.definition.display},t.prototype.canApply=function(){var r=this.props.state,n=r.cells.get(this.props.transform.ref);if(!n)return!1;if(n.status==="error"){var a=r.cells.get(this.props.transform.parent);return a?a.status==="ok":!1}return!this.state.error&&!this.state.busy&&!this.state.isInitial},t.prototype.applyText=function(){return this.canApply()?"Update":"Nothing to Update"},t.prototype.isUpdate=function(){return!0},t.prototype.getSourceAndTarget=function(){var r=this.props.state.cells.get(this.props.transform.ref);return{a:this.props.state.cells.get(this.props.transform.parent).obj,b:r==null?void 0:r.obj,bCell:r}},t.prototype.canAutoApply=function(r){var n=this.props.transform.transformer.definition.canAutoUpdate;if(!n)return!1;var a=this.props.state,i=a.cells.get(this.props.transform.ref);if(!i||!i.sourceRef||i.status!=="ok")return!1;var o=a.cells.get(i.sourceRef);return n({a:o.obj,b:i.obj,oldParams:this.getInfo().initialValues,newParams:r},this.plugin)},t.prototype.componentDidMount=function(){var r=this;e.prototype.componentDidMount.call(this),this.props.toggleCollapsed&&this.subscribe(this.props.toggleCollapsed,function(){return r.setState({isCollapsed:!r.state.isCollapsed})}),this.subscribe(this.plugin.state.events.object.updated,function(n){var a=n.ref,i=n.state;r.props.transform.ref!==a||r.props.state!==i||r.state.params!==r.props.transform.params&&(r._getInfo=bc(function(o){return qd.infoFromTransform(r.plugin,r.props.state,o)}),r.setState({params:r.props.transform.params,isInitial:!0}))})},t.prototype.componentDidUpdate=function(r){var n;if(this.props.transform!==r.transform){var a=this.props.state.cells.get(this.props.transform.ref);this.setState({params:((n=a.params)===null||n===void 0?void 0:n.values)||{},isInitial:!0,error:void 0,simpleOnly:this.state.simpleOnly})}},t}(_L);(function(e){Be(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.events.object.updated,function(n){var a=n.ref,i=n.state;r.props.nodeRef!==a||r.plugin.state.data!==i||r.forceUpdate()})},t.prototype.render=function(){var r=this.plugin.state.data,n=this.props.nodeRef,a=r.cells.get(n);if(!a||a.status!=="ok"&&a.status!=="error")return null;var i=a.transform;return L(Zu,{state:r,transform:i,initiallyCollapsed:this.props.initiallyCollapsed,customHeader:this.props.header},void 0)},t})(hr);var BSe=function(e){Be(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return Object.defineProperty(t.prototype,"current",{get:function(){return this.plugin.managers.structure.hierarchy.behaviors.selection},enumerable:!1,configurable:!0}),t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.current,function(){return r.forceUpdate()})},Object.defineProperty(t.prototype,"unitcell",{get:function(){var r,n=this.plugin.managers.structure.hierarchy.selection;if(n.structures.length===0)return null;for(var a=[],i=0,o=n.structures;i<o.length;i++){var s=o[i],u=s.model;(u==null?void 0:u.unitcell)&&((r=u.unitcell)===null||r===void 0?void 0:r.cell.obj)&&a.push(u.unitcell)}return a.length===0?null:L(UI,{refs:a,labelMultiple:"Unit Cells"},void 0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"customControls",{get:function(){var r=this,n=[];return this.plugin.genericRepresentationControls.forEach(function(a,i){var o=a(r.plugin.managers.structure.hierarchy.selection),s=o[0],u=o[1];s.length>0&&n.push(L("div",{children:L(UI,{refs:s,labelMultiple:u},void 0)},i))}),n.length>0?n:null},enumerable:!1,configurable:!0}),t.prototype.render=function(){return L(Rt,{children:Te("div",w({style:{marginTop:"6px"}},{children:[this.unitcell,this.customControls]}),void 0)},void 0)},t}(Sa),UI=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={showOptions:!1},r.toggleVisibility=function(n){n.preventDefault(),r.plugin.managers.structure.hierarchy.toggleVisibility(r.props.refs),n.currentTarget.blur()},r.highlight=function(n){n.preventDefault(),r.pivot.cell.parent&&wt.Interactivity.Object.Highlight(r.plugin,{state:r.pivot.cell.parent,ref:r.props.refs.map(function(a){return a.cell.transform.ref})})},r.clearHighlight=function(n){n.preventDefault(),wt.Interactivity.ClearHighlights(r.plugin)},r.focus=function(n){var a;n.preventDefault();for(var i=!0,o=0,s=r.props.refs;o<s.length;o++){var u=s[o];if(!u.cell.state.isHidden){i=!1;break}}i&&r.plugin.managers.structure.hierarchy.toggleVisibility(r.props.refs,"show");for(var l=[],c=0,d=r.props.refs;c<d.length;c++){var u=d[c];if(!u.cell.state.isHidden){var f=(a=u.cell.obj)===null||a===void 0?void 0:a.data.repr.getLoci();f&&l.push(f)}}r.plugin.managers.camera.focusLoci(l)},r.toggleOptions=function(){return r.setState({showOptions:!r.state.showOptions})},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.events.cell.stateUpdated,function(n){var a;vc.ObjectEvent.isCell(n,(a=r.pivot)===null||a===void 0?void 0:a.cell)&&r.forceUpdate()})},Object.defineProperty(t.prototype,"pivot",{get:function(){return this.props.refs[0]},enumerable:!1,configurable:!0}),t.prototype.render=function(){var r=this.props,n=r.refs,a=r.labelMultiple;if(n.length===0)return null;var i=n[0],o,s;if(n.length===1){var u=i.cell.obj;if(!u)return null;o=u==null?void 0:u.label,s=u==null?void 0:u.description}else o=n.length+" "+(a||"Objects");return Te(Rt,{children:[Te("div",w({className:"msp-flex-row"},{children:[Te("button",w({className:"msp-form-control msp-control-button-label",title:o+". Click to focus.",onClick:this.focus,onMouseEnter:this.highlight,onMouseLeave:this.clearHighlight,style:{textAlign:"left"}},{children:[o," ",L("small",{children:s},void 0)]}),void 0),L(Gt,{svg:i.cell.state.isHidden?Xd:Yd,toggleState:!1,className:"msp-form-control",onClick:this.toggleVisibility,title:i.cell.state.isHidden?"Show":"Hide",small:!0,flex:!0},void 0),n.length===1&&L(Gt,{svg:Ed,className:"msp-form-control",onClick:this.toggleOptions,title:"Options",toggleState:this.state.showOptions,flex:!0},void 0)]}),void 0),n.length===1&&this.state.showOptions&&i.cell.parent&&L(Rt,{children:L("div",w({className:"msp-control-offset"},{children:L(Zu,{state:i.cell.parent,transform:i.cell.transform,customHeader:"none",autoHideApply:!0},void 0)}),void 0)},void 0)]},void 0)},t}(Sa),LSe=function(e){Be(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.defaultState=function(){return{header:"Components",isCollapsed:!1,isDisabled:!1,brand:{accent:"blue",svg:ex}}},t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,function(n){return r.setState({description:Pv.getSelectedStructuresDescription(r.plugin)})})},t.prototype.renderControls=function(){return Te(Rt,{children:[L(NSe,{},void 0),L(zSe,{},void 0),L(BSe,{},void 0)]},void 0)},t}(Ap),NSe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isEmpty:!0,isBusy:!1,canUndo:!1},r.togglePreset=r.toggleAction("preset"),r.toggleAdd=r.toggleAction("add"),r.toggleOptions=r.toggleAction("options"),r.hideAction=function(){return r.setState({action:void 0})},r.applyPreset=function(n){if(r.hideAction(),!!n){var a=r.plugin.managers.structure,i=a.hierarchy.selection.structures;n.value===null?a.component.clear(i):a.component.applyPreset(i,n.value)}},r.undo=function(){var n=r.plugin.state.data.undo();n&&r.plugin.runTask(n)},r}return Object.defineProperty(t.prototype,"isDisabled",{get:function(){return this.state.isBusy||this.state.isEmpty},enumerable:!1,configurable:!0}),t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,function(n){return r.setState({action:r.state.action!=="options"||n.structures.length===0?void 0:"options",isEmpty:n.structures.length===0})}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){r.setState({isBusy:n,action:r.state.action!=="options"?void 0:"options"})}),this.subscribe(this.plugin.state.data.events.historyUpdated,function(n){var a=n.state;r.setState({canUndo:a.canUndo})})},t.prototype.toggleAction=function(r){var n=this;return function(){return n.setState({action:n.state.action===r?void 0:r})}},Object.defineProperty(t.prototype,"presetControls",{get:function(){return L(Jt,{items:this.presetActions,onSelect:this.applyPreset},void 0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"presetActions",{get:function(){var r=this.plugin.managers.structure.component.pivotStructure,n=this.plugin.builders.structure.representation.getPresets(r==null?void 0:r.cell.obj);return Jt.createItems(n,{label:function(a){return a.display.name},category:function(a){return a.display.group},description:function(a){return a.display.description}})},enumerable:!1,configurable:!0}),t.prototype.render=function(){var r=this.state.canUndo?"Undo "+this.plugin.state.data.latestUndoLabel:"Some mistakes of the past can be undone.";return Te(Rt,{children:[Te("div",w({className:"msp-flex-row"},{children:[L(oa,{icon:My,label:"Preset",title:"Apply a representation preset for the current structure(s).",toggle:this.togglePreset,isSelected:this.state.action==="preset",disabled:this.isDisabled},void 0),L(oa,{icon:_p,label:"Add",title:"Add a new representation component for a selection.",toggle:this.toggleAdd,isSelected:this.state.action==="add",disabled:this.isDisabled},void 0),L(oa,{icon:Id,label:"",title:"Options that are applied to all applicable representations.",style:{flex:"0 0 40px",padding:0},toggle:this.toggleOptions,isSelected:this.state.action==="options",disabled:this.isDisabled},void 0),L(Gt,{svg:ox,className:"msp-flex-item",flex:"40px",onClick:this.undo,disabled:!this.state.canUndo||this.isDisabled,title:r},void 0)]}),void 0),this.state.action==="preset"&&this.presetControls,this.state.action==="add"&&L("div",w({className:"msp-control-offset"},{children:L(wL,{onApply:this.hideAction},void 0)}),void 0),this.state.action==="options"&&L("div",w({className:"msp-control-offset"},{children:L(USe,{isDisabled:this.isDisabled},void 0)}),void 0)]},void 0)},t}(Sa),wL=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state=r.createState(),r.apply=function(){var n=r.props.forSelection?r.currentStructures:r.selectedStructures;r.props.onApply(),r.plugin.managers.structure.component.add(r.state.values,n)},r.paramsChanged=function(n){return r.setState({values:n})},r}return t.prototype.createState=function(){var r=Gd.getAddParams(this.plugin);return{params:r,values:E.getDefaultValues(r)}},Object.defineProperty(t.prototype,"selectedStructures",{get:function(){return this.plugin.managers.structure.component.currentStructures},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentStructures",{get:function(){return this.plugin.managers.structure.hierarchy.current.structures},enumerable:!1,configurable:!0}),t.prototype.render=function(){return Te(Rt,{children:[L(Pn,{params:this.state.params,values:this.state.values,onChangeValues:this.paramsChanged},void 0),L(pr,w({icon:_p,title:"Use Selection and optional Representation to create a new Component.",className:"msp-btn-commit msp-btn-commit-on",onClick:this.apply,style:{marginTop:"1px"}},{children:"Create Component"}),void 0)]},void 0)},t}(Sa),USe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.update=function(n){return r.plugin.managers.structure.component.setOptions(n)},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.component.events.optionsUpdated,function(){return r.forceUpdate()})},t.prototype.render=function(){return L(Pn,{params:Gd.OptionsParams,values:this.plugin.managers.structure.component.state.options,onChangeValues:this.update,isDisabled:this.props.isDisabled},void 0)},t}(Sa),zSe=function(e){Be(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,function(){r.forceUpdate()})},t.prototype.render=function(){var r=this.plugin.managers.structure.hierarchy.currentComponentGroups;return r.length===0?null:L("div",w({style:{marginTop:"6px"}},{children:r.map(function(n){return L(VSe,{group:n},n[0].cell.transform.ref)})}),void 0)},t}(Sa),VSe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={action:void 0},r.toggleVisible=function(n){n.preventDefault(),n.currentTarget.blur(),r.plugin.managers.structure.component.toggleVisibility(r.props.group)},r.selectAction=function(n){!n||(r.setState({action:void 0}),(n==null?void 0:n.value)())},r.remove=function(){return r.plugin.managers.structure.hierarchy.remove(r.props.group,!0)},r.toggleAction=function(){return r.setState({action:r.state.action==="action"?void 0:"action"})},r.toggleLabel=function(){return r.setState({action:r.state.action==="label"?void 0:"label"})},r.highlight=function(n){n.preventDefault(),r.props.group[0].cell.parent&&wt.Interactivity.Object.Highlight(r.plugin,{state:r.props.group[0].cell.parent,ref:r.props.group.map(function(a){return a.cell.transform.ref})})},r.clearHighlight=function(n){n.preventDefault(),wt.Interactivity.ClearHighlights(r.plugin)},r.focus=function(){for(var n=!0,a=0,i=r.props.group;a<i.length;a++){var o=i[a];if(!o.cell.state.isHidden){n=!1;break}}n&&r.plugin.managers.structure.hierarchy.toggleVisibility(r.props.group,"show"),r.plugin.managers.camera.focusSpheres(r.props.group,function(s){var u;if(!s.cell.state.isHidden)return(u=s.cell.obj)===null||u===void 0?void 0:u.data.boundary.sphere})},r.updateLabel=function(n){r.plugin.managers.structure.component.updateLabel(r.pivot,n)},r}return Object.defineProperty(t.prototype,"pivot",{get:function(){return this.props.group[0]},enumerable:!1,configurable:!0}),t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.events.cell.stateUpdated,function(n){vc.ObjectEvent.isCell(n,r.pivot.cell)&&r.forceUpdate()})},Object.defineProperty(t.prototype,"colorByActions",{get:function(){var r=this,n,a,i=this.plugin.managers.structure.component,o=this.pivot.representations[0],s=(n=o.cell.transform.params)===null||n===void 0?void 0:n.colorTheme.name,u=uye(this.plugin,(a=this.pivot.cell.obj)===null||a===void 0?void 0:a.data);return Jt.createItemsFromSelectOptions(u,{value:function(l){return function(){return i.updateRepresentationsTheme(r.props.group,{color:l[0]})}},selected:function(l){return l[0]===s}})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"actions",{get:function(){var r=this,n=this.plugin.managers.structure.component,a=[Nt([Jt.Header("Add Representation")],Gd.getRepresentationTypes(this.plugin,this.props.group[0]).map(function(i){return Jt.Item(i[1],function(){return n.addRepresentation(r.props.group,i[0])})}))];return this.pivot.representations.length>0&&a.push(Nt([Jt.Header("Set Coloring",{isIndependent:!0})],this.colorByActions)),n.canBeModified(this.props.group[0])&&a.push([Jt.Header("Modify by Selection"),Jt.Item("Include",function(){return n.modifyByCurrentSelection(r.props.group,"union")},{icon:QS}),Jt.Item("Subtract",function(){return n.modifyByCurrentSelection(r.props.group,"subtract")},{icon:ZS}),Jt.Item("Intersect",function(){return n.modifyByCurrentSelection(r.props.group,"intersect")},{icon:JS})]),a.push(Jt.Item("Select This",function(){return n.selectThis(r.props.group)},{icon:rg})),n.canBeModified(this.props.group[0])&&a.push(Jt.Item("Edit Label",this.toggleLabel)),a},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"reprLabel",{get:function(){var r,n=this.pivot;return n.representations.length===0?"No repr.":n.representations.length===1?(r=n.representations[0].cell.obj)===null||r===void 0?void 0:r.label:n.representations.length+" reprs"},enumerable:!1,configurable:!0}),t.prototype.render=function(){var r=this,n,a=this.pivot,i=a.cell,o=(n=i.obj)===null||n===void 0?void 0:n.label,s=this.reprLabel;return Te(Rt,{children:[Te("div",w({className:"msp-flex-row"},{children:[Te(pr,w({noOverflow:!0,className:"msp-control-button-label",title:o+". Click to focus.",onClick:this.focus,onMouseEnter:this.highlight,onMouseLeave:this.clearHighlight,style:{textAlign:"left"}},{children:[o,L("small",w({className:"msp-25-lower-contrast-text",style:{float:"right"}},{children:s}),void 0)]}),void 0),L(Gt,{svg:i.state.isHidden?Xd:Yd,toggleState:!1,onClick:this.toggleVisible,title:(i.state.isHidden?"Show":"Hide")+" component",small:!0,className:"msp-form-control",flex:!0},void 0),L(Gt,{svg:Oo,toggleState:!1,onClick:this.remove,title:"Remove",small:!0,className:"msp-form-control",flex:!0},void 0),L(Gt,{svg:Ed,onClick:this.toggleAction,title:"Actions",toggleState:this.state.action==="action",className:"msp-form-control",flex:!0},void 0)]}),void 0),this.state.action==="label"&&L("div",w({className:"msp-control-offset",style:{marginBottom:"6px"}},{children:L(Io,{label:"Label",control:Te("div",w({style:{display:"flex",textAlignLast:"center"}},{children:[L(Du,{onChange:this.updateLabel,value:o,style:{flex:"1 1 auto",minWidth:0},className:"msp-form-control",blurOnEnter:!0,blurOnEscape:!0},void 0),L(Gt,{svg:wp,onClick:this.toggleLabel,className:"msp-form-control msp-control-button-label",flex:!0},void 0)]}),void 0)},void 0)}),void 0),this.state.action==="action"&&Te("div",w({className:"msp-accent-offset"},{children:[L("div",w({style:{marginBottom:"6px"}},{children:L(Jt,{items:this.actions,onSelect:this.selectAction,noOffset:!0},void 0)}),void 0),L("div",w({style:{marginBottom:"6px"}},{children:a.representations.map(function(u){return L(HSe,{group:r.props.group,representation:u},u.cell.transform.ref)})}),void 0)]}),void 0)]},void 0)},t}(Sa),HSe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.remove=function(){return r.plugin.managers.structure.component.removeRepresentations(r.props.group,r.props.representation)},r.toggleVisible=function(n){n.preventDefault(),n.currentTarget.blur(),r.plugin.managers.structure.component.toggleVisibility(r.props.group,r.props.representation)},r.update=function(n){return r.plugin.managers.structure.component.updateRepresentations(r.props.group,r.props.representation,n)},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.events.cell.stateUpdated,function(n){vc.ObjectEvent.isCell(n,r.props.representation.cell)&&r.forceUpdate()})},t.prototype.render=function(){var r,n=this.props.representation.cell;return Te("div",w({className:"msp-representation-entry"},{children:[n.parent&&L(ls,w({header:(((r=n.obj)===null||r===void 0?void 0:r.label)||"")+" Representation",noOffset:!0},{children:L(Zu,{state:n.parent,transform:n.transform,customHeader:"none",customUpdate:this.update,noMargin:!0},void 0)}),void 0),L(Gt,{svg:Oo,onClick:this.remove,title:"Remove",small:!0,className:"msp-default-bg",toggleState:!1,style:{position:"absolute",top:0,right:"32px",lineHeight:"24px",height:"24px",textAlign:"right",width:"44px",paddingRight:"6px",background:"none"}},void 0),L(Gt,{svg:this.props.representation.cell.state.isHidden?Xd:Yd,toggleState:!1,onClick:this.toggleVisible,title:"Toggle Visibility",small:!0,className:"msp-default-bg",style:{position:"absolute",top:0,right:0,lineHeight:"24px",height:"24px",textAlign:"right",width:"32px",paddingRight:"6px",background:"none"}},void 0)]}),void 0)},t}(Sa),q2="measurement-group",AL={distanceUnitLabel:E.Text("\u212B",{isEssential:!0}),textColor:_k.textColor},GSe=E.getDefaultValues(AL),qSe=function(e){Be(t,e);function t(r){var n=e.call(this,{labels:[],distances:[],angles:[],dihedrals:[],orientations:[],options:GSe})||this;return n.plugin=r,n.behaviors={state:n.ev.behavior(n.state)},n._empty=[],r.state.data.events.changed.subscribe(function(a){a.inTransaction||r.behaviors.state.isAnimating.value||n.sync()}),r.behaviors.state.isAnimating.subscribe(function(a){!a&&!r.behaviors.state.isUpdating.value&&n.sync()}),n}return t.prototype.stateUpdated=function(){this.behaviors.state.next(this.state)},t.prototype.getGroup=function(){var r=this.plugin.state.data,n=ar.findTagInSubtree(r.tree,cr.RootRef,q2),a=this.plugin.state.data.build();return n?a.to(n):a.toRoot().group(rt.Misc.CreateGroup,{label:"Measurements"},{tags:q2})},t.prototype.setOptions=function(r){return ce(this,void 0,void 0,function(){var n,a,i,f,o,s,f,u,l,f,c,d,f;return de(this,function(p){switch(p.label){case 0:for(this.updateState({options:r})&&this.stateUpdated(),n=this.plugin.state.data.build(),a=0,i=this.state.distances;a<i.length;a++)f=i[a],n.to(f).update(function(h){h.unitLabel=r.distanceUnitLabel,h.textColor=r.textColor});for(o=0,s=this.state.labels;o<s.length;o++)f=s[o],n.to(f).update(function(h){h.textColor=r.textColor});for(u=0,l=this.state.angles;u<l.length;u++)f=l[u],n.to(f).update(function(h){h.textColor=r.textColor});for(c=0,d=this.state.dihedrals;c<d.length;c++)f=d[c],n.to(f).update(function(h){h.textColor=r.textColor});return n.editInfo.count===0?[2]:[4,wt.State.Update(this.plugin,{state:this.plugin.state.data,tree:n,options:{doNotLogTiming:!0}})];case 1:return p.sent(),[2]}})})},t.prototype.addDistance=function(r,n,a){return ce(this,void 0,void 0,function(){var i,o,s,u,l;return de(this,function(c){switch(c.label){case 0:return i=this.plugin.helpers.substructureParent.get(r.structure),o=this.plugin.helpers.substructureParent.get(n.structure),!i||!o?[2]:(s=[i.transform.ref],Xa(s,o.transform.ref),u=this.getGroup(),u.apply(rt.Model.MultiStructureSelectionFromExpression,{selections:[{key:"a",groupId:"a",ref:i.transform.ref,expression:Re.toExpression(r)},{key:"b",groupId:"b",ref:o.transform.ref,expression:Re.toExpression(n)}],isTransitive:!0,label:"Distance"},{dependsOn:s,tags:a==null?void 0:a.selectionTags}).apply(rt.Representation.StructureSelectionsDistance3D,w(w(w({customText:(a==null?void 0:a.customText)||"",unitLabel:this.state.options.distanceUnitLabel,textColor:this.state.options.textColor},a==null?void 0:a.lineParams),a==null?void 0:a.labelParams),a==null?void 0:a.visualParams),{tags:a==null?void 0:a.reprTags}),l=this.plugin.state.data,[4,wt.State.Update(this.plugin,{state:l,tree:u,options:{doNotLogTiming:!0}})]);case 1:return c.sent(),[2]}})})},t.prototype.addAngle=function(r,n,a,i){return ce(this,void 0,void 0,function(){var o,s,u,l,c,d;return de(this,function(f){switch(f.label){case 0:return o=this.plugin.helpers.substructureParent.get(r.structure),s=this.plugin.helpers.substructureParent.get(n.structure),u=this.plugin.helpers.substructureParent.get(a.structure),!o||!s||!u?[2]:(l=[o.transform.ref],Xa(l,s.transform.ref),Xa(l,u.transform.ref),c=this.getGroup(),c.apply(rt.Model.MultiStructureSelectionFromExpression,{selections:[{key:"a",ref:o.transform.ref,expression:Re.toExpression(r)},{key:"b",ref:s.transform.ref,expression:Re.toExpression(n)},{key:"c",ref:u.transform.ref,expression:Re.toExpression(a)}],isTransitive:!0,label:"Angle"},{dependsOn:l,tags:i==null?void 0:i.selectionTags}).apply(rt.Representation.StructureSelectionsAngle3D,w(w(w({customText:(i==null?void 0:i.customText)||"",textColor:this.state.options.textColor},i==null?void 0:i.lineParams),i==null?void 0:i.labelParams),i==null?void 0:i.visualParams),{tags:i==null?void 0:i.reprTags}),d=this.plugin.state.data,[4,wt.State.Update(this.plugin,{state:d,tree:c,options:{doNotLogTiming:!0}})]);case 1:return f.sent(),[2]}})})},t.prototype.addDihedral=function(r,n,a,i,o){return ce(this,void 0,void 0,function(){var s,u,l,c,d,f,p;return de(this,function(h){switch(h.label){case 0:return s=this.plugin.helpers.substructureParent.get(r.structure),u=this.plugin.helpers.substructureParent.get(n.structure),l=this.plugin.helpers.substructureParent.get(a.structure),c=this.plugin.helpers.substructureParent.get(i.structure),!s||!u||!l||!c?[2]:(d=[s.transform.ref],Xa(d,u.transform.ref),Xa(d,l.transform.ref),Xa(d,c.transform.ref),f=this.getGroup(),f.apply(rt.Model.MultiStructureSelectionFromExpression,{selections:[{key:"a",ref:s.transform.ref,expression:Re.toExpression(r)},{key:"b",ref:u.transform.ref,expression:Re.toExpression(n)},{key:"c",ref:l.transform.ref,expression:Re.toExpression(a)},{key:"d",ref:c.transform.ref,expression:Re.toExpression(i)}],isTransitive:!0,label:"Dihedral"},{dependsOn:d,tags:o==null?void 0:o.selectionTags}).apply(rt.Representation.StructureSelectionsDihedral3D,w(w(w({customText:(o==null?void 0:o.customText)||"",textColor:this.state.options.textColor},o==null?void 0:o.lineParams),o==null?void 0:o.labelParams),o==null?void 0:o.visualParams),{tags:o==null?void 0:o.reprTags}),p=this.plugin.state.data,[4,wt.State.Update(this.plugin,{state:p,tree:f,options:{doNotLogTiming:!0}})]);case 1:return h.sent(),[2]}})})},t.prototype.addLabel=function(r,n){return ce(this,void 0,void 0,function(){var a,i,o,s;return de(this,function(u){switch(u.label){case 0:return a=this.plugin.helpers.substructureParent.get(r.structure),a?(i=[a.transform.ref],o=this.getGroup(),o.apply(rt.Model.MultiStructureSelectionFromExpression,{selections:[{key:"a",ref:a.transform.ref,expression:Re.toExpression(r)}],isTransitive:!0,label:"Label"},{dependsOn:i,tags:n==null?void 0:n.selectionTags}).apply(rt.Representation.StructureSelectionsLabel3D,w(w({textColor:this.state.options.textColor},n==null?void 0:n.labelParams),n==null?void 0:n.visualParams),{tags:n==null?void 0:n.reprTags}),s=this.plugin.state.data,[4,wt.State.Update(this.plugin,{state:s,tree:o,options:{doNotLogTiming:!0}})]):[2];case 1:return u.sent(),[2]}})})},t.prototype.addOrientation=function(r){return ce(this,void 0,void 0,function(){var n,a,i,o;return de(this,function(s){switch(s.label){case 0:return n=this.plugin.helpers.substructureParent.get(r.structure),n?(a=[n.transform.ref],i=this.getGroup(),i.apply(rt.Model.MultiStructureSelectionFromExpression,{selections:[{key:"a",ref:n.transform.ref,expression:Re.toExpression(r)}],isTransitive:!0,label:"Orientation"},{dependsOn:a}).apply(rt.Representation.StructureSelectionsOrientation3D),o=this.plugin.state.data,[4,wt.State.Update(this.plugin,{state:o,tree:i,options:{doNotLogTiming:!0}})]):[2];case 1:return s.sent(),[2]}})})},t.prototype.getTransforms=function(r){var n=this.plugin.state.data,a=ar.findTagInSubtree(n.tree,cr.RootRef,q2),i=a?n.select(ar.Generators.ofTransformer(r,a)):this._empty;return i.length===0?this._empty:i},t.prototype.sync=function(){var r=this.updateState({labels:this.getTransforms(rt.Representation.StructureSelectionsLabel3D),distances:this.getTransforms(rt.Representation.StructureSelectionsDistance3D),angles:this.getTransforms(rt.Representation.StructureSelectionsAngle3D),dihedrals:this.getTransforms(rt.Representation.StructureSelectionsDihedral3D),orientations:this.getTransforms(rt.Representation.StructureSelectionsOrientation3D)});r&&this.stateUpdated()},t}(gl),Zg=function(e){Be(t,e);function t(r,n){n===void 0&&(n={});var a=e.call(this,{props:w(w({},E.getDefaultValues(t.Params)),n)})||this;return a.plugin=r,a._props=E.getDefaultValues(t.Params),a.events={propsUpdated:a.ev()},a.lociSelects=new t.LociSelectManager(r,a._props),a.lociHighlights=new t.LociHighlightManager(r,a._props),a}return Object.defineProperty(t.prototype,"props",{get:function(){return w({},this.state.props)},enumerable:!1,configurable:!0}),t.prototype.setProps=function(r){var n=this.props,a=w(w({},this.state.props),r);R_(n,a)||(this.updateState({props:a}),this.lociSelects.setProps(a),this.lociHighlights.setProps(a),this.events.propsUpdated.next())},t}(gl);(function(e){e.Params={granularity:E.Select("residue",ir.GranularityOptions,{label:"Picking Level",description:"Controls if selections are expanded upon picking to whole residues, chains, structures, instances, or left as atoms and coarse elements"})};var t=function(){function a(i,o){o===void 0&&(o={}),this.ctx=i,this.providers=[],this.props=E.getDefaultValues(e.Params),this.sel=i.managers.structure.selection,this.setProps(o)}return a.prototype.setProps=function(i){Object.assign(this.props,i)},a.prototype.addProvider=function(i){this.providers.push(i)},a.prototype.removeProvider=function(i){this.providers=this.providers.filter(function(o){return o!==i})},a.prototype.normalizedLoci=function(i,o){o===void 0&&(o=!0);var s=i.loci,u=i.repr,l=o?this.props.granularity:void 0;return{loci:ir.normalize(s,l),repr:u}},a.prototype.mark=function(i,o){if(!ir.isEmpty(i.loci))for(var s=0,u=this.providers;s<u.length;s++){var l=u[s];l(i,o)}},a}();e.LociMarkManager=t;var r=function(a){Be(i,a);function i(){var o=a!==null&&a.apply(this,arguments)||this;return o.prev=[],o.clearHighlights=function(){for(var s=0,u=o.prev;s<u.length;s++){var l=u[s];o.mark(l,tr.RemoveHighlight)}o.prev.length=0},o}return i.prototype.isHighlighted=function(o){for(var s=0,u=this.prev;s<u.length;s++){var l=u[s];if(or.Loci.areEqual(l,o))return!0}return!1},i.prototype.addHighlight=function(o){this.mark(o,tr.Highlight),this.prev.push(o)},i.prototype.highlight=function(o,s){s===void 0&&(s=!0);var u=this.normalizedLoci(o,s);this.isHighlighted(u)||this.addHighlight(u)},i.prototype.highlightOnly=function(o,s){s===void 0&&(s=!0);var u=this.normalizedLoci(o,s);this.isHighlighted(u)||(this.clearHighlights(),this.addHighlight(u))},i.prototype.highlightOnlyExtend=function(o,s){s===void 0&&(s=!0);var u=this.normalizedLoci(o,s);if(Re.is(u.loci)){var l={loci:this.sel.tryGetRange(u.loci)||u.loci,repr:u.repr};this.isHighlighted(l)||(this.clearHighlights(),this.addHighlight(l))}},i}(t);e.LociHighlightManager=r;var n=function(a){Be(i,a);function i(){return a!==null&&a.apply(this,arguments)||this}return i.prototype.toggle=function(o,s){if(s===void 0&&(s=!0),!ir.isEmpty(o.loci)){var u=this.normalizedLoci(o,s);Re.is(u.loci)?this.toggleSel(u):a.prototype.mark.call(this,u,tr.Toggle)}},i.prototype.toggleExtend=function(o,s){if(s===void 0&&(s=!0),!ir.isEmpty(o.loci)){var u=this.normalizedLoci(o,s);if(Re.is(u.loci)){var l=this.sel.tryGetRange(u.loci)||u.loci;this.toggleSel({loci:l,repr:u.repr})}}},i.prototype.select=function(o,s){s===void 0&&(s=!0);var u=this.normalizedLoci(o,s);Re.is(u.loci)&&this.sel.modify("add",u.loci),this.mark(u,tr.Select)},i.prototype.selectJoin=function(o,s){s===void 0&&(s=!0);var u=this.normalizedLoci(o,s);Re.is(u.loci)&&this.sel.modify("intersect",u.loci),this.mark(u,tr.Select)},i.prototype.selectOnly=function(o,s){s===void 0&&(s=!0);var u=this.normalizedLoci(o,s);Re.is(u.loci)&&(this.deselect({loci:Xe.toStructureElementLoci(u.loci.structure),repr:u.repr},!1),this.sel.modify("set",u.loci)),this.mark(u,tr.Select)},i.prototype.deselect=function(o,s){s===void 0&&(s=!0);var u=this.normalizedLoci(o,s);Re.is(u.loci)&&this.sel.modify("remove",u.loci),this.mark(u,tr.Deselect)},i.prototype.deselectAll=function(){this.sel.clear(),this.mark({loci:lpe},tr.Deselect)},i.prototype.deselectAllOnEmpty=function(o){ns(o.loci)&&this.deselectAll()},i.prototype.mark=function(o,s){var u=o.loci;ir.isEmpty(u)||(Re.is(u)?(a.prototype.mark.call(this,{loci:Xe.Loci(u.structure)},tr.Deselect),a.prototype.mark.call(this,{loci:this.sel.getLoci(u.structure)},tr.Select)):a.prototype.mark.call(this,o,s))},i.prototype.toggleSel=function(o){this.sel.has(o.loci)?(this.sel.modify("remove",o.loci),this.mark(o,tr.Deselect)):(this.sel.modify("add",o.loci),this.mark(o,tr.Select))},i}(t);e.LociSelectManager=n})(Zg||(Zg={}));function jSe(e,t){for(var r,n=[],a=t==="auth"?"auth_asym_id":"label_asym_id",i=t==="auth"?"auth_seq_id":"label_seq_id",o=0,s=e;o<s.length;o++){var u=s[o];if(u.kind==="range")n.push(se.struct.generator.atomGroups({"chain-test":se.core.rel.eq([se.ammp(a),u.asym_id]),"residue-test":se.core.rel.inRange([se.ammp(i),u.seq_id_beg,u.seq_id_end])}));else{var l=((r=u.ins_code)!==null&&r!==void 0?r:"").trim();n.push(se.struct.generator.atomGroups({"chain-test":se.core.rel.eq([se.ammp(a),u.asym_id]),"residue-test":se.core.logic.and([se.core.rel.eq([se.ammp(i),u.seq_id]),se.core.rel.eq([se.ammp("pdbx_PDB_ins_code"),l])])}))}}var c=se.struct.combinator.merge(n);return Ld(c)}function WSe(e){for(var t=$r.create(),r=0,n=e;r<n.length;r++)for(var a=n[r],i=a[0],o=a[1],s=i;s<=o;s++)$r.add(t,s,s);var u=se.struct.generator.atomGroups({"atom-test":se.core.set.has([se.set.apply(se,t.array),se.ammp("id")])});return Ld(u)}function XSe(e,t,r){if(!(!e||t.length===0||Number.isNaN(+t[0])))return Number.isNaN(r)?{kind:"single",asym_id:e,seq_id:+t[0],ins_code:t[1]}:{kind:"range",asym_id:e,seq_id_beg:+t[0],seq_id_end:r}}function YSe(e){return e?e.split(":"):[]}function KSe(e){return e.split(",").map(function(t){return t.trim().split(/\s+|[-]/g).filter(function(r){return!!r})}).map(function(t){return XSe(t[0],YSe(t[1]),+t[2])}).filter(function(t){return!!t})}function $Se(e){return e.split(",").map(function(t){return t.trim().split(/\s+|[-]/g).filter(function(r){return!!r})}).filter(function(t){return t.length===1||t.length===2}).map(function(t){return t.length===1?[+t[0],+t[0]]:[+t[0],+t[1]]})}function QSe(e,t){if(t==="atom-id"){var r=$Se(e);return WSe(r)}else{var r=KSe(e);return jSe(r,t)}}function ZSe(e){return Object.keys(e).map(function(t){return[t,e[t]]})}var qC=function(e){Be(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getBindingComponents=function(){var r=ZSe(this.props.bindings);return L(Rt,{children:r.map(function(n){var a=n[0],i=n[1];return fr.isEmpty(i)?null:Te("div",w({style:{marginBottom:"6px"}},{children:[L("b",{children:i.action},void 0),L("br",{},void 0),L("span",{dangerouslySetInnerHTML:{__html:fr.format(i,a)}},void 0)]}),a)})},void 0)},t.prototype.render=function(){return L(Os,{children:this.getBindingComponents()},void 0)},t}(kt.exports.PureComponent),Os=function(e){Be(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.render=function(){return L("div",w({className:"msp-help-text"},{children:L("div",{children:this.props.children},void 0)}),void 0)},t}(kt.exports.PureComponent),ks=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={header:r.props.header,isExpanded:!!r.props.initiallyExpanded},r.toggleExpanded=function(){return r.setState({isExpanded:!r.state.isExpanded})},r}return t.prototype.render=function(){return Te("div",w({className:"msp-control-group-wrapper"},{children:[L("div",w({className:"msp-control-group-header"},{children:Te(pr,w({onClick:this.toggleExpanded},{children:[L(tn,{svg:this.state.isExpanded?Lu:Nu},void 0),this.props.header]}),void 0)}),void 0),this.state.isExpanded&&L("div",w({className:"msp-control-offset",style:{display:this.state.isExpanded?"block":"none"}},{children:this.props.children}),void 0)]}),void 0)},t}(kt.exports.PureComponent);function j2(e){return L("div",w({className:"msp-simple-help-section"},{children:e.header}),void 0)}var nw=function(e){Be(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.events.canvas3d.settingsUpdated,function(){return r.forceUpdate()})},t.prototype.render=function(){var r={};return this.plugin.spec.behaviors.forEach(function(n){var a=n.defaultParams.bindings;a&&Object.assign(r,a)}),Te(Rt,{children:[!this.props.selectOnly&&this.plugin.canvas3d&&L(ks,w({header:"Moving in 3D"},{children:L(qC,{bindings:this.plugin.canvas3d.props.trackball.bindings},void 0)}),"trackball"),L(ks,w({header:"Mouse Controls"},{children:L(qC,{bindings:r},void 0)}),"interactions")]},void 0)},t}(hr),JSe=function(e){Be(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.events.canvas3d.settingsUpdated,function(){return r.forceUpdate()})},t.prototype.formatTriggers=function(r){return r.triggers.map(function(n){return fr.Trigger.format(n)}).join(" or ")},t.prototype.getTriggerFor=function(r,n){var a=this.plugin.state.behaviors,i=a.select(ar.Generators.ofTransformer(r)),o=i.length===1?i[0].params:void 0,s=o?o.values.bindings:{},u=n in s?s[n]:fr.Empty;return this.formatTriggers(u)},t.prototype.render=function(){var r=this.getTriggerFor(QB,"clickSelectToggle"),n=this.getTriggerFor(C1,"clickFocus");return Te("div",{children:[L(j2,{header:"Interface Controls"},void 0),Te(ks,w({header:"Inline Help"},{children:[L(Os,{children:"Many user interface elements show a little questionmark icon when hovered over. Clicking the icon toggles the display of an inline help text."},void 0),L(Os,{children:"Tooltips may provide additional information on a user interface element and are shown when hovering over it with the mouse."},void 0)]}),void 0),L(ks,w({header:"Selections"},{children:Te(Os,{children:["The viewer allows changing colors and representations for selections of atoms, residues or chains. Selections can be created by",Te("ul",w({style:{paddingLeft:"20px"}},{children:[Te("li",{children:["picking elements on the 3D canvas or the sequence view using the mouse, e.g. toggle selection using ",r," (for more see help section on ",L("i",{children:"Mouse Controls"},void 0),")"]},void 0),Te("li",{children:["using the ",L("i",{children:"Add"},void 0),", ",L("i",{children:"Remove"},void 0)," and ",L("i",{children:"Only"},void 0)," dropdown buttons in the ",L("i",{children:"Manage Selection"},void 0)," panel which allow modifing the current selection by predefined sets"]},void 0)]}),void 0)]},void 0)}),void 0),L(ks,w({header:"Coloring"},{children:Te(Os,{children:["There are two ways to color structures. Every representation (e.g. cartoon or spacefill) has a color theme which can be changed using the dropdown for each representation in the ",L("i",{children:"Structure Settings"},void 0)," panel. Additionally any selection atoms, residues or chains can by given a custom color. For that, first select the parts of the structure to be colored (see help section on ",L("i",{children:"Selections"},void 0),") and, second, choose a color from the color dropdown botton in the ",L("i",{children:"Selection"},void 0)," row of the ",L("i",{children:"Change Representation"},void 0)," panel. The theme color can be seen as a base color that is overpainted by the custom color. Custom colors can be removed for a selection with the 'Clear' option in the color dropdown."]},void 0)}),void 0),L(ks,w({header:"Representations"},{children:Te(Os,{children:["Structures can be shown with many different representations (e.g. cartoon or spacefill). The ",L("i",{children:"Change Representation"},void 0)," panel offers a collection of predefined styles which can be applied using the ",L("i",{children:"Preset"},void 0)," dropdown button. Additionally any selection atoms, residues or chains can by shown with a custom representation. For that, first select the parts of the structure to be mofified (see help section on ",L("i",{children:"Selections"},void 0),") and, second, choose a representation to hide or show from the ",L("i",{children:"Show"},void 0)," and ",L("i",{children:"Hide"},void 0)," dropdown bottons in the ",L("i",{children:"Selection"},void 0)," row of the ",L("i",{children:"Change Representation"},void 0)," panel. The ",L("i",{children:"Everything"},void 0)," row applies the action to the whole structure instead of the current selection."]},void 0)}),void 0),L(ks,w({header:"Surroundings"},{children:Te(Os,{children:["To show the surroundings of a residue or ligand, click it in the 3D scene or in the sequence widget using ",n,"."]},void 0)}),void 0),L(j2,{header:"How-to Guides"},void 0),L(ks,w({header:"Create an Image"},{children:Te(Os,{children:[Te("p",{children:["Use the ",L(tn,{svg:Ej},void 0)," icon in the viewport to bring up the screenshot controls."]},void 0),Te("p",{children:["To adjust the size of the image, use the ",L("i",{children:"Resolution"},void 0)," dropdown."]},void 0)]},void 0)}),void 0),L(j2,{header:"Mouse Controls"},void 0),L(nw,{},void 0)]},void 0)},t}(hr),Jg=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r._toggleSelMode=function(){r.plugin.selectionMode=!r.plugin.selectionMode},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.events.canvas3d.settingsUpdated,function(){return r.forceUpdate()}),this.subscribe(this.plugin.layout.events.updated,function(){return r.forceUpdate()}),this.subscribe(this.plugin.behaviors.interaction.selectionMode,function(){return r.forceUpdate()})},t.prototype.render=function(){var r=this.props.inline?{background:"transparent",width:"auto",height:"auto",lineHeight:"unset"}:{background:"transparent"};return L(Gt,{svg:IW,onClick:this._toggleSelMode,title:"Toggle Selection Mode",style:r,toggleState:this.plugin.selectionMode},void 0)},t}(Sa),exe={granularity:Zg.Params.granularity},Rf=new Map([["add","Add/Union Selection"],["remove","Remove/Subtract Selection"],["intersect","Intersect Selection"],["set","Set Selection"]]),txe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={action:void 0,helper:void 0,isEmpty:!0,isBusy:!1,canUndo:!1},r.set=function(n,a){r.plugin.managers.structure.selection.fromSelectionQuery(n,a,!1)},r.selectQuery=function(n,a){if(!n||!r.state.action){r.setState({action:void 0});return}var i=r.state.action;a!=null&&a.shiftKey?r.set(i,n.value):r.setState({action:void 0},function(){r.set(i,n.value)})},r.selectHelper=function(n,a){if(console.log(n),!n||!r.state.action){r.setState({action:void 0,helper:void 0});return}r.setState({helper:n.value.kind})},r.queriesItems=[],r.queriesVersion=-1,r.helpersItems=void 0,r.toggleAdd=r.showAction("add"),r.toggleRemove=r.showAction("remove"),r.toggleIntersect=r.showAction("intersect"),r.toggleSet=r.showAction("set"),r.toggleTheme=r.showAction("theme"),r.toggleAddComponent=r.showAction("add-component"),r.toggleHelp=r.showAction("help"),r.setGranuality=function(n){var a=n.value;r.plugin.managers.interactivity.setProps({granularity:a})},r.turnOff=function(){return r.plugin.selectionMode=!1},r.undo=function(){var n=r.plugin.state.data.undo();n&&r.plugin.runTask(n)},r.subtract=function(){for(var n=r.plugin.managers.structure.hierarchy.getStructuresWithSelection(),a=[],i=0,o=n;i<o.length;i++){var s=o[i];a.push.apply(a,s.components)}a.length!==0&&r.plugin.managers.structure.component.modifyByCurrentSelection(a,"subtract")},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,function(n){var a=n.hierarchy.structures.length===0;r.state.isEmpty!==a&&r.setState({isEmpty:a}),r.queriesVersion=-1,r.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){r.setState({isBusy:n,action:void 0})}),this.subscribe(this.plugin.managers.interactivity.events.propsUpdated,function(){r.forceUpdate()}),this.subscribe(this.plugin.state.data.events.historyUpdated,function(n){var a=n.state;r.setState({canUndo:a.canUndo})})},Object.defineProperty(t.prototype,"isDisabled",{get:function(){return this.state.isBusy||this.state.isEmpty},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"structures",{get:function(){for(var r,n=[],a=0,i=this.plugin.managers.structure.hierarchy.selection.structures;a<i.length;a++){var o=i[a],s=(r=o.cell.obj)===null||r===void 0?void 0:r.data;s&&n.push(s)}return n},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"queries",{get:function(){var r=this.plugin.query.structure.registry;if(r.version!==this.queriesVersion){var n=this.structures,a=Nt(Nt(Nt(Nt([],r.list),ime(n)),ame(n)),nme(n)).sort(function(i,o){return o.priority-i.priority});this.queriesItems=Jt.createItems(a,{filter:function(i){return i!==Xn.current&&!i.isHidden},label:function(i){return i.label},category:function(i){return i.category},description:function(i){return i.description}}),this.queriesVersion=r.version}return this.queriesItems},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"helpers",{get:function(){if(this.helpersItems)return this.helpersItems;var r=[{kind:"residue-list",category:"Helpers",label:"Atom/Residue Identifier List",description:"Create a selection from a list of atom/residue ranges."}];return this.helpersItems=Jt.createItems(r,{label:function(n){return n.label},category:function(n){return n.category},description:function(n){return n.description}}),this.helpersItems},enumerable:!1,configurable:!0}),t.prototype.showAction=function(r){var n=this;return function(){return n.setState({action:n.state.action===r?void 0:r,helper:void 0})}},t.prototype.render=function(){var r=this,n=this.plugin.managers.interactivity.props.granularity,a=this.state.canUndo?"Undo "+this.plugin.state.data.latestUndoLabel:"Some mistakes of the past can be undone.",i=void 0;if(this.state.action&&!this.state.helper)i=Te(Rt,{children:[this.state.action&&this.state.action!=="theme"&&this.state.action!=="add-component"&&this.state.action!=="help"&&Te("div",w({className:"msp-selection-viewport-controls-actions"},{children:[L(Jt,{header:Rf.get(this.state.action),title:"Click to close.",items:this.queries,onSelect:this.selectQuery,noOffset:!0},void 0),L(Jt,{items:this.helpers,onSelect:this.selectHelper,noOffset:!0},void 0)]}),void 0),this.state.action==="theme"&&L("div",w({className:"msp-selection-viewport-controls-actions"},{children:L(Pu,w({header:"Theme",title:"Click to close.",initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.toggleTheme,topRightIcon:Au},{children:L(nxe,{onApply:this.toggleTheme},void 0)}),void 0)}),void 0),this.state.action==="add-component"&&L("div",w({className:"msp-selection-viewport-controls-actions"},{children:L(Pu,w({header:"Add Component",title:"Click to close.",initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.toggleAddComponent,topRightIcon:Au},{children:L(wL,{onApply:this.toggleAddComponent,forSelection:!0},void 0)}),void 0)}),void 0),this.state.action==="help"&&L("div",w({className:"msp-selection-viewport-controls-actions"},{children:Te(Pu,w({header:"Help",title:"Click to close.",initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.toggleHelp,topRightIcon:Au,maxHeight:"300px"},{children:[L(ks,w({header:"Selection Operations"},{children:Te(Os,{children:["Use ",L(tn,{svg:QS,inline:!0},void 0)," ",L(tn,{svg:ZS,inline:!0},void 0)," ",L(tn,{svg:JS,inline:!0},void 0)," ",L(tn,{svg:rg,inline:!0},void 0)," to modify the selection."]},void 0)}),void 0),L(ks,w({header:"Representation Operations"},{children:Te(Os,{children:["Use ",L(tn,{svg:tx,inline:!0},void 0)," ",L(tn,{svg:ex,inline:!0},void 0)," ",L(tn,{svg:ix,inline:!0},void 0)," ",L(tn,{svg:ox,inline:!0},void 0)," to color, create components, remove from components, or undo actions."]},void 0)}),void 0),L(nw,{selectOnly:!0},void 0)]}),void 0)}),void 0)]},void 0);else if(Rf.has(this.state.action)&&this.state.helper==="residue-list"){var o=function(){return r.setState({action:void 0,helper:void 0})};i=L("div",w({className:"msp-selection-viewport-controls-actions"},{children:L(Pu,w({header:"Atom/Residue Identifier List",title:"Click to close.",initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:o,topRightIcon:Au},{children:L(ixe,{modifier:this.state.action,plugin:this.plugin,close:o},void 0)}),void 0)}),void 0)}return Te(Rt,{children:[Te("div",w({className:"msp-flex-row",style:{background:"none"}},{children:[L(Hf,{title:"Picking Level for selecting and highlighting",param:exe.granularity,name:"granularity",value:n,onChange:this.setGranuality,isDisabled:this.isDisabled},void 0),L(oa,{icon:QS,title:Rf.get("add")+". Hold shift key to keep menu open.",toggle:this.toggleAdd,isSelected:this.state.action==="add",disabled:this.isDisabled},void 0),L(oa,{icon:ZS,title:Rf.get("remove")+". Hold shift key to keep menu open.",toggle:this.toggleRemove,isSelected:this.state.action==="remove",disabled:this.isDisabled},void 0),L(oa,{icon:JS,title:Rf.get("intersect")+". Hold shift key to keep menu open.",toggle:this.toggleIntersect,isSelected:this.state.action==="intersect",disabled:this.isDisabled},void 0),L(oa,{icon:rg,title:Rf.get("set")+". Hold shift key to keep menu open.",toggle:this.toggleSet,isSelected:this.state.action==="set",disabled:this.isDisabled},void 0),L(oa,{icon:tx,title:"Apply Theme to Selection",toggle:this.toggleTheme,isSelected:this.state.action==="theme",disabled:this.isDisabled,style:{marginLeft:"10px"}},void 0),L(oa,{icon:ex,title:"Create Component of Selection with Representation",toggle:this.toggleAddComponent,isSelected:this.state.action==="add-component",disabled:this.isDisabled},void 0),L(Gt,{svg:ix,title:"Remove/subtract Selection from all Components",onClick:this.subtract,disabled:this.isDisabled},void 0),L(Gt,{svg:ox,onClick:this.undo,disabled:!this.state.canUndo||this.isDisabled,title:a},void 0),L(oa,{icon:Hs,title:"Show/hide help",toggle:this.toggleHelp,style:{marginLeft:"10px"},isSelected:this.state.action==="help"},void 0),L(Gt,{svg:D_,title:"Turn selection mode off",onClick:this.turnOff},void 0)]}),void 0),i]},void 0)},t}(hr),rxe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isEmpty:!0,isBusy:!1},r.clear=function(){return r.plugin.managers.interactivity.lociSelects.deselectAll()},r.focus=function(){if(r.plugin.managers.structure.selection.stats.elementCount!==0){var n=r.plugin.managers.structure.selection.getBoundary().sphere;r.plugin.managers.camera.focusSphere(n)}},r.highlight=function(n){r.plugin.managers.interactivity.lociHighlights.clearHighlights(),r.plugin.managers.structure.selection.entries.forEach(function(a){r.plugin.managers.interactivity.lociHighlights.highlight({loci:a.selection},!1)})},r.clearHighlight=function(){r.plugin.managers.interactivity.lociHighlights.clearHighlights()},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.selection.events.changed,function(){r.forceUpdate()}),this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,function(n){var a=n.structures.length===0;r.state.isEmpty!==a&&r.setState({isEmpty:a})}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){r.setState({isBusy:n})})},Object.defineProperty(t.prototype,"isDisabled",{get:function(){return this.state.isBusy||this.state.isEmpty},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stats",{get:function(){var r=this.plugin.managers.structure.selection.stats;return r.structureCount===0||r.elementCount===0?"Nothing Selected":Zl(r.label)+" Selected"},enumerable:!1,configurable:!0}),t.prototype.render=function(){var r=this.plugin.managers.structure.selection.stats,n=r.structureCount===0||r.elementCount===0;return n&&this.props.hideOnEmpty?null:L(Rt,{children:Te("div",w({className:"msp-flex-row"},{children:[L(pr,w({noOverflow:!0,onClick:this.focus,title:"Click to Focus Selection",disabled:n,onMouseEnter:this.highlight,onMouseLeave:this.clearHighlight,style:{textAlignLast:n?void 0:"left"}},{children:this.stats}),void 0),!n&&L(Gt,{svg:D_,onClick:this.clear,title:"Clear",className:"msp-form-control",flex:!0},void 0)]}),void 0)},void 0)},t}(hr),nxe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r._params=bc(function(n){return Gd.getThemeParams(r.plugin,n)}),r.state={values:E.getDefaultValues(r.params)},r.apply=function(){var n,a;r.plugin.managers.structure.component.applyTheme(r.state.values,r.plugin.managers.structure.hierarchy.current.structures),(a=(n=r.props).onApply)===null||a===void 0||a.call(n)},r.paramsChanged=function(n){return r.setState({values:n})},r}return Object.defineProperty(t.prototype,"params",{get:function(){return this._params(this.plugin.managers.structure.component.pivotStructure)},enumerable:!1,configurable:!0}),t.prototype.render=function(){return Te(Rt,{children:[L(Pn,{params:this.params,values:this.state.values,onChangeValues:this.paramsChanged},void 0),L(pr,w({icon:tx,className:"msp-btn-commit msp-btn-commit-on",onClick:this.apply,style:{marginTop:"1px"}},{children:"Apply Theme"}),void 0)]},void 0)},t}(Sa),PL={idType:E.Select("auth",E.arrayToOptions(["auth","label","atom-id"])),identifiers:E.Text("",{description:"A comma separated list of atom identifiers (e.g. 10, 15-25) or residue ranges in given chain (e.g. A 10-15, B 25, C 30:i)"})},axe=E.getDefaultValues(PL);function ixe(e){var t=e.modifier,r=e.plugin,n=e.close,a=kt.exports.useState(axe),i=a[0],o=a[1],s=function(){if(i.identifiers.trim().length!==0)try{n();var u=QSe(i.identifiers,i.idType);r.managers.structure.selection.fromCompiledQuery(t,u,!1)}catch(l){r.log.error("Failed to create selection: "+l)}};return Te(Rt,{children:[L(Pn,{params:PL,values:i,onChangeValues:o,onEnter:s},void 0),Te(pr,w({className:"msp-btn-commit msp-btn-commit-on",disabled:i.identifiers.trim().length===0,onClick:s,style:{marginTop:"1px"}},{children:[Cp(t)," Selection"]}),void 0)]},void 0)}var oxe=function(e){Be(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.defaultState=function(){return{isCollapsed:!1,header:"Measurements",brand:{accent:"gray",svg:lj}}},t.prototype.renderControls=function(){return Te(Rt,{children:[L(uxe,{},void 0),L(sxe,{},void 0)]},void 0)},t}(Ap),sxe=function(e){Be(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.measurement.behaviors.state,function(){r.forceUpdate()})},t.prototype.renderGroup=function(r,n){for(var a=[],i=0,o=r;i<o.length;i++){var s=o[i];s.obj&&a.push(L(cxe,{cell:s},s.obj.id))}return a.length?L(ls,w({header:n,initiallyExpanded:!0},{children:a}),void 0):null},t.prototype.render=function(){var r=this.plugin.managers.structure.measurement.state;return Te("div",w({style:{marginTop:"6px"}},{children:[this.renderGroup(r.labels,"Labels"),this.renderGroup(r.distances,"Distances"),this.renderGroup(r.angles,"Angles"),this.renderGroup(r.dihedrals,"Dihedrals")]}),void 0)},t}(Sa),uxe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isBusy:!1,action:void 0},r.measureDistance=function(){var n=r.plugin.managers.structure.selection.additionsHistory;r.plugin.managers.structure.measurement.addDistance(n[0].loci,n[1].loci)},r.measureAngle=function(){var n=r.plugin.managers.structure.selection.additionsHistory;r.plugin.managers.structure.measurement.addAngle(n[0].loci,n[1].loci,n[2].loci)},r.measureDihedral=function(){var n=r.plugin.managers.structure.selection.additionsHistory;r.plugin.managers.structure.measurement.addDihedral(n[0].loci,n[1].loci,n[2].loci,n[3].loci)},r.addLabel=function(){var n=r.plugin.managers.structure.selection.additionsHistory;r.plugin.managers.structure.measurement.addLabel(n[0].loci)},r.selectAction=function(n){r.toggleAdd(),n&&(n==null?void 0:n.value)()},r.toggleAdd=function(){return r.setState({action:r.state.action==="add"?void 0:"add"})},r.toggleOptions=function(){return r.setState({action:r.state.action==="options"?void 0:"options"})},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.selection.events.additionsHistoryUpdated,function(){r.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){r.setState({isBusy:n})})},Object.defineProperty(t.prototype,"selection",{get:function(){return this.plugin.managers.structure.selection},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"actions",{get:function(){var r=this.selection.additionsHistory,n=[{kind:"item",label:"Label "+(r.length===0?" (1 selection required)":" (1st selection)"),value:this.addLabel,disabled:r.length===0},{kind:"item",label:"Distance "+(r.length<2?" (2 selections required)":" (top 2 selections)"),value:this.measureDistance,disabled:r.length<2},{kind:"item",label:"Angle "+(r.length<3?" (3 selections required)":" (top 3 selections)"),value:this.measureAngle,disabled:r.length<3},{kind:"item",label:"Dihedral "+(r.length<4?" (4 selections required)":" (top 4 selections)"),value:this.measureDihedral,disabled:r.length<4}];return n},enumerable:!1,configurable:!0}),t.prototype.highlight=function(r){this.plugin.managers.interactivity.lociHighlights.highlightOnly({loci:r},!1)},t.prototype.moveHistory=function(r,n){this.plugin.managers.structure.selection.modifyHistory(r,n,4)},t.prototype.focusLoci=function(r){this.plugin.managers.camera.focusLoci(r)},t.prototype.historyEntry=function(r,n){var a=this,i=this.plugin.managers.structure.selection.additionsHistory;return Te("div",w({className:"msp-flex-row"},{children:[Te(pr,w({noOverflow:!0,title:"Click to focus. Hover to highlight.",onClick:function(){return a.focusLoci(r.loci)},style:{width:"auto",textAlign:"left"},onMouseEnter:function(){return a.highlight(r.loci)},onMouseLeave:this.plugin.managers.interactivity.lociHighlights.clearHighlights},{children:[n,". ",L("span",{dangerouslySetInnerHTML:{__html:r.label}},void 0)]}),void 0),i.length>1&&L(Gt,{svg:Iy,small:!0,className:"msp-form-control",onClick:function(){return a.moveHistory(r,"up")},flex:"20px",title:"Move up"},void 0),i.length>1&&L(Gt,{svg:Ey,small:!0,className:"msp-form-control",onClick:function(){return a.moveHistory(r,"down")},flex:"20px",title:"Move down"},void 0),L(Gt,{svg:Oo,small:!0,className:"msp-form-control",onClick:function(){return a.plugin.managers.structure.selection.modifyHistory(r,"remove")},flex:!0,title:"Remove"},void 0)]}),r.id)},t.prototype.add=function(){for(var r=this.plugin.managers.structure.selection.additionsHistory,n=[],a=0,i=Math.min(r.length,4);a<i;a++)n.push(this.historyEntry(r[a],a+1));return Te(Rt,{children:[L(Jt,{items:this.actions,onSelect:this.selectAction},void 0),n.length>0&&L("div",w({className:"msp-control-offset"},{children:n}),void 0),n.length===0&&L("div",w({className:"msp-control-offset msp-help-text"},{children:Te("div",w({className:"msp-help-description"},{children:[L(tn,{svg:Hs,inline:!0},void 0),"Add one or more selections (toggle ",L(Jg,{inline:!0},void 0)," mode)"]}),void 0)}),void 0)]},void 0)},t.prototype.render=function(){return Te(Rt,{children:[Te("div",w({className:"msp-flex-row"},{children:[L(oa,{icon:_p,label:"Add",toggle:this.toggleAdd,isSelected:this.state.action==="add",disabled:this.state.isBusy,className:"msp-btn-apply-simple"},void 0),L(oa,{icon:Id,label:"",title:"Options",toggle:this.toggleOptions,isSelected:this.state.action==="options",disabled:this.state.isBusy,style:{flex:"0 0 40px",padding:0}},void 0)]}),void 0),this.state.action==="add"&&this.add(),this.state.action==="options"&&L(lxe,{},void 0)]},void 0)},t}(Sa),lxe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isDisabled:!1},r.changed=function(n){r.plugin.managers.structure.measurement.setOptions(n)},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.measurement.behaviors.state,function(){r.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){r.setState({isDisabled:n})})},t.prototype.render=function(){var r=this.plugin.managers.structure.measurement.state;return L("div",w({className:"msp-control-offset"},{children:L(Pn,{params:AL,values:r.options,onChangeValues:this.changed,isDisabled:this.state.isDisabled},void 0)}),void 0)},t}(Sa),cxe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={showUpdate:!1},r.delete=function(){wt.State.RemoveObject(r.plugin,{state:r.props.cell.parent,ref:r.props.cell.transform.parent,removeParentGhosts:!0})},r.toggleVisibility=function(n){n.preventDefault(),wt.State.ToggleVisibility(r.plugin,{state:r.props.cell.parent,ref:r.props.cell.transform.parent}),n.currentTarget.blur()},r.highlight=function(){var n,a=r.selections;if(!!a){r.plugin.managers.interactivity.lociHighlights.clearHighlights();for(var i=0,o=r.lociArray;i<o.length;i++){var s=o[i];r.plugin.managers.interactivity.lociHighlights.highlight({loci:s},!1)}r.plugin.managers.interactivity.lociHighlights.highlight({loci:(n=r.props.cell.obj)===null||n===void 0?void 0:n.data.repr.getLoci()},!1)}},r.clearHighlight=function(){r.plugin.managers.interactivity.lociHighlights.clearHighlights()},r.toggleUpdate=function(){return r.setState({showUpdate:!r.state.showUpdate})},r.focus=function(){var n=r.selections;if(!!n){var a=ir.getBundleBoundingSphere({loci:r.lociArray});a&&r.plugin.managers.camera.focusSphere(a)}},r.selectAction=function(n){!n||(r.setState({showUpdate:!1}),(n==null?void 0:n.value)())},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.events.cell.stateUpdated,function(n){r.forceUpdate()})},Object.defineProperty(t.prototype,"selections",{get:function(){var r;return(r=this.props.cell.obj)===null||r===void 0?void 0:r.data.sourceData},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lociArray",{get:function(){var r=this.selections;return r?r.infos?[r.infos[0].loci]:r.pairs?r.pairs[0].loci:r.triples?r.triples[0].loci:r.quads?r.quads[0].loci:[]:[]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"label",{get:function(){var r=this.selections;return r?r.infos?Cc(r.infos[0].loci,{condensed:!0}):r.pairs?s1(r.pairs[0],{condensed:!0,unitLabel:this.plugin.managers.structure.measurement.state.options.distanceUnitLabel}):r.triples?u1(r.triples[0],{condensed:!0}):r.quads?l1(r.quads[0],{condensed:!0}):"<empty>":"<empty>"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"actions",{get:function(){var r=this;return this.props.cell.sourceRef,[Jt.Item("Select This",function(){return r.plugin.managers.structure.selection.fromSelections(r.props.cell.sourceRef)},{icon:rg})]},enumerable:!1,configurable:!0}),t.prototype.render=function(){var r=this.props.cell,n=r.obj;return n?Te(Rt,{children:[Te("div",w({className:"msp-flex-row",onMouseEnter:this.highlight,onMouseLeave:this.clearHighlight},{children:[L("button",w({className:"msp-form-control msp-control-button-label msp-no-overflow",title:"Click to focus. Hover to highlight.",onClick:this.focus,style:{width:"auto",textAlign:"left"}},{children:L("span",{dangerouslySetInnerHTML:{__html:this.label}},void 0)}),void 0),L(Gt,{svg:r.state.isHidden?Xd:Yd,toggleState:!1,small:!0,className:"msp-form-control",onClick:this.toggleVisibility,flex:!0,title:r.state.isHidden?"Show":"Hide"},void 0),L(Gt,{svg:Oo,small:!0,className:"msp-form-control",onClick:this.delete,flex:!0,title:"Delete",toggleState:!1},void 0),L(Gt,{svg:Ed,className:"msp-form-control",onClick:this.toggleUpdate,flex:!0,title:"Actions",toggleState:this.state.showUpdate},void 0)]}),n.id),this.state.showUpdate&&r.parent&&L(Rt,{children:Te("div",w({className:"msp-accent-offset"},{children:[L(Jt,{items:this.actions,onSelect:this.selectAction,noOffset:!0},void 0),L(ls,w({header:"Options",noOffset:!0},{children:L(Zu,{state:r.parent,transform:r.transform,customHeader:"none",autoHideApply:!0},void 0)}),void 0)]}),void 0)},void 0)]},void 0):null},t}(Sa);function W2(e,t,r,n){for(var a=Je.indexOf(t.unit.elements,t.element),i=Re(t.structure,[{unit:t.unit,indices:ke.ofSingleton(a)}]),o=n==="residue"?Re.extendToWholeResidues(i):Re.extendToWholeChains(i),s=ct.entity.pdbx_description(t).join(", "),u=0,l=r.units;u<l.length;u++){var c=l[u],d=Re(o.structure,[{unit:c,indices:o.elements[0].indices}]),f=Cc(d,{reverse:!0,hidePrefix:!0,htmlStyling:!1,granularity:n});f||(f=Cc(d,{hidePrefix:!1,htmlStyling:!1})),r.units.length>1&&(f+=" | "+d.elements[0].unit.conformation.operator.name);var p={label:f,category:s,loci:d};e.has(s)?e.get(s).push(p):e.set(s,[p])}}function dxe(e){for(var t=new Map,r=Ze.create(e),n=0,a=e.unitSymmetryGroups;n<a.length;n++){var i=a[n];if(!!ze.isAtomic(i.units[0])){r.unit=i.units[0],r.element=i.elements[0];var o=ze.Traits.is(r.unit.traits,1),s=ct.entity.type(r),u=s==="non-polymer",l=s==="branched",c=!!ct.entity.prd_id(r);if(c)W2(t,r,i,"chain");else if(u&&!o)W2(t,r,i,"residue");else if(l||u&&o)for(var d=r.unit,f=d.model.atomicHierarchy.residueAtomSegments.index,p=-1,h=0,v=d.elements.length;h<v;++h){var m=d.elements[h],g=f[m];g!==p&&(r.element=m,W2(t,r,i,"residue"),p=g)}}}var y=[];return t.forEach(function(b,x){b.length===1?y.push({label:x+": "+b[0].label,loci:b[0].loci}):b.length<2e3&&y.push.apply(y,b)}),y}var fxe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isBusy:!1,showAction:!1},r.getSelectionItems=bc(function(n){for(var a,i=[],o=0,s=n;o<s.length;o++){var u=s[o],l=(a=u.cell.obj)===null||a===void 0?void 0:a.data;if(l){var c=dxe(l);c.length>0&&i.push(Nt([Jt.Header(l.label,{description:l.label})],Jt.createItems(c,{label:function(d){return d.label},category:function(d){return d.category},description:function(d){return d.label}})))}}return i}),r.selectAction=function(n,a){if(!n||!r.state.showAction){r.setState({showAction:!1});return}var i=n.value;a!=null&&a.shiftKey?r.plugin.managers.structure.focus.addFromLoci(i.loci):r.plugin.managers.structure.focus.set(i),r.focusCamera()},r.toggleAction=function(){return r.setState({showAction:!r.state.showAction})},r.focusCamera=function(){var n=r.plugin.managers.structure.focus.current;n&&r.plugin.managers.camera.focusLoci(n.loci)},r.clear=function(){r.plugin.managers.structure.focus.clear(),r.plugin.managers.camera.reset()},r.highlightCurrent=function(){var n=r.plugin.managers.structure.focus.current;n&&r.plugin.managers.interactivity.lociHighlights.highlightOnly({loci:n.loci},!1)},r.clearHighlights=function(){r.plugin.managers.interactivity.lociHighlights.clearHighlights()},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.focus.behaviors.current,function(n){r.getSelectionItems([]),r.forceUpdate()}),this.subscribe(this.plugin.managers.structure.focus.events.historyUpdated,function(n){r.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){r.setState({isBusy:n,showAction:!1})})},Object.defineProperty(t.prototype,"isDisabled",{get:function(){return this.state.isBusy||this.actionItems.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"actionItems",{get:function(){var r=[],n=this.plugin.managers.structure.focus.history;n.length>0&&r.push(Nt([Jt.Header("History",{description:"Previously focused on items."})],Jt.createItems(n,{label:function(u){return u.label},description:function(u){return u.category&&u.label!==u.category?u.category+" | "+u.label:u.label}})));var a=this.getSelectionItems(this.plugin.managers.structure.hierarchy.selection.structures);if(a.length===1){var i=a[0],o=i[0];o.initiallyExpanded=!0}var s=[];return a.length>0&&s.push.apply(s,a),r.length>0&&s.push.apply(s,r),s},enumerable:!1,configurable:!0}),t.prototype.getToggleBindingLabel=function(){var r,n=this.plugin.state.behaviors.transforms.get(C1.id);if(!n)return"";var a=(r=n.params)===null||r===void 0?void 0:r.bindings.clickFocus;return!a||fr.isEmpty(a)?"":fr.formatTriggers(a)},t.prototype.render=function(){var r=this.plugin.managers.structure.focus.current,n=(r==null?void 0:r.label)||"Nothing Focused",a="Click to Center Camera";if(!r){a="Select focus using the menu";var i=this.getToggleBindingLabel();i&&(a+=`
or use '`+i+"' on element")}return Te(Rt,{children:[Te("div",w({className:"msp-flex-row"},{children:[L(pr,w({noOverflow:!0,onClick:this.focusCamera,title:a,onMouseEnter:this.highlightCurrent,onMouseLeave:this.clearHighlights,disabled:this.isDisabled||!r,style:{textAlignLast:r?"left":void 0}},{children:n}),void 0),r&&L(Gt,{svg:D_,onClick:this.clear,title:"Clear",className:"msp-form-control",flex:!0,disabled:this.isDisabled},void 0),L(oa,{icon:Rj,title:"Select a focus target to center on an show its surroundings. Hold shift to focus on multiple targets.",toggle:this.toggleAction,isSelected:this.state.showAction,disabled:this.isDisabled,style:{flex:"0 0 40px",padding:0}},void 0)]}),void 0),this.state.showAction&&L(Jt,{items:this.actionItems,onSelect:this.selectAction},void 0)]},void 0)},t}(hr),pxe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.item=function(n){var a,i,o,s,u,l,c,d,f,p=r.plugin.managers.structure.hierarchy.seletionSet,h;switch(n.kind){case"model":{var v=(a=n.cell.obj)===null||a===void 0?void 0:a.data;v&&jt.TrajectoryInfo.get(v).size>1&&(h=((i=n.cell.obj)===null||i===void 0?void 0:i.data.entryId)+" | Model "+(jt.TrajectoryInfo.get(v).index+1)+" of "+jt.TrajectoryInfo.get(v).size),h=((o=n.cell.obj)===null||o===void 0?void 0:o.data.entryId)+" | "+((s=n.cell.obj)===null||s===void 0?void 0:s.label);break}case"structure":{var v=(u=n.cell.obj)===null||u===void 0?void 0:u.data.models[0];if(v&&jt.TrajectoryInfo.get(v).size>1){h=v.entryId+" | "+((l=n.cell.obj)===null||l===void 0?void 0:l.label)+" (Model "+(jt.TrajectoryInfo.get(v).index+1)+" of "+jt.TrajectoryInfo.get(v).size+")";break}else if(v){h=v.entryId+" | "+((c=n.cell.obj)===null||c===void 0?void 0:c.label);break}else{h=""+((d=n.cell.obj)===null||d===void 0?void 0:d.label);break}}default:h=(f=n.cell.obj)===null||f===void 0?void 0:f.label;break}var m={kind:"item",label:h||n.kind,selected:p.has(n.cell.transform.ref),value:[n]};return m},r.getTrajectoryItems=function(n){var a;return n.models.length===0?r.item(n):Nt([Jt.Header((a=n.cell.obj)===null||a===void 0?void 0:a.label)],n.models.map(r.getModelItems))},r.getModelItems=function(n){var a,i,o;if(n.structures.length===0)return r.item(n);if(n.structures.length===1){var s=r.plugin.managers.structure.hierarchy.seletionSet,u=n.structures[0];return{label:((a=n.cell.obj)===null||a===void 0?void 0:a.label)+" | "+((i=u.cell.obj)===null||i===void 0?void 0:i.label),selected:s.has(u.cell.transform.ref),value:[n,u]}}return Nt([Jt.Header((o=n.cell.obj)===null||o===void 0?void 0:o.label)],n.structures.map(r.item))},r.selectHierarchy=function(n){if(!(!n||n.length===0)){for(var a=[],i=0,o=n;i<o.length;i++)for(var s=o[i],u=0,l=s.value;u<l.length;u++){var c=l[u];a.push(c)}r.plugin.managers.structure.hierarchy.updateCurrent(a,n[0].selected?"remove":"add")}},r.toggleHierarchy=function(){return r.setState({show:r.state.show!=="hierarchy"?"hierarchy":void 0})},r.togglePreset=function(){return r.setState({show:r.state.show!=="presets"?"presets":void 0})},r.applyPreset=function(n){if(r.setState({show:void 0}),!!n){var a=r.plugin.managers.structure,i=a.hierarchy.selection.trajectories;a.hierarchy.applyPreset(i,n.value)}},r.updateModelQueueParams=void 0,r.isUpdatingModel=!1,r.updateStructureModel=function(n){r.updateModelQueueParams=n,r._updateStructureModel()},r.updateStructure=function(n){var a=r.plugin.managers.structure.hierarchy.selection,i=a.structures[0];return r.plugin.managers.structure.hierarchy.updateStructure(i,n)},r}return t.prototype.defaultState=function(){return{header:"Structure",isCollapsed:!1,isBusy:!1,brand:{accent:"purple",svg:aj}}},t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,function(){return r.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){r.setState({isBusy:n})})},Object.defineProperty(t.prototype,"hierarchyItems",{get:function(){var r=this.plugin.managers.structure.hierarchy,n=r.current,a=[];return n.trajectories.length>1&&a.push(Nt([Jt.Header("Trajectories")],n.trajectories.map(this.item))),(n.models.length>1||n.trajectories.length>1)&&a.push(Nt([Jt.Header("Models")],n.models.map(this.item))),n.trajectories.length===1&&n.models.length===1?a.push.apply(a,n.structures.map(this.item)):n.structures.length>0&&a.push(Nt([Jt.Header("Structures")],n.structures.map(this.item))),a},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isEmpty",{get:function(){var r=this.plugin.managers.structure.hierarchy.current,n=r.structures,a=r.models,i=r.trajectories;return i.length===0&&a.length===0&&n.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"label",{get:function(){var r,n,a,i,o,s,u,l,c,d,f,p,h,v,m=this.plugin.managers.structure.hierarchy.selection,g=m.structures,y=m.models,b=m.trajectories;if(g.length===1){var x=g[0];return((n=(r=x.model)===null||r===void 0?void 0:r.trajectory)===null||n===void 0?void 0:n.models)&&x.model.trajectory.models.length===1?(a=x.cell.obj)===null||a===void 0?void 0:a.data.label:x.model?((i=x.model.cell.obj)===null||i===void 0?void 0:i.label)+" | "+((o=x.cell.obj)===null||o===void 0?void 0:o.data.label):(s=x.cell.obj)===null||s===void 0?void 0:s.data.label}if(g.length>1){for(var S=g[0],_=(u=S==null?void 0:S.model)===null||u===void 0?void 0:u.trajectory,A=!0,T=0,I=g;T<I.length;T++){var x=I[T];if(((l=x==null?void 0:x.model)===null||l===void 0?void 0:l.trajectory)!==_){A=!1;break}}return A&&_?((c=_.cell.obj)===null||c===void 0?void 0:c.label)+" | "+g.length+" structures":g.length+" structures"}if(y.length>0){var _=y[0].trajectory;if(y.length===1){var M=(d=y[0].cell.obj)===null||d===void 0?void 0:d.data;return M&&jt.TrajectoryInfo.get(M).size>1?((f=_==null?void 0:_.cell.obj)===null||f===void 0?void 0:f.label)+" | Model "+(jt.TrajectoryInfo.get(M).index+1)+" of "+jt.TrajectoryInfo.get(M).size:((p=_==null?void 0:_.cell.obj)===null||p===void 0?void 0:p.label)+" | Model"}for(var A=!0,O=0,D=y;O<D.length;O++){var F=D[O];if(F.trajectory!==_){A=!1;break}}return A?((h=_==null?void 0:_.cell.obj)===null||h===void 0?void 0:h.label)+" | "+y.length+" models":y.length+" models"}return b.length>0?b.length===1?((v=b[0].cell.obj)===null||v===void 0?void 0:v.label)+" trajectory":b.length+" trajectories":b.length===0&&y.length===0&&g.length===0?"Nothing Loaded":"Nothing Selected"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"presetActions",{get:function(){var r=[],n=this.plugin.managers.structure.hierarchy.selection.trajectories;if(n.length===0)return r;var a=this.plugin.builders.structure.hierarchy.getPresets(n[0].cell.obj);if(n.length>1){for(var i=new Set(a),o=1;o<n.length;o++)for(var s=this.plugin.builders.structure.hierarchy.getPresets(n[o].cell.obj),u=new Set(s),l=0,c=s;l<c.length;l++){var d=c[l];u.has(d)||i.delete(d)}a=a.filter(function(h){return i.has(h)})}for(var f=0,p=a;f<p.length;f++){var d=p[f];r.push(Jt.Item(d.display.name,d,{description:d.display.description}))}return r},enumerable:!1,configurable:!0}),t.prototype._updateStructureModel=function(){return ce(this,void 0,void 0,function(){var r,n,a;return de(this,function(i){switch(i.label){case 0:if(!this.updateModelQueueParams||this.isUpdatingModel)return[2];r=this.updateModelQueueParams,this.updateModelQueueParams=void 0,i.label=1;case 1:return i.trys.push([1,,3,4]),this.isUpdatingModel=!0,n=this.plugin.managers.structure.hierarchy.selection,a=n.structures[0].model,[4,this.plugin.state.updateTransform(this.plugin.state.data,a.cell.transform.ref,r,"Model Index")];case 2:return i.sent(),[3,4];case 3:return this.isUpdatingModel=!1,this._updateStructureModel(),[7];case 4:return[2]}})})},Object.defineProperty(t.prototype,"modelIndex",{get:function(){var r,n,a=this.plugin.managers.structure.hierarchy.selection;if(a.structures.length!==1)return null;var i=a.structures[0].model;if(!i||i.cell.transform.transformer!==rt.Model.ModelFromTrajectory||!i.cell.obj||jt.TrajectoryInfo.get(i.cell.obj.data).size<=1)return null;var o=(r=i.cell.params)===null||r===void 0?void 0:r.definition;return o?L(Pn,{params:o,values:(n=i.cell.params)===null||n===void 0?void 0:n.values,onChangeValues:this.updateStructureModel,isDisabled:this.state.isBusy},void 0):null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"structureType",{get:function(){var r,n=this.plugin.managers.structure.hierarchy.selection;if(n.structures.length!==1)return null;var a=n.structures[0],i=(r=a.cell.params)===null||r===void 0?void 0:r.definition;return!i||!a.cell.parent?null:L(Zu,{state:a.cell.parent,transform:a.cell.transform,customHeader:"none",customUpdate:this.updateStructure,noMargin:!0,autoHideApply:!0},void 0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"transform",{get:function(){var r=this.plugin.managers.structure.hierarchy.selection;if(r.structures.length!==1)return null;var n=r.structures[0];if(!n.cell.parent)return null;var a=ar.tryFindDecorator(this.plugin.state.data,n.cell.transform.ref,rt.Model.TransformStructureConformation);if(!!a)return L(ls,w({header:"Conformation Transform"},{children:L(Zu,{state:a.parent,transform:a.transform,customHeader:"none",noMargin:!0,autoHideApply:!0},void 0)}),void 0)},enumerable:!1,configurable:!0}),t.prototype.renderControls=function(){var r=this.state.isBusy||this.isEmpty,n=this.presetActions,a=this.label;return Te(Rt,{children:[Te("div",w({className:"msp-flex-row",style:{marginTop:"1px"}},{children:[L(pr,w({noOverflow:!0,flex:!0,onClick:this.toggleHierarchy,disabled:r,title:a},{children:a}),void 0),n.length>0&&L(Gt,{svg:My,className:"msp-form-control",flex:"40px",onClick:this.togglePreset,title:"Apply a structure presets to the current hierarchy.",toggleState:this.state.show==="presets",disabled:r},void 0)]}),void 0),this.state.show==="hierarchy"&&L(Jt,{items:this.hierarchyItems,onSelect:this.selectHierarchy,multiselect:!0},void 0),this.state.show==="presets"&&L(Jt,{items:n,onSelect:this.applyPreset},void 0),this.modelIndex,this.structureType,this.transform,Te("div",w({style:{marginTop:"6px"}},{children:[L(fxe,{},void 0),L(rxe,{hideOnEmpty:!0},void 0)]}),void 0)]},void 0)},t}(Ap);function hxe(e,t){var r=yxe(e,t||aw());return _xe(e.tree,r),t&&t.refs.forEach(xxe,r),{hierarchy:r.hierarchy,added:r.added,changed:r.changed}}function aw(){return{volumes:[],lazyVolumes:[],refs:new Map}}function vxe(e){return{kind:"volume",cell:e,version:e.transform.version,representations:[]}}function mxe(e){return{kind:"lazy-volume",cell:e,version:e.transform.version}}function gxe(e,t){return{kind:"volume-representation",cell:e,version:e.transform.version,volume:t}}function yxe(e,t){return{state:e,oldHierarchy:t,hierarchy:aw(),changed:!1,added:new Set}}function X2(e,t,r,n){for(var a=[],i=4;i<arguments.length;i++)a[i-4]=arguments[i];var o=n.apply(void 0,a);r.push(o),e.hierarchy.refs.set(t.transform.ref,o);var s=e.oldHierarchy.refs.get(t.transform.ref);return s?s.version!==t.transform.version&&(e.changed=!0):(e.added.add(o.cell.transform.ref),e.changed=!0),o}function bxe(e,t){return function(r,n){return!t(n)&&e.is(r.obj)}}function zI(){}var Sxe=[[bxe(ge.Volume.Data,function(e){return e.currentVolume}),function(e,t){e.currentVolume=X2(e,t,e.hierarchy.volumes,vxe,t)},function(e){return e.currentVolume=void 0}],[function(e){return ge.Volume.Lazy.is(e.obj)},function(e,t){X2(e,t,e.hierarchy.lazyVolumes,mxe,t)},zI],[function(e,t){return!e.state.isGhost&&!!t.currentVolume&&ge.Volume.Representation3D.is(e.obj)},function(e,t){return e.currentVolume&&X2(e,t,e.currentVolume.representations,gxe,t,e.currentVolume),!1},zI]];function TL(e){if(!e||!(e!=null&&e.parent)||!e.parent.cells.has(e.transform.ref))return!1;var t=e.obj;return!(!t||t===Cn.Null||e.status!=="ok"&&e.status!=="error")}function xxe(e){var t=e.cell;TL(t)||(this.changed=!0)}function Cxe(e){EL(this,this.tree.transforms.get(e))}function EL(e,t){var r=e.state,n=r.state.cells.get(t.ref);if(!!TL(n)){for(var a=void 0,i=!1,o=0,s=Sxe;o<s.length;o++){var u=s[o],l=u[0],c=u[1],d=u[2];if(l(n,r)){var f=c(r,n);if(f===!1){i=!0;break}a=d;break}}if(!i){var p=e.tree.children.get(t.ref);p&&p.size&&p.forEach(Cxe,e),a&&a(r)}}}function _xe(e,t){var r={tree:e,state:t};return EL(r,e.root),r.state}function np(e,t,r){r===void 0&&(r={});var n=r;return typeof n.type=="string"||typeof n.color=="string"||typeof n.size=="string"?wxe(e,t||Ct.One,r):IL(e,t||Ct.One,r)}function wxe(e,t,r){var n=r.type&&e.representation.volume.registry.get(r.type)||e.representation.volume.registry.default.provider,a=r.color&&e.representation.volume.themes.colorThemeRegistry.get(r.color)||e.representation.volume.themes.colorThemeRegistry.get(n.defaultColorTheme.name),i=r.size&&e.representation.volume.themes.sizeThemeRegistry.get(r.size)||e.representation.volume.themes.sizeThemeRegistry.get(n.defaultSizeTheme.name);return IL(e,t,{type:n,typeParams:r.typeParams,color:a,colorParams:r.colorParams,size:i,sizeParams:r.sizeParams})}function IL(e,t,r){r===void 0&&(r={});var n=e.representation.volume.themes,a={volume:t},i=r.type||e.representation.volume.registry.default.provider,o=E.getDefaultValues(i.getParams(n,t)),s=Object.assign(o,r.typeParams),u=r.color||n.colorThemeRegistry.get(i.defaultColorTheme.name),l=E.getDefaultValues(u.getParams(a));u.name===i.defaultColorTheme.name&&Object.assign(l,i.defaultColorTheme.props);var c=Object.assign(l,r.colorParams),d=r.size||n.sizeThemeRegistry.get(i.defaultSizeTheme.name),f=E.getDefaultValues(d.getParams(a));d.name===i.defaultSizeTheme.name&&Object.assign(f,i.defaultSizeTheme.props);var p=Object.assign(f,r.sizeParams);return{type:{name:i.name,params:s},colorTheme:{name:u.name,params:c},sizeTheme:{name:d.name,params:p}}}var ey=function(e){Be(t,e);function t(r){var n=e.call(this)||this;return n.plugin=r,n.state={syncedTree:n.dataState.tree,notified:!1,hierarchy:aw(),selection:void 0},n.behaviors={selection:n.ev.behavior({hierarchy:n.current,volume:n.selection})},n.subscribe(r.state.data.events.changed,function(a){a.inTransaction||r.behaviors.state.isAnimating.value||n.sync(!0)}),n.subscribe(r.behaviors.state.isAnimating,function(a){!a&&!r.behaviors.state.isUpdating.value&&n.sync(!0)}),n}return Object.defineProperty(t.prototype,"dataState",{get:function(){return this.plugin.state.data},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"current",{get:function(){return this.sync(!1),this.state.hierarchy},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"selection",{get:function(){return this.sync(!1),this.state.selection},enumerable:!1,configurable:!0}),t.prototype.sync=function(r){if(!(!r&&this.dataState.inUpdate)){if(this.state.syncedTree===this.dataState.tree){r&&!this.state.notified&&(this.state.notified=!0,this.behaviors.selection.next({hierarchy:this.state.hierarchy,volume:this.state.selection}));return}this.state.syncedTree=this.dataState.tree;var n=hxe(this.plugin.state.data,this.current);if(!!n.changed){var a=n.hierarchy;this.state.hierarchy=a,this.state.selection?this.state.selection=a.refs.has(this.state.selection.cell.transform.ref)?a.refs.get(this.state.selection.cell.transform.ref):a.volumes[0]:this.state.selection=a.volumes[0],r?(this.state.notified=!0,this.behaviors.selection.next({hierarchy:a,volume:this.state.selection})):this.state.notified=!1}}},t.prototype.setCurrent=function(r){this.state.selection=r||this.state.hierarchy.volumes[0],this.behaviors.selection.next({hierarchy:this.state.hierarchy,volume:r||this.state.hierarchy.volumes[0]})},t.prototype.remove=function(r,n){if(r.length!==0){for(var a=this.plugin.state.data.build(),i=0,o=r;i<o.length;i++){var s=o[i];a.delete(typeof s=="string"?s:s.cell.transform.ref)}return a.commit({canUndo:n?"Remove":!1})}},t.prototype.toggleVisibility=function(r,n){if(r.length!==0)for(var a=n!==void 0?n!=="show":!r[0].cell.state.isHidden,i=0,o=r;i<o.length;i++){var s=o[i];Vd(this.dataState,s.cell.transform.ref,a)}},t.prototype.addRepresentation=function(r,n){var a,i=this.dataState.build().to(r.cell).apply(rt.Representation.VolumeRepresentation3D,np(this.plugin,(a=r.cell.obj)===null||a===void 0?void 0:a.data,{type:n}));return i.commit({canUndo:"Add Representation"})},t}(Vv);(function(e){function t(r,n){var a,i;return!((a=n==null?void 0:n.cell.obj)===null||a===void 0)&&a.data?r.representation.volume.registry.getApplicableTypes((i=n.cell.obj)===null||i===void 0?void 0:i.data):r.representation.volume.registry.types}e.getRepresentationTypes=t})(ey||(ey={}));var jC=function(e){Be(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t}(ge.Create({name:"Volume Streaming",typeClass:"Object"})),VI;(function(e){(function(t){t.Float32="float32",t.Int8="int8"})(e.ValueType||(e.ValueType={}))})(VI||(VI={}));function Axe(e,t){if(t===void 0&&(t="x-ray"),!e)return t;var r=e.models[0];return Jr.is(r.sourceData)?jt.hasEmMap(r)?"em":jt.hasXrayMap(r)?"x-ray":jt.isFromEm(r)?"em":jt.isFromXray(r)?"x-ray":t:t}function Pxe(e){var t=[];if(!Jr.is(e.sourceData))return[e.entryId];var r=e.sourceData.data.db.pdbx_database_related,n=r.db_id,a=r.db_name,i=r.content_type;if(!a.isDefined)return[e.entryId];for(var o=0,s=a.rowCount;o<s;++o)a.value(o).toUpperCase()==="EMDB"&&i.value(o)==="associated EM volume"&&t.push(n.value(o));return t}function Txe(e){return[e.entryId]}function Exe(e,t){if(!t||!t.models.length)return[];var r=t.models[0];switch(e){case"em":return Pxe(r);case"x-ray":return Txe(r)}}function HI(e,t,r,n){return ce(this,void 0,void 0,function(){return de(this,function(a){switch(e){case"emdb":return[2,ML(t,r,n)];case"pdbe":return[2,Ixe(t,r,n)]}return[2]})})}function ML(e,t,r){return ce(this,void 0,void 0,function(){var n,a,i,o;return de(this,function(s){switch(s.label){case 0:return n=e.config.get(jr.VolumeStreaming.EmdbHeaderServer),[4,e.fetch({url:n+"/"+r.toUpperCase()+"/header/"+r.toLowerCase()+".xml",type:"xml"}).runInContext(t)];case 1:return a=s.sent(),i=a.getElementsByTagName("map")[0],o=parseFloat(i.getElementsByTagName("contourLevel")[0].textContent),[2,o]}})})}function Ixe(e,t,r){var n,a,i,o;return ce(this,void 0,void 0,function(){var s,u;return de(this,function(l){switch(l.label){case 0:return r=r.toUpperCase(),[4,e.fetch({url:"https://www.ebi.ac.uk/emdb/api/entry/map/"+r,type:"json"}).runInContext(t)];case 1:return s=l.sent(),u=(a=(n=s==null?void 0:s.map)===null||n===void 0?void 0:n.contour_list)===null||a===void 0?void 0:a.contour,!u||u.length===0?[2,Mxe(e,t,r)]:[2,(o=(i=u.find(function(c){return c.primary}))===null||i===void 0?void 0:i.level)!==null&&o!==void 0?o:u[0].level]}})})}function Mxe(e,t,r){var n,a,i;return ce(this,void 0,void 0,function(){var o,s,u;return de(this,function(l){switch(l.label){case 0:return r=r.toUpperCase(),[4,e.fetch({url:"https://www.ebi.ac.uk/pdbe/api/emdb/entry/map/"+r,type:"json"}).runInContext(t)];case 1:return o=l.sent(),s=o==null?void 0:o[r],u=void 0,((i=(a=(n=s==null?void 0:s[0])===null||n===void 0?void 0:n.map)===null||a===void 0?void 0:a.contour_level)===null||i===void 0?void 0:i.value)!==void 0&&(u=+s[0].map.contour_level.value),[2,u]}})})}function Dxe(e,t,r){var n;return ce(this,void 0,void 0,function(){var a,i,o,s;return de(this,function(u){switch(u.label){case 0:return[4,e.fetch({url:"https://www.ebi.ac.uk/pdbe/api/pdb/entry/summary/"+r,type:"json"}).runInContext(t)];case 1:if(a=u.sent(),i=a==null?void 0:a[r],o=[],!((n=i==null?void 0:i[0])===null||n===void 0)&&n.related_structures){if(s=i[0].related_structures.filter(function(l){return l.resource==="EMDB"&&l.relationship==="associated EM volume"}),!s.length)throw new Error("No related EMDB entry found for '"+r+"'.");o.push.apply(o,s.map(function(l){return l.accession}))}else throw new Error("No related EMDB entry found for '"+r+"'.");return[2,o]}})})}function Rl(e,t,r){return{i:e,j:t,k:r}}function lo(e,t){return{a:e,b:t}}var Bn=[Rl(0,0,0),Rl(1,0,0),Rl(1,1,0),Rl(0,1,0),Rl(0,0,1),Rl(1,0,1),Rl(1,1,1),Rl(0,1,1)],Rxe=[lo(Bn[0],Bn[1]),lo(Bn[1],Bn[2]),lo(Bn[2],Bn[3]),lo(Bn[3],Bn[0]),lo(Bn[4],Bn[5]),lo(Bn[5],Bn[6]),lo(Bn[6],Bn[7]),lo(Bn[7],Bn[4]),lo(Bn[0],Bn[4]),lo(Bn[1],Bn[5]),lo(Bn[2],Bn[6]),lo(Bn[3],Bn[7])],Oxe=[{i:0,j:0,k:0,e:0},{i:1,j:0,k:0,e:1},{i:0,j:1,k:0,e:0},{i:0,j:0,k:0,e:1},{i:0,j:0,k:1,e:0},{i:1,j:0,k:1,e:1},{i:0,j:1,k:1,e:0},{i:0,j:0,k:1,e:1},{i:0,j:0,k:0,e:2},{i:1,j:0,k:0,e:2},{i:1,j:1,k:0,e:2},{i:0,j:1,k:0,e:2}],Fxe=[0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0],ap=[[],[0,8,3],[0,1,9],[1,8,3,9,8,1],[1,2,10],[0,8,3,1,2,10],[9,2,10,0,2,9],[2,8,3,2,10,8,10,9,8],[3,11,2],[0,11,2,8,11,0],[1,9,0,2,3,11],[1,11,2,1,9,11,9,8,11],[3,10,1,11,10,3],[0,10,1,0,8,10,8,11,10],[3,9,0,3,11,9,11,10,9],[9,8,10,10,8,11],[4,7,8],[4,3,0,7,3,4],[0,1,9,8,4,7],[4,1,9,4,7,1,7,3,1],[1,2,10,8,4,7],[3,4,7,3,0,4,1,2,10],[9,2,10,9,0,2,8,4,7],[2,10,9,2,9,7,2,7,3,7,9,4],[8,4,7,3,11,2],[11,4,7,11,2,4,2,0,4],[9,0,1,8,4,7,2,3,11],[4,7,11,9,4,11,9,11,2,9,2,1],[3,10,1,3,11,10,7,8,4],[1,11,10,1,4,11,1,0,4,7,11,4],[4,7,8,9,0,11,9,11,10,11,0,3],[4,7,11,4,11,9,9,11,10],[9,5,4],[9,5,4,0,8,3],[0,5,4,1,5,0],[8,5,4,8,3,5,3,1,5],[1,2,10,9,5,4],[3,0,8,1,2,10,4,9,5],[5,2,10,5,4,2,4,0,2],[2,10,5,3,2,5,3,5,4,3,4,8],[9,5,4,2,3,11],[0,11,2,0,8,11,4,9,5],[0,5,4,0,1,5,2,3,11],[2,1,5,2,5,8,2,8,11,4,8,5],[10,3,11,10,1,3,9,5,4],[4,9,5,0,8,1,8,10,1,8,11,10],[5,4,0,5,0,11,5,11,10,11,0,3],[5,4,8,5,8,10,10,8,11],[9,7,8,5,7,9],[9,3,0,9,5,3,5,7,3],[0,7,8,0,1,7,1,5,7],[1,5,3,3,5,7],[9,7,8,9,5,7,10,1,2],[10,1,2,9,5,0,5,3,0,5,7,3],[8,0,2,8,2,5,8,5,7,10,5,2],[2,10,5,2,5,3,3,5,7],[7,9,5,7,8,9,3,11,2],[9,5,7,9,7,2,9,2,0,2,7,11],[2,3,11,0,1,8,1,7,8,1,5,7],[11,2,1,11,1,7,7,1,5],[9,5,8,8,5,7,10,1,3,10,3,11],[5,7,0,5,0,9,7,11,0,1,0,10,11,10,0],[11,10,0,11,0,3,10,5,0,8,0,7,5,7,0],[11,10,5,7,11,5],[10,6,5],[0,8,3,5,10,6],[9,0,1,5,10,6],[1,8,3,1,9,8,5,10,6],[1,6,5,2,6,1],[1,6,5,1,2,6,3,0,8],[9,6,5,9,0,6,0,2,6],[5,9,8,5,8,2,5,2,6,3,2,8],[2,3,11,10,6,5],[11,0,8,11,2,0,10,6,5],[0,1,9,2,3,11,5,10,6],[5,10,6,1,9,2,9,11,2,9,8,11],[6,3,11,6,5,3,5,1,3],[0,8,11,0,11,5,0,5,1,5,11,6],[3,11,6,0,3,6,0,6,5,0,5,9],[6,5,9,6,9,11,11,9,8],[5,10,6,4,7,8],[4,3,0,4,7,3,6,5,10],[1,9,0,5,10,6,8,4,7],[10,6,5,1,9,7,1,7,3,7,9,4],[6,1,2,6,5,1,4,7,8],[1,2,5,5,2,6,3,0,4,3,4,7],[8,4,7,9,0,5,0,6,5,0,2,6],[7,3,9,7,9,4,3,2,9,5,9,6,2,6,9],[3,11,2,7,8,4,10,6,5],[5,10,6,4,7,2,4,2,0,2,7,11],[0,1,9,4,7,8,2,3,11,5,10,6],[9,2,1,9,11,2,9,4,11,7,11,4,5,10,6],[8,4,7,3,11,5,3,5,1,5,11,6],[5,1,11,5,11,6,1,0,11,7,11,4,0,4,11],[0,5,9,0,6,5,0,3,6,11,6,3,8,4,7],[6,5,9,6,9,11,4,7,9,7,11,9],[10,4,9,6,4,10],[4,10,6,4,9,10,0,8,3],[10,0,1,10,6,0,6,4,0],[8,3,1,8,1,6,8,6,4,6,1,10],[1,4,9,1,2,4,2,6,4],[3,0,8,1,2,9,2,4,9,2,6,4],[0,2,4,4,2,6],[8,3,2,8,2,4,4,2,6],[10,4,9,10,6,4,11,2,3],[0,8,2,2,8,11,4,9,10,4,10,6],[3,11,2,0,1,6,0,6,4,6,1,10],[6,4,1,6,1,10,4,8,1,2,1,11,8,11,1],[9,6,4,9,3,6,9,1,3,11,6,3],[8,11,1,8,1,0,11,6,1,9,1,4,6,4,1],[3,11,6,3,6,0,0,6,4],[6,4,8,11,6,8],[7,10,6,7,8,10,8,9,10],[0,7,3,0,10,7,0,9,10,6,7,10],[10,6,7,1,10,7,1,7,8,1,8,0],[10,6,7,10,7,1,1,7,3],[1,2,6,1,6,8,1,8,9,8,6,7],[2,6,9,2,9,1,6,7,9,0,9,3,7,3,9],[7,8,0,7,0,6,6,0,2],[7,3,2,6,7,2],[2,3,11,10,6,8,10,8,9,8,6,7],[2,0,7,2,7,11,0,9,7,6,7,10,9,10,7],[1,8,0,1,7,8,1,10,7,6,7,10,2,3,11],[11,2,1,11,1,7,10,6,1,6,7,1],[8,9,6,8,6,7,9,1,6,11,6,3,1,3,6],[0,9,1,11,6,7],[7,8,0,7,0,6,3,11,0,11,6,0],[7,11,6],[7,6,11],[3,0,8,11,7,6],[0,1,9,11,7,6],[8,1,9,8,3,1,11,7,6],[10,1,2,6,11,7],[1,2,10,3,0,8,6,11,7],[2,9,0,2,10,9,6,11,7],[6,11,7,2,10,3,10,8,3,10,9,8],[7,2,3,6,2,7],[7,0,8,7,6,0,6,2,0],[2,7,6,2,3,7,0,1,9],[1,6,2,1,8,6,1,9,8,8,7,6],[10,7,6,10,1,7,1,3,7],[10,7,6,1,7,10,1,8,7,1,0,8],[0,3,7,0,7,10,0,10,9,6,10,7],[7,6,10,7,10,8,8,10,9],[6,8,4,11,8,6],[3,6,11,3,0,6,0,4,6],[8,6,11,8,4,6,9,0,1],[9,4,6,9,6,3,9,3,1,11,3,6],[6,8,4,6,11,8,2,10,1],[1,2,10,3,0,11,0,6,11,0,4,6],[4,11,8,4,6,11,0,2,9,2,10,9],[10,9,3,10,3,2,9,4,3,11,3,6,4,6,3],[8,2,3,8,4,2,4,6,2],[0,4,2,4,6,2],[1,9,0,2,3,4,2,4,6,4,3,8],[1,9,4,1,4,2,2,4,6],[8,1,3,8,6,1,8,4,6,6,10,1],[10,1,0,10,0,6,6,0,4],[4,6,3,4,3,8,6,10,3,0,3,9,10,9,3],[10,9,4,6,10,4],[4,9,5,7,6,11],[0,8,3,4,9,5,11,7,6],[5,0,1,5,4,0,7,6,11],[11,7,6,8,3,4,3,5,4,3,1,5],[9,5,4,10,1,2,7,6,11],[6,11,7,1,2,10,0,8,3,4,9,5],[7,6,11,5,4,10,4,2,10,4,0,2],[3,4,8,3,5,4,3,2,5,10,5,2,11,7,6],[7,2,3,7,6,2,5,4,9],[9,5,4,0,8,6,0,6,2,6,8,7],[3,6,2,3,7,6,1,5,0,5,4,0],[6,2,8,6,8,7,2,1,8,4,8,5,1,5,8],[9,5,4,10,1,6,1,7,6,1,3,7],[1,6,10,1,7,6,1,0,7,8,7,0,9,5,4],[4,0,10,4,10,5,0,3,10,6,10,7,3,7,10],[7,6,10,7,10,8,5,4,10,4,8,10],[6,9,5,6,11,9,11,8,9],[3,6,11,0,6,3,0,5,6,0,9,5],[0,11,8,0,5,11,0,1,5,5,6,11],[6,11,3,6,3,5,5,3,1],[1,2,10,9,5,11,9,11,8,11,5,6],[0,11,3,0,6,11,0,9,6,5,6,9,1,2,10],[11,8,5,11,5,6,8,0,5,10,5,2,0,2,5],[6,11,3,6,3,5,2,10,3,10,5,3],[5,8,9,5,2,8,5,6,2,3,8,2],[9,5,6,9,6,0,0,6,2],[1,5,8,1,8,0,5,6,8,3,8,2,6,2,8],[1,5,6,2,1,6],[1,3,6,1,6,10,3,8,6,5,6,9,8,9,6],[10,1,0,10,0,6,9,5,0,5,6,0],[0,3,8,5,6,10],[10,5,6],[11,5,10,7,5,11],[11,5,10,11,7,5,8,3,0],[5,11,7,5,10,11,1,9,0],[10,7,5,10,11,7,9,8,1,8,3,1],[11,1,2,11,7,1,7,5,1],[0,8,3,1,2,7,1,7,5,7,2,11],[9,7,5,9,2,7,9,0,2,2,11,7],[7,5,2,7,2,11,5,9,2,3,2,8,9,8,2],[2,5,10,2,3,5,3,7,5],[8,2,0,8,5,2,8,7,5,10,2,5],[9,0,1,5,10,3,5,3,7,3,10,2],[9,8,2,9,2,1,8,7,2,10,2,5,7,5,2],[1,3,5,3,7,5],[0,8,7,0,7,1,1,7,5],[9,0,3,9,3,5,5,3,7],[9,8,7,5,9,7],[5,8,4,5,10,8,10,11,8],[5,0,4,5,11,0,5,10,11,11,3,0],[0,1,9,8,4,10,8,10,11,10,4,5],[10,11,4,10,4,5,11,3,4,9,4,1,3,1,4],[2,5,1,2,8,5,2,11,8,4,5,8],[0,4,11,0,11,3,4,5,11,2,11,1,5,1,11],[0,2,5,0,5,9,2,11,5,4,5,8,11,8,5],[9,4,5,2,11,3],[2,5,10,3,5,2,3,4,5,3,8,4],[5,10,2,5,2,4,4,2,0],[3,10,2,3,5,10,3,8,5,4,5,8,0,1,9],[5,10,2,5,2,4,1,9,2,9,4,2],[8,4,5,8,5,3,3,5,1],[0,4,5,1,0,5],[8,4,5,8,5,3,9,0,5,0,3,5],[9,4,5],[4,11,7,4,9,11,9,10,11],[0,8,3,4,9,7,9,11,7,9,10,11],[1,10,11,1,11,4,1,4,0,7,4,11],[3,1,4,3,4,8,1,10,4,7,4,11,10,11,4],[4,11,7,9,11,4,9,2,11,9,1,2],[9,7,4,9,11,7,9,1,11,2,11,1,0,8,3],[11,7,4,11,4,2,2,4,0],[11,7,4,11,4,2,8,3,4,3,2,4],[2,9,10,2,7,9,2,3,7,7,4,9],[9,10,7,9,7,4,10,2,7,8,7,0,2,0,7],[3,7,10,3,10,2,7,4,10,1,10,0,4,0,10],[1,10,2,8,7,4],[4,9,1,4,1,7,7,1,3],[4,9,1,4,1,7,0,8,1,8,7,1],[4,0,3,7,4,3],[4,8,7],[9,10,8,10,11,8],[3,0,9,3,9,11,11,9,10],[0,1,10,0,10,8,8,10,11],[3,1,10,11,3,10],[1,2,11,1,11,9,9,11,8],[3,0,9,3,9,11,1,2,9,2,11,9],[0,2,11,8,0,11],[3,2,11],[2,3,8,2,8,10,10,8,9],[9,10,2,0,9,2],[2,3,8,2,8,10,0,1,8,1,10,8],[1,10,2],[1,3,8,9,1,8],[0,9,1],[0,3,8],[]],Y2=[[0,4,4,4,2,0,0,0,2,2,0,0],[4,0,4,4,0,8,0,0,0,8,8,0],[4,4,0,4,0,0,8,0,0,0,8,8],[4,4,4,0,0,0,0,1,1,0,0,1],[2,0,0,0,0,8,8,8,2,2,0,0],[0,8,0,0,8,0,8,8,0,8,8,0],[0,0,8,0,8,8,0,8,0,0,8,8],[0,0,0,1,8,8,8,0,1,0,0,1],[2,0,0,1,2,0,0,1,0,2,0,1],[2,8,0,0,2,8,0,0,2,0,8,0],[0,8,8,0,0,8,8,0,0,8,0,8],[0,0,8,1,0,0,8,1,1,0,8,0]];function kxe(e,t){var r=Math.min(65536,e*4),n=je.create(Float32Array,3,e,t&&t.vertexBuffer.ref.value),a=je.create(Float32Array,3,e,t&&t.normalBuffer.ref.value),i=je.create(Float32Array,1,e,t&&t.groupBuffer.ref.value),o=je.create(Uint32Array,3,r,t&&t.indexBuffer.ref.value),s=0,u=0;return{addVertex:function(l,c,d){return++s,je.add3(n,l,c,d)},addNormal:function(l,c,d){je.add3(a,l,c,d)},addGroup:function(l){je.add(i,l)},addTriangle:function(l,c,d,f){var p=l[c],h=l[d],v=l[f];p>=0&&h>=0&&v>=0&&(++u,je.add3(o,p,h,v))},get:function(){var l=je.compact(n,!0),c=je.compact(a,!0),d=je.compact(o,!0),f=je.compact(i,!0);return Lt.create(l,d,c,f,s,u,t)}}}function Bxe(e,t){var r=je.create(Float32Array,3,e),n=je.create(Float32Array,1,e),a=je.create(Float32Array,2,e),i=0;return{addVertex:function(o,s,u){return je.add3(r,o,s,u)},addNormal:function(){return ql},addGroup:function(o){je.add(n,o)},addTriangle:function(o,s,u,l,c){var d=o[s],f=o[u],p=o[l];d>=0&&f>=0&&p>=0&&(Y2[s][u]&c&&(++i,je.add2(a,o[s],o[u])),Y2[u][l]&c&&(++i,je.add2(a,o[u],o[l])),Y2[s][l]&c&&(++i,je.add2(a,o[s],o[l])))},get:function(){for(var o=je.compact(r,!0),s=je.compact(a,!0),u=je.compact(n,!0),l=Zi.create(i,i/10,t),c=0;c<i;++c){var d=s[c*2],f=s[c*2+1];l.add(o[d*3],o[d*3+1],o[d*3+2],o[f*3],o[f*3+1],o[f*3+2],u[d])}return l.getLines()}}}function DL(e){return w(w({},e),{bottomLeft:ia(e.bottomLeft,[0,0,0]),topRight:ia(e.topRight,e.scalarField.space.dimensions)})}function RL(e){return{dX:e.topRight[0]-e.bottomLeft[0],dY:e.topRight[1]-e.bottomLeft[1],dZ:e.topRight[2]-e.bottomLeft[2]}}function w1(e,t){var r=this;return We.create("Marching Cubes Mesh",function(n){return ce(r,void 0,void 0,function(){var a,i,o,s,u,l,c;return de(this,function(d){switch(d.label){case 0:return a=DL(e),i=RL(a),o=i.dX,s=i.dY,u=i.dZ,l=Math.min(262144,Math.max(o*s*u/32,1024)),c=kxe(l,t),[4,new OL(n,c,a).run()];case 1:return d.sent(),[2,c.get()]}})})})}function iw(e,t){var r=this;return We.create("Marching Cubes Lines",function(n){return ce(r,void 0,void 0,function(){var a,i,o,s,u,l,c;return de(this,function(d){switch(d.label){case 0:return a=DL(e),i=RL(a),o=i.dX,s=i.dY,u=i.dZ,l=Math.min(262144,Math.max(o*s*u/32,1024)),c=Bxe(l,t),[4,new OL(n,c,a).run()];case 1:return d.sent(),[2,c.get()]}})})})}var OL=function(){function e(t,r,n){this.ctx=t,this.minX=0,this.minY=0,this.minZ=0,this.maxX=0,this.maxY=0,this.maxZ=0,this.state=new Lxe(r,n),this.minX=n.bottomLeft[0],this.minY=n.bottomLeft[1],this.minZ=n.bottomLeft[2],this.maxX=n.topRight[0]-1,this.maxY=n.topRight[1]-1,this.maxZ=n.topRight[2]-1,this.size=(this.maxX-this.minX)*(this.maxY-this.minY)*(this.maxZ-this.minZ),this.sliceSize=(this.maxX-this.minX)*(this.maxY-this.minY)}return e.prototype.doSlices=function(){return ce(this,void 0,void 0,function(){var t,r;return de(this,function(n){switch(n.label){case 0:t=0,this.edgeFilter=15,r=this.minZ,n.label=1;case 1:return r<this.maxZ?(this.slice(r),t+=this.sliceSize,this.ctx.shouldUpdate?[4,this.ctx.update({message:"Computing surface...",current:t,max:this.size})]:[3,3]):[3,4];case 2:n.sent(),n.label=3;case 3:return r++,this.edgeFilter&=-5,[3,1];case 4:return[2]}})})},e.prototype.slice=function(t){this.edgeFilter|=2;for(var r=this.minY;r<this.maxY;r++,this.edgeFilter&=-3){this.edgeFilter|=1;for(var n=this.minX;n<this.maxX;n++,this.edgeFilter&=-2)this.state.processCell(n,r,t,this.edgeFilter)}this.state.clearEdgeVertexIndexSlice(t)},e.prototype.run=function(){return ce(this,void 0,void 0,function(){return de(this,function(t){switch(t.label){case 0:return[4,this.doSlices()];case 1:return t.sent(),[2]}})})},e}(),Lxe=function(){function e(t,r){this.builder=t,this.vertList=[0,0,0,0,0,0,0,0,0,0,0,0],this.i=0,this.j=0,this.k=0;var n=r.scalarField.space.dimensions;this.nX=n[0],this.nY=n[1],this.nZ=n[2],this.isoLevel=r.isoLevel,this.scalarFieldGet=r.scalarField.space.get,this.scalarField=r.scalarField.data,r.idField&&(this.idField=r.idField.data,this.idFieldGet=r.idField.space.get),this.verticesOnEdges=new Int32Array(3*this.nX*this.nY*2)}return e.prototype.get3dOffsetFromEdgeInfo=function(t){return this.nX*((this.k+t.k)%2*this.nY+this.j+t.j)+this.i+t.i},e.prototype.clearEdgeVertexIndexSlice=function(t){var r=t%2===0?0:3*this.nX*this.nY,n=t%2===0?3*this.nX*this.nY:this.verticesOnEdges.length;this.verticesOnEdges.fill(0,r,n)},e.prototype.interpolate=function(t){var r=Oxe[t],n=3*this.get3dOffsetFromEdgeInfo(r)+r.e,a=this.verticesOnEdges[n];if(a>0)return a-1;var i=this.scalarField,o=this.scalarFieldGet,s=Rxe[t],u=s.a,l=s.b,c=u.i+this.i,d=u.j+this.j,f=u.k+this.k,p=l.i+this.i,h=l.j+this.j,v=l.k+this.k,m=o(i,c,d,f),g=o(i,p,h,v),y=(this.isoLevel-m)/(m-g);if(this.idField){var b=this.idFieldGet(this.idField,c,d,f),x=this.idFieldGet(this.idField,p,h,v),S=y<.5?b:x;if(S===-1&&(S=y<.5?x:b),S===-2)return-1;this.builder.addGroup(S)}else this.builder.addGroup(0);var _=this.builder.addVertex(c+y*(c-p),d+y*(d-h),f+y*(f-v));this.verticesOnEdges[n]=_+1;var A=o(i,Math.max(0,c-1),d,f)-o(i,Math.min(this.nX-1,c+1),d,f),T=o(i,c,Math.max(0,d-1),f)-o(i,c,Math.min(this.nY-1,d+1),f),I=o(i,c,d,Math.max(0,f-1))-o(i,c,d,Math.min(this.nZ,f+1)),M=o(i,Math.max(0,p-1),h,v)-o(i,Math.min(this.nX-1,p+1),h,v),O=o(i,p,Math.max(0,h-1),v)-o(i,p,Math.min(this.nY-1,h+1),v),D=o(i,p,h,Math.max(0,v-1))-o(i,p,h,Math.min(this.nZ-1,v+1)),F=A+y*(A-M),G=T+y*(T-O),N=I+y*(I-D);return this.isoLevel>=0?this.builder.addNormal(F,G,N):this.builder.addNormal(-F,-G,-N),_},e.prototype.get=function(t,r,n){return this.scalarFieldGet(this.scalarField,t,r,n)},e.prototype.processCell=function(t,r,n,a){var i=0;if(this.get(t,r,n)<this.isoLevel&&(i|=1),this.get(t+1,r,n)<this.isoLevel&&(i|=2),this.get(t+1,r+1,n)<this.isoLevel&&(i|=4),this.get(t,r+1,n)<this.isoLevel&&(i|=8),this.get(t,r,n+1)<this.isoLevel&&(i|=16),this.get(t+1,r,n+1)<this.isoLevel&&(i|=32),this.get(t+1,r+1,n+1)<this.isoLevel&&(i|=64),this.get(t,r+1,n+1)<this.isoLevel&&(i|=128),!(i===0||i===255)){this.i=t,this.j=r,this.k=n;var o=Fxe[i];(o&1)>0&&(this.vertList[0]=this.interpolate(0)),(o&2)>0&&(this.vertList[1]=this.interpolate(1)),(o&4)>0&&(this.vertList[2]=this.interpolate(2)),(o&8)>0&&(this.vertList[3]=this.interpolate(3)),(o&16)>0&&(this.vertList[4]=this.interpolate(4)),(o&32)>0&&(this.vertList[5]=this.interpolate(5)),(o&64)>0&&(this.vertList[6]=this.interpolate(6)),(o&128)>0&&(this.vertList[7]=this.interpolate(7)),(o&256)>0&&(this.vertList[8]=this.interpolate(8)),(o&512)>0&&(this.vertList[9]=this.interpolate(9)),(o&1024)>0&&(this.vertList[10]=this.interpolate(10)),(o&2048)>0&&(this.vertList[11]=this.interpolate(11));for(var s=ap[i],u=0;u<s.length;u+=3){var l=s[u],c=s[u+1],d=s[u+2];this.isoLevel>=0?this.builder.addTriangle(this.vertList,l,c,d,a):this.builder.addTriangle(this.vertList,d,c,l,a)}}},e}();function Nxe(e,t,r,n,a,i){var o=Ma.getUtils(t),s=o.createValues,u=o.createRenderableState,l=K_(),c=s(t,l,r,n,a),d=u(a);return kp(t.kind,c,d,i)}function jv(e,t){var r=e.defaultProps,n=e.createGeometry,a=e.createLocationIterator,i=e.getLoci,o=e.eachLocation,s=e.setUpdateState,u=e.mustRecreate,l=e.dispose,c=e.geometryUtils,d=c.updateValues,f=c.updateBoundingSphere,p=c.updateRenderableState,h=c.createPositionIterator,v=Ys.create(),m,g,y,b,x=Object.assign({},r),S=Yn.createEmpty(),_,A,T,I;function M(F,G,N){if(!N&&!_)throw new Error("missing volume");if(g=Object.assign({},x,G),y=F,b=N,Ys.reset(v),m?(!_||!Ct.areEquivalent(b,_))&&(v.createNew=!0):v.createNew=!0,v.createNew){v.createGeometry=!0;return}s(v,N,g,x,y,S),Wu.areEqual(F.color,S.color)||(v.updateColor=!0),v.createGeometry&&(v.updateColor=!0)}function O(F){if(v.createNew)if(T=a(b),F)m=Nxe(b,F,T,y,g,t),I=h(F,m.values);else throw new Error("expected geometry to be given");else{if(!m)throw new Error("expected renderObject to be available");if(T.reset(),v.createGeometry)if(F)k.updateIfChanged(m.values.drawCount,Ma.getDrawCount(F)),k.updateIfChanged(m.values.uVertexCount,Ma.getVertexCount(F));else throw new Error("expected geometry to be given");(v.updateTransform||v.createGeometry)&&(f(m.values,F||A),I=h(F||A,m.values)),v.updateSize&&"uSize"in m.values&&il(T,y.size,m.values),v.updateColor&&to(T,I,y.color,m.values),d(m.values,g),p(m.state,g)}x=g,S=y,_=b,F&&(A=F)}function D(F,G){return Ao(F)?G(Ie.ofBounds(0,T.groupCount*T.instanceCount)):o(F,_,x,G)}return{get groupCount(){return T?T.count:0},get renderObject(){return m},createOrUpdate:function(F,G,N,z){return N===void 0&&(N={}),ce(this,void 0,void 0,function(){var $;return de(this,function(j){return M(G,N,z||_),v.createGeometry?($=n(F,b,y,g,A),[2,T3($)?$.then(O):O($)]):(O(),[2])})})},getLoci:function(F){return m?i(F,_,x,m.id):Or},mark:function(F,G){return Sr.mark(m,F,G,D)},setVisibility:function(F){Sr.setVisibility(m,F)},setAlphaFactor:function(F){Sr.setAlphaFactor(m,F)},setPickable:function(F){Sr.setPickable(m,F)},setColorOnly:function(F){Sr.setColorOnly(m,F)},setTransform:function(F,G){Sr.setTransform(m,F,G)},setOverpaint:function(F){return Sr.setOverpaint(m,F,D,!0)},setTransparency:function(F){return Sr.setTransparency(m,F,D,!0)},setClipping:function(F){return Sr.setClipping(m,F,D,!0)},destroy:function(){l==null||l(A),m&&(m.state.disposed=!0,m=void 0)},mustRecreate:u}}w({},At.Params);function ty(e,t,r,n,a){var i=0,o=t.webgl,s=new Ln,u=vl(),l=[],c=or.createState(),d,f,p,h,v=Yn.createEmpty();function m(S,_){var A=this;S===void 0&&(S={}),_&&_!==f&&(p=r(t,_),f=_,h||(h=E.getDefaultValues(p)));var T=bC(Object.assign({},h,S),f);return Object.assign(h,S,T),We.create("Creating or updating VolumeRepresentation",function(I){return ce(A,void 0,void 0,function(){var M,O;return de(this,function(D){switch(D.label){case 0:return d?!((O=d.mustRecreate)===null||O===void 0)&&O.call(d,f,h,o)&&(d.destroy(),d=n(u,f,h,o)):d=n(u,f,h,o),M=d.createOrUpdate({webgl:o,runtime:I},v,h,_),M?[4,M]:[3,2];case 1:D.sent(),D.label=2;case 2:return l.length=0,d&&d.renderObject&&l.push(d.renderObject),s.next(i++),[2]}})})})}function g(S,_){return d?d.mark(S,_):!1}function y(S){S.visible!==void 0&&d&&d.setVisibility(S.visible),S.alphaFactor!==void 0&&d&&d.setAlphaFactor(S.alphaFactor),S.pickable!==void 0&&d&&d.setPickable(S.pickable),S.overpaint!==void 0&&d&&d.setOverpaint(S.overpaint),S.transparency!==void 0&&d&&d.setTransparency(S.transparency),S.transform!==void 0&&d&&d.setTransform(S.transform),or.updateState(c,S)}function b(S){v=S}function x(){d&&d.destroy()}return{label:e,get groupCount(){return d?d.groupCount:0},get props(){return h},get params(){return p},get state(){return c},get theme(){return v},renderObjects:l,updated:s,createOrUpdate:m,setState:y,setTheme:b,getLoci:function(S){return S===void 0?a(f,h):d?d.getLoci(S):Or},mark:g,destroy:x}}var ry=C.set,FL=C.normalize,kL=C.sub,BL=C.addScalar,ny=C.scale,LL=C.toArray;function ow(e,t,r,n){var a=!1;if(Ct.isLoci(e)){if(!Ct.areEquivalent(e.volume,t))return!1;n(Ie.ofLength(t.grid.cells.data.length))&&(a=!0)}else if(Ct.Isosurface.isLoci(e)){if(!Ct.areEquivalent(e.volume,t))return!1;if(r){if(!Ct.IsoValue.areSame(e.isoValue,r,t.grid.stats))return!1;n(Ie.ofLength(t.grid.cells.data.length))&&(a=!0)}else for(var i=t.grid,o=i.stats,s=i.cells.data,u=o.sigma,l=Ct.IsoValue.toAbsolute(e.isoValue,o).absoluteValue,c=0,d=s.length;c<d;++c)cn(l,s[c],u)&&n(Ie.ofSingleton(c))&&(a=!0)}else if(Ct.Cell.isLoci(e)){if(!Ct.areEquivalent(e.volume,t))return!1;Ie.is(e.indices)?n(e.indices)&&(a=!0):ke.forEach(e.indices,function(f){n(Ie.ofSingleton(f))&&(a=!0)})}return a}function Wv(e,t){t===void 0&&(t=0);var r=e[0]*e[1]*e[2],n=Math.sqrt(r),a=Math.pow(2,Math.ceil(Math.log(n)/Math.log(2))),i=e[0]+t,o=e[1]+t,s=1,u=i;return a<i*e[2]?(u=Math.floor(a/i),s=Math.ceil(e[2]/u),i*=u,o*=s):i*=e[2],{width:i,height:o,columns:u,rows:s,powerOfTwoSize:o<a?a:a*2}}function NL(e,t,r){r===void 0&&(r=0);for(var n=e.grid,a=n.cells,i=a.space,o=a.data,s=n.stats,u=s.max,l=s.min,c=i.dimensions,d=i.dataOffset,f=Wv(c,r),p=f.width,h=f.height,v=t==="data"?1:4,m=new Uint8Array(p*h*v),g={array:m,width:p,height:h},y=u-l,b=c[0],x=c[1],S=c[2],_=b+r,A=x+r,T=C(),I=C(),M=b-1,O=x-1,D=S-1,F=0;F<S;++F)for(var G=0;G<x;++G)for(var N=0;N<b;++N){var z=Math.floor(F*_%p/_),$=Math.floor(F*_/p),j=z*_+N,Z=v*($*A*p+G*p+j),q=d(N,G,F);t==="data"?m[Z]=Math.round((o[q]-l)/y*255):(t==="groups"?Fv(q,m,Z):(ry(T,o[d(Math.max(0,N-1),G,F)],o[d(N,Math.max(0,G-1),F)],o[d(N,G,Math.max(0,F-1))]),ry(I,o[d(Math.min(M,N+1),G,F)],o[d(N,Math.min(O,G+1),F)],o[d(N,G,Math.min(D,F+1))]),FL(T,kL(T,T,I)),BL(T,ny(T,T,.5),.5),LL(ny(T,T,255),m,Z)),m[Z+3]=Math.round((o[q]-l)/y*255))}return g}function Uxe(e){for(var t=e.grid,r=t.cells,n=r.space,a=r.data,i=t.stats,o=i.max,s=i.min,u=n.dimensions,l=u[0],c=u[1],d=u[2],f=n.dataOffset,p=new Uint8Array(l*c*d*4),h={array:p,width:l,height:c,depth:d},v=o-s,m=C(),g=C(),y=l-1,b=c-1,x=d-1,S=0,_=0;_<d;++_)for(var A=0;A<c;++A)for(var T=0;T<l;++T){var I=f(T,A,_);ry(m,a[f(Math.max(0,T-1),A,_)],a[f(T,Math.max(0,A-1),_)],a[f(T,A,Math.max(0,_-1))]),ry(g,a[f(Math.min(y,T+1),A,_)],a[f(T,Math.min(b,A+1),_)],a[f(T,A,Math.min(x,_+1))]),FL(m,kL(m,m,g)),BL(m,ny(m,m,.5),.5),LL(ny(m,m,255),p,S),p[S+3]=Math.round((a[I]-s)/v*255),S+=4}return h}var zxe=`
precision highp float;
precision highp int;

#if __VERSION__ == 100
    precision highp sampler2D;
    uniform sampler2D tTexture;
#else
    precision highp isampler2D;
    uniform isampler2D tTexture;
#endif

void main(void) {
    #if __VERSION__ == 100
        gl_FragColor = texture2D(tTexture, vec2(0.5));
    #else
        gl_FragColor = ivec4(texture2D(tTexture, vec2(0.5)).r);
    #endif
}
`,Vxe=w(w({},Ua),{tTexture:ur("texture","rgba","float","nearest")}),So="histopyramid-sum";function Hxe(e,t){if(e.namedComputeRenderables[So]){var r=e.namedComputeRenderables[So].values;k.update(r.tTexture,t),e.namedComputeRenderables[So].update()}else e.namedComputeRenderables[So]=Gxe(e,t);return e.namedComputeRenderables[So]}function Gxe(e,t){var r=w(w({},za),{tTexture:k.create(t)}),n=w({},Vxe),a=_n("sum",Di,zxe,{},{0:"ivec4"}),i=Ca(e,"triangles",a,n,r);return xa(i,r)}function qxe(e){var t=e.gl,r=e.state;r.disable(t.CULL_FACE),r.disable(t.BLEND),r.disable(t.DEPTH_TEST),r.disable(t.SCISSOR_TEST),r.depthMask(!1),r.colorMask(!0,!0,!0,!0),r.clearColor(0,0,0,0)}var e0=new Uint8Array(4),GI=new Int32Array(4);function jxe(e,t){var r=e.gl,n=e.resources,a=Hxe(e,t);e.state.currentRenderItemId=-1,e.namedFramebuffers[So]||(e.namedFramebuffers[So]=n.framebuffer());var i=e.namedFramebuffers[So];e.namedTextures[So]||(e.namedTextures[So]=_r(r)?n.texture("image-int32","rgba","int","nearest"):n.texture("image-uint8","rgba","ubyte","nearest"),e.namedTextures[So].define(1,1));var o=e.namedTextures[So];return o.attachFramebuffer(i,0),qxe(e),r.viewport(0,0,1,1),a.render(),r.finish(),e.readPixels(0,0,1,1,_r(r)?GI:e0),e.unbindFramebuffer(),_r(r)?GI[0]:h3(e0[0],e0[1],e0[2])}var Wxe=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tInputLevel;

// previous level used to evaluate the new level
#if __VERSION__ == 100
    uniform sampler2D tPreviousLevel;
#else
    precision highp isampler2D;
    uniform isampler2D tPreviousLevel;
#endif

// inverted size of the previous level texture.
uniform float uSize;
uniform float uTexSize;
uniform bool uFirst;

#include common

void main(void) {
    float k = 0.5 * uSize;
    vec2 position = floor((gl_FragCoord.xy / uTexSize) / uSize) * uSize;

    #if __VERSION__ == 100
        float a, b, c, d;

        if (uFirst) {
            a = texture2D(tInputLevel, position).r * 255.0;
            b = texture2D(tInputLevel, position + vec2(k, 0.0)).r * 255.0;
            c = texture2D(tInputLevel, position + vec2(0.0, k)).r * 255.0;
            d = texture2D(tInputLevel, position + vec2(k, k)).r * 255.0;
        } else {
            a = decodeFloatRGB(texture2D(tPreviousLevel, position).rgb);
            b = decodeFloatRGB(texture2D(tPreviousLevel, position + vec2(k, 0.0)).rgb);
            c = decodeFloatRGB(texture2D(tPreviousLevel, position + vec2(0.0, k)).rgb);
            d = decodeFloatRGB(texture2D(tPreviousLevel, position + vec2(k, k)).rgb);
        }
        gl_FragColor = vec4(encodeFloatRGB(a + b + c + d), 1.0);
    #else
        int a, b, c, d;

        if (uFirst) {
            a = int(texture2D(tInputLevel, position).r * 255.0);
            b = int(texture2D(tInputLevel, position + vec2(k, 0.0)).r * 255.0);
            c = int(texture2D(tInputLevel, position + vec2(0.0, k)).r * 255.0);
            d = int(texture2D(tInputLevel, position + vec2(k, k)).r * 255.0);
        } else {
            a = texture2D(tPreviousLevel, position).r;
            b = texture2D(tPreviousLevel, position + vec2(k, 0.0)).r;
            c = texture2D(tPreviousLevel, position + vec2(0.0, k)).r;
            d = texture2D(tPreviousLevel, position + vec2(k, k)).r;
        }
        gl_FragColor = ivec4(a + b + c + d);
    #endif
}
`,Xxe=w(w({},Ua),{tInputLevel:ur("texture","rgba","float","nearest"),tPreviousLevel:ur("texture","rgba","float","nearest"),uSize:qe("f"),uTexSize:qe("f"),uFirst:qe("b")}),ud="histogram-pyramid";function Yxe(e,t,r){if(e.namedComputeRenderables[ud]){var n=e.namedComputeRenderables[ud].values;k.update(n.tInputLevel,t),k.update(n.tPreviousLevel,r),e.namedComputeRenderables[ud].update()}else e.namedComputeRenderables[ud]=Kxe(e,t,r);return e.namedComputeRenderables[ud]}function Kxe(e,t,r){var n=w(w({},za),{tInputLevel:k.create(t),tPreviousLevel:k.create(r),uSize:k.create(0),uTexSize:k.create(0),uFirst:k.create(!0)}),a=w({},Xxe),i=_n("reduction",Di,Wxe,{},{0:"ivec4"}),o=Ca(e,"triangles",i,a,n);return xa(o,n)}var qI=[];function $xe(e,t){var r=qI[t],n=Math.pow(2,t);if(r===void 0){var a=e.isWebGL2?ay("level"+t,e,"image-int32","alpha","int","nearest"):ay("level"+t,e,"image-uint8","rgba","ubyte","nearest");a.define(n,n);var i=UL("level"+t,e);a.attachFramebuffer(i,0),r={texture:a,framebuffer:i},qI[t]=r}return r}function Qxe(e){var t=e.gl,r=e.state;r.disable(t.CULL_FACE),r.disable(t.BLEND),r.disable(t.DEPTH_TEST),r.enable(t.SCISSOR_TEST),r.depthMask(!1),r.colorMask(!0,!0,!0,!0),r.clearColor(0,0,0,0)}function UL(e,t){var r=ud+"-"+e;return t.namedFramebuffers[r]||(t.namedFramebuffers[r]=t.resources.framebuffer()),t.namedFramebuffers[r]}function ay(e,t,r,n,a,i){var o=ud+"-"+e;return t.namedTextures[o]||(t.namedTextures[o]=t.resources.texture(r,n,a,i)),t.namedTextures[o]}function Zxe(e,t,r,n){var a=e.gl,i=t.getWidth(),o=t.getHeight();if(i!==o||!GH(i))throw new Error("inputTexture must be of square power-of-two size");var s=Math.ceil(Math.log(i)/Math.log(2)),u=Math.pow(2,s),l=Math.pow(2,s),c=Math.pow(2,s-1),d=e.isWebGL2?ay("pyramid",e,"image-int32","alpha","int","nearest"):ay("pyramid",e,"image-uint8","rgba","ubyte","nearest");d.define(l,c);var f=UL("pyramid",e);d.attachFramebuffer(f,0),a.viewport(0,0,l,c),_r(a)?a.clearBufferiv(a.COLOR,0,[0,0,0,0]):a.clear(a.COLOR_BUFFER_BIT);for(var p=[],h=0;h<s;++h)p.push($xe(e,h));var v=Yxe(e,t,p[0].texture);e.state.currentRenderItemId=-1,Qxe(e);for(var m=0,h=0;h<s;h++){var g=s-1-h,y=p[g];y.framebuffer.bind();var b=Math.pow(2,g);k.update(v.values.uSize,Math.pow(2,h+1)/u),k.update(v.values.uTexSize,b),k.updateIfChanged(v.values.uFirst,h===0),h>0&&(k.update(v.values.tPreviousLevel,p[s-h].texture),v.update()),e.state.currentRenderItemId=-1,a.viewport(0,0,b,b),a.scissor(0,0,b,b),_r(a)?a.clearBufferiv(a.COLOR,0,[0,0,0,0]):a.clear(a.COLOR_BUFFER_BIT),a.scissor(0,0,n[0],n[1]),v.render(),d.bind(0),a.copyTexSubImage2D(a.TEXTURE_2D,0,m,0,0,0,b,b),d.unbind(0),m+=b}a.finish();var x=Math.max(1,jxe(e,p[0].texture)),S=Math.ceil(x/Math.pow(2,s));return{pyramidTex:d,count:x,height:S,levels:s,scale:r}}var uh;function Jxe(){if(uh!==void 0)return uh;uh=Na(16*16,1,Uint8Array);for(var e=uh.array,t=0,r=ap.length;t<r;++t)e[t]=ap[t].length/3;return uh}var lh;function eCe(){if(lh!==void 0)return lh;lh=Na(64*64,1,Uint8Array);for(var e=lh.array,t=0,r=ap.length;t<r;++t)for(var n=0;n<16;++n)n<ap[t].length?e[t*16+n]=ap[t][n]:e[t*16+n]=255;return lh}var tCe=`
precision highp float;
precision highp int;
precision highp sampler2D;

#if __VERSION__ == 100
    uniform sampler2D tActiveVoxelsPyramid;
#else
    precision highp isampler2D;
    uniform isampler2D tActiveVoxelsPyramid;
#endif

uniform sampler2D tActiveVoxelsBase;
uniform sampler2D tVolumeData;
uniform sampler2D tTriIndices;

uniform float uIsoValue;
uniform float uLevels;
uniform float uSize;
uniform float uCount;
uniform bool uInvert;

uniform vec3 uGridDim;
uniform vec3 uGridTexDim;
uniform mat4 uGridTransform;

// scale to volume data coord
uniform vec2 uScale;

#include common

// cube corners (excluding origin)
const vec3 c1 = vec3(1., 0., 0.);
const vec3 c2 = vec3(1., 1., 0.);
const vec3 c3 = vec3(0., 1., 0.);
const vec3 c4 = vec3(0., 0., 1.);
const vec3 c5 = vec3(1., 0., 1.);
const vec3 c6 = vec3(1., 1., 1.);
const vec3 c7 = vec3(0., 1., 1.);

vec3 index3dFrom2d(vec2 coord) {
    vec2 gridTexPos = coord * uGridTexDim.xy;
    vec2 columnRow = ivec2Div(gridTexPos, uGridDim.xy);
    vec2 posXY = gridTexPos - columnRow * uGridDim.xy;
    float posZ = columnRow.y * intDiv(uGridTexDim.x, uGridDim.x) + columnRow.x;
    return vec3(posXY, posZ);
}

vec4 texture3dFrom2dNearest(sampler2D tex, vec3 pos, vec3 gridDim, vec2 texDim) {
    float zSlice = floor(pos.z * gridDim.z + 0.5); // round to nearest z-slice
    float column = intDiv(intMod(zSlice * gridDim.x, texDim.x), gridDim.x);
    float row = intDiv(zSlice * gridDim.x, texDim.x);
    vec2 coord = (vec2(column * gridDim.x, row * gridDim.y) + (pos.xy * gridDim.xy)) / (texDim / uScale);
    return texture2D(tex, coord + 0.5 / (texDim / uScale));
}

vec4 voxel(vec3 pos) {
    pos = min(max(vec3(0.0), pos), uGridDim - vec3(1.0));
    return texture3dFrom2dNearest(tVolumeData, pos / uGridDim, uGridDim, uGridTexDim.xy);
}

vec4 voxelPadded(vec3 pos) {
    pos = min(max(vec3(0.0), pos), uGridDim - vec3(vec2(2.0), 1.0)); // remove xy padding
    return texture3dFrom2dNearest(tVolumeData, pos / uGridDim, uGridDim, uGridTexDim.xy);
}

int idot2(const in ivec2 a, const in ivec2 b) {
    return a.x * b.x + a.y * b.y;
}

int idot4(const in ivec4 a, const in ivec4 b) {
    return a.x * b.x + a.y * b.y + a.z * b.z + a.w * b.w;
}

#if __VERSION__ == 100
    int pyramidVoxel(vec2 pos) {
        return int(decodeFloatRGB(texture2D(tActiveVoxelsPyramid, pos / (vec2(1.0, 0.5) * uSize)).rgb));
    }
#else
    int pyramidVoxel(vec2 pos) {
        return texture2D(tActiveVoxelsPyramid, pos / (vec2(1.0, 0.5) * uSize)).r;
    }
#endif

vec4 baseVoxel(vec2 pos) {
    return texture2D(tActiveVoxelsBase, pos / uSize);
}

void main(void) {
    // get 1D index
    int vI = int(gl_FragCoord.x) + int(gl_FragCoord.y) * int(uSize);

    // ignore 1D indices outside of the grid
    if(vI >= int(uCount)) discard;

    ivec2 offset = ivec2(int(uSize) - 2, 0);

    int start = 0;
    ivec4 starts = ivec4(0);
    ivec4 ends = ivec4(0);
    int diff = 2;
    ivec4 m = ivec4(0);
    ivec2 position = ivec2(0);
    ivec4 vI4 = ivec4(vI);

    ivec2 relativePosition = ivec2(0);
    int end = 0;
    ivec2 pos1 = ivec2(0);
    ivec2 pos2 = ivec2(0);
    ivec2 pos3 = ivec2(0);
    ivec2 pos4 = ivec2(0);
    ivec3 vI3 = ivec3(vI);
    ivec3 mask = ivec3(0);

    // traverse the different levels of the pyramid
    for(int i = 1; i < 14; i++) {
        if(float(i) >= uLevels) break;

        offset.x -= diff;
        diff *= 2;
        relativePosition = position + offset;

        end = start + pyramidVoxel(vec2(relativePosition));
        pos1 = ivec2(relativePosition);
        starts.x = start;
        ends.x = end;
        pos2 = ivec2(relativePosition + ivec2(1, 0));
        starts.y = ends.x;
        ends.y = ends.x + pyramidVoxel(vec2(pos2));
        pos3 = relativePosition + ivec2(0, 1);
        starts.z = ends.y;
        ends.z = ends.y + pyramidVoxel(vec2(pos3));
        pos4 = relativePosition + ivec2(1, 1);
        starts.w = ends.z;
        mask = ivec3(greaterThanEqual(vI3, starts.rgb)) * ivec3(lessThan(vI3, ends.rgb));
        m = ivec4(mask, 1 - int(any(bvec3(mask))));

        relativePosition = m.x * pos1 + m.y * pos2 + m.z * pos3 + m.w * pos4;
        start = idot4(m, starts);
        position = 2 * (relativePosition - offset);
    }

    end = start + int(baseVoxel(vec2(position)).r * 255.0);
    pos1 = position;
    starts.x = start;
    ends.x = end;
    pos2 = position + ivec2(1, 0);
    starts.y = ends.x;
    ends.y = ends.x + int(baseVoxel(vec2(pos2)).r * 255.0);
    pos3 = position + ivec2(0, 1);
    starts.z = ends.y;
    ends.z = ends.y + int(baseVoxel(vec2(pos3)).r * 255.0);
    pos4 = position + ivec2(1, 1);
    starts.w = ends.z;
    mask = ivec3(greaterThanEqual(vI3, starts.rgb)) * ivec3(lessThan(vI3, ends.rgb));
    m = ivec4(mask, 1 - int(any(bvec3(mask))));
    position = m.x * pos1 + m.y * pos2 + m.z * pos3 + m.w * pos4;

    vec2 coord2d = (vec2(position) / uSize) / uScale;
    vec3 coord3d = floor(index3dFrom2d(coord2d) + 0.5);

    float edgeIndex = floor(baseVoxel(vec2(position)).a * 255.0 + 0.5);

    // current vertex for the up to 15 MC cases
    int currentVertex = vI - idot4(m, starts);

    // ensure winding-order is the same for negative and positive iso-levels
    if (uInvert) {
        int v = imod(currentVertex + 1, 3);
        if (v == 1) currentVertex += 2;
        else if (v == 0) currentVertex -= 2;
    }

    // get index into triIndices table
    int mcIndex = 16 * int(edgeIndex) + currentVertex;
    vec4 mcData = texture2D(tTriIndices, vec2(imod(mcIndex, 64), mcIndex / 64) / 64.);

    // bit mask to avoid conditionals (see comment below) for getting MC case corner
    vec4 m0 = vec4(floor(mcData.a * 255.0 + 0.5));

    // get edge value masks
    vec4 m1 = vec4(equal(m0, vec4(0., 1., 2., 3.)));
    vec4 m2 = vec4(equal(m0, vec4(4., 5., 6., 7.)));
    vec4 m3 = vec4(equal(m0, vec4(8., 9., 10., 11.)));

    // apply bit masks
    vec3 b0 = coord3d +
                m1.y * c1 +
                m1.z * c2 +
                m1.w * c3 +
                m2.x * c4 +
                m2.y * c5 +
                m2.z * c6 +
                m2.w * c7 +
                m3.y * c1 +
                m3.z * c2 +
                m3.w * c3;
    vec3 b1 = coord3d +
                m1.x * c1 +
                m1.y * c2 +
                m1.z * c3 +
                m2.x * c5 +
                m2.y * c6 +
                m2.z * c7 +
                m2.w * c4 +
                m3.x * c4 +
                m3.y * c5 +
                m3.z * c6 +
                m3.w * c7;

    // the conditionals that are avoided by above bitmasks
    // vec3 b0 = coord3d;
    // vec3 b1 = coord3d;
    // if (mcIndex == 0.0) {
    //     b1 += c1;
    // } else if (mcIndex == 1.0) {
    //     b0 += c1; b1 += c2;
    // } else if (mcIndex == 2.0) {
    //     b0 += c2; b1 += c3;
    // } else if (mcIndex == 3.0) {
    //     b0 += c3;
    // } else if (mcIndex == 4.0) {
    //     b0 += c4; b1 += c5;
    // } else if (mcIndex == 5.0) {
    //     b0 += c5; b1 += c6;
    // } else if (mcIndex == 6.0) {
    //     b0 += c6; b1 += c7;
    // } else if (mcIndex == 7.0) {
    //     b0 += c7; b1 += c4;
    // } else if (mcIndex == 8.0) {
    //     b1 += c4;
    // } else if (mcIndex == 9.0) {
    //     b0 += c1; b1 += c5;
    // } else if (mcIndex == 10.0) {
    //     b0 += c2; b1 += c6;
    // } else if (mcIndex == 11.0) {
    //     b0 += c3; b1 += c7;
    // }
    // b0 = floor(b0 + 0.5);
    // b1 = floor(b1 + 0.5);

    vec4 d0 = voxel(b0);
    vec4 d1 = voxel(b1);

    float v0 = d0.a;
    float v1 = d1.a;

    float t = (uIsoValue - v0) / (v0 - v1);
    gl_FragData[0].xyz = (uGridTransform * vec4(b0 + t * (b0 - b1), 1.0)).xyz;

    // group id
    #if __VERSION__ == 100
        // webgl1 does not support 'flat' interpolation (i.e. no interpolation)
        // so we ensure a constant group id per triangle here
        #ifdef dPackedGroup
            gl_FragData[1] = vec4(voxel(coord3d).rgb, 1.0);
        #else
            vec3 gridDim = uGridDim - vec3(1.0, 1.0, 0.0); // remove xy padding
            float group = coord3d.z + coord3d.y * gridDim.z + coord3d.x * gridDim.z * gridDim.y;
            gl_FragData[1] = vec4(group > 16777215.5 ? vec3(1.0) : encodeFloatRGB(group), 1.0);
        #endif
    #else
        #ifdef dPackedGroup
            gl_FragData[1] = vec4(t < 0.5 ? d0.rgb : d1.rgb, 1.0);
        #else
            vec3 b = t < 0.5 ? b0 : b1;
            vec3 gridDim = uGridDim - vec3(1.0, 1.0, 0.0); // remove xy padding
            float group = b.z + b.y * gridDim.z + b.x * gridDim.z * gridDim.y;
            gl_FragData[1] = vec4(group > 16777215.5 ? vec3(1.0) : encodeFloatRGB(group), 1.0);
        #endif
    #endif

    // normals from gradients
    vec3 n0 = -normalize(vec3(
        voxelPadded(b0 - c1).a - voxelPadded(b0 + c1).a,
        voxelPadded(b0 - c3).a - voxelPadded(b0 + c3).a,
        voxelPadded(b0 - c4).a - voxelPadded(b0 + c4).a
    ));
    vec3 n1 = -normalize(vec3(
        voxelPadded(b1 - c1).a - voxelPadded(b1 + c1).a,
        voxelPadded(b1 - c3).a - voxelPadded(b1 + c3).a,
        voxelPadded(b1 - c4).a - voxelPadded(b1 + c4).a
    ));
    gl_FragData[2].xyz = -vec3(
        n0.x + t * (n0.x - n1.x),
        n0.y + t * (n0.y - n1.y),
        n0.z + t * (n0.z - n1.z)
    );

    // ensure normal-direction is the same for negative and positive iso-levels
    if (uInvert) {
        gl_FragData[2].xyz *= -1.0;
    }

    // apply normal matrix
    gl_FragData[2].xyz *= transpose3(inverse3(mat3(uGridTransform)));
}
`,rCe=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tTriCount;
uniform sampler2D tVolumeData;

uniform float uIsoValue;
uniform vec3 uGridDim;
uniform vec3 uGridTexDim;
uniform vec2 uScale;

#include common

// cube corners (excluding origin)
const vec3 c1 = vec3(1., 0., 0.);
const vec3 c2 = vec3(1., 1., 0.);
const vec3 c3 = vec3(0., 1., 0.);
const vec3 c4 = vec3(0., 0., 1.);
const vec3 c5 = vec3(1., 0., 1.);
const vec3 c6 = vec3(1., 1., 1.);
const vec3 c7 = vec3(0., 1., 1.);

vec3 index3dFrom2d(vec2 coord) {
    vec2 gridTexPos = coord * uGridTexDim.xy;
    vec2 columnRow = ivec2Div(gridTexPos, uGridDim.xy);
    vec2 posXY = gridTexPos - columnRow * uGridDim.xy;
    float posZ = columnRow.y * intDiv(uGridTexDim.x, uGridDim.x) + columnRow.x;
    return vec3(posXY, posZ);
}

vec4 texture3dFrom2dNearest(sampler2D tex, vec3 pos, vec3 gridDim, vec2 texDim) {
    float zSlice = floor(pos.z * gridDim.z + 0.5); // round to nearest z-slice
    float column = intDiv(intMod(zSlice * gridDim.x, texDim.x), gridDim.x);
    float row = intDiv(zSlice * gridDim.x, texDim.x);
    vec2 coord = (vec2(column * gridDim.x, row * gridDim.y) + (pos.xy * gridDim.xy)) / (texDim / uScale);
    return texture2D(tex, coord);
}

vec4 voxel(vec3 pos) {
    pos = min(max(vec3(0.0), pos), uGridDim - vec3(1.0));
    return texture3dFrom2dNearest(tVolumeData, pos / uGridDim, uGridDim, uGridTexDim.xy);
}

void main(void) {
    vec2 uv = gl_FragCoord.xy / uGridTexDim.xy;
    vec3 posXYZ = index3dFrom2d(uv);

    // get MC case as the sum of corners that are below the given iso level
    float c = step(voxel(posXYZ).a, uIsoValue)
        + 2. * step(voxel(posXYZ + c1).a, uIsoValue)
        + 4. * step(voxel(posXYZ + c2).a, uIsoValue)
        + 8. * step(voxel(posXYZ + c3).a, uIsoValue)
        + 16. * step(voxel(posXYZ + c4).a, uIsoValue)
        + 32. * step(voxel(posXYZ + c5).a, uIsoValue)
        + 64. * step(voxel(posXYZ + c6).a, uIsoValue)
        + 128. * step(voxel(posXYZ + c7).a, uIsoValue);
    c *= step(c, 254.);

    // handle out of bounds positions
    posXYZ += 1.0;
    posXYZ.xy += 1.0; // pixel padding (usually ok even if the texture has no padding)
    if (posXYZ.x >= uGridDim.x || posXYZ.y >= uGridDim.y || posXYZ.z >= uGridDim.z)
        c = 0.0;

    // get total triangles to generate for calculated MC case from triCount texture
    float totalTrianglesToGenerate = texture2D(tTriCount, vec2(intMod(c, 16.), floor(c / 16.)) / 16.).a;
    gl_FragColor = vec4(vec3(totalTrianglesToGenerate * 3.0), c / 255.0);
}
`,nCe=w(w({},Ua),{tTriCount:ur("image-uint8","alpha","ubyte","nearest"),tVolumeData:ur("texture","rgba","ubyte","nearest"),uIsoValue:qe("f"),uGridDim:qe("v3"),uGridTexDim:qe("v3"),uScale:qe("v2")}),Wo="active-voxels";function aCe(e,t,r,n,a,i){if(e.namedComputeRenderables[Wo]){var o=e.namedComputeRenderables[Wo].values;k.update(o.uQuadScale,i),k.update(o.tVolumeData,t),k.updateIfChanged(o.uIsoValue,a),k.update(o.uGridDim,r),k.update(o.uGridTexDim,n),k.update(o.uScale,i),e.namedComputeRenderables[Wo].update()}else e.namedComputeRenderables[Wo]=iCe(e,t,r,n,a,i);return e.namedComputeRenderables[Wo]}function iCe(e,t,r,n,a,i){var o=w(w({},za),{tTriCount:k.create(Jxe()),uQuadScale:k.create(i),tVolumeData:k.create(t),uIsoValue:k.create(a),uGridDim:k.create(r),uGridTexDim:k.create(n),uScale:k.create(i)}),s=w({},nCe),u=_n("active-voxels",Di,rCe),l=Ca(e,"triangles",u,s,o);return xa(l,o)}function oCe(e){var t=e.gl,r=e.state;r.disable(t.CULL_FACE),r.disable(t.BLEND),r.disable(t.DEPTH_TEST),r.enable(t.SCISSOR_TEST),r.depthMask(!1),r.colorMask(!0,!0,!0,!0),r.clearColor(0,0,0,0)}function sCe(e,t,r,n,a,i){var o=e.gl,s=e.resources,u=t.getWidth(),l=t.getHeight();e.namedFramebuffers[Wo]||(e.namedFramebuffers[Wo]=s.framebuffer());var c=e.namedFramebuffers[Wo];c.bind(),e.namedTextures[Wo]||(e.namedTextures[Wo]=s.texture("image-uint8","rgba","ubyte","nearest"));var d=e.namedTextures[Wo];d.define(u,l);var f=aCe(e,t,r,n,a,i);return e.state.currentRenderItemId=-1,d.attachFramebuffer(c,0),oCe(e),o.viewport(0,0,u,l),o.scissor(0,0,u,l),o.clear(o.COLOR_BUFFER_BIT),o.scissor(0,0,n[0],n[1]),f.render(),o.finish(),d}var uCe=w(w({},Ua),{tTriIndices:ur("image-uint8","alpha","ubyte","nearest"),tActiveVoxelsPyramid:ur("texture","rgba","float","nearest"),tActiveVoxelsBase:ur("texture","rgba","float","nearest"),tVolumeData:ur("texture","rgba","ubyte","nearest"),uIsoValue:qe("f"),uSize:qe("f"),uLevels:qe("f"),uCount:qe("f"),uInvert:qe("b"),uGridDim:qe("v3"),uGridTexDim:qe("v3"),uGridTransform:qe("m4"),uScale:qe("v2"),dPackedGroup:$t("boolean")}),$l="isosurface";function lCe(e,t,r,n,a,i,o,s,u,l,c,d,f){if(e.namedComputeRenderables[$l]){var p=e.namedComputeRenderables[$l].values;k.update(p.tActiveVoxelsPyramid,t),k.update(p.tActiveVoxelsBase,r),k.update(p.tVolumeData,n),k.updateIfChanged(p.uIsoValue,s),k.updateIfChanged(p.uSize,Math.pow(2,u)),k.updateIfChanged(p.uLevels,u),k.updateIfChanged(p.uCount,c),k.updateIfChanged(p.uInvert,d),k.update(p.uGridDim,a),k.update(p.uGridTexDim,i),k.update(p.uGridTransform,o),k.update(p.uScale,l),k.update(p.dPackedGroup,f),e.namedComputeRenderables[$l].update()}else e.namedComputeRenderables[$l]=cCe(e,t,r,n,a,i,o,s,u,l,c,d,f);return e.namedComputeRenderables[$l]}function cCe(e,t,r,n,a,i,o,s,u,l,c,d,f){var p=w(w({},za),{tTriIndices:k.create(eCe()),tActiveVoxelsPyramid:k.create(t),tActiveVoxelsBase:k.create(r),tVolumeData:k.create(n),uIsoValue:k.create(s),uSize:k.create(Math.pow(2,u)),uLevels:k.create(u),uCount:k.create(c),uInvert:k.create(d),uGridDim:k.create(a),uGridTexDim:k.create(i),uGridTransform:k.create(o),uScale:k.create(l),dPackedGroup:k.create(f)}),h=w({},uCe),v=_n("isosurface",Di,tCe,{drawBuffers:"required"}),m=Ca(e,"triangles",v,h,p);return xa(m,p)}function dCe(e){var t=e.gl,r=e.state;r.disable(t.CULL_FACE),r.disable(t.BLEND),r.disable(t.DEPTH_TEST),r.disable(t.SCISSOR_TEST),r.depthMask(!1),r.colorMask(!0,!0,!0,!0),r.clearColor(0,0,0,0)}function fCe(e,t,r,n,a,i,o,s,u,l,c,d,f){var p=e.gl,h=e.resources,v=e.extensions,m=n.pyramidTex,g=n.height,y=n.levels,b=n.scale,x=n.count,S=m.getWidth();e.namedFramebuffers[$l]||(e.namedFramebuffers[$l]=h.framebuffer());var _=e.namedFramebuffers[$l];_r(p)?(c||(c=v.colorBufferHalfFloat&&v.textureHalfFloat?h.texture("image-float16","rgba","fp16","nearest"):h.texture("image-float32","rgba","float","nearest")),d||(d=h.texture("image-uint8","rgba","ubyte","nearest")),f||(f=v.colorBufferHalfFloat&&v.textureHalfFloat?h.texture("image-float16","rgba","fp16","nearest"):h.texture("image-float32","rgba","float","nearest"))):(c||(c=h.texture("image-float32","rgba","float","nearest")),d||(d=h.texture("image-float32","rgba","float","nearest")),f||(f=h.texture("image-float32","rgba","float","nearest"))),c.define(S,g),d.define(S,g),f.define(S,g),c.attachFramebuffer(_,0),d.attachFramebuffer(_,1),f.attachFramebuffer(_,2);var A=lCe(e,m,t,r,a,i,o,s,y,b,x,u,l);e.state.currentRenderItemId=-1;var T=e.extensions.drawBuffers;if(!T)throw new Error("need WebGL draw buffers");return _.bind(),T.drawBuffers([T.COLOR_ATTACHMENT0,T.COLOR_ATTACHMENT1,T.COLOR_ATTACHMENT2]),dCe(e),p.viewport(0,0,S,g),p.clear(p.COLOR_BUFFER_BIT),A.render(),p.finish(),{vertexTexture:c,groupTexture:d,normalTexture:f,vertexCount:x}}function sw(e,t,r,n,a,i,o,s,u,l,c,d){var f=sCe(e,t,r,n,o,a),p=Zxe(e,f,a,n),h=fCe(e,f,t,p,r,n,i,o,s,u,l,c,d);return h}var zL={isoValue:Ct.IsoValueParam};function pCe(e){return e.extensions.colorBufferFloat&&e.extensions.textureFloat&&e.extensions.drawBuffers}var Rh=1;function uw(e,t){var r=e.grid.cells.space.dimensions,n=Wv(r,Rh).powerOfTwoSize;return n<=t.maxTextureSize/2}function hCe(e,t,r,n){return r.tryUseGpu&&n&&pCe(n)&&uw(t,n)?yCe(e):mCe(e)}function jI(e,t){return Ct.Isosurface.Loci(e,t.isoValue)}function lw(e,t,r,n){var a=e.objectId,i=e.groupId;return n===a?Ct.Cell.Loci(t,Ie.ofSingleton(i)):Or}function cw(e,t,r,n){return ow(e,t,r.isoValue,n)}function vCe(e,t,r,n,a){return ce(this,void 0,void 0,function(){var i,o,s;return de(this,function(u){switch(u.label){case 0:return e.runtime.update({message:"Marching cubes..."}),i=Mo(new Int32Array(t.grid.cells.data.length)),[4,w1({isoLevel:Ct.IsoValue.toAbsolute(n.isoValue,t.grid.stats).absoluteValue,scalarField:t.grid.cells,idField:Pr.create(t.grid.cells.space,Pr.Data1(i))},a).runAsChild(e.runtime)];case 1:return o=u.sent(),s=qa.getGridToCartesianTransform(t.grid),Lt.transform(o,s),e.webgl&&!e.webgl.isWebGL2&&Lt.uniformTriangleGroup(o,!1),o.setBoundingSphere(Ct.getBoundingSphere(t)),[2,o]}})})}var dw=w(w(w(w({},Lt.Params),ps.Params),zL),{quality:w(w({},Lt.Params.quality),{isEssential:!1}),tryUseGpu:E.Boolean(!0)});function mCe(e){return jv({defaultProps:E.getDefaultValues(dw),createGeometry:vCe,createLocationIterator:function(t){return pn(t.grid.cells.data.length,1,1,function(){return $i})},getLoci:lw,eachLocation:cw,setUpdateState:function(t,r,n,a){Ct.IsoValue.areSame(n.isoValue,a.isoValue,r.grid.stats)||(t.createGeometry=!0)},geometryUtils:Lt.Utils,mustRecreate:function(t,r,n){return r.tryUseGpu&&!!n&&uw(t,n)}},e)}var WC;(function(e){var t="volume-isosurface-texture";e.descriptor=Pi({name:t});function r(n,a){var i=a.resources,o=qa.getGridToCartesianTransform(n.grid),s=C.clone(n.grid.cells.space.dimensions),u=Wv(s,Rh),l=u.width,c=u.height,d=u.powerOfTwoSize,f=C.create(l,c,0),p=Ge.create(l/d,c/d);if(d>a.maxTextureSize/2)throw new Error("volume too large for gpu isosurface extraction");if(!n._propertyData[t]){n._propertyData[t]=i.texture("image-uint8","alpha","ubyte","linear");var h=n._propertyData[t];h.define(d,d),h.load(NL(n,"data",Rh),!0),n.customProperties.add(e.descriptor),n.customProperties.assets(e.descriptor,[{dispose:function(){return h.destroy()}}])}return s[0]+=Rh,s[1]+=Rh,{texture:n._propertyData[t],transform:o,gridDimension:s,gridTexDim:f,gridTexScale:p}}e.get=r})(WC||(WC={}));function gCe(e,t,r,n,a){return ce(this,void 0,void 0,function(){var i,o,s,u,l,c,d,f,p,h,v,m,g,y,b;return de(this,function(x){if(!e.webgl)throw new Error("webgl context required to create volume isosurface texture-mesh");return i=t.grid.stats,o=i.max,s=i.min,u=o-s,l=Ct.IsoValue.toAbsolute(n.isoValue,t.grid.stats).absoluteValue,c=(l-s)/u,d=WC.get(t,e.webgl),f=d.texture,p=d.gridDimension,h=d.gridTexDim,v=d.gridTexScale,m=d.transform,g=a==null?void 0:a.doubleBuffer.get(),y=sw(e.webgl,f,p,h,v,m,c,l<0,!1,g==null?void 0:g.vertex,g==null?void 0:g.group,g==null?void 0:g.normal),b=ps.create(y.vertexCount,1,y.vertexTexture,y.groupTexture,y.normalTexture,Ct.getBoundingSphere(t),a),[2,b]})})}function yCe(e){return jv({defaultProps:E.getDefaultValues(dw),createGeometry:gCe,createLocationIterator:function(t){return pn(t.grid.cells.data.length,1,1,function(){return $i})},getLoci:lw,eachLocation:cw,setUpdateState:function(t,r,n,a){Ct.IsoValue.areSame(n.isoValue,a.isoValue,r.grid.stats)||(t.createGeometry=!0)},geometryUtils:ps.Utils,mustRecreate:function(t,r,n){return!r.tryUseGpu||!n||!uw(t,n)},dispose:function(t){t.vertexTexture.ref.value.destroy(),t.groupTexture.ref.value.destroy(),t.normalTexture.ref.value.destroy(),t.doubleBuffer.destroy()}},e)}function bCe(e,t,r,n,a){return ce(this,void 0,void 0,function(){var i,o,s;return de(this,function(u){switch(u.label){case 0:return e.runtime.update({message:"Marching cubes..."}),i=Mo(new Int32Array(t.grid.cells.data.length)),[4,iw({isoLevel:Ct.IsoValue.toAbsolute(n.isoValue,t.grid.stats).absoluteValue,scalarField:t.grid.cells,idField:Pr.create(t.grid.cells.space,Pr.Data1(i))},a).runAsChild(e.runtime)];case 1:return o=u.sent(),s=qa.getGridToCartesianTransform(t.grid),mn.transform(o,s),o.setBoundingSphere(Ct.getBoundingSphere(t)),[2,o]}})})}var VL=w(w(w({},mn.Params),zL),{quality:w(w({},mn.Params.quality),{isEssential:!1}),sizeFactor:E.Numeric(3,{min:0,max:10,step:.1})});function SCe(e){return jv({defaultProps:E.getDefaultValues(VL),createGeometry:bCe,createLocationIterator:function(t){return pn(t.grid.cells.data.length,1,1,function(){return $i})},getLoci:lw,eachLocation:cw,setUpdateState:function(t,r,n,a){Ct.IsoValue.areSame(n.isoValue,a.isoValue,r.grid.stats)||(t.createGeometry=!0)},geometryUtils:mn.Utils},e)}var HL={solid:function(e,t){return ty("Isosurface mesh",e,t,hCe,jI)},wireframe:function(e,t){return ty("Isosurface wireframe",e,t,SCe,jI)}},GL=w(w(w({},dw),VL),{visuals:E.MultiSelect(["solid"],E.objectToOptions(HL))});function xCe(e,t){var r=E.clone(GL);return r.isoValue=Ct.createIsoValueParam(Ct.IsoValue.relative(2),t.grid.stats),r}function CCe(e,t){return or.createMulti("Isosurface",e,t,or.StateBuilder,HL)}var _Ce={name:"isosurface",label:"Isosurface",description:"Displays a triangulated isosurface of volumetric data.",factory:CCe,getParams:xCe,defaultValues:E.getDefaultValues(GL),defaultColorTheme:{name:"uniform"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return!Ct.isEmpty(e)}};function wCe(e,t,r,n,a){return ce(this,void 0,void 0,function(){var i,o,s,u,l,c,d,f,p,h,v,m,g,y,b,x,S,_,A,T,I,M,O,D,F,G,N,z,$,j,Z,q,te,he,W,K,U,H;return de(this,function(J){for(i=n.dimension.name,o=n.isoValue,s=t.grid.cells,u=s.space,l=s.data,c=t.grid.stats,d=c.min,f=c.max,p=Ct.IsoValue.toAbsolute(o,t.grid.stats).absoluteValue,h=r.color.color($i,!1),v=it.toRgbNormalized(h),m=v[0],g=v[1],y=v[2],b=fw(t.grid,n),x=b.width,S=b.height,_=b.x,A=b.y,T=b.z,I=b.x0,M=b.y0,O=b.z0,D=b.nx,F=b.ny,G=b.nz,N=new Float32Array(i==="x"?[_,0,0,_,A,0,_,0,T,_,A,T]:i==="y"?[0,A,0,_,A,0,0,A,T,_,A,T]:[0,0,T,0,A,T,_,0,T,_,A,T]),z=new Uint8Array(x*S*4),$=ACe(t.grid,n),j=0,Z=M;Z<F;++Z)for(q=I;q<D;++q)for(te=O;te<G;++te)he=u.get(l,q,Z,te),W=(he-d)/(f-d),z[j]=m*W*2*255,z[j+1]=g*W*2*255,z[j+2]=y*W*2*255,z[j+3]=he>=p?255:0,j+=4;return K={width:x,height:S,array:z,flipY:!0},U={width:x,height:S,array:$,flipY:!0},H=qa.getGridToCartesianTransform(t.grid),Nd(H,N,0,4),[2,ju.create(K,N,U,a)]})})}function fw(e,t){var r=t.dimension,n=r.name,a=r.params,i=e.cells.space,o,s,u,l,c,d=0,f=0,p=0,h=i.dimensions,v=h[0],m=h[1],g=h[2];return n==="x"?(u=a,l=m-1,c=g-1,o=g,s=m,d=u,v=d+1):n==="y"?(u=v-1,l=a,c=g-1,o=g,s=v,f=l,m=f+1):(u=v-1,l=m-1,c=a,o=v,s=m,p=c,g=p+1),{width:o,height:s,x:u,y:l,z:c,x0:d,y0:f,z0:p,nx:v,ny:m,nz:g}}function ACe(e,t){for(var r=e.cells.space,n=fw(e,t),a=n.width,i=n.height,o=n.x0,s=n.y0,u=n.z0,l=n.nx,c=n.ny,d=n.nz,f=new Uint8Array(a*i*4),p=0,h=s;h<c;++h)for(var v=o;v<l;++v)for(var m=u;m<d;++m)Fv(r.dataOffset(v,h,m),f,p),p+=4;return f}function PCe(e,t){for(var r=e.cells.space,n=fw(e,t),a=n.width,i=n.height,o=n.x0,s=n.y0,u=n.z0,l=n.nx,c=n.ny,d=n.nz,f=new Uint32Array(a*i),p=0,h=s;h<c;++h)for(var v=o;v<l;++v)for(var m=u;m<d;++m)f[p]=r.dataOffset(v,h,m),p+=1;return f}function TCe(e,t){var r=PCe(e.grid,t);return Ct.Cell.Loci(e,Je.ofUnsortedArray(r))}function ECe(e,t,r,n){var a=e.objectId,i=e.groupId;return n===a?Ct.Cell.Loci(t,Ie.ofSingleton(i)):Or}function ICe(e,t,r,n){return ow(e,t,void 0,n)}var pw=w(w({},ju.Params),{quality:w(w({},ju.Params.quality),{isEssential:!1}),dimension:E.MappedStatic("x",{x:E.Numeric(0,{min:0,max:0,step:1}),y:E.Numeric(0,{min:0,max:0,step:1}),z:E.Numeric(0,{min:0,max:0,step:1})},{isEssential:!0}),isoValue:Ct.IsoValueParam});function MCe(e,t){var r=E.clone(pw),n=t.grid.cells.space.dimensions;return r.dimension=E.MappedStatic("x",{x:E.Numeric(0,{min:0,max:n[0]-1,step:1}),y:E.Numeric(0,{min:0,max:n[1]-1,step:1}),z:E.Numeric(0,{min:0,max:n[2]-1,step:1})},{isEssential:!0}),r.isoValue=Ct.createIsoValueParam(Ct.IsoValue.absolute(t.grid.stats.min),t.grid.stats),r}function DCe(e){return jv({defaultProps:E.getDefaultValues(pw),createGeometry:wCe,createLocationIterator:function(t){return pn(t.grid.cells.data.length,1,1,function(){return $i})},getLoci:ECe,eachLocation:ICe,setUpdateState:function(t,r,n,a,i,o){t.createGeometry=n.dimension.name!==a.dimension.name||n.dimension.params!==a.dimension.params||!Ct.IsoValue.areSame(n.isoValue,a.isoValue,r.grid.stats)||!Wu.areEqual(i.color,o.color)},geometryUtils:w(w({},ju.Utils),{createRenderableState:function(t){var r=ju.Utils.createRenderableState(t);return WI(r,t),r},updateRenderableState:WI})},e)}function WI(e,t){ju.Utils.updateRenderableState(e,t),e.opaque=!1,e.writeDepth=!0}function RCe(e,t){return ty("Slice",e,t,DCe,TCe)}var OCe={name:"slice",label:"Slice",description:"Slice of volume rendered as image with interpolation.",factory:RCe,getParams:MCe,defaultValues:E.getDefaultValues(pw),defaultColorTheme:{name:"uniform"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return!Ct.isEmpty(e)}};function qL(e,t){var r=Xt();return Xt.add(r,e),Xt.transform(r,r,t),r}function FCe(e,t,r,n){var a=r.grid.cells.space.dimensions,i=Wv(a),o=i.width,s=i.height;if(Math.max(o,s)>t.maxTextureSize/2)throw new Error("volume too large for direct-volume rendering");var u=NL(r,"normals"),l=qa.getGridToCartesianTransform(r.grid),c=qL(a,l),d=n?n.gridTexture.ref.value:t.resources.texture("image-uint8","rgba","ubyte","linear");d.load(u);var f=jL(r.grid),p=f.unitToCartn,h=f.cellDim;return di.create(c,a,l,p,h,d,r.grid.stats,!1,n)}function jL(e){if(e.transform.kind==="matrix")return{unitToCartn:ue.mul(ue(),e.transform.matrix,ue.fromScaling(ue(),e.cells.space.dimensions)),cellDim:ue.getScaling(C(),e.transform.matrix)};var t=e.transform.fractionalBox,r=Xt.size(C(),t);return{unitToCartn:ue.mul3(ue(),e.transform.cell.fromFractional,ue.fromTranslation(ue(),t.min),ue.fromScaling(ue(),r)),cellDim:C.div(C(),e.transform.cell.size,e.cells.space.dimensions)}}function kCe(e,t,r,n){var a=r.grid.cells.space.dimensions;if(Math.max.apply(Math,a)>t.max3dTextureSize/2)throw new Error("volume too large for direct-volume rendering");var i=Uxe(r),o=qa.getGridToCartesianTransform(r.grid),s=qL(a,o),u=n?n.gridTexture.ref.value:t.resources.texture("volume-uint8","rgba","ubyte","linear");u.load(i);var l=jL(r.grid),c=l.unitToCartn,d=l.cellDim;return di.create(s,a,o,c,d,u,r.grid.stats,!1,n)}function BCe(e,t,r,n,a){return ce(this,void 0,void 0,function(){var i,o;return de(this,function(s){if(i=e.runtime,o=e.webgl,o===void 0)throw new Error("DirectVolumeVisual requires `webgl` in props");return[2,o.isWebGL2?kCe(i,o,t,a):FCe(i,o,t,a)]})})}function LCe(e,t){return t.renderMode.name==="isosurface"?Ct.Isosurface.Loci(e,t.renderMode.params.isoValue):Ct.Loci(e)}function NCe(e,t,r,n){var a=e.objectId,i=e.groupId;return n===a?Ct.Cell.Loci(t,Ie.ofSingleton(i)):Or}function UCe(e,t,r,n){var a=r.renderMode.name==="isosurface"?r.renderMode.params.isoValue:void 0;return ow(e,t,a,n)}var hw=w(w({},di.Params),{quality:w(w({},di.Params.quality),{isEssential:!1})});function zCe(e,t){var r=E.clone(hw);return r.renderMode=di.createRenderModeParam(t.grid.stats),r}function VCe(e){return jv({defaultProps:E.getDefaultValues(hw),createGeometry:BCe,createLocationIterator:function(t){return pn(t.grid.cells.data.length,1,1,function(){return $i})},getLoci:NCe,eachLocation:UCe,setUpdateState:function(t,r,n,a){},geometryUtils:di.Utils,dispose:function(t){t.gridTexture.ref.value.destroy()}},e)}function HCe(e,t){return ty("Direct Volume",e,t,VCe,LCe)}var GCe={name:"direct-volume",label:"Direct Volume",description:"Direct rendering of volumetric data.",factory:HCe,getParams:zCe,defaultValues:E.getDefaultValues(hw),defaultColorTheme:{name:"uniform"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return!Ct.isEmpty(e)}},iy=function(e){Be(t,e);function t(){var r=e.call(this)||this;return cs(t.BuiltIn,function(n,a){if(n.name!==a)throw new Error("Fix BuiltInVolumeRepresentations to have matching names. "+n.name+" "+a);r.add(n)}),r}return t}(xk);(function(e){e.BuiltIn={isosurface:_Ce,slice:OCe,"direct-volume":GCe}})(iy||(iy={}));function XI(e,t,r,n){e.push({source:t==="em"?{name:"em",params:{isoValue:Ct.IsoValue.absolute(n||0)}}:{name:"x-ray",params:{}},dataId:r})}var XC=Ai.build({display:{name:"Volume Streaming"},from:ge.Molecule.Structure,params:function(e,t){var r=Axe(e&&e.data),n=Exe(r,e&&e.data);return{method:E.Select(r,[["em","EM"],["x-ray","X-Ray"]]),entries:E.ObjectList({id:E.Text(n[0]||"")},function(a){var i=a.id;return i},{defaultValue:n.map(function(a){return{id:a}})}),defaultView:E.Select(r==="em"?"cell":"selection-box",Qa.ViewTypeOptions),options:E.Group({serverUrl:E.Text(t.config.get(jr.VolumeStreaming.DefaultServer)||"https://ds.litemol.org"),behaviorRef:E.Text("",{isHidden:!0}),emContourProvider:E.Select("emdb",[["emdb","EMDB"],["pdbe","PDBe"]],{isHidden:!0}),channelParams:E.Value({},{isHidden:!0})})}},isApplicable:function(e,t,r){var n=r.config.get(jr.VolumeStreaming.CanStream);return n?n(e.data,r):e.data.models.length===1&&jt.probablyHasDensityMap(e.data.models[0])}})(function(e,t){var r=e.ref,n=e.state,a=e.params;return We.create("Volume Streaming",function(i){return ce(void 0,void 0,void 0,function(){var o,s,u,l,c,d,f,p,h,v,m,g,y,b,x,S,_;return de(this,function(A){switch(A.label){case 0:o=[],s=0,u=a.entries.length,A.label=1;case 1:return s<u?(l=a.entries[s].id.toLowerCase(),c=void 0,a.method!=="em"?[3,14]:l.toUpperCase().startsWith("EMD")?[3,11]:[4,i.update("Getting EMDB info...")]):[3,16];case 2:return A.sent(),[4,Dxe(t,i,l)];case 3:d=A.sent(),f=0,p=d.length,A.label=4;case 4:if(!(f<p))return[3,10];h=d[f],v=void 0,A.label=5;case 5:return A.trys.push([5,7,,8]),[4,HI(a.options.emContourProvider,t,i,h)];case 6:return v=A.sent(),[3,8];case 7:return m=A.sent(),console.info("Could not get map info for "+h+": "+m),[3,9];case 8:XI(o,a.method,h,v||0),A.label=9;case 9:return++f,[3,4];case 10:return[3,15];case 11:return A.trys.push([11,13,,14]),[4,HI(a.options.emContourProvider,t,i,l)];case 12:return c=A.sent(),[3,14];case 13:return g=A.sent(),console.info("Could not get map info for "+l+": "+g),[3,15];case 14:XI(o,a.method,l,c||0),A.label=15;case 15:return++s,[3,1];case 16:return y=n.build().to(r).applyOrUpdateTagged(Qa.RootTag,WCe,{serverUrl:a.options.serverUrl,entries:o}),[4,y.commit()];case 17:return A.sent(),b=y.selector,b.isOk?(x=n.tree.children.get(b.ref),(x==null?void 0:x.size)>0?[4,t.managers.structure.hierarchy.remove(x==null?void 0:x.toArray())]:[3,19]):[2];case 18:A.sent(),A.label=19;case 19:return S=b.cell.obj,_=n.build().to(y.ref).apply(vw,E.getDefaultValues(Qa.createParams({data:S.data,defaultView:a.defaultView,channelParams:a.options.channelParams})),{ref:a.options.behaviorRef?a.options.behaviorRef:void 0}),a.method==="em"?_.apply(t0,{channel:"em"},{state:{isGhost:!0},tags:"em"}):(_.apply(t0,{channel:"2fo-fc"},{state:{isGhost:!0},tags:"2fo-fc"}),_.apply(t0,{channel:"fo-fc(+ve)"},{state:{isGhost:!0},tags:"fo-fc(+ve)"}),_.apply(t0,{channel:"fo-fc(-ve)"},{state:{isGhost:!0},tags:"fo-fc(-ve)"})),[4,n.updateTree(_).runInContext(i)];case 20:return A.sent(),[2]}})})})}),qCe=Ai.build({display:{name:"Boxify Volume Streaming",description:"Make the current box permanent."},from:Qa,isApplicable:function(e){return e.data.params.entry.params.view.name==="selection-box"}})(function(e,t){var r=e.a,n=e.ref,a=e.state,i=r.data.params;if(i.entry.params.view.name==="selection-box"){var o=Xt.create(C.clone(i.entry.params.view.params.bottomLeft),C.clone(i.entry.params.view.params.topRight)),s=i.entry.params.view.params.radius;Xt.expand(o,o,C.create(s,s,s));var u=w(w({},i),{entry:{name:i.entry.name,params:w(w({},i.entry.params),{view:{name:"box",params:{bottomLeft:o.min,topRight:o.max}}})}});return a.updateTree(a.build().to(n).update(u))}}),jCe={dataId:E.Text(""),source:E.MappedStatic("x-ray",{em:E.Group({isoValue:Ct.createIsoValueParam(Ct.IsoValue.relative(1))}),"x-ray":E.Group({})})},WCe=Ot.BuiltIn({name:"create-volume-streaming-info",display:{name:"Volume Streaming Info"},from:ge.Molecule.Structure,to:jC,params:function(e){return{serverUrl:E.Text("https://ds.litemol.org"),entries:E.ObjectList(jCe,function(t){var r=t.dataId;return r},{defaultValue:[{dataId:"",source:{name:"x-ray",params:{}}}]})}}})({apply:function(e,t){var r=e.a,n=e.params;return We.create("",function(a){return ce(void 0,void 0,void 0,function(){var i,o,s,u,l,c,d,f;return de(this,function(p){switch(p.label){case 0:i=[],o=0,s=n.entries.length,p.label=1;case 1:return o<s?(u=n.entries[o],l=u.dataId,c=u.source.name==="em"?u.source.params.isoValue:Ct.IsoValue.relative(1),[4,a.update("Getting server header...")]):[3,5];case 2:return p.sent(),[4,t.fetch({url:S1(n.serverUrl,u.source.name+"/"+l.toLocaleLowerCase()),type:"json"}).runInContext(a)];case 3:d=p.sent(),i.push({dataId:l,kind:u.source.name,header:d,emDefaultContourLevel:c}),p.label=4;case 4:return++o,[3,1];case 5:return f={serverUrl:n.serverUrl,entries:i,structure:r.data},[2,new jC(f,{label:"Volume Server",description:""+i.map(function(h){return h.dataId}).join(", ")})]}})})})}}),vw=Ot.BuiltIn({name:"create-volume-streaming-behavior",display:{name:"Volume Streaming Behavior"},from:jC,to:Qa,params:function(e){return Qa.createParams({data:e&&e.data})}})({canAutoUpdate:function(e){var t=e.oldParams,r=e.newParams;return t.entry.params.view===r.entry.params.view||r.entry.params.view.name==="selection-box"||r.entry.params.view.name==="off"},apply:function(e,t){var r=e.a,n=e.params;return We.create("Volume streaming",function(a){return ce(void 0,void 0,void 0,function(){var i;return de(this,function(o){switch(o.label){case 0:return i=new Qa.Behavior(t,r.data),[4,i.update(n)];case 1:return o.sent(),[2,new Qa(i,{label:"Volume Streaming",description:i.getDescription()})]}})})})},update:function(e){var t=this;e.a;var r=e.b,n=e.oldParams,a=e.newParams;return We.create("Update Volume Streaming",function(i){return ce(t,void 0,void 0,function(){var o,s;return de(this,function(u){switch(u.label){case 0:return n.entry.name!==a.entry.name&&"em"in a.entry.params.channels&&(o=r.data.infoMap.get(a.entry.name).emDefaultContourLevel,o&&(a.entry.params.channels.em.isoValue=o)),[4,r.data.update(a)];case 1:return s=u.sent()?ft.UpdateResult.Updated:ft.UpdateResult.Unchanged,r.description=r.data.getDescription(),[2,s]}})})})}}),t0=Ot.BuiltIn({name:"create-volume-streaming-visual",display:{name:"Volume Streaming Visual"},from:Qa,to:ge.Volume.Representation3D,params:{channel:E.Select("em",Qa.ChannelTypeOptions,{isHidden:!0})}})({apply:function(e,t){var r=e.a,n=e.params,a=e.spine;return We.create("Volume Representation",function(i){return ce(void 0,void 0,void 0,function(){var o,s,u,l,c,d,f,p,h;return de(this,function(v){switch(v.label){case 0:return o=r.data.channels[n.channel],o?(s=YI(r.data,n.channel),u=iy.BuiltIn.isosurface,l=s.type.params||{},c=u.factory(w({webgl:(p=t.canvas3d)===null||p===void 0?void 0:p.webgl},t.representation.volume.themes),u.getParams),c.setTheme(Yn.create(t.representation.volume.themes,{volume:o.data},s)),d=(h=a.getAncestorOfType(ge.Molecule.Structure))===null||h===void 0?void 0:h.data,f=(d==null?void 0:d.models.length)===0?void 0:Sd.get(d==null?void 0:d.models[0]),[4,c.createOrUpdate(l,o.data).runInContext(i)]):[2,Cn.Null];case 1:return v.sent(),f&&c.setState({transform:f}),[2,new ge.Volume.Representation3D({repr:c,sourceData:o.data},{label:Math.round(o.isoValue.relativeValue*100)/100+" \u03C3 ["+n.channel+"]"})]}})})})},update:function(e,t){var r=e.a,n=e.b,a=e.newParams;return e.spine,We.create("Volume Representation",function(i){return ce(void 0,void 0,void 0,function(){var o,s,u,l;return de(this,function(c){switch(c.label){case 0:return o=r.data.channels[a.channel],o?(s=n.data.repr.state.visible,u=YI(r.data,a.channel),l=w(w({},n.data.repr.props),u.type.params),n.data.repr.setTheme(Yn.create(t.representation.volume.themes,{volume:o.data},u)),[4,n.data.repr.createOrUpdate(l,o.data).runInContext(i)]):[2,ft.UpdateResult.Unchanged];case 1:return c.sent(),n.data.repr.setState({visible:s}),n.data.sourceData=o.data,[2,ft.UpdateResult.Updated]}})})})}});function YI(e,t){var r=e.channels[t];return Ou.getDefaultParamsStatic(e.plugin,"isosurface",{isoValue:r.isoValue,alpha:r.opacity,visuals:r.wireframe?["wireframe"]:["solid"]},"uniform",{value:r.color})}var mw=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r._getInfo=bc(function(n,a){return qd.infoFromAction(r.plugin,r.props.state,r.props.action,r.props.nodeRef)}),r.state={plugin:r.plugin,ref:r.props.nodeRef,version:r.props.state.transforms.get(r.props.nodeRef).version,error:void 0,isInitial:!0,params:r.getInfo().initialValues,busy:!1,isCollapsed:r.props.initiallyCollapsed},r}return t.prototype.applyAction=function(){return wt.State.ApplyAction(this.plugin,{state:this.props.state,action:this.props.action.create(this.state.params),ref:this.props.nodeRef})},t.prototype.getInfo=function(){return this._getInfo(this.props.nodeRef,this.props.state.transforms.get(this.props.nodeRef).version)},t.prototype.getTransformerId=function(){return this.props.state.transforms.get(this.props.nodeRef).transformer.id},t.prototype.getHeader=function(){return this.props.hideHeader?"none":this.props.action.definition.display},t.prototype.canApply=function(){return!this.state.error&&!this.state.busy},t.prototype.canAutoApply=function(){return!1},t.prototype.applyText=function(){return"Apply"},t.prototype.isUpdate=function(){return!1},t.prototype.getSourceAndTarget=function(){return{a:this.props.state.cells.get(this.props.nodeRef).obj}},t.getDerivedStateFromProps=function(r,n){var a=r.state.transforms.get(r.nodeRef).version;if(r.nodeRef===n.ref&&a===n.version)return null;var i=r.state.cells.get(r.nodeRef).obj,o=r.action.definition.params?E.getDefaultValues(r.action.definition.params(i,n.plugin)):{},s={plugin:n.plugin,ref:r.nodeRef,version:a,params:o,isInitial:!0,error:void 0};return s},t}(_L),XCe=function(e){Be(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.defaultState=function(){return{header:"Volume Streaming",isCollapsed:!1,isBusy:!1,isHidden:!0,brand:{accent:"cyan",svg:mR}}},t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,function(){r.setState({isHidden:!r.canEnable(),description:Pv.getSelectedStructuresDescription(r.plugin)})}),this.subscribe(this.plugin.state.events.cell.stateUpdated,function(n){cr.hasTag(n.cell.transform,Qa.RootTag)&&r.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){r.setState({isBusy:n})})},Object.defineProperty(t.prototype,"pivot",{get:function(){return this.plugin.managers.structure.hierarchy.selection.structures[0]},enumerable:!1,configurable:!0}),t.prototype.canEnable=function(){var r,n,a=this.plugin.managers.structure.hierarchy.selection;if(a.structures.length!==1)return!1;var i=this.pivot.cell;return i.obj?!!(!((n=(r=XC.definition).isApplicable)===null||n===void 0)&&n.call(r,i.obj,i.transform,this.plugin)):!1},t.prototype.renderEnable=function(){var r,n=this.pivot;if(!n.cell.parent)return null;var a=ar.findTagInSubtree(n.cell.parent.tree,this.pivot.cell.transform.ref,Qa.RootTag),i=a&&n.cell.parent.cells.get(a),o=i&&i.status==="error"?{header:"Error enabling",icon:q4,title:i.errorText}:i&&((r=i.obj)===null||r===void 0?void 0:r.data.entries.length)===0?{header:"Error enabling",icon:q4,title:"No entry for streaming found"}:{header:"Enable",icon:wp,title:"Enable"};return L(mw,{state:n.cell.parent,action:XC,initiallyCollapsed:!0,nodeRef:n.cell.transform.ref,simpleApply:o},void 0)},t.prototype.renderParams=function(){var r,n,a,i,o,s=this.pivot;if(!s.cell.parent)return null;var u=((n=(r=s.volumeStreaming)===null||r===void 0?void 0:r.cell.transform.params)===null||n===void 0?void 0:n.entry.params.view.name)==="selection-box"&&((o=(i=(a=this.plugin.state.behaviors.cells.get(C1.id))===null||a===void 0?void 0:a.params)===null||i===void 0?void 0:i.values)===null||o===void 0?void 0:o.bindings);return Te(Rt,{children:[L(Zu,{state:s.cell.parent,transform:s.volumeStreaming.cell.transform,customHeader:"none",noMargin:!0},void 0),u&&L(ls,w({header:"Controls Help"},{children:L(qC,{bindings:u},void 0)}),void 0)]},void 0)},t.prototype.renderControls=function(){var r=this.pivot;return r?r.volumeStreaming?this.renderParams():this.renderEnable():null},t}(Ap),YCe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.item=function(n){var a,i=r.plugin.managers.volume.hierarchy.selection,o=((a=n.cell.obj)===null||a===void 0?void 0:a.label)||"Volume",s={kind:"item",label:(n.kind==="lazy-volume"?"Load ":"")+(o||n.kind),selected:i===n,value:n};return s},r.selectCurrent=function(n){if(r.toggleHierarchy(),!!n){var a=n.value;a.kind==="volume"?r.plugin.managers.volume.hierarchy.setCurrent(a):r.lazyLoad(a.cell)}},r.selectAdd=function(n){!n||(r.setState({show:void 0}),n.value())},r.toggleHierarchy=function(){return r.setState({show:r.state.show!=="hierarchy"?"hierarchy":void 0})},r.toggleAddRepr=function(){return r.setState({show:r.state.show!=="add-repr"?"add-repr":void 0})},r}return t.prototype.defaultState=function(){return{header:"Volume",isCollapsed:!1,isBusy:!1,isHidden:!0,brand:{accent:"purple",svg:mR}}},t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.volume.hierarchy.behaviors.selection,function(n){r.setState({isHidden:n.hierarchy.volumes.length===0&&n.hierarchy.lazyVolumes.length===0})}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){r.setState({isBusy:n})})},Object.defineProperty(t.prototype,"hierarchyItems",{get:function(){for(var r=this.plugin.managers.volume.hierarchy,n=r.current,a=[],i=0,o=n.volumes;i<o.length;i++){var s=o[i];a.push(this.item(s))}for(var u=0,l=n.lazyVolumes;u<l.length;u++){var s=l[u];a.push(this.item(s))}return a},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"addActions",{get:function(){var r=this.plugin.managers.volume.hierarchy,n=r.selection,a=Nt([],ey.getRepresentationTypes(this.plugin,n).map(function(i){return Jt.Item(i[1],function(){return r.addRepresentation(n,i[0])})}));return a},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isEmpty",{get:function(){var r=this.plugin.managers.volume.hierarchy.current,n=r.volumes,a=r.lazyVolumes;return n.length===0&&a.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"label",{get:function(){var r;if(this.state.loadingLabel)return"Loading "+this.state.loadingLabel+"...";var n=this.plugin.managers.volume.hierarchy.selection;return n?((r=n==null?void 0:n.cell.obj)===null||r===void 0?void 0:r.label)||"Volume":"Nothing Selected"},enumerable:!1,configurable:!0}),t.prototype.lazyLoad=function(r){return ce(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c=this;return de(this,function(d){switch(d.label){case 0:n=r.obj.data,a=n.url,i=n.isBinary,o=n.format,s=n.entryId,u=n.isovalues,this.setState({isBusy:!0,loadingLabel:r.obj.label}),d.label=1;case 1:return d.trys.push([1,,3,4]),l=this.plugin,[4,l.dataTransaction(function(){return ce(c,void 0,void 0,function(){var f,p,h,v,m,g,y,b,x,S,_;return de(this,function(A){switch(A.label){case 0:return[4,l.builders.data.download({url:a,isBinary:i},{state:{isGhost:!0}})];case 1:return f=A.sent(),[4,l.dataFormats.get(o).parse(l,f,{entryId:s})];case 2:if(p=A.sent(),h=p.volume||p.volumes[0],!(h!=null&&h.isOk))throw new Error("Failed to parse any volume.");for(v=l.build(),m=0,g=u;m<g.length;m++)y=g[m],v.to((S=(b=p.volumes)===null||b===void 0?void 0:b[(x=y.volumeIndex)!==null&&x!==void 0?x:0])!==null&&S!==void 0?S:p.volume).apply(rt.Representation.VolumeRepresentation3D,np(this.plugin,h.data,{type:"isosurface",typeParams:{alpha:(_=y.alpha)!==null&&_!==void 0?_:1,isoValue:y.type==="absolute"?{kind:"absolute",absoluteValue:y.value}:{kind:"relative",relativeValue:y.value}},color:"uniform",colorParams:{value:y.color}}));return[4,v.commit()];case 3:return A.sent(),[4,l.build().delete(r).commit()];case 4:return A.sent(),[2]}})})})];case 2:return d.sent(),[3,4];case 3:return this.setState({isBusy:!1,loadingLabel:void 0}),[7];case 4:return[2]}})})},t.prototype.renderControls=function(){var r=this.state.isBusy||this.isEmpty,n=this.label,a=this.plugin.managers.volume.hierarchy.selection;return Te(Rt,{children:[Te("div",w({className:"msp-flex-row",style:{marginTop:"1px"}},{children:[L(pr,w({noOverflow:!0,flex:!0,onClick:this.toggleHierarchy,disabled:r,title:n},{children:n}),void 0),!this.isEmpty&&a&&L(Gt,{svg:_p,onClick:this.toggleAddRepr,title:"Apply a structure presets to the current hierarchy.",toggleState:this.state.show==="add-repr",disabled:r},void 0)]}),void 0),this.state.show==="hierarchy"&&L(Jt,{items:this.hierarchyItems,onSelect:this.selectCurrent},void 0),this.state.show==="add-repr"&&L(Jt,{items:this.addActions,onSelect:this.selectAdd},void 0),a&&a.representations.length>0&&L("div",w({style:{marginTop:"6px"}},{children:a.representations.map(function(i){return L(KCe,{representation:i},i.cell.transform.ref)})}),void 0)]},void 0)},t}(Ap),KCe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={action:void 0},r.remove=function(){return r.plugin.managers.volume.hierarchy.remove([r.props.representation],!0)},r.toggleVisible=function(n){n.preventDefault(),n.currentTarget.blur(),r.plugin.managers.volume.hierarchy.toggleVisibility([r.props.representation])},r.toggleUpdate=function(){return r.setState({action:r.state.action==="update"?void 0:"update"})},r.highlight=function(n){n.preventDefault(),r.props.representation.cell.parent&&wt.Interactivity.Object.Highlight(r.plugin,{state:r.props.representation.cell.parent,ref:r.props.representation.cell.transform.ref})},r.clearHighlight=function(n){n.preventDefault(),wt.Interactivity.ClearHighlights(r.plugin)},r.focus=function(){var n,a=r.props.representation,i=(n=r.props.representation.cell.obj)===null||n===void 0?void 0:n.data.repr.renderObjects;a.cell.state.isHidden&&r.plugin.managers.volume.hierarchy.toggleVisibility([r.props.representation],"show"),r.plugin.managers.camera.focusRenderObjects(i,{extraRadius:1})},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.events.cell.stateUpdated,function(n){vc.ObjectEvent.isCell(n,r.props.representation.cell)&&r.forceUpdate()})},t.prototype.render=function(){var r,n,a,i=this.props.representation.cell;return Te(Rt,{children:[Te("div",w({className:"msp-flex-row"},{children:[Te(pr,w({noOverflow:!0,className:"msp-control-button-label",title:((r=i.obj)===null||r===void 0?void 0:r.label)+". Click to focus.",onClick:this.focus,onMouseEnter:this.highlight,onMouseLeave:this.clearHighlight,style:{textAlign:"left"}},{children:[(n=i.obj)===null||n===void 0?void 0:n.label,L("small",w({className:"msp-25-lower-contrast-text",style:{float:"right"}},{children:(a=i.obj)===null||a===void 0?void 0:a.description}),void 0)]}),void 0),L(Gt,{svg:i.state.isHidden?Xd:Yd,toggleState:!1,onClick:this.toggleVisible,title:(i.state.isHidden?"Show":"Hide")+" component",small:!0,className:"msp-form-control",flex:!0},void 0),L(Gt,{svg:Oo,onClick:this.remove,title:"Remove",small:!0},void 0),L(Gt,{svg:Ed,onClick:this.toggleUpdate,title:"Actions",toggleState:this.state.action==="update"},void 0)]}),void 0),this.state.action==="update"&&!!i.parent&&L("div",w({style:{marginBottom:"6px"},className:"msp-accent-offset"},{children:L(Zu,{state:i.parent,transform:i.transform,customHeader:"none",noMargin:!0},void 0)}),void 0)]},void 0)},t}(Sa),oy;(function(e){function t(n){return{size:n,matrix:Ar.create(n,n),eigenValues:new Float64Array(n),D:new Float64Array(n),E:new Float64Array(n)}}e.createCache=t;function r(n){$Ce(n.size,n.matrix.data,n.eigenValues,n.D,n.E)}e.compute=r})(oy||(oy={}));function $Ce(e,t,r,n,a){for(var i=0;i<e;i++)a[i]=0;for(var o=e-1,i=0;i<e;i++)n[i]=t[i*e+o];QCe(t,n,a,e),ZCe(t,n,a,e);for(var i=0;i<e;i++)r[i]=n[i]}function QCe(e,t,r,n){for(var a=n-1;a>0;a--){for(var i=0,o=0,s=0;s<a;s++)i=i+Math.abs(t[s]);if(i===0){r[a]=t[a-1];for(var u=0;u<a;u++)t[u]=e[u*n+a-1],e[u*n+a]=0,e[a*n+u]=0}else{for(var s=0;s<a;s++)t[s]/=i,o+=t[s]*t[s];var l=t[a-1],c=Math.sqrt(o);l>0&&(c=-c),r[a]=i*c,o=o-l*c,t[a-1]=l-c;for(var u=0;u<a;u++)r[u]=0;for(var u=0;u<a;u++){l=t[u],e[a*n+u]=l,c=r[u]+e[u*n+u]*l;for(var s=u+1;s<=a-1;s++)c+=e[u*n+s]*t[s],r[s]+=e[u*n+s]*l;r[u]=c}l=0;for(var u=0;u<a;u++)r[u]/=o,l+=r[u]*t[u];for(var d=l/(o+o),u=0;u<a;u++)r[u]-=d*t[u];for(var u=0;u<a;u++){l=t[u],c=r[u];for(var s=u;s<=a-1;s++)e[u*n+s]-=l*r[s]+c*t[s];t[u]=e[u*n+a-1],e[u*n+a]=0}}t[a]=o}for(var a=0;a<n-1;a++){e[a*n+n-1]=e[a*n+a],e[a*n+a]=1;var o=t[a+1];if(o!==0){for(var s=0;s<=a;s++)t[s]=e[(a+1)*n+s]/o;for(var u=0;u<=a;u++){for(var c=0,s=0;s<=a;s++)c+=e[(a+1)*n+s]*e[u*n+s];for(var s=0;s<=a;s++)e[u*n+s]-=c*t[s]}}for(var s=0;s<=a;s++)e[(a+1)*n+s]=0}for(var u=0;u<n;u++)t[u]=e[u*n+n-1],e[u*n+n-1]=0;e[n*n-1]=1,r[0]=0}function ZCe(e,t,r,n){for(var a=1e3,i=1;i<n;i++)r[i-1]=r[i];r[n-1]=0;for(var o=0,s=0,u=Math.pow(2,-53),l=0;l<n;l++){s=Math.max(s,Math.abs(t[l])+Math.abs(r[l]));for(var c=l;c<n&&!(Math.abs(r[c])<=u*s);)c++;if(c>l){var d=0;do{d=d+1;var f=t[l],p=(t[l+1]-f)/(2*r[l]),h=KI(p,1);p<0&&(h=-h),t[l]=r[l]/(p+h),t[l+1]=r[l]*(p+h);for(var v=t[l+1],m=f-t[l],i=l+2;i<n;i++)t[i]-=m;o=o+m,p=t[c];for(var g=1,y=g,b=g,x=r[l+1],S=0,_=0,i=c-1;i>=l;i--){b=y,y=g,_=S,f=g*r[i],m=g*p,h=KI(p,r[i]),r[i+1]=S*h,S=r[i]/h,g=p/h,p=g*t[i]-S*f,t[i+1]=m+S*(g*f+S*t[i]);for(var A=0;A<n;A++)m=e[(i+1)*n+A],e[(i+1)*n+A]=S*e[i*n+A]+g*m,e[i*n+A]=g*e[i*n+A]-S*m}if(p=-S*_*b*x*r[l]/v,r[l]=S*p,t[l]=g*p,d>=a)throw"SVD: Not converging."}while(Math.abs(r[l])>u*s)}t[l]=t[l]+o,r[l]=0}for(var i=0;i<n-1;i++){for(var A=i,p=t[i],T=i+1;T<n;T++)t[T]<p&&(A=T,p=t[T]);if(A!==i){t[A]=t[i],t[i]=p;for(var T=0;T<n;T++)p=e[i*n+T],e[i*n+T]=e[A*n+T],e[A*n+T]=p}}}function KI(e,t){if(Math.abs(e)>Math.abs(t)){var r=t/e;return Math.abs(e)*Math.sqrt(1+r*r)}if(t!==0){var r=e/t;return Math.abs(t)*Math.sqrt(1+r*r)}return 0}var Ju;(function(e){(function(r){function n(a){return{x:new Float64Array(a),y:new Float64Array(a),z:new Float64Array(a)}}r.empty=n})(e.Positions||(e.Positions={}));function t(r,n){return typeof n=="undefined"&&(n={bTransform:ue.zero(),rmsd:0}),r_e(new JCe(r,n)),n}e.compute=t})(Ju||(Ju={}));var JCe=function(){function e(t,r){this.evdCache=oy.createCache(4),this.translateB=ue.identity(),this.rotateB=ue.identity(),this.tempMatrix=ue.identity(),this.a=t.a,this.b=t.b,t.centerA?this.centerA=t.centerA:this.centerA=t.centerA=qu.fromArrays(t.a,Ne()).center,t.centerB?this.centerB=t.centerB:this.centerB=t.centerB=qu.fromArrays(t.b,Ne()).center,this.result=r}return e}();function e_e(e){var t=e.evdCache.matrix;Ar.makeZero(t);for(var r=e.a.x,n=e.a.y,a=e.a.z,i=e.b.x,o=e.b.y,s=e.b.z,u=e.centerA,l=e.centerB,c=0,d=0,f=e.a.x.length;d<f;d++){var p=r[d]-u[0],h=n[d]-u[1],v=a[d]-u[2],m=i[d]-l[0],g=o[d]-l[1],y=s[d]-l[2];c+=p*p+h*h+v*v+m*m+g*g+y*y,Ar.add(t,0,0,p*m+h*g+v*y),Ar.add(t,0,1,-(v*g)+h*y),Ar.add(t,0,2,v*m-p*y),Ar.add(t,0,3,-(h*m)+p*g),Ar.add(t,1,0,-(v*g)+h*y),Ar.add(t,1,1,p*m-h*g-v*y),Ar.add(t,1,2,h*m+p*g),Ar.add(t,1,3,v*m+p*y),Ar.add(t,2,0,v*m-p*y),Ar.add(t,2,1,h*m+p*g),Ar.add(t,2,2,-(p*m)+h*g-v*y),Ar.add(t,2,3,v*g+h*y),Ar.add(t,3,0,-(h*m)+p*g),Ar.add(t,3,1,v*m+p*y),Ar.add(t,3,2,v*g+h*y),Ar.add(t,3,3,-(p*m)-h*g+v*y)}return c}function t_e(e){var t=e.evdCache.matrix,r=Ar.get(t,1,3),n=Ar.get(t,2,3),a=Ar.get(t,3,3),i=Ar.get(t,0,3),o=2*n*n,s=2*a*a,u=2*r*r,l=2*r*n,c=2*i*a,d=2*r*a,f=2*i*n,p=2*n*a,h=2*i*r,v=e.translateB;ue.setValue(v,0,3,-e.centerB[0]),ue.setValue(v,1,3,-e.centerB[1]),ue.setValue(v,2,3,-e.centerB[2]),v=e.rotateB,ue.setValue(v,0,0,1-o-s),ue.setValue(v,0,1,l+c),ue.setValue(v,0,2,d-f),ue.setValue(v,1,0,l-c),ue.setValue(v,1,1,1-u-s),ue.setValue(v,1,2,p+h),ue.setValue(v,2,0,d+f),ue.setValue(v,2,1,p-h),ue.setValue(v,2,2,1-u-o),ue.setValue(v,3,3,1),ue.mul(e.tempMatrix,e.rotateB,e.translateB),v=e.translateB,ue.setValue(v,0,3,e.centerA[0]),ue.setValue(v,1,3,e.centerA[1]),ue.setValue(v,2,3,e.centerA[2]),ue.mul(e.result.bTransform,e.translateB,e.tempMatrix)}function r_e(e){var t=e_e(e);oy.compute(e.evdCache);var r=t-2*e.evdCache.eigenValues[3];r=r<0?0:Math.sqrt(r/e.a.x.length),t_e(e),e.result.rmsd=r}var n_e="ACDEFGHIKLMNPQRSTVWY",a_e="ARNDCQEGHILKMFPSTWYVBZX",i_e=[[4,0,-2,-1,-2,0,-2,-1,-1,-1,-1,-2,-1,-1,-1,1,0,0,-3,-2],[0,9,-3,-4,-2,-3,-3,-1,-3,-1,-1,-3,-3,-3,-3,-1,-1,-1,-2,-2],[-2,-3,6,2,-3,-1,-1,-3,-1,-4,-3,1,-1,0,-2,0,-1,-3,-4,-3],[-1,-4,2,5,-3,-2,0,-3,1,-3,-2,0,-1,2,0,0,-1,-2,-3,-2],[-2,-2,-3,-3,6,-3,-1,0,-3,0,0,-3,-4,-3,-3,-2,-2,-1,1,3],[0,-3,-1,-2,-3,6,-2,-4,-2,-4,-3,0,-2,-2,-2,0,-2,-3,-2,-3],[-2,-3,-1,0,-1,-2,8,-3,-1,-3,-2,1,-2,0,0,-1,-2,-3,-2,2],[-1,-1,-3,-3,0,-4,-3,4,-3,2,1,-3,-3,-3,-3,-2,-1,3,-3,-1],[-1,-3,-1,1,-3,-2,-1,-3,5,-2,-1,0,-1,1,2,0,-1,-2,-3,-2],[-1,-1,-4,-3,0,-4,-3,2,-2,4,2,-3,-3,-2,-2,-2,-1,1,-2,-1],[-1,-1,-3,-2,0,-3,-2,1,-1,2,5,-2,-2,0,-1,-1,-1,1,-1,-1],[-2,-3,1,0,-3,0,1,-3,0,-3,-2,6,-2,0,0,1,0,-3,-4,-2],[-1,-3,-1,-1,-4,-2,-2,-3,-1,-3,-2,-2,7,-1,-2,-1,-1,-2,-4,-3],[-1,-3,0,2,-3,-2,0,-3,1,-2,0,0,-1,5,1,0,-1,-2,-2,-1],[-1,-3,-2,0,-3,-2,0,-3,2,-2,-1,0,-2,1,5,-1,-1,-3,-3,-2],[1,-1,0,0,-2,0,-1,-2,0,-2,-1,1,-1,0,-1,4,1,-2,-3,-2],[0,-1,-1,-1,-2,-2,-2,-1,-1,-1,-1,0,-1,-1,-1,1,5,0,-2,-2],[0,-1,-3,-2,-1,-3,-3,3,-2,1,1,-3,-2,-2,-3,-2,0,4,-3,-1],[-3,-2,-4,-3,1,-2,-2,-3,-3,-2,-1,-4,-4,-2,-3,-3,-2,-3,11,2],[-2,-2,-3,-2,3,-3,2,-1,-2,-1,-1,-2,-3,-1,-2,-2,-2,-1,2,7]],o_e=[[4,-1,-2,-2,0,-1,-1,0,-2,-1,-1,-1,-1,-2,-1,1,0,-3,-2,0,-2,-1,0],[-1,5,0,-2,-3,1,0,-2,0,-3,-2,2,-1,-3,-2,-1,-1,-3,-2,-3,-1,0,-1],[-2,0,6,1,-3,0,0,0,1,-3,-3,0,-2,-3,-2,1,0,-4,-2,-3,3,0,-1],[-2,-2,1,6,-3,0,2,-1,-1,-3,-4,-1,-3,-3,-1,0,-1,-4,-3,-3,4,1,-1],[0,-3,-3,-3,9,-3,-4,-3,-3,-1,-1,-3,-1,-2,-3,-1,-1,-2,-2,-1,-3,-3,-2],[-1,1,0,0,-3,5,2,-2,0,-3,-2,1,0,-3,-1,0,-1,-2,-1,-2,0,3,-1],[-1,0,0,2,-4,2,5,-2,0,-3,-3,1,-2,-3,-1,0,-1,-3,-2,-2,1,4,-1],[0,-2,0,-1,-3,-2,-2,6,-2,-4,-4,-2,-3,-3,-2,0,-2,-2,-3,-3,-1,-2,-1],[-2,0,1,-1,-3,0,0,-2,8,-3,-3,-1,-2,-1,-2,-1,-2,-2,2,-3,0,0,-1],[-1,-3,-3,-3,-1,-3,-3,-4,-3,4,2,-3,1,0,-3,-2,-1,-3,-1,3,-3,-3,-1],[-1,-2,-3,-4,-1,-2,-3,-4,-3,2,4,-2,2,0,-3,-2,-1,-2,-1,1,-4,-3,-1],[-1,2,0,-1,-3,1,1,-2,-1,-3,-2,5,-1,-3,-1,0,-1,-3,-2,-2,0,1,-1],[-1,-1,-2,-3,-1,0,-2,-3,-2,1,2,-1,5,0,-2,-1,-1,-1,-1,1,-3,-1,-1],[-2,-3,-3,-3,-2,-3,-3,-3,-1,0,0,-3,0,6,-4,-2,-2,1,3,-1,-3,-3,-1],[-1,-2,-2,-1,-3,-1,-1,-2,-2,-3,-3,-1,-2,-4,7,-1,-1,-4,-3,-2,-2,-1,-2],[1,-1,1,0,-1,0,0,0,-1,-2,-2,0,-1,-2,-1,4,1,-3,-2,-2,0,0,0],[0,-1,0,-1,-1,-1,-1,-2,-2,-1,-1,-1,-1,-2,-1,1,5,-2,-2,0,-1,-1,0],[-3,-3,-4,-4,-2,-2,-3,-2,-2,-3,-2,-3,-1,1,-4,-3,-2,11,2,-3,-4,-3,-2],[-2,-2,-2,-3,-2,-1,-2,-3,2,-1,-1,-2,-1,3,-3,-2,-2,2,7,-1,-3,-2,-1],[0,-3,-3,-3,-1,-2,-2,-3,-3,3,1,-2,1,-1,-2,-2,0,-3,-1,4,-3,-2,-1],[-2,-1,3,4,-3,0,1,-1,0,-3,-4,0,-3,-3,-2,0,-1,-4,-3,-3,4,1,-1],[-1,0,0,1,-3,3,4,-2,0,-3,-3,1,-1,-3,-1,0,-1,-3,-2,-2,1,4,-1],[0,-1,-1,-1,-2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-2,0,0,-2,-1,-1,-1,-1,-1]];function $I(e,t){var r,n=0,a={};return t.forEach(function(i){r=0;var o={};i.forEach(function(s){return o[e[r++]]=s}),a[e[n++]]=o}),a}var s_e=function(){return{blosum62:$I(a_e,o_e),blosum62x:$I(n_e,i_e)}}(),u_e={gapPenalty:-11,gapExtensionPenalty:-1,substMatrix:"default"};function l_e(e,t,r){r===void 0&&(r={});var n=w(w({},u_e),r),a=new c_e(e,t,n);return a.calculate(),a.trace()}var c_e=function(){function e(t,r,n){this.seqA=t,this.seqB=r,this.S=[],this.V=[],this.H=[],this.gapPenalty=n.gapPenalty,this.gapExtensionPenalty=n.gapExtensionPenalty,this.substMatrix=n.substMatrix==="default"?void 0:s_e[n.substMatrix],this.n=this.seqA.length,this.m=this.seqB.length}return e.prototype.initMatrices=function(){for(var t=this,r=t.n,n=t.m,a=t.gapPenalty,i=t.S,o=t.V,s=t.H,u=0;u<=r;++u){i[u]=[],o[u]=[],s[u]=[];for(var l=0;l<=n;++l)i[u][l]=0,o[u][l]=0,s[u][l]=0}for(var u=0;u<=r;++u)i[u][0]=a,s[u][0]=-1/0;for(var l=0;l<=n;++l)i[0][l]=a,o[0][l]=-1/0;i[0][0]=0},e.prototype.makeScoreFn=function(){var t=this,r=t.seqA,n=t.seqB,a=t.substMatrix;return a?function(o,s){var u,l,c=r[o],d=n[s];return(l=(u=a[c])===null||u===void 0?void 0:u[d])!==null&&l!==void 0?l:-4}:function(o,s){var u=r[o],l=n[s];return u===l?5:-3}},e.prototype.calculate=function(){this.initMatrices();for(var t=this.makeScoreFn(),r=this,n=r.V,a=r.H,i=r.S,o=r.n,s=r.m,u=r.gapExtensionPenalty,l=r.gapPenalty,c,d,f,p,h,v=1;v<=o;++v){d=i[v-1],c=n[v-1],f=n[v],p=a[v],h=i[v];for(var m=1;m<=s;++m)f[m]=Math.max(d[m]+l,c[m]+u),p[m]=Math.max(h[m-1]+l,p[m-1]+u),h[m]=Math.max(d[m-1]+t(v-1,m-1),f[m],p[m])}},e.prototype.trace=function(){var t=this.makeScoreFn(),r=this,n=r.V,a=r.H,i=r.S,o=r.seqA,s=r.seqB,u=r.gapExtensionPenalty,l=r.gapPenalty,c=this.n,d=this.m,f,p,h="",v="";for(i[c][d]>=n[c][d]?(f="S",p=i[c][d]):n[c][d]>=a[c][d]?(f="V",p=n[c][d]):(f="H",p=a[c][d]);c>0&&d>0;)f==="S"?i[c][d]===i[c-1][d-1]+t(c-1,d-1)?(h=o[c-1]+h,v=s[d-1]+v,--c,--d,f="S"):i[c][d]===n[c][d]?f="V":i[c][d]===a[c][d]?f="H":(--c,--d):f==="V"?n[c][d]===n[c-1][d]+u?(h=o[c-1]+h,v="-"+v,--c,f="V"):n[c][d]===i[c-1][d]+l?(h=o[c-1]+h,v="-"+v,--c,f="S"):--c:f==="H"&&(a[c][d]===a[c][d-1]+u?(h="-"+h,v=s[d-1]+v,--d,f="H"):a[c][d]===i[c][d-1]+l?(h="-"+h,v=s[d-1]+v,--d,f="S"):--d);for(;c>0;)h=o[c-1]+h,v="-"+v,--c;for(;d>0;)h="-"+h,v=s[d-1]+v,--d;return{aliA:h,aliB:v,score:p}},e}(),YC;(function(e){function t(n){var a=new Map;if(ze.isAtomic(n.unit))for(var i=n.unit.model.atomicHierarchy.residues.label_seq_id,o=n.unit.residueIndex,s=0,u=ke.size(n.indices);s<u;++s){var l=ke.getAt(n.indices,s),c=n.unit.elements[l],d=i.value(o[c]);a.has(d)?a.get(d).push(l):a.set(d,[l])}else if(ze.isCoarse(n.unit))for(var f=(ze.isSpheres(n.unit)?n.unit.model.coarseHierarchy.spheres:n.unit.model.coarseHierarchy.gaussians).seq_id_begin,s=0,u=ke.size(n.indices);s<u;++s){var l=ke.getAt(n.indices,s),c=n.unit.elements[l],d=f.value(c);a.set(d,[l])}return a}function r(n,a){a===void 0&&(a={});for(var i=QI(n.a.unit),o=QI(n.b.unit),s=t(n.a),u=t(n.b),l=[],c=[],d=l_e(i.code.toArray(),o.code.toArray(),a),f=d.aliA,p=d.aliB,h=d.score,v=0,m=0,g=0,y=f.length;g<y;++g){if(f[g]==="-"||p[g]==="-"){f[g]!=="-"&&(v+=1),p[g]!=="-"&&(m+=1);continue}var b=i.seqId.value(v),x=o.seqId.value(m);if(s.has(b)&&u.has(x))for(var S=s.get(b),_=u.get(x),A=0,T=Math.min(S.length,_.length);A<T;++A)l.push(S[A]),c.push(_[A]);v+=1,m+=1}var I=ke.intersect(ke.ofSortedArray(l),n.a.indices),M=ke.intersect(ke.ofSortedArray(c),n.b.indices);return{a:{unit:n.a.unit,indices:I},b:{unit:n.b.unit,indices:M},score:h}}e.compute=r})(YC||(YC={}));function d_e(e){switch(e.kind){case 0:return e.model.atomicHierarchy.index.getEntityFromChain(e.chainIndex[e.elements[0]]);case 1:return e.model.coarseHierarchy.spheres.entityKey[e.elements[0]];case 2:return e.model.coarseHierarchy.gaussians.entityKey[e.elements[0]]}}function QI(e){return e.model.sequence.byEntityKey[d_e(e)].sequence}function ZI(e){var t=[];if(e.length<=0)return t;var r=h_e(e),n={a:Qh(e[0],r),b:Qh(e[1],r)};t[0]=Ju.compute(n);for(var a=2;a<e.length;a++)n.b=Qh(e[a],r),n.centerB=void 0,t.push(Ju.compute(n));return t}var f_e=/(polypeptide|cyclic-pseudo-peptide)/i;function p_e(e){var t=[];if(e.length<=0)return t;for(var r=Re.getFirstLocation(e[0]),n=ct.entity.subtype(r),a=n.match(f_e)?"blosum62":"default",i=1;i<e.length;i++){var o=YC.compute({a:e[0].elements[0],b:e[i].elements[0]},{substMatrix:a}),s=o.a,u=o.b,l=o.score,c=Re(e[0].structure,[s]),d=Re(e[i].structure,[u]),f=ke.size(s.indices);t.push(w(w({},Ju.compute({a:Qh(c,f),b:Qh(d,f)})),{alignmentScore:l}))}return t}function Qh(e,t){for(var r=Ju.Positions.empty(t),n=0,a=0,i=e.elements;a<i.length;a++){for(var o=i[a],s=o.unit,u=o.indices,l=s.elements,c=s.conformation,d=c.x,f=c.y,p=c.z,h=0,v=ke.size(u);h<v;h++){var m=l[ke.getAt(u,h)];if(r.x[n]=d(m),r.y[n]=f(m),r.z[n]=p(m),n++,n>=t)break}if(n>=t)break}return r}function h_e(e){if(e.length===0)return 0;for(var t=Re.size(e[0]),r=1;r<e.length;r++){var n=Re.size(e[r]);n<t&&(t=n)}return t}function v_e(e){for(var t=new Map,r=0;r<e.length;r++)y_e(e[r],t,r);for(var n=Array.from(t.values()),a=g_e(e.length,n),i=[],o=0,s=a;o<s.length;o++){var u=s[o],l=m_e(n,u.i,u.j,u.count),c=l[0],d=l[1],f=Ju.compute({a:c,b:d});i.push({transform:f,pivot:u.i,other:u.j})}return i}function m_e(e,t,r,n){for(var a=Ju.Positions.empty(n),i=Ju.Positions.empty(n),o=0,s=0,u=e;s<u.length;s++){var l=u[s].pivots,c=l[t],d=l[r];if(!(!c||!d))for(var f=Math.min(c[2]-c[1],d[2]-d[1]),p=0;p<f;p++){var h=c[1]+p;a.x[o]=c[0].conformation.x(h),a.y[o]=c[0].conformation.y(h),a.z[o]=c[0].conformation.z(h),h=d[1]+p,i.x[o]=d[0].conformation.x(h),i.y[o]=d[0].conformation.y(h),i.z[o]=d[0].conformation.z(h),o++}}return[a,i]}function g_e(e,t){for(var r=[],n=0;n<e;n++){r[n]=[];for(var a=0;a<e;a++)r[n][a]=0}for(var i=0,o=t;i<o.length;i++)for(var s=o[i].pivots,n=0;n<e;n++)if(!!s[n]){for(var u=s[n][2]-s[n][1],a=n+1;a<e;a++)if(!!s[a]){var l=s[a][2]-s[a][1];r[n][a]=r[n][a]+Math.min(u,l)}}for(var c=[],a=1;a<e;a++)c[a-1]={i:0,j:a,count:r[0][a]};return c}function y_e(e,t,r){for(var n,a=0,i=e.units;a<i.length;a++){var o=i[a];if(o.kind===0){var s=o.elements,u=o.model,l=u.atomicHierarchy.residueAtomSegments.offsets,c=os.Provider.get(u).value;if(!c)return;for(var d=c.dbName,f=c.accession,p=c.num,h=nr.transientSegments(o.model.atomicHierarchy.chainAtomSegments,s),v=nr.transientSegments(o.model.atomicHierarchy.residueAtomSegments,s);h.hasNext;){var m=h.move();for(v.setSegment(m);v.hasNext;){var g=v.move(),y=s[g.start],b=l[y];if(!!d[b]){var x=d[b]+"-"+f[b]+"-"+p[b];if(!t.has(x))t.set(x,{key:x,pivots:(n={},n[r]=[o,y,s[g.end]],n)});else{var S=t.get(x);S.pivots[r]||(S.pivots[r]=[o,y,s[g.end]])}}}}}}}var b_e=function(e){Be(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.defaultState=function(){return{isCollapsed:!1,header:"Superposition",brand:{accent:"gray",svg:DW},isHidden:!0}},t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,function(n){r.setState({isHidden:n.structures.length<2})})},t.prototype.renderControls=function(){return L(Rt,{children:L(x_e,{},void 0)},void 0)},t}(Ap),WL={alignSequences:E.Boolean(!0,{isEssential:!0,description:"Perform a sequence alignment and use the aligned residue pairs to guide the 3D superposition."})},S_e=E.getDefaultValues(WL),JI="SuperpositionTransform",x_e=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isBusy:!1,canUseDb:!1,action:void 0,options:S_e},r.superposeChains=function(){return ce(r,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d,f,p,h,v,m=this;return de(this,function(g){switch(g.label){case 0:n=Xn.trace.query,a=this.chainEntries,i=a.map(function(y,b){var x=Re.toStructure(y.loci),S=mt.toLociWithSourceUnits(n(new Qi(x)));return Re.remap(S,b===0?m.plugin.helpers.substructureParent.get(y.loci.structure.root).obj.data:S.structure.root)}),o=this.state.options.alignSequences?p_e(i):ZI(i),s=a[0],u=1,l=i.length,g.label=1;case 1:return u<l?(c=a[u],d=o[u-1],f=d.bTransform,p=d.rmsd,[4,this.transform(c.cell,f)]):[3,4];case 2:g.sent(),h=Zl(s.label),v=Zl(c.label),this.plugin.log.info("Superposed ["+h+"] and ["+v+"] with RMSD "+p.toFixed(2)+"."),g.label=3;case 3:return++u,[3,1];case 4:return[2]}})})},r.superposeAtoms=function(){return ce(r,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d,f,p,h,v,m=this;return de(this,function(g){switch(g.label){case 0:n=this.atomEntries,a=n.map(function(y,b){return Re.remap(y.loci,b===0?m.plugin.helpers.substructureParent.get(y.loci.structure.root).obj.data:y.loci.structure.root)}),i=ZI(a),o=n[0],s=1,u=a.length,g.label=1;case 1:return s<u?(l=n[s],c=i[s-1],d=c.bTransform,f=c.rmsd,[4,this.transform(l.cell,d)]):[3,4];case 2:g.sent(),p=Zl(o.label),h=Zl(l.label),v=n[s].atoms.length,this.plugin.log.info("Superposed "+v+" "+(v===1?"atom":"atoms")+" of ["+p+"] and ["+h+"] with RMSD "+f.toFixed(2)+"."),g.label=3;case 3:return++s,[3,1];case 4:return[2]}})})},r.superposeDb=function(){return ce(r,void 0,void 0,function(){var n,a,i,o,s,u;return de(this,function(l){switch(l.label){case 0:n=this.plugin.managers.structure.hierarchy.behaviors.selection.value.structures,a=v_e(n.map(function(c){var d;return(d=c.cell.obj)===null||d===void 0?void 0:d.data})),i=0,o=0,s=a,l.label=1;case 1:return o<s.length?(u=s[o],[4,this.transform(n[u.other].cell,u.transform.bTransform)]):[3,4];case 2:l.sent(),i+=u.transform.rmsd,l.label=3;case 3:return o++,[3,1];case 4:return i/=a.length-1,this.plugin.log.info("Superposed "+n.length+" structures with avg. RMSD "+i.toFixed(2)+"."),[4,new Promise(function(c){return requestAnimationFrame(c)})];case 5:return l.sent(),wt.Camera.Reset(this.plugin),[2]}})})},r.toggleByChains=function(){return r.setState({action:r.state.action==="byChains"?void 0:"byChains"})},r.toggleByAtoms=function(){return r.setState({action:r.state.action==="byAtoms"?void 0:"byAtoms"})},r.toggleOptions=function(){return r.setState({action:r.state.action==="options"?void 0:"options"})},r.setOptions=function(n){r.setState({options:n})},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.selection.events.changed,function(){r.forceUpdate()}),this.subscribe(this.selection.events.additionsHistoryUpdated,function(){r.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){r.setState({isBusy:n})}),this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,function(n){r.setState({canUseDb:n.structures.every(function(a){var i;return!!(!((i=a.cell.obj)===null||i===void 0)&&i.data)&&a.cell.obj.data.models.some(function(o){return os.Provider.isApplicable(o)})})})})},Object.defineProperty(t.prototype,"selection",{get:function(){return this.plugin.managers.structure.selection},enumerable:!1,configurable:!0}),t.prototype.transform=function(r,n){return ce(this,void 0,void 0,function(){var a,i,o,s;return de(this,function(u){switch(u.label){case 0:return a=ua.resolveAndCheck(this.plugin.state.data,r),a?(i=ar.findTagInSubtree(this.plugin.state.data.tree,a.transform.ref,JI),o={transform:{name:"matrix",params:{data:n,transpose:!1}}},s=i?this.plugin.state.data.build().to(i).update(o):this.plugin.state.data.build().to(r).insert(rt.Model.TransformStructureConformation,o,{tags:JI}),[4,this.plugin.runTask(this.plugin.state.data.updateTree(s))]):[2];case 1:return u.sent(),[2]}})})},t.prototype.highlight=function(r){this.plugin.managers.interactivity.lociHighlights.highlightOnly({loci:r},!1)},t.prototype.moveHistory=function(r,n){this.plugin.managers.structure.selection.modifyHistory(r,n,void 0,!0)},t.prototype.focusLoci=function(r){this.plugin.managers.camera.focusLoci(r)},t.prototype.lociEntry=function(r,n){var a=this;return L("div",w({className:"msp-flex-row"},{children:L(pr,w({noOverflow:!0,title:"Click to focus. Hover to highlight.",onClick:function(){return a.focusLoci(r.loci)},style:{width:"auto",textAlign:"left"},onMouseEnter:function(){return a.highlight(r.loci)},onMouseLeave:this.plugin.managers.interactivity.lociHighlights.clearHighlights},{children:L("span",{dangerouslySetInnerHTML:{__html:r.label}},void 0)}),void 0)}),n)},t.prototype.historyEntry=function(r,n){var a=this,i=this.plugin.managers.structure.selection.additionsHistory;return Te("div",w({className:"msp-flex-row"},{children:[Te(pr,w({noOverflow:!0,title:"Click to focus. Hover to highlight.",onClick:function(){return a.focusLoci(r.loci)},style:{width:"auto",textAlign:"left"},onMouseEnter:function(){return a.highlight(r.loci)},onMouseLeave:this.plugin.managers.interactivity.lociHighlights.clearHighlights},{children:[n,". ",L("span",{dangerouslySetInnerHTML:{__html:r.label}},void 0)]}),void 0),i.length>1&&L(Gt,{svg:Iy,small:!0,className:"msp-form-control",onClick:function(){return a.moveHistory(r,"up")},flex:"20px",title:"Move up"},void 0),i.length>1&&L(Gt,{svg:Ey,small:!0,className:"msp-form-control",onClick:function(){return a.moveHistory(r,"down")},flex:"20px",title:"Move down"},void 0),L(Gt,{svg:Oo,small:!0,className:"msp-form-control",onClick:function(){return a.plugin.managers.structure.selection.modifyHistory(r,"remove")},flex:!0,title:"Remove"},void 0)]}),r.id)},t.prototype.atomsLociEntry=function(r,n){var a=this;return Te("div",{children:[L("div",w({className:"msp-control-group-header"},{children:L("div",w({className:"msp-no-overflow",title:r.label},{children:r.label}),void 0)}),void 0),L("div",w({className:"msp-control-offset"},{children:r.atoms.map(function(i,o){return a.historyEntry(i,o)})}),void 0)]},n)},Object.defineProperty(t.prototype,"chainEntries",{get:function(){var r=this,n=Ze.create(),a=[];return this.plugin.managers.structure.selection.entries.forEach(function(i,o){var s=i.selection,u=ua.resolveAndCheck(r.plugin.state.data,o);if(!(!u||Re.isEmpty(s))){var l=Re.getFirstLocation(s,n);if(!(s.elements.length>1||ct.entity.type(l)!=="polymer")){var c=nc.ofLoci(s),d=Fg(c,{countsOnly:!0}),f=Go(l,{reverse:!0,granularity:"chain"}).split("|"),p=d+" | "+f[0]+" | "+f[f.length-1];a.push({loci:s,label:p,cell:u})}}}),a},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"atomEntries",{get:function(){for(var r=this,n=new Map,a=this.plugin.managers.structure.selection.additionsHistory,i=0,o=a.length;i<o;++i){var s=a[i];if(Re.size(s.loci)===1){var u=s.loci.structure;n.has(u)?n.get(u).push(s):n.set(u,[s])}}var l=[];return n.forEach(function(c,d){for(var f=r.plugin.helpers.substructureParent.get(d),p=[],h=0,v=c.length;h<v;++h)p.push(c[h].loci.elements[0]);var m=Re(c[0].loci.structure,p),g=m.structure.label.split(" | ")[0];l.push({loci:m,label:g,cell:f,atoms:c})}),l},enumerable:!1,configurable:!0}),t.prototype.addByChains=function(){var r=this,n=this.chainEntries;return Te(Rt,{children:[n.length>0&&L("div",w({className:"msp-control-offset"},{children:n.map(function(a,i){return r.lociEntry(a,i)})}),void 0),n.length<2&&L("div",w({className:"msp-control-offset msp-help-text"},{children:Te("div",w({className:"msp-help-description"},{children:[L(tn,{svg:Hs,inline:!0},void 0),"Add 2 or more selections (toggle ",L(Jg,{inline:!0},void 0)," mode) from separate structures. Selections must be limited to single polymer chains or residues therein."]}),void 0)}),void 0),n.length>1&&L(pr,w({title:"Superpose structures by selected chains.",className:"msp-btn-commit msp-btn-commit-on",onClick:this.superposeChains,style:{marginTop:"1px"}},{children:"Superpose"}),void 0)]},void 0)},t.prototype.addByAtoms=function(){var r=this,n=this.atomEntries;return Te(Rt,{children:[n.length>0&&L("div",w({className:"msp-control-offset"},{children:n.map(function(a,i){return r.atomsLociEntry(a,i)})}),void 0),n.length<2&&L("div",w({className:"msp-control-offset msp-help-text"},{children:Te("div",w({className:"msp-help-description"},{children:[L(tn,{svg:Hs,inline:!0},void 0),"Add 1 or more selections (toggle ",L(Jg,{inline:!0},void 0)," mode) from separate structures. Selections must be limited to single atoms."]}),void 0)}),void 0),n.length>1&&L(pr,w({title:"Superpose structures by selected atoms.",className:"msp-btn-commit msp-btn-commit-on",onClick:this.superposeAtoms,style:{marginTop:"1px"}},{children:"Superpose"}),void 0)]},void 0)},t.prototype.superposeByDbMapping=function(){return L(Rt,{children:L(pr,w({icon:j4,title:"Superpose structures using database mapping.",className:"msp-btn msp-btn-block",onClick:this.superposeDb,style:{marginTop:"1px"},disabled:this.state.isBusy},{children:"DB"}),void 0)},void 0)},t.prototype.render=function(){return Te(Rt,{children:[Te("div",w({className:"msp-flex-row"},{children:[L(oa,{icon:j4,label:"Chains",toggle:this.toggleByChains,isSelected:this.state.action==="byChains",disabled:this.state.isBusy},void 0),L(oa,{icon:MW,label:"Atoms",toggle:this.toggleByAtoms,isSelected:this.state.action==="byAtoms",disabled:this.state.isBusy},void 0),this.state.canUseDb&&this.superposeByDbMapping(),L(oa,{icon:Id,label:"",title:"Options",toggle:this.toggleOptions,isSelected:this.state.action==="options",disabled:this.state.isBusy,style:{flex:"0 0 40px",padding:0}},void 0)]}),void 0),this.state.action==="byChains"&&this.addByChains(),this.state.action==="byAtoms"&&this.addByAtoms(),this.state.action==="options"&&L("div",w({className:"msp-control-offset"},{children:L(Pn,{params:WL,values:this.state.options,onChangeValues:this.setOptions,isDisabled:this.state.isBusy},void 0)}),void 0)]},void 0)},t}(Sa),C_e=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={show:!1,label:""},r.update=function(){var n=r.plugin.state.data,a=n.selectQ(function(p){return p.ofTransformer(rt.Model.ModelFromTrajectory)});if(a.length===0){r.setState({show:!1});return}for(var i="",o=0,s=new Set,u=0,l=a;u<l.length;u++){var c=l[u];if(!!c.sourceRef){var d=n.cells.get(c.sourceRef).obj;if(!!d&&d.data.frameCount>1){if(s.has(c.sourceRef)){r.setState({show:!1});return}if(s.add(c.sourceRef),o++,!i){var f=c.transform.params.modelIndex;i="Model "+(f+1)+" / "+d.data.frameCount}}}}o>1&&(i=""),r.setState({show:o>0,label:i})},r.reset=function(){return wt.State.ApplyAction(r.plugin,{state:r.plugin.state.data,action:k0.create({action:"reset"})})},r.prev=function(){return wt.State.ApplyAction(r.plugin,{state:r.plugin.state.data,action:k0.create({action:"advance",by:-1})})},r.next=function(){return wt.State.ApplyAction(r.plugin,{state:r.plugin.state.data,action:k0.create({action:"advance",by:1})})},r}return t.prototype.componentDidMount=function(){this.subscribe(this.plugin.state.data.events.changed,this.update),this.subscribe(this.plugin.behaviors.state.isAnimating,this.update)},t.prototype.render=function(){var r=this.plugin.behaviors.state.isAnimating.value;return!this.state.show||r&&!this.state.label?null:Te("div",w({className:"msp-traj-controls"},{children:[!r&&L(Gt,{svg:yW,title:"First Model",onClick:this.reset,disabled:r},void 0),!r&&L(Gt,{svg:bR,title:"Previous Model",onClick:this.prev,disabled:r},void 0),!r&&L(Gt,{svg:SR,title:"Next Model",onClick:this.next,disabled:r},void 0),!!this.state.label&&L("span",{children:this.state.label},void 0)]}),void 0)},t}(hr),__e=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isBusy:!1,show:!0},r.keyUp=function(n){if(!(!n.ctrlKey||r.state.isBusy||n.target!==document.body)){var a=r.plugin.managers.snapshot;if(n.keyCode===37||n.key==="ArrowLeft")a.state.isPlaying&&a.stop(),r.prev();else if(n.keyCode===38||n.key==="ArrowUp"){if(a.state.isPlaying&&a.stop(),a.state.entries.size===0)return;var i=a.state.entries.get(0);r.update(i.snapshot.id)}else if(n.keyCode===39||n.key==="ArrowRight")a.state.isPlaying&&a.stop(),r.next();else if(n.keyCode===40||n.key==="ArrowDown"){if(a.state.isPlaying&&a.stop(),a.state.entries.size===0)return;var o=a.state.entries.get(a.state.entries.size-1);r.update(o.snapshot.id)}}},r.change=function(n){n.target.value!=="none"&&r.update(n.target.value)},r.prev=function(){var n=r.plugin.managers.snapshot,a=n.getNextId(n.state.current,-1);a&&r.update(a)},r.next=function(){var n=r.plugin.managers.snapshot,a=n.getNextId(n.state.current,1);a&&r.update(a)},r.togglePlay=function(){r.plugin.managers.snapshot.togglePlay()},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.snapshot.events.changed,function(){return r.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){return r.setState({isBusy:n})}),this.subscribe(this.plugin.behaviors.state.isAnimating,function(n){return r.setState({isBusy:n})}),window.addEventListener("keyup",this.keyUp,!1)},t.prototype.componentWillUnmount=function(){e.prototype.componentWillUnmount.call(this),window.removeEventListener("keyup",this.keyUp,!1)},t.prototype.update=function(r){return ce(this,void 0,void 0,function(){return de(this,function(n){switch(n.label){case 0:return this.setState({isBusy:!0}),[4,wt.State.Snapshots.Apply(this.plugin,{id:r})];case 1:return n.sent(),this.setState({isBusy:!1}),[2]}})})},t.prototype.render=function(){var r=this.plugin.managers.snapshot,n=r.state.entries.size;if(n<2||!this.state.show)return null;var a=r.state.current,i=r.state.isPlaying;return Te("div",w({className:"msp-state-snapshot-viewport-controls"},{children:[Te("select",w({className:"msp-form-control",value:a||"none",onChange:this.change,disabled:this.state.isBusy||i},{children:[!a&&L("option",{value:"none"},"none"),r.state.entries.valueSeq().map(function(o,s){return Te("option",w({value:o.snapshot.id},{children:["["+(s+1)+"/"+n+"]"," ",o.name||new Date(o.timestamp).toLocaleString()]}),o.snapshot.id)})]}),void 0),L(Gt,{svg:i?_R:xR,title:i?"Pause":"Cycle States",onClick:this.togglePlay,disabled:i?!1:this.state.isBusy},void 0),!i&&Te(Rt,{children:[L(Gt,{svg:bR,title:"Previous State",onClick:this.prev,disabled:this.state.isBusy||i},void 0),L(Gt,{svg:SR,title:"Next State",onClick:this.next,disabled:this.state.isBusy||i},void 0)]},void 0)]}),void 0)},t}(hr),w_e=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isEmpty:!0,isExpanded:!1,isBusy:!1,isAnimating:!1,isPlaying:!1},r.toggleExpanded=function(){return r.setState({isExpanded:!r.state.isExpanded})},r.stop=function(){r.plugin.managers.animation.stop(),r.plugin.managers.snapshot.stop()},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.snapshot.events.changed,function(){r.plugin.managers.snapshot.state.isPlaying?r.setState({isPlaying:!0,isExpanded:!1}):r.setState({isPlaying:!1})}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){n?r.setState({isBusy:!0,isExpanded:!1,isEmpty:r.plugin.state.data.tree.transforms.size<2}):r.setState({isBusy:!1,isEmpty:r.plugin.state.data.tree.transforms.size<2})}),this.subscribe(this.plugin.behaviors.state.isAnimating,function(n){n?r.setState({isAnimating:!0,isExpanded:!1}):r.setState({isAnimating:!1})})},t.prototype.render=function(){var r=this.plugin.managers.snapshot.state.isPlaying;if(r||this.state.isEmpty||this.plugin.managers.animation.isEmpty||!this.plugin.config.get(jr.Viewport.ShowAnimation))return null;var n=this.state.isAnimating;return Te("div",w({className:"msp-animation-viewport-controls"},{children:[Te("div",{children:[L("div",{className:"msp-semi-transparent-background"},void 0),L(Gt,{svg:n||r?_R:xW,transparent:!0,title:n?"Stop":"Select Animation",onClick:n||r?this.stop:this.toggleExpanded,toggleState:this.state.isExpanded,disabled:n||r?!1:this.state.isBusy||this.state.isPlaying||this.state.isEmpty},void 0)]},void 0),this.state.isExpanded&&!this.state.isBusy&&L("div",w({className:"msp-animation-viewport-controls-select"},{children:L(hSe,{onStart:this.toggleExpanded},void 0)}),void 0)]}),void 0)},t}(hr),A_e=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onMouseMove=function(n){n.buttons===0&&n.stopPropagation()},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.behaviors.interaction.selectionMode,function(){return r.forceUpdate()})},t.prototype.render=function(){return this.plugin.selectionMode?L("div",w({className:"msp-selection-viewport-controls",onMouseMove:this.onMouseMove},{children:L(txe,{},void 0)}),void 0):null},t}(hr),P_e=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={labels:[]},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.behaviors.labels.highlight,function(n){return r.setState({labels:n.labels})})},t.prototype.render=function(){return this.state.labels.length===0?null:L("div",w({className:"msp-highlight-info"},{children:this.state.labels.map(function(r,n){return L("div",{dangerouslySetInnerHTML:{__html:r}},""+n)})}),void 0)},t}(hr),T_e=function(e){Be(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.behaviors.events.changed,function(){return r.forceUpdate()})},t.prototype.render=function(){var r=this,n=[];return this.plugin.customStructureControls.forEach(function(a,i){n.push(L(a,{initiallyCollapsed:r.props.initiallyCollapsed},i))}),n.length>0?L(Rt,{children:n},void 0):null},t}(hr),E_e=function(e){Be(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.render=function(){return Te(Rt,{children:[Te("div",w({className:"msp-section-header"},{children:[L(tn,{svg:wj},void 0),"Structure Tools"]}),void 0),L(pxe,{},void 0),L(oxe,{},void 0),L(b_e,{},void 0),L(LSe,{},void 0),this.plugin.config.get(jr.VolumeStreaming.Enabled)&&L(XCe,{},void 0),L(YCe,{},void 0),L(T_e,{},void 0)]},void 0)},t}(hr),I_e=function(e){Be(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return Object.defineProperty(t.prototype,"current",{get:function(){return this.props.state.behaviors.currentObject.value},enumerable:!1,configurable:!0}),t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.events.object.updated,function(n){var a=n.ref,i=n.state,o=r.current;o.ref!==a||o.state!==i||r.forceUpdate()}),this.subscribe(this.plugin.state.data.actions.events.added,function(){return r.forceUpdate()}),this.subscribe(this.plugin.state.data.actions.events.removed,function(){return r.forceUpdate()})},t.prototype.render=function(){var r=this,n=this.props,a=n.state,i=n.nodeRef,o=a.cells.get(i),s=a.actions.fromCell(o,this.plugin);if(s.length===0)return null;var u=o.transform.transformer.definition,l=o.obj?o.obj.label:u.display&&u.display.name||u.name;return Te("div",w({className:"msp-state-actions"},{children:[!this.props.hideHeader&&Te("div",w({className:"msp-section-header"},{children:[L(tn,{svg:Uj},void 0)," ","Actions ("+l+")"]}),void 0),s.map(function(c,d){return L(mw,{state:a,action:c,nodeRef:i,initiallyCollapsed:d===0?!r.props.alwaysExpandFirst&&r.props.initiallyCollapsed:r.props.initiallyCollapsed},""+c.id)})]}),void 0)},t}(hr),sy=function(e){Be(t,e);function t(r){var n=e.call(this)||this;return n.plugin=r,n.data=vc.create(new ge.Root({}),{runTask:n.plugin.runTask,globalContext:n.plugin,historyCapacity:n.plugin.config.get(jr.State.HistoryCapacity)}),n.behaviors=vc.create(new Mr.Root({}),{runTask:n.plugin.runTask,globalContext:n.plugin,rootState:{isLocked:!0}}),n.events={cell:{stateUpdated:xu(n.data.events.cell.stateUpdated,n.behaviors.events.cell.stateUpdated),created:xu(n.data.events.cell.created,n.behaviors.events.cell.created),removed:xu(n.data.events.cell.removed,n.behaviors.events.cell.removed)},object:{created:xu(n.data.events.object.created,n.behaviors.events.object.created),removed:xu(n.data.events.object.removed,n.behaviors.events.object.removed),updated:xu(n.data.events.object.updated,n.behaviors.events.object.updated)}},n.snapshotParams=n.ev.behavior(t.DefaultSnapshotParams),n.setSnapshotParams=function(a){n.snapshotParams.next(w(w({},t.DefaultSnapshotParams),a))},n}return Object.defineProperty(t.prototype,"animation",{get:function(){return this.plugin.managers.animation},enumerable:!1,configurable:!0}),t.prototype.getSnapshot=function(r){var n,a,i=w(w({},this.snapshotParams.value),r);return{id:un.create22(),data:i.data?this.data.getSnapshot():void 0,behaviour:i.behavior?this.behaviors.getSnapshot():void 0,animation:i.animation?this.animation.getSnapshot():void 0,startAnimation:i.startAnimation?!!i.startAnimation:void 0,camera:i.camera?{current:this.plugin.canvas3d.camera.getSnapshot(),transitionStyle:i.cameraTransition.name,transitionDurationInMs:((n=i==null?void 0:i.cameraTransition)===null||n===void 0?void 0:n.name)==="animate"?i.cameraTransition.params.durationInMs:void 0}:void 0,canvas3d:i.canvas3d?{props:(a=this.plugin.canvas3d)===null||a===void 0?void 0:a.props}:void 0,interactivity:i.interactivity?{props:this.plugin.managers.interactivity.props}:void 0,structureFocus:this.plugin.managers.structure.focus.getSnapshot(),durationInMs:i==null?void 0:i.durationInMs}},t.prototype.setSnapshot=function(r){var n;return ce(this,void 0,void 0,function(){var a;return de(this,function(i){switch(i.label){case 0:return[4,this.animation.stop()];case 1:return i.sent(),r.behaviour?[4,this.plugin.runTask(this.behaviors.setSnapshot(r.behaviour))]:[3,3];case 2:i.sent(),i.label=3;case 3:return r.data?[4,this.plugin.runTask(this.data.setSnapshot(r.data))]:[3,5];case 4:i.sent(),i.label=5;case 5:return!((n=r.canvas3d)===null||n===void 0)&&n.props?(a=E.normalizeParams(vo,r.canvas3d.props,"children"),[4,wt.Canvas3D.SetSettings(this.plugin,{settings:a})]):[3,7];case 6:i.sent(),i.label=7;case 7:return r.interactivity&&r.interactivity.props&&this.plugin.managers.interactivity.setProps(r.interactivity.props),r.structureFocus&&this.plugin.managers.structure.focus.setSnapshot(r.structureFocus),r.animation&&this.animation.setSnapshot(r.animation),r.camera&&wt.Camera.Reset(this.plugin,{snapshot:r.camera.current,durationMs:r.camera.transitionStyle==="animate"?r.camera.transitionDurationInMs:void 0}),r.startAnimation&&this.animation.start(),[2]}})})},t.prototype.updateTransform=function(r,n,a,i){var o=r.build().to(n).update(a);return wt.State.Update(this.plugin,{state:r,tree:o,options:{canUndo:i}})},t.prototype.updateBehavior=function(r,n){var a=this.behaviors.build();if(this.behaviors.tree.transforms.has(r.id))a.to(r.id).update(n);else{var i=r.createDefaultParams(void 0,this.plugin);a.to(Mr.getCategoryId(r)).apply(r,Vu(i,n),{ref:r.id})}return this.plugin.runTask(this.behaviors.updateTree(a))},t.prototype.dispose=function(){this.behaviors.cells.forEach(function(r){Mr.Behavior.is(r.obj)&&r.obj.data.unregister()}),e.prototype.dispose.call(this),this.data.dispose(),this.behaviors.dispose(),this.animation.dispose()},t}(Vv);(function(e){e.SnapshotParams={durationInMs:E.Numeric(1500,{min:100,max:15e3,step:100},{label:"Duration in ms"}),data:E.Boolean(!0),behavior:E.Boolean(!1),animation:E.Boolean(!0),startAnimation:E.Boolean(!1),canvas3d:E.Boolean(!0),interactivity:E.Boolean(!0),camera:E.Boolean(!0),cameraTransition:E.MappedStatic("animate",{animate:E.Group({durationInMs:E.Numeric(250,{min:100,max:5e3,step:500},{label:"Duration in ms"})}),instant:E.Group({})},{options:[["animate","Animate"],["instant","Instant"]]})},e.DefaultSnapshotParams=E.getDefaultValues(e.SnapshotParams)})(sy||(sy={}));var M_e=function(e){Be(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.render=function(){var r;return Te("div",{children:[L(Tu,{icon:CR,title:"Plugin State"},void 0),L("div",w({style:{marginBottom:"10px"}},{children:L(ls,w({header:"Save Options",initiallyExpanded:!1},{children:L(YL,{},void 0)}),void 0)}),void 0),L(D_e,{},void 0),L(R_e,{},void 0),L(Tu,{title:"Save as File",accent:"blue"},void 0),L(XL,{},void 0),((r=this.plugin.spec.components)===null||r===void 0?void 0:r.remoteState)!=="none"&&L(KL,{},void 0)]},void 0)},t}(hr),XL=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.downloadToFileJson=function(){var n,a;(a=(n=r.props).onAction)===null||a===void 0||a.call(n),wt.State.Snapshots.DownloadToFile(r.plugin,{type:"json"})},r.downloadToFileZip=function(){var n,a;(a=(n=r.props).onAction)===null||a===void 0||a.call(n),wt.State.Snapshots.DownloadToFile(r.plugin,{type:"zip"})},r.open=function(n){var a,i;if(!n.target.files||!n.target.files[0]){r.plugin.log.error("No state file selected");return}(i=(a=r.props).onAction)===null||i===void 0||i.call(a),wt.State.Snapshots.OpenFile(r.plugin,{file:n.target.files[0]})},r}return t.prototype.render=function(){return Te(Rt,{children:[Te("div",w({className:"msp-flex-row"},{children:[L(pr,w({icon:rx,onClick:this.downloadToFileJson,title:"Save the state description. Input data are loaded using the provided sources. Does not work if local files are used as input."},{children:"State"}),void 0),L(pr,w({icon:rx,onClick:this.downloadToFileZip,title:"Save the state including the input data."},{children:"Session"}),void 0),Te("div",w({className:"msp-btn msp-btn-block msp-btn-action msp-loader-msp-btn-file"},{children:[L(tn,{svg:lW,inline:!0},void 0)," Open ",L("input",{onChange:this.open,type:"file",multiple:!1,accept:".molx,.molj"},void 0)]}),void 0)]}),void 0),Te("div",w({className:"msp-help-text",style:{padding:"10px"}},{children:[L(tn,{svg:EW},void 0)," This is an experimental feature and stored states/sessions might not be openable in a future version."]}),void 0)]},void 0)},t}(hr),YL=function(e){Be(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.snapshotParams,function(){return r.forceUpdate()})},t.prototype.render=function(){return L(Pn,{params:sy.SnapshotParams,values:this.plugin.state.snapshotParams.value,onChangeValues:this.plugin.state.setSnapshotParams},void 0)},t}(hr),D_e=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={params:E.getDefaultValues(t.Params)},r.add=function(){wt.State.Snapshots.Add(r.plugin,{name:r.state.params.name,description:r.state.params.description})},r.updateParams=function(n){return r.setState({params:n})},r.clear=function(){wt.State.Snapshots.Clear(r.plugin,{})},r}return t.prototype.shouldComponentUpdate=function(r,n){return!lp(this.props,r)||!lp(this.state,n)},t.prototype.render=function(){return Te("div",{children:[L(Pn,{params:t.Params,values:this.state.params,onEnter:this.add,onChangeValues:this.updateParams},void 0),Te("div",w({className:"msp-flex-row"},{children:[L(Gt,{onClick:this.clear,svg:Oo,title:"Remove All"},void 0),L(pr,w({onClick:this.add,icon:_p,style:{textAlign:"right"},commit:!0},{children:"Add"}),void 0)]}),void 0)]},void 0)},t.Params={name:E.Text(),description:E.Text()},t}(hr),R_e=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.apply=function(n){var a=n.currentTarget.getAttribute("data-id");!a||wt.State.Snapshots.Apply(r.plugin,{id:a})},r.remove=function(n){var a=n.currentTarget.getAttribute("data-id");!a||wt.State.Snapshots.Remove(r.plugin,{id:a})},r.moveUp=function(n){var a=n.currentTarget.getAttribute("data-id");!a||wt.State.Snapshots.Move(r.plugin,{id:a,dir:-1})},r.moveDown=function(n){var a=n.currentTarget.getAttribute("data-id");!a||wt.State.Snapshots.Move(r.plugin,{id:a,dir:1})},r.replace=function(n){var a=n.currentTarget.getAttribute("data-id");!a||wt.State.Snapshots.Replace(r.plugin,{id:a})},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.snapshot.events.changed,function(){return r.forceUpdate()})},t.prototype.render=function(){var r=this,n=this.plugin.managers.snapshot.state.current;return L("ul",w({style:{listStyle:"none",marginTop:"10px"},className:"msp-state-list"},{children:this.plugin.managers.snapshot.state.entries.map(function(a){return Te("li",w({className:"msp-flex-row"},{children:[Te(pr,w({"data-id":a.snapshot.id,onClick:r.apply,className:"msp-no-overflow"},{children:[L("span",w({style:{fontWeight:a.snapshot.id===n?"bold":void 0}},{children:a.name||new Date(a.timestamp).toLocaleString()}),void 0)," ",L("small",{children:(a.snapshot.durationInMs?C0(a.snapshot.durationInMs,!1)+(a.description?", ":""):"")+(a.description?a.description:"")},void 0)]}),void 0),L(Gt,{svg:Iy,"data-id":a.snapshot.id,title:"Move Up",onClick:r.moveUp,flex:"20px"},void 0),L(Gt,{svg:Ey,"data-id":a.snapshot.id,title:"Move Down",onClick:r.moveDown,flex:"20px"},void 0),L(Gt,{svg:_W,"data-id":a.snapshot.id,title:"Replace",onClick:r.replace,flex:"20px"},void 0),L(Gt,{svg:Oo,"data-id":a.snapshot.id,title:"Remove",onClick:r.remove,flex:"20px"},void 0)]}),a.snapshot.id)})}),void 0)},t}(hr),KL=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.Params={name:E.Text(),options:E.Group({description:E.Text(),playOnLoad:E.Boolean(!1),serverUrl:E.Text(r.plugin.config.get(jr.State.CurrentServer))})},r.state={params:E.getDefaultValues(r.Params),entries:Nn.exports.OrderedMap(),isBusy:!1},r.ListOnlyParams={options:E.Group({serverUrl:E.Text(r.plugin.config.get(jr.State.CurrentServer))},{isFlat:!0})},r._mounted=!1,r.refresh=function(){return ce(r,void 0,void 0,function(){var n,a,i,o,s,u;return de(this,function(l){switch(l.label){case 0:return l.trys.push([0,2,,3]),this.setState({isBusy:!0}),this.plugin.config.set(jr.State.CurrentServer,this.state.params.options.serverUrl),[4,this.plugin.runTask(this.plugin.fetch({url:this.serverUrl("list"),type:"json"}))];case 1:for(n=l.sent()||[],n.sort(function(c,d){return c.isSticky===d.isSticky?c.timestamp-d.timestamp:c.isSticky?-1:1}),a=Nn.exports.OrderedMap().asMutable(),i=0,o=n;i<o.length;i++)s=o[i],a.set(s.id,w(w({},s),{url:this.serverUrl("get/"+s.id),removeUrl:this.serverUrl("remove/"+s.id)}));return this._mounted&&this.setState({entries:a.asImmutable(),isBusy:!1}),[3,3];case 2:return u=l.sent(),this.plugin.log.error("Fetching Remote Snapshots: "+u),this._mounted&&this.setState({entries:Nn.exports.OrderedMap(),isBusy:!1}),[3,3];case 3:return[2]}})})},r.upload=function(){return ce(r,void 0,void 0,function(){return de(this,function(n){switch(n.label){case 0:return this.setState({isBusy:!0}),this.plugin.config.set(jr.State.CurrentServer,this.state.params.options.serverUrl),[4,wt.State.Snapshots.Upload(this.plugin,{name:this.state.params.name,description:this.state.params.options.description,playOnLoad:this.state.params.options.playOnLoad,serverUrl:this.state.params.options.serverUrl})];case 1:return n.sent(),this.plugin.log.message("Snapshot uploaded."),this._mounted&&(this.setState({isBusy:!1}),this.refresh()),[2]}})})},r.fetch=function(n){return ce(r,void 0,void 0,function(){var a,i;return de(this,function(o){switch(o.label){case 0:if(a=n.currentTarget.getAttribute("data-id"),!a)return[2];if(i=this.state.entries.get(a),!i)return[2];this.setState({isBusy:!0}),o.label=1;case 1:return o.trys.push([1,,3,4]),[4,wt.State.Snapshots.Fetch(this.plugin,{url:i.url})];case 2:return o.sent(),[3,4];case 3:return this._mounted&&this.setState({isBusy:!1}),[7];case 4:return[2]}})})},r.remove=function(n){return ce(r,void 0,void 0,function(){var a,i;return de(this,function(o){switch(o.label){case 0:if(a=n.currentTarget.getAttribute("data-id"),!a)return[2];if(i=this.state.entries.get(a),!i)return[2];this.setState({entries:this.state.entries.remove(a)}),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,fetch(i.removeUrl)];case 2:return o.sent(),[3,4];case 3:return o.sent(),[3,4];case 4:return[2]}})})},r}return t.prototype.componentDidMount=function(){this.refresh(),this._mounted=!0},t.prototype.componentWillUnmount=function(){this._mounted=!1},t.prototype.serverUrl=function(r){return r?S1(this.state.params.options.serverUrl,r):this.state.params.options.serverUrl},t.prototype.render=function(){var r=this;return Te(Rt,{children:[L(Tu,{title:"Remote States",accent:"blue"},void 0),!this.props.listOnly&&Te(Rt,{children:[L(Pn,{params:this.Params,values:this.state.params,onEnter:this.upload,onChange:function(n){var a;r.setState({params:w(w({},r.state.params),(a={},a[n.name]=n.value,a))})},isDisabled:this.state.isBusy},void 0),Te("div",w({className:"msp-flex-row"},{children:[L(Gt,{onClick:this.refresh,disabled:this.state.isBusy,svg:ax},void 0),L(pr,w({icon:Lj,onClick:this.upload,disabled:this.state.isBusy,commit:!0},{children:"Upload"}),void 0)]}),void 0)]},void 0),L(O_e,{entries:this.state.entries,isBusy:this.state.isBusy,serverUrl:this.state.params.options.serverUrl,fetch:this.fetch,remove:this.props.listOnly?void 0:this.remove},void 0),this.props.listOnly&&Te("div",w({style:{marginTop:"10px"}},{children:[L(Pn,{params:this.ListOnlyParams,values:this.state.params,onEnter:this.upload,onChange:function(n){var a;r.setState({params:w(w({},r.state.params),(a={},a[n.name]=n.value,a))})},isDisabled:this.state.isBusy},void 0),L("div",w({className:"msp-flex-row"},{children:L(pr,w({onClick:this.refresh,disabled:this.state.isBusy,icon:ax},{children:"Refresh"}),void 0)}),void 0)]}),void 0)]},void 0)},t}(hr),O_e=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.open=function(n){return ce(r,void 0,void 0,function(){var a,i,o,s;return de(this,function(u){return a=n.currentTarget.getAttribute("data-id"),a?(i=this.props.entries.get(a),i?(n.preventDefault(),o=""+window.location,s=o.indexOf("?"),s>0&&(o=o.substr(0,s)),window.open(o+"?snapshot-url="+encodeURIComponent(i.url),"_blank"),[2]):[2]):[2]})})},r}return t.prototype.render=function(){var r=this;return L("ul",w({style:{listStyle:"none",marginTop:"10px"},className:"msp-state-list"},{children:this.props.entries.valueSeq().map(function(n){return Te("li",w({className:"msp-flex-row"},{children:[Te(pr,w({"data-id":n.id,onClick:r.props.fetch,disabled:r.props.isBusy,onContextMenu:r.open,title:"Click to download, right-click to open in a new tab."},{children:[n.name||new Date(n.timestamp).toLocaleString()," ",L("small",{children:n.description},void 0)]}),void 0),!n.isSticky&&r.props.remove&&L(Gt,{svg:Oo,"data-id":n.id,title:"Remove",onClick:r.props.remove,disabled:r.props.isBusy,small:!0},void 0)]}),n.id)})}),void 0)},t}(Sa);function $L(e,t){return t===void 0&&(t=ZX),function(r){return r.lift(new F_e(e,t))}}var F_e=function(){function e(t,r){this.dueTime=t,this.scheduler=r}return e.prototype.call=function(t,r){return r.subscribe(new k_e(t,this.dueTime,this.scheduler))},e}(),k_e=function(e){La(t,e);function t(r,n,a){var i=e.call(this,r)||this;return i.dueTime=n,i.scheduler=a,i.debouncedSubscription=null,i.lastValue=null,i.hasValue=!1,i}return t.prototype._next=function(r){this.clearDebounce(),this.lastValue=r,this.hasValue=!0,this.add(this.debouncedSubscription=this.scheduler.schedule(B_e,this.dueTime,this))},t.prototype._complete=function(){this.debouncedNext(),this.destination.complete()},t.prototype.debouncedNext=function(){if(this.clearDebounce(),this.hasValue){var r=this.lastValue;this.lastValue=null,this.hasValue=!1,this.destination.next(r)}},t.prototype.clearDebounce=function(){var r=this.debouncedSubscription;r!==null&&(this.remove(r),r.unsubscribe(),this.debouncedSubscription=null)},t}(wo);function B_e(e){e.debouncedNext()}function L_e(e){return function(t){return e===0?XX():t.lift(new N_e(e))}}var N_e=function(){function e(t){if(this.total=t,this.total<0)throw new eY}return e.prototype.call=function(t,r){return r.subscribe(new U_e(t,this.total))},e}(),U_e=function(e){La(t,e);function t(r,n){var a=e.call(this,r)||this;return a.total=n,a.count=0,a}return t.prototype._next=function(r){var n=this.total,a=++this.count;a<=n&&(this.destination.next(r),a===n&&(this.destination.complete(),this.unsubscribe()))},t}(wo),QL=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={showActions:!0},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.events.cell.created,function(n){n.cell.transform.parent===cr.RootRef&&r.forceUpdate()}),this.subscribe(this.plugin.state.events.cell.removed,function(n){n.parent===cr.RootRef&&r.forceUpdate()})},t.getDerivedStateFromProps=function(r,n){var a=r.state.tree.root.ref,i=r.state.tree.children.get(a),o=i.size===0;return n.showActions===o?null:{showActions:o}},t.prototype.render=function(){var r=this.props.state.tree.root.ref;return this.state.showActions?Te("div",w({style:{margin:"10px",cursor:"default"}},{children:[L("p",{children:"Nothing to see here yet."},void 0),Te("p",{children:["Structures and Volumes can be loaded from the ",L(tn,{svg:nx},void 0)," tab."]},void 0)]}),void 0):L(z_e,{cell:this.props.state.cells.get(r),depth:0},void 0)},t}(hr),z_e=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isCollapsed:!!r.props.cell.state.isCollapsed,isNull:t.isNull(r.props.cell),showLabel:t.showLabel(r.props.cell)},r}return t.prototype.is=function(r){return r.ref===this.ref&&r.state===this.props.cell.parent},Object.defineProperty(t.prototype,"ref",{get:function(){return this.props.cell.transform.ref},enumerable:!1,configurable:!0}),t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.events.cell.stateUpdated,function(n){r.props.cell===n.cell&&r.is(n)&&n.state.cells.has(r.ref)&&(r.state.isCollapsed!==!!n.cell.state.isCollapsed||r.state.isNull!==t.isNull(n.cell)||r.state.showLabel!==t.showLabel(n.cell))&&r.forceUpdate()}),this.subscribe(this.plugin.state.events.cell.created,function(n){r.props.cell.parent===n.state&&r.ref===n.cell.transform.parent&&r.forceUpdate()}),this.subscribe(this.plugin.state.events.cell.removed,function(n){r.props.cell.parent===n.state&&r.ref===n.parent&&r.forceUpdate()})},t.getDerivedStateFromProps=function(r,n){var a=t.isNull(r.cell),i=t.showLabel(r.cell);return!!r.cell.state.isCollapsed===n.isCollapsed&&n.isNull===a&&n.showLabel===i?null:{isCollapsed:!!r.cell.state.isCollapsed,isNull:a,showLabel:i}},t.hasDecorator=function(r){var n,a=r.parent.tree.children.get(r.transform.ref);return a.size!==1?!1:!!(!((n=r.parent)===null||n===void 0)&&n.tree.transforms.get(a.first()).transformer.definition.isDecorator)},t.isNull=function(r){return!r||!r.parent||r.obj===Cn.Null||!r.parent.tree.transforms.has(r.transform.ref)},t.showLabel=function(r){return r.transform.ref!==cr.RootRef&&(r.status!=="ok"||!r.state.isGhost&&!t.hasDecorator(r))},t.prototype.render=function(){var r=this;if(this.state.isNull)return null;var n=this.props.cell,a=n.parent.tree.children.get(this.ref);if(!this.state.showLabel)return a.size===0?null:L(Rt,{children:a.map(function(o){return L(t,{cell:n.parent.cells.get(o),depth:r.props.depth},o)})},void 0);var i=this.props.depth+1;return Te(Rt,{children:[L(V_e,{cell:n,depth:this.props.depth},void 0),a.size===0?void 0:L("div",w({style:{display:this.state.isCollapsed?"none":"block"}},{children:a.map(function(o){return L(t,{cell:n.parent.cells.get(o),depth:i},o)})}),void 0)]},void 0)},t}(hr),V_e=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isCurrent:r.props.cell.parent.current===r.ref,isCollapsed:!!r.props.cell.state.isCollapsed,action:void 0,currentAction:void 0},r.setCurrent=function(n){n==null||n.preventDefault(),n==null||n.currentTarget.blur(),wt.State.SetCurrentObject(r.plugin,{state:r.props.cell.parent,ref:r.ref})},r.setCurrentRoot=function(n){n==null||n.preventDefault(),n==null||n.currentTarget.blur(),wt.State.SetCurrentObject(r.plugin,{state:r.props.cell.parent,ref:cr.RootRef})},r.remove=function(n){n==null||n.preventDefault(),wt.State.RemoveObject(r.plugin,{state:r.props.cell.parent,ref:r.ref,removeParentGhosts:!0})},r.toggleVisible=function(n){n.preventDefault(),wt.State.ToggleVisibility(r.plugin,{state:r.props.cell.parent,ref:r.ref}),n.currentTarget.blur()},r.toggleExpanded=function(n){n.preventDefault(),wt.State.ToggleExpanded(r.plugin,{state:r.props.cell.parent,ref:r.ref}),n.currentTarget.blur()},r.highlight=function(n){n.preventDefault(),wt.Interactivity.Object.Highlight(r.plugin,{state:r.props.cell.parent,ref:r.ref}),n.currentTarget.blur()},r.clearHighlight=function(n){n.preventDefault(),wt.Interactivity.ClearHighlights(r.plugin),n.currentTarget.blur()},r.hideApply=function(){r.setCurrentRoot()},r.selectAction=function(n){!n||(n==null?void 0:n.value)()},r}return t.prototype.is=function(r){return r.ref===this.ref&&r.state===this.props.cell.parent},Object.defineProperty(t.prototype,"ref",{get:function(){return this.props.cell.transform.ref},enumerable:!1,configurable:!0}),t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.events.cell.stateUpdated.pipe(Ly(function(n){return r.is(n)}),$L(33)),function(n){r.forceUpdate()}),this.subscribe(this.props.cell.parent.behaviors.currentObject,function(n){if(!r.is(n)){r.state.isCurrent&&n.state.transforms.has(r.ref)&&r._setCurrent(r.props.cell.parent.current===r.ref,r.state.isCollapsed);return}n.state.transforms.has(r.ref)&&r._setCurrent(r.props.cell.parent.current===r.ref,!!r.props.cell.state.isCollapsed)})},t.prototype._setCurrent=function(r,n){r?this.setState({isCurrent:r,action:"options",currentAction:void 0,isCollapsed:n}):this.setState({isCurrent:r,action:void 0,currentAction:void 0,isCollapsed:n})},t.getDerivedStateFromProps=function(r,n){var a=r.cell.parent.current===r.cell.transform.ref,i=!!r.cell.state.isCollapsed;return n.isCollapsed===i&&n.isCurrent===a?null:{isCurrent:a,isCollapsed:i,action:void 0,currentAction:void 0}},Object.defineProperty(t.prototype,"actions",{get:function(){var r=this,n=this.props.cell,a=Nt([],n.parent.actions.fromCell(n,this.plugin));if(a.length!==0)return a.sort(function(i,o){return i.definition.display.name<o.definition.display.name?-1:i.definition.display.name===o.definition.display.name?0:1}),Nt([Jt.Header("Apply Action")],a.map(function(i){return Jt.Item(i.definition.display.name,function(){return r.setState({action:"apply",currentAction:i})})}))},enumerable:!1,configurable:!0}),t.prototype.updates=function(r){for(var n=this.props.cell,a=dv.getDecoratorChain(n.parent,n.transform.ref),i=[],o=a.length-1;o>=0;o--){var s=a[o];i.push(L(Zu,{state:n.parent,transform:s.transform,noMargin:!0,wrapInExpander:!0,expanderHeaderLeftMargin:r},s.transform.transformer.id+"-"+o))}return L("div",w({className:"msp-tree-updates-wrapper"},{children:i}),void 0)},t.prototype.render=function(){var r=this.props.cell,n=r.transform;if(!r)return null;var a=this.is(r.parent.behaviors.currentObject.value),i=r.status!=="error"&&r.status!=="ok",o;if(r.status==="error"||!r.obj){var s=r.status==="error"?r.errorText:n.transformer.definition.display.name;o=Te(pr,w({className:"msp-btn-tree-label msp-no-hover-outline",noOverflow:!0,title:s,onClick:this.state.isCurrent?this.setCurrentRoot:this.setCurrent,disabled:i},{children:[r.status==="error"&&Te("b",{children:["[",r.status,"]"]},void 0)," ",L("span",{children:s},void 0)]}),void 0)}else{var u=r.obj,l=u.label+" "+(u.description?u.description:"");o=Te(pr,w({className:"msp-btn-tree-label msp-type-class-"+u.type.typeClass,noOverflow:!0,disabled:i,title:l,onClick:this.state.isCurrent?this.setCurrentRoot:this.setCurrent},{children:[L("span",{children:u.label},void 0)," ",u.description?L("small",{children:u.description},void 0):void 0]}),void 0)}var c=r.parent.tree.children.get(this.ref),d=r.state,f=L(Gt,{svg:d.isCollapsed?Nu:Lu,flex:"20px",disabled:i,onClick:this.toggleExpanded,transparent:!0,className:"msp-no-hover-outline",style:{visibility:c.size>0?"visible":"hidden"}},void 0),p=r.state.isLocked?void 0:L(Gt,{svg:Oo,onClick:this.remove,disabled:i,small:!0,toggleState:!1},void 0),h=L(Gt,{svg:d.isHidden?Xd:Yd,toggleState:!1,disabled:i,small:!0,onClick:this.toggleVisible},void 0),v={marginLeft:this.props.depth*8+"px"},m=Te("div",w({className:"msp-flex-row msp-tree-row"+(a?" msp-tree-row-current":""),onMouseEnter:this.highlight,onMouseLeave:this.clearHighlight,style:v},{children:[f,o,p,h]}),void 0);if(!a)return m;if(this.state.action==="apply"&&this.state.currentAction)return Te("div",w({style:{marginBottom:"1px"}},{children:[m,L(Pu,w({header:"Apply "+this.state.currentAction.definition.display.name,initialExpanded:!0,hideExpander:!0,hideOffset:!1,onHeaderClick:this.hideApply,topRightIcon:Au,headerLeftMargin:this.props.depth*8+21+"px"},{children:L(mw,{onApply:this.hideApply,state:this.props.cell.parent,action:this.state.currentAction,nodeRef:this.props.cell.transform.ref,hideHeader:!0,noMargin:!0},void 0)}),void 0)]}),void 0);if(this.state.action==="options"){var g=this.actions,y=this.updates(this.props.depth*8+21+"px");return Te("div",w({style:{marginBottom:"1px"}},{children:[m,y,g&&L("div",w({style:{marginLeft:this.props.depth*8+21+"px",marginTop:"-1px"}},{children:L(Jt,{items:g,onSelect:this.selectAction},void 0)}),void 0)]}),void 0)}return m},t}(hr),H_e=function(e){Be(t,e);function t(){var r,n=e.apply(this,arguments)||this;return n.state={tab:n.plugin.behaviors.layout.leftPanelTabName.value},n.set=function(a){if(n.state.tab===a){n.setState({tab:"none"},function(){return n.plugin.behaviors.layout.leftPanelTabName.next("none")}),wt.Layout.Update(n.plugin,{state:{regionState:w(w({},n.plugin.layout.state.regionState),{left:"collapsed"})}});return}n.setState({tab:a},function(){return n.plugin.behaviors.layout.leftPanelTabName.next(a)}),n.plugin.layout.state.regionState.left!=="full"&&wt.Layout.Update(n.plugin,{state:{regionState:w(w({},n.plugin.layout.state.regionState),{left:"full"})}})},n.tabs={none:L(Rt,{},void 0),root:Te(Rt,{children:[L(Tu,{icon:nx,title:"Home"},void 0),L(I_e,{state:n.plugin.state.data,nodeRef:cr.RootRef,hideHeader:!0,initiallyCollapsed:!0,alwaysExpandFirst:!0},void 0),((r=n.plugin.spec.components)===null||r===void 0?void 0:r.remoteState)!=="none"&&L(KL,{listOnly:!0},void 0)]},void 0),data:Te(Rt,{children:[L(Tu,{icon:vR,title:Te(Rt,{children:[L(j_e,{},void 0)," State Tree"]},void 0)},void 0),L(QL,{state:n.plugin.state.data},void 0)]},void 0),states:L(M_e,{},void 0),settings:Te(Rt,{children:[L(Tu,{icon:Id,title:"Plugin Settings"},void 0),L(q_e,{},void 0)]},void 0),help:Te(Rt,{children:[L(Tu,{icon:Hs,title:"Help"},void 0),L(JSe,{},void 0)]},void 0)},n}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.behaviors.layout.leftPanelTabName,function(n){r.state.tab!==n&&r.setState({tab:n}),n==="none"&&r.plugin.layout.state.regionState.left!=="collapsed"&&wt.Layout.Update(r.plugin,{state:{regionState:w(w({},r.plugin.layout.state.regionState),{left:"collapsed"})}})}),this.subscribe(this.plugin.state.data.events.changed,function(n){var a=n.state;r.state.tab==="data"&&a.cells.size===1&&r.set("root")})},t.prototype.render=function(){var r=this,n=this.state.tab;return Te("div",w({className:"msp-left-panel-controls"},{children:[Te("div",w({className:"msp-left-panel-controls-buttons"},{children:[L(Gt,{svg:nx,toggleState:n==="root",transparent:!0,onClick:function(){return r.set("root")},title:"Home"},void 0),L(G_e,{set:this.set},void 0),L(Gt,{svg:CR,toggleState:n==="states",transparent:!0,onClick:function(){return r.set("states")},title:"Plugin State"},void 0),L(Gt,{svg:Hs,toggleState:n==="help",transparent:!0,onClick:function(){return r.set("help")},title:"Help"},void 0),L("div",w({className:"msp-left-panel-controls-buttons-bottom"},{children:L(Gt,{svg:Id,toggleState:n==="settings",transparent:!0,onClick:function(){return r.set("settings")},title:"Settings"},void 0)}),void 0)]}),void 0),L("div",w({className:"msp-scrollable-container"},{children:this.tabs[n]}),void 0)]}),void 0)},t}(hr),G_e=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={changed:!1},r}return Object.defineProperty(t.prototype,"tab",{get:function(){return this.plugin.behaviors.layout.leftPanelTabName.value},enumerable:!1,configurable:!0}),t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.behaviors.layout.leftPanelTabName,function(n){r.tab==="data"?r.setState({changed:!1}):r.forceUpdate()}),this.subscribe(this.plugin.state.data.events.changed,function(n){r.tab!=="data"&&r.setState({changed:!0})})},t.prototype.render=function(){var r=this;return L(Gt,{svg:vR,toggleState:this.tab==="data",transparent:!0,onClick:function(){return r.props.set("data")},title:"State Tree",style:{position:"relative"},extraContent:this.state.changed?L("div",{className:"msp-left-panel-controls-button-data-dirty"},void 0):void 0},void 0)},t}(hr),q_e=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.setSettings=function(n){var a;wt.Canvas3D.SetSettings(r.plugin,{settings:(a={},a[n.name]=n.value,a)})},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.events.canvas3d.settingsUpdated,function(){return r.forceUpdate()}),this.subscribe(this.plugin.layout.events.updated,function(){return r.forceUpdate()}),this.subscribe(this.plugin.canvas3d.camera.stateChanged,function(n){(n.radiusMax!==void 0||n.radius!==void 0)&&r.forceUpdate()})},t.prototype.render=function(){return Te(Rt,{children:[this.plugin.canvas3d&&Te(Rt,{children:[L(Tu,{title:"Viewport"},void 0),L(Pn,{params:vo,values:this.plugin.canvas3d.props,onChange:this.setSettings},void 0)]},void 0),L(Tu,{title:"Behavior"},void 0),L(QL,{state:this.plugin.state.behaviors},void 0)]},void 0)},t}(hr),j_e=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.remove=function(n){n.preventDefault(),wt.State.RemoveObject(r.plugin,{state:r.plugin.state.data,ref:cr.RootRef})},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.events.cell.created,function(n){n.cell.transform.parent===cr.RootRef&&r.forceUpdate()}),this.subscribe(this.plugin.state.events.cell.removed,function(n){n.parent===cr.RootRef&&r.forceUpdate()})},t.prototype.render=function(){var r=this.plugin.state.data.tree.children.get(cr.RootRef).size;return r===0?null:L(Gt,{svg:Oo,onClick:this.remove,title:"Remove All",style:{display:"inline-block"},small:!0,className:"msp-no-hover-outline",transparent:!0},void 0)},t}(hr),eM=5,W_e=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.parentDiv=kt.exports.createRef(),r.lastMouseOverSeqIdx=-1,r.highlightQueue=new Ln,r.lociHighlightProvider=function(n,a){var i=r.props.sequenceWrapper.markResidue(n.loci,a);i&&r.updateMarker()},r.lociSelectionProvider=function(n,a){var i=r.props.sequenceWrapper.markResidue(n.loci,a);i&&r.updateMarker()},r.contextMenu=function(n){n.preventDefault()},r.mouseDownLoci=void 0,r.mouseDown=function(n){n.stopPropagation();var a=r.getSeqIdx(n),i=r.getLoci(a),o=fd(n.nativeEvent),s=$f(n.nativeEvent),u=Xm(n.nativeEvent);r.click(i,o,s,u),r.mouseDownLoci=i},r.mouseUp=function(n){if(n.stopPropagation(),r.mouseDownLoci!==void 0){var a=r.getSeqIdx(n),i=r.getLoci(a);if(i&&!Re.areEqual(r.mouseDownLoci,i)){var o=fd(n.nativeEvent),s=$f(n.nativeEvent),u=Xm(n.nativeEvent),l=r.mouseDownLoci.elements[0],c=i.elements[0],d=Math.min(ke.min(l.indices),ke.min(c.indices)),f=Math.max(ke.max(l.indices),ke.max(c.indices)),p=Re(i.structure,[{unit:l.unit,indices:ke.ofRange(d,f)}]);r.click(Re.subtract(p,r.mouseDownLoci),o,s,u)}r.mouseDownLoci=void 0}},r.location=Ze.create(void 0),r.mouseMove=function(n){n.stopPropagation();var a=fd(n.nativeEvent),i=$f(n.nativeEvent),o=Xm(n.nativeEvent),s=n.target;if(!s||!s.getAttribute){if(r.lastMouseOverSeqIdx===-1)return;r.lastMouseOverSeqIdx=-1,r.highlightQueue.next({seqIdx:-1,buttons:a,button:i,modifiers:o});return}var u=s.hasAttribute("data-seqid")?+s.getAttribute("data-seqid"):-1;if(r.lastMouseOverSeqIdx!==u)if(r.lastMouseOverSeqIdx=u,r.mouseDownLoci!==void 0){var l=r.getLoci(u);r.hover(l,0,0,w(w({},o),{shift:!0}))}else r.highlightQueue.next({seqIdx:u,buttons:a,button:i,modifiers:o})},r.mouseLeave=function(n){if(n.stopPropagation(),r.mouseDownLoci=void 0,r.lastMouseOverSeqIdx!==-1){r.lastMouseOverSeqIdx=-1;var a=fd(n.nativeEvent),i=$f(n.nativeEvent),o=Xm(n.nativeEvent);r.highlightQueue.next({seqIdx:-1,buttons:a,button:i,modifiers:o})}},r}return Object.defineProperty(t.prototype,"sequenceNumberPeriod",{get:function(){if(this.props.sequenceNumberPeriod!==void 0)return this.props.sequenceNumberPeriod;if(this.props.sequenceWrapper.length>10)return 10;var r=this.getSequenceNumber(this.props.sequenceWrapper.length-1);return r.length>1?5:1},enumerable:!1,configurable:!0}),t.prototype.componentDidMount=function(){var r=this;this.plugin.managers.interactivity.lociHighlights.addProvider(this.lociHighlightProvider),this.plugin.managers.interactivity.lociSelects.addProvider(this.lociSelectionProvider),this.subscribe($L(15)(this.highlightQueue),function(n){var a=r.getLoci(n.seqIdx<0?void 0:n.seqIdx);r.hover(a,n.buttons,n.button,n.modifiers)})},t.prototype.componentWillUnmount=function(){e.prototype.componentWillUnmount.call(this),this.plugin.managers.interactivity.lociHighlights.removeProvider(this.lociHighlightProvider),this.plugin.managers.interactivity.lociSelects.removeProvider(this.lociSelectionProvider)},t.prototype.getLoci=function(r){if(r!==void 0){var n=this.props.sequenceWrapper.getLoci(r);if(!Re.isEmpty(n))return n}},t.prototype.getSeqIdx=function(r){var n=void 0,a=r.target;return a&&a.getAttribute&&(n=a.hasAttribute("data-seqid")?+a.getAttribute("data-seqid"):void 0),n},t.prototype.hover=function(r,n,a,i){var o={current:or.Loci.Empty,buttons:n,button:a,modifiers:i};r!==void 0&&!Re.isEmpty(r)&&(o.current={loci:r}),this.plugin.behaviors.interaction.hover.next(o)},t.prototype.click=function(r,n,a,i){var o={current:or.Loci.Empty,buttons:n,button:a,modifiers:i};r!==void 0&&!Re.isEmpty(r)&&(o.current={loci:r}),this.plugin.behaviors.interaction.click.next(o)},t.prototype.getBackgroundColor=function(r){return typeof r=="undefined"&&console.error("unexpected marker value"),r===0?"":r%2===0?"rgb(51, 255, 25)":"rgb(255, 102, 153)"},t.prototype.getResidueClass=function(r,n){return n.length>1?this.props.sequenceWrapper.residueClass(r)+(r===0?" msp-sequence-residue-long-begin":" msp-sequence-residue-long"):this.props.sequenceWrapper.residueClass(r)},t.prototype.residue=function(r,n,a){return L("span",w({"data-seqid":r,style:{backgroundColor:this.getBackgroundColor(a)},className:this.getResidueClass(r,n)},{children:"\u200B"+n+"\u200B"}),r)},t.prototype.getSequenceNumberClass=function(r,n,a){var i=["msp-sequence-number"];return n.startsWith("-")?a.length>1&&r>0?i.push("msp-sequence-number-long-negative"):i.push("msp-sequence-number-negative"):a.length>1&&r>0&&i.push("msp-sequence-number-long"),i.join(" ")},t.prototype.getSequenceNumber=function(r){var n="",a=this.props.sequenceWrapper.getLoci(r),i=Re.getFirstLocation(a,this.location);if(i)if(ze.isAtomic(i.unit)){var o=ct.residue.auth_seq_id(i),s=ct.residue.pdbx_PDB_ins_code(i);n=""+o+(s||"")}else ze.isCoarse(i.unit)&&(n=""+(r+1));return n},t.prototype.padSeqNum=function(r){return r.length<eM?r+new Array(eM-r.length+1).join("\xA0"):r},t.prototype.getSequenceNumberSpan=function(r,n){var a=this.getSequenceNumber(r);return L("span",w({className:this.getSequenceNumberClass(r,a,n)},{children:this.padSeqNum(a)}),"marker-"+r)},t.prototype.updateMarker=function(){if(!!this.parentDiv.current)for(var r=this.parentDiv.current.children,n=this.props.sequenceWrapper.markerArray,a=!this.props.hideSequenceNumbers,i=this.sequenceNumberPeriod,o=0,s=0,u=n.length;s<u;s++){a&&s%i===0&&s<u&&o++;var l=r[o];if(!l)return;o++;var c=this.getBackgroundColor(n[s]);l.style.backgroundColor!==c&&(l.style.backgroundColor=c)}},t.prototype.render=function(){for(var r=this.props.sequenceWrapper,n=[],a=!this.props.hideSequenceNumbers,i=this.sequenceNumberPeriod,o=0,s=r.length;o<s;++o){var u=r.residueLabel(o);a&&o%i===0&&o<s&&(n[n.length]=this.getSequenceNumberSpan(o,u)),n[n.length]=this.residue(o,u,r.markerArray[o])}return this.updateMarker(),L("div",w({className:"msp-sequence-wrapper",onContextMenu:this.contextMenu,onMouseDown:this.mouseDown,onMouseUp:this.mouseUp,onMouseMove:this.mouseMove,onMouseLeave:this.mouseLeave,ref:this.parentDiv},{children:n}),void 0)},t}(hr),A1=function(){function e(t,r,n){this.data=t,this.markerArray=r,this.length=n}return e.prototype.markResidue=function(t,r){return Ao(t)?hs(this.markerArray,Ie.ofLength(this.length),r):this.mark(t,r)},e}(),X_e=function(e){Be(t,e);function t(r){var n=this,a=Ze.create(r.structure,r.units[0],r.units[0].elements[0]),i=r.units[0].model.sequence.byEntityKey[ct.entity.key(a)],o=i.sequence.length,s=new Uint8Array(o);n=e.call(this,r,s,o)||this,n.unitMap=new Map;for(var u=0,l=r.units;u<l.length;u++){var c=l[u];n.unitMap.set(c.id,c)}n.sequence=i.sequence,n.missing=r.units[0].model.properties.missingResidues,n.modelNum=r.units[0].model.modelNum,n.asymId=ze.isAtomic(r.units[0])?ct.chain.label_asym_id(a):ct.coarse.asym_id(a);for(var d=[],f=0;f<o;++f)n.missing.has(n.modelNum,n.asymId,n.seqId(f))&&d.push(f);return n.observed=ke.subtract(Ie.ofBounds(0,o),Je.ofSortedArray(d)),n}return t.prototype.seqId=function(r){return this.sequence.seqId.value(r)},t.prototype.residueLabel=function(r){return this.sequence.label.value(r)||this.sequence.code.value(r)},t.prototype.residueColor=function(r){return this.missing.has(this.modelNum,this.asymId,this.seqId(r))?dr.grey:dr.black},t.prototype.residueClass=function(r){return this.missing.has(this.modelNum,this.asymId,this.seqId(r))?"msp-sequence-missing":"msp-sequence-present"},t.prototype.mark=function(r,n){var a=this,i=!1,o=this.data.structure,s=function(d){return a.sequence.index(d)};if(Re.is(r)){if(!Xe.areRootsEquivalent(r.structure,o))return!1;r=Re.remap(r,o);for(var u=0,l=r.elements;u<l.length;u++){var c=l[u];!this.unitMap.has(c.unit.id)||(ze.isAtomic(c.unit)?i=K_e(c,n,this.markerArray,s):i=$_e(c,n,this.markerArray,s))}}else if(Xe.isLoci(r)){if(!Xe.areRootsEquivalent(r.structure,o))return!1;hs(this.markerArray,this.observed,n)&&(i=!0)}return i},t.prototype.getLoci=function(r){var n=Y_e(this.data.units[0].chainGroupId,this.data.units[0].conformation.operator.name,this.seqId(r));return mt.toLociWithSourceUnits(Fx.run(n,this.data.structure))},t}(A1);function Y_e(e,t,r){return Zr.generators.atoms({unitTest:function(n){return ct.unit.chainGroupId(n.element)===e&&ct.unit.operator_name(n.element)===t},residueTest:function(n){return n.element.unit.kind===0?ct.residue.label_seq_id(n.element)===r:ct.coarse.seq_id_begin(n.element)<=r&&ct.coarse.seq_id_end(n.element)>=r}})}function K_e(e,t,r,n){var a=e.unit,i=a.model,o=a.elements,s=i.atomicHierarchy.residueAtomSegments.index,u=i.atomicHierarchy.residues.label_seq_id;return ke.forEachSegment(e.indices,function(l){return s[o[l]]},function(l){var c=u.value(l);Rg(r,n(c),t)}),!0}function $_e(e,t,r,n){var a=e.unit,i=a.model,o=a.elements,s=ze.isSpheres(e.unit)?i.coarseHierarchy.spheres.seq_id_begin:i.coarseHierarchy.gaussians.seq_id_begin,u=ze.isSpheres(e.unit)?i.coarseHierarchy.spheres.seq_id_end:i.coarseHierarchy.gaussians.seq_id_end;return ke.forEach(e.indices,function(l){for(var c=o[l],d=n(s.value(c)),f=n(u.value(c));d<=f;d++)Rg(r,d,t)}),!0}var Q_e=function(e){Be(t,e);function t(r){for(var n=this,a=[],i=new Map,o=new Map,s=new Map,u=0,l=r.units.length;u<l;++u)for(var c=r.units[u],d=c.model.atomicHierarchy,f=d.residueAtomSegments,p=d.atoms,h=nr.transientSegments(f,c.elements);h.hasNext;){var v=h.move().index;i.set(v,a.length),o.set(a.length,v),s.set(a.length,c),a.push(p.label_comp_id.value(f.offsets[v]))}var m=a.length,g=new Uint8Array(m);n=e.call(this,r,g,m)||this,n.unitMap=new Map;for(var y=0,b=r.units;y<b.length;y++){var c=b[y];n.unitMap.set(c.id,c)}return n.sequence=a,n.sequenceIndices=i,n.residueIndices=o,n.seqToUnit=s,n}return t.prototype.residueLabel=function(r){return this.sequence[r]},t.prototype.residueColor=function(r){return dr.black},t.prototype.residueClass=function(r){return"msp-sequence-present"},t.prototype.mark=function(r,n){var a=this,i=!1,o=this.data.structure;if(Re.is(r)){if(!Xe.areRootsEquivalent(r.structure,o))return!1;r=Re.remap(r,o);for(var s=function(f){var p=u.unitMap.get(f.unit.id);if(p){var h=f.unit.model.atomicHierarchy.residueAtomSegments.index;ke.forEach(f.indices,function(v){var m=a.sequenceIndices.get(h[p.elements[v]]);m!==void 0&&hs(a.markerArray,Ie.ofSingleton(m),n)&&(i=!0)})}},u=this,l=0,c=r.elements;l<c.length;l++){var d=c[l];s(d)}}else if(Xe.isLoci(r)){if(!Xe.areRootsEquivalent(r.structure,o))return!1;hs(this.markerArray,Ie.ofBounds(0,this.length),n)&&(i=!0)}return i},t.prototype.getLoci=function(r){var n=[],a=this.residueIndices.get(r);if(a!==void 0){var i=this.seqToUnit.get(r),o=i.model.atomicHierarchy.residueAtomSegments.offsets,s=Je.findPredecessorIndex(i.elements,o[a]),u=Je.findPredecessorIndex(i.elements,o[a+1]);n.push({unit:i,indices:Ie.ofBounds(s,u)})}return Re(this.data.structure,n)},t}(A1),K2=function(e){Be(t,e);function t(r){for(var n=this,a=0,i=0,o=[],s=Ze.create(r.structure),u=new Map,l=[],c=0,d=r.units.length;c<d;++c){var f=r.units[c];Ze.set(s,r.structure,f,f.elements[0]);var p=f.model.sequence.byEntityKey[ct.entity.key(s)];p&&(a+=p.sequence.length),i+=f.elements.length;var h=Ie.ofBounds(0,f.elements.length);u.set(f.id,h),l.push({unit:f,indices:h})}a>0&&o.push(a+" residues"),o.push(i+" elements");var v=1,m=new Uint8Array(v);return n=e.call(this,r,m,v)||this,n.label="Whole Chain ("+o.join(", ")+")",n.unitIndices=u,n.loci=Re(n.data.structure,l),n}return t.prototype.residueLabel=function(r){return this.label},t.prototype.residueColor=function(r){return dr.black},t.prototype.residueClass=function(r){return"msp-sequence-present"},t.prototype.mark=function(r,n){var a=!1,i=this.data.structure;if(Re.is(r)){if(!Xe.areRootsEquivalent(r.structure,i))return!1;r=Re.remap(r,i);for(var o=0,s=r.elements;o<s.length;o++){var u=s[o],l=this.unitIndices.get(u.unit.id);l&&ke.isSubset(l,u.indices)&&hs(this.markerArray,Ie.ofSingleton(0),n)&&(a=!0)}}else if(Xe.isLoci(r)){if(!Xe.areRootsEquivalent(r.structure,i))return!1;hs(this.markerArray,Ie.ofSingleton(0),n)&&(a=!0)}return a},t.prototype.getLoci=function(r){return this.loci},t}(A1),Z_e=function(e){Be(t,e);function t(r){for(var n=this,a=0,i=new Map,o=0,s=r.units.length;o<s;++o){var u=r.units[o];a+=u.elements.length;var l=Ie.ofBounds(0,u.elements.length);i.set(u.id,l)}var c=new Uint8Array(a);return n=e.call(this,r,c,a)||this,n.unitIndices=i,n}return t.prototype.residueLabel=function(r){return"X"},t.prototype.residueColor=function(r){return dr.black},t.prototype.residueClass=function(r){return"msp-sequence-present"},t.prototype.mark=function(r,n){var a=!1,i=this.data,o=i.structure,s=i.units;if(Re.is(r)){if(!Xe.areRootsEquivalent(r.structure,o))return!1;r=Re.remap(r,o);for(var u=0,l=r.elements;u<l.length;u++){var c=l[u],d=this.unitIndices.get(c.unit.id);d&&ke.isSubset(d,c.indices)&&hs(this.markerArray,c.indices,n)&&(a=!0)}}else if(Xe.isLoci(r)){if(!Xe.areRootsEquivalent(r.structure,o))return!1;for(var f=0,p=s.length;f<p;++f){var d=this.unitIndices.get(s[f].id);hs(this.markerArray,d,n)&&(a=!0)}}return a},t.prototype.getLoci=function(r){for(var n=this.data.units,a=[],i=0,o=0,s=n.length;o<s;++o){var u=n[o];if(r<i+u.elements.length){a.push({unit:u,indices:Ie.ofSingleton(r-i)});break}i+=u.elements.length}return Re(this.data.structure,a)},t}(A1),$2=5e3;function ZL(e){var t=ct.unit.pdbx_struct_oper_list_ids(e),r=ct.unit.struct_ncs_oper_id(e),n=ct.unit.hkl(e),a=ct.unit.spgrOp(e);return t.sort().join(",")+"|"+r+"|"+n+"|"+a}function gw(e){var t=e.split("|"),r=t[0],n=t[1];return[parseInt(r),n]}function tM(e,t){for(var r=e.structure,n=e.modelEntityId,a=e.chainGroupId,i=e.operatorKey,o=Ze.create(r),s=gw(n),u=s[0],l=s[1],c=[],d=0,f=r.units;d<f.length;d++){var p=f[d];Ze.set(o,r,p,p.elements[0]),r.getModelIndex(p.model)===u&&ct.entity.id(o)===l&&p.chainGroupId===a&&ZL(o)===i&&c.push(p)}if(c.length>0){var h={structure:r,units:c},p=c[0],v=void 0;if(p.polymerElements.length){var m=Ze.create(r,p,p.elements[0]),g=p.model.sequence.byEntityKey[ct.entity.key(m)];if(g&&g.sequence.length<=$2)v=new X_e(h);else{var y=c.reduce(function(S,_){return S+_.polymerElements.length},0);ze.isAtomic(p)||y>$2?v=new K2(h):v=new Z_e(h)}}else if(ze.isAtomic(p)){var b=c.reduce(function(S,_){return S+_.residueCount},0);b>$2?v=new K2(h):v=new Q_e(h)}else console.warn("should not happen, expecting coarse units to be polymeric"),v=new K2(h);return v.markResidue(t.getLoci(r),tr.Select),v}else return"No sequence available"}function r0(e,t){t===void 0&&(t=!1);for(var r=[],n=Ze.create(e),a=new Set,i=0,o=e.units;i<o.length;i++){var s=o[i];Ze.set(n,e,s,s.elements[0]);var u=ct.entity.id(n),l=e.getModelIndex(s.model),c=l+"|"+u;if(!a.has(c)&&!(t&&ct.entity.type(n)!=="polymer")){var d=ct.entity.pdbx_description(n).join(", ");e.models.length&&(e.representativeModel?d+=" (Model "+e.models[l].modelNum+")":d.startsWith("Polymer ")&&(d+=" ("+e.models[l].entry+")"));var f=u+": "+d;r.push([c,f]),a.add(c)}}return r.length===0&&r.push(["","No entities"]),r}function ch(e,t){for(var r=[],n=Ze.create(e),a=new Set,i=gw(t),o=i[0],s=i[1],u=0,l=e.units;u<l.length;u++){var c=l[u];if(Ze.set(n,e,c,c.elements[0]),e.getModelIndex(c.model)===o&&ct.entity.id(n)===s){var d=c.chainGroupId;if(!a.has(d)){var f=Go(n,{granularity:"chain",hidePrefix:!0,htmlStyling:!1});r.push([d,f]),a.add(d)}}}return r.length===0&&r.push([-1,"No units"]),r}function Of(e,t,r){for(var n=[],a=Ze.create(e),i=new Set,o=gw(t),s=o[0],u=o[1],l=0,c=e.units;l<c.length;l++){var d=c[l];if(Ze.set(a,e,d,d.elements[0]),e.getModelIndex(d.model)===s&&ct.entity.id(a)===u&&d.chainGroupId===r){var f=ZL(a);if(!i.has(f)){var p=d.conformation.operator.name;n.push([f,p]),i.add(f)}}}return n.length===0&&n.push(["","No operators"]),n}function rM(e){for(var t,r=[],n=[],a=e.select(ar.Generators.rootsOfType(ge.Molecule.Structure)),i=0,o=a;i<o.length;i++){var s=o[i];!(!((t=s.obj)===null||t===void 0)&&t.data)||(n.push(s.obj.data),r.push([s.transform.ref,s.obj.data.label]))}return r.length===0&&r.push(["","No structure"]),{options:r,all:n}}var nM=E.Select("single",[["single","Chain"],["polymers","Polymers"],["all","Everything"]]),J_e=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={structureOptions:{options:[],all:[]},structure:Xe.Empty,structureRef:"",modelEntityId:"",chainGroupId:-1,operatorKey:"",mode:"single"},r.setParamProps=function(n){var a=w({},r.state);switch(n.name){case"mode":if(a.mode=n.value,r.state.mode===a.mode)return;if(a.mode==="all"||a.mode==="polymers")break;case"structure":n.name==="structure"&&(a.structureRef=n.value),a.structure=r.getStructure(a.structureRef),a.modelEntityId=r0(a.structure)[0][0],a.chainGroupId=ch(a.structure,a.modelEntityId)[0][0],a.operatorKey=Of(a.structure,a.modelEntityId,a.chainGroupId)[0][0];break;case"entity":a.modelEntityId=n.value,a.chainGroupId=ch(a.structure,a.modelEntityId)[0][0],a.operatorKey=Of(a.structure,a.modelEntityId,a.chainGroupId)[0][0];break;case"chain":a.chainGroupId=n.value,a.operatorKey=Of(a.structure,a.modelEntityId,a.chainGroupId)[0][0];break;case"operator":a.operatorKey=n.value;break}r.setState(a)},r}return t.prototype.componentDidMount=function(){var r=this;this.plugin.state.data.select(ar.Generators.rootsOfType(ge.Molecule.Structure)).length>0&&this.setState(this.getInitialState()),this.subscribe(this.plugin.state.events.object.updated,function(n){var a=n.ref,i=n.obj;a===r.state.structureRef&&i&&i.type===ge.Molecule.Structure.type&&i.data!==r.state.structure&&r.sync()}),this.subscribe(this.plugin.state.events.object.created,function(n){var a=n.obj;a&&a.type===ge.Molecule.Structure.type&&r.sync()}),this.subscribe(this.plugin.state.events.object.removed,function(n){var a=n.obj;a&&a.type===ge.Molecule.Structure.type&&a.data===r.state.structure&&r.sync()})},t.prototype.sync=function(){var r=rM(this.plugin.state.data);L_(r.all,this.state.structureOptions.all)||this.setState(this.getInitialState())},t.prototype.getStructure=function(r){var n=this.plugin.state.data,a=n.select(r)[0];return!r||!a||!a.obj?Xe.Empty:a.obj.data},t.prototype.getSequenceWrapper=function(r){return{wrapper:tM(this.state,this.plugin.managers.structure.selection),label:E.optionLabel(r.chain,this.state.chainGroupId)+" | "+E.optionLabel(r.entity,this.state.modelEntityId)}},t.prototype.getSequenceWrappers=function(r){if(this.state.mode==="single")return[this.getSequenceWrapper(r)];for(var n=this.getStructure(this.state.structureRef),a=[],i=0,o=r0(n,this.state.mode==="polymers");i<o.length;i++)for(var s=o[i],u=s[0],l=s[1],c=0,d=ch(n,u);c<d.length;c++)for(var f=d[c],p=f[0],h=f[1],v=0,m=Of(n,u,p);v<m.length;v++){var g=m[v][0];a.push({wrapper:tM({structure:n,modelEntityId:u,chainGroupId:p,operatorKey:g},this.plugin.managers.structure.selection),label:h+" | "+l})}return a},t.prototype.getInitialState=function(){var r,n=rM(this.plugin.state.data),a=n.options[0][0],i=this.getStructure(a),o=r0(i)[0][0],s=ch(i,o)[0][0],u=Of(i,o,s)[0][0];return this.state.structure&&this.state.structure===i&&(o=this.state.modelEntityId,s=this.state.chainGroupId,u=this.state.operatorKey),{structureOptions:n,structure:i,structureRef:a,modelEntityId:o,chainGroupId:s,operatorKey:u,mode:(r=this.props.defaultMode)!==null&&r!==void 0?r:"single"}},Object.defineProperty(t.prototype,"params",{get:function(){var r=this.state,n=r.structureOptions,a=r.structure,i=r.modelEntityId,o=r.chainGroupId,s=r0(a),u=ch(a,i),l=Of(a,i,o);return{structure:E.Select(n.options[0][0],n.options,{shortLabel:!0}),entity:E.Select(s[0][0],s,{shortLabel:!0}),chain:E.Select(u[0][0],u,{shortLabel:!0,twoColumns:!0,label:"Chain"}),operator:E.Select(l[0][0],l,{shortLabel:!0,twoColumns:!0}),mode:nM}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"values",{get:function(){return{structure:this.state.structureRef,entity:this.state.modelEntityId,chain:this.state.chainGroupId,operator:this.state.operatorKey,mode:this.state.mode}},enumerable:!1,configurable:!0}),t.prototype.render=function(){if(this.getStructure(this.state.structureRef)===Xe.Empty)return L("div",w({className:"msp-sequence"},{children:Te("div",w({className:"msp-sequence-select"},{children:[L(tn,{svg:Hs,style:{cursor:"help",position:"absolute",right:0,top:0},title:"Shows a sequence of one or more chains. Use the controls to alter selection."},void 0),L("span",{children:"Sequence"},void 0),L("span",w({style:{fontWeight:"normal"}},{children:"No structure available"}),void 0)]}),void 0)}),void 0);var r=this.params,n=this.values,a=this.getSequenceWrappers(r);return Te("div",w({className:"msp-sequence"},{children:[Te("div",w({className:"msp-sequence-select"},{children:[L(tn,{svg:Hs,style:{cursor:"help",position:"absolute",right:0,top:0},title:"This shows a single sequence. Use the controls to show a different sequence."},void 0),L("span",{children:"Sequence of"},void 0),L(Hf,{title:"[Structure] "+E.optionLabel(r.structure,n.structure),param:r.structure,name:"structure",value:n.structure,onChange:this.setParamProps},void 0),L(Hf,{title:"[Mode]",param:nM,name:"mode",value:n.mode,onChange:this.setParamProps},void 0),n.mode==="single"&&L(Hf,{title:"[Entity] "+E.optionLabel(r.entity,n.entity),param:r.entity,name:"entity",value:n.entity,onChange:this.setParamProps},void 0),n.mode==="single"&&L(Hf,{title:"[Chain] "+E.optionLabel(r.chain,n.chain),param:r.chain,name:"chain",value:n.chain,onChange:this.setParamProps},void 0),r.operator.options.length>1&&L(Rt,{children:L(Hf,{title:"[Instance] "+E.optionLabel(r.operator,n.operator),param:r.operator,name:"operator",value:n.operator,onChange:this.setParamProps},void 0)},void 0)]}),void 0),L(e3e,{children:a.map(function(i,o){var s=typeof i.wrapper=="string"?L("div",w({className:"msp-sequence-wrapper"},{children:i.wrapper}),o):L(W_e,{sequenceWrapper:i.wrapper},o);return n.mode==="single"?s:Te(kt.exports.Fragment,{children:[L("div",w({className:"msp-sequence-chain-label"},{children:i.label}),void 0),s]},o)})},void 0)]}),void 0)},t}(hr);function e3e(e){var t=e.children;return L("div",w({className:"msp-sequence-wrapper-non-empty"},{children:t}),void 0)}var t3e=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={tracked:Nn.exports.OrderedMap()},r}return t.prototype.componentDidMount=function(){var r=this,n,a=!!(!((n=this.plugin.spec.components)===null||n===void 0)&&n.hideTaskOverlay);this.subscribe(this.plugin.events.task.progress.pipe(Ly(function(i){return i.level==="background"&&(a||!i.useOverlay)})),function(i){r.setState({tracked:r.state.tracked.set(i.id,i)})}),this.subscribe(this.plugin.events.task.finished,function(i){var o=i.id;r.setState({tracked:r.state.tracked.delete(o)})})},t.prototype.render=function(){return L("div",w({className:"msp-background-tasks"},{children:this.state.tracked.valueSeq().map(function(r){return L(JL,{event:r},r.id)})}),void 0)},t}(hr),JL=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.abort=function(){r.plugin.managers.task.requestAbort(r.props.event.progress.root.progress.taskId,"User Request")},r}return t.prototype.render=function(){var r=this.props.event.progress.root,n=e8(this.props.event.progress.root)-1,a=r.progress.isIndeterminate?void 0:Te(Rt,{children:["[",r.progress.current,"/",r.progress.max,"]"]},void 0),i=n>0?Te(Rt,{children:["[",n," subtask(s)]"]},void 0):void 0;return L("div",w({className:"msp-task-state"},{children:Te("div",{children:[r.progress.canAbort&&L(Gt,{svg:gR,onClick:this.abort,title:"Abort"},void 0),Te("div",{children:[r.progress.message," ",a," ",i]},void 0)]},void 0)}),void 0)},t}(hr);function e8(e){if(e.children.length===0)return 1;for(var t=0,r=0,n=e.children;r<n.length;r++){var a=n[r];t+=e8(a)}return t}var r3e=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={tracked:Nn.exports.OrderedMap()},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.events.task.progress.pipe(Ly(function(n){return!!n.useOverlay})),function(n){r.setState({tracked:r.state.tracked.set(n.id,n)})}),this.subscribe(this.plugin.events.task.finished,function(n){var a=n.id;r.setState({tracked:r.state.tracked.delete(a)})})},t.prototype.render=function(){return this.state.tracked.size===0?null:L("div",w({className:"msp-overlay-tasks"},{children:this.state.tracked.valueSeq().map(function(r){return L(JL,{event:r},r.id)})}),void 0)},t}(hr),n3e=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.hide=function(){var n=r.props.entry;(n.hide||function(){}).call(null)},r}return t.prototype.render=function(){var r=this,n=this.props.entry,a=typeof n.message=="string"?L("div",{dangerouslySetInnerHTML:{__html:n.message}},void 0):L("div",{children:L(n.message,{},void 0)},void 0);return Te("div",w({className:"msp-toast-entry"},{children:[L("div",w({className:"msp-toast-title",onClick:function(){return r.hide()}},{children:n.title}),void 0),L("div",w({className:"msp-toast-message"},{children:a}),void 0),L("div",{className:"msp-toast-clear"},void 0),L("div",w({className:"msp-toast-hide"},{children:L(Gt,{svg:gR,onClick:this.hide,title:"Hide",className:"msp-no-hover-outline"},void 0)}),void 0)]}),void 0)},t}(hr),a3e=function(e){Be(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.toast.events.changed,function(){return r.forceUpdate()})},t.prototype.render=function(){var r=this.plugin.managers.toast.state;if(!r.entries.count())return null;var n=[];return r.entries.forEach(function(a,i){return n.push(a)}),n.sort(function(a,i){return a.serialNumber-i.serialNumber}),L("div",w({className:"msp-toast-container"},{children:n.map(function(a){return L(n3e,{entry:a},a.serialNumber)})}),void 0)},t}(hr),i3e=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.container=kt.exports.createRef(),r.canvas=kt.exports.createRef(),r.state={noWebGl:!1,showLogo:!0},r.handleLogo=function(){var n;r.setState({showLogo:!(!((n=r.plugin.canvas3d)===null||n===void 0)&&n.reprCount.value)})},r}return t.prototype.componentDidMount=function(){if(!this.canvas.current||!this.container.current||!this.plugin.initViewer(this.canvas.current,this.container.current)){this.setState({noWebGl:!0});return}this.handleLogo(),this.subscribe(this.plugin.canvas3d.reprCount,this.handleLogo)},t.prototype.componentWillUnmount=function(){e.prototype.componentWillUnmount.call(this)},t.prototype.renderMissing=function(){if(this.props.noWebGl){var r=this.props.noWebGl;return L(r,{},void 0)}return L("div",w({className:"msp-no-webgl"},{children:Te("div",{children:[L("p",{children:L("b",{children:"WebGL does not seem to be available."},void 0)},void 0),L("p",{children:"This can be caused by an outdated browser, graphics card driver issue, or bad weather. Sometimes, just restarting the browser helps."},void 0),Te("p",{children:["For a list of supported browsers, refer to ",L("a",w({href:"http://caniuse.com/#feat=webgl",target:"_blank"},{children:"http://caniuse.com/#feat=webgl"}),void 0),"."]},void 0)]},void 0)}),void 0)},t.prototype.render=function(){if(this.state.noWebGl)return this.renderMissing();var r=this.props.logo;return Te("div",w({className:this.props.parentClassName||"msp-viewport",style:this.props.parentStyle},{children:[L("div",w({className:this.props.hostClassName||"msp-viewport-host3d",style:this.props.hostStyle,ref:this.container},{children:L("canvas",{ref:this.canvas},void 0)}),void 0),this.state.showLogo&&r&&L(r,{},void 0)]}),void 0)},t}(hr);function hd(e){var t=kt.exports.useState(e==null?void 0:e.value),r=t[0],n=t[1];return kt.exports.useEffect(function(){if(!e){r!==void 0&&n(void 0);return}var a=!0,i=e.subscribe(function(o){a?(a=!1,o!==r&&n(o)):n(o)});return function(){i.unsubscribe()}},[e]),r}var o3e=function(e){var t=e.plugin,r=e.cropFrameColor,n=t.helpers.viewportScreenshot,a=kt.exports.useState(null),i=a[0],o=a[1],s=kt.exports.useRef(null),u=kt.exports.useRef(e);return kt.exports.useEffect(function(){u.current=e},Object.values(e)),kt.exports.useEffect(function(){i!==s.current&&o(s.current)}),kt.exports.useEffect(function(){var l,c=!1,d=[];function f(g,y){!g||d.push(g.subscribe(y))}function p(){var g=u.current;!g.suspend&&s.current&&aM(n,s.current,g.customBackground,g.borderColor,g.borderWidth),s.current||(c=!0)}var h=setInterval(function(){c&&(c=!1,p())},1e3/8);f(t.events.canvas3d.settingsUpdated,function(){return c=!0}),f((l=t.canvas3d)===null||l===void 0?void 0:l.didDraw,function(){return c=!0}),f(t.state.data.behaviors.isUpdating,function(g){g||(c=!0)}),f(n.behaviors.values,function(){return c=!0}),f(n.behaviors.cropParams,function(){return c=!0});var v=void 0;typeof ResizeObserver!="undefined"&&(v=new ResizeObserver(function(){return c=!0}));var m=s.current;return v==null||v.observe(m),p(),function(){clearInterval(h),d.forEach(function(g){return g.unsubscribe()}),v==null||v.unobserve(m)}},[n]),kt.exports.useLayoutEffect(function(){s.current&&aM(n,s.current,e.customBackground,e.borderColor,e.borderWidth)},Nt([],Object.values(e))),L(Rt,{children:Te("div",w({style:{position:"relative",width:"100%",height:"100%"}},{children:[L("canvas",{ref:s,onContextMenu:function(l){l.preventDefault(),l.stopPropagation()},style:{display:"block",width:"100%",height:"100%"}},void 0),L(u3e,{plugin:t,canvas:i,color:r},void 0)]}),void 0)},void 0)},s3e=kt.exports.memo(o3e,function(e,t){return R_(e,t)});function aM(e,t,r,n,a){var i=e.getPreview(),o=i.canvas,s=i.width,u=i.height,l=t.getContext("2d");if(!!l){var c=t.clientWidth,d=t.clientHeight;t.width=c,t.height=d,l.clearRect(0,0,c,d);var f=t8(s,u,c,d);if(r)l.fillStyle=r,l.fillRect(f.x,f.y,f.width,f.height);else if(e.values.transparent)for(var p=13,h=0;h<f.width;h+=p)for(var v=0;v<f.height;v+=p){l.fillStyle=(h+v)%2?"#ffffff":"#bfbfbf";var m=f.x+h,g=f.y+v,y=h+p>f.width?f.width-h:p,b=v+p>f.height?f.height-v:p;l.fillRect(m,g,y,b)}if(l.drawImage(o,f.x,f.y,f.width,f.height),n&&a){var x=a;l.rect(f.x,f.y,f.width,f.height),l.rect(f.x+x,f.y+x,f.width-2*x,f.height-2*x),l.fillStyle=n,l.fill("evenodd")}}}function u3e(e){var t,r=e.plugin,n=e.canvas,a=e.color,i=a===void 0?"rgba(255, 87, 45, 0.75)":a,o=r.helpers.viewportScreenshot,s=hd(o==null?void 0:o.behaviors.values),u=hd(o==null?void 0:o.behaviors.cropParams),l=hd(o==null?void 0:o.behaviors.relativeCrop),c=kt.exports.useRef({x:0,y:0,width:0,height:0});hd((s==null?void 0:s.resolution.name)==="viewport"?(t=r.canvas3d)===null||t===void 0?void 0:t.resized:void 0);var d=kt.exports.useState(""),f=d[0],p=d[1],h=kt.exports.useState([0,0]),v=h[0],m=h[1],g=kt.exports.useState([0,0]),y=g[0],b=g[1];if(!o||!n)return null;var x=o.getSizeAndViewport(),S=x.width,_=x.height,A=t8(S,_,n.clientWidth,n.clientHeight),T={x:A.x+Math.floor(A.width*l.x),y:A.y+Math.floor(A.height*l.y),width:Math.ceil(A.width*l.width),height:Math.ceil(A.height*l.height)},I=iM(T),M=iM(A);if(f==="move"?(I.l+=y[0]-v[0],I.r+=y[0]-v[0],I.t+=y[1]-v[1],I.b+=y[1]-v[1]):f&&(f.indexOf("left")>=0?I.l+=y[0]-v[0]:f.indexOf("right")>=0&&(I.r+=y[0]-v[0]),f.indexOf("top")>=0?I.t+=y[1]-v[1]:f.indexOf("bottom")>=0&&(I.b+=y[1]-v[1])),I.l>I.r){var O=I.l;I.l=I.r,I.r=O}if(I.t>I.b){var O=I.t;I.t=I.b,I.b=O}var D=40;I.l=Math.min(M.r-D,Math.max(M.l,I.l)),I.r=Math.max(M.l+D,Math.min(M.r,I.r)),I.t=Math.min(M.b-D,Math.max(M.t,I.t)),I.b=Math.max(M.t+D,Math.min(M.b,I.b)),T.x=I.l,T.y=I.t,T.width=I.r-I.l+1,T.height=I.b-I.t+1,c.current=T;var F=function(K){K.preventDefault(),b([K.pageX,K.pageY])},G=function(K){K.preventDefault();var U=K.touches[0];b([U.pageX,U.pageY])},N=function(K){K.preventDefault(),p(K.currentTarget.getAttribute("data-drag"));var U=K.touches[0],H=[U.pageX,U.pageY];m(H),b(H),window.addEventListener("touchend",j),window.addEventListener("touchmove",G)},z=function(K){K.preventDefault(),p(K.currentTarget.getAttribute("data-drag"));var U=[K.pageX,K.pageY];m(U),b(U),window.addEventListener("mouseup",$),window.addEventListener("mousemove",F)},$=function(){window.removeEventListener("mouseup",$),window.removeEventListener("mousemove",F),Z()},j=function(){window.removeEventListener("touchend",j),window.removeEventListener("touchmove",G),Z()};function Z(){var K=c.current;u.auto&&(o==null||o.behaviors.cropParams.next(w(w({},u),{auto:!1}))),o==null||o.behaviors.relativeCrop.next({x:(K.x-A.x)/A.width,y:(K.y-A.y)/A.height,width:K.width/A.width,height:K.height/A.height}),p("");var U=[0,0];m(U),b(U)}var q=function(K){K.preventDefault(),K.stopPropagation()},te=4,he="3px solid "+i,W="transparent";return Te(Rt,{children:[L("div",{"data-drag":"move",style:{position:"absolute",left:T.x,top:T.y,width:T.width,height:T.height,border:he,cursor:"move"},onMouseDown:z,onTouchStart:N,draggable:!1,onContextMenu:q},void 0),L("div",{"data-drag":"left",style:{position:"absolute",left:T.x-te,top:T.y+te,width:4*te,height:T.height-te,background:W,cursor:"w-resize"},onMouseDown:z,onTouchStart:N,draggable:!1,onContextMenu:q},void 0),L("div",{"data-drag":"right",style:{position:"absolute",left:I.r-2*te,top:T.y,width:4*te,height:T.height-te,background:W,cursor:"w-resize"},onMouseDown:z,onTouchStart:N,draggable:!1,onContextMenu:q},void 0),L("div",{"data-drag":"top",style:{position:"absolute",left:T.x-te,top:T.y-te,width:T.width+2*te,height:4*te,background:W,cursor:"n-resize"},onMouseDown:z,onTouchStart:N,draggable:!1,onContextMenu:q},void 0),L("div",{"data-drag":"bottom",style:{position:"absolute",left:T.x-te,top:I.b-2*te,width:T.width+2*te,height:4*te,background:W,cursor:"n-resize"},onMouseDown:z,onTouchStart:N,draggable:!1,onContextMenu:q},void 0),L("div",{"data-drag":"top, left",style:{position:"absolute",left:I.l-te,top:I.t-te,width:4*te,height:4*te,background:W,cursor:"nw-resize"},onMouseDown:z,onTouchStart:N,draggable:!1,onContextMenu:q},void 0),L("div",{"data-drag":"bottom, right",style:{position:"absolute",left:I.r-2*te,top:I.b-2*te,width:4*te,height:4*te,background:W,cursor:"nw-resize"},onMouseDown:z,onTouchStart:N,draggable:!1,onContextMenu:q},void 0),L("div",{"data-drag":"top, right",style:{position:"absolute",left:I.r-2*te,top:I.t-te,width:4*te,height:4*te,background:W,cursor:"ne-resize"},onMouseDown:z,onTouchStart:N,draggable:!1,onContextMenu:q},void 0),L("div",{"data-drag":"bottom, left",style:{position:"absolute",left:I.l-te,top:I.b-2*te,width:4*te,height:4*te,background:W,cursor:"ne-resize"},onMouseDown:z,onTouchStart:N,draggable:!1,onContextMenu:q},void 0)]},void 0)}function iM(e){return{l:e.x,t:e.y,r:e.x+e.width-1,b:e.y+e.height-1}}function t8(e,t,r,n){var a=e/t,i=r/n;if(a<=i){var o=n*a;return{x:Math.round((r-o)/2),y:0,width:Math.round(o),height:n}}else{var o=r/a;return{x:0,y:Math.round((n-o)/2),width:r,height:Math.round(o)}}}var l3e=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={showPreview:!0,isDisabled:!1},r.download=function(){var n;(n=r.plugin.helpers.viewportScreenshot)===null||n===void 0||n.download(),r.props.close()},r.copy=function(){return ce(r,void 0,void 0,function(){var n;return de(this,function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,(n=this.plugin.helpers.viewportScreenshot)===null||n===void 0?void 0:n.copyToClipboard()];case 1:return a.sent(),wt.Toast.Show(this.plugin,{message:"Copied to clipboard.",title:"Screenshot",timeoutMs:1500}),[3,3];case 2:return a.sent(),[2,this.copyImg()];case 3:return[2]}})})},r.copyImg=function(){return ce(r,void 0,void 0,function(){var n,a;return de(this,function(i){switch(i.label){case 0:return[4,(a=this.plugin.helpers.viewportScreenshot)===null||a===void 0?void 0:a.getImageDataUri()];case 1:return n=i.sent(),this.setState({imageData:n}),[2]}})})},r.open=function(n){!n.target.files||!n.target.files[0]||wt.State.Snapshots.OpenFile(r.plugin,{file:n.target.files[0]})},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.data.behaviors.isUpdating,function(n){r.setState({isDisabled:n})})},t.prototype.componentWillUnmount=function(){this.setState({imageData:void 0})},t.prototype.render=function(){var r=this,n,a=!!(!((n=navigator.clipboard)===null||n===void 0)&&n.write);return Te("div",{children:[this.state.showPreview&&Te("div",w({className:"msp-image-preview"},{children:[L(s3e,{plugin:this.plugin},void 0),L(d3e,{plugin:this.plugin},void 0)]}),void 0),Te("div",w({className:"msp-flex-row"},{children:[!this.state.imageData&&L(pr,w({icon:Vj,onClick:a?this.copy:this.copyImg,disabled:this.state.isDisabled},{children:"Copy"}),void 0),this.state.imageData&&L(pr,w({onClick:function(){return r.setState({imageData:void 0})},disabled:this.state.isDisabled},{children:"Clear"}),void 0),L(pr,w({icon:rx,onClick:this.download,disabled:this.state.isDisabled},{children:"Download"}),void 0)]}),void 0),this.state.imageData&&Te("div",w({className:"msp-row msp-copy-image-wrapper"},{children:[L("div",{children:"Right click below + Copy Image"},void 0),L("img",{src:this.state.imageData,style:{width:"100%",height:32,display:"block"}},void 0)]}),void 0),L(c3e,{plugin:this.plugin,isDisabled:this.state.isDisabled},void 0),Te(ls,w({header:"State"},{children:[L(XL,{onAction:this.props.close},void 0),L(ls,w({header:"Save Options",initiallyExpanded:!1,noOffset:!0},{children:L(YL,{},void 0)}),void 0)]}),void 0)]},void 0)},t}(hr);function c3e(e){var t=e.plugin,r=e.isDisabled,n=t.helpers.viewportScreenshot,a=hd(n.behaviors.values);return L(Pn,{params:n.params,values:a,onChangeValues:function(i){return n.behaviors.values.next(i)},isDisabled:r},void 0)}function d3e(e){var t=e.plugin,r=t.helpers.viewportScreenshot,n=hd(r==null?void 0:r.behaviors.cropParams);return hd(r==null?void 0:r.behaviors.relativeCrop),r?Te("div",w({style:{width:"100%",height:"24px",marginTop:"8px"}},{children:[L(oa,{icon:Xj,title:"Auto-crop",inline:!0,isSelected:n.auto,style:{background:"transparent",float:"left",width:"auto",height:"24px",lineHeight:"24px"},toggle:function(){return r.toggleAutocrop()},label:"Auto-crop "+(n.auto?"On":"Off")},void 0),!n.auto&&L(pr,{icon:Gj,title:"Crop",style:{background:"transparent",float:"right",height:"24px",lineHeight:"24px",width:"24px",padding:"0"},onClick:function(){return r.autocrop()}},void 0),!n.auto&&!r.isFullFrame&&L(pr,{icon:jj,title:"Reset Crop",style:{background:"transparent",float:"right",height:"24px",lineHeight:"24px",width:"24px",padding:"0"},onClick:function(){return r.resetCrop()}},void 0)]}),void 0):null}function f3e(e){return function(t){var r=t.values,n=t.update,a=t.apply;return{params:typeof e.params=="function"?e.params:function(i){return e.params},getTarget:e.target,getValues:r,update:function(i,o){var s=e.target(o);return Vu(s,function(u){return n(i,u,o)})},apply:a||function(){}}}}var p3e=function(e){Be(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.events.canvas3d.settingsUpdated,function(){return r.forceUpdate()}),this.subscribe(this.plugin.canvas3d.camera.stateChanged,function(n){(n.radiusMax!==void 0||n.radius!==void 0)&&r.forceUpdate()})},t.prototype.render=function(){return this.plugin.canvas3d?Te(Rt,{children:[L(V2e,{mapping:v3e},void 0),L(nw,{},void 0)]},void 0):null},t}(hr),B0={sequence:"Sequence",log:"Log",left:"Left Panel"},h3e={spin:E.Group({spin:vo.trackball.params.spin,speed:vo.trackball.params.spinSpeed},{pivot:"spin"}),camera:vo.camera,background:E.Group({color:E.Color(it(16579577),{label:"Background",description:"Custom background color"}),transparent:E.Boolean(!1)},{pivot:"color"}),lighting:E.Group({renderStyle:vo.renderer.params.style,occlusion:vo.postprocessing.params.occlusion,outline:vo.postprocessing.params.outline,fog:vo.cameraFog},{pivot:"renderStyle"}),clipping:E.Group(w(w({},vo.cameraClipping.params),vo.renderer.params.clip.params),{pivot:"radius"}),layout:E.MultiSelect([],E.objectToOptions(B0))},v3e=f3e({params:function(e){var t,r=E.clone(h3e),n=(t=e.spec.components)===null||t===void 0?void 0:t.controls;if(n){var a=[];n.top!=="none"&&a.push(["sequence",B0.sequence]),n.bottom!=="none"&&a.push(["log",B0.log]),n.left!=="none"&&a.push(["left",B0.left]),r.layout.options=a}return r},target:function(e){var t,r,n=(t=e.spec.components)===null||t===void 0?void 0:t.controls,a=e.layout.state.regionState,i=[];return a.top!=="hidden"&&(!n||n.top!=="none")&&i.push("sequence"),a.bottom!=="hidden"&&(!n||n.bottom!=="none")&&i.push("log"),a.left!=="hidden"&&(!n||n.left!=="none")&&i.push("left"),{canvas:(r=e.canvas3d)===null||r===void 0?void 0:r.props,layout:i}}})({values:function(e,t){var r=e.canvas,n=r.renderer;return{layout:e.layout,spin:{spin:!!r.trackball.spin,speed:r.trackball.spinSpeed},camera:r.camera,background:{color:n.backgroundColor,transparent:r.transparentBackground},lighting:{renderStyle:n.style,occlusion:r.postprocessing.occlusion,outline:r.postprocessing.outline,fog:r.cameraFog},clipping:w(w({},r.cameraClipping),r.renderer.clip)}},update:function(e,t){var r=t.canvas;r.trackball.spin=e.spin.spin,r.trackball.spinSpeed=e.spin.speed,r.camera=e.camera,r.transparentBackground=e.background.transparent,r.renderer.backgroundColor=e.background.color,r.renderer.style=e.lighting.renderStyle,r.postprocessing.occlusion=e.lighting.occlusion,r.postprocessing.outline=e.lighting.outline,r.cameraFog=e.lighting.fog,r.cameraClipping={radius:e.clipping.radius,far:e.clipping.far},r.renderer.clip={variant:e.clipping.variant,objects:e.clipping.objects},t.layout=e.layout},apply:function(e,t){return ce(this,void 0,void 0,function(){var r,n;return de(this,function(a){switch(a.label){case 0:return[4,wt.Canvas3D.SetSettings(t,{settings:e.canvas})];case 1:return a.sent(),r=e.layout.indexOf("left")<0,n=Vu(t.layout.state,function(i){i.regionState.top=e.layout.indexOf("sequence")>=0?"full":"hidden",i.regionState.bottom=e.layout.indexOf("log")>=0?"full":"hidden",i.regionState.left=r?"hidden":t.behaviors.layout.leftPanelTabName.value==="none"?"collapsed":"full"}),[4,wt.Layout.Update(t,{state:n})];case 2:return a.sent(),r&&wt.State.SetCurrentObject(t,{state:t.state.data,ref:cr.RootRef}),[2]}})})}}),m3e=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.allCollapsedState={isSettingsExpanded:!1,isScreenshotExpanded:!1},r.state=w({},r.allCollapsedState),r.resetCamera=function(){wt.Camera.Reset(r.plugin,{})},r.toggleSettingsExpanded=r.toggle("isSettingsExpanded"),r.toggleScreenshotExpanded=r.toggle("isScreenshotExpanded"),r.toggleControls=function(){wt.Layout.Update(r.plugin,{state:{showControls:!r.plugin.layout.state.showControls}})},r.toggleExpanded=function(){wt.Layout.Update(r.plugin,{state:{isExpanded:!r.plugin.layout.state.isExpanded}})},r.setSettings=function(n){var a;wt.Canvas3D.SetSettings(r.plugin,{settings:(a={},a[n.name]=n.value,a)})},r.setLayout=function(n){var a;wt.Layout.Update(r.plugin,{state:(a={},a[n.name]=n.value,a)})},r.screenshot=function(){var n;(n=r.plugin.helpers.viewportScreenshot)===null||n===void 0||n.download()},r.onMouseMove=function(n){n.buttons===0&&n.stopPropagation()},r}return t.prototype.toggle=function(r){var n=this;return function(a){var i;n.setState(w(w({},n.allCollapsedState),(i={},i[r]=!n.state[r],i))),a==null||a.currentTarget.blur()}},t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.events.canvas3d.settingsUpdated,function(){return r.forceUpdate()}),this.subscribe(this.plugin.layout.events.updated,function(){return r.forceUpdate()})},t.prototype.icon=function(r,n,a,i){return i===void 0&&(i=!0),L(Gt,{svg:r,toggleState:i,onClick:n,title:a,style:{background:"transparent"}},void 0)},t.prototype.render=function(){return Te("div",w({className:"msp-viewport-controls",onMouseMove:this.onMouseMove},{children:[Te("div",w({className:"msp-viewport-controls-buttons"},{children:[Te("div",{children:[L("div",{className:"msp-semi-transparent-background"},void 0),this.icon(gj,this.resetCamera,"Reset Camera")]},void 0),Te("div",{children:[L("div",{className:"msp-semi-transparent-background"},void 0),this.icon(Pj,this.toggleScreenshotExpanded,"Screenshot / State Snapshot",this.state.isScreenshotExpanded)]},void 0),Te("div",{children:[L("div",{className:"msp-semi-transparent-background"},void 0),this.plugin.config.get(jr.Viewport.ShowControls)&&this.icon(Cj,this.toggleControls,"Toggle Controls Panel",this.plugin.layout.state.showControls),this.plugin.config.get(jr.Viewport.ShowExpand)&&this.icon(Jj,this.toggleExpanded,"Toggle Expanded Viewport",this.plugin.layout.state.isExpanded),this.plugin.config.get(jr.Viewport.ShowSettings)&&this.icon(Id,this.toggleSettingsExpanded,"Settings / Controls Info",this.state.isSettingsExpanded)]},void 0),this.plugin.config.get(jr.Viewport.ShowSelectionMode)&&Te("div",{children:[L("div",{className:"msp-semi-transparent-background"},void 0),L(Jg,{},void 0)]},void 0)]}),void 0),this.state.isScreenshotExpanded&&L("div",w({className:"msp-viewport-controls-panel"},{children:L(Pu,w({header:"Screenshot / State",title:"Click to close.",initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.toggleScreenshotExpanded,topRightIcon:Au,noTopMargin:!0,childrenClassName:"msp-viewport-controls-panel-controls"},{children:L(l3e,{close:this.toggleScreenshotExpanded},void 0)}),void 0)}),void 0),this.state.isSettingsExpanded&&L("div",w({className:"msp-viewport-controls-panel"},{children:L(Pu,w({header:"Settings / Controls Info",title:"Click to close.",initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.toggleSettingsExpanded,topRightIcon:Au,noTopMargin:!0,childrenClassName:"msp-viewport-controls-panel-controls"},{children:L(p3e,{},void 0)}),void 0)}),void 0)]}),void 0)},t}(hr),g3e=function(){return L("a",{className:"msp-logo",href:"https://molstar.org",target:"_blank"},void 0)},y3e=function(){return L(i3e,{logo:g3e},void 0)},b3e=function(e){Be(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.region=function(r,n){return L("div",w({className:"msp-layout-region msp-layout-"+r},{children:L("div",w({className:"msp-layout-static"},{children:n}),void 0)}),void 0)},t.prototype.render=function(){return L(Dy.Provider,w({value:this.props.plugin},{children:L(S3e,{},void 0)}),void 0)},t}(kt.exports.Component);(function(e){Be(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.render=function(){return L(Dy.Provider,w({value:this.props.plugin},{children:L("div",w({className:"msp-plugin"},{children:this.props.children}),void 0)}),void 0)},t})(kt.exports.Component);var S3e=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onDrop=function(n){n.preventDefault();var a;if(n.dataTransfer.items){for(var i=0;i<n.dataTransfer.items.length;i++)if(n.dataTransfer.items[i].kind==="file"){a=n.dataTransfer.items[i].getAsFile();break}}else a=n.dataTransfer.files[0];if(!!a){var o=(a==null?void 0:a.name.toLowerCase())||"";(o.endsWith("molx")||o.endsWith("molj"))&&wt.State.Snapshots.OpenFile(r.plugin,{file:a})}},r.onDragOver=function(n){n.preventDefault()},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.layout.events.updated,function(){return r.forceUpdate()})},t.prototype.region=function(r,n){return L("div",w({className:"msp-layout-region msp-layout-"+r},{children:L("div",w({className:"msp-layout-static"},{children:n?L(n,{},void 0):null}),void 0)}),void 0)},Object.defineProperty(t.prototype,"layoutVisibilityClassName",{get:function(){var r,n,a=this.plugin.layout.state,i=(n=(r=this.plugin.spec.components)===null||r===void 0?void 0:r.controls)!==null&&n!==void 0?n:{},o=[];return(i.top==="none"||!a.showControls||a.regionState.top==="hidden")&&o.push("msp-layout-hide-top"),i.left==="none"||!a.showControls||a.regionState.left==="hidden"?o.push("msp-layout-hide-left"):a.regionState.left==="collapsed"&&o.push("msp-layout-collapse-left"),(i.right==="none"||!a.showControls||a.regionState.right==="hidden")&&o.push("msp-layout-hide-right"),(i.bottom==="none"||!a.showControls||a.regionState.bottom==="hidden")&&o.push("msp-layout-hide-bottom"),o.join(" ")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"layoutClassName",{get:function(){var r=this.plugin.layout.state,n=["msp-plugin-content"];return r.isExpanded?n.push("msp-layout-expanded"):n.push("msp-layout-standard","msp-layout-standard-"+r.controlsDisplay),n.join(" ")},enumerable:!1,configurable:!0}),t.prototype.render=function(){var r,n,a,i,o=this.plugin.layout.state,s=((r=this.plugin.spec.components)===null||r===void 0?void 0:r.controls)||{},u=((a=(n=this.plugin.spec.components)===null||n===void 0?void 0:n.viewport)===null||a===void 0?void 0:a.view)||C3e;return L("div",w({className:"msp-plugin",onDrop:this.onDrop,onDragOver:this.onDragOver},{children:Te("div",w({className:this.layoutClassName},{children:[Te("div",w({className:this.layoutVisibilityClassName},{children:[this.region("main",u),o.showControls&&s.top!=="none"&&this.region("top",s.top||J_e),o.showControls&&s.left!=="none"&&this.region("left",s.left||H_e),o.showControls&&s.right!=="none"&&this.region("right",s.right||x3e),o.showControls&&s.bottom!=="none"&&this.region("bottom",s.bottom||_3e)]}),void 0),!(!((i=this.plugin.spec.components)===null||i===void 0)&&i.hideTaskOverlay)&&L(r3e,{},void 0)]}),void 0)}),void 0)},t}(hr),x3e=function(e){Be(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.render=function(){var r,n=((r=this.plugin.spec.components)===null||r===void 0?void 0:r.structureTools)||E_e;return L("div",w({className:"msp-scrollable-container"},{children:L(n,{},void 0)}),void 0)},t}(hr),C3e=function(e){Be(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.render=function(){var r,n,a=((n=(r=this.plugin.spec.components)===null||r===void 0?void 0:r.viewport)===null||n===void 0?void 0:n.controls)||m3e;return Te(Rt,{children:[L(y3e,{},void 0),Te("div",w({className:"msp-viewport-top-left-controls"},{children:[L(w_e,{},void 0),L(C_e,{},void 0),L(__e,{},void 0)]}),void 0),L(A_e,{},void 0),L(a,{},void 0),L(t3e,{},void 0),Te("div",w({className:"msp-highlight-toast-wrapper"},{children:[L(P_e,{},void 0),L(a3e,{},void 0)]}),void 0)]},void 0)},t}(hr),_3e=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.wrapper=kt.exports.createRef(),r.state={entries:r.plugin.log.entries},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.events.log,function(){return r.setState({entries:r.plugin.log.entries})})},t.prototype.componentDidUpdate=function(){this.scrollToBottom()},t.prototype.scrollToBottom=function(){var r=this.wrapper.current;r&&(r.scrollTop=r.scrollHeight-r.clientHeight-1)},t.prototype.render=function(){for(var r=10,n=this.state.entries,a=n.size,i=[],o=Math.max(0,a-r),s=0;o<a;o++){var u=n.get(o);i.push(Te("li",{children:[L("div",{className:"msp-log-entry-badge msp-log-entry-"+u.type},void 0),L("div",w({className:"msp-log-timestamp"},{children:HH(u.timestamp)}),void 0),L("div",w({className:"msp-log-entry"},{children:u.message}),void 0)]},s++))}return L("div",w({ref:this.wrapper,className:"msp-log",style:{position:"absolute",top:"0",right:"0",bottom:"0",left:"0",overflowY:"auto"}},{children:L("ul",w({className:"msp-list-unstyled"},{children:i}),void 0)}),void 0)},t}(hr);function w3e(e,t,r,n){n===void 0&&(n=1),e.width=Math.round(window.devicePixelRatio*n*t),e.height=Math.round(window.devicePixelRatio*n*r),Object.assign(e.style,{width:t+"px",height:r+"px"})}function A3e(e,t,r){r===void 0&&(r=1);var n=window.innerWidth,a=window.innerHeight;t!==document.body&&(n=t.offsetWidth,a=t.offsetHeight),w3e(e,n,a,r)}function P3e(e,t,r,n){for(var a=atob(e.toDataURL(r,n).split(",")[1]),i=a.length,o=i>>2,s=new Uint8Array(i),u=new Uint32Array(s.buffer,0,o),l=0,c=0;c<o;++c)u[c]=a.charCodeAt(l++)|a.charCodeAt(l++)<<8|a.charCodeAt(l++)<<16|a.charCodeAt(l++)<<24;for(var d=i&3;d--;)s[l]=a.charCodeAt(l++);t(new Blob([s],{type:r||"image/png"}))}function oM(e,t,r){return ce(this,void 0,void 0,function(){return de(this,function(n){return[2,new Promise(function(a,i){var o=function(s){s?a(s):i("no blob returned")};HTMLCanvasElement.prototype.toBlob?e.toBlob(o,t,r):P3e(e,o,t,r)})]})})}var uy;(function(e){var t=function(){function r(){this.providers=Nn.exports.OrderedMap().asMutable(),this.defaultAutoAttachValues=new Map}return r.prototype.getParams=function(n){var a={},i=[],o=[];if(n)for(var s=this.providers.values();;){var u=s.next();if(u.done)break;var l=u.value;!l.isApplicable(n)||(l.isHidden||(i.push([l.descriptor.name,l.label]),this.defaultAutoAttachValues.get(l.descriptor.name)&&o.push(l.descriptor.name)),a[l.descriptor.name]=E.Group(w({},l.getParams(n)),{label:l.label,isHidden:l.isHidden}))}return{autoAttach:E.MultiSelect(o,i),properties:E.Group(a,{isFlat:!0})}},r.prototype.setDefaultAutoAttach=function(n,a){this.defaultAutoAttachValues.set(n,a)},r.prototype.get=function(n){var a=this.providers.get(n);if(!a)throw new Error("Custom property '"+n+"' is not registered.");return this.providers.get(n)},r.prototype.register=function(n,a){this.providers.set(n.descriptor.name,n),this.defaultAutoAttachValues.set(n.descriptor.name,a)},r.prototype.unregister=function(n){this.providers.delete(n),this.defaultAutoAttachValues.delete(n)},r}();e.Registry=t})(uy||(uy={}));var T3e=["gz","zip"],E3e=["bcif","ccp4","dcd"];function yw(e){var t,r,n="";e instanceof File?t=e.name:e instanceof Blob?t="":t=e;var a=t.lastIndexOf("?"),i=a!==-1?t.substring(a):"";t=t.substring(0,a===-1?t.length:a);var o=t.replace(/^.*[\\/]/,""),s=o.substring(0,o.lastIndexOf(".")),u=o.split("."),l=u.length>1?(u.pop()||"").toLowerCase():"",c=t.match(/^(.+):\/\/(.+)$/);c&&(n=c[1].toLowerCase(),t=c[2]||"");var d=t.substring(0,t.lastIndexOf("/")+1);if(T3e.includes(l)){r=l;var f=t.length-l.length-1;l=(t.substr(0,f).split(".").pop()||"").toLowerCase();var p=s.length-l.length-1;s=s.substr(0,p)}else r=!1;var h=E3e.includes(l);return{path:t,name:o,ext:l,base:s,dir:d,compressed:r,binary:h,protocol:n,query:i,src:e}}var I3e=function(){function e(t){this.plugin=t}return Object.defineProperty(e.prototype,"dataState",{get:function(){return this.plugin.state.data},enumerable:!1,configurable:!0}),e.prototype.rawData=function(t,r){var n=this.dataState.build().toRoot().apply(AO,t,r);return n.commit({revertOnError:!0})},e.prototype.download=function(t,r){var n=this.dataState.build().toRoot().apply(_O,t,r);return n.commit({revertOnError:!0})},e.prototype.downloadBlob=function(t,r){var n=this.dataState.build().toRoot().apply(wO,t,r);return n.commit({revertOnError:!0})},e.prototype.readFile=function(t,r){var n;return ce(this,void 0,void 0,function(){var a,i;return de(this,function(o){switch(o.label){case 0:return[4,this.dataState.build().toRoot().apply(PO,t,r).commit({revertOnError:!0})];case 1:return a=o.sent(),i=yw(((n=t.file)===null||n===void 0?void 0:n.file)||""),[2,{data:a,fileInfo:i}]}})})},e}(),M3e=function(){function e(t){var r=this;this.plugin=t,this._providers=[],this.providerMap=new Map,this.defaultProvider=tp.auto,cs(tp,function(n){return r.registerPreset(n)})}return Object.defineProperty(e.prototype,"dataState",{get:function(){return this.plugin.state.data},enumerable:!1,configurable:!0}),e.prototype.resolveProvider=function(t){var r;return typeof t=="string"?(r=tp[t])!==null&&r!==void 0?r:T_(this._providers,function(n){return n.id===t}):t},e.prototype.hasPreset=function(t){for(var r=0,n=this._providers;r<n.length;r++){var a=n[r];if(!a.isApplicable||a.isApplicable(t,this.plugin))return!0}return!1},Object.defineProperty(e.prototype,"providers",{get:function(){return this._providers},enumerable:!1,configurable:!0}),e.prototype.getPresets=function(t){if(!t)return this.providers;for(var r=[],n=0,a=this._providers;n<a.length;n++){var i=a[n];i.isApplicable&&!i.isApplicable(t,this.plugin)||r.push(i)}return r},e.prototype.getPresetSelect=function(t){for(var r=[],n=0,a=this._providers;n<a.length;n++){var i=a[n];t&&i.isApplicable&&!i.isApplicable(t,this.plugin)||r.push([i.id,i.display.name,i.display.group])}return E.Select("auto",r)},e.prototype.getPresetsWithOptions=function(t){for(var r=[],n=Object.create(null),a=0,i=this._providers;a<i.length;a++){var o=i[a];o.isApplicable&&!o.isApplicable(t,this.plugin)||(r.push([o.id,o.display.name]),n[o.id]=o.params?E.Group(o.params(t,this.plugin)):E.EmptyGroup())}return r.length===0?E.MappedStatic("",{"":E.EmptyGroup()}):E.MappedStatic(r[0][0],n,{options:r})},e.prototype.registerPreset=function(t){if(this.providerMap.has(t.id))throw new Error("Representation provider with id '"+t.id+"' already registered.");this._providers.push(t),this.providerMap.set(t.id,t)},e.prototype.unregisterPreset=function(t){this.providerMap.delete(t.id),sv(this._providers,t)},e.prototype.applyPreset=function(t,r,n){var a=this,i,o=this.resolveProvider(r);if(!!o){var s=this.plugin.state.data,u=ua.resolveAndCheck(s,t);if(!u){Pp||console.warn("Applying structure repr. provider to bad cell.");return}var l=((i=o.params)===null||i===void 0?void 0:i.call(o,u.obj,this.plugin))||{},c=n||(o.params?E.getDefaultValues(l):{}),d=this.plugin.config.get(jr.Structure.DefaultRepresentationPresetParams);c=E.merge(l,d,c);var f=We.create(""+o.display.name,function(){return o.apply(u,c,a.plugin)});return this.plugin.runTask(f)}},e.prototype.addRepresentation=function(t,r,n){return ce(this,void 0,void 0,function(){var a,i;return de(this,function(o){switch(o.label){case 0:return a=this.dataState.build(),i=this.buildRepresentation(a,t,r,n),i?[4,a.commit()]:[2];case 1:return o.sent(),[2,i]}})})},e.prototype.buildRepresentation=function(t,r,n,a){var i,o;if(!!r){var s=(o=(i=ua.resolveAndCheck(this.dataState,r))===null||i===void 0?void 0:i.obj)===null||o===void 0?void 0:o.data;if(!!s){var u=O0(this.plugin,s,n);return a!=null&&a.tag?t.to(r).applyOrUpdateTagged(a.tag,kg,u,{state:a==null?void 0:a.initialState}).selector:t.to(r).apply(kg,u,{state:a==null?void 0:a.initialState}).selector}}},e}();function _c(e){return e}(function(e){e.CommonParams=function(t,r){return{modelProperties:E.Optional(E.Group(ft.getParamDefinition(rt.Model.CustomModelProperties,void 0,r))),structureProperties:E.Optional(E.Group(ft.getParamDefinition(rt.Model.CustomStructureProperties,void 0,r))),representationPreset:E.Optional(E.Text("auto"))}}})(_c||(_c={}));var P1=_c.CommonParams,D3e=function(e,t){return w({model:E.Optional(E.Group(ft.getParamDefinition(rt.Model.ModelFromTrajectory,e,t))),showUnitcell:E.Optional(E.Boolean(!1)),structure:E.Optional(wd.getParams(void 0,"assembly").type),representationPresetParams:E.Optional(E.Group(fi.CommonParams))},P1(e,t))},r8=_c({id:"preset-trajectory-default",display:{name:"Default (Assembly)",group:"Preset",description:"Shows the first assembly or, if that is unavailable, the first model."},isApplicable:function(e){return!0},params:D3e,apply:function(e,t,r){return ce(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c;return de(this,function(d){switch(d.label){case 0:return n=r.builders.structure,[4,n.createModel(e,t.model)];case 1:return a=d.sent(),[4,n.insertModelProperties(a,t.modelProperties)];case 2:return i=d.sent(),[4,n.createStructure(i||a,t.structure)];case 3:return o=d.sent(),[4,n.insertStructureProperties(o,t.structureProperties)];case 4:return s=d.sent(),t.showUnitcell===void 0||!!t.showUnitcell?[4,n.tryCreateUnitcell(i,void 0,{isHidden:!0})]:[3,6];case 5:return l=d.sent(),[3,7];case 6:l=void 0,d.label=7;case 7:return u=l,[4,r.builders.structure.representation.applyPreset(s,t.representationPreset||"auto",t.representationPresetParams)];case 8:return c=d.sent(),[2,{model:a,modelProperties:i,unitcell:u,structure:o,structureProperties:s,representation:c}]}})})}}),R3e=function(e,t){return w({useDefaultIfSingleModel:E.Optional(E.Boolean(!1)),representationPresetParams:E.Optional(E.Group(fi.CommonParams))},P1(e,t))},O3e=_c({id:"preset-trajectory-all-models",display:{name:"All Models",group:"Preset",description:"Shows all models; colored by model-index."},isApplicable:function(e){return e.data.frameCount>1},params:R3e,apply:function(e,t,r){var n,a;return ce(this,void 0,void 0,function(){var i,o,s,u,l,c,d,f,p,h;return de(this,function(v){switch(v.label){case 0:if(i=(a=(n=ua.resolveAndCheck(r.state.data,e))===null||n===void 0?void 0:n.obj)===null||a===void 0?void 0:a.data,!i)return[2,{}];if(i.frameCount===1&&t.useDefaultIfSingleModel)return[2,r8.apply(e,t,r)];o=r.builders.structure,s=[],u=[],l=0,v.label=1;case 1:return l<i.frameCount?[4,o.createModel(e,{modelIndex:l})]:[3,8];case 2:return c=v.sent(),[4,o.insertModelProperties(c,t.modelProperties,{isCollapsed:!0})];case 3:return d=v.sent(),[4,o.createStructure(d||c,{name:"model",params:{}})];case 4:return f=v.sent(),[4,o.insertStructureProperties(f,t.structureProperties)];case 5:return p=v.sent(),s.push(c),u.push(f),h=f.obj?Sk(f.obj.data,{elementCountFactor:i.frameCount}):"medium",[4,o.representation.applyPreset(p,t.representationPreset||"auto",{theme:{globalName:"model-index"},quality:h})];case 6:v.sent(),v.label=7;case 7:return l++,[3,1];case 8:return[2,{models:s,structures:u}]}})})}}),n8=function(e,t){return w({model:E.Optional(E.Group(ft.getParamDefinition(rt.Model.ModelFromTrajectory,e,t)))},P1(e,t))};function a8(e,t,r,n){return ce(this,void 0,void 0,function(){var a,i,o,s,u,l,c;return de(this,function(d){switch(d.label){case 0:return a=n.builders.structure,[4,a.createModel(t,r.model)];case 1:return i=d.sent(),[4,a.insertModelProperties(i,r.modelProperties)];case 2:return o=d.sent(),[4,a.createStructure(o||i,{name:"symmetry",params:e})];case 3:return s=d.sent(),[4,a.insertStructureProperties(s,r.structureProperties)];case 4:return u=d.sent(),[4,a.tryCreateUnitcell(o,void 0,{isHidden:!1})];case 5:return l=d.sent(),[4,n.builders.structure.representation.applyPreset(u,r.representationPreset||"auto",{theme:{globalName:e.theme}})];case 6:return c=d.sent(),[2,{model:i,modelProperties:o,unitcell:l,structure:s,structureProperties:u,representation:c}]}})})}var F3e=_c({id:"preset-trajectory-unitcell",display:{name:"Unit Cell",group:"Preset",description:"Shows the fully populated unit cell."},isApplicable:function(e){return jt.hasCrystalSymmetry(e.data.representative)},params:n8,apply:function(e,t,r){return ce(this,void 0,void 0,function(){return de(this,function(n){switch(n.label){case 0:return[4,a8({ijkMin:C.create(0,0,0),ijkMax:C.create(0,0,0)},e,t,r)];case 1:return[2,n.sent()]}})})}}),k3e=_c({id:"preset-trajectory-supercell",display:{name:"Super Cell",group:"Preset",description:"Shows the super cell, i.e. the central unit cell and all adjacent unit cells."},isApplicable:function(e){return jt.hasCrystalSymmetry(e.data.representative)},params:n8,apply:function(e,t,r){return ce(this,void 0,void 0,function(){return de(this,function(n){switch(n.label){case 0:return[4,a8({ijkMin:C.create(-1,-1,-1),ijkMax:C.create(1,1,1),theme:"operator-hkl"},e,t,r)];case 1:return[2,n.sent()]}})})}}),B3e=function(e,t){return w({model:E.Optional(E.Group(ft.getParamDefinition(rt.Model.ModelFromTrajectory,e,t)))},P1(e,t))},L3e=_c({id:"preset-trajectory-crystal-contacts",display:{name:"Crystal Contacts",group:"Preset",description:"Showsasymetric unit and chains from neighbours within 5 \u212B, i.e., symmetry mates."},isApplicable:function(e){return jt.hasCrystalSymmetry(e.data.representative)},params:B3e,apply:function(e,t,r){return ce(this,void 0,void 0,function(){var n,a,i,o,s,u,l;return de(this,function(c){switch(c.label){case 0:return n=r.builders.structure,[4,n.createModel(e,t.model)];case 1:return a=c.sent(),[4,n.insertModelProperties(a,t.modelProperties)];case 2:return i=c.sent(),[4,n.createStructure(i||a,{name:"symmetry-mates",params:{radius:5}})];case 3:return o=c.sent(),[4,n.insertStructureProperties(o,t.structureProperties)];case 4:return s=c.sent(),[4,n.tryCreateUnitcell(i,void 0,{isHidden:!0})];case 5:return u=c.sent(),[4,r.builders.structure.representation.applyPreset(s,t.representationPreset||"auto",{theme:{globalName:"operator-name",carbonColor:"operator-name",focus:{name:"element-symbol",params:{carbonColor:{name:"operator-name",params:P3.defaultValues}}}}})];case 6:return l=c.sent(),[2,{model:a,modelProperties:i,unitcell:u,structure:o,structureProperties:s,representation:l}]}})})}}),Q2={default:r8,"all-models":O3e,unitcell:F3e,supercell:k3e,crystalContacts:L3e},N3e=function(){function e(t){var r=this;this.plugin=t,this._providers=[],this.providerMap=new Map,this.defaultProvider=Q2.default,cs(Q2,function(n){return r.registerPreset(n)})}return e.prototype.resolveProvider=function(t){var r;return typeof t=="string"?(r=Q2[t])!==null&&r!==void 0?r:T_(this._providers,function(n){return n.id===t}):t},e.prototype.hasPreset=function(t){for(var r=0,n=this._providers;r<n.length;r++){var a=n[r];if(!a.isApplicable||a.isApplicable(t,this.plugin))return!0}return!1},Object.defineProperty(e.prototype,"providers",{get:function(){return this._providers},enumerable:!1,configurable:!0}),e.prototype.getPresets=function(t){if(!t)return this.providers;for(var r=[],n=0,a=this._providers;n<a.length;n++){var i=a[n];i.isApplicable&&!i.isApplicable(t,this.plugin)||r.push(i)}return r},e.prototype.getPresetSelect=function(t){for(var r=[],n=0,a=this._providers;n<a.length;n++){var i=a[n];t&&i.isApplicable&&!i.isApplicable(t,this.plugin)||r.push([i.id,i.display.name])}return E.Select("auto",r)},e.prototype.getPresetsWithOptions=function(t){for(var r=[],n=Object.create(null),a=0,i=this._providers;a<i.length;a++){var o=i[a];o.isApplicable&&!o.isApplicable(t,this.plugin)||(r.push([o.id,o.display.name]),n[o.id]=o.params?E.Group(o.params(t,this.plugin)):E.EmptyGroup())}return r.length===0?E.MappedStatic("",{"":E.EmptyGroup()}):E.MappedStatic(r[0][0],n,{options:r})},e.prototype.registerPreset=function(t){if(this.providerMap.has(t.id))throw new Error("Hierarchy provider with id '"+t.id+"' already registered.");this._providers.push(t),this.providerMap.set(t.id,t)},e.prototype.unregisterPreset=function(t){this.providerMap.delete(t.id),sv(this._providers,t)},e.prototype.applyPreset=function(t,r,n){var a=this,i=this.resolveProvider(r);if(!!i){var o=this.plugin.state.data,s=ua.resolveAndCheck(o,t);if(!s){Pp||console.warn("Applying hierarchy preset provider to bad cell.");return}var u=n||(i.params?E.getDefaultValues(i.params(s.obj,this.plugin)):{}),l=We.create(""+i.display.name,function(){return i.apply(s,u,a.plugin)});return this.plugin.runTask(l)}},e}(),U3e=function(){function e(t){this.plugin=t,this.hierarchy=new N3e(this.plugin),this.representation=new M3e(this.plugin)}return Object.defineProperty(e.prototype,"dataState",{get:function(){return this.plugin.state.data},enumerable:!1,configurable:!0}),e.prototype.parseTrajectoryData=function(t,r){return ce(this,void 0,void 0,function(){var n,a;return de(this,function(i){switch(i.label){case 0:if(n=typeof r=="string"?this.plugin.dataFormats.get(r):r,!n)throw new Error("'"+r+"' is not a supported data format.");return[4,n.parse(this.plugin,t)];case 1:return a=i.sent().trajectory,[2,a]}})})},e.prototype.parseTrajectoryBlob=function(t,r){var n=this.dataState,a=n.build().to(t).apply(rt.Data.ParseBlob,r,{state:{isGhost:!0}}).apply(rt.Model.TrajectoryFromBlob,void 0);return a.commit({revertOnError:!0})},e.prototype.parseTrajectory=function(t,r){var n=ua.resolveAndCheck(this.dataState,t);if(!n)throw new Error("Invalid data cell.");return ge.Data.Blob.is(n.obj)?this.parseTrajectoryBlob(t,r):this.parseTrajectoryData(t,r)},e.prototype.createModel=function(t,r,n){var a=this.dataState,i=a.build().to(t).apply(rt.Model.ModelFromTrajectory,r||{modelIndex:0},{state:n});return i.commit({revertOnError:!0})},e.prototype.insertModelProperties=function(t,r,n){var a=this.dataState,i=a.build().to(t).apply(rt.Model.CustomModelProperties,r,{state:n});return i.commit({revertOnError:!0})},e.prototype.tryCreateUnitcell=function(t,r,n){var a,i,o,s=this.dataState,u=(i=(a=ua.resolveAndCheck(s,t))===null||a===void 0?void 0:a.obj)===null||i===void 0?void 0:i.data;if(!!u){var l=(o=qn.Provider.get(u))===null||o===void 0?void 0:o.spacegroup.cell;if(!Ei.isZero(l)){var c=s.build().to(t).apply(rt.Representation.ModelUnitcell3D,r,{state:n});return c.commit({revertOnError:!0})}}},e.prototype.createStructure=function(t,r,n){var a,i=this.dataState;if(!r){var o=ua.resolveAndCheck(i,t);if(o){var s=qn.Provider.get((a=o.obj)===null||a===void 0?void 0:a.data);(!s||(s==null?void 0:s.assemblies.length)===0)&&(r={name:"model",params:{}})}}var u=i.build().to(t).apply(rt.Model.StructureFromModel,{type:r||{name:"assembly",params:{}}},{state:n});return u.commit({revertOnError:!0})},e.prototype.insertStructureProperties=function(t,r){var n=this.dataState,a=n.build().to(t).apply(rt.Model.CustomStructureProperties,r);return a.commit({revertOnError:!0})},e.prototype.isComponentTransform=function(t){return t.transform.transformer===rt.Model.StructureComponent},e.prototype.tryCreateComponent=function(t,r,n,a){var i,o;return ce(this,void 0,void 0,function(){var s,u,l,c,d;return de(this,function(f){switch(f.label){case 0:return s=this.dataState,u=s.build().to(t),l="structure-component-"+n,c=u.applyOrUpdateTagged(l,rt.Model.StructureComponent,r,{tags:a?Nt(Nt([],a),[l]):[l]}),[4,c.commit()];case 1:return f.sent(),d=c.selector,!d.isOk||((o=(i=d.cell)===null||i===void 0?void 0:i.obj)===null||o===void 0?void 0:o.data.elementCount)===0?[4,s.build().delete(d.ref).commit()]:[3,3];case 2:return f.sent(),[2];case 3:return[2,d]}})})},e.prototype.tryCreateComponentFromExpression=function(t,r,n,a){return this.tryCreateComponent(t,{type:{name:"expression",params:r},nullIfEmpty:!0,label:((a==null?void 0:a.label)||"").trim()},n,a==null?void 0:a.tags)},e.prototype.tryCreateComponentStatic=function(t,r,n){return this.tryCreateComponent(t,{type:{name:"static",params:r},nullIfEmpty:!0,label:((n==null?void 0:n.label)||"").trim()},"static-"+r,n==null?void 0:n.tags)},e.prototype.tryCreateComponentFromSelection=function(t,r,n,a){var i=this;return this.plugin.runTask(We.create("Query Component",function(o){return ce(i,void 0,void 0,function(){var s,u,l,c,d,f,p,h,v,m,g,y;return de(this,function(b){switch(b.label){case 0:return s=a||{},u=s.label,l=s.tags,u=(u||"").trim(),c=(y=(g=ua.resolveAndCheck(this.dataState,t))===null||g===void 0?void 0:g.obj)===null||y===void 0?void 0:y.data,c?r.referencesCurrent?(v={},m={name:"bundle"},h=(p=Qr).fromSelection,[4,r.getSelection(this.plugin,o,c)]):[3,2]:[2];case 1:return f=(v.type=(m.params=h.apply(p,[b.sent()]),m),v.nullIfEmpty=!0,v.label=u||r.label,v),[3,3];case 2:f={type:{name:"expression",params:r.expression},nullIfEmpty:!0,label:u||r.label},b.label=3;case 3:return d=f,r.ensureCustomProperties?[4,r.ensureCustomProperties({runtime:o,assetManager:this.plugin.managers.asset},c)]:[3,5];case 4:b.sent(),b.label=5;case 5:return[2,this.tryCreateComponent(t,d,n,l)]}})})}))},e}(),KC;(function(e){function t(r){var n=r.name;return{descriptor:r,get:function(a){return a._propertyData[n]},set:function(a,i){a.customProperties.add(r),a._propertyData[n]=i}}}e.create=t})(KC||(KC={}));var ly;(function(e){e.Descriptor={name:"recommended_iso_value"},e.Provider=KC.create(e.Descriptor)})(ly||(ly={}));var Xv="Volume";function Yv(e,t){return ce(this,void 0,void 0,function(){var r,n=this;return de(this,function(a){return t?(r=t.entryId,!r||!r.toLowerCase().startsWith("emd")?[2]:[2,e.runTask(We.create("Try Set Recommended IsoValue",function(i){return ce(n,void 0,void 0,function(){var o;return de(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,ML(e,i,r)];case 1:return o=s.sent(),ly.Provider.set(t,Ct.IsoValue.absolute(o)),[3,3];case 2:return s.sent(),[3,3];case 3:return[2]}})})}))]):[2]})})}function i8(e){var t=ly.Provider.get(e);if(!!t){if(t.kind==="relative")return t;var r=e.grid.stats;return Dg.is(e.sourceData)&&(r={min:e.sourceData.data.volume_data_3d_info.min_source.value(0),max:e.sourceData.data.volume_data_3d_info.max_source.value(0),mean:e.sourceData.data.volume_data_3d_info.mean_source.value(0),sigma:e.sourceData.data.volume_data_3d_info.sigma_source.value(0)}),Ct.IsoValue.toRelative(t,r)}}function bw(e,t){return ce(this,void 0,void 0,function(){var r,n,a;return de(this,function(i){switch(i.label){case 0:return r={},n=t.volume.data&&i8(t.volume.data),n&&(r.isoValue=n),a=e.build().to(t.volume).apply(rt.Representation.VolumeRepresentation3D,np(e,t.volume.data,{type:"isosurface",typeParams:r})),[4,a.commit()];case 1:return[2,[i.sent()]]}})})}var z3e={label:"CCP4/MRC/MAP",description:"CCP4/MRC/MAP",category:Xv,binaryExtensions:["ccp4","mrc","map"],parse:function(e,t,r){return ce(void 0,void 0,void 0,function(){var n,a;return de(this,function(i){switch(i.label){case 0:return n=e.build().to(t).apply(rt.Data.ParseCcp4,{},{state:{isGhost:!0}}),a=n.apply(rt.Volume.VolumeFromCcp4,{entryId:r==null?void 0:r.entryId}),[4,n.commit({revertOnError:!0})];case 1:return i.sent(),[4,Yv(e,a.selector.data)];case 2:return i.sent(),[2,{format:n.selector,volume:a.selector}]}})})},visuals:bw},V3e={label:"DSN6/BRIX",description:"DSN6/BRIX",category:Xv,binaryExtensions:["dsn6","brix"],parse:function(e,t,r){return ce(void 0,void 0,void 0,function(){var n,a;return de(this,function(i){switch(i.label){case 0:return n=e.build().to(t).apply(rt.Data.ParseDsn6,{},{state:{isGhost:!0}}),a=n.apply(rt.Volume.VolumeFromDsn6,{entryId:r==null?void 0:r.entryId}),[4,n.commit({revertOnError:!0})];case 1:return i.sent(),[4,Yv(e,a.selector.data)];case 2:return i.sent(),[2,{format:n.selector,volume:a.selector}]}})})},visuals:bw},H3e={label:"DX",description:"DX",category:Xv,stringExtensions:["dx"],binaryExtensions:["dxbin"],parse:function(e,t,r){return ce(void 0,void 0,void 0,function(){var n,a;return de(this,function(i){switch(i.label){case 0:return n=e.build().to(t).apply(rt.Data.ParseDx,{},{state:{isGhost:!0}}),a=n.apply(rt.Volume.VolumeFromDx,{entryId:r==null?void 0:r.entryId}),[4,a.commit({revertOnError:!0})];case 1:return i.sent(),[4,Yv(e,a.selector.data)];case 2:return i.sent(),[2,{volume:a.selector}]}})})},visuals:bw},G3e={label:"Cube",description:"Cube",category:Xv,stringExtensions:["cub","cube"],parse:function(e,t,r){return ce(void 0,void 0,void 0,function(){var n,a,i;return de(this,function(o){switch(o.label){case 0:return n=e.build().to(t).apply(rt.Data.ParseCube,{},{state:{isGhost:!0}}),a=n.apply(rt.Volume.VolumeFromCube,{entryId:r==null?void 0:r.entryId}),i=n.apply(rt.Model.TrajectoryFromCube,void 0,{state:{isGhost:!0}}).apply(rt.Model.ModelFromTrajectory).apply(rt.Model.StructureFromModel),[4,n.commit({revertOnError:!0})];case 1:return o.sent(),[4,Yv(e,a.selector.data)];case 2:return o.sent(),[2,{format:n.selector,volume:a.selector,structure:i.selector}]}})})},visuals:function(e,t){return ce(void 0,void 0,void 0,function(){var r,n,a,i,o,s,u,l,c,d;return de(this,function(f){switch(f.label){case 0:return r=e.build(),n=[],a=(d=(c=t.volume.cell)===null||c===void 0?void 0:c.obj)===null||d===void 0?void 0:d.data,a&&Ct.isOrbitals(a)?(i=r.to(t.volume).apply(rt.Representation.VolumeRepresentation3D,np(e,a,{type:"isosurface",typeParams:{isoValue:Ct.IsoValue.relative(1),alpha:.4},color:"uniform",colorParams:{value:dr.blue}})),o=r.to(t.volume).apply(rt.Representation.VolumeRepresentation3D,np(e,a,{type:"isosurface",typeParams:{isoValue:Ct.IsoValue.relative(-1),alpha:.4},color:"uniform",colorParams:{value:dr.red}})),n.push(i.selector,o.selector)):(s=r.to(t.volume).apply(rt.Representation.VolumeRepresentation3D,np(e,a,{type:"isosurface",typeParams:{isoValue:Ct.IsoValue.relative(2),alpha:.4},color:"uniform",colorParams:{value:dr.grey}})),n.push(s.selector)),[4,e.builders.structure.representation.applyPreset(t.structure,"auto")];case 1:return u=f.sent(),[4,r.commit()];case 2:return f.sent(),l=[],cs(u==null?void 0:u.representations,function(p){p&&l.push(p)}),[2,Nt(Nt([],n),l)]}})})}},q3e={label:"DensityServer CIF",description:"DensityServer CIF",category:Xv,stringExtensions:["cif"],binaryExtensions:["bcif"],isApplicable:function(e,t){return K3(e,t)==="dscif"},parse:function(e,t,r){return ce(void 0,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d,f,p,h;return de(this,function(v){switch(v.label){case 0:return[4,e.build().to(t).apply(rt.Data.ParseCif).commit()];case 1:if(n=v.sent(),a=e.build().to(n),i=n.obj.data.blocks.slice(1),i.length!==1&&i.length!==2)throw new Error("unknown number of blocks");for(o=[],s=0,u=0,l=i;u<l.length;u++)c=l[u],d=Array.isArray(r==null?void 0:r.entryId)?r==null?void 0:r.entryId[s]:r==null?void 0:r.entryId,o.push(a.apply(rt.Volume.VolumeFromDensityServerCif,{blockHeader:c.header,entryId:d}).selector),s++;return[4,a.commit()];case 2:v.sent(),f=0,p=o,v.label=3;case 3:return f<p.length?(h=p[f],[4,Yv(e,h.data)]):[3,6];case 4:v.sent(),v.label=5;case 5:return f++,[3,3];case 6:return[2,{volumes:o}]}})})},visuals:function(e,t){return ce(void 0,void 0,void 0,function(){var r,n,a,i,o,s;return de(this,function(u){switch(u.label){case 0:return r=t.volumes,n=e.build(),a=[],r.length>0&&(i=r[0].data&&i8(r[0].data)||Ct.IsoValue.relative(1.5),a[0]=n.to(r[0]).apply(rt.Representation.VolumeRepresentation3D,Ou.getDefaultParamsStatic(e,"isosurface",{isoValue:i,alpha:1},"uniform",{value:dr.teal})).selector),r.length>1&&(o=Ou.getDefaultParamsStatic(e,"isosurface",{isoValue:Ct.IsoValue.relative(3),alpha:.3},"uniform",{value:dr.green}),s=Ou.getDefaultParamsStatic(e,"isosurface",{isoValue:Ct.IsoValue.relative(-3),alpha:.3},"uniform",{value:dr.red}),a[a.length]=n.to(r[1]).apply(rt.Representation.VolumeRepresentation3D,o).selector,a[a.length]=n.to(r[1]).apply(rt.Representation.VolumeRepresentation3D,s).selector),[4,n.commit()];case 1:return u.sent(),[2,a]}})})}},j3e=[["ccp4",z3e],["dsn6",V3e],["cube",G3e],["dx",H3e],["dscif",q3e]],W3e="Shape",X3e={label:"PLY",description:"PLY",category:W3e,stringExtensions:["ply"],parse:function(e,t){return ce(void 0,void 0,void 0,function(){var r,n;return de(this,function(a){switch(a.label){case 0:return r=e.state.data.build().to(t).apply(rt.Data.ParsePly,{},{state:{isGhost:!0}}),n=r.apply(rt.Model.ShapeFromPly),[4,r.commit()];case 1:return a.sent(),[2,{format:r.selector,shape:n.selector}]}})})},visuals:function(e,t){var r=e.state.data.build().to(t.shape).apply(rt.Representation.ShapeRepresentation3D);return r.commit()}},Y3e=[["ply",X3e]],Sw="Structure",K3e={label:"PSF",description:"PSF",category:Sw,stringExtensions:["psf"],parse:function(e,t){return ce(void 0,void 0,void 0,function(){var r,n;return de(this,function(a){switch(a.label){case 0:return r=e.state.data.build().to(t).apply(rt.Data.ParsePsf,{},{state:{isGhost:!0}}),n=r.apply(rt.Model.TopologyFromPsf),[4,r.commit()];case 1:return a.sent(),[2,{format:r.selector,topology:n.selector}]}})})}},$3e={label:"DCD",description:"DCD",category:Sw,binaryExtensions:["dcd"],parse:function(e,t){var r=e.state.data.build().to(t).apply(rt.Model.CoordinatesFromDcd);return r.commit()}},Q3e={label:"XTC",description:"XTC",category:Sw,binaryExtensions:["xtc"],parse:function(e,t){var r=e.state.data.build().to(t).apply(rt.Model.CoordinatesFromXtc);return r.commit()}},Z3e=[["psf",K3e],["dcd",$3e],["xtc",Q3e]],J3e=function(){function e(){this._list=[],this._map=new Map,this._extensions=void 0,this._binaryExtensions=void 0,this._options=void 0;for(var t=0,r=j3e;t<r.length;t++){var n=r[t],a=n[0],i=n[1];this.add(a,i)}for(var o=0,s=Z3e;o<s.length;o++){var u=s[o],a=u[0],i=u[1];this.add(a,i)}for(var l=0,c=Y3e;l<c.length;l++){var d=c[l],a=d[0],i=d[1];this.add(a,i)}for(var f=0,p=fL;f<p.length;f++){var h=p[f],a=h[0],i=h[1];this.add(a,i)}}return Object.defineProperty(e.prototype,"types",{get:function(){return this._list.map(function(t){return[t.name,t.provider.label]})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"extensions",{get:function(){if(this._extensions)return this._extensions;var t=new Set;return this._list.forEach(function(r){var n,a,i=r.provider;(n=i.stringExtensions)===null||n===void 0||n.forEach(function(o){return t.add(o)}),(a=i.binaryExtensions)===null||a===void 0||a.forEach(function(o){return t.add(o)})}),this._extensions=t,t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"binaryExtensions",{get:function(){if(this._binaryExtensions)return this._binaryExtensions;var t=new Set;return this._list.forEach(function(r){var n,a=r.provider;return(n=a.binaryExtensions)===null||n===void 0?void 0:n.forEach(function(i){return t.add(i)})}),this._binaryExtensions=t,t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"options",{get:function(){if(this._options)return this._options;var t=[];return this._list.forEach(function(r){var n=r.name,a=r.provider;return t.push([n,a.label,a.category||""])}),this._options=t,t},enumerable:!1,configurable:!0}),e.prototype._clear=function(){this._extensions=void 0,this._binaryExtensions=void 0,this._options=void 0},e.prototype.add=function(t,r){this._clear(),this._list.push({name:t,provider:r}),this._map.set(t,r)},e.prototype.remove=function(t){this._clear(),this._list.splice(this._list.findIndex(function(r){return r.name===t}),1),this._map.delete(t)},e.prototype.auto=function(t,r){for(var n=0,a=this.list.length;n<a;++n){var i=this._list[n].provider,o=!1;if((i.binaryExtensions&&i.binaryExtensions.indexOf(t.ext)>=0||i.stringExtensions&&i.stringExtensions.indexOf(t.ext)>=0)&&(o=!0),o&&(!i.isApplicable||i.isApplicable(t,r.data)))return i}},e.prototype.get=function(t){if(this._map.has(t))return this._map.get(t);throw new Error("unknown data format name '"+t+"'")},Object.defineProperty(e.prototype,"list",{get:function(){return this._list},enumerable:!1,configurable:!0}),e}(),ewe=function(e){Be(t,e);function t(r){var n=e.call(this,{params:{current:""},animationState:"stopped"})||this;return n.context=r,n.map=new Map,n._animations=[],n.currentTime=0,n._params=void 0,n.events={updated:n.ev(),applied:n.ev()},n.isStopped=!0,n.isApplying=!1,n}return Object.defineProperty(t.prototype,"isEmpty",{get:function(){return this._animations.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"current",{get:function(){return this._current},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"animations",{get:function(){return this._animations},enumerable:!1,configurable:!0}),t.prototype.triggerUpdate=function(){this.events.updated.next()},t.prototype.triggerApply=function(){this.events.applied.next()},t.prototype.getParams=function(){return this._params||(this._params={current:E.Select(this._animations[0]&&this._animations[0].name,this._animations.map(function(r){return[r.name,r.display.name]}),{label:"Animation"})}),this._params},t.prototype.updateParams=function(r){if(!this.isEmpty){this.updateState({params:w(w({},this.state.params),r)});var n=this.map.get(this.state.params.current),a=n.params(this.context);this._current={anim:n,params:a,paramValues:E.getDefaultValues(a),state:{},startedTime:-1,lastTime:0},this.triggerUpdate()}},t.prototype.updateCurrentParams=function(r){this.isEmpty||(this._current.paramValues=w(w({},this._current.paramValues),r),this.triggerUpdate())},t.prototype.register=function(r){if(this.map.has(r.name)){this.context.log.error("Animation '"+r.name+"' is already registered.");return}this._params=void 0,this.map.set(r.name,r),this._animations.push(r),this._animations.length===1?this.updateParams({current:r.name}):this.triggerUpdate()},t.prototype.play=function(r,n){return ce(this,void 0,void 0,function(){return de(this,function(a){switch(a.label){case 0:return[4,this.stop()];case 1:return a.sent(),this.map.has(r.name)||this.register(r),this.updateParams({current:r.name}),this.updateCurrentParams(n),[4,this.start()];case 2:return a.sent(),[2]}})})},t.prototype.tick=function(r,n){return ce(this,void 0,void 0,function(){return de(this,function(a){switch(a.label){case 0:return this.currentTime=r,this.isStopped?[2]:n?[4,this.applyFrame()]:[3,2];case 1:return a.sent(),[3,3];case 2:this.applyAsync(),a.label=3;case 3:return[2]}})})},t.prototype.start=function(){return ce(this,void 0,void 0,function(){var r,n,a;return de(this,function(i){switch(i.label){case 0:return this.updateState({animationState:"playing"}),this.context.behaviors.state.isAnimating.value||this.context.behaviors.state.isAnimating.next(!0),this.triggerUpdate(),r=this._current.anim,n=this._current.anim.initialState(this._current.paramValues,this.context),r.setup?[4,r.setup(this._current.paramValues,n,this.context)]:[3,2];case 1:a=i.sent(),a&&(n=a),i.label=2;case 2:return this._current.lastTime=0,this._current.startedTime=-1,this._current.state=n,this.isStopped=!1,[2]}})})},t.prototype.stop=function(){return ce(this,void 0,void 0,function(){var r;return de(this,function(n){switch(n.label){case 0:return this.isStopped=!0,this.state.animationState==="stopped"?[3,3]:(r=this._current.anim,r.teardown?[4,r.teardown(this._current.paramValues,this._current.state,this.context)]:[3,2]);case 1:n.sent(),n.label=2;case 2:this.updateState({animationState:"stopped"}),this.triggerUpdate(),n.label=3;case 3:return this.context.behaviors.state.isAnimating.value&&this.context.behaviors.state.isAnimating.next(!1),[2]}})})},Object.defineProperty(t.prototype,"isAnimating",{get:function(){return this.state.animationState==="playing"},enumerable:!1,configurable:!0}),t.prototype.applyAsync=function(){return ce(this,void 0,void 0,function(){return de(this,function(r){switch(r.label){case 0:if(this.isApplying)return[2];this.isApplying=!0,r.label=1;case 1:return r.trys.push([1,,3,4]),[4,this.applyFrame()];case 2:return r.sent(),[3,4];case 3:return this.isApplying=!1,[7];case 4:return[2]}})})},t.prototype.applyFrame=function(){return ce(this,void 0,void 0,function(){var r,n;return de(this,function(a){switch(a.label){case 0:return r=this.currentTime,this._current.startedTime<0&&(this._current.startedTime=r),[4,this._current.anim.apply(this._current.state,{lastApplied:this._current.lastTime,current:r-this._current.startedTime},{params:this._current.paramValues,plugin:this.context})];case 1:return n=a.sent(),n.kind==="finished"?this.stop():n.kind==="next"&&(this._current.state=n.state,this._current.lastTime=r-this._current.startedTime),this.triggerApply(),[2]}})})},t.prototype.getSnapshot=function(){return this.current?{state:this.state,current:{paramValues:this._current.paramValues,state:this._current.anim.stateSerialization?this._current.anim.stateSerialization.toJSON(this._current.state):this._current.state}}:{state:this.state}},t.prototype.setSnapshot=function(r){this.isEmpty||(this.updateState({animationState:r.state.animationState}),this.updateParams(r.state.params),r.current&&(this.current.paramValues=r.current.paramValues,this.current.state=this._current.anim.stateSerialization?this._current.anim.stateSerialization.fromJSON(r.current.state):r.current.state,this.triggerUpdate(),this.state.animationState==="playing"&&this.resume()))},t.prototype.resume=function(){return ce(this,void 0,void 0,function(){var r;return de(this,function(n){switch(n.label){case 0:return this._current.lastTime=0,this._current.startedTime=-1,r=this._current.anim,this.context.behaviors.state.isAnimating.value||this.context.behaviors.state.isAnimating.next(!0),r.setup?[4,r.setup(this._current.paramValues,this._current.state,this.context)]:[3,2];case 1:n.sent(),n.label=2;case 2:return this.isStopped=!1,[2]}})})},t}(gl),twe={minRadius:5,extraRadius:4,durationMs:250},rwe=function(){function e(t){this.plugin=t,this.boundaryHelper=new eo("98")}return e.prototype.transformedLoci=function(t){var r,n;if(Re.is(t)){var a=(n=(r=this.plugin.helpers.substructureParent.get(t.structure))===null||r===void 0?void 0:r.obj)===null||n===void 0?void 0:n.data;a&&(t=Re.remap(t,a))}return t},e.prototype.focusRenderObjects=function(t,r){if(!!t){for(var n=[],a=0,i=t;a<i.length;a++){var o=i[a],s=o.values.boundingSphere.ref.value;s.radius!==0&&n.push(s)}this.focusSpheres(n,function(u){return u},r)}},e.prototype.focusLoci=function(t,r){var n;if(Array.isArray(t)&&t.length>1){for(var a=[],i=0,o=t;i<o.length;i++){var s=o[i],u=ir.getBoundingSphere(this.transformedLoci(s));u&&a.push(u)}if(a.length===0)return;this.boundaryHelper.reset();for(var l=0,c=a;l<c.length;l++){var u=c[l];this.boundaryHelper.includeSphere(u)}this.boundaryHelper.finishedIncludeStep();for(var d=0,f=a;d<f.length;d++){var u=f[d];this.boundaryHelper.radiusSphere(u)}n=this.boundaryHelper.getSphere()}else if(Array.isArray(t)){if(t.length===0)return;n=ir.getBoundingSphere(this.transformedLoci(t[0]))}else n=ir.getBoundingSphere(this.transformedLoci(t));n&&this.focusSphere(n,r)},e.prototype.focusSpheres=function(t,r,n){for(var a=[],i=0,o=t;i<o.length;i++){var s=o[i],u=r(s);u&&a.push(u)}if(a.length!==0){if(a.length===1)return this.focusSphere(a[0],n);this.boundaryHelper.reset();for(var l=0,c=a;l<c.length;l++){var u=c[l];this.boundaryHelper.includeSphere(u)}this.boundaryHelper.finishedIncludeStep();for(var d=0,f=a;d<f.length;d++){var u=f[d];this.boundaryHelper.radiusSphere(u)}this.focusSphere(this.boundaryHelper.getSphere(),n)}},e.prototype.focusSphere=function(t,r){var n,a,i,o,s=w(w({},twe),r),u=s.extraRadius,l=s.minRadius,c=s.durationMs,d=Math.max(t.radius+u,l);if(r!=null&&r.principalAxes){var f=r==null?void 0:r.principalAxes.boxAxes,p=f.origin,h=f.dirA,v=f.dirC,m=(n=this.plugin.canvas3d)===null||n===void 0?void 0:n.camera.getFocus(p,d,h,v);(a=this.plugin.canvas3d)===null||a===void 0||a.requestCameraReset({durationMs:c,snapshot:m})}else{var m=(i=this.plugin.canvas3d)===null||i===void 0?void 0:i.camera.getFocus(t.center,d);(o=this.plugin.canvas3d)===null||o===void 0||o.requestCameraReset({durationMs:c,snapshot:m})}},e.prototype.setSnapshot=function(t,r){var n;(n=this.plugin.canvas3d)===null||n===void 0||n.requestCameraReset({snapshot:t,durationMs:r})},e.prototype.reset=function(t,r){var n;(n=this.plugin.canvas3d)===null||n===void 0||n.requestCameraReset({snapshot:t,durationMs:r})},e}(),nwe=function(){function e(t){var r=this;this.ctx=t,this.providers=[],this.locis=[],this.isDirty=!1,this.labels=[],this.groupedLabels=new Map,t.managers.interactivity.lociHighlights.addProvider(function(n,a){r.mark(n,a),r.showLabels()})}return e.prototype.clearProviders=function(){this.providers=[],this.isDirty=!0,this.showLabels()},e.prototype.addProvider=function(t){this.providers.push(t),this.providers.sort(function(r,n){return(n.priority||0)-(r.priority||0)}),this.isDirty=!0,this.showLabels()},e.prototype.removeProvider=function(t){this.providers=this.providers.filter(function(r){return r!==t}),this.isDirty=!0,this.showLabels()},e.prototype.mark=function(t,r){var n=this.locis.findIndex(function(a){return or.Loci.areEqual(t,a)});n===-1&&r===tr.Highlight?(this.locis.push(t),this.isDirty=!0):n!==-1&&r===tr.RemoveHighlight&&(uv(this.locis,n),this.isDirty=!0)},e.prototype.showLabels=function(){this.ctx.behaviors.labels.highlight.next({labels:this.getLabels()})},e.prototype.getLabels=function(){var t=this;if(this.isDirty){this.groupedLabels.clear(),this.labels.length=0;for(var r=0,n=this.providers;r<n.length;r++)for(var a=n[r],i=0,o=this.locis;i<o.length;i++){var s=o[i];if(!ir.isEmpty(s.loci)){var u=a.label(s.loci,s.repr);if(u){var l=a.group?a.group(u):u.toString(),c=this.groupedLabels.get(l);c?c.push(u):this.groupedLabels.set(l,[u])}}}this.labels.length=0,this.groupedLabels.forEach(function(d,f){var p=d.length,h=p>1&&d[0]!==d[1]?f:d[0];t.labels.push(p===1?h:h+" <small>|| \xD7 "+p+"</small>")}),this.isDirty=!1}return this.labels},e}(),awe=8,iwe=function(e){Be(t,e);function t(r){var n=e.call(this,{history:[]})||this;n.plugin=r,n.events={historyUpdated:n.ev()},n.behaviors={current:n.ev.behavior(void 0)},r.state.data.events.object.removed.subscribe(function(i){var o,s,u=i.obj;if(!!ge.Molecule.Structure.is(u)){((s=n.current)===null||s===void 0?void 0:s.loci.structure)===u.data&&n.clear();for(var l=[],c=0,d=n.history;c<d.length;c++){var f=d[c];f.loci.structure===u.data&&l.push(f)}l.length!==n.history.length&&(n.history.length=0,(o=n.history).push.apply(o,l),n.events.historyUpdated.next())}});var a=Ne();return r.state.data.events.object.updated.subscribe(function(i){var o,s=i.oldData,u=i.obj,l=i.action;if(!!ge.Molecule.Structure.is(u)&&s!==u.data&&l==="in-place"){var c=n.state.current,d=u.data;if(c&&c.loci.structure===s){var f=Re.remap(c.loci,d);n.state.current=w(w({},c),{loci:f}),n.behaviors.current.next(n.state.current),ir.getBoundingSphere(f,a);var p=(o=n.plugin.canvas3d)===null||o===void 0?void 0:o.camera,h=p.getTargetDistance(a.radius+4);(C.distance(p.target,a.center)>a.radius||h>p.viewport.height/p.zoom)&&n.plugin.managers.camera.focusSphere(a,{durationMs:0})}}}),n}return Object.defineProperty(t.prototype,"current",{get:function(){return this.state.current},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"history",{get:function(){return this.state.history},enumerable:!1,configurable:!0}),t.prototype.tryAddHistory=function(r){if(!Re.isEmpty(r.loci)){for(var n=0,a=void 0,i=0,o=this.state.history;i<o.length;i++){var s=o[i];if(Re.areEqual(s.loci,r.loci)){a=s;break}n++}if(a){uv(this.state.history,n),this.state.history.unshift(r),this.events.historyUpdated.next();return}this.state.history.unshift(r),this.state.history.length>awe&&this.state.history.pop(),this.events.historyUpdated.next()}},t.prototype.set=function(r){this.tryAddHistory(r),(!this.state.current||!Re.areEqual(this.state.current.loci,r.loci))&&(this.state.current=r,this.behaviors.current.next(r))},t.prototype.setFromLoci=function(r){var n=ir.normalize(r);if(!Re.is(n)||Re.isEmpty(n)){this.clear();return}this.set({loci:n,label:Cc(n,{reverse:!0,hidePrefix:!0,htmlStyling:!1})})},t.prototype.addFromLoci=function(r){var n=this.state.current&&Re.is(r)&&r.structure===this.state.current.loci.structure?Re.union(r,this.state.current.loci):r;this.setFromLoci(n)},t.prototype.clear=function(){this.state.current&&(this.state.current=void 0,this.behaviors.current.next(void 0))},t.prototype.getSnapshot=function(){if(!this.current)return{};var r=this.plugin.helpers.substructureParent.get(this.current.loci.structure),n=r==null?void 0:r.transform.ref;return n?{current:{label:this.current.label,ref:n,bundle:Qr.fromLoci(this.current.loci),category:this.current.category}}:{}},t.prototype.setSnapshot=function(r){var n,a;if(!r.current){this.clear();return}var i=r.current,o=i.label,s=i.ref,u=i.bundle,l=i.category,c=(a=(n=this.plugin.state.data.select(ar.Generators.byRef(s))[0])===null||n===void 0?void 0:n.obj)===null||a===void 0?void 0:a.data;if(!!c){var d=Qr.toLoci(u,c);this.set({label:o,loci:d,category:l})}},t}(gl),dh=new eo("98"),owe=24,swe=function(e){Be(t,e);function t(r){var n=e.call(this,{entries:new Map,additionsHistory:[],stats:uwe()})||this;return n.plugin=r,n.events={changed:n.ev(),additionsHistoryUpdated:n.ev(),loci:{add:n.ev(),remove:n.ev(),clear:n.ev()}},r.helpers.substructureParent.events.removed.subscribe(function(a){return n.onRemove(a.ref,a.obj)}),r.helpers.substructureParent.events.updated.subscribe(function(a){return n.onUpdate(a.ref,a.oldObj,a.obj)}),n}return Object.defineProperty(t.prototype,"entries",{get:function(){return this.state.entries},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"additionsHistory",{get:function(){return this.state.additionsHistory},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stats",{get:function(){return this.state.stats?this.state.stats:(this.state.stats=this.calcStats(),this.state.stats)},enumerable:!1,configurable:!0}),t.prototype.getEntry=function(r){var n=this.plugin.helpers.substructureParent.get(r,!0);if(!!n){var a=n.transform.ref;if(!this.entries.has(a)){var i=new $C(Re(r,[]));return this.entries.set(a,i),i}return this.entries.get(a)}},t.prototype.calcStats=function(){var r=0,n=0,a=nc.create();this.entries.forEach(function(o){var s=o.selection.elements;if(s.length){r+=1;for(var u=0,l=s.length;u<l;++u)n+=ke.size(s[u].indices);nc.add(a,a,nc.ofLoci(o.selection))}});var i=Fg(a,{countsOnly:!0});return{structureCount:r,elementCount:n,label:i}},t.prototype.add=function(r){if(!Re.is(r))return!1;var n=this.getEntry(r.structure);if(!n)return!1;var a=n.selection;return n.selection=Re.union(n.selection,r),this.tryAddHistory(r),this.referenceLoci=r,this.events.loci.add.next(r),!Re.areEqual(a,n.selection)},t.prototype.remove=function(r){if(!Re.is(r))return!1;var n=this.getEntry(r.structure);if(!n)return!1;var a=n.selection;return n.selection=Re.subtract(n.selection,r),this.referenceLoci=r,this.events.loci.remove.next(r),!Re.areEqual(a,n.selection)},t.prototype.intersect=function(r){if(!Re.is(r))return!1;var n=this.getEntry(r.structure);if(!n)return!1;var a=n.selection;return n.selection=Re.intersect(n.selection,r),this.referenceLoci=r,!Re.areEqual(a,n.selection)},t.prototype.set=function(r){if(!Re.is(r))return!1;var n=this.getEntry(r.structure);if(!n)return!1;var a=n.selection;return n.selection=r,this.tryAddHistory(r),this.referenceLoci=void 0,!Re.areEqual(a,n.selection)},t.prototype.modifyHistory=function(r,n,a,i){i===void 0&&(i=!1);var o=this.additionsHistory,s=o.indexOf(r);if(!(s<0)){var u=void 0;switch(n){case"remove":uv(o,s);break;case"up":u=s-1;break;case"down":u=s+1;break}if(u!==void 0)for(var l=a?Math.min(o.length,a):o.length;;)if(u=u%l,u<0&&(u+=l),!i||o[s].loci.structure===o[u].loci.structure){var c=o[s];o[s]=o[u],o[u]=c;break}else u+=n==="up"?-1:1;this.events.additionsHistoryUpdated.next()}},t.prototype.tryAddHistory=function(r){if(!ir.isEmpty(r)){for(var n=0,a=void 0,i=0,o=this.additionsHistory;i<o.length;i++){var s=o[i];if(ir.areEqual(s.loci,r)){a=s;break}n++}if(a){uv(this.additionsHistory,n),this.additionsHistory.unshift(a),this.events.additionsHistoryUpdated.next();return}var u=nc.ofLoci(r),l=Fg(u,{reverse:!0});this.additionsHistory.unshift({id:un.create22(),loci:r,label:l}),this.additionsHistory.length>owe&&this.additionsHistory.pop(),this.events.additionsHistoryUpdated.next()}},t.prototype.clearHistory=function(){this.state.additionsHistory.length!==0&&(this.state.additionsHistory=[],this.events.additionsHistoryUpdated.next())},t.prototype.clearHistoryForStructure=function(r){for(var n=[],a=0,i=this.state.additionsHistory;a<i.length;a++){var o=i[a];o.loci.structure.root===r.root&&n.push(o)}for(var s=0,u=n;s<u.length;s++){var o=u[s];this.modifyHistory(o,"remove")}n.length!==0&&this.events.additionsHistoryUpdated.next()},t.prototype.onRemove=function(r,n){var a;this.entries.has(r)&&(this.entries.delete(r),n!=null&&n.data&&this.clearHistoryForStructure(n.data),((a=this.referenceLoci)===null||a===void 0?void 0:a.structure)===(n==null?void 0:n.data)&&(this.referenceLoci=void 0),this.state.stats=void 0,this.events.changed.next())},t.prototype.onUpdate=function(r,n,a){var i,o,s,u;if(!(n===a||(n==null?void 0:n.data)===a.data)){var l=this.plugin.helpers.substructureParent.get(a.data,!0);if(!!l&&(r=l.transform.ref,!!this.entries.has(r))){var c=(o=(i=this.plugin.helpers.substructureParent.get(a.data))===null||i===void 0?void 0:i.obj)===null||o===void 0?void 0:o.data;if(!!c)if(!(n!=null&&n.data)||Xe.areUnitIdsAndIndicesEqual(n.data,a.data)){this.entries.set(r,lwe(this.entries.get(r),c)),((s=this.referenceLoci)===null||s===void 0?void 0:s.structure.root)===c.root&&(this.referenceLoci=Re.remap(this.referenceLoci,c));for(var d=!1,f=0,p=this.state.additionsHistory;f<p.length;f++){var h=p[f];h.loci.structure.root===c.root&&(h.loci=Re.remap(h.loci,c),d=!0)}d&&this.events.additionsHistoryUpdated.next()}else this.entries.set(r,new $C(Re(c,[]))),((u=this.referenceLoci)===null||u===void 0?void 0:u.structure.root)===c.root&&(this.referenceLoci=void 0),this.clearHistoryForStructure(c),this.state.stats=void 0,this.events.changed.next()}}},t.prototype.clear=function(){for(var r=this.entries.keys(),n=[];;){var a=r.next();if(a.done)break;var i=this.entries.get(a.value);Re.isEmpty(i.selection)||n.push(i.selection),i.selection=Re(i.selection.structure,[])}return this.referenceLoci=void 0,this.state.stats=void 0,this.events.changed.next(),this.events.loci.clear.next(),this.clearHistory(),n},t.prototype.getLoci=function(r){var n=this.getEntry(r);return n?n.selection:Or},t.prototype.getStructure=function(r){var n=this.getEntry(r);if(!!n)return n.structure},t.prototype.structureHasSelection=function(r){var n,a,i=(a=(n=r.cell)===null||n===void 0?void 0:n.obj)===null||a===void 0?void 0:a.data;if(!i)return!1;var o=this.getEntry(i);return!!o&&!Re.isEmpty(o.selection)},t.prototype.has=function(r){if(Re.is(r)){var n=this.getEntry(r.structure);if(n)return Re.isSubset(n.selection,r)}return!1},t.prototype.tryGetRange=function(r){if(!!Re.is(r)&&r.elements.length===1){var n=this.getEntry(r.structure);if(!!n){var a=r.elements[0];if(!!a){var i=this.referenceLoci;if(!(!i||!Re.is(i)||i.structure!==r.structure)){for(var o,s=0,u=i.elements;s<u.length;s++){var l=u[s];if(a.unit===l.unit){o=l;break}}if(!!o&&a.unit===o.unit)return cwe(r.structure,o,a)}}}}},t.prototype.elementCount=function(){var r=0;return this.entries.forEach(function(n){r+=Re.size(n.selection)}),r},t.prototype.getBoundary=function(){var r=C.create(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),n=C.create(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);dh.reset();var a=[];this.entries.forEach(function(c){var d=c.selection;Re.isEmpty(d)||a.push(Re.getBoundary(d))});for(var i=0,o=a.length;i<o;++i){var s=a[i],u=s.box,l=s.sphere;C.min(r,r,u.min),C.max(n,n,u.max),dh.includePositionRadius(l.center,l.radius)}dh.finishedIncludeStep();for(var i=0,o=a.length;i<o;++i){var l=a[i].sphere;dh.radiusPositionRadius(l.center,l.radius)}return{box:{min:r,max:n},sphere:dh.getSphere()}},t.prototype.getPrincipalAxes=function(){var r=this.elementCount(),n=new Float32Array(3*r),a=0;return this.entries.forEach(function(i){Re.toPositionsArray(i.selection,n,a),a+=Re.size(i.selection)*3}),Fd.ofPositions(n)},t.prototype.modify=function(r,n){var a=!1;switch(r){case"add":a=this.add(n);break;case"remove":a=this.remove(n);break;case"intersect":a=this.intersect(n);break;case"set":a=this.set(n);break}a&&(this.state.stats=void 0,this.events.changed.next())},Object.defineProperty(t.prototype,"applicableStructures",{get:function(){return this.plugin.managers.structure.hierarchy.selection.structures.filter(function(r){return!!r.cell.obj}).map(function(r){return r.cell.obj.data})},enumerable:!1,configurable:!0}),t.prototype.triggerInteraction=function(r,n,a){switch(a===void 0&&(a=!0),r){case"add":this.plugin.managers.interactivity.lociSelects.select({loci:n},a);break;case"remove":this.plugin.managers.interactivity.lociSelects.deselect({loci:n},a);break;case"intersect":this.plugin.managers.interactivity.lociSelects.selectJoin({loci:n},a);break;case"set":this.plugin.managers.interactivity.lociSelects.selectOnly({loci:n},a);break}},t.prototype.fromLoci=function(r,n,a){a===void 0&&(a=!0),this.triggerInteraction(r,n,a)},t.prototype.fromCompiledQuery=function(r,n,a){a===void 0&&(a=!0);for(var i=0,o=this.applicableStructures;i<o.length;i++){var s=o[i],u=n(new Qi(s));this.triggerInteraction(r,mt.toLociWithSourceUnits(u),a)}},t.prototype.fromSelectionQuery=function(r,n,a){var i=this;a===void 0&&(a=!0),this.plugin.runTask(We.create("Structure Selection",function(o){return ce(i,void 0,void 0,function(){var s,u,l,c;return de(this,function(d){switch(d.label){case 0:s=0,u=this.applicableStructures,d.label=1;case 1:return s<u.length?(l=u[s],[4,n.getSelection(this.plugin,o,l)]):[3,4];case 2:c=d.sent(),this.triggerInteraction(r,mt.toLociWithSourceUnits(c),a),d.label=3;case 3:return s++,[3,1];case 4:return[2]}})})}))},t.prototype.fromSelections=function(r){var n,a=ua.resolveAndCheck(this.plugin.state.data,r);if(!(!a||!a.obj)){if(!ge.Molecule.Structure.Selections.is(a.obj)){console.warn("fromSelections applied to wrong object type.",a.obj);return}this.clear();for(var i=0,o=(n=a.obj)===null||n===void 0?void 0:n.data;i<o.length;i++){var s=o[i];this.fromLoci("set",s.loci)}}},t}(gl);function uwe(){return{structureCount:0,elementCount:0,label:"Nothing Selected"}}var $C=function(){function e(t){this._structure=void 0,this._selection=t}return Object.defineProperty(e.prototype,"selection",{get:function(){return this._selection},set:function(t){this._selection=t,this._structure=void 0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"structure",{get:function(){return this._structure?this._structure:(ir.isEmpty(this._selection)?this._structure=void 0:this._structure=Re.toStructure(this._selection),this._structure)},enumerable:!1,configurable:!0}),e}();function lwe(e,t){return new $C(Re.remap(e.selection,t))}function cwe(e,t,r){var n=Math.min(ke.min(t.indices),ke.min(r.indices)),a=Math.max(ke.max(t.indices),ke.max(r.indices));return Re(e,[{unit:t.unit,indices:ke.ofRange(n,a)}])}var dwe=[["full","Full"],["collapsed","Collapsed"],["hidden","Hidden"]],Z2=[["full","Full"],["hidden","Hidden"]],fwe={isExpanded:E.Boolean(!1),showControls:E.Boolean(!0),regionState:E.Group({left:E.Select("full",dwe),top:E.Select("full",Z2),right:E.Select("full",Z2),bottom:E.Select("full",Z2)}),controlsDisplay:E.Value("outside",{isHidden:!0})},pwe=function(e){Be(t,e);function t(r){var n=e.call(this,w(w({},E.getDefaultValues(fwe)),r.spec.layout&&r.spec.layout.initial))||this;return n.context=r,n.events={updated:n.ev()},n.rootState=void 0,wt.Layout.Update.subscribe(r,function(a){return n.updateProps(a.state)}),typeof document!="undefined"&&(n.expandedViewport=document.createElement("meta"),n.expandedViewport.name="viewport",n.expandedViewport.content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"),n}return t.prototype.updateProps=function(r){var n=!!this.state.isExpanded;this.updateState(r),this.root&&typeof r.isExpanded=="boolean"&&r.isExpanded!==n&&this.handleExpand(),this.events.updated.next()},t.prototype.setProps=function(r){this.updateState(r)},t.prototype.setRoot=function(r){this.root=r,this.state.isExpanded&&this.handleExpand()},t.prototype.getScrollElement=function(){return document.scrollingElement?document.scrollingElement:document.documentElement?document.documentElement:document.body},t.prototype.handleExpand=function(){try{var r=document.getElementsByTagName("body")[0],n=document.getElementsByTagName("head")[0];if(!r||!n||!this.root)return;if(this.state.isExpanded){for(var a=n.children,i=[],o=!1,s=0;s<a.length;s++)a[s]===this.expandedViewport?o=!0:(a[s].name||"").toLowerCase()==="viewport"&&i.push(a[s]);for(var u=0,l=i;u<l.length;u++){var c=l[u];n.removeChild(c)}o||n.appendChild(this.expandedViewport);var d=r.style,f=this.getScrollElement(),p=f.scrollLeft,h=f.scrollTop;this.rootState={top:d.top,bottom:d.bottom,right:d.right,left:d.left,scrollTop:h,scrollLeft:p,position:d.position,overflow:d.overflow,viewports:i,zIndex:this.root.style.zIndex,width:d.width,height:d.height,maxWidth:d.maxWidth,maxHeight:d.maxHeight,margin:d.margin,marginLeft:d.marginLeft,marginRight:d.marginRight,marginTop:d.marginTop,marginBottom:d.marginBottom},d.overflow="hidden",d.position="fixed",d.top="0",d.bottom="0",d.right="0",d.left="0",d.width="100%",d.height="100%",d.maxWidth="100%",d.maxHeight="100%",d.margin="0",d.marginLeft="0",d.marginRight="0",d.marginTop="0",d.marginBottom="0"}else{for(var a=n.children,s=0;s<a.length;s++)if(a[s]===this.expandedViewport){n.removeChild(this.expandedViewport);break}if(this.rootState){for(var v=this.rootState,m=0,g=v.viewports;m<g.length;m++){var c=g[m];n.appendChild(c)}var d=r.style;d.top=v.top,d.bottom=v.bottom,d.left=v.left,d.right=v.right,d.width=v.width,d.height=v.height,d.maxWidth=v.maxWidth,d.maxHeight=v.maxHeight,d.margin=v.margin,d.marginLeft=v.marginLeft,d.marginRight=v.marginRight,d.marginTop=v.marginTop,d.marginBottom=v.marginBottom,d.position=v.position,d.overflow=v.overflow||"";var f=this.getScrollElement();f.scrollTop=v.scrollTop,f.scrollLeft=v.scrollLeft,this.rootState=void 0,this.root.style.zIndex=v.zIndex}}}catch(b){var y="Layout change error, you might have to reload the page.";this.context.log.error(y),console.error(y,b)}},t}(gl),xw={includeTypes:E.MultiSelect(a1(kr.Names),E.objectToOptions(kr.Names)),excludeTypes:E.MultiSelect([],E.objectToOptions(kr.Names)),ignoreHydrogens:E.Boolean(!1),aromaticBonds:E.Boolean(!1,{description:"Display aromatic bonds with dashes"})};E.getDefaultValues(xw);var Cw=w(w(w({},nf),xw),{adjustCylinderLength:E.Boolean(!0,{description:"Shorten cylinders to reduce overlap with spheres."})});E.getDefaultValues(Cw);var _w=w(w({},vB),xw);E.getDefaultValues(_w);function o8(e,t,r){return!kr.is(e,r)||kr.is(t,r)}function s8(e,t,r){var n=t.elements,a=t.model.atomicHierarchy.derived.atom.atomicNumber,i=t.bonds,o=i.a,s=i.b,u=i.edgeProps,l=u.flags,c=r.ignoreHydrogens,d=r.includeTypes,f=r.excludeTypes,p=kr.fromNames(d),h=kr.fromNames(f),v=kr.isAll(p)&&h===0,m=e.child,g=m==null?void 0:m.unitMap.get(t.id);if(m&&!g)throw new Error("expected childUnit to exist if child exists");if(!(v&&!c&&!m))return function(y){return!!g&&!Je.has(g.elements,n[o[y]])||c&&(Lg(a,n[o[y]])||Lg(a,n[s[y]]))||!v&&o8(p,h,l[y])}}function u8(e,t){var r=e.interUnitBonds,n=r.edges,a=t.ignoreHydrogens,i=t.includeTypes,o=t.excludeTypes,s=kr.fromNames(i),u=kr.fromNames(o),l=kr.isAll(s)&&u===0,c=e.child;if(!(l&&!a&&!c))return function(d){if(c){var f=n[d],p=c.unitMap.get(f.unitA);if(!p)return!0;var h=e.unitMap.get(f.unitA),v=h.elements[f.indexA];if(!Je.has(p.elements,v))return!0}if(a){var f=n[d],m=e.unitMap.get(f.unitA),g=e.unitMap.get(f.unitB);if(Bg(m,m.elements[f.indexA])||Bg(g,g.elements[f.indexB]))return!0}return!!(!l&&o8(s,u,n[d].props.flag))}}var wc;(function(e){function t(n){var a=n.group,i=n.structure,o=a.units[0],s=ze.isAtomic(o)?o.bonds.edgeCount*2:0,u=a.units.length,l=Ht.Location(i,void 0,void 0,i,void 0,void 0),c=function(d,f){var p=a.units[f];return l.aUnit=p,l.bUnit=p,l.aIndex=p.bonds.a[d],l.bIndex=p.bonds.b[d],l};return pn(s,u,1,c)}e.fromGroup=t;function r(n){var a=n.interUnitBonds.edgeCount,i=1,o=Ht.Location(n,void 0,void 0,n,void 0,void 0),s=function(u){var l=n.interUnitBonds.edges[u];return o.aUnit=n.unitMap.get(l.unitA),o.aIndex=l.indexA,o.bUnit=n.unitMap.get(l.unitB),o.bIndex=l.indexB,o};return pn(a,i,1,s,!0)}e.fromStructure=r})(wc||(wc={}));function ww(e,t,r){var n=e.objectId,a=e.instanceId,i=e.groupId;if(r===n){var o=t.structure,s=t.group,u=s.units[a];if(ze.isAtomic(u)){var l=o.target,c=u.bonds.a[i],d=u.bonds.b[i];return Ht.Loci(l,[Ht.Location(l,u,c,l,u,d),Ht.Location(l,u,d,l,u,c)])}}return Or}function Aw(e,t,r,n){var a=!1;if(Ht.isLoci(e)){var i=t.structure,o=t.group;if(!Xe.areEquivalent(e.structure,i))return!1;var s=o.units[0];if(!ze.isAtomic(s))return!1;for(var u=s.bonds.edgeCount*2,l=0,c=e.bonds;l<c.length;l++){var d=c[l];if(d.aUnit===d.bUnit){var f=o.unitIndexMap.get(d.aUnit.id);if(f!==void 0){var p=s.bonds.getDirectedEdgeIndex(d.aIndex,d.bIndex);p!==-1&&r(Ie.ofSingleton(f*u+p))&&(a=!0)}}}}else if(Re.is(e)){var i=t.structure,o=t.group;if(!Xe.areEquivalent(e.structure,i))return!1;var s=o.units[0];if(!ze.isAtomic(s))return!1;for(var h=s.bonds.edgeCount*2,v=function(_){var A=o.unitIndexMap.get(_.unit.id);if(A!==void 0){var T=s.bonds,I=T.offset,M=T.b;ke.forEach(_.indices,function(O){for(var D=I[O],F=I[O+1];D<F;D++)(!n||ke.has(_.indices,M[D]))&&r(Ie.ofSingleton(A*h+D))&&(a=!0)})}},m=0,g=e.elements;m<g.length;m++){var y=g[m];v(y)}}return a}function Pw(e,t,r){var n=e.objectId,a=e.groupId;if(r===n){var i=t.target,o=t.interUnitBonds.edges[a],s=t.unitMap.get(o.unitA),u=t.unitMap.get(o.unitB);return Ht.Loci(i,[Ht.Location(i,s,o.indexA,i,u,o.indexB),Ht.Location(i,u,o.indexB,i,s,o.indexA)])}return Or}function Tw(e,t,r,n){var a=!1;if(Ht.isLoci(e)){if(!Xe.areEquivalent(e.structure,t))return!1;for(var i=0,o=e.bonds;i<o.length;i++){var s=o[i],u=t.interUnitBonds.getBondIndexFromLocation(s);u!==-1&&r(Ie.ofSingleton(u))&&(a=!0)}}else if(Re.is(e)){if(!Xe.areEquivalent(e.structure,t)||n&&e.elements.length===1)return!1;for(var l=new Map,c=0,d=e.elements;c<d.length;c++){var f=d[c];l.set(f.unit.id,f.indices)}for(var p=function(m){var g=m.unit;if(!ze.isAtomic(g))return"continue";t.interUnitBonds.getConnectedUnits(g.id).forEach(function(y){var b=l.get(y.unitB);(!n||b)&&ke.forEach(m.indices,function(x){!y.connectedIndices.includes(x)||y.getEdges(x).forEach(function(S){if(!n||b&&ke.has(b,S.indexB)){var _=t.interUnitBonds.getEdgeIndex(x,g.id,S.indexB,y.unitB);r(Ie.ofSingleton(_))&&(a=!0)}})})})},h=0,v=e.elements;h<v.length;h++){var f=v[h];p(f)}}return a}var J2=kr.is;function l8(e,t,r,n){var a=e.elements,i=e.bonds,o=i.edgeCount,s=i.a,u=i.b,l=i.edgeProps,c=i.offset,d=l.order,f=l.flags,p=n.sizeFactor,h=n.sizeAspectRatio,v=n.adjustCylinderLength,m=n.aromaticBonds,g=C(),y=C(),b=e.conformation.invariantPosition,x,S=Ze.create(t,e),_=Ht.Location(t,e,void 0,t,e,void 0),A=t.child;if(n.includeParent&&A){var T=A.unitMap.get(e.id);if(!T)throw new Error("expected childUnit to exist");x=function(N){var z=a[s[N]],$=a[u[N]];return Je.has(T.elements,z)&&!Je.has(T.elements,$)}}var I=function(N){return _.aIndex=s[N],_.bIndex=u[N],r.size.size(_)*p},M=function(N){return S.element=a[s[N]],r.size.size(S)*p},O=function(N){return S.element=a[u[N]],r.size.size(S)*p},D=e.rings,F=D.elementRingIndices,G=D.elementAromaticRingIndices;return{linkCount:o*2,referencePosition:function(N){var z,$,j=s[N],Z=u[N];j>Z&&(z=[Z,j],j=z[0],Z=z[1]),c[j+1]-c[j]===1&&($=[Z,j],j=$[0],Z=$[1]);for(var q=F.get(j),te=0,he=c[j],W=c[j+1];he<W;++he){var K=u[he];if(K!==Z&&K!==j)if(q){var U=F.get(K);if(!U)continue;var H=ag(q,U);H>te&&(te=H,b(a[K],g))}else return b(a[K],g)}return te>0?g:null},position:function(N,z,$){if(b(a[s[$]],N),b(a[u[$]],z),v){var j=M($),Z=O($),q=Math.min(j,Z)*h,te=Math.sqrt(Math.max(0,j*j-q*q))-.05,he=Math.sqrt(Math.max(0,Z*Z-q*q))-.05;if(te<=.01&&he<=.01)return;C.normalize(y,C.sub(y,z,N)),C.scaleAndAdd(N,N,y,te),C.scaleAndAdd(z,z,y,-he)}},style:function(N){var z=d[N],$=f[N];if(J2($,2)||J2($,4))return 1;if(z===3)return 3;if(m){var j=s[N],Z=u[N],q=G.get(j),te=G.get(Z),he=q&&te?ag(q,te):0;if(he||J2($,16))return he===2?6:5}return z===2?2:0},radius:function(N){return I(N)*h},ignore:s8(t,e,n),stub:x}}function hwe(e,t,r,n,a,i){if(!ze.isAtomic(t)||!t.bonds.edgeCount)return Wi.createEmpty(i);var o=r.child,s=o==null?void 0:o.unitMap.get(t.id);if(o&&!s)return Wi.createEmpty(i);var u=l8(t,r,n,a),l=mB(e,u,a,i),c=Ne.expand(Ne(),(s!=null?s:t).boundary.sphere,1*a.sizeFactor);return l.setBoundingSphere(c),l}function vwe(e,t,r,n,a,i){if(!ze.isAtomic(t)||!t.bonds.edgeCount)return Lt.createEmpty(i);var o=r.child,s=o==null?void 0:o.unitMap.get(t.id);if(o&&!s)return Lt.createEmpty(i);var u=l8(t,r,n,a),l=af(e,u,a,i),c=Ne.expand(Ne(),(s!=null?s:t).boundary.sphere,1*a.sizeFactor);return l.setBoundingSphere(c),l}var T1=w(w(w(w({},Va),nB),Cw),{sizeFactor:E.Numeric(.3,{min:0,max:10,step:.01}),sizeAspectRatio:E.Numeric(2/3,{min:0,max:3,step:.01}),tryUseImpostor:E.Boolean(!0),includeParent:E.Boolean(!1)});function c8(e,t,r,n){return r.tryUseImpostor&&n&&n.extensions.fragDepth?mwe(e):gwe(e)}function mwe(e){return aB({defaultProps:E.getDefaultValues(T1),createGeometry:hwe,createLocationIterator:wc.fromGroup,getLoci:ww,eachLocation:Aw,setUpdateState:function(t,r,n,a,i,o,s){t.createGeometry=r.sizeAspectRatio!==n.sizeAspectRatio||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.ignoreHydrogens!==n.ignoreHydrogens||r.linkCap!==n.linkCap||r.dashCount!==n.dashCount||r.dashScale!==n.dashScale||r.dashCap!==n.dashCap||r.stubCap!==n.stubCap||!ci(r.includeTypes,n.includeTypes)||!ci(r.excludeTypes,n.excludeTypes)||r.adjustCylinderLength!==n.adjustCylinderLength||r.aromaticBonds!==n.aromaticBonds;var u=o.group.units[0],l=s.group.units[0];ze.isAtomic(u)&&ze.isAtomic(l)&&(Ti.areEqual(u.bonds,l.bonds)||(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.updateSize=!0))},mustRecreate:function(t,r,n){return!r.tryUseImpostor||!n}},e)}function gwe(e){return pi({defaultProps:E.getDefaultValues(T1),createGeometry:vwe,createLocationIterator:wc.fromGroup,getLoci:ww,eachLocation:Aw,setUpdateState:function(t,r,n,a,i,o,s){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.sizeAspectRatio!==n.sizeAspectRatio||r.radialSegments!==n.radialSegments||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.ignoreHydrogens!==n.ignoreHydrogens||r.linkCap!==n.linkCap||r.dashCount!==n.dashCount||r.dashScale!==n.dashScale||r.dashCap!==n.dashCap||r.stubCap!==n.stubCap||!ci(r.includeTypes,n.includeTypes)||!ci(r.excludeTypes,n.excludeTypes)||r.adjustCylinderLength!==n.adjustCylinderLength||r.aromaticBonds!==n.aromaticBonds;var u=o.group.units[0],l=s.group.units[0];ze.isAtomic(u)&&ze.isAtomic(l)&&(Ti.areEqual(u.bonds,l.bonds)||(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.updateSize=!0))},mustRecreate:function(t,r,n){return r.tryUseImpostor&&!!n}},e)}var eS=new Ht.ElementBondIterator;function sM(e,t,r,n){for(eS.setElement(t,r,n);eS.hasNext;){var a=eS.move();return a.otherUnit.conformation.position(a.otherUnit.elements[a.otherIndex],e),e}return null}var uM=C();function d8(e,t,r){var n=Ze.create(e),a=Ht.Location(e,void 0,void 0,e,void 0,void 0),i=e.interUnitBonds,o=i.edgeCount,s=i.edges,u=r.sizeFactor,l=r.sizeAspectRatio,c=r.adjustCylinderLength,d=r.aromaticBonds,f=C(),p,h=e.child;r.includeParent&&h&&(p=function(y){var b=s[y],x=h.unitMap.get(b.unitA),S=h.unitMap.get(b.unitB),_=e.unitMap.get(b.unitA),A=_.elements[b.indexA],T=e.unitMap.get(b.unitB),I=T.elements[b.indexB];return x&&Je.has(x.elements,A)&&(!S||!Je.has(S.elements,I))});var v=function(y){var b=s[y];return a.aUnit=e.unitMap.get(b.unitA),a.aIndex=b.indexA,a.bUnit=e.unitMap.get(b.unitB),a.bIndex=b.indexB,t.size.size(a)*u},m=function(y){var b=s[y];return n.unit=e.unitMap.get(b.unitA),n.element=n.unit.elements[b.indexA],t.size.size(n)*u},g=function(y){var b=s[y];return n.unit=e.unitMap.get(b.unitB),n.element=n.unit.elements[b.indexB],t.size.size(n)*u};return{linkCount:o,referencePosition:function(y){var b=s[y],x,S,_,A;if(b.unitA<b.unitB)x=e.unitMap.get(b.unitA),S=e.unitMap.get(b.unitB),_=b.indexA,A=b.indexB;else if(b.unitA>b.unitB)x=e.unitMap.get(b.unitB),S=e.unitMap.get(b.unitA),_=b.indexB,A=b.indexA;else throw new Error("same units in createInterUnitBondCylinderMesh");return sM(uM,e,x,_)||sM(uM,e,S,A)},position:function(y,b,x){var S=s[x],_=e.unitMap.get(S.unitA),A=e.unitMap.get(S.unitB);if(_.conformation.position(_.elements[S.indexA],y),A.conformation.position(A.elements[S.indexB],b),c){var T=m(x),I=g(x),M=Math.min(T,I)*l,O=Math.sqrt(Math.max(0,T*T-M*M))-.05,D=Math.sqrt(Math.max(0,I*I-M*M))-.05;if(O<=.01&&D<=.01)return;C.normalize(f,C.sub(f,b,y)),C.scaleAndAdd(y,y,f,O),C.scaleAndAdd(b,b,f,-D)}},style:function(y){var b=s[y].props.order,x=ka.create(s[y].props.flag);return kr.is(x,2)||kr.is(x,4)?1:b===3?3:d&&kr.is(x,16)?5:b===2?2:0},radius:function(y){return v(y)*l},ignore:u8(e,r),stub:p}}function ywe(e,t,r,n,a){if(!t.interUnitBonds.edgeCount)return Wi.createEmpty(a);var i=d8(t,r,n),o=mB(e,i,n,a),s=t.child,u=Ne.expand(Ne(),(s!=null?s:t).boundary.sphere,1*n.sizeFactor);return o.setBoundingSphere(u),o}function bwe(e,t,r,n,a){if(!t.interUnitBonds.edgeCount)return Lt.createEmpty(a);var i=d8(t,r,n),o=af(e,i,n,a),s=t.child,u=Ne.expand(Ne(),(s!=null?s:t).boundary.sphere,1*n.sizeFactor);return o.setBoundingSphere(u),o}var E1=w(w(w(w({},Uv),Sme),Cw),{sizeFactor:E.Numeric(.3,{min:0,max:10,step:.01}),sizeAspectRatio:E.Numeric(2/3,{min:0,max:3,step:.01}),tryUseImpostor:E.Boolean(!0),includeParent:E.Boolean(!1)});function f8(e,t,r,n){return r.tryUseImpostor&&n&&n.extensions.fragDepth?Swe(e):xwe(e)}function Swe(e){return xme({defaultProps:E.getDefaultValues(E1),createGeometry:ywe,createLocationIterator:wc.fromStructure,getLoci:Pw,eachLocation:Tw,setUpdateState:function(t,r,n){t.createGeometry=r.sizeAspectRatio!==n.sizeAspectRatio||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.ignoreHydrogens!==n.ignoreHydrogens||r.linkCap!==n.linkCap||r.dashCount!==n.dashCount||r.dashScale!==n.dashScale||r.dashCap!==n.dashCap||r.stubCap!==n.stubCap||!ci(r.includeTypes,n.includeTypes)||!ci(r.excludeTypes,n.excludeTypes)||r.adjustCylinderLength!==n.adjustCylinderLength},mustRecreate:function(t,r,n){return!r.tryUseImpostor||!n}},e)}function xwe(e){return tf({defaultProps:E.getDefaultValues(E1),createGeometry:bwe,createLocationIterator:wc.fromStructure,getLoci:Pw,eachLocation:Tw,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.sizeAspectRatio!==n.sizeAspectRatio||r.radialSegments!==n.radialSegments||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.ignoreHydrogens!==n.ignoreHydrogens||r.linkCap!==n.linkCap||r.dashCount!==n.dashCount||r.dashScale!==n.dashScale||r.dashCap!==n.dashCap||r.stubCap!==n.stubCap||!ci(r.includeTypes,n.includeTypes)||!ci(r.excludeTypes,n.excludeTypes)||r.adjustCylinderLength!==n.adjustCylinderLength},mustRecreate:function(t,r,n){return r.tryUseImpostor&&!!n}},e)}var lM=new Float32Array([-1,1,-1,-1,1,1,1,-1]),Ff=new Uint16Array([0,1,2,1,3,2]),tS=je.add3,Cwe=je.add2,_we=je.add,cy;(function(e){function t(r,n,a){r===void 0&&(r=2048),n===void 0&&(n=1024),r*=4,n*=4;var i=je.create(Float32Array,3,n,a?a.centerBuffer.ref.value:r),o=je.create(Float32Array,2,n,a?a.mappingBuffer.ref.value:r),s=je.create(Uint32Array,3,n/2,a?a.indexBuffer.ref.value:r/2),u=je.create(Float32Array,1,n,a?a.groupBuffer.ref.value:r);return{add:function(l,c,d,f){for(var p=i.elementCount,h=0;h<4;++h)tS(i,l,c,d),Cwe(o,lM[h*2],lM[h*2+1]),_we(u,f);tS(s,p+Ff[0],p+Ff[1],p+Ff[2]),tS(s,p+Ff[3],p+Ff[4],p+Ff[5])},getSpheres:function(){var l=je.compact(i,!0),c=je.compact(o,!0),d=je.compact(s,!0),f=je.compact(u,!0);return xc.create(l,c,d,f,i.elementCount/4,a)}}}e.create=t})(cy||(cy={}));var p8=C.add;function Ew(e,t,r){var n=r.ignoreHydrogens,a=r.traceOnly,i=t.model.atomicHierarchy.derived.atom.atomicNumber,o=ze.isCoarse(t),s=e.child,u=s==null?void 0:s.unitMap.get(t.id);if(s&&!u)throw new Error("expected childUnit to exist if child exists");if(!(!s&&!n&&!a))return function(l){return!!u&&!Je.has(u.elements,l)||!o&&n&&Lg(i,l)||a&&!B3(t,l)}}function wwe(e,t,r,n,a,i){var o=r.child,s=o==null?void 0:o.unitMap.get(t.id);if(o&&!s)return Lt.createEmpty(i);for(var u=a.detail,l=a.sizeFactor,c=t.elements,d=c.length,f=d*e1(u),p=_t.createState(f,f/2,i),h=C(),v=t.conformation.invariantPosition,m=Ew(r,t,a),g=Ze.create(r,t),y=n.size.size,b=C(),x=0,S=0,_=0;_<d;_++)if(!(m&&m(c[_]))){g.element=c[_],v(c[_],h),p8(b,b,h),S+=1,p.currentGroup=_;var A=y(g);A>x&&(x=A),la(p,h,A*l,u)}var T;C.scale(b,b,1/S),i&&C.distance(b,i.boundingSphere.center)/i.boundingSphere.radius<1?T=Ne.clone(i.boundingSphere):T=Ne.expand(Ne(),(s!=null?s:t).boundary.sphere,x*l+.05);var I=_t.getMesh(p);return I.setBoundingSphere(T),I}function Awe(e,t,r,n,a,i){var o=r.child,s=o==null?void 0:o.unitMap.get(t.id);if(o&&!s)return xc.createEmpty(i);for(var u=t.elements,l=u.length,c=cy.create(l,l/2,i),d=C(),f=t.conformation.invariantPosition,p=Ew(r,t,a),h=Ze.create(r,t),v=n.size.size,m=C(),g=0,y=0,b=0;b<l;b++)if(!(p!=null&&p(u[b]))){f(u[b],d),c.add(d[0],d[1],d[2],b),p8(m,m,d),y+=1,h.element=u[b];var x=v(h);x>g&&(g=x)}var S;C.scale(m,m,1/y),i&&C.distance(m,i.boundingSphere.center)/i.boundingSphere.radius<1?S=Ne.clone(i.boundingSphere):S=Ne.expand(Ne(),(s!=null?s:t).boundary.sphere,g*a.sizeFactor+.05);var _=c.getSpheres();return _.setBoundingSphere(S),_}function Zs(e,t,r){var n=!1;if(!Re.is(e))return!1;var a=t.structure,i=t.group;if(!Xe.areEquivalent(e.structure,a))return!1;for(var o=i.elements.length,s=0,u=e.elements;s<u.length;s++){var l=u[s],c=i.unitIndexMap.get(l.unit.id);if(c!==void 0){var d=c*o;if(Ie.is(l.indices)){var f=d+Ie.start(l.indices),p=d+Ie.end(l.indices);r(Ie.ofBounds(f,p))&&(n=!0)}else for(var h=0,v=l.indices.length;h<v;h++){for(var f=l.indices[h],m=h+1;m<v&&l.indices[m]===f;)m++;h=m-1;var p=l.indices[h];n=r(Ie.ofRange(d+f,d+p))||n}}}return n}function Js(e,t,r){var n=e.objectId,a=e.instanceId,i=e.groupId;if(r===n){var o=t.structure,s=t.group,u=s.units[a],l=ke.ofSingleton(i);return Re(o.target,[{unit:u,indices:l}])}return Or}function I1(e,t,r){var n=!1;if(!Re.is(e)||!Xe.areEquivalent(e.structure,t))return!1;for(var a=t.serialMapping.cumulativeUnitElementCount,i=0,o=e.elements;i<o.length;i++){var s=o[i],u=t.unitIndexMap.get(s.unit.id);if(u!==void 0)if(Ie.is(s.indices)){var l=a[u]+Ie.start(s.indices),c=a[u]+Ie.end(s.indices);r(Ie.ofBounds(l,c))&&(n=!0)}else for(var d=0,f=s.indices.length;d<f;d++){var p=a[u]+s.indices[d];r(Ie.ofSingleton(p))&&(n=!0)}}return n}function M1(e,t,r){var n=e.objectId,a=e.groupId;if(r===n){var i=t.serialMapping,o=i.unitIndices,s=i.cumulativeUnitElementCount,u=o[a],l=t.units[u],c=a-s[u],d=ke.ofSingleton(c);return Re(t,[{unit:l,indices:d}])}return Or}var ei;(function(e){function t(n){var a=n.group,i=n.structure,o=a.elements.length,s=a.units.length,u=Ze.create(i),l=function(c,d){var f=a.units[d];return u.unit=f,u.element=f.elements[c],u};return pn(o,s,1,l)}e.fromGroup=t;function r(n){var a=n.units,i=n.elementCount,o=i,s=1,u=n.serialMapping,l=u.unitIndices,c=u.elementIndices,d=Ze.create(n),f=function(p){return d.unit=a[l[p]],d.element=c[p],d};return pn(o,s,1,f,!0)}e.fromStructure=r})(ei||(ei={}));var D1=w(w(w({},Va),tB),{sizeFactor:E.Numeric(1,{min:0,max:10,step:.1}),detail:E.Numeric(0,{min:0,max:3,step:1},At.CustomQualityParamInfo),ignoreHydrogens:E.Boolean(!1),traceOnly:E.Boolean(!1),tryUseImpostor:E.Boolean(!0)});function h8(e,t,r,n){return r.tryUseImpostor&&n&&n.extensions.fragDepth?Pwe(e):Twe(e)}function Pwe(e){return rB({defaultProps:E.getDefaultValues(D1),createGeometry:Awe,createLocationIterator:ei.fromGroup,getLoci:Js,eachLocation:Zs,setUpdateState:function(t,r,n){t.createGeometry=r.ignoreHydrogens!==n.ignoreHydrogens||r.traceOnly!==n.traceOnly},mustRecreate:function(t,r,n){return!r.tryUseImpostor||!n}},e)}function Twe(e){return pi({defaultProps:E.getDefaultValues(D1),createGeometry:wwe,createLocationIterator:ei.fromGroup,getLoci:Js,eachLocation:Zs,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail||r.ignoreHydrogens!==n.ignoreHydrogens||r.traceOnly!==n.traceOnly},mustRecreate:function(t,r,n){return r.tryUseImpostor&&!!n}},e)}var v8={"element-sphere":function(e,t){return Un("Element sphere",e,t,h8)},"intra-bond":function(e,t){return Un("Intra-unit bond cylinder",e,t,c8)},"inter-bond":function(e,t){return as("Inter-unit bond cylinder",e,t,f8)}},m8=w(w(w(w(w({},D1),{traceOnly:E.Boolean(!1,{isHidden:!0})}),T1),E1),{includeParent:E.Boolean(!1),unitKinds:Nv(["atomic"]),sizeFactor:E.Numeric(.15,{min:.01,max:10,step:.01}),sizeAspectRatio:E.Numeric(2/3,{min:.01,max:3,step:.01}),visuals:E.MultiSelect(["element-sphere","intra-bond","inter-bond"],E.objectToOptions(v8))});function Ewe(e,t){return E.clone(m8)}function Iwe(e,t){return or.createMulti("Ball & Stick",e,t,da,v8)}var Mwe={name:"ball-and-stick",label:"Ball & Stick",description:"Displays atoms as spheres and bonds as cylinders.",factory:Iwe,getParams:Ewe,defaultValues:E.getDefaultValues(m8),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"physical"},isApplicable:function(e){return e.elementCount>0},getData:function(e,t){return t.includeParent?e.asParent():e},mustRecreate:function(e,t){return e.includeParent!==t.includeParent}};function Dwe(e,t,r,n,a){var i=t.carbohydrates,o=i.links,s=i.elements,u=n.linkSizeFactor,l=Ze.create(t),c={linkCount:o.length,position:function(d,f,p){var h=o[p];C.copy(d,s[h.carbohydrateIndexA].geometry.center),C.copy(f,s[h.carbohydrateIndexB].geometry.center)},radius:function(d){var f=o[d],p=s[f.carbohydrateIndexA],h=p.unit.rings.all[p.ringIndex];return l.unit=p.unit,l.element=p.unit.elements[h[0]],r.size.size(l)*u}};return af(e,c,n,a)}var g8=w(w(w({},Va),nf),{linkSizeFactor:E.Numeric(.3,{min:0,max:3,step:.01})});function Rwe(e){return tf({defaultProps:E.getDefaultValues(g8),createGeometry:Dwe,createLocationIterator:Owe,getLoci:Fwe,eachLocation:kwe,setUpdateState:function(t,r,n){t.createGeometry=r.linkSizeFactor!==n.linkSizeFactor||r.radialSegments!==n.radialSegments||r.linkCap!==n.linkCap}},e)}function Owe(e){var t=e.carbohydrates,r=t.elements,n=t.links,a=n.length,i=1,o=Ze.create(e),s=function(u){var l=n[u],c=r[l.carbohydrateIndexA],d=c.unit.rings.all[c.ringIndex];return o.unit=c.unit,o.element=c.unit.elements[d[0]],o};return pn(a,i,1,s,!0)}function Fwe(e,t,r){var n=e.objectId,a=e.groupId;if(r===n){var i=t.carbohydrates,o=i.links,s=i.elements,u=o[a],l=s[u.carbohydrateIndexA],c=s[u.carbohydrateIndexB];return Re.union(wv(t,l.unit,l.residueIndex,l.altId),wv(t,c.unit,c.residueIndex,c.altId))}return Or}function kwe(e,t,r){var n=!1;if(!Re.is(e)||!Xe.areEquivalent(e.structure,t))return!1;for(var a=t.carbohydrates.getLinkIndices,i=function(d,f){if(!ze.isAtomic(d))return"continue";ke.forEach(f,function(p){for(var h=a(d,d.elements[p]),v=0,m=h.length;v<m;++v)r(Ie.ofSingleton(h[v]))&&(n=!0)})},o=0,s=e.elements;o<s.length;o++){var u=s[o],l=u.unit,c=u.indices;i(l,c)}return n}var Bwe=C.create(0,0,-.5),Lwe=C.create(0,0,.5),Ol=C(),Fl=C(),n0=C(),cM=C();function Nwe(e){for(var t=e.length/3,r=t===3?1:t===4?2:t,n=r+t,a=t===4?t*3+4:n*3,i=Op(n,a),o=0;o<t;++o){var s=(o+1)%t;C.set(Ol,e[o*3],e[o*3+1],-.5),C.set(Fl,e[s*3],e[s*3+1],-.5),i.add(Ol,Fl,Lwe)}if(t===3)C.set(Ol,e[0],e[1],-.5),C.set(Fl,e[3],e[4],-.5),C.set(n0,e[6],e[7],-.5),i.add(n0,Fl,Ol);else if(t===4)C.set(Ol,e[0],e[1],-.5),C.set(Fl,e[3],e[4],-.5),C.set(n0,e[6],e[7],-.5),C.set(cM,e[9],e[10],-.5),i.addQuad(cM,n0,Fl,Ol);else for(var o=0;o<t;++o){var s=(o+1)%t;C.set(Ol,e[o*3],e[o*3+1],-.5),C.set(Fl,e[s*3],e[s*3+1],-.5),i.add(Bwe,Fl,Ol)}return i.getPrimitive()}var rS;function Uwe(){return rS||(rS=Nwe(Qs(8,!0))),rS}var nS;function zwe(){if(!nS){for(var e=Qs(8,!0),t=new Float32Array(8*3+6),r=0;r<8;++r)t[r*3]=e[r*3],t[r*3+1]=e[r*3+1],t[r*3+2]=-.5;t[8*3]=0,t[8*3+1]=0,t[8*3+2]=-.5,t[8*3+3]=0,t[8*3+4]=0,t[8*3+5]=.5;var n=[0,1,8,1,2,8,4,5,8,5,6,8,2,3,9,3,4,9,6,7,9,7,0,9];nS=Zy(t,n)}return nS}var Vwe={pointCount:5,outerRadius:1,innerRadius:.5,thickness:.3},aS=C.zero(),iS=C.zero(),oS=C.zero(),fh=C.zero(),sS=C.zero();function Hwe(e){for(var t=w(w({},Vwe),e),r=t.outerRadius,n=t.innerRadius,a=t.thickness,i=t.pointCount,o=i*2*2,s=Op(o),u=new Float32Array(i*2),l=new Float32Array(i*2),c=0;c<i;++c){var d=c*2,f=c*2+1,p=(d+1)/i*Math.PI,h=(f+1)/i*Math.PI;l[d]=Math.cos(p)*r,l[f]=Math.sin(p)*r,u[d]=Math.cos(h)*n,u[f]=Math.sin(h)*n}C.set(aS,0,0,a/2),C.set(iS,0,0,-a/2);for(var c=0;c<i;++c){var v=(c+1)%i;C.set(oS,l[c*2],l[c*2+1],0),C.set(fh,u[c*2],u[c*2+1],0),C.set(sS,l[v*2],l[v*2+1],0),s.add(aS,oS,fh),s.add(fh,oS,iS),s.add(aS,fh,sS),s.add(sS,fh,iS)}return s.getPrimitive()}var y8=[.5,0,0,-.5,0,0,0,.5,0,0,-.5,0,0,0,.5,0,0,-.5],Gwe=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],qwe=[0,2,4,0,4,3,1,2,5,1,5,3],uS;function jwe(){return uS||(uS=Zy(y8,Gwe)),uS}var lS;function Wwe(){return lS||(lS=Zy(y8,qwe)),lS}var Ft=ue.identity(),fu=C.zero(),dM=C.zero(),Xwe=2*.806,fM=y3(),pM=Yae(),Ywe=Uwe(),hM=zwe(),Kwe=Hwe({outerRadius:1,innerRadius:.5,thickness:.5,pointCount:5}),$we=jwe(),vM=Wwe(),mM=vue(),Qwe=mue(),Zwe=gue(),Jwe=yue(),eAe=bue();function tAe(e,t,r,n,a){for(var i=_t.createState(256,128,a),o=n.detail,s=n.sizeFactor,u=t.carbohydrates,l=u.elements.length,c=Ze.create(t),d=0;d<l;++d){var f=u.elements[d],p=f.unit.rings.all[f.ringIndex],h=FK(f.component.type,p.length);c.unit=f.unit,c.element=f.unit.elements[p[0]];var v=r.size.size(c),m=v*s,g=v*s*Xwe,y=f.geometry,b=y.center,x=y.normal,S=y.direction;switch(C.add(dM,b,S),ue.targetTo(Ft,b,dM,x),ue.setTranslation(Ft,b),i.currentGroup=d*2,h){case 0:la(i,b,m,o);break;case 1:ue.scaleUniformly(Ft,Ft,g),_t.addPrimitive(i,Ft,fM);break;case 2:ue.scaleUniformly(Ft,Ft,g),_t.addPrimitive(i,Ft,pM),ue.mul(Ft,Ft,ue.rotZ90X180),i.currentGroup+=1,_t.addPrimitive(i,Ft,pM);break;case 4:ue.scaleUniformly(Ft,Ft,g*1.2),_t.addPrimitive(i,Ft,Ywe);break;case 5:ue.scaleUniformly(Ft,Ft,g*1.2),_t.addPrimitive(i,Ft,hM),ue.mul(Ft,Ft,ue.rotZ90),i.currentGroup+=1,_t.addPrimitive(i,Ft,hM);break;case 6:ue.mul(Ft,Ft,ue.rotZY90),ue.scale(Ft,Ft,C.set(fu,g,g,g/2)),_t.addPrimitive(i,Ft,fM);break;case 7:ue.scaleUniformly(Ft,Ft,g),ue.mul(Ft,Ft,ue.rotZY90),_t.addPrimitive(i,Ft,Kwe);break;case 8:ue.mul(Ft,Ft,ue.rotZY90),ue.scale(Ft,Ft,C.set(fu,g*1.4,g*1.4,g*1.4)),_t.addPrimitive(i,Ft,$we);break;case 3:ue.mul(Ft,Ft,ue.rotZY90),ue.scale(Ft,Ft,C.set(fu,g*1.4,g*1.4,g*1.4)),_t.addPrimitive(i,Ft,vM),ue.mul(Ft,Ft,ue.rotY90),i.currentGroup+=1,_t.addPrimitive(i,Ft,vM);break;case 9:ue.mul(Ft,Ft,ue.rotZY90),ue.scale(Ft,Ft,C.set(fu,g,g/2,g/2)),_t.addPrimitive(i,Ft,mM);break;case 12:ue.mul(Ft,Ft,ue.rotZY90),ue.scale(Ft,Ft,C.set(fu,g,g,g/2)),_t.addPrimitive(i,Ft,mM);break;case 13:case 11:ue.mul(Ft,Ft,ue.rotZY90),ue.scale(Ft,Ft,C.set(fu,g,g,g/2)),_t.addPrimitive(i,Ft,Qwe);break;case 14:ue.mul(Ft,Ft,ue.rotZY90),ue.scale(Ft,Ft,C.set(fu,g,g,g/2)),_t.addPrimitive(i,Ft,Zwe);break;case 15:ue.mul(Ft,Ft,ue.rotZY90),ue.scale(Ft,Ft,C.set(fu,g,g,g/2)),_t.addPrimitive(i,Ft,eAe);break;case 10:default:ue.mul(Ft,Ft,ue.rotZYZ90),ue.scale(Ft,Ft,C.set(fu,g/1.5,g,g/2)),_t.addPrimitive(i,Ft,Jwe);break}}return _t.getMesh(i)}var b8=w(w({},Uv),{detail:E.Numeric(0,{min:0,max:3,step:1},At.CustomQualityParamInfo),sizeFactor:E.Numeric(1.75,{min:0,max:10,step:.01})});function rAe(e){return tf({defaultProps:E.getDefaultValues(b8),createGeometry:tAe,createLocationIterator:nAe,getLoci:aAe,eachLocation:iAe,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail}},e)}function nAe(e){var t=e.carbohydrates.elements,r=t.length*2,n=1,a=Ze.create(e);function i(s,u){var l=t[Math.floor(s/2)],c=l.unit.rings.all[l.ringIndex];return a.unit=l.unit,a.element=l.unit.elements[c[0]],a}function o(s,u){return s%2===1}return pn(r,n,1,i,!0,o)}function aAe(e,t,r){var n=e.objectId,a=e.groupId;if(r===n){var i=t.carbohydrates.elements[Math.floor(a/2)];return wv(t,i.unit,i.residueIndex,i.altId)}return Or}function iAe(e,t,r){var n=t.carbohydrates.getElementIndices,a=!1;if(!Re.is(e)||!Xe.areEquivalent(e.structure,t))return!1;for(var i=function(d,f){if(!ze.isAtomic(d))return"continue";ke.forEach(f,function(p){for(var h=n(d,d.elements[p]),v=0,m=h.length;v<m;++v)r(Ie.ofSingleton(h[v]*2))&&(a=!0)})},o=0,s=e.elements;o<s.length;o++){var u=s[o],l=u.unit,c=u.indices;i(l,c)}return a}function oAe(e,t,r,n,a){var i=t.carbohydrates,o=i.terminalLinks,s=i.elements,u=n.terminalLinkSizeFactor,l=Ze.create(t),c={linkCount:o.length,position:function(d,f,p){var h=o[p];h.fromCarbohydrate?(C.copy(d,s[h.carbohydrateIndex].geometry.center),h.elementUnit.conformation.position(h.elementUnit.elements[h.elementIndex],f)):(h.elementUnit.conformation.position(h.elementUnit.elements[h.elementIndex],d),C.copy(f,s[h.carbohydrateIndex].geometry.center))},radius:function(d){var f=o[d];if(f.fromCarbohydrate){var p=s[f.carbohydrateIndex],h=p.unit.rings.all[p.ringIndex];l.unit=p.unit,l.element=p.unit.elements[h[0]]}else l.unit=f.elementUnit,l.element=f.elementUnit.elements[f.elementIndex];return r.size.size(l)*u},style:function(d){var f=o[d],p=f.elementUnit.elements[f.elementIndex],h=pp(f.elementUnit.model.atomicHierarchy.atoms.type_symbol.value(p));return yv.has(h)?1:0}};return af(e,c,n,a)}var S8=w(w(w({},Va),nf),{terminalLinkSizeFactor:E.Numeric(.2,{min:0,max:3,step:.01})});function sAe(e){return tf({defaultProps:E.getDefaultValues(S8),createGeometry:oAe,createLocationIterator:uAe,getLoci:lAe,eachLocation:cAe,setUpdateState:function(t,r,n){t.createGeometry=r.terminalLinkSizeFactor!==n.terminalLinkSizeFactor||r.radialSegments!==n.radialSegments||r.linkCap!==n.linkCap}},e)}function uAe(e){var t=e.carbohydrates,r=t.elements,n=t.terminalLinks,a=n.length,i=1,o=Ze.create(e),s=function(u){var l=n[u];if(l.fromCarbohydrate){var c=r[l.carbohydrateIndex],d=c.unit.rings.all[c.ringIndex];o.unit=c.unit,o.element=c.unit.elements[d[0]]}else o.unit=l.elementUnit,o.element=l.elementUnit.elements[l.elementIndex];return o};return pn(a,i,1,s,!0)}function lAe(e,t,r){var n=e.objectId,a=e.groupId;if(r===n){var i=t.carbohydrates,o=i.terminalLinks,s=i.elements,u=o[a],l=s[u.carbohydrateIndex];return Re.union(wv(t,l.unit,l.residueIndex,l.altId),lme(t,u.elementUnit,u.elementUnit.elements[u.elementIndex]))}return Or}function cAe(e,t,r){var n=!1;if(!Re.is(e)||!Xe.areEquivalent(e.structure,t))return!1;for(var a=t.carbohydrates.getTerminalLinkIndices,i=function(d,f){if(!ze.isAtomic(d))return"continue";ke.forEach(f,function(p){for(var h=a(d,d.elements[p]),v=0,m=h.length;v<m;++v)r(Ie.ofSingleton(h[v]))&&(n=!0)})},o=0,s=e.elements;o<s.length;o++){var u=s[o],l=u.unit,c=u.indices;i(l,c)}return n}var x8={"carbohydrate-symbol":function(e,t){return as("Carbohydrate symbol mesh",e,t,rAe)},"carbohydrate-link":function(e,t){return as("Carbohydrate link cylinder",e,t,Rwe)},"carbohydrate-terminal-link":function(e,t){return as("Carbohydrate terminal link cylinder",e,t,sAe)}},C8=w(w(w(w({},b8),g8),S8),{visuals:E.MultiSelect(["carbohydrate-symbol","carbohydrate-link","carbohydrate-terminal-link"],E.objectToOptions(x8))});function dAe(e,t){return E.clone(C8)}function fAe(e,t){return or.createMulti("Carbohydrate",e,t,da,x8)}var pAe={name:"carbohydrate",label:"Carbohydrate",description:"Displays carbohydrate symbols (3D SNFG).",factory:fAe,getParams:dAe,defaultValues:E.getDefaultValues(C8),defaultColorTheme:{name:"carbohydrate-symbol"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.models.some(function(t){return jt.hasCarbohydrate(t)})}};function _8(e,t){switch(e.kind){case 0:return hAe(e,t);case 1:case 2:return vAe(e,t)}}function hAe(e,t){for(var r=e.model.atomicRanges.cyclicPolymerMap,n=Kr.transientSegments(Kv(e),e.elements),a=nr.transientSegments(e.model.atomicHierarchy.residueAtomSegments,e.elements),i=e.model.atomicHierarchy.derived.residue.traceElementIndex,o=e.model.atomicHierarchy.derived.residue.moleculeType,s=-1,u=-1,l=!0,c=-1,d=0;n.hasNext;){for(l=!0,c=d,a.setSegment(n.move());a.hasNext;){if(l){var f=a.move().index;if(++d,!a.hasNext)continue;l=!1,u=f}var p=a.move().index;s=u,u=p,t(i[s],i[u],d-1,d,o[s]),++d}r.has(u)&&(s=u,u=r.get(s),t(i[s],i[u],d-1,c,o[s]))}}function vAe(e,t){for(var r=Kr.transientSegments(Kv(e),e.elements),n=e.elements,a=!0,i=0;r.hasNext;){a=!0;for(var o=r.move(),s=o.start,u=o.end,l=s,c=u;l<c;++l){if(a){if(++l,++i,l>c)continue;a=!1}t(n[l-1],n[l],i-1,i,0),++i}}}function w8(e,t){switch(e.kind){case 0:return mAe(e,t);case 1:case 2:return gAe(e,t)}}function mAe(e,t){for(var r=Kr.transientSegments(Kv(e),e.elements),n=nr.transientSegments(e.model.atomicHierarchy.residueAtomSegments,e.elements),a=e.model.atomicHierarchy.derived.residue.traceElementIndex,i=0;r.hasNext;)for(n.setSegment(r.move());n.hasNext;){var o=n.move().index;t(a[o],i),++i}}function gAe(e,t){for(var r=Kr.transientSegments(Kv(e),e.elements),n=e.elements,a=0;r.hasNext;)for(var i=r.move(),o=i.start,s=i.end,u=o,l=s;u<l;++u)t(n[u],a),++a}function yAe(e,t){switch(t.kind){case 0:return new bAe(e,t);case 1:case 2:return new SAe(e,t)}}function A8(e,t){return{centerA:Ze.create(e,t),centerB:Ze.create(e,t)}}var bAe=function(){function e(t,r){this.unit=r,this.hasNext=!1,this.traceElementIndex=r.model.atomicHierarchy.derived.residue.traceElementIndex,this.gapIt=Kr.transientSegments(E8(r),r.elements),this.value=A8(t,r),this.hasNext=this.gapIt.hasNext}return e.prototype.move=function(){var t=this.unit,r=t.elements,n=t.residueIndex,a=this.gapIt.move();return this.value.centerA.element=this.traceElementIndex[n[r[a.start]]],this.value.centerB.element=this.traceElementIndex[n[r[a.end-1]]],this.hasNext=this.gapIt.hasNext,this.value},e}(),SAe=function(){function e(t,r){this.unit=r,this.hasNext=!1,this.gapIt=Kr.transientSegments(E8(r),r.elements),this.value=A8(t,r),this.hasNext=this.gapIt.hasNext}return e.prototype.move=function(){var t=this.gapIt.move();return this.value.centerA.element=this.unit.elements[t.start],this.value.centerB.element=this.unit.elements[t.end-1],this.hasNext=this.gapIt.hasNext,this.value},e}();function xAe(e){for(var t=e.atomicConformation,r=t.x,n=t.y,a=t.z,i=e.atomicHierarchy.derived.residue,o=i.polymerType,s=i.traceElementIndex,u=o.length,l=ke.ofBounds(0,e.atomicConformation.atomId.rowCount),c=Kr.transientSegments(e.atomicRanges.polymerRanges,l),d=nr.transientSegments(e.atomicHierarchy.residueAtomSegments,l),f=new Float32Array(u*3),p=new Float32Array(u*3),h=0,v=-1,m=-1,g=C(),y=C(),b=C(),x=C(),S=C(),_=C(),A=C(),T=C(),I=C(),M=C(),O=C(),D=C(),F=C(),G=C();c.hasNext;){var N=c.move();for(d.setSegment(N),h=-1,m=-1;d.hasNext;){h+=1;var z=d.move().index;h===0&&(m=z),v=z-2;var $=v*3;C.copy(g,y),C.copy(y,b),C.copy(b,x);var j=s[z];if(C.set(x,r[j],n[j],a[j]),!(h<3)){C.sub(S,y,g),C.sub(_,b,y),C.sub(A,x,b),C.sub(O,S,_),C.sub(D,_,A),C.cross(F,O,D),C.normalize(F,F),C.toArray(F,p,$);var Z=Math.cos(C.angle(O,D)),q=C.magnitude(O),te=C.magnitude(D),he=Math.sqrt(te*q)/Math.max(2,2*(1-Z));C.scale(T,O,he/q),C.sub(T,y,T),C.toArray(T,f,$),C.scale(I,D,he/te),C.sub(I,b,I),C.toArray(I,f,$+3),C.copy(G,F)}}var W=m*3;C.fromArray(T,f,W+3),C.fromArray(I,f,W+6),C.normalize(F,C.sub(F,T,I));var K=s[m];C.set(g,r[K],n[K],a[K]),C.copy(M,g),C.projectPointOnVector(M,M,F,T),C.toArray(M,f,W);var U=v+2,H=U*3;C.fromArray(T,f,H-3),C.fromArray(I,f,H-6),C.normalize(F,C.sub(F,T,I));var J=s[U];C.set(g,r[J],n[J],a[J]),C.copy(M,g),C.projectPointOnVector(M,M,F,T),C.toArray(M,f,H)}return{centers:f}}var QC=Bd.createProvider({label:"Helix Orientation",descriptor:Pi({name:"molstar_helix_orientation"}),type:"dynamic",defaultParams:{},getParams:function(){return{}},isApplicable:function(e){return!0},obtain:function(e,t){return ce(void 0,void 0,void 0,function(){return de(this,function(r){return[2,{value:xAe(t)}]})})}});function Vo(e){return Fr.is(e,2)}function CAe(e){return Fr.is(e,4)}function Iw(e,t,r){switch(r===void 0&&(r={}),e.kind){case 0:return new _Ae(e,t,r);case 1:case 2:return new wAe(e,t)}}var L0=Fr.create(536870912);function P8(e,t){return{center:Ze.create(e,t),centerPrev:Ze.create(e,t),centerNext:Ze.create(e,t),first:!1,last:!1,initial:!1,final:!1,secStrucFirst:!1,secStrucLast:!1,secStrucType:L0,moleculeType:0,coarseBackboneFirst:!1,coarseBackboneLast:!1,isCoarseBackbone:!1,p0:C(),p1:C(),p2:C(),p3:C(),p4:C(),d12:C(),d23:C()}}var Kt=C(),a0=C(),i0=C(),_Ae=function(){function e(t,r,n){n===void 0&&(n={});var a;if(this.unit=t,this.state=0,this.p0=C(),this.p1=C(),this.p2=C(),this.p3=C(),this.p4=C(),this.p5=C(),this.p6=C(),this.d01=C(),this.d12=C(),this.d23=C(),this.d34=C(),this.hasNext=!1,this.atomicConformation=t.model.atomicConformation,this.residueAtomSegments=t.model.atomicHierarchy.residueAtomSegments,this.polymerRanges=t.model.atomicRanges.polymerRanges,this.traceElementIndex=t.model.atomicHierarchy.derived.residue.traceElementIndex,this.directionFromElementIndex=t.model.atomicHierarchy.derived.residue.directionFromElementIndex,this.directionToElementIndex=t.model.atomicHierarchy.derived.residue.directionToElementIndex,this.moleculeType=t.model.atomicHierarchy.derived.residue.moleculeType,this.cyclicPolymerMap=t.model.atomicRanges.cyclicPolymerMap,this.polymerIt=Kr.transientSegments(this.polymerRanges,t.elements),this.residueIt=nr.transientSegments(this.residueAtomSegments,t.elements),this.value=P8(r,t),this.hasNext=this.residueIt.hasNext&&this.polymerIt.hasNext,n.ignoreSecondaryStructure||(this.secondaryStructure=(a=Xs.get(r).value)===null||a===void 0?void 0:a.get(t.invariantId)),n.useHelixOrientation){var i=QC.get(t.model).value;if(!i)throw new Error("missing helix-orientation");this.helixOrientationCenters=i.centers}}return e.prototype.atomicPos=function(t,r){r!==-1&&(t[0]=this.atomicConformation.x[r],t[1]=this.atomicConformation.y[r],t[2]=this.atomicConformation.z[r])},e.prototype.pos=function(t,r,n){var a=this.traceElementIndex[r];this.helixOrientationCenters&&Vo(n)?C.fromArray(t,this.helixOrientationCenters,r*3):this.atomicPos(t,a)},e.prototype.updateResidueSegmentRange=function(t){var r=this.residueAtomSegments.index;this.residueSegmentMin=r[this.polymerRanges[t.index*2]],this.residueSegmentMax=r[this.polymerRanges[t.index*2+1]]},e.prototype.getResidueIndex=function(t){if(t<this.residueSegmentMin){var r=this.cyclicPolymerMap.get(this.residueSegmentMin);r!==void 0?t=r-(this.residueSegmentMin-t-1):t=this.residueSegmentMin}else if(t>this.residueSegmentMax){var r=this.cyclicPolymerMap.get(this.residueSegmentMax);r!==void 0?t=r+(t-this.residueSegmentMax-1):t=this.residueSegmentMax}return t},e.prototype.getSecStruc=function(t){if(this.secondaryStructure){var r=this.secondaryStructure,n=r.type,a=r.getIndex,i=n[a(t)];return Vo(i)?2:i}else return L0},e.prototype.setControlPoint=function(t,r,n,a,i){CAe(i)||this.helixOrientationCenters&&Vo(i)?C.scale(t,C.add(t,r,C.add(t,a,C.add(t,n,n))),1/4):C.copy(t,n)},e.prototype.setFromToVector=function(t,r,n){this.value.isCoarseBackbone||this.helixOrientationCenters&&Vo(n)?C.set(t,1,0,0):(this.atomicPos(a0,this.directionFromElementIndex[r]),this.atomicPos(i0,this.directionToElementIndex[r]),C.sub(t,i0,a0))},e.prototype.setDirection=function(t,r,n,a){C.matchDirection(a0,r,n),C.matchDirection(i0,a,n),C.scale(t,C.add(t,a0,C.add(t,i0,C.add(t,n,n))),1/4)},e.prototype.move=function(){var t=this,r=t.residueIt,n=t.polymerIt,a=t.value;if(this.state===0){for(;n.hasNext;)if(this.polymerSegment=n.move(),r.setSegment(this.polymerSegment),this.updateResidueSegmentRange(this.polymerSegment),r.hasNext){this.state=1;var i=this.residueAtomSegments.index[this.unit.elements[this.polymerSegment.start]],o=this.getResidueIndex(i-1);this.currSecStrucType=i===o?L0:this.getSecStruc(o),this.nextSecStrucType=this.getSecStruc(i),this.currCoarseBackbone=this.directionFromElementIndex[o]===-1||this.directionToElementIndex[o]===-1,this.nextCoarseBackbone=this.directionFromElementIndex[i]===-1||this.directionToElementIndex[i]===-1;break}}if(this.state===1){var s=r.move().index,u=this.getResidueIndex(s-3),l=this.getResidueIndex(s-2),c=this.getResidueIndex(s-1),d=this.getResidueIndex(s+1),f=this.getResidueIndex(s+2),p=this.getResidueIndex(s+3);this.prevSecStrucType=this.currSecStrucType,this.currSecStrucType=this.nextSecStrucType,this.nextSecStrucType=s===d?L0:this.getSecStruc(d),this.prevCoarseBackbone=this.currCoarseBackbone,this.currCoarseBackbone=this.nextCoarseBackbone,this.nextCoarseBackbone=this.directionFromElementIndex[d]===-1||this.directionToElementIndex[d]===-1,a.secStrucType=this.currSecStrucType,a.secStrucFirst=this.prevSecStrucType!==this.currSecStrucType,a.secStrucLast=this.currSecStrucType!==this.nextSecStrucType,a.isCoarseBackbone=this.currCoarseBackbone,a.coarseBackboneFirst=this.prevCoarseBackbone!==this.currCoarseBackbone,a.coarseBackboneLast=this.currCoarseBackbone!==this.nextCoarseBackbone,a.first=s===this.residueSegmentMin,a.last=s===this.residueSegmentMax,a.moleculeType=this.moleculeType[s],a.initial=s===c,a.final=s===d,a.centerPrev.element=this.traceElementIndex[c],a.center.element=this.traceElementIndex[s],a.centerNext.element=this.traceElementIndex[d];var h=this.getSecStruc(u),v=this.getSecStruc(l),m=this.getSecStruc(c),g=this.getSecStruc(s),y=this.getSecStruc(d),b=this.getSecStruc(f),x=this.getSecStruc(p);this.pos(this.p0,u,h),this.pos(this.p1,l,v),this.pos(this.p2,c,m),this.pos(this.p3,s,g),this.pos(this.p4,d,y),this.pos(this.p5,f,b),this.pos(this.p6,p,x);var S=Vo(h),_=Vo(v),A=Vo(m),T=Vo(g),I=Vo(y),M=Vo(b),O=Vo(x);this.helixOrientationCenters&&(T!==A?T?(C.copy(this.p0,this.p3),C.copy(this.p1,this.p3),C.copy(this.p2,this.p3)):A&&(C.scale(Kt,C.sub(Kt,this.p2,this.p3),2),C.add(this.p2,this.p3,Kt),C.add(this.p1,this.p2,Kt),C.add(this.p0,this.p1,Kt)):T!==_?T?(C.copy(this.p0,this.p2),C.copy(this.p1,this.p2)):_&&(C.scale(Kt,C.sub(Kt,this.p1,this.p2),2),C.add(this.p1,this.p2,Kt),C.add(this.p0,this.p1,Kt)):T!==S&&(T?C.copy(this.p0,this.p1):S&&(C.scale(Kt,C.sub(Kt,this.p0,this.p1),2),C.add(this.p0,this.p1,Kt))),T!==I?T?(C.copy(this.p4,this.p3),C.copy(this.p5,this.p3),C.copy(this.p6,this.p3)):I&&(C.scale(Kt,C.sub(Kt,this.p4,this.p3),2),C.add(this.p4,this.p3,Kt),C.add(this.p5,this.p4,Kt),C.add(this.p6,this.p5,Kt)):T!==M?T?(C.copy(this.p5,this.p4),C.copy(this.p6,this.p4)):M&&(C.scale(Kt,C.sub(Kt,this.p5,this.p4),2),C.add(this.p5,this.p4,Kt),C.add(this.p6,this.p5,Kt)):T!==O&&(T?C.copy(this.p6,this.p5):O&&(C.scale(Kt,C.sub(Kt,this.p6,this.p5),2),C.add(this.p6,this.p5,Kt)))),this.setFromToVector(this.d01,c,m),this.setFromToVector(this.d12,s,g),this.setFromToVector(this.d23,d,y),this.setFromToVector(this.d34,f,b);var D=T&&this.helixOrientationCenters,F=1.5;s===c||g!==m&&D?(C.setMagnitude(Kt,C.sub(Kt,this.p3,this.p4),F),C.add(this.p2,this.p3,Kt),C.add(this.p1,this.p2,Kt),C.add(this.p0,this.p1,Kt)):c===l||g!==v&&D?(C.setMagnitude(Kt,C.sub(Kt,this.p2,this.p3),F),C.add(this.p1,this.p2,Kt),C.add(this.p0,this.p1,Kt)):(l===u||g!==h&&D)&&(C.setMagnitude(Kt,C.sub(Kt,this.p1,this.p2),F),C.add(this.p0,this.p1,Kt)),s===d||g!==y&&D?(C.setMagnitude(Kt,C.sub(Kt,this.p3,this.p2),F),C.add(this.p4,this.p3,Kt),C.add(this.p5,this.p4,Kt),C.add(this.p6,this.p5,Kt)):d===f||g!==b&&D?(C.setMagnitude(Kt,C.sub(Kt,this.p4,this.p3),F),C.add(this.p5,this.p4,Kt),C.add(this.p6,this.p5,Kt)):(f===p||g!==x&&D)&&(C.setMagnitude(Kt,C.sub(Kt,this.p5,this.p4),F),C.add(this.p6,this.p5,Kt)),this.setControlPoint(a.p0,this.p0,this.p1,this.p2,v),this.setControlPoint(a.p1,this.p1,this.p2,this.p3,m),this.setControlPoint(a.p2,this.p2,this.p3,this.p4,g),this.setControlPoint(a.p3,this.p3,this.p4,this.p5,y),this.setControlPoint(a.p4,this.p4,this.p5,this.p6,b),this.setDirection(a.d12,this.d01,this.d12,this.d23),this.setDirection(a.d23,this.d12,this.d23,this.d34),r.hasNext||(this.state=0)}return this.hasNext=r.hasNext||n.hasNext,this.value},e}(),wAe=function(){function e(t,r){switch(this.unit=t,this.state=0,this.hasNext=!1,this.polymerIt=Kr.transientSegments(Kv(t),t.elements),this.value=P8(r,t),C.set(this.value.d12,1,0,0),C.set(this.value.d23,1,0,0),t.kind){case 1:this.conformation=t.model.coarseConformation.spheres;break;case 2:this.conformation=t.model.coarseConformation.gaussians;break}this.hasNext=this.polymerIt.hasNext}return e.prototype.getElementIndex=function(t){return Math.min(Math.max(this.polymerSegment.start,t),this.polymerSegment.end-1)},e.prototype.pos=function(t,r){var n=this.unit.elements[r];t[0]=this.conformation.x[n],t[1]=this.conformation.y[n],t[2]=this.conformation.z[n]},e.prototype.move=function(){if(this.state===0){for(;this.polymerIt.hasNext;)if(this.polymerSegment=this.polymerIt.move(),this.elementIndex=this.polymerSegment.start,this.elementIndex<this.polymerSegment.end){this.state=1;break}}if(this.state===1){var t=this.getElementIndex(this.elementIndex-2),r=this.getElementIndex(this.elementIndex-1),n=this.getElementIndex(this.elementIndex+1),a=this.getElementIndex(this.elementIndex+2);this.value.centerPrev.element=this.value.center.unit.elements[r],this.value.center.element=this.value.center.unit.elements[this.elementIndex],this.value.centerNext.element=this.value.center.unit.elements[n],this.pos(this.value.p0,t),this.pos(this.value.p1,r),this.pos(this.value.p2,this.elementIndex),this.pos(this.value.p3,n),this.pos(this.value.p4,a);var i=.5;this.elementIndex===r?(C.scale(Kt,C.sub(Kt,this.value.p2,this.value.p3),i),C.add(this.value.p1,this.value.p2,Kt),C.add(this.value.p0,this.value.p1,Kt)):r===t&&(C.scale(Kt,C.sub(Kt,this.value.p1,this.value.p2),i),C.add(this.value.p0,this.value.p1,Kt)),this.elementIndex===n?(C.scale(Kt,C.sub(Kt,this.value.p2,this.value.p1),i),C.add(this.value.p3,this.value.p2,Kt),C.add(this.value.p4,this.value.p3,Kt)):n===a&&(C.scale(Kt,C.sub(Kt,this.value.p3,this.value.p2),i),C.add(this.value.p4,this.value.p3,Kt)),this.value.first=this.elementIndex===this.polymerSegment.start,this.value.last=this.elementIndex===this.polymerSegment.end-1,this.elementIndex+1>=this.polymerSegment.end&&(this.state=0)}return this.hasNext=this.elementIndex+1<this.polymerSegment.end||this.polymerIt.hasNext,this.elementIndex+=1,this.value},e}(),Xc=C.fromArray,Qf=C.toArray,ZC=C.normalize,AAe=C.sub,kf=C.spline,PAe=C.slerp,gM=C.copy,yM=C.cross,cS=C.orthogonalize,TAe=C.matchDirection,EAe=C.scale,bM=C.add;function Mw(e){var t=e+1,r=t*3;return{curvePoints:new Float32Array(r),tangentVectors:new Float32Array(r),normalVectors:new Float32Array(r),binormalVectors:new Float32Array(r),widthValues:new Float32Array(t),heightValues:new Float32Array(t),linearSegments:e}}function Dw(e,t,r,n){IAe(e,t,r,n),DAe(e,t)}var dS=C(),fS=C(),pS=C();function IAe(e,t,r,n){for(var a=e.curvePoints,i=e.tangentVectors,o=e.linearSegments,s=t.p0,u=t.p1,l=t.p2,c=t.p3,d=t.p4,f=t.secStrucFirst,p=t.secStrucLast,h=1-n,v=f?.5:r,m=p?.5:r,g=0;g<=o;++g){var y=g*1/o;if(y<h){var b=Gi(v,r,y);kf(pS,s,u,l,c,y+n,b),kf(dS,s,u,l,c,y+n+.01,v),kf(fS,s,u,l,c,y+n-.01,v)}else{var b=Gi(r,m,y);kf(pS,u,l,c,d,y-h,b),kf(dS,u,l,c,d,y-h+.01,b),kf(fS,u,l,c,d,y-h-.01,b)}Qf(pS,a,g*3),ZC(Ql,AAe(Ql,dS,fS)),Qf(Ql,i,g*3)}}var MAe=C(),Ql=C(),Ho=C(),Bf=C(),ph=C(),SM=C(),xM=C(),CM=C(),hS=C(),o0=C();function DAe(e,t){var r=e.curvePoints,n=e.tangentVectors,a=e.normalVectors,i=e.binormalVectors,o=t.d12,s=t.d23,u=r.length/3;Xc(xM,n,0),Xc(CM,n,(u-1)*3),cS(hS,xM,o),cS(o0,CM,s),TAe(o0,o0,hS),gM(ph,hS);for(var l=u-1,c=0;c<u;++c){var d=eR(0,l,c)*l,f=c===0?0:1/(u-d);Xc(Ql,n,c*3),cS(Ho,Ql,PAe(MAe,ph,o0,f)),Qf(Ho,a,c*3),gM(ph,Ho),ZC(Bf,yM(Bf,Ql,Ho)),Qf(Bf,i,c*3)}for(var c=1;c<l;++c)Xc(ph,a,(c-1)*3),Xc(Ho,a,c*3),Xc(SM,a,(c+1)*3),EAe(Ho,bM(Ho,ph,bM(Ho,SM,Ho)),1/3),Qf(Ho,a,c*3),Xc(Ql,n,c*3),ZC(Bf,yM(Bf,Ql,Ho)),Qf(Bf,i,c*3)}function JC(e,t,r,n,a,i,o,s){for(var u=e.widthValues,l=e.heightValues,c=e.linearSegments,d=1-s,f=0;f<=c;++f){var p=f*1/c;p<d?(u[f]=Gi(t,r,p+s),l[f]=Gi(a,i,p+s)):(u[f]=Gi(r,n,p-d),l[f]=Gi(i,o,p-d))}}var T8=.5,RAe=.9,R1=.5,O1=.3,dy=2;function Kv(e){switch(e.kind){case 0:return e.model.atomicRanges.polymerRanges;case 1:return e.model.coarseHierarchy.spheres.polymerRanges;case 2:return e.model.coarseHierarchy.gaussians.polymerRanges}}function E8(e){switch(e.kind){case 0:return e.model.atomicRanges.gapRanges;case 1:return e.model.coarseHierarchy.spheres.gapRanges;case 2:return e.model.coarseHierarchy.gaussians.gapRanges}}var el;(function(e){function t(r){var n=r.group,a=r.structure,i=n.units[0].polymerElements,o=i.length,s=n.units.length,u=Ze.create(a),l=function(c,d){var f=n.units[d];return u.unit=f,u.element=i[c],u};return pn(o,s,1,l)}e.fromGroup=t})(el||(el={}));var e_;(function(e){function t(r){var n=r.group,a=r.structure,i=n.units[0].gapElements,o=i.length,s=n.units.length,u=Ze.create(a),l=function(c,d){var f=n.units[d];return u.unit=f,u.element=i[c],u};return pn(o,s,1,l)}e.fromGroup=t})(e_||(e_={}));function lf(e,t,r){var n=e.objectId,a=e.instanceId,i=e.groupId;if(r===n){var o=t.structure,s=t.group,u=s.units[a];if(ze.isAtomic(u))return qk(o,u,u.polymerElements[i]);var l=u.elements,c=u.polymerElements[i],d=ke.indexOf(l,c);if(d!==-1){var f=ke.ofSingleton(d);return Re(o,[{unit:u,indices:f}])}}return Or}function _M(e,t,r,n,a,i){for(var o=-1,s=-1,u=a;u<=i;u++){var l=r[u];if(!(l<0)&&(o=ke.indexOf(t,l),o>=0)){s=u;break}}if(o<0)return!1;for(var c=o,u=i;u>s;u--){var l=r[u];if(!(l<0)){var d=ke.indexOf(t,l);if(d>=0){c=d;break}}}return n(Ie.ofRange(e+o,e+c))}function I8(e,t,r,n,a){var i=!1,o=a.unit.elements,s=a.unit.model.atomicHierarchy.derived.residue.traceElementIndex,u=a.unit.model.atomicHierarchy.residueAtomSegments.index,l=r(a.unit);if(Ie.is(a.indices))if(Ie.start(a.indices)===0&&Ie.end(a.indices)===a.unit.elements.length)i=n(Ie.ofBounds(e,e+t))||i;else{var c=u[o[Ie.min(a.indices)]],d=u[o[Ie.max(a.indices)]];i=_M(e,l,s,n,c,d)||i}else for(var f=a.indices,p=0,h=f.length;p<h;p++){for(var c=u[o[f[p]]],d=c,v=p+1;v<h;){var m=u[o[f[v]]];if(m-d>1)break;d=m,v++}p=v-1,i=_M(e,l,s,n,c,d)||i}return i}function OAe(e){return e.polymerElements}function cf(e,t,r){var n=!1;if(!Re.is(e))return!1;var a=t.structure,i=t.group;if(!Xe.areEquivalent(e.structure,a))return!1;for(var o=i.units[0].polymerElements.length,s=0,u=e.elements;s<u.length;s++){var l=u[s];if(!!i.unitIndexMap.has(l.unit.id)){var c=i.unitIndexMap.get(l.unit.id)*o;if(ze.isAtomic(l.unit))n=I8(c,o,OAe,r,l)||n;else if(Ie.is(l.indices)){var d=c+Ie.start(l.indices),f=c+Ie.end(l.indices);n=r(Ie.ofBounds(d,f))||n}else for(var p=0,h=l.indices.length;p<h;p++){for(var d=l.indices[p],v=p+1;v<h&&l.indices[v]===d;)v++;p=v-1;var f=l.indices[p];n=r(Ie.ofRange(c+d,c+f))||n}}}return n}function FAe(e,t,r){var n=e.objectId,a=e.instanceId,i=e.groupId;if(r===n){var o=t.structure,s=t.group,u=s.units[a],l=ke.indexOf(u.elements,u.gapElements[i]),c=ke.indexOf(u.elements,u.gapElements[i%2?i-1:i+1]);if(l!==-1&&c!==-1)return Ht.Loci(o,[Ht.Location(o,u,l,o,u,c),Ht.Location(o,u,c,o,u,l)])}return Or}function kAe(e,t,r){var n=!1;if(Ht.isLoci(e)){var a=t.structure,i=t.group;if(!Xe.areRootsEquivalent(e.structure,a))return!1;e=Ht.remapLoci(e,a);for(var o=i.units[0].gapElements.length,s=0,u=e.bonds;s<u.length;s++){var l=u[s],c=i.unitIndexMap.get(l.aUnit.id);if(c!==void 0){var d=ke.indexOf(l.aUnit.gapElements,l.aUnit.elements[l.aIndex]),f=ke.indexOf(l.bUnit.gapElements,l.bUnit.elements[l.bIndex]);d!==-1&&f!==-1&&r(Ie.ofSingleton(c*o+d))&&(n=!0)}}}else if(Re.is(e)){var a=t.structure,i=t.group;if(!Xe.areRootsEquivalent(e.structure,a))return!1;e=Re.remap(e,a);for(var p=i.units[0].gapElements.length,h=function(x){var S=i.unitIndexMap.get(x.unit.id);S!==void 0&&ke.forEach(x.indices,function(_){var A=ke.indexOf(x.unit.gapElements,x.unit.elements[_]);A!==-1&&r(Ie.ofSingleton(S*p+A))&&(n=!0)})},v=0,m=e.elements;v<m.length;v++){var g=m[v];h(g)}}return n}var fy;(function(e){function t(r){var n=r.group,a=r.structure,i=n.units[0],o=ze.isAtomic(i)?i.nucleotideElements:[],s=o.length,u=n.units.length,l=Ze.create(a),c=function(d,f){var p=n.units[f];return l.unit=p,l.element=o[d],l};return pn(s,u,1,c)}e.fromGroup=t})(fy||(fy={}));function M8(e,t,r){var n=e.objectId,a=e.instanceId,i=e.groupId;if(r===n){var o=t.structure,s=t.group,u=s.units[a];if(ze.isAtomic(u))return qk(o,u,u.nucleotideElements[i])}return Or}function BAe(e){return e.nucleotideElements}function D8(e,t,r){var n=!1;if(!Re.is(e))return!1;var a=t.structure,i=t.group;if(!Xe.areEquivalent(e.structure,a))return!1;var o=i.units[0];if(!ze.isAtomic(o))return!1;for(var s=o.nucleotideElements,u=s.length,l=0,c=e.elements;l<c.length;l++){var d=c[l];if(!!ze.isAtomic(d.unit)&&!!i.unitIndexMap.has(d.unit.id)){var f=i.unitIndexMap.get(d.unit.id)*u;ze.isAtomic(d.unit)&&(n=I8(f,u,BAe,r,d)||n)}}return n}var hh=C.zero(),s0=C.zero(),wM=C.zero(),AM=C.zero(),PM=C.zero(),TM=C.zero(),u0=C.zero(),vS=C.zero(),mS=C.zero(),EM=C.zero(),vh=ue.identity(),LAe=C.zero(),IM=y3(),R8={sizeFactor:E.Numeric(.2,{min:0,max:10,step:.01}),radialSegments:E.Numeric(16,{min:2,max:56,step:2},At.CustomQualityParamInfo)};E.getDefaultValues(R8);function NAe(e,t,r,n,a,i){if(!ze.isAtomic(t))return Lt.createEmpty(i);var o=t.nucleotideElements.length;if(!o)return Lt.createEmpty(i);for(var s=a.sizeFactor,u=a.radialSegments,l=o*(IM.vertices.length/3+u*2),c=_t.createState(l,l/4,i),d=t.elements,f=t.model,p=f.atomicHierarchy,h=p.chainAtomSegments,v=p.residueAtomSegments,m=p.atoms,g=p.index,y=f.atomicHierarchy.derived.residue,b=y.moleculeType,x=y.traceElementIndex,S=m.label_comp_id,_=t.conformation.invariantPosition,A=nr.transientSegments(h,d),T=nr.transientSegments(v,d),I={radiusTop:1*s,radiusBottom:1*s,radialSegments:u,bottomCap:!0},M=0;A.hasNext;)for(T.setSegment(A.move());T.hasNext;){var O=T.move().index;if($s(b[O])){var D=S.value(v.offsets[O]),F=-1,G=-1,N=-1,z=-1,$=-1,j=-1,Z=4.5,q=4.5,te=2.5*s,he=g6(D),W=y6(D);if(!he&&!W){var K=g.findAtomOnResidue(O,"C4"),U=g.findAtomOnResidue(O,"N9");K!==-1&&U!==-1&&C.distance(_(K,hh),_(U,s0))<1.6?he=!0:W=!0}he?(q=4.5,F=g.findAtomOnResidue(O,"N1"),G=g.findAtomOnResidue(O,"C4"),N=g.findAtomOnResidue(O,"C6"),z=g.findAtomOnResidue(O,"C2"),$=g.findAtomOnResidue(O,"N9"),j=x[O]):W&&(q=3,F=g.findAtomOnResidue(O,"N3"),G=g.findAtomOnResidue(O,"C6"),N=g.findAtomOnResidue(O,"C4"),z=g.findAtomOnResidue(O,"C2"),$=g.findAtomOnResidue(O,"N1"),$===-1&&($=g.findAtomOnResidue(O,"C1")),j=x[O]),$!==-1&&j!==-1&&(_($,PM),_(j,TM),c.currentGroup=M,$a(c,PM,TM,1,I),F!==-1&&G!==-1&&N!==-1&&z!==-1&&(_(F,hh),_(G,s0),_(N,wM),_(z,AM),C.normalize(u0,C.sub(u0,s0,hh)),C.normalize(vS,C.sub(vS,AM,wM)),C.normalize(mS,C.cross(mS,u0,vS)),ue.targetTo(vh,hh,s0,mS),C.scaleAndAdd(EM,hh,u0,q/2-.2),ue.scale(vh,vh,C.set(LAe,Z,te,q)),ue.setTranslation(vh,EM),_t.addPrimitive(c,vh,IM))),++M}}var H=_t.getMesh(c),J=Ne.expand(Ne(),t.boundary.sphere,1*a.sizeFactor);return H.setBoundingSphere(J),H}var O8=w(w({},Va),R8);function UAe(e){return pi({defaultProps:E.getDefaultValues(O8),createGeometry:NAe,createLocationIterator:fy.fromGroup,getLoci:M8,eachLocation:D8,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.radialSegments!==n.radialSegments}},e)}var l0=C.zero(),kl=C.zero(),c0=C.zero(),d0=C.zero(),Yc=C.zero(),Lf=C.zero(),f0=C.zero(),MM=C.zero(),DM=C.zero(),mh=C.zero(),Bl=C.zero(),F8={sizeFactor:E.Numeric(.2,{min:0,max:10,step:.01}),radialSegments:E.Numeric(16,{min:2,max:56,step:2},At.CustomQualityParamInfo),detail:E.Numeric(0,{min:0,max:3,step:1},At.CustomQualityParamInfo)};E.getDefaultValues(F8);var p0=new Float32Array(2*9*3),zAe=new Uint32Array([0,1,2,3,4,5,6,7,16,17,14,15,12,13,8,9,10,11,0,1]),VAe=new Uint32Array([8,12,14,16,6,4,2,0,10]),HAe=new Uint32Array([9,11,1,3,5,7,17,15,13]),h0=new Float32Array(2*6*3),GAe=new Uint32Array([0,1,2,3,4,5,6,7,8,9,10,11,0,1]),qAe=new Uint32Array([0,10,8,6,4,2]),jAe=new Uint32Array([1,3,5,7,9,11]),RM=C.zero();function OM(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];for(var a=0,i=r.length;a<i;++a){var o=r[a];C.toArray(C.add(RM,o,t),e,a*2*3),C.toArray(C.sub(RM,o,t),e,(a*2+1)*3)}}function WAe(e,t,r,n,a,i){if(!ze.isAtomic(t))return Lt.createEmpty(i);var o=t.nucleotideElements.length;if(!o)return Lt.createEmpty(i);for(var s=a.sizeFactor,u=a.radialSegments,l=a.detail,c=o*(26+u*2),d=_t.createState(c,c/4,i),f=t.elements,p=t.model,h=p.atomicHierarchy,v=h.chainAtomSegments,m=h.residueAtomSegments,g=h.atoms,y=h.index,b=p.atomicHierarchy.derived.residue,x=b.moleculeType,S=b.traceElementIndex,_=g.label_comp_id,A=t.conformation.invariantPosition,T=nr.transientSegments(v,f),I=nr.transientSegments(m,f),M=1*s,O=1.25*s,D={radiusTop:1*s,radiusBottom:1*s,radialSegments:u},F=0;T.hasNext;)for(I.setSegment(T.move());I.hasNext;){var G=I.move().index;if($s(x[G])){var N=_.value(m.offsets[G]),z=-1,$=-1,j=-1,Z=-1,q=-1,te=-1,he=-1,W=-1,K=-1,U=-1;d.currentGroup=F;var H=g6(N),J=y6(N);if(!H&&!J){var X=y.findAtomOnResidue(G,"C4"),Q=y.findAtomOnResidue(G,"N9");X!==-1&&Q!==-1&&C.distance(A(X,Yc),A(Q,mh))<1.6?H=!0:J=!0}H?(z=S[G],$=y.findAtomOnResidue(G,"N1"),j=y.findAtomOnResidue(G,"C2"),Z=y.findAtomOnResidue(G,"N3"),q=y.findAtomOnResidue(G,"C4"),te=y.findAtomOnResidue(G,"C5"),te===-1&&(te=y.findAtomOnResidue(G,"N5")),he=y.findAtomOnResidue(G,"C6"),W=y.findAtomOnResidue(G,"N7"),W===-1&&(W=y.findAtomOnResidue(G,"C7")),K=y.findAtomOnResidue(G,"C8"),U=y.findAtomOnResidue(G,"N9"),U!==-1&&z!==-1&&(A(U,mh),A(z,l0),d.currentGroup=F,$a(d,mh,l0,1,D),la(d,mh,M,l)),$!==-1&&j!==-1&&Z!==-1&&q!==-1&&te!==-1&&he!==-1&&W!==-1&&K!==-1&&U!==-1&&(A($,kl),A(j,c0),A(Z,d0),A(q,Yc),A(te,Lf),A(he,f0),A(W,MM),A(K,DM),C.triangleNormal(Bl,kl,Yc,Lf),C.scale(Bl,Bl,O),OM(p0,Bl,kl,c0,d0,Yc,Lf,f0,MM,DM,mh),_t.addTriangleStrip(d,p0,zAe),_t.addTriangleFan(d,p0,VAe),_t.addTriangleFan(d,p0,HAe))):J&&(z=S[G],$=y.findAtomOnResidue(G,"N1"),$===-1&&($=y.findAtomOnResidue(G,"C1")),j=y.findAtomOnResidue(G,"C2"),Z=y.findAtomOnResidue(G,"N3"),q=y.findAtomOnResidue(G,"C4"),te=y.findAtomOnResidue(G,"C5"),he=y.findAtomOnResidue(G,"C6"),$!==-1&&z!==-1&&(A($,kl),A(z,l0),d.currentGroup=F,$a(d,kl,l0,1,D),la(d,kl,M,l)),$!==-1&&j!==-1&&Z!==-1&&q!==-1&&te!==-1&&he!==-1&&(A(j,c0),A(Z,d0),A(q,Yc),A(te,Lf),A(he,f0),C.triangleNormal(Bl,kl,Yc,Lf),C.scale(Bl,Bl,O),OM(h0,Bl,kl,c0,d0,Yc,Lf,f0),_t.addTriangleStrip(d,h0,GAe),_t.addTriangleFan(d,h0,qAe),_t.addTriangleFan(d,h0,jAe))),++F}}var ee=_t.getMesh(d),le=Ne.expand(Ne(),t.boundary.sphere,1*a.sizeFactor);return ee.setBoundingSphere(le),ee}var k8=w(w({},Va),F8);function XAe(e){return pi({defaultProps:E.getDefaultValues(k8),createGeometry:WAe,createLocationIterator:fy.fromGroup,getLoci:M8,eachLocation:D8,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.radialSegments!==n.radialSegments}},e)}var Kc=C.zero(),Nf=C.zero(),$c=C.zero(),FM=C.zero(),ea=Qs(3,!1);function YAe(){for(var e=Op(8),t=0;t<3;++t){var r=(t+1)%3;C.set(Kc,ea[t*3],ea[t*3+1],-.5),C.set(Nf,ea[r*3],ea[r*3+1],-.5),C.set($c,ea[r*3],ea[r*3+1],.5),C.set(FM,ea[t*3],ea[t*3+1],.5),e.add(Kc,Nf,$c),e.add($c,FM,Kc)}return C.set(Kc,ea[0],ea[1],-.5),C.set(Nf,ea[3],ea[4],-.5),C.set($c,ea[6],ea[7],-.5),e.add($c,Nf,Kc),C.set(Kc,ea[0],ea[1],.5),C.set(Nf,ea[3],ea[4],.5),C.set($c,ea[6],ea[7],.5),e.add(Kc,Nf,$c),e.getPrimitive()}var gS;function KAe(){return gS||(gS=YAe()),gS}var Qc=ue.identity(),$Ae=C.zero(),kM=C.zero(),BM=C.zero(),yS=C.zero(),QAe=4,ZAe=4,JAe=6,e4e=KAe(),B8={sizeFactor:E.Numeric(.2,{min:0,max:10,step:.01})};E.getDefaultValues(B8);function t4e(e,t,r,n,a,i){var o=t.polymerElements.length;if(!o)return Lt.createEmpty(i);for(var s=a.sizeFactor,u=o*24,l=_t.createState(u,u/10,i),c=1,d=Mw(c),f=d.normalVectors,p=d.binormalVectors,h=0,v=Iw(t,r);v.hasNext;){var m=v.move();l.currentGroup=h;var g=$s(m.moleculeType),y=Fr.is(m.secStrucType,4),b=g||y?.5:.9,x=g?.3:.5;if(Dw(d,m,b,x),y&&!m.secStrucLast||!y){var S=n.size.size(m.center)*s,_=QAe*S,A=ZAe*S,T=JAe*S,I=g?p:f;C.fromArray(kM,I,0),C.fromArray(BM,I,3),C.normalize(yS,C.add(yS,kM,BM)),ue.targetTo(Qc,m.p3,m.p1,yS),ue.mul(Qc,Qc,ue.rotY90Z180),ue.scale(Qc,Qc,C.set($Ae,T,A,_)),ue.setTranslation(Qc,m.p2),_t.addPrimitive(l,Qc,e4e)}++h}var M=_t.getMesh(l),O=Ne.expand(Ne(),t.boundary.sphere,1*a.sizeFactor);return M.setBoundingSphere(O),M}var L8=w(w({},Va),B8);function r4e(e){return pi({defaultProps:E.getDefaultValues(L8),createGeometry:t4e,createLocationIterator:el.fromGroup,getLoci:lf,eachLocation:cf,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor}},e)}var bS=10,N8={sizeFactor:E.Numeric(.2,{min:0,max:10,step:.01}),radialSegments:E.Numeric(16,{min:2,max:56,step:2},At.CustomQualityParamInfo)};E.getDefaultValues(N8);function n4e(e,t,r,n,a,i){var o=t.gapElements.length;if(!o)return Lt.createEmpty(i);for(var s=a.sizeFactor,u=a.radialSegments,l=bS*u*2*o*2,c=_t.createState(l,l/10,i),d=t.conformation.invariantPosition,f=C.zero(),p=C.zero(),h={radiusTop:1,radiusBottom:1,topCap:!0,bottomCap:!0,radialSegments:u},v=0,m=yAe(r,t);m.hasNext;){var g=m.move(),y=g.centerA,b=g.centerB;y.element===b.element||(d(y.element,f),d(b.element,p),h.radiusTop=h.radiusBottom=n.size.size(y)*s,c.currentGroup=v,Xh(c,f,p,.5,bS,h),h.radiusTop=h.radiusBottom=n.size.size(b)*s,c.currentGroup=v+1,Xh(c,p,f,.5,bS,h)),v+=2}var x=_t.getMesh(c),S=Ne.expand(Ne(),t.boundary.sphere,1*a.sizeFactor);return x.setBoundingSphere(S),x}var F1=w(w({},Va),N8);function Rw(e){return pi({defaultProps:E.getDefaultValues(F1),createGeometry:n4e,createLocationIterator:e_.fromGroup,getLoci:FAe,eachLocation:kAe,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.radialSegments!==n.radialSegments}},e)}var Er=C(),Gr=C(),a4e=C(),Vi=C(),Ms=C(),v0=C(),m0=C(),gh=C(),Xo=C(),vd=C(),SS=C(),Ll=C(),Nl=C(),Ul=C(),zl=C(),mo=C.fromArray,ip=C.scale,yo=C.add,_u=C.sub,i4e=C.magnitude,LM=C.negate,t_=C.copy,U8=C.cross,o4e=C.set,sn=je.add3,s4e=je.add;function g0(e,t,r,n,a,i,o,s){var u=t.vertices,l=t.normals,c=t.indices,d=u.elementCount;mo(Er,n,e),ip(m0,Er,o),ip(v0,Er,s),mo(Gr,a,e),ip(Vi,Gr,i),U8(vd,Gr,Er),mo(Xo,r,e),yo(Ll,yo(Ll,Xo,Vi),v0),_u(Nl,yo(Nl,Xo,Vi),m0),_u(Ul,_u(Ul,Xo,Vi),m0),yo(zl,_u(zl,Xo,Vi),v0),o<s?(sn(u,zl[0],zl[1],zl[2]),sn(u,Ul[0],Ul[1],Ul[2]),sn(u,Nl[0],Nl[1],Nl[2]),sn(u,Ll[0],Ll[1],Ll[2]),t_(Ms,v0)):(sn(u,Ll[0],Ll[1],Ll[2]),sn(u,Nl[0],Nl[1],Nl[2]),sn(u,Ul[0],Ul[1],Ul[2]),sn(u,zl[0],zl[1],zl[2]),t_(Ms,m0));for(var f=0;f<4;++f)sn(l,vd[0],vd[1],vd[2]);sn(c,d+2,d+1,d),sn(c,d,d+3,d+2)}function r_(e,t,r,n,a,i,o,s,u,l){var c=e.currentGroup,d=e.vertices,f=e.normals,p=e.indices,h=e.groups,v=d.elementCount,m=0;s>0?(mo(Er,t,0),mo(Gr,t,a*3),m=s/i4e(_u(a4e,Gr,Er))):o4e(gh,0,0,0);for(var g=0;g<=a;++g){var y=i[g],b=o[g],x=s===0?b:s*(1-g/a),S=g*3;mo(Ms,r,S),ip(Ms,Ms,x),mo(Vi,n,S),ip(Vi,Vi,y),s>0&&(mo(Er,r,S),mo(Gr,n,S),ip(gh,U8(gh,Er,Gr),m)),mo(Xo,t,S),mo(vd,r,S),mo(SS,n,S),yo(Er,yo(Er,Xo,Vi),Ms),yo(Gr,vd,gh),sn(d,Er[0],Er[1],Er[2]),sn(f,Gr[0],Gr[1],Gr[2]),yo(Er,_u(Er,Xo,Vi),Ms),sn(d,Er[0],Er[1],Er[2]),sn(f,Gr[0],Gr[1],Gr[2]),LM(Gr,SS),sn(d,Er[0],Er[1],Er[2]),sn(f,Gr[0],Gr[1],Gr[2]),_u(Er,_u(Er,Xo,Vi),Ms),sn(d,Er[0],Er[1],Er[2]),sn(f,Gr[0],Gr[1],Gr[2]),yo(Gr,LM(Gr,vd),gh),sn(d,Er[0],Er[1],Er[2]),sn(f,Gr[0],Gr[1],Gr[2]),_u(Er,yo(Er,Xo,Vi),Ms),sn(d,Er[0],Er[1],Er[2]),sn(f,Gr[0],Gr[1],Gr[2]),t_(Gr,SS),sn(d,Er[0],Er[1],Er[2]),sn(f,Gr[0],Gr[1],Gr[2]),yo(Er,yo(Er,Xo,Vi),Ms),sn(d,Er[0],Er[1],Er[2]),sn(f,Gr[0],Gr[1],Gr[2])}for(var g=0;g<a;++g){for(var _=0;_<2;_++)sn(p,v+g*8+2*_,v+(g+1)*8+2*_+1,v+g*8+2*_+1),sn(p,v+g*8+2*_,v+(g+1)*8+2*_,v+(g+1)*8+2*_+1);for(var _=2;_<4;_++)sn(p,v+g*8+2*_,v+(g+1)*8+2*_,v+g*8+2*_+1),sn(p,v+(g+1)*8+2*_,v+(g+1)*8+2*_+1,v+g*8+2*_+1)}if(u){var y=i[0],b=o[0],A=s===0?b:s;g0(0,e,t,r,n,y,A,A)}else if(s>0){var y=i[0],b=o[0];g0(0,e,t,r,n,y,s,-b),g0(0,e,t,r,n,y,-s,b)}if(l&&s===0){var y=i[a],b=o[a];g0(a*3,e,t,r,n,y,-b,-b)}for(var T=(a+1)*8+(u?4:s>0?8:0)+(l&&s===0?4:0),g=0,I=T;g<I;++g)s4e(h,c)}var En=C(),co=C(),fo=C(),pu=C(),Ts=C();function u4e(e,t,r,n,a){e[0]=t[0]*n+r[0]*a,e[1]=t[1]*n+r[1]*a,e[2]=t[2]*n+r[2]*a}function xS(e,t,r,n,a,i){e[0]=t[0]*a+r[0]*i+n[0],e[1]=t[1]*a+r[1]*i+n[1],e[2]=t[2]*a+r[2]*i+n[2]}var hu=C.fromArray,NM=C.normalize,l4e=C.negate,c4e=C.copy,UM=C.cross,bi=je.add3,CS=new Map;function d4e(e){if(!CS.has(e)){for(var t=[],r=[],n=0;n<e;++n){var a=2*Math.PI*n/e;t[n]=Math.cos(a),r[n]=Math.sin(a)}CS.set(e,{cos:t,sin:r})}return CS.get(e)}function z8(e,t,r,n,a,i,o,s,u,l){for(var c=e.currentGroup,d=e.vertices,f=e.normals,p=e.indices,h=e.groups,v=d.elementCount,m=d4e(i),g=m.cos,y=m.sin,b=0;b<=a;++b){var x=b*3;hu(pu,r,x),hu(Ts,n,x),hu(fo,t,x);for(var S=o[b],_=s[b],A=0;A<i;++A)xS(co,pu,Ts,fo,_*g[A],S*y[A]),i===2?(c4e(En,Ts),NM(En,En),(A!==0||b%2===0)&&l4e(En,En)):u4e(En,pu,Ts,S*g[A],_*y[A]),NM(En,En),bi(d,co[0],co[1],co[2]),bi(f,En[0],En[1],En[2])}for(var b=0;b<a;++b)for(var A=0;A<i;++A)bi(p,v+b*i+(A+1)%i,v+(b+1)*i+(A+1)%i,v+b*i+A),bi(p,v+(b+1)*i+(A+1)%i,v+(b+1)*i+A,v+b*i+A);if(u){var T=0,I=d.elementCount;hu(pu,r,T),hu(Ts,n,T),hu(fo,t,T),UM(En,Ts,pu),bi(d,fo[0],fo[1],fo[2]),bi(f,En[0],En[1],En[2]);var S=o[0],_=s[0];v=d.elementCount;for(var b=0;b<i;++b)xS(co,pu,Ts,fo,_*g[b],S*y[b]),bi(d,co[0],co[1],co[2]),bi(f,En[0],En[1],En[2]),bi(p,v+(b+1)%i,v+b,I)}if(l){var T=a*3,I=d.elementCount;hu(pu,r,T),hu(Ts,n,T),hu(fo,t,T),UM(En,pu,Ts),bi(d,fo[0],fo[1],fo[2]),bi(f,En[0],En[1],En[2]);var S=o[a],_=s[a];v=d.elementCount;for(var b=0;b<i;++b)xS(co,pu,Ts,fo,_*g[b],S*y[b]),bi(d,co[0],co[1],co[2]),bi(f,En[0],En[1],En[2]),bi(p,v+b,v+(b+1)%i,I)}var M=(a+1)*i+(u?i+1:0)+(l?i+1:0);je.addRepeat(h,M,c)}var vu=C.fromArray,f4e=C.magnitude,_S=C.sub,zM=C.add,wS=C.scale,p4e=C.negate,h4e=C.copy,v4e=C.cross,po=je.add3,m4e=je.add,ta=C(),Pa=C(),g4e=C(),AS=C(),Zc=C(),VM=C(),yh=C(),y4e=C(),PS=C();function N0(e,t,r,n,a,i,o,s){var u=e.currentGroup,l=e.vertices,c=e.normals,d=e.indices,f=e.groups,p=l.elementCount,h=0;s>0&&(vu(ta,t,0),vu(Pa,t,a*3),h=s/f4e(_S(g4e,Pa,ta)));for(var v=0;v<=a;++v){var m=i[v],g=o[v],y=s===0?g:s*(1-v/a),b=v*3;vu(Zc,r,b),wS(Zc,Zc,y),vu(AS,n,b),wS(AS,AS,m),s>0&&(vu(ta,r,b),vu(Pa,n,b),wS(VM,v4e(VM,ta,Pa),h)),vu(yh,t,b),vu(y4e,r,b),vu(PS,n,b),zM(ta,yh,Zc),p4e(Pa,PS),po(l,ta[0],ta[1],ta[2]),po(c,Pa[0],Pa[1],Pa[2]),_S(ta,yh,Zc),po(l,ta[0],ta[1],ta[2]),po(c,Pa[0],Pa[1],Pa[2]),zM(ta,yh,Zc),h4e(Pa,PS),po(l,ta[0],ta[1],ta[2]),po(c,Pa[0],Pa[1],Pa[2]),_S(ta,yh,Zc),po(l,ta[0],ta[1],ta[2]),po(c,Pa[0],Pa[1],Pa[2])}for(var v=0;v<a;++v)po(d,p+v*4,p+(v+1)*4+1,p+v*4+1),po(d,p+v*4,p+(v+1)*4,p+(v+1)*4+1),po(d,p+v*4+2+1,p+(v+1)*4+2+1,p+v*4+2),po(d,p+v*4+2,p+(v+1)*4+2+1,p+(v+1)*4+2);for(var x=(a+1)*4,v=0,S=x;v<S;++v)m4e(f,u)}var V8={sizeFactor:E.Numeric(.2,{min:0,max:10,step:.01}),aspectRatio:E.Numeric(5,{min:.1,max:10,step:.1}),arrowFactor:E.Numeric(1.5,{min:0,max:3,step:.1}),tubularHelices:E.Boolean(!1),detail:E.Numeric(0,{min:0,max:3,step:1},At.CustomQualityParamInfo),linearSegments:E.Numeric(8,{min:1,max:48,step:1},At.CustomQualityParamInfo),radialSegments:E.Numeric(16,{min:2,max:56,step:2},At.CustomQualityParamInfo)};E.getDefaultValues(V8);var Si=C();function b4e(e,t,r,n,a,i){var o,s,u,l=t.polymerElements.length;if(!l)return Lt.createEmpty(i);for(var c=a.sizeFactor,d=a.detail,f=a.linearSegments,p=a.radialSegments,h=a.aspectRatio,v=a.arrowFactor,m=a.tubularHelices,g=f*p*l+(p+1)*l*2,y=_t.createState(g,g/10,i),b=ze.isCoarse(t),x=Mw(f),S=x.curvePoints,_=x.normalVectors,A=x.binormalVectors,T=x.widthValues,I=x.heightValues,M=0,O=Iw(t,r,{ignoreSecondaryStructure:!1,useHelixOrientation:m});O.hasNext;){var D=O.move();y.currentGroup=M;var F=$s(D.moleculeType),G=Fr.is(D.secStrucType,4),N=Fr.is(D.secStrucType,2),z=N&&!m?RAe:T8,$=F?O1:R1;Dw(x,D,z,$);var j=n.size.size(D.centerPrev)*c,Z=n.size.size(D.center)*c,q=n.size.size(D.centerNext)*c;b&&(j*=h/2,Z*=h/2,q*=h/2);var te=D.secStrucFirst||D.coarseBackboneFirst||D.first,he=D.secStrucLast||D.coarseBackboneLast||D.last,W=f;if(D.initial){W=Math.max(Math.round(f*$),1);var K=f-W;S.copyWithin(0,K*3),A.copyWithin(0,K*3),_.copyWithin(0,K*3),C.fromArray(Si,S,3),C.normalize(Si,C.sub(Si,D.p2,Si)),C.scaleAndAdd(Si,D.p2,Si,Z*dy),C.toArray(Si,S,0)}else D.final&&(W=Math.max(Math.round(f*(1-$)),1),C.fromArray(Si,S,W*3-3),C.normalize(Si,C.sub(Si,D.p2,Si)),C.scaleAndAdd(Si,D.p2,Si,Z*dy),C.toArray(Si,S,W*3));if(D.initial===!0&&D.final===!0)la(y,D.p2,Z*2,d);else if(G){var U=j*h,H=Z*h,J=q*h,X=D.secStrucLast?H*v:0;JC(x,j,Z,q,U,H,J,$),p===2?N0(y,S,_,A,W,T,I,X):r_(y,S,_,A,W,T,I,X,te,he)}else{var U=void 0,H=void 0,J=void 0;if(N&&!D.isCoarseBackbone?m?(j*=h*1.5,Z*=h*1.5,q*=h*1.5,U=j,H=Z,J=q):(U=j*h,H=Z*h,J=q*h):F&&!D.isCoarseBackbone?(U=j*h,H=Z*h,J=q*h,o=[U,j],j=o[0],U=o[1],s=[H,Z],Z=s[0],H=s[1],u=[J,q],q=u[0],J=u[1]):(U=j,H=Z,J=q),JC(x,j,Z,q,U,H,J,$),p===2)if(F&&!D.isCoarseBackbone){for(var Q=0,ee=A.length;Q<ee;Q++)A[Q]*=-1;N0(y,S,A,_,W,I,T,0)}else N0(y,S,_,A,W,T,I,0);else p===4?r_(y,S,_,A,W,T,I,0,te,he):z8(y,S,_,A,W,p,T,I,te,he)}++M}var le=_t.getMesh(y),ye=Ne.expand(Ne(),t.boundary.sphere,1*a.sizeFactor);return le.setBoundingSphere(ye),le}var H8=w(w({},Va),V8);function S4e(e){return pi({defaultProps:E.getDefaultValues(H8),createGeometry:b4e,createLocationIterator:el.fromGroup,getLoci:lf,eachLocation:cf,setUpdateState:function(t,r,n,a,i,o,s){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.tubularHelices!==n.tubularHelices||r.detail!==n.detail||r.linearSegments!==n.linearSegments||r.radialSegments!==n.radialSegments||r.aspectRatio!==n.aspectRatio||r.arrowFactor!==n.arrowFactor;var u=Xs.get(o.structure).version;t.info.secondaryStructureHash!==u&&(t.createGeometry=!0,t.info.secondaryStructureHash=u)}},e)}var G8={"polymer-trace":function(e,t){return Un("Polymer trace mesh",e,t,S4e)},"polymer-gap":function(e,t){return Un("Polymer gap cylinder",e,t,Rw)},"nucleotide-block":function(e,t){return Un("Nucleotide block mesh",e,t,UAe)},"nucleotide-ring":function(e,t){return Un("Nucleotide ring mesh",e,t,XAe)},"direction-wedge":function(e,t){return Un("Polymer direction wedge",e,t,r4e)}},q8=w(w(w(w(w(w({},H8),F1),O8),k8),L8),{sizeFactor:E.Numeric(.2,{min:0,max:10,step:.01}),visuals:E.MultiSelect(["polymer-trace","polymer-gap","nucleotide-block"],E.objectToOptions(G8))});function x4e(e,t){var r=E.clone(q8),n=!1,a=!1;return t.units.forEach(function(i){!n&&ze.isAtomic(i)&&i.nucleotideElements.length&&(n=!0),!a&&i.gapElements.length&&(a=!0)}),r.visuals.defaultValue=["polymer-trace"],n&&r.visuals.defaultValue.push("nucleotide-block"),a&&r.visuals.defaultValue.push("polymer-gap"),r}function C4e(e,t){return or.createMulti("Cartoon",e,t,da,G8)}var _4e={name:"cartoon",label:"Cartoon",description:"Displays ribbons, planks, tubes smoothly following the trace atoms of polymers.",factory:C4e,getParams:x4e,defaultValues:E.getDefaultValues(q8),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.polymerResidueCount>0},ensureCustomProperties:{attach:function(e,t){return ce(void 0,void 0,void 0,function(){var r,n,a;return de(this,function(i){switch(i.label){case 0:return[4,Xs.attach(e,t,void 0,!0)];case 1:i.sent(),r=0,n=t.models,i.label=2;case 2:return r<n.length?(a=n[r],[4,QC.attach(e,a,void 0,!0)]):[3,5];case 3:i.sent(),i.label=4;case 4:return r++,[3,2];case 5:return[2]}})})},detach:function(e){Xs.ref(e,!1);for(var t=0,r=e.models;t<r.length;t++){var n=r[t];QC.ref(n,!1)}}}},j8=w(w({},Va),{sizeFactor:E.Numeric(1,{min:0,max:10,step:.1}),detail:E.Numeric(0,{min:0,max:3,step:1},At.CustomQualityParamInfo),ignoreHydrogens:E.Boolean(!1)});function w4e(e){return pi({defaultProps:E.getDefaultValues(j8),createGeometry:A4e,createLocationIterator:ei.fromGroup,getLoci:Js,eachLocation:Zs,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail||r.ignoreHydrogens!==n.ignoreHydrogens}},e)}function A4e(e,t,r,n,a,i){var o=r.child,s=o==null?void 0:o.unitMap.get(t.id);if(o&&!s)return Lt.createEmpty(i);var u=a.detail,l=a.sizeFactor,c=a.ignoreHydrogens,d=t.elements,f=t.model,p=t.model.atomicHierarchy.derived.atom.atomicNumber,h=d.length,v=h*e1(u),m=_t.createState(v,v/2,i),g=js.Provider.get(f);if(!g)return Lt.createEmpty(i);var y=C(),b=Mn(),x=C(),S=C(),_=C(),A=g.elementToAnsiotrop,T=g.data,I=T.U,M=T._schema.U.space,O=t.conformation.invariantPosition,D=Ze.create(r);D.unit=t;for(var F=0;F<h;F++){var G=d[F],N=A[G];if(N!==-1&&!(!!s&&!Je.has(s.elements,G)||c&&Lg(p,G))){D.element=G,O(G,y),m.currentGroup=F,Pr.toMat3(b,M,I.value(N)),Mn.symmtricFromLower(b,b),Mn.symmetricEigenvalues(x,b),Mn.eigenvector(S,b,x[1]),Mn.eigenvector(_,b,x[2]);for(var z=0;z<3;++z)x[z]=l*1.5958*Math.sqrt(Math.abs(x[z]));cn(x[0],x[1],fn)&&cn(x[1],x[2],fn)?la(m,y,x[0],u):M3(m,y,_,S,x,u)}}var $=_t.getMesh(m),j=Ne.expand(Ne(),(s||t).boundary.sphere,1*l);return $.setBoundingSphere(j),$}var W8={"ellipsoid-mesh":function(e,t){return Un("Ellipsoid Mesh",e,t,w4e)},"intra-bond":function(e,t){return Un("Intra-unit bond cylinder",e,t,c8)},"inter-bond":function(e,t){return as("Inter-unit bond cylinder",e,t,f8)}},X8=w(w(w(w({},j8),T1),E1),{includeParent:E.Boolean(!1),adjustCylinderLength:E.Boolean(!1,{isHidden:!0}),unitKinds:Nv(["atomic"]),sizeFactor:E.Numeric(1,{min:.01,max:10,step:.01}),sizeAspectRatio:E.Numeric(.1,{min:.01,max:3,step:.01}),linkCap:E.Boolean(!0),visuals:E.MultiSelect(["ellipsoid-mesh","intra-bond","inter-bond"],E.objectToOptions(W8))});function P4e(e,t){return E.clone(X8)}function T4e(e,t){return or.createMulti("Ellipsoid",e,t,da,W8)}var E4e={name:"ellipsoid",label:"Ellipsoid",description:"Displays anisotropic displacement ellipsoids of atomic elements plus bonds as cylinders.",factory:T4e,getParams:P4e,defaultValues:E.getDefaultValues(X8),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.elementCount>0&&e.models.some(function(t){return js.Provider.isApplicable(t)})},getData:function(e,t){return t.includeParent?e.asParent():e},mustRecreate:function(e,t){return e.includeParent!==t.includeParent}},I4e=`
precision highp float;

attribute vec3 aPosition;
attribute float aRadius;

varying vec3 vPosition;
varying float vRadiusSqInv;

#if defined(dCalcType_groupId)
    attribute float aGroup;
    varying float vGroup;
#endif

uniform vec3 uBboxSize;
uniform vec3 uBboxMin;
uniform float uResolution;

void main() {
    vRadiusSqInv = 1.0 / (aRadius * aRadius);
    #if defined(dCalcType_groupId)
        vGroup = aGroup;
    #endif
    gl_PointSize = ceil(((aRadius * 3.0) / uResolution) + uResolution);
    vPosition = (aPosition - uBboxMin) / uResolution;
    gl_Position = vec4(((aPosition - uBboxMin) / uBboxSize) * 2.0 - 1.0, 1.0);
}
`,M4e=`
precision highp float;

varying vec3 vPosition;
varying float vRadiusSqInv;
#if defined(dCalcType_groupId)
    #if defined(dGridTexType_2d)
        precision highp sampler2D;
        uniform sampler2D tMinDistanceTex;
        uniform vec3 uGridTexDim;
    #elif defined(dGridTexType_3d)
        precision highp sampler3D;
        uniform sampler3D tMinDistanceTex;
    #endif
    varying float vGroup;
#endif

#include common

uniform vec3 uGridDim;
uniform vec2 uGridTexScale;
uniform float uCurrentSlice;
uniform float uCurrentX;
uniform float uCurrentY;
uniform float uAlpha;
uniform float uResolution;
uniform float uRadiusFactorInv;

void main() {
    vec2 v = gl_FragCoord.xy - vec2(uCurrentX, uCurrentY) - 0.5;
    vec3 fragPos = vec3(v.x, v.y, uCurrentSlice);
    float dist = distance(fragPos, vPosition) * uResolution;

    #if defined(dCalcType_density)
        float density = exp(-uAlpha * ((dist * dist) * vRadiusSqInv));
        gl_FragColor.a = density * uRadiusFactorInv;
    #elif defined(dCalcType_minDistance)
        gl_FragColor.a = 1.0 - dist * uRadiusFactorInv;
    #elif defined(dCalcType_groupId)
        #if defined(dGridTexType_2d)
            float minDistance = 1.0 - texture2D(tMinDistanceTex, (gl_FragCoord.xy) / (uGridTexDim.xy / uGridTexScale)).a;
        #elif defined(dGridTexType_3d)
            float minDistance = 1.0 - texelFetch(tMinDistanceTex, ivec3(gl_FragCoord.xy, uCurrentSlice), 0).a;
        #endif
        if (dist * uRadiusFactorInv > minDistance + uResolution * 0.05)
            discard;
        gl_FragColor.rgb = encodeFloatRGB(vGroup);
    #endif
}
`,D4e={drawCount:Zn("number"),instanceCount:Zn("number"),aRadius:Vr("float32",1,0),aPosition:Vr("float32",3,0),aGroup:Vr("float32",1,0),uCurrentSlice:qe("f"),uCurrentX:qe("f"),uCurrentY:qe("f"),uBboxMin:qe("v3","material"),uBboxSize:qe("v3","material"),uGridDim:qe("v3","material"),uGridTexDim:qe("v3","material"),uGridTexScale:qe("v2","material"),uAlpha:qe("f","material"),uResolution:qe("f","material"),uRadiusFactorInv:qe("f","material"),tMinDistanceTex:ur("texture","rgba","float","nearest"),dGridTexType:$t("string",["2d","3d"]),dCalcType:$t("string",["density","minDistance","groupId"])},Ls="gaussian-density";function Y8(e){return e.namedFramebuffers[Ls]||(e.namedFramebuffers[Ls]=e.resources.framebuffer()),e.namedFramebuffers[Ls]}function K8(e,t,r,n,a,i){var o=Ls+"-"+e;return t.namedTextures[o]||(t.namedTextures[o]=t.resources.texture(r,n,a,i)),t.namedTextures[o]}function $8(e,t,r,n,a,i){return e.isWebGL2?R4e(e,t,r,n,a,i):Ow(e,t,r,n,!1,a,i)}function Ow(e,t,r,n,a,i,o){return Q8(F4e(e,t,r,n,a,i,o))}function R4e(e,t,r,n,a,i){return Q8(k4e(e,t,r,n,a,i))}function Q8(e){var t=e.texture,r=e.scale,n=e.bbox,a=e.gridDim,i=e.gridTexDim,o=e.gridTexScale,s=e.radiusFactor,u=e.resolution;return{transform:O4e(r,n),texture:t,bbox:n,gridDim:a,gridTexDim:i,gridTexScale:o,radiusFactor:s,resolution:u}}function O4e(e,t){var r=ue.identity();return ue.fromScaling(r,e),ue.setTranslation(r,t.min),r}function F4e(e,t,r,n,a,i,o){var s=e.gl,u=e.resources,l=e.state,c=e.extensions,d=c.colorBufferFloat,f=c.textureFloat,p=c.colorBufferHalfFloat,h=c.textureHalfFloat,v=c.blendMinMax,m=i.smoothness,g=i.resolution,y=Z8(t,r,n,i),b=y.drawCount,x=y.positions,S=y.radii,_=y.groups,A=y.scale,T=y.expandedBox,I=y.dim,M=y.maxRadius,O=I[0],D=I[1],F=I[2],G=L4e(I),N=G.texDimX,z=G.texDimY,$=G.texCols,j=G.powerOfTwoSize,Z=C.create(N,z,0),q=Ge.create(N/j,z/j),te=M*2,he=a?j:N,W=a?j:z,K=K8("min-dist-2d",e,"image-uint8","rgba","ubyte","nearest");K.define(he,W);var U=J8(e,b,x,S,_,K,T,I,Z,q,m,g,te),H=U.values,J=H.uCurrentSlice,X=H.uCurrentX,Q=H.uCurrentY,ee=Y8(e);ee.bind(),eN(e),o||(o=p&&h?u.texture("image-float16","rgba","fp16","linear"):d&&f?u.texture("image-float32","rgba","float","linear"):u.texture("image-uint8","rgba","ubyte","linear")),o.define(he,W);function le(ye,be){l.currentRenderItemId=-1,ye.attachFramebuffer(ee,0),be&&(s.viewport(0,0,he,W),s.scissor(0,0,he,W),s.clear(s.COLOR_BUFFER_BIT)),k.update(Q,0);for(var Ae=0,xe=0,ae=0,oe=0;oe<F;++oe)Ae>=$&&(Ae-=$,xe+=D,ae=0,k.update(Q,xe)),k.update(X,ae),k.update(J,oe),s.viewport(ae,xe,O,D),s.scissor(ae,xe,O,D),U.render(),++Ae,ae+=O;s.flush()}return rN(e,U),le(o,!0),v&&(tN(e,U),le(K,!0),nN(e,U),le(o,!1)),{texture:o,scale:A,bbox:T,gridDim:I,gridTexDim:Z,gridTexScale:q,radiusFactor:te,resolution:g}}function k4e(e,t,r,n,a,i){var o=e.gl,s=e.resources,u=e.state,l=e.extensions,c=l.colorBufferFloat,d=l.textureFloat,f=l.colorBufferHalfFloat,p=l.textureHalfFloat,h=a.smoothness,v=a.resolution,m=Z8(t,r,n,a),g=m.drawCount,y=m.positions,b=m.radii,x=m.groups,S=m.scale,_=m.expandedBox,A=m.dim,T=m.maxRadius,I=A[0],M=A[1],O=A[2],D=K8("min-dist-3d",e,"volume-uint8","rgba","ubyte","nearest");D.define(I,M,O);var F=Ge.create(1,1),G=T*2,N=J8(e,g,y,b,x,D,_,A,A,F,h,v,G),z=N.values.uCurrentSlice,$=Y8(e);$.bind(),eN(e),o.viewport(0,0,I,M),o.scissor(0,0,I,M),i||(i=f&&p?s.texture("volume-float16","rgba","fp16","linear"):c&&d?s.texture("volume-float32","rgba","float","linear"):s.texture("volume-uint8","rgba","ubyte","linear")),i.define(I,M,O);function j(Z,q){u.currentRenderItemId=-1;for(var te=0;te<O;++te)k.update(z,te),Z.attachFramebuffer($,0,te),q&&o.clear(o.COLOR_BUFFER_BIT),N.render();o.flush()}return rN(e,N),j(i,!0),tN(e,N),j(D,!0),nN(e,N),j(i,!1),{texture:i,scale:S,bbox:_,gridDim:A,gridTexDim:A,gridTexScale:F,radiusFactor:G,resolution:v}}function Z8(e,t,r,n){for(var a=n.resolution,i=n.radiusOffset,o=1/a,s=e.indices,u=e.x,l=e.y,c=e.z,d=e.id,f=ke.size(s),p=new Float32Array(f*3),h=new Float32Array(f),v=new Float32Array(f),m=0,g=0;g<f;++g){var y=ke.getAt(s,g);p[g*3]=u[y],p[g*3+1]=l[y],p[g*3+2]=c[y];var b=r(y)+i;m<b&&(m=b),h[g]=b,v[g]=d?d[g]:g}var x=m*2+a*4,S=Xt.expand(Xt(),t,C.create(x,x,x)),_=Xt.scale(Xt(),S,o),A=Xt.size(C(),_);C.ceil(A,A);var T=C.create(a,a,a);return{drawCount:f,positions:p,radii:h,groups:v,scale:T,expandedBox:S,dim:A,maxRadius:m}}function J8(e,t,r,n,a,i,o,s,u,l,c,d,f){if(e.namedComputeRenderables[Ls]){var p=C.sub(C(),o.max,o.min),h=e.namedComputeRenderables[Ls].values;k.updateIfChanged(h.drawCount,t),k.updateIfChanged(h.instanceCount,1),k.update(h.aRadius,n),k.update(h.aPosition,r),k.update(h.aGroup,a),k.updateIfChanged(h.uCurrentSlice,0),k.updateIfChanged(h.uCurrentX,0),k.updateIfChanged(h.uCurrentY,0),k.update(h.uBboxMin,o.min),k.update(h.uBboxSize,p),k.update(h.uGridDim,s),k.update(h.uGridTexDim,u),k.update(h.uGridTexScale,l),k.updateIfChanged(h.uAlpha,c),k.updateIfChanged(h.uResolution,d),k.updateIfChanged(h.uRadiusFactorInv,1/f),k.update(h.tMinDistanceTex,i),k.updateIfChanged(h.dGridTexType,i.getDepth()>0?"3d":"2d"),k.updateIfChanged(h.dCalcType,"density"),e.namedComputeRenderables[Ls].update()}else e.namedComputeRenderables[Ls]=B4e(e,t,r,n,a,i,o,s,u,l,c,d,f);return e.namedComputeRenderables[Ls]}function B4e(e,t,r,n,a,i,o,s,u,l,c,d,f){var p=C.sub(C(),o.max,o.min),h={drawCount:k.create(t),instanceCount:k.create(1),aRadius:k.create(n),aPosition:k.create(r),aGroup:k.create(a),uCurrentSlice:k.create(0),uCurrentX:k.create(0),uCurrentY:k.create(0),uBboxMin:k.create(o.min),uBboxSize:k.create(p),uGridDim:k.create(s),uGridTexDim:k.create(u),uGridTexScale:k.create(l),uAlpha:k.create(c),uResolution:k.create(d),uRadiusFactorInv:k.create(1/f),tMinDistanceTex:k.create(i),dGridTexType:k.create(i.getDepth()>0?"3d":"2d"),dCalcType:k.create("density")},v=w({},D4e),m=_n(Ls,I4e,M4e),g=Ca(e,"points",m,v,h);return xa(g,h)}function eN(e){var t=e.gl,r=e.state;r.disable(t.CULL_FACE),r.enable(t.BLEND),r.disable(t.DEPTH_TEST),r.enable(t.SCISSOR_TEST),r.depthMask(!1),r.clearColor(0,0,0,0)}function tN(e,t){var r=e.gl,n=e.state;if(k.update(t.values.dCalcType,"minDistance"),t.update(),n.colorMask(!1,!1,!1,!0),n.blendFunc(r.ONE,r.ONE),!e.extensions.blendMinMax)throw new Error("GPU gaussian surface calculation requires EXT_blend_minmax");n.blendEquation(e.extensions.blendMinMax.MAX)}function rN(e,t){var r=e.gl,n=e.state;k.update(t.values.dCalcType,"density"),t.update(),n.colorMask(!1,!1,!1,!0),n.blendFunc(r.ONE,r.ONE),n.blendEquation(r.FUNC_ADD)}function nN(e,t){var r=e.gl,n=e.state;k.update(t.values.dCalcType,"groupId"),t.update(),n.colorMask(!0,!0,!0,!1),n.blendFunc(r.ONE,r.ZERO),n.blendEquation(r.FUNC_ADD)}function L4e(e){var t=e[0]*e[1]*e[2],r=Math.sqrt(t),n=Math.pow(2,Math.ceil(Math.log(r)/Math.log(2))),a=0,i=e[1],o=1,s=e[2];return n<e[0]*e[2]?(s=Math.floor(n/e[0]),o=Math.ceil(e[2]/s),a=s*e[0],i*=o):a=e[0]*e[2],{texDimX:a,texDimY:i,texRows:o,texCols:s,powerOfTwoSize:i<n?n:n*2}}function aN(e,t,r,n,a){return ce(this,void 0,void 0,function(){function i(X,Q){for(var ee=X;ee<Q;++ee)for(var le=ke.getAt(d,ee),ye=f[le],be=p[le],Ae=h[le],xe=g[ee],ae=xe*xe,oe=1/ae,R=xe*2,V=R*R,pe=Math.ceil(R*c),_e=Math.floor(c*(ye-A[0])),Ee=Math.floor(c*(be-A[1])),Ve=Math.floor(c*(Ae-A[2])),He=Math.max(0,_e-pe),Ye=Math.max(0,Ee-pe),lt=Math.max(0,Ve-pe),Le=Math.min(N,_e+pe+2),Qe=Math.min(z,Ee+pe+2),at=Math.min($,Ve+pe+2),ot=He;ot<Le;++ot)for(var dt=te[ot]-ye,Oe=ot*q,Me=Ye;Me<Qe;++Me)for(var Ke=he[Me]-be,tt=dt*dt+Ke*Ke,St=Me*j+Oe,ht=lt;ht<at;++ht){var ut=W[ht]-Ae,fe=tt+ut*ut;if(fe<=V){var me=xae(-U*(fe*oe)),we=ht+St;O[we]+=me,me>K[we]&&(K[we]=me,F[we]=v?v[ee]:ee)}}}function o(){return ce(this,void 0,void 0,function(){var X;return de(this,function(Q){switch(Q.label){case 0:X=0,Q.label=1;case 1:return X<m?(i(X,Math.min(X+H,m)),e.shouldUpdate?[4,e.update({message:"filling density grid",current:X,max:m})]:[3,3]):[3,4];case 2:Q.sent(),Q.label=3;case 3:return X+=H,[3,1];case 4:return[2]}})})}var s,u,l,c,d,f,p,h,v,m,g,y,b,x,S,_,A,T,I,M,O,D,F,G,N,z,$,j,Z,q,te,he,W,K,U,H,J;return de(this,function(X){switch(X.label){case 0:for(s=a.resolution,u=a.radiusOffset,l=a.smoothness,c=1/s,d=t.indices,f=t.x,p=t.y,h=t.z,v=t.id,m=ke.size(d),g=new Float32Array(m),y=0,b=0;b<m;++b)x=n(ke.getAt(d,b))+u,y<x&&(y=x),g[b]=x;return S=y*2+s,_=Xt.expand(Xt(),r,C.create(S,S,S)),A=_.min,T=Xt.scale(Xt(),_,c),I=Xt.size(C(),T),C.ceil(I,I),M=Pr.Space(I,[0,1,2],Float32Array),O=M.create(),D=Pr.create(M,O),F=M.create(),F.fill(-1),G=Pr.create(M,F),N=I[0],z=I[1],$=I[2],j=$,Z=z,q=j*Z,te=Jf(I[0],A[0],s),he=Jf(I[1],A[1],s),W=Jf(I[2],A[2],s),K=M.create(),U=l,H=Math.ceil(1e5/(Math.pow(Math.pow(y,3),3)*c)),[4,o()];case 1:return X.sent(),J=ue.identity(),ue.fromScaling(J,C.create(s,s,s)),ue.setTranslation(J,_.min),[2,{field:D,idField:G,transform:J,radiusFactor:1,resolution:s}]}})})}var $v=w({resolution:E.Numeric(1,{min:.1,max:20,step:.1},w({description:"Grid resolution/cell spacing."},At.CustomQualityParamInfo)),radiusOffset:E.Numeric(0,{min:0,max:10,step:.1},{description:"Extra/offset radius added to the atoms/coarse elements for gaussian calculation. Useful to create coarse, low resolution surfaces."}),smoothness:E.Numeric(1.5,{min:.5,max:2.5,step:.1},{description:"Smoothness of the gausian surface, lower is smoother."})},g1);E.getDefaultValues($v);function k1(e,t){var r=e.maxTextureSize/3;return r*r/Math.max(1,t?t.units.length/16:1)}function iN(e,t,r){var n=this,a=t.lookup3d.boundary.box,i=ef(a,r),o=y1(e,t,i),s=o.position,u=o.radius;return We.create("Gaussian Density",function(l){return ce(n,void 0,void 0,function(){return de(this,function(c){switch(c.label){case 0:return[4,aN(l,s,a,u,i)];case 1:return[2,c.sent()]}})})})}function N4e(e,t,r,n,a){var i=this,o=t.lookup3d.boundary.box,s=ef(o,r,k1(n,e)),u=y1(e,t,s),l=u.position,c=u.radius;return We.create("Gaussian Density",function(d){return ce(i,void 0,void 0,function(){return de(this,function(f){return[2,$8(n,l,o,c,s,a)]})})})}function U4e(e,t,r,n,a,i){var o=this,s=t.lookup3d.boundary.box,u=ef(s,n,k1(a,e)),l=y1(e,t,u),c=l.position,d=l.radius;return We.create("Gaussian Density",function(f){return ce(o,void 0,void 0,function(){return de(this,function(p){return[2,Ow(a,c,s,d,r,u,i)]})})})}function z4e(e,t){var r=this,n=e.lookup3d.boundary.box,a=ef(n,t),i=k3(e,t.ignoreHydrogens,t.traceOnly),o=i.position,s=i.radius;return We.create("Gaussian Density",function(u){return ce(r,void 0,void 0,function(){return de(this,function(l){switch(l.label){case 0:return[4,aN(u,o,n,s,a)];case 1:return[2,l.sent()]}})})})}function V4e(e,t,r,n){var a=this,i=e.lookup3d.boundary.box,o=ef(i,t,k1(r)),s=k3(e,t.ignoreHydrogens,t.traceOnly),u=s.position,l=s.radius;return We.create("Gaussian Density",function(c){return ce(a,void 0,void 0,function(){return de(this,function(d){return[2,$8(r,u,i,l,o,n)]})})})}function H4e(e,t,r,n,a){var i=this,o=e.lookup3d.boundary.box,s=ef(o,r,k1(n)),u=k3(e,r.ignoreHydrogens,r.traceOnly),l=u.position,c=u.radius;return We.create("Gaussian Density",function(d){return ce(i,void 0,void 0,function(){return de(this,function(f){return[2,Ow(n,l,o,c,t,s,a)]})})})}function G4e(e,t,r,n,a){var i=e.colorType,o=e.vertexCount,s=e.groupCount,u=e.positionBuffer,l=e.transformBuffer,c=e.groupBuffer,d=i.endsWith("Instance"),f=Xt.fromSphere3D(Xt(),d?e.boundingSphere:e.invariantBoundingSphere),p=1/t,h=Xt.scale(Xt(),f,p),v=Xt.size(C(),h);C.ceil(v,v),C.add(v,v,C.create(2,2,2));var m=f.min,g=v[0],y=v[1],b=Wv(v),x=b.width,S=b.height,_=3,A=new Float32Array(x*S*_),T=new Float32Array(x*S),I=new Uint8Array(x*S*_),M={array:I,width:x,height:S,filter:"linear"},O=d?e.instanceCount:1,D=e.colorData.array;function F(Me,Ke,tt){var St=Math.floor(tt*g%x/g),ht=Math.floor(tt*g/x),ut=St*g+Me;return _*(ht*y*x+Ke*x+ut)}for(var G=2,N=v[0],z=v[1],$=v[2],j=C(),Z=0;Z<O;++Z)for(var q=0;q<o;q+=r){C.fromArray(j,u,q*3),d&&C.transformMat4Offset(j,j,l,0,0,Z*16),C.sub(j,j,m),C.scale(j,j,p);for(var te=j[0],he=j[1],W=j[2],K=Math.floor(te),U=Math.floor(he),H=Math.floor(W),J=Z*s+c[q],X=D[J*3],Q=D[J*3+1],ee=D[J*3+2],le=Math.max(0,K-G),ye=Math.max(0,U-G),be=Math.max(0,H-G),Ae=Math.min(N,K+G+2),xe=Math.min(z,U+G+2),ae=Math.min($,H+G+2),oe=le;oe<Ae;++oe)for(var R=oe-te,V=ye;V<xe;++V)for(var pe=V-he,_e=be;_e<ae;++_e){var Ee=_e-W,Ve=Math.sqrt(R*R+pe*pe+Ee*Ee);if(!(Ve>G)){var He=G-Ve,Ye=F(oe,V,_e);A[Ye]+=X*He,A[Ye+1]+=Q*He,A[Ye+2]+=ee*He,T[Ye/3]+=He}}}for(var Z=0,lt=T.length;Z<lt;++Z){var Le=Z*3,Qe=T[Z];I[Le]=Math.round(A[Le]/Qe),I[Le+1]=Math.round(A[Le+1]/Qe),I[Le+2]=Math.round(A[Le+2]/Qe)}var at=Ge.create(x,S),ot=Cr.create(m[0],m[1],m[2],p),dt=d?"volumeInstance":"volume";if(n)return a||(a=n.resources.texture("image-uint8","rgb","ubyte","linear")),a.load(M),{kind:"volume",texture:a,gridTexDim:at,gridDim:v,gridTransform:ot,type:dt};var Oe=q4e({vertexCount:o,instanceCount:O,transformBuffer:l,positionBuffer:u,colorType:dt,grid:I,gridDim:v,gridTexDim:at,gridTransform:ot,vertexStride:3,colorStride:3});return{kind:"vertex",texture:Oe,texDim:Ge.create(Oe.width,Oe.height),type:d?"vertexInstance":"vertex"}}function q4e(e){var t=e.vertexCount,r=e.positionBuffer,n=e.transformBuffer,a=e.grid,i=e.gridDim,o=e.gridTexDim,s=e.gridTransform,u=e.vertexStride,l=e.colorStride,c=e.colorType.endsWith("Instance"),d=c?e.instanceCount:1,f=Na(Math.max(1,d*t),3,Uint8Array),p=f.array,h=i[0],v=i[1],m=o[0],g=C.fromArray(C(),s,0),y=s[3];function b(be,Ae,xe){var ae=Math.floor(xe*h%m/h),oe=Math.floor(xe*h/m),R=ae*h+be;return l*(oe*v*m+Ae*m+R)}for(var x=C(),S=C(),_=C(),A=C(),T=0;T<d;++T)for(var I=0;I<t;++I){C.fromArray(x,r,I*u),c&&C.transformMat4Offset(x,x,n,0,0,T*16),C.sub(x,x,g),C.scale(x,x,y),C.floor(S,x),C.ceil(_,x),C.sub(A,x,S),C.sub(x,_,S),C.div(A,A,x);var M=S[0],O=S[1],D=S[2],F=_[0],G=_[1],N=_[2],z=A[0],$=A[1],j=A[2],Z=it.fromArray(a,b(M,O,D)),q=it.fromArray(a,b(F,O,D)),te=it.fromArray(a,b(M,O,N)),he=it.fromArray(a,b(F,O,N)),W=it.fromArray(a,b(M,G,D)),K=it.fromArray(a,b(F,G,D)),U=it.fromArray(a,b(M,G,N)),H=it.fromArray(a,b(F,G,N)),J=it.interpolate(Z,q,z),X=it.interpolate(te,he,z),Q=it.interpolate(W,K,z),ee=it.interpolate(U,H,z),le=it.interpolate(J,Q,$),ye=it.interpolate(X,ee,$);it.toArray(it.interpolate(le,ye,j),p,(T*t+I)*3)}return f}var j4e=`
precision highp float;
precision highp sampler2D;

uniform sampler2D tColor;
uniform vec2 uTexSize;

void main(void) {
    vec2 coords = gl_FragCoord.xy / uTexSize;
    vec4 color = texture2D(tColor, coords);

    gl_FragColor.rgb = color.rgb / color.a;
}
`,W4e=`
precision highp float;

varying vec3 vPosition;
varying vec3 vColor;

uniform float uCurrentSlice;
uniform float uCurrentX;
uniform float uCurrentY;
uniform float uResolution;

const float p = 2.0;

void main() {
    vec2 v = gl_FragCoord.xy - vec2(uCurrentX, uCurrentY) - 0.5;
    vec3 fragPos = vec3(v.x, v.y, uCurrentSlice);
    float dist = distance(fragPos, vPosition);
    if (dist > p) discard;

    gl_FragColor = vec4(vColor, 1.0) * (p - dist);
}
`,X4e=`
precision highp float;

#include common
#include read_from_texture

uniform int uTotalCount;
uniform int uGroupCount;

attribute float aSample;
#define SampleID int(aSample)

attribute mat4 aTransform;
attribute float aInstance;

uniform vec2 uGeoTexDim;
uniform sampler2D tPosition;
uniform sampler2D tGroup;

uniform vec2 uColorTexDim;
uniform sampler2D tColor;

varying vec3 vPosition;
varying vec3 vColor;

uniform vec3 uBboxSize;
uniform vec3 uBboxMin;
uniform float uResolution;

void main() {
    vec3 position = readFromTexture(tPosition, SampleID, uGeoTexDim).xyz;
    float group = decodeFloatRGB(readFromTexture(tGroup, SampleID, uGeoTexDim).rgb);

    position = (aTransform * vec4(position, 1.0)).xyz;
    gl_PointSize = 7.0;
    vPosition = (position - uBboxMin) / uResolution;
    gl_Position = vec4(((position - uBboxMin) / uBboxSize) * 2.0 - 1.0, 1.0);

    #if defined(dColorType_group)
        vColor = readFromTexture(tColor, group, uColorTexDim).rgb;
    #elif defined(dColorType_groupInstance)
        vColor = readFromTexture(tColor, aInstance * float(uGroupCount) + group, uColorTexDim).rgb;
    #endif
}
`,Y4e={drawCount:Zn("number"),instanceCount:Zn("number"),stride:Zn("number"),uTotalCount:qe("i"),uInstanceCount:qe("i"),uGroupCount:qe("i"),aTransform:Vr("float32",16,1),aInstance:Vr("float32",1,1),aSample:Vr("float32",1,0),uGeoTexDim:qe("v2","buffered"),tPosition:ur("texture","rgba","float","nearest"),tGroup:ur("texture","rgba","float","nearest"),uColorTexDim:qe("v2"),tColor:ur("image-uint8","rgb","ubyte","nearest"),dColorType:$t("string",["group","groupInstance","vertex","vertexInstance"]),uCurrentSlice:qe("f"),uCurrentX:qe("f"),uCurrentY:qe("f"),uBboxMin:qe("v3","material"),uBboxSize:qe("v3","material"),uResolution:qe("f","material")},Yo="color-accumulate";function oN(e,t){for(var r=new Float32Array(e),n=0;n<e;++n)r[n]=n*t;return r}function K4e(e,t,r,n,a){if(e.namedComputeRenderables[Yo]){var i=C.sub(C(),r.max,r.min),o=e.namedComputeRenderables[Yo].values,s=Math.round(t.vertexCount/a);(s>o.drawCount.ref.value||a!==o.stride.ref.value)&&k.update(o.aSample,oN(s,a)),k.updateIfChanged(o.drawCount,s),k.updateIfChanged(o.instanceCount,t.instanceCount),k.updateIfChanged(o.stride,a),k.updateIfChanged(o.uTotalCount,t.vertexCount),k.updateIfChanged(o.uInstanceCount,t.instanceCount),k.updateIfChanged(o.uGroupCount,t.groupCount),k.update(o.aTransform,t.transformBuffer),k.update(o.aInstance,t.instanceBuffer),k.update(o.uGeoTexDim,Ge.set(o.uGeoTexDim.ref.value,t.positionTexture.getWidth(),t.positionTexture.getHeight())),k.update(o.tPosition,t.positionTexture),k.update(o.tGroup,t.groupTexture),k.update(o.uColorTexDim,Ge.set(o.uColorTexDim.ref.value,t.colorData.width,t.colorData.height)),k.update(o.tColor,t.colorData),k.updateIfChanged(o.dColorType,t.colorType),k.updateIfChanged(o.uCurrentSlice,0),k.updateIfChanged(o.uCurrentX,0),k.updateIfChanged(o.uCurrentY,0),k.update(o.uBboxMin,r.min),k.update(o.uBboxSize,i),k.updateIfChanged(o.uResolution,n),e.namedComputeRenderables[Yo].update()}else e.namedComputeRenderables[Yo]=$4e(e,t,r,n,a);return e.namedComputeRenderables[Yo]}function $4e(e,t,r,n,a){var i=C.sub(C(),r.max,r.min),o=Math.round(t.vertexCount/a),s={drawCount:k.create(o),instanceCount:k.create(t.instanceCount),stride:k.create(a),uTotalCount:k.create(t.vertexCount),uInstanceCount:k.create(t.instanceCount),uGroupCount:k.create(t.groupCount),aTransform:k.create(t.transformBuffer),aInstance:k.create(t.instanceBuffer),aSample:k.create(oN(o,a)),uGeoTexDim:k.create(Ge.create(t.positionTexture.getWidth(),t.positionTexture.getHeight())),tPosition:k.create(t.positionTexture),tGroup:k.create(t.groupTexture),uColorTexDim:k.create(Ge.create(t.colorData.width,t.colorData.height)),tColor:k.create(t.colorData),dColorType:k.create(t.colorType),uCurrentSlice:k.create(0),uCurrentX:k.create(0),uCurrentY:k.create(0),uBboxMin:k.create(r.min),uBboxSize:k.create(i),uResolution:k.create(n)},u=w({},Y4e),l=_n("accumulate",X4e,W4e),c=Ca(e,"points",l,u,s);return xa(c,s)}function Q4e(e){var t=e.gl,r=e.state;r.disable(t.CULL_FACE),r.enable(t.BLEND),r.disable(t.DEPTH_TEST),r.enable(t.SCISSOR_TEST),r.depthMask(!1),r.clearColor(0,0,0,0),r.blendFunc(t.ONE,t.ONE),r.blendEquation(t.FUNC_ADD)}var Z4e=w(w({},Ua),{tColor:ur("texture","rgba","float","nearest"),uTexSize:qe("v2")}),bh="color-normalize";function J4e(e,t){if(e.namedComputeRenderables[bh]){var r=e.namedComputeRenderables[bh].values;k.update(r.tColor,t),k.update(r.uTexSize,Ge.set(r.uTexSize.ref.value,t.getWidth(),t.getHeight())),e.namedComputeRenderables[bh].update()}else e.namedComputeRenderables[bh]=ePe(e,t);return e.namedComputeRenderables[bh]}function ePe(e,t){var r=w(w({},za),{tColor:k.create(t),uTexSize:k.create(Ge.create(t.getWidth(),t.getHeight()))}),n=w({},Z4e),a=_n("normalize",Di,j4e),i=Ca(e,"triangles",a,n,r);return xa(i,r)}function tPe(e){var t=e.gl,r=e.state;r.disable(t.CULL_FACE),r.enable(t.BLEND),r.disable(t.DEPTH_TEST),r.enable(t.SCISSOR_TEST),r.depthMask(!1),r.clearColor(0,0,0,0),r.blendFunc(t.ONE,t.ONE),r.blendEquation(t.FUNC_ADD)}function rPe(e){var t=e[0]*e[1]*e[2],r=Math.sqrt(t),n=Math.pow(2,Math.ceil(Math.log(r)/Math.log(2))),a=0,i=e[1],o=1,s=e[2];return n<e[0]*e[2]?(s=Math.floor(n/e[0]),o=Math.ceil(e[2]/s),a=s*e[0],i*=o):a=e[0]*e[2],{texDimX:a,texDimY:i,texRows:o,texCols:s,powerOfTwoSize:i<n?n:n*2}}function nPe(e,t,r,n,a){var i=n.gl,o=n.resources,s=n.state,u=n.extensions,l=u.colorBufferHalfFloat,c=u.textureHalfFloat,d=e.colorType.endsWith("Instance"),f=Xt.fromSphere3D(Xt(),d?e.boundingSphere:e.invariantBoundingSphere),p=1/t,h=Xt.scale(Xt(),f,p),v=Xt.size(C(),h);C.ceil(v,v),C.add(v,v,C.create(2,2,2));var m=f.min,g=v[0],y=v[1],b=v[2],x=rPe(v),S=x.texDimX,_=x.texDimY,A=x.texCols;n.namedTextures[Yo]||(n.namedTextures[Yo]=l&&c?o.texture("image-float16","rgba","fp16","nearest"):o.texture("image-float32","rgba","float","nearest"));var T=n.namedTextures[Yo];T.define(S,_);var I=K4e(n,e,f,t,r),M=I.values,O=M.uCurrentSlice,D=M.uCurrentX,F=M.uCurrentY;n.namedFramebuffers[Yo]||(n.namedFramebuffers[Yo]=n.resources.framebuffer());var G=n.namedFramebuffers[Yo];G.bind(),Q4e(n),s.currentRenderItemId=-1,T.attachFramebuffer(G,0),i.viewport(0,0,S,_),i.scissor(0,0,S,_),i.clear(i.COLOR_BUFFER_BIT),k.update(F,0);for(var N=0,z=0,$=0,j=0;j<b;++j)N>=A&&(N-=A,z+=y,$=0,k.update(F,z)),k.update(D,$),k.update(O,j),i.viewport($,z,g,y),i.scissor($,z,g,y),I.render(),++N,$+=g;a||(a=o.texture("image-uint8","rgb","ubyte","linear")),a.define(S,_);var Z=J4e(n,T);tPe(n),s.currentRenderItemId=-1,a.attachFramebuffer(G,0),i.viewport(0,0,S,_),i.scissor(0,0,S,_),i.clear(i.COLOR_BUFFER_BIT),Z.render();var q=Cr.create(m[0],m[1],m[2],p),te=d?"volumeInstance":"volume";return{texture:a,gridDim:v,gridTexDim:Ge.create(S,_),gridTransform:q,type:te}}var sN={smoothColors:E.MappedStatic("auto",{auto:E.Group({}),on:E.Group({resolutionFactor:E.Numeric(2,{min:.5,max:6,step:.1}),sampleStride:E.Numeric(3,{min:1,max:12,step:1})}),off:E.Group({})})};function Qv(e,t,r,n){if((e.smoothColors.name==="on"||e.smoothColors.name==="auto"&&t.color.preferSmoothing)&&r&&r<3&&n){var a=3;return e.smoothColors.name==="on"?(r*=e.smoothColors.params.resolutionFactor,a=e.smoothColors.params.sampleStride):(r*=2-eR(0,1.1,r),r=Math.max(.5,r),r>1.2&&(a=2)),{resolution:r,stride:a,webgl:n}}}function uN(e){return e==="group"||e==="groupInstance"}function Fw(e,t,r,n,a){if(!!uN(e.dColorType.ref.value)){var i=G4e({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionBuffer:e.aPosition.ref.value,groupBuffer:e.aGroup.ref.value,colorData:e.tColor.ref.value,colorType:e.dColorType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value},t,r,n,a);i.kind==="volume"?(k.updateIfChanged(e.dColorType,i.type),k.update(e.tColorGrid,i.texture),k.update(e.uColorTexDim,i.gridTexDim),k.update(e.uColorGridDim,i.gridDim),k.update(e.uColorGridTransform,i.gridTransform)):i.kind==="vertex"&&(k.updateIfChanged(e.dColorType,i.type),k.update(e.tColor,i.texture),k.update(e.uColorTexDim,i.texDim))}}function lN(e,t,r,n,a){if(!!uN(e.dColorType.ref.value)){r*=3;var i=nPe({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionTexture:e.tPosition.ref.value,groupTexture:e.tGroup.ref.value,colorData:e.tColor.ref.value,colorType:e.dColorType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value},t,r,n,a);k.updateIfChanged(e.dColorType,i.type),k.update(e.tColorGrid,i.texture),k.update(e.uColorTexDim,i.gridTexDim),k.update(e.uColorGridDim,i.gridDim),k.update(e.uColorGridTransform,i.gridTransform)}}var cN=w(w(w({},$v),sN),{ignoreHydrogens:E.Boolean(!1),tryUseGpu:E.Boolean(!0)}),kw=w(w(w({},Va),kme),cN),dN=w(w(w({},Uv),Eme),cN);function fN(e){return e.extensions.colorBufferFloat&&e.extensions.textureFloat&&e.extensions.blendMinMax&&e.extensions.drawBuffers}function Vp(e,t,r){if(t.resolution>1)return!1;var n=r.maxTextureSize/3,a=Xk(e.boundary.box,t.resolution,n*n),i=a.areaCells,o=a.maxAreaCells;return i<o}function aPe(e,t,r,n){return r.tryUseGpu&&n&&fN(n)&&Vp(t,r,n)?dPe(e):sPe(e)}function iPe(e,t,r,n){return r.tryUseGpu&&n&&fN(n)&&Vp(t,r,n)?pPe(e):lPe(e)}function oPe(e,t,r,n,a,i){return ce(this,void 0,void 0,function(){var o,s,u,l,c,d,f,p,h,v;return de(this,function(m){switch(m.label){case 0:return o=a.smoothness,[4,iN(r,t,a).runInContext(e.runtime)];case 1:return s=m.sent(),u=s.transform,l=s.field,c=s.idField,d=s.radiusFactor,f=s.resolution,p={isoLevel:Math.exp(-o)/d,scalarField:l,idField:c},[4,w1(p,i).runAsChild(e.runtime)];case 2:return h=m.sent(),h.meta.resolution=f,Lt.transform(h,u),e.webgl&&!e.webgl.isWebGL2&&Lt.uniformTriangleGroup(h),v=Ne.expand(Ne(),t.boundary.sphere,a.radiusOffset+Np(t)),h.setBoundingSphere(v),[2,h]}})})}function sPe(e){return pi({defaultProps:E.getDefaultValues(kw),createGeometry:oPe,createLocationIterator:ei.fromGroup,getLoci:Js,eachLocation:Zs,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0),r.smoothColors.name!==n.smoothColors.name?t.updateColor=!0:r.smoothColors.name==="on"&&n.smoothColors.name==="on"&&(r.smoothColors.params.resolutionFactor!==n.smoothColors.params.resolutionFactor&&(t.updateColor=!0),r.smoothColors.params.sampleStride!==n.smoothColors.params.sampleStride&&(t.updateColor=!0))},mustRecreate:function(t,r,n){return r.tryUseGpu&&!!n&&Vp(t.structure,r,n)},processValues:function(t,r,n,a,i){var o=r.meta,s=o.resolution,u=o.colorTexture,l=Qv(n,a,s,i);l&&(Fw(t,l.resolution,l.stride,l.webgl,u),r.meta.colorTexture=t.tColorGrid.ref.value)},dispose:function(t){var r;(r=t.meta.colorTexture)===null||r===void 0||r.destroy()}},e)}function uPe(e,t,r,n,a){return ce(this,void 0,void 0,function(){var i,o,s,u,l,c,d,f,p,h;return de(this,function(v){switch(v.label){case 0:return i=n.smoothness,[4,z4e(t,n).runInContext(e.runtime)];case 1:return o=v.sent(),s=o.transform,u=o.field,l=o.idField,c=o.radiusFactor,d=o.resolution,f={isoLevel:Math.exp(-i)/c,scalarField:u,idField:l},[4,w1(f,a).runAsChild(e.runtime)];case 2:return p=v.sent(),p.meta.resolution=d,Lt.transform(p,s),e.webgl&&!e.webgl.isWebGL2&&Lt.uniformTriangleGroup(p),h=Ne.expand(Ne(),t.boundary.sphere,n.radiusOffset+b1(t)),p.setBoundingSphere(h),[2,p]}})})}function lPe(e){return tf({defaultProps:E.getDefaultValues(dN),createGeometry:uPe,createLocationIterator:ei.fromStructure,getLoci:M1,eachLocation:I1,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.smoothColors.name!==n.smoothColors.name?t.updateColor=!0:r.smoothColors.name==="on"&&n.smoothColors.name==="on"&&(r.smoothColors.params.resolutionFactor!==n.smoothColors.params.resolutionFactor&&(t.updateColor=!0),r.smoothColors.params.sampleStride!==n.smoothColors.params.sampleStride&&(t.updateColor=!0))},mustRecreate:function(t,r,n){return r.tryUseGpu&&!!n&&Vp(t,r,n)},processValues:function(t,r,n,a,i){var o=r.meta,s=o.resolution,u=o.colorTexture,l=Qv(n,a,s,i);l&&(Fw(t,l.resolution,l.stride,l.webgl,u),r.meta.colorTexture=t.tColorGrid.ref.value)},dispose:function(t){var r;(r=t.meta.colorTexture)===null||r===void 0||r.destroy()}},e)}var op="gaussian-surface";function cPe(e,t,r,n,a,i){return ce(this,void 0,void 0,function(){var o,s,u,l,c,d,f,p,h,v,m,g,y,b;return de(this,function(x){switch(x.label){case 0:if(!e.webgl)throw new Error("webgl context required to create gaussian surface texture-mesh");return o=e.webgl,s=o.namedTextures,u=o.resources,l=o.extensions,c=l.colorBufferFloat,d=l.textureFloat,f=l.colorBufferHalfFloat,p=l.textureHalfFloat,s[op]||(s[op]=f&&p?u.texture("image-float16","rgba","fp16","linear"):c&&d?u.texture("image-float32","rgba","float","linear"):u.texture("image-uint8","rgba","ubyte","linear")),[4,U4e(r,t,!0,a,e.webgl,s[op]).runInContext(e.runtime)];case 1:return h=x.sent(),v=Math.exp(-a.smoothness)/h.radiusFactor,m=i==null?void 0:i.doubleBuffer.get(),g=sw(e.webgl,h.texture,h.gridDim,h.gridTexDim,h.gridTexScale,h.transform,v,!1,!0,m==null?void 0:m.vertex,m==null?void 0:m.group,m==null?void 0:m.normal),y=Ne.expand(Ne(),t.boundary.sphere,a.radiusOffset+b1(r)),b=ps.create(g.vertexCount,1,g.vertexTexture,g.groupTexture,g.normalTexture,y,i),b.meta={resolution:h.resolution},[2,b]}})})}function dPe(e){return Bme({defaultProps:E.getDefaultValues(kw),createGeometry:cPe,createLocationIterator:ei.fromGroup,getLoci:Js,eachLocation:Zs,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0),r.smoothColors.name!==n.smoothColors.name?t.updateColor=!0:r.smoothColors.name==="on"&&n.smoothColors.name==="on"&&(r.smoothColors.params.resolutionFactor!==n.smoothColors.params.resolutionFactor&&(t.updateColor=!0),r.smoothColors.params.sampleStride!==n.smoothColors.params.sampleStride&&(t.updateColor=!0))},mustRecreate:function(t,r,n){return!r.tryUseGpu||!n||!Vp(t.structure,r,n)},processValues:function(t,r,n,a,i){var o=r.meta,s=o.resolution,u=o.colorTexture,l=Qv(n,a,s,i);l&&(lN(t,l.resolution,l.stride,l.webgl,u),r.meta.colorTexture=t.tColorGrid.ref.value)},dispose:function(t){var r;t.vertexTexture.ref.value.destroy(),t.groupTexture.ref.value.destroy(),t.normalTexture.ref.value.destroy(),t.doubleBuffer.destroy(),(r=t.meta.colorTexture)===null||r===void 0||r.destroy()}},e)}function fPe(e,t,r,n,a){return ce(this,void 0,void 0,function(){var i,o,s,u,l,c,d,f,p,h,v,m,g,y;return de(this,function(b){switch(b.label){case 0:if(!e.webgl)throw new Error("webgl context required to create structure gaussian surface texture-mesh");return i=e.webgl,o=i.namedTextures,s=i.resources,u=i.extensions,l=u.colorBufferFloat,c=u.textureFloat,d=u.colorBufferHalfFloat,f=u.textureHalfFloat,o[op]||(o[op]=d&&f?s.texture("image-float16","rgba","fp16","linear"):l&&c?s.texture("image-float32","rgba","float","linear"):s.texture("image-uint8","rgba","ubyte","linear")),[4,H4e(t,!0,n,e.webgl,o[op]).runInContext(e.runtime)];case 1:return p=b.sent(),h=Math.exp(-n.smoothness)/p.radiusFactor,v=a==null?void 0:a.doubleBuffer.get(),m=sw(e.webgl,p.texture,p.gridDim,p.gridTexDim,p.gridTexScale,p.transform,h,!1,!0,v==null?void 0:v.vertex,v==null?void 0:v.group,v==null?void 0:v.normal),g=Ne.expand(Ne(),t.boundary.sphere,n.radiusOffset+b1(t)),y=ps.create(m.vertexCount,1,m.vertexTexture,m.groupTexture,m.normalTexture,g,a),y.meta={resolution:p.resolution},[2,y]}})})}function pPe(e){return Ime({defaultProps:E.getDefaultValues(dN),createGeometry:fPe,createLocationIterator:ei.fromStructure,getLoci:M1,eachLocation:I1,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0),r.smoothColors.name!==n.smoothColors.name?t.updateColor=!0:r.smoothColors.name==="on"&&n.smoothColors.name==="on"&&(r.smoothColors.params.resolutionFactor!==n.smoothColors.params.resolutionFactor&&(t.updateColor=!0),r.smoothColors.params.sampleStride!==n.smoothColors.params.sampleStride&&(t.updateColor=!0))},mustRecreate:function(t,r,n){return!r.tryUseGpu||!n||!Vp(t,r,n)},processValues:function(t,r,n,a,i){var o=r.meta,s=o.resolution,u=o.colorTexture,l=Qv(n,a,s,i);l&&(lN(t,l.resolution,l.stride,l.webgl,u),r.meta.colorTexture=t.tColorGrid.ref.value)},dispose:function(t){var r;t.vertexTexture.ref.value.destroy(),t.groupTexture.ref.value.destroy(),t.normalTexture.ref.value.destroy(),t.doubleBuffer.destroy(),(r=t.meta.colorTexture)===null||r===void 0||r.destroy()}},e)}function hPe(e,t,r,n,a,i){return ce(this,void 0,void 0,function(){var o,s,u,l,c,d,f,p;return de(this,function(h){switch(h.label){case 0:return o=a.smoothness,[4,iN(r,t,a).runInContext(e.runtime)];case 1:return s=h.sent(),u=s.transform,l=s.field,c=s.idField,d={isoLevel:Math.exp(-o),scalarField:l,idField:c},[4,iw(d,i).runAsChild(e.runtime)];case 2:return f=h.sent(),mn.transform(f,u),p=Ne.expand(Ne(),t.boundary.sphere,a.radiusOffset+Np(t)),f.setBoundingSphere(p),[2,f]}})})}var pN=w(w(w({},L3),$v),{sizeFactor:E.Numeric(3,{min:0,max:10,step:.1}),lineSizeAttenuation:E.Boolean(!1),ignoreHydrogens:E.Boolean(!1)});function vPe(e){return N3({defaultProps:E.getDefaultValues(pN),createGeometry:hPe,createLocationIterator:ei.fromGroup,getLoci:Js,eachLocation:Zs,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0)}},e)}var hN={"gaussian-surface-mesh":function(e,t){return Un("Gaussian surface mesh",e,t,aPe)},"structure-gaussian-surface-mesh":function(e,t){return as("Structure-Gaussian surface mesh",e,t,iPe)},"gaussian-surface-wireframe":function(e,t){return Un("Gaussian surface wireframe",e,t,vPe)}},vN=w(w(w({},kw),pN),{visuals:E.MultiSelect(["gaussian-surface-mesh"],E.objectToOptions(hN))});function mPe(e,t){return E.clone(vN)}function gPe(e,t){return or.createMulti("Gaussian Surface",e,t,da,hN)}var yPe={name:"gaussian-surface",label:"Gaussian Surface",description:"Displays a gaussian molecular surface.",factory:gPe,getParams:mPe,defaultValues:E.getDefaultValues(vN),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.elementCount>0}},mN=w(w({},wme),{background:E.Boolean(!0),backgroundMargin:E.Numeric(0,{min:0,max:1,step:.01}),backgroundColor:E.Color(dr.black),backgroundOpacity:E.Numeric(.5,{min:0,max:1,step:.01}),level:E.Select("residue",[["chain","Chain"],["residue","Residue"],["element","Element"]]),chainScale:E.Numeric(10,{min:0,max:20,step:.1}),residueScale:E.Numeric(1,{min:0,max:20,step:.1}),elementScale:E.Numeric(.5,{min:0,max:20,step:.1})});function bPe(e){return Ame({defaultProps:E.getDefaultValues(mN),createGeometry:SPe,createLocationIterator:ei.fromStructure,getLoci:M1,eachLocation:I1,setUpdateState:function(t,r,n){t.createGeometry=r.level!==n.level||r.level==="chain"&&r.chainScale!==n.chainScale||r.level==="residue"&&r.residueScale!==n.residueScale||r.level==="element"&&r.elementScale!==n.elementScale}},e)}function SPe(e,t,r,n,a){switch(n.level){case"chain":return xPe(e,t,r,n,a);case"residue":return CPe(e,t,r,n,a);case"element":return _Pe(e,t,r,n,a)}}var _o=C(),Sh=new eo("98");function xPe(e,t,r,n,a){for(var i=Ze.create(t),o=t.units,s=t.serialMapping,u=ct.chain,l=u.auth_asym_id,c=u.label_asym_id,d=s.cumulativeUnitElementCount,f=o.length,p=n.chainScale,h=Xu.create(n,f,f/2,a),v=0,m=o.length;v<m;++v){var g=o[v];i.unit=g,i.element=g.elements[0];var y=g.lookup3d.boundary.sphere,b=y.center,x=y.radius;C.transformMat4(_o,b,g.conformation.operator.matrix);var S=l(i),_=c(i),A=S===_?_:_+" ["+S+"]";h.add(A,_o[0],_o[1],_o[2],x,p,d[v])}return h.getText()}function CPe(e,t,r,n,a){for(var i=Ze.create(t),o=t.units,s=t.serialMapping,u=ct.atom.label_comp_id,l=ct.residue.auth_seq_id,c=s.cumulativeUnitElementCount,d=t.polymerResidueCount*2,f=n.residueScale,p=Xu.create(n,d,d/2,a),h=0,v=o.length;h<v;++h){var m=o[h],g=m.conformation.position,y=m.elements;i.unit=m,i.element=m.elements[0];for(var b=m.model.atomicHierarchy.residueAtomSegments.index,x=c[h],S=0,_=y.length;S<_;){var A=S,T=b[y[S]];for(S++;S<_&&b[y[S]]===T;)S++;Sh.reset();for(var I=A;I<S;I++)g(y[I],_o),Sh.includePosition(_o);Sh.finishedIncludeStep();for(var I=A;I<S;I++)g(y[I],_o),Sh.radiusPosition(_o);i.element=y[A];var M=Sh.getSphere(),O=M.center,D=M.radius,F=l(i),G=u(i),N=G+" "+F;p.add(N,O[0],O[1],O[2],D,f,x+A)}}return p.getText()}function _Pe(e,t,r,n,a){for(var i=Ze.create(t),o=t.units,s=t.serialMapping,u=ct.atom,l=u.label_atom_id,c=u.label_alt_id,d=s.cumulativeUnitElementCount,f=Lv({},{scale:1}),p=t.elementCount,h=n.elementScale,v=Xu.create(n,p,p/2,a),m=0,g=o.length;m<g;++m){var y=o[m],b=y.conformation.position,x=y.elements;i.unit=y;for(var S=d[m],_=0,A=x.length;_<A;_++){i.element=x[_],b(i.element,_o);var T=l(i),I=c(i),M=I?T+"%"+I:T;v.add(M,_o[0],_o[1],_o[2],f.size(i),h,S+_)}}return v.getText()}var gN={"label-text":function(e,t){return as("Label text",e,t,bPe)}},yN=w(w({},mN),{visuals:E.MultiSelect(["label-text"],E.objectToOptions(gN))});function wPe(e,t){return E.clone(yN)}function APe(e,t){var r=or.createMulti("Label",e,t,da,gN);return r.setState({pickable:!1,markerActions:tr.None}),r}var PPe={name:"label",label:"Label",description:"Displays labels.",factory:APe,getParams:wPe,defaultValues:E.getDefaultValues(yN),defaultColorTheme:{name:"uniform"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.elementCount>0}};function TPe(e,t){return e[0]=e[1]=e[2]=1,t[0]!==0?e[0]=(t[1]+t[2])/-t[0]:t[1]!==0?e[1]=(t[0]+t[2])/-t[1]:t[2]!==0&&(e[2]=(t[0]+t[1])/-t[2]),e}function EPe(e){for(var t=0,r=2*Math.PI/e,n=new Float32Array(e),a=new Float32Array(e),i=0;i<e;i++)n[i]=Math.cos(t),a[i]=Math.sin(t),t+=r;return{cosTable:n,sinTable:a}}var Bw={probeRadius:E.Numeric(1.4,{min:0,max:10,step:.1},{description:"Radius of the probe tracing the molecular surface."}),resolution:E.Numeric(.5,{min:.01,max:20,step:.01},w({description:"Grid resolution/cell spacing."},At.CustomQualityParamInfo)),probePositions:E.Numeric(36,{min:12,max:90,step:1},w({description:"Number of positions tested for probe target intersection."},At.CustomQualityParamInfo))};E.getDefaultValues(Bw);function IPe(e,t,r,n,a,i){return ce(this,void 0,void 0,function(){function o(He,Ye,lt,Le,Qe){if(p!==-1){var at=p;if(at!==Le&&at!==Qe&&s(at,He,Ye,lt))return at;p=-1}for(var ot=0,dt=I.count;ot<dt;++ot){var at=ke.getAt(M,I.indices[ot]);if(at!==Le&&at!==Qe&&s(at,He,Ye,lt))return p=at,at}return-1}function s(He,Ye,lt,Le){var Qe=N[He],at=O[He]-Ye,ot=D[He]-lt,dt=F[He]-Le,Oe=at*at+ot*ot+dt*dt;return Oe<Qe*Qe}function u(He,Ye){for(var lt=He;lt<Ye;++lt){var Le=ke.getAt(M,lt),Qe=O[Le],at=D[Le],ot=F[Le],dt=N[Le],Oe=dt*dt;T.find(Qe,at,ot,dt);for(var Me=Math.ceil(dt*S),Ke=Math.floor(S*(Qe-q)),tt=Math.floor(S*(at-te)),St=Math.floor(S*(ot-he)),ht=Math.max(0,Ke-Me),ut=Math.max(0,tt-Me),fe=Math.max(0,St-Me),me=Math.min(U,Ke+Me+2),we=Math.min(H,tt+Me+2),$e=Math.min(J,St+Me+2),gt=ht;gt<me;++gt)for(var Tt=oe[gt]-Qe,Wt=gt*ee,lr=ut;lr<we;++lr)for(var wr=R[lr]-at,Yt=Tt*Tt+wr*wr,zn=lr*X+Wt,_a=fe;_a<$e;++_a){var wa=V[_a]-ot,Ri=Yt+wa*wa;if(Ri<Oe){var ms=_a+zn;xe[ms]<0&&(xe[ms]*=-1);var eu=Math.sqrt(Ri),Bo=dt/eu,Mc=Tt*Bo+Qe,Dc=wr*Bo+at,hi=wa*Bo+ot;if(o(Mc,Dc,hi,Le,-1)===-1){var Sl=dt-eu;Sl<xe[ms]&&(xe[ms]=Sl,ae[ms]=G[lt])}}}}}function l(){return ce(this,void 0,void 0,function(){var He;return de(this,function(Ye){switch(Ye.label){case 0:He=0,Ye.label=1;case 1:return He<z?(u(He,Math.min(He+pe,z)),e.shouldUpdate?[4,e.update({message:"projecting points",current:He,max:z})]:[3,3]):[3,4];case 2:Ye.sent(),Ye.label=3;case 3:return He+=pe,[3,1];case 4:return[2]}})})}function c(He,Ye){var lt=N[He],Le=N[Ye],Qe=h[0]=O[Ye]-O[He],at=h[1]=D[Ye]-D[He],ot=h[2]=F[Ye]-F[He],dt=Qe*Qe+at*at+ot*ot,Oe=Math.sqrt(dt),Me=(lt*lt+Oe*Oe-Le*Le)/(2*lt*Oe),Ke=lt*Me;C.normalize(h,h),TPe(m,h),C.normalize(m,m),C.cross(g,h,m),C.normalize(g,g);var tt=Math.sqrt(lt*lt-Ke*Ke);C.scale(m,m,tt),C.scale(g,g,tt),C.scale(h,h,Ke),v[0]=h[0]+O[He],v[1]=h[1]+D[He],v[2]=h[2]+F[He],p=-1;for(var St=0;St<x;++St){var ht=ye[St],ut=be[St],fe=v[0]+ht*m[0]+ut*g[0],me=v[1]+ht*m[1]+ut*g[1],we=v[2]+ht*m[2]+ut*g[2];if(o(fe,me,we,He,Ye)===-1)for(var $e=Math.floor(S*(fe-q)),gt=Math.floor(S*(me-te)),Tt=Math.floor(S*(we-he)),Wt=Math.max(0,$e-_),lr=Math.max(0,gt-_),wr=Math.max(0,Tt-_),Yt=Math.min(U,$e+_+2),zn=Math.min(H,gt+_+2),_a=Math.min(J,Tt+_+2),wa=Wt;wa<Yt;++wa)for(var Ri=fe-oe[wa],ms=wa*ee,eu=lr;eu<zn;++eu)for(var Bo=me-R[eu],Mc=Ri*Ri+Bo*Bo,Dc=eu*X+ms,hi=wr;hi<_a;++hi){var Sl=we-V[hi],Zv=Mc+Sl*Sl,Rc=hi+Dc,Oc=xe[Rc];if(Oc>0&&Zv<Oc*Oc){xe[Rc]=Math.sqrt(Zv);var ri=Ri*h[0]+Bo*h[1]+Sl*h[2];ae[Rc]=G[ke.indexOf(M,ri<0?Ye:He)]}}}}function d(He,Ye){for(var lt=He;lt<Ye;++lt){var Le=ke.getAt(M,lt);T.find(O[Le],D[Le],F[Le],N[Le]);for(var Qe=0,at=I.count;Qe<at;++Qe){var ot=ke.getAt(M,I.indices[Qe]);Le<ot&&c(Le,ot)}}}function f(){return ce(this,void 0,void 0,function(){var He;return de(this,function(Ye){switch(Ye.label){case 0:He=0,Ye.label=1;case 1:return He<z?(d(He,Math.min(He+pe,z)),e.shouldUpdate?[4,e.update({message:"projecting torii",current:He,max:z})]:[3,3]):[3,4];case 2:Ye.sent(),Ye.label=3;case 3:return He+=pe,[3,1];case 4:return[2]}})})}var p,h,v,m,g,y,b,x,S,_,A,T,I,M,O,D,F,G,N,z,$,j,Z,q,te,he,W,K,U,H,J,X,Q,ee,le,ye,be,Ae,xe,ae,oe,R,V,pe,_e,Ee,Ve;return de(this,function(He){switch(He.label){case 0:return p=-1,h=C(),v=C(),m=C(),g=C(),y=i.resolution,b=i.probeRadius,x=i.probePositions,S=1/y,_=Math.max(5,2+Math.floor(b*S)),A=C.create(n,n,n),C.scale(A,A,2),T=Rd(t,r,A),I=T.result,a===null&&(a=T.boundary.box),M=t.indices,O=t.x,D=t.y,F=t.z,G=t.id,N=t.radius,z=ke.size(M),$=n+y,j=Xt.expand(Xt(),a,C.create($,$,$)),Z=j.min,q=Z[0],te=Z[1],he=Z[2],W=Xt.scale(Xt(),j,S),K=Xt.size(C(),W),C.ceil(K,K),U=K[0],H=K[1],J=K[2],X=J,Q=H,ee=X*Q,le=EPe(x),ye=le.cosTable,be=le.sinTable,Ae=Pr.Space(K,[0,1,2],Float32Array),xe=Ae.create(),ae=Ae.create(),xe.fill(-1001),ae.fill(-1),oe=Jf(U,q,y),R=Jf(H,te,y),V=Jf(J,he,y),pe=Math.ceil(1e5/(Math.pow(Math.pow(n,3),3)*S)),[4,l()];case 1:return He.sent(),[4,f()];case 2:return He.sent(),_e=Pr.create(Ae,xe),Ee=Pr.create(Ae,ae),Ve=ue.identity(),ue.fromScaling(Ve,C.create(y,y,y)),ue.setTranslation(Ve,j.min),[2,{field:_e,idField:Ee,transform:Ve,resolution:y}]}})})}function MPe(e,t,r){for(var n=r.probeRadius,a=y1(e,t,r),i=a.position,o=a.boundary,s=a.radius,u=i.indices,l=ke.size(u),c=new Float32Array(ke.end(u)),d=0,f=0;f<l;++f){var p=ke.getAt(u,f),h=s(p);d<h&&(d=h),c[p]=h+n}return{position:w(w({},i),{radius:c}),boundary:o,maxRadius:d}}function bN(e,t,r){var n=this,a=t.lookup3d.boundary.box,i=ef(a,r),o=MPe(e,t,i),s=o.position,u=o.boundary,l=o.maxRadius;return We.create("Molecular Surface",function(c){return ce(n,void 0,void 0,function(){return de(this,function(d){switch(d.label){case 0:return[4,DPe(c,s,u,l,a,i)];case 1:return[2,d.sent()]}})})})}function DPe(e,t,r,n,a,i){return ce(this,void 0,void 0,function(){return de(this,function(o){return[2,IPe(e,t,r,n,a,i)]})})}var SN=w(w(w(w({},Va),Bw),g1),sN);function RPe(e,t,r,n,a,i){return ce(this,void 0,void 0,function(){var o,s,u,l,c,d,f,p;return de(this,function(h){switch(h.label){case 0:return[4,bN(r,t,a).runInContext(e.runtime)];case 1:return o=h.sent(),s=o.transform,u=o.field,l=o.idField,c=o.resolution,d={isoLevel:a.probeRadius,scalarField:u,idField:l},[4,w1(d,i).runAsChild(e.runtime)];case 2:return f=h.sent(),Lt.transform(f,s),e.webgl&&!e.webgl.isWebGL2&&Lt.uniformTriangleGroup(f),p=Ne.expand(Ne(),t.boundary.sphere,a.probeRadius+Np(t)),f.setBoundingSphere(p),f.meta.resolution=c,[2,f]}})})}function OPe(e){return pi({defaultProps:E.getDefaultValues(SN),createGeometry:RPe,createLocationIterator:ei.fromGroup,getLoci:Js,eachLocation:Zs,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.probeRadius!==n.probeRadius&&(t.createGeometry=!0),r.probePositions!==n.probePositions&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0),r.smoothColors.name!==n.smoothColors.name?t.updateColor=!0:r.smoothColors.name==="on"&&n.smoothColors.name==="on"&&(r.smoothColors.params.resolutionFactor!==n.smoothColors.params.resolutionFactor&&(t.updateColor=!0),r.smoothColors.params.sampleStride!==n.smoothColors.params.sampleStride&&(t.updateColor=!0))},processValues:function(t,r,n,a,i){var o=r.meta,s=o.resolution,u=o.colorTexture,l=Qv(n,a,s,i);l&&(Fw(t,l.resolution,l.stride,l.webgl,u),r.meta.colorTexture=t.tColorGrid.ref.value)},dispose:function(t){var r;(r=t.meta.colorTexture)===null||r===void 0||r.destroy()}},e)}var xN=w(w(w(w({},L3),Bw),g1),{sizeFactor:E.Numeric(1.5,{min:0,max:10,step:.1})});function FPe(e,t,r,n,a,i){return ce(this,void 0,void 0,function(){var o,s,u,l,c,d,f;return de(this,function(p){switch(p.label){case 0:return[4,bN(r,t,a).runInContext(e.runtime)];case 1:return o=p.sent(),s=o.transform,u=o.field,l=o.idField,c={isoLevel:a.probeRadius,scalarField:u,idField:l},[4,iw(c,i).runAsChild(e.runtime)];case 2:return d=p.sent(),mn.transform(d,s),f=Ne.expand(Ne(),t.boundary.sphere,a.probeRadius+Np(t)),d.setBoundingSphere(f),[2,d]}})})}function kPe(e){return N3({defaultProps:E.getDefaultValues(xN),createGeometry:FPe,createLocationIterator:ei.fromGroup,getLoci:Js,eachLocation:Zs,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.probeRadius!==n.probeRadius&&(t.createGeometry=!0),r.probePositions!==n.probePositions&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0)}},e)}var CN={"molecular-surface-mesh":function(e,t){return Un("Molecular surface mesh",e,t,OPe)},"molecular-surface-wireframe":function(e,t){return Un("Molecular surface wireframe",e,t,kPe)}},_N=w(w(w({},SN),xN),{visuals:E.MultiSelect(["molecular-surface-mesh"],E.objectToOptions(CN))});function BPe(e,t){return E.clone(_N)}function LPe(e,t){return or.createMulti("Molecular Surface",e,t,da,CN)}var NPe={name:"molecular-surface",label:"Molecular Surface",description:"Displays a molecular surface.",factory:LPe,getParams:BPe,defaultValues:E.getDefaultValues(_N),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.elementCount>0}},wN=w(w({},Va),{sizeFactor:E.Numeric(1,{min:0,max:2,step:.1}),detail:E.Numeric(0,{min:0,max:3,step:1},At.CustomQualityParamInfo)});function UPe(e){return pi({defaultProps:E.getDefaultValues(wN),createGeometry:VPe,createLocationIterator:HPe,getLoci:GPe,eachLocation:qPe,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail}},e)}function zPe(e){if(ze.Traits.is(e.traits,1)||ze.Traits.is(e.traits,2))return!1;if(ze.isCoarse(e))return!0;if(e.elements.length===0)return!1;e.model.atomicHierarchy.derived.residue.moleculeType;var t=e.residueIndex[e.elements[0]],r=e.model.atomicHierarchy.derived.residue.moleculeType[t];return!(r===3||r===2)}function VPe(e,t,r,n,a,i){if(!zPe(t))return Lt.createEmpty(i);var o=a.detail,s=a.sizeFactor,u=256,l=_t.createState(u,u/2,i),c=t.principalAxes.boxAxes,d=c.origin,f=c.dirA,p=c.dirB,h=Qo.size(C(),c);C.scale(h,h,s/2);var v=C.create(h[2],h[1],h[0]);l.currentGroup=0,M3(l,d,f,p,v,o+1);var m=_t.getMesh(l),g=Ne.expand(Ne(),t.boundary.sphere,1*a.sizeFactor);return m.setBoundingSphere(g),m}function HPe(e){var t=e.group,r=e.structure,n=1,a=t.units.length,i=Ze.create(r),o=function(s,u){var l=t.units[u];return i.unit=l,i.element=l.elements[s],i};return pn(n,a,1,o)}function GPe(e,t,r){var n=e.objectId,a=e.instanceId;if(r===n){var i=t.structure,o=t.group,s=o.units[a],u=ke.ofBounds(0,s.elements.length);return Re(i,[{unit:s,indices:u}])}return Or}function qPe(e,t,r){var n=!1;if(!Re.is(e))return!1;var a=t.structure,i=t.group;if(!Xe.areEquivalent(e.structure,a))return!1;for(var o=i.elements.length,s=0,u=e.elements;s<u.length;s++){var l=u[s],c=i.unitIndexMap.get(l.unit.id);c!==void 0&&ke.size(l.indices)===o&&r(Ie.ofSingleton(c))&&(n=!0)}return n}var AN={"orientation-ellipsoid-mesh":function(e,t){return Un("Orientation ellipsoid mesh",e,t,UPe)}},PN=w(w({},wN),{visuals:E.MultiSelect(["orientation-ellipsoid-mesh"],E.objectToOptions(AN))});function jPe(e,t){return E.clone(PN)}function WPe(e,t){return or.createMulti("Orientation",e,t,da,AN)}var XPe={name:"orientation",label:"Orientation",description:"Displays orientation ellipsoids for polymer chains.",factory:WPe,getParams:jPe,defaultValues:E.getDefaultValues(PN),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.elementCount>0}},YPe=je.add3,KPe=je.add,n_;(function(e){function t(r,n,a){r===void 0&&(r=2048),n===void 0&&(n=1024);var i=je.create(Float32Array,3,n,a?a.centerBuffer.ref.value:r),o=je.create(Float32Array,1,n,a?a.groupBuffer.ref.value:r);return{add:function(s,u,l,c){YPe(i,s,u,l),KPe(o,c)},getPoints:function(){var s=je.compact(i,!0),u=je.compact(o,!0);return Ud.create(s,u,i.elementCount,a)}}}e.create=t})(n_||(n_={}));var TN=w(w({},Dme),{pointSizeAttenuation:E.Boolean(!0),ignoreHydrogens:E.Boolean(!1),traceOnly:E.Boolean(!1)});function $Pe(e,t,r,n,a,i){var o=r.child;if(o&&!o.unitMap.get(t.id))return Ud.createEmpty(i);var s=t.elements,u=s.length,l=n_.create(u,u/10,i),c=C(),d=t.conformation.invariantPosition,f=Ew(r,t,a);if(f)for(var p=0;p<u;++p)f(s[p])||(d(s[p],c),l.add(c[0],c[1],c[2],p));else for(var p=0;p<u;++p)d(s[p],c),l.add(c[0],c[1],c[2],p);var h=l.getPoints(),v=Ne.expand(Ne(),t.boundary.sphere,1*a.sizeFactor);return h.setBoundingSphere(v),h}function QPe(e){return Rme({defaultProps:E.getDefaultValues(TN),createGeometry:$Pe,createLocationIterator:ei.fromGroup,getLoci:Js,eachLocation:Zs,setUpdateState:function(t,r,n){t.createGeometry=r.ignoreHydrogens!==n.ignoreHydrogens||r.traceOnly!==n.traceOnly}},e)}var ZPe={"element-point":function(e,t){return Un("Points",e,t,QPe)}},EN=w({},TN);function JPe(e,t){return E.clone(EN)}function eTe(e,t){return or.createMulti("Point",e,t,da,ZPe)}var tTe={name:"point",label:"Point",description:"Displays elements (atoms, coarse spheres) as spheres.",factory:eTe,getParams:JPe,defaultValues:E.getDefaultValues(EN),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"physical"},isApplicable:function(e){return e.elementCount>0}},IN={sizeFactor:E.Numeric(.2,{min:0,max:10,step:.01}),detail:E.Numeric(0,{min:0,max:3,step:1},At.CustomQualityParamInfo),linearSegments:E.Numeric(8,{min:1,max:48,step:1},At.CustomQualityParamInfo),radialSegments:E.Numeric(16,{min:2,max:56,step:2},At.CustomQualityParamInfo)};E.getDefaultValues(IN);var xi=C();function rTe(e,t,r,n,a,i){var o=t.polymerElements.length;if(!o)return Lt.createEmpty(i);for(var s=a.sizeFactor,u=a.detail,l=a.linearSegments,c=a.radialSegments,d=l*c*o+(c+1)*o*2,f=_t.createState(d,d/10,i),p=Mw(l),h=p.curvePoints,v=p.normalVectors,m=p.binormalVectors,g=p.widthValues,y=p.heightValues,b=0,x=Iw(t,r,{ignoreSecondaryStructure:!0});x.hasNext;){var S=x.move();f.currentGroup=b;var _=$s(S.moleculeType),A=_?O1:R1;Dw(p,S,T8,A);var T=S.coarseBackboneFirst||S.first,I=S.coarseBackboneLast||S.last,M=n.size.size(S.centerPrev)*s,O=n.size.size(S.center)*s,D=n.size.size(S.centerNext)*s;JC(p,M,O,D,M,O,D,A);var F=l;if(S.initial){F=Math.max(Math.round(l*A),1);var G=l-F;h.copyWithin(0,G*3),m.copyWithin(0,G*3),v.copyWithin(0,G*3),g.copyWithin(0,G*3),y.copyWithin(0,G*3),C.fromArray(xi,h,3),C.normalize(xi,C.sub(xi,S.p2,xi)),C.scaleAndAdd(xi,S.p2,xi,O*dy),C.toArray(xi,h,0)}else S.final&&(F=Math.max(Math.round(l*(1-A)),1),C.fromArray(xi,h,F*3-3),C.normalize(xi,C.sub(xi,S.p2,xi)),C.scaleAndAdd(xi,S.p2,xi,O*dy),C.toArray(xi,h,F*3));S.initial===!0&&S.final===!0?la(f,S.p2,O*2,u):c===2?N0(f,h,v,m,F,g,y,0):c===4?r_(f,h,v,m,F,g,y,0,T,I):z8(f,h,v,m,F,c,g,y,T,I),++b}var N=_t.getMesh(f),z=Ne.expand(Ne(),t.boundary.sphere,1*a.sizeFactor);return N.setBoundingSphere(z),N}var MN=w(w({},Va),IN);function nTe(e){return pi({defaultProps:E.getDefaultValues(MN),createGeometry:rTe,createLocationIterator:el.fromGroup,getLoci:lf,eachLocation:cf,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail||r.linearSegments!==n.linearSegments||r.radialSegments!==n.radialSegments}},e)}var DN={"polymer-tube":function(e,t){return Un("Polymer tube mesh",e,t,nTe)},"polymer-gap":function(e,t){return Un("Polymer gap cylinder",e,t,Rw)}},RN=w(w(w({},MN),F1),{sizeFactor:E.Numeric(.2,{min:0,max:10,step:.01}),visuals:E.MultiSelect(["polymer-tube","polymer-gap"],E.objectToOptions(DN))});function aTe(e,t){var r=E.clone(RN),n=!1,a=!1;return t.units.forEach(function(i){!n&&ze.isAtomic(i)&&i.nucleotideElements.length&&(n=!0),!a&&i.gapElements.length&&(a=!0)}),r.visuals.defaultValue=["polymer-tube"],a&&r.visuals.defaultValue.push("polymer-gap"),r}function iTe(e,t){return or.createMulti("Putty",e,t,da,DN)}var oTe={name:"putty",label:"Putty",description:"Displays a tube smoothly following the trace atoms of polymers.",factory:iTe,getParams:aTe,defaultValues:E.getDefaultValues(RN),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"uncertainty"},isApplicable:function(e){return e.polymerResidueCount>0}},sTe={"element-sphere":function(e,t){return Un("Sphere mesh",e,t,h8)}},ON=w({},D1);function uTe(e,t){var r=E.clone(ON);return t.isCoarseGrained&&(r.sizeFactor.defaultValue=2),r}function lTe(e,t){return or.createMulti("Spacefill",e,t,da,sTe)}var cTe={name:"spacefill",label:"Spacefill",description:"Displays atomic/coarse elements as spheres.",factory:lTe,getParams:uTe,defaultValues:E.getDefaultValues(ON),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"physical"},isApplicable:function(e){return e.elementCount>0}},TS=kr.is;function dTe(e,t,r,n,a,i){if(!ze.isAtomic(t))return mn.createEmpty(i);var o=r.child,s=o==null?void 0:o.unitMap.get(t.id);if(o&&!s)return mn.createEmpty(i);var u=Ze.create(r,t),l=t.elements,c=t.bonds,d=c.edgeCount,f=c.a,p=c.b,h=c.edgeProps,v=c.offset,m=h.order,g=h.flags,y=a.sizeFactor,b=a.aromaticBonds;if(!d)return mn.createEmpty(i);var x=C(),S=t.conformation.invariantPosition,_=t.rings,A=_.elementRingIndices,T=_.elementAromaticRingIndices,I={linkCount:d*2,referencePosition:function(D){var F,G,N=f[D],z=p[D];N>z&&(F=[z,N],N=F[0],z=F[1]),v[N+1]-v[N]===1&&(G=[z,N],N=G[0],z=G[1]);for(var $=A.get(N),j=0,Z=v[N],q=v[N+1];Z<q;++Z){var te=p[Z];if(te!==z&&te!==N)if($){var he=A.get(te);if(!he)continue;var W=ag($,he);W>j&&(j=W,S(l[te],x))}else return S(l[te],x)}return j>0?x:null},position:function(D,F,G){S(l[f[G]],D),S(l[p[G]],F)},style:function(D){var F=m[D],G=g[D];if(TS(G,2)||TS(G,4))return 1;if(F===3)return 3;if(b){var N=f[D],z=p[D],$=T.get(N),j=T.get(z),Z=$&&j?ag($,j):0;if(Z||TS(G,16))return Z===2?6:5}return F===2?2:0},radius:function(D){u.element=l[f[D]];var F=n.size.size(u);u.element=l[p[D]];var G=n.size.size(u);return Math.min(F,G)*y},ignore:s8(r,t,a)},M=gB(e,I,a,i),O=Ne.expand(Ne(),(s!=null?s:t).boundary.sphere,1*y);return M.setBoundingSphere(O),M}var FN=w(w(w({},L3),_w),{includeParent:E.Boolean(!1)});function fTe(e){return N3({defaultProps:E.getDefaultValues(FN),createGeometry:dTe,createLocationIterator:wc.fromGroup,getLoci:ww,eachLocation:Aw,setUpdateState:function(t,r,n,a,i,o,s){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.dashCount!==n.dashCount||r.ignoreHydrogens!==n.ignoreHydrogens||!ci(r.includeTypes,n.includeTypes)||!ci(r.excludeTypes,n.excludeTypes)||r.aromaticBonds!==n.aromaticBonds;var u=o.group.units[0],l=s.group.units[0];ze.isAtomic(u)&&ze.isAtomic(l)&&(Ti.areEqual(u.bonds,l.bonds)||(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.updateSize=!0))}},e)}var ES=new Ht.ElementBondIterator;function HM(e,t,r,n){for(ES.setElement(t,r,n);ES.hasNext;){var a=ES.move();return a.otherUnit.conformation.position(a.otherUnit.elements[a.otherIndex],e),e}return null}function pTe(e,t,r,n,a){var i=t.interUnitBonds,o=i.edgeCount,s=i.edges,u=n.sizeFactor,l=n.aromaticBonds;if(!o)return mn.createEmpty(a);var c=C(),d=Ze.create(),f={linkCount:o,referencePosition:function(m){var g=s[m],y,b,x,S;if(g.unitA<g.unitB)y=t.unitMap.get(g.unitA),b=t.unitMap.get(g.unitB),x=g.indexA,S=g.indexB;else if(g.unitA>g.unitB)y=t.unitMap.get(g.unitB),b=t.unitMap.get(g.unitA),x=g.indexB,S=g.indexA;else throw new Error("same units in createInterUnitBondLines");return HM(c,t,y,x)||HM(c,t,b,S)},position:function(m,g,y){var b=s[y],x=t.unitMap.get(b.unitA),S=t.unitMap.get(b.unitB);x.conformation.position(x.elements[b.indexA],m),S.conformation.position(S.elements[b.indexB],g)},style:function(m){var g=s[m].props.order,y=ka.create(s[m].props.flag);return kr.is(y,2)||kr.is(y,4)?1:g===3?3:l&&kr.is(y,16)?5:g===2?2:0},radius:function(m){var g=s[m];d.structure=t,d.unit=t.unitMap.get(g.unitA),d.element=d.unit.elements[g.indexA];var y=r.size.size(d);d.unit=t.unitMap.get(g.unitB),d.element=d.unit.elements[g.indexB];var b=r.size.size(d);return Math.min(y,b)*u},ignore:u8(t,n)},p=gB(e,f,n,a),h=t.child,v=Ne.expand(Ne(),(h!=null?h:t).boundary.sphere,1*n.sizeFactor);return p.setBoundingSphere(v),p}var kN=w(w(w({},Cme),_w),{includeParent:E.Boolean(!1)});function hTe(e){return _me({defaultProps:E.getDefaultValues(kN),createGeometry:pTe,createLocationIterator:wc.fromStructure,getLoci:Pw,eachLocation:Tw,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.dashCount!==n.dashCount||r.ignoreHydrogens!==n.ignoreHydrogens||!ci(r.includeTypes,n.includeTypes)||!ci(r.excludeTypes,n.excludeTypes)}},e)}var BN={"intra-bond":function(e,t){return Un("Intra-unit bond line",e,t,fTe)},"inter-bond":function(e,t){return as("Inter-unit bond line",e,t,hTe)}},LN=w(w(w({},FN),kN),{includeParent:E.Boolean(!1),sizeFactor:E.Numeric(1.5,{min:.01,max:10,step:.01}),unitKinds:Nv(["atomic"]),visuals:E.MultiSelect(["intra-bond","inter-bond"],E.objectToOptions(BN))});function vTe(e,t){return E.clone(LN)}function mTe(e,t){return or.createMulti("Line",e,t,da,BN)}var gTe={name:"line",label:"Line",description:"Displays bonds as lines.",factory:mTe,getParams:vTe,defaultValues:E.getDefaultValues(LN),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.elementCount>0},getData:function(e,t){return t.includeParent?e.asParent():e},mustRecreate:function(e,t){return e.includeParent!==t.includeParent}};function yTe(e,t,r,n,a){return ce(this,void 0,void 0,function(){var i,o,s,u,l,c,d,f,p,h,v,m,g;return de(this,function(y){switch(y.label){case 0:if(i=e.runtime,o=e.webgl,!o||!o.extensions.blendMinMax)throw new Error("GaussianDensityVolume requires `webgl` and `blendMinMax` extension");return s=a?a.gridTexture.ref.value:void 0,[4,V4e(t,n,o,s).runInContext(i)];case 1:return u=y.sent(),l=u.transform,c=u.texture,d=u.bbox,f=u.gridDim,p={min:0,max:1,mean:.04,sigma:.01},h=ue.mul(ue(),l,ue.fromScaling(ue(),f)),v=ue.getScaling(C(),l),m=di.create(d,f,l,h,v,c,p,!0,a),g=Ne.expand(Ne(),t.boundary.sphere,n.radiusOffset+b1(t)),m.setBoundingSphere(g),[2,m]}})})}var NN=w(w(w({},Pme),$v),{ignoreHydrogens:E.Boolean(!1)});function bTe(e){return Tme({defaultProps:E.getDefaultValues(NN),createGeometry:yTe,createLocationIterator:ei.fromStructure,getLoci:M1,eachLocation:I1,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0)},dispose:function(t){t.gridTexture.ref.value.destroy()}},e)}function STe(e,t,r,n,a,i){return ce(this,void 0,void 0,function(){var o,s,u,l,c,d,f,p,h,v,m,g,y;return de(this,function(b){switch(b.label){case 0:if(o=e.runtime,s=e.webgl,!s)throw new Error("GaussianDensityVolume requires `webgl`");return u=i?i.gridTexture.ref.value:void 0,[4,N4e(r,t,a,s,u).runInContext(o)];case 1:return l=b.sent(),c=l.transform,d=l.texture,f=l.bbox,p=l.gridDim,h={min:0,max:1,mean:.04,sigma:.01},v=ue.mul(ue(),c,ue.fromScaling(ue(),p)),m=ue.getScaling(C(),c),g=di.create(f,p,c,v,m,d,h,!0,i),y=Ne.expand(Ne(),t.boundary.sphere,a.radiusOffset+Np(t)),g.setBoundingSphere(y),[2,g]}})})}var xTe=w(w(w({},Ome),$v),{ignoreHydrogens:E.Boolean(!1)});function CTe(e){return Fme({defaultProps:E.getDefaultValues(xTe),createGeometry:STe,createLocationIterator:ei.fromGroup,getLoci:Js,eachLocation:Zs,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0)},dispose:function(t){t.gridTexture.ref.value.destroy()}},e)}var UN={"gaussian-volume":function(e,t){return as("Gaussian volume",e,t,bTe)},"units-gaussian-volume":function(e,t){return Un("Units-Gaussian volume",e,t,CTe)}},zN=w(w({},NN),{visuals:E.MultiSelect(["gaussian-volume"],E.objectToOptions(UN))});function _Te(e,t){var r=E.clone(zN);return r.renderMode=di.createRenderModeParam({min:0,max:1,mean:.04,sigma:.01}),r.jumpLength=E.Numeric(4,{min:0,max:20,step:.1}),r}function wTe(e,t){return or.createMulti("Gaussian Volume",e,t,da,UN)}var ATe={name:"gaussian-volume",label:"Gaussian Volume",description:"Displays a gaussian molecular density using direct volume rendering.",factory:wTe,getParams:_Te,defaultValues:E.getDefaultValues(zN),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.elementCount>0}},PTe=C.scale,TTe=C.add,ETe=C.sub,Lw=w(w(w({},Va),nB),{sizeFactor:E.Numeric(.3,{min:0,max:10,step:.01}),radialSegments:E.Numeric(16,{min:2,max:56,step:2},At.CustomQualityParamInfo),tryUseImpostor:E.Boolean(!0)});function ITe(e,t,r,n){return r.tryUseImpostor&&n&&n.extensions.fragDepth?DTe(e):OTe(e)}function MTe(e,t,r,n,a,i){var o=t.polymerElements.length;if(!o)return Wi.createEmpty(i);var s=o*2,u=Wg.create(s,s/4,i),l=t.conformation.invariantPosition,c=C(),d=C(),f=C(),p=function(m,g,y,b,x){l(m,c),l(g,d);var S=$s(x),_=S?O1:R1;TTe(f,c,PTe(f,ETe(f,d,c),_)),u.add(c[0],c[1],c[2],f[0],f[1],f[2],1,!1,!1,y),u.add(f[0],f[1],f[2],d[0],d[1],d[2],1,!1,!1,b)};_8(t,p);var h=u.getCylinders(),v=Ne.expand(Ne(),t.boundary.sphere,1*a.sizeFactor);return h.setBoundingSphere(v),h}function DTe(e){return aB({defaultProps:E.getDefaultValues(Lw),createGeometry:MTe,createLocationIterator:el.fromGroup,getLoci:lf,eachLocation:cf,setUpdateState:function(t,r,n){},mustRecreate:function(t,r,n){return!r.tryUseImpostor||!n}},e)}function RTe(e,t,r,n,a,i){var o=t.polymerElements.length;if(!o)return Lt.createEmpty(i);var s=a.radialSegments,u=a.sizeFactor,l=s*2*o*2,c=_t.createState(l,l/10,i),d=t.conformation.invariantPosition,f=C(),p=C(),h={radiusTop:1,radiusBottom:1,radialSegments:s},v=Ze.create(r,t),m=Ze.create(r,t),g=function(x,S,_,A,T){v.element=x,m.element=S,d(v.element,f),d(m.element,p);var I=$s(T),M=I?O1:R1;h.radiusTop=h.radiusBottom=n.size.size(v)*u,c.currentGroup=_,$a(c,f,p,M,h),h.radiusTop=h.radiusBottom=n.size.size(m)*u,c.currentGroup=A,$a(c,p,f,1-M,h)};_8(t,g);var y=_t.getMesh(c),b=Ne.expand(Ne(),t.boundary.sphere,1*a.sizeFactor);return y.setBoundingSphere(b),y}function OTe(e){return pi({defaultProps:E.getDefaultValues(Lw),createGeometry:RTe,createLocationIterator:el.fromGroup,getLoci:lf,eachLocation:cf,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.radialSegments!==n.radialSegments},mustRecreate:function(t,r,n){return r.tryUseImpostor&&!!n}},e)}var Nw=w(w(w({},Va),tB),{sizeFactor:E.Numeric(.3,{min:0,max:10,step:.01}),detail:E.Numeric(0,{min:0,max:3,step:1},At.CustomQualityParamInfo),tryUseImpostor:E.Boolean(!0)});function FTe(e,t,r,n){return r.tryUseImpostor&&n&&n.extensions.fragDepth?BTe(e):NTe(e)}function kTe(e,t,r,n,a,i){var o=t.polymerElements.length;if(!o)return xc.createEmpty(i);var s=cy.create(o,o/2,i),u=t.conformation.invariantPosition,l=C(),c=function(p,h){u(p,l),s.add(l[0],l[1],l[2],h)};w8(t,c);var d=s.getSpheres(),f=Ne.expand(Ne(),t.boundary.sphere,1*a.sizeFactor);return d.setBoundingSphere(f),d}function BTe(e){return rB({defaultProps:E.getDefaultValues(Nw),createGeometry:kTe,createLocationIterator:el.fromGroup,getLoci:lf,eachLocation:cf,setUpdateState:function(t,r,n){},mustRecreate:function(t,r,n){return!r.tryUseImpostor||!n}},e)}function LTe(e,t,r,n,a,i){var o=t.polymerElements.length;if(!o)return Lt.createEmpty(i);var s=a.detail,u=a.sizeFactor,l=o*e1(s),c=_t.createState(l,l/2,i),d=t.conformation.invariantPosition,f=C(),p=Ze.create(r,t),h=function(g,y){p.element=g,d(p.element,f),c.currentGroup=y,la(c,f,n.size.size(p)*u,s)};w8(t,h);var v=_t.getMesh(c),m=Ne.expand(Ne(),t.boundary.sphere,1*a.sizeFactor);return v.setBoundingSphere(m),v}function NTe(e){return pi({defaultProps:E.getDefaultValues(Nw),createGeometry:LTe,createLocationIterator:el.fromGroup,getLoci:lf,eachLocation:cf,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail},mustRecreate:function(t,r,n){return r.tryUseImpostor&&!!n}},e)}var VN={"polymer-backbone-cylinder":function(e,t){return Un("Polymer backbone cylinder",e,t,ITe)},"polymer-backbone-sphere":function(e,t){return Un("Polymer backbone sphere",e,t,FTe)},"polymer-gap":function(e,t){return Un("Polymer gap cylinder",e,t,Rw)}},HN=w(w(w(w({},Nw),Lw),F1),{sizeAspectRatio:E.Numeric(1,{min:.1,max:3,step:.1}),visuals:E.MultiSelect(["polymer-backbone-cylinder","polymer-backbone-sphere","polymer-gap"],E.objectToOptions(VN))});function UTe(e,t){var r=E.clone(HN),n=!1;return t.units.forEach(function(a){!n&&a.gapElements.length&&(n=!0)}),r.visuals.defaultValue=["polymer-backbone-cylinder","polymer-backbone-sphere"],n&&r.visuals.defaultValue.push("polymer-gap"),r}function zTe(e,t){return or.createMulti("Backbone",e,t,da,VN)}var VTe={name:"backbone",label:"Backbone",description:"Displays polymer backbone with cylinders and spheres.",factory:zTe,getParams:UTe,defaultValues:E.getDefaultValues(HN),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.polymerResidueCount>0}},a_=function(e){Be(t,e);function t(){var r=e.call(this)||this;return cs(t.BuiltIn,function(n,a){if(n.name!==a)throw new Error("Fix BuiltInStructureRepresentations to have matching names. "+n.name+" "+a);r.add(n)}),r}return t}(xk);(function(e){e.BuiltIn={cartoon:_4e,backbone:VTe,"ball-and-stick":Mwe,carbohydrate:pAe,ellipsoid:E4e,"gaussian-surface":yPe,"gaussian-volume":ATe,label:PPe,line:gTe,"molecular-surface":NPe,orientation:XPe,point:tTe,putty:oTe,spacefill:cTe}})(a_||(a_={}));var HTe=function(){function e(t){var r=this;this.plugin=t,this.currentFrame=void 0,this._isAnimating=!1,this.frame=function(){r.tick(xn()),r._isAnimating&&(r.currentFrame=requestAnimationFrame(r.frame))}}return Object.defineProperty(e.prototype,"isAnimating",{get:function(){return this._isAnimating},enumerable:!1,configurable:!0}),e.prototype.tick=function(t,r){var n;return ce(this,void 0,void 0,function(){return de(this,function(a){switch(a.label){case 0:return[4,this.plugin.managers.animation.tick(t,r==null?void 0:r.isSynchronous)];case 1:return a.sent(),(n=this.plugin.canvas3d)===null||n===void 0||n.tick(t,r),[2]}})})},e.prototype.resetTime=function(t){var r;t===void 0&&(t=xn()),(r=this.plugin.canvas3d)===null||r===void 0||r.resetTime(t)},e.prototype.start=function(t){var r;(r=this.plugin.canvas3d)===null||r===void 0||r.resume(),this._isAnimating=!0,this.resetTime(),t!=null&&t.immediate?this.frame():this.currentFrame=requestAnimationFrame(this.frame)},e.prototype.stop=function(t){var r;this._isAnimating=!1,this.currentFrame!==void 0&&(cancelAnimationFrame(this.currentFrame),this.currentFrame=void 0),t!=null&&t.noDraw&&((r=this.plugin.canvas3d)===null||r===void 0||r.pause(t==null?void 0:t.noDraw))},e}(),GTe=function(){function e(t){var r=this;this.plugin=t,this.ev=zu.create(),this.events={updated:this.ev(),removed:this.ev()},this.root=new Map,this.tracked=new Map,t.state.data.events.object.created.subscribe(function(n){r.addMapping(n.state,n.ref,n.obj)}),t.state.data.events.object.removed.subscribe(function(n){r.removeMapping(n.ref)&&r.events.removed.next({ref:n.ref,obj:n.obj})}),t.state.data.events.object.updated.subscribe(function(n){r.updateMapping(n.state,n.ref,n.oldObj,n.obj)&&r.events.updated.next({ref:n.ref,oldObj:n.oldObj,obj:n.obj})})}return e.prototype.getDecorator=function(t){var r=this.plugin.state.data.tree,n=r.children.get(t);if(n.size!==1)return t;var a=n.first();return r.transforms.get(a).transformer.definition.isDecorator?this.getDecorator(a):t},e.prototype.get=function(t,r){r===void 0&&(r=!1);var n=this.root.get(t);if(!!n)return r?this.plugin.state.data.cells.get(n.ref):this.plugin.state.data.cells.get(this.getDecorator(n.ref))},e.prototype.addMapping=function(t,r,n){if(!ge.Molecule.Structure.is(n))return!1;if(this.tracked.set(r,n.data),this.root.has(n.data)){var a=this.root.get(n.data);a.count++}else{var i=t.select(ar.Generators.byRef(r).rootOfType([ge.Molecule.Structure]))[0];i?this.root.set(n.data,{ref:i.transform.ref,count:1}):this.root.set(n.data,{ref:r,count:1})}return!0},e.prototype.removeMapping=function(t){if(!this.tracked.has(t))return!1;var r=this.tracked.get(t);this.tracked.delete(t);var n=this.root.get(r);return n.count>1?n.count--:this.root.delete(r),!0},e.prototype.updateMapping=function(t,r,n,a){return ge.Molecule.Structure.is(a)?(this.removeMapping(r),this.addMapping(t,r,a),!0):!1},e.prototype.dispose=function(){this.ev.dispose()},e}(),i_=function(){function e(){this.ev=zu.create(),this.id=0,this.runningTasks=new Set,this.abortRequests=new Map,this.options=new Map,this.currentContext=[],this.events={progress:this.ev(),finished:this.ev()}}return e.prototype.tryGetAbortTaskId=function(t){if(this.abortRequests.has(t.progress.taskId))return t.progress.taskId;for(var r=0,n=t.children;r<n.length;r++){var a=n[r],i=this.tryGetAbortTaskId(a);if(i!==void 0)return i}},e.prototype.track=function(t,r){var n=this;return function(a){var i;if(a.canAbort&&a.requestAbort){var o=n.tryGetAbortTaskId(a.root);o!==void 0&&a.requestAbort(n.abortRequests.get(o))}var s=xn()-a.root.progress.startedTime;n.events.progress.next({id:t,useOverlay:(i=n.options.get(r))===null||i===void 0?void 0:i.useOverlay,level:s<250?"none":"background",progress:a})}},e.prototype.run=function(t,r){return ce(this,void 0,void 0,function(){var n,a,i;return de(this,function(o){switch(o.label){case 0:n=this.id++,(r==null?void 0:r.createNewContext)||this.currentContext.length===0?a={ctx:zW(t,this.track(n,t.id),100),refCount:1}:(a=this.currentContext[this.currentContext.length-1],a.refCount++),o.label=1;case 1:return o.trys.push([1,,3,4]),this.options.set(t.id,{useOverlay:!!(r!=null&&r.useOverlay)}),this.runningTasks.add(t.id),[4,AR(a.ctx,t)];case 2:return i=o.sent(),[2,i];case 3:return this.options.delete(t.id),this.runningTasks.delete(t.id),this.events.finished.next({id:n}),this.abortRequests.delete(t.id),a.refCount--,a.refCount===0&&sv(this.currentContext,a),[7];case 4:return[2]}})})},e.prototype.requestAbortAll=function(t){var r=this;this.runningTasks.forEach(function(n){return r.abortRequests.set(n,t)})},e.prototype.requestAbort=function(t,r){var n=typeof t=="number"?t:t.root.progress.taskId;this.abortRequests.set(n,r)},e.prototype.dispose=function(){this.ev.dispose()},e}();(function(e){function t(n){return new Promise(function(a){return setTimeout(a,n)})}function r(n){var a=this;return We.create("Test",function(i){return ce(a,void 0,void 0,function(){var o;return de(this,function(s){switch(s.label){case 0:o=0,s.label=1;case 1:return o<n?[4,t(100+Math.random()*200)]:[3,5];case 2:return s.sent(),i.shouldUpdate?[4,i.update({message:"Step "+o,current:o,max:n,isIndeterminate:!1})]:[3,4];case 3:s.sent(),s.label=4;case 4:return o++,[3,1];case 5:return[2]}})})})}e.testTask=r})(i_||(i_={}));var qTe=function(e){Be(t,e);function t(r){var n=e.call(this,{entries:Nn.exports.OrderedMap()})||this;return n.events={changed:n.ev()},n.serialNumber=0,n.serialId=0,wt.Toast.Show.subscribe(r,function(a){return n.show(a)}),wt.Toast.Hide.subscribe(r,function(a){return n.hide(n.findByKey(a.key))}),n}return t.prototype.findByKey=function(r){return this.state.entries.find(function(n){return!!n&&n.key===r})},t.prototype.show=function(r){var n=this,a=this.state.entries,i=void 0,o=++this.serialId,s;r.key&&(i=this.findByKey(r.key))?(i.timeout!==void 0&&clearTimeout(i.timeout),s=i.serialNumber,a=a.remove(i.id)):s=++this.serialNumber,i={id:o,serialNumber:s,key:r.key,title:r.title,message:r.message,timeout:this.timeout(o,r.timeoutMs),hide:function(){return n.hideId(o)}},this.updateState({entries:a.set(o,i)})&&this.events.changed.next()},t.prototype.timeout=function(r,n){var a=this;if(n!==void 0)return n<0&&(n=500),setTimeout(function(){var i=a.state.entries.get(r);i.timeout=void 0,a.hide(i)},n)},t.prototype.hideId=function(r){this.hide(this.state.entries.get(r))},t.prototype.hide=function(r){!r||(r.timeout!==void 0&&clearTimeout(r.timeout),r.hide=void 0,this.updateState({entries:this.state.entries.delete(r.id)})&&this.events.changed.next())},t}(gl),jTe=function(e){Be(t,e);function t(r){var n=e.call(this)||this;return n.plugin=r,n._params=void 0,n.behaviors={values:n.ev.behavior({transparent:n.params.transparent.defaultValue,axes:{name:"off",params:{}},resolution:n.params.resolution.defaultValue}),cropParams:n.ev.behavior({auto:!0,relativePadding:.1}),relativeCrop:n.ev.behavior({x:0,y:0,width:1,height:1})},n.events={previewed:n.ev()},n.canvas=function(){var a=document.createElement("canvas");return a}(),n.previewCanvas=function(){var a=document.createElement("canvas");return a}(),n.previewData={image:{data:new Uint8ClampedArray(1),width:1,height:0},background:it(0),transparent:!1},n}return t.prototype.createParams=function(){var r=Math.min(this.plugin.canvas3d?this.plugin.canvas3d.webgl.maxRenderbufferSize:4096,4096);return{resolution:E.MappedStatic("viewport",{viewport:E.Group({}),hd:E.Group({}),"full-hd":E.Group({}),"ultra-hd":E.Group({}),custom:E.Group({width:E.Numeric(1920,{min:128,max:r,step:1}),height:E.Numeric(1080,{min:128,max:r,step:1})},{isFlat:!0})},{options:[["viewport","Viewport"],["hd","HD (1280 x 720)"],["full-hd","Full HD (1920 x 1080)"],["ultra-hd","Ultra HD (3840 x 2160)"],["custom","Custom"]]}),transparent:E.Boolean(!1),axes:x1.axes}},Object.defineProperty(t.prototype,"params",{get:function(){return this._params?this._params:this._params=this.createParams()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"values",{get:function(){return this.behaviors.values.value},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cropParams",{get:function(){return this.behaviors.cropParams.value},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"relativeCrop",{get:function(){return this.behaviors.relativeCrop.value},enumerable:!1,configurable:!0}),t.prototype.getCanvasSize=function(){var r,n;return{width:((r=this.plugin.canvas3d)===null||r===void 0?void 0:r.webgl.gl.drawingBufferWidth)||0,height:((n=this.plugin.canvas3d)===null||n===void 0?void 0:n.webgl.gl.drawingBufferHeight)||0}},t.prototype.getSize=function(){var r=this.values;switch(r.resolution.name){case"viewport":return this.getCanvasSize();case"hd":return{width:1280,height:720};case"full-hd":return{width:1920,height:1080};case"ultra-hd":return{width:3840,height:2160};default:return{width:r.resolution.params.width,height:r.resolution.params.height}}},t.prototype.createPass=function(r){var n=this.plugin.canvas3d,a=n.webgl.extensions,i=a.colorBufferFloat,o=a.textureFloat,s=this.plugin.canvas3d.props.postprocessing.occlusion;return this.plugin.canvas3d.getImagePass({transparentBackground:this.values.transparent,cameraHelper:{axes:this.values.axes},multiSample:{mode:r?"on":"off",sampleLevel:i&&o?4:2},postprocessing:w(w({},n.props.postprocessing),{occlusion:s.name==="on"?{name:"on",params:w(w({},s.params),{samples:128})}:s})})},Object.defineProperty(t.prototype,"previewPass",{get:function(){return this._previewPass||(this._previewPass=this.createPass(!1))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"imagePass",{get:function(){if(this._imagePass){var r=this.plugin.canvas3d.props.postprocessing.occlusion;return this._imagePass.setProps({cameraHelper:{axes:this.values.axes},transparentBackground:this.values.transparent,postprocessing:w(w({},this.plugin.canvas3d.props.postprocessing),{occlusion:r.name==="on"?{name:"on",params:w(w({},r.params),{samples:128})}:r})}),this._imagePass}return this._imagePass=this.createPass(!0)},enumerable:!1,configurable:!0}),t.prototype.getFilename=function(r){r===void 0&&(r=".png");var n=this.plugin.state.data.select(ar.Generators.rootsOfType(ge.Molecule.Model)).map(function(o){return o.obj.data}),a=new Set;n.forEach(function(o){return a.add(o.entryId.toUpperCase())});var i=jn.toArray(a).join("-");return""+(i||"molstar-image")+r},t.prototype.resetCrop=function(){this.behaviors.relativeCrop.next({x:0,y:0,width:1,height:1})},t.prototype.toggleAutocrop=function(){this.cropParams.auto?(this.behaviors.cropParams.next(w(w({},this.cropParams),{auto:!1})),this.resetCrop()):this.behaviors.cropParams.next(w(w({},this.cropParams),{auto:!0}))},Object.defineProperty(t.prototype,"isFullFrame",{get:function(){var r=this.relativeCrop;return cn(r.x,0,1e-5)&&cn(r.y,0,1e-5)&&cn(r.width,1,1e-5)&&cn(r.height,1,1e-5)},enumerable:!1,configurable:!0}),t.prototype.autocrop=function(r){r===void 0&&(r=this.cropParams.relativePadding);for(var n=this.previewData.image,a=n.data,i=n.width,o=n.height,s=this.previewData.transparent,u=s?this.previewData.background:4278190080|this.previewData.background,l=i,c=0,d=o,f=0,p=0;p<o;p++)for(var h=p*i,v=0;v<i;v++){var m=4*(h+v);if(s){if(a[m+3]===0)continue}else{var g=a[m]<<16|a[m+1]<<8|a[m+2]|a[m+3]<<24;if(g===u)continue}v<l&&(l=v),v>c&&(c=v),p<d&&(d=p),p>f&&(f=p)}if(l>c){var y=l;l=c,c=y}if(d>f){var y=d;d=f,f=y}var b=c-l+1,x=f-d+1;l-=r*b,c+=r*b,d-=r*x,f+=r*x;var S={x:Math.max(0,l/i),y:Math.max(0,d/o),width:Math.min(1,(c-l+1)/i),height:Math.min(1,(f-d+1)/o)};this.behaviors.relativeCrop.next(S)},t.prototype.getPreview=function(r){r===void 0&&(r=320);var n=this.getSize(),a=n.width,i=n.height;if(!(a<=0||i<=0)){var o=a/i,s=0,u=0;o>1?(s=r,u=Math.round(r/o)):(u=r,s=Math.round(r*o));var l=this.plugin.canvas3d.props;this.previewPass.setProps({cameraHelper:{axes:this.values.axes},transparentBackground:this.values.transparent,postprocessing:l.postprocessing});var c=this.previewPass.getImageData(s,u),d=this.previewCanvas;d.width=c.width,d.height=c.height,this.previewData.image=c,this.previewData.background=l.renderer.backgroundColor,this.previewData.transparent=this.values.transparent;var f=d.getContext("2d");if(!f)throw new Error("Could not create canvas 2d context");return f.putImageData(c,0,0),this.cropParams.auto&&this.autocrop(),this.events.previewed.next(),{canvas:d,width:s,height:u}}},t.prototype.getSizeAndViewport=function(){var r=this.getSize(),n=r.width,a=r.height,i=this.relativeCrop,o={x:Math.floor(i.x*n),y:Math.floor(i.y*a),width:Math.ceil(i.width*n),height:Math.ceil(i.height*a)};return o.width+o.x>n&&(o.width=n-o.x),o.height+o.y>a&&(o.height=a-o.y),{width:n,height:a,viewport:o}},t.prototype.draw=function(r){return ce(this,void 0,void 0,function(){var n,a,i,o,s,u,l;return de(this,function(c){switch(c.label){case 0:return n=this.getSizeAndViewport(),a=n.width,i=n.height,o=n.viewport,a<=0||i<=0?[2]:[4,r.update("Rendering image...")];case 1:return c.sent(),s=this.imagePass.getImageData(a,i,o),[4,r.update("Encoding image...")];case 2:if(c.sent(),u=this.canvas,u.width=s.width,u.height=s.height,l=u.getContext("2d"),!l)throw new Error("Could not create canvas 2d context");return l.putImageData(s,0,0),[2]}})})},t.prototype.copyToClipboardTask=function(){var r=this,n=navigator.clipboard;if(!(n!=null&&n.write)){this.plugin.log.error("clipboard.write not supported!");return}return We.create("Copy Image",function(a){return ce(r,void 0,void 0,function(){var i,o;return de(this,function(s){switch(s.label){case 0:return[4,this.draw(a)];case 1:return s.sent(),[4,a.update("Converting image...")];case 2:return s.sent(),[4,oM(this.canvas,"png")];case 3:return i=s.sent(),o=new ClipboardItem({"image/png":i}),[4,n.write([o])];case 4:return s.sent(),this.plugin.log.message("Image copied to clipboard."),[2]}})})})},t.prototype.getImageDataUri=function(){var r=this;return this.plugin.runTask(We.create("Generate Image",function(n){return ce(r,void 0,void 0,function(){return de(this,function(a){switch(a.label){case 0:return[4,this.draw(n)];case 1:return a.sent(),[4,n.update("Converting image...")];case 2:return a.sent(),[2,this.canvas.toDataURL("png")]}})})}))},t.prototype.copyToClipboard=function(){var r=this.copyToClipboardTask();if(!!r)return this.plugin.runTask(r)},t.prototype.downloadTask=function(r){var n=this;return We.create("Download Image",function(a){return ce(n,void 0,void 0,function(){var i;return de(this,function(o){switch(o.label){case 0:return[4,this.draw(a)];case 1:return o.sent(),[4,a.update("Downloading image...")];case 2:return o.sent(),[4,oM(this.canvas,"png")];case 3:return i=o.sent(),AB(i,r!=null?r:this.getFilename()),[2]}})})})},t.prototype.download=function(r){this.plugin.runTask(this.downloadTask(r))},t}(Vv),WTe=function(){function e(t){var r=this;this.spec=t,this.runTask=function(n,a){return r.managers.task.run(n,a)},this.resolveTask=function(n){if(!!n)return We.is(n)?r.runTask(n):n},this.subs=[],this.disposed=!1,this.ev=zu.create(),this.config=new ume(this.spec.config),this.state=new sy(this),this.commands=new hye,this.canvas3dInit=this.ev.behavior(!1),this.behaviors={state:{isAnimating:this.ev.behavior(!1),isUpdating:this.ev.behavior(!1),isBusy:this.ev.behavior(!1)},interaction:{hover:this.ev.behavior({current:or.Loci.Empty,modifiers:is.None,buttons:0,button:0}),click:this.ev.behavior({current:or.Loci.Empty,modifiers:is.None,buttons:0,button:0}),drag:this.ev.behavior({current:or.Loci.Empty,modifiers:is.None,buttons:0,button:0,pageStart:Ge(),pageEnd:Ge()}),selectionMode:this.ev.behavior(!1)},labels:{highlight:this.ev.behavior({labels:[]})},layout:{leftPanelTabName:this.ev.behavior("root")},canvas3d:{initialized:this.canvas3dInit.pipe(Ly(function(n){return!!n}),L_e(1))}},this.layout=new pwe(this),this.animationLoop=new HTe(this),this.representation={structure:{registry:new a_,themes:{colorThemeRegistry:Wu.createRegistry(),sizeThemeRegistry:ba.createRegistry()}},volume:{registry:new iy,themes:{colorThemeRegistry:Wu.createRegistry(),sizeThemeRegistry:ba.createRegistry()}}},this.query={structure:{registry:new ome}},this.dataFormats=new J3e,this.builders={data:new I3e(this),structure:void 0},this.helpers={substructureParent:new GTe(this),viewportScreenshot:void 0},this.managers={structure:{hierarchy:new Pv(this),component:new Gd(this),measurement:new qSe(this),selection:new swe(this),focus:new iwe(this)},volume:{hierarchy:new ey(this)},interactivity:void 0,camera:new rwe(this),animation:new ewe(this),snapshot:new Yg(this),lociLabels:void 0,toast:new qTe(this),asset:new TX,task:new i_},this.events={log:this.ev(),task:this.managers.task.events,canvas3d:{settingsUpdated:this.ev()}},this.customModelProperties=new uy.Registry,this.customStructureProperties=new uy.Registry,this.customStructureControls=new Map,this.genericRepresentationControls=new Map,this.customState=Object.create(null),this.log={entries:Nn.exports.List(),entry:function(n){return r.events.log.next(n)},error:function(n){return r.events.log.next(Ns.error(n))},message:function(n){return r.events.log.next(Ns.message(n))},info:function(n){return r.events.log.next(Ns.info(n))},warn:function(n){return r.events.log.next(Ns.warning(n))}},this.fetch=cx,kY(!1)}return e.prototype.build=function(){return this.state.data.build()},e.prototype.initViewer=function(t,r,n){var a=this,i,o,s,u,l;try{if(this.layout.setRoot(r),this.spec.layout&&this.spec.layout.initial&&this.layout.setProps(this.spec.layout.initial),n)this.canvas3dContext=n;else{var c=!((i=this.config.get(jr.General.DisableAntialiasing))!==null&&i!==void 0&&i),d=!((o=this.config.get(jr.General.DisablePreserveDrawingBuffer))!==null&&o!==void 0&&o),f=this.config.get(jr.General.PixelScale)||1,p=this.config.get(jr.General.PickScale)||.25,h=this.config.get(jr.General.EnableWboit)||!1;this.canvas3dContext=UC.fromCanvas(t,{antialias:c,preserveDrawingBuffer:d,pixelScale:f,pickScale:p,enableWboit:h})}this.canvas3d=zC.create(this.canvas3dContext),this.canvas3dInit.next(!0);var v=this.spec.canvas3d,m=it(16579577);return v?(((u=v.renderer)===null||u===void 0?void 0:u.backgroundColor)===void 0&&(v=Vu(v,function(g){g.renderer?g.renderer.backgroundColor=m:g.renderer={backgroundColor:m}})),(l=this.canvas3d)===null||l===void 0||l.setProps(v)):(s=this.canvas3d)===null||s===void 0||s.setProps({renderer:{backgroundColor:m}}),this.animationLoop.start(),this.helpers.viewportScreenshot=new jTe(this),this.subs.push(this.canvas3d.interaction.click.subscribe(function(g){return a.behaviors.interaction.click.next(g)})),this.subs.push(this.canvas3d.interaction.drag.subscribe(function(g){return a.behaviors.interaction.drag.next(g)})),this.subs.push(this.canvas3d.interaction.hover.subscribe(function(g){return a.behaviors.interaction.hover.next(g)})),this.subs.push(this.canvas3d.input.resize.subscribe(function(){return a.handleResize()})),this.subs.push(this.layout.events.updated.subscribe(function(){return requestAnimationFrame(function(){return a.handleResize()})})),this.handleResize(),!0}catch(g){return this.log.error(""+g),console.error(g),!1}},e.prototype.handleResize=function(){var t,r,n=(t=this.canvas3dContext)===null||t===void 0?void 0:t.canvas,a=this.layout.root;if(a&&n){var i=this.config.get(jr.General.PixelScale)||1;A3e(n,a,i),(r=this.canvas3d)===null||r===void 0||r.requestResize()}},Object.defineProperty(e.prototype,"isBusy",{get:function(){return this.behaviors.state.isAnimating.value||this.behaviors.state.isUpdating.value},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"selectionMode",{get:function(){return this.behaviors.interaction.selectionMode.value},set:function(t){this.behaviors.interaction.selectionMode.next(t)},enumerable:!1,configurable:!0}),e.prototype.dataTransaction=function(t,r){return this.runTask(this.state.data.transaction(t,r))},e.prototype.clear=function(t){var r;return t===void 0&&(t=!1),t&&((r=this.canvas3d)===null||r===void 0||r.setProps(j3)),wt.State.RemoveObject(this,{state:this.state.data,ref:cr.RootRef})},e.prototype.dispose=function(t){var r,n;if(!this.disposed){for(var a=0,i=this.subs;a<i.length;a++){var o=i[a];o.unsubscribe()}this.subs=[],this.commands.dispose(),(r=this.canvas3d)===null||r===void 0||r.dispose(),(n=this.canvas3dContext)===null||n===void 0||n.dispose(t),this.ev.dispose(),this.state.dispose(),this.managers.task.dispose(),this.helpers.substructureParent.dispose(),cs(this.managers,function(s){var u,l;return(l=(u=s)===null||u===void 0?void 0:u.dispose)===null||l===void 0?void 0:l.call(u)}),cs(this.managers.structure,function(s){var u,l;return(l=(u=s)===null||u===void 0?void 0:u.dispose)===null||l===void 0?void 0:l.call(u)}),this.disposed=!0}},e.prototype.initBehaviorEvents=function(){var t=this;this.subs.push(xu(this.state.data.behaviors.isUpdating,this.state.behaviors.behaviors.isUpdating).subscribe(function(s){t.behaviors.state.isUpdating.value!==s&&t.behaviors.state.isUpdating.next(s)}));var r=this.config.get(jr.General.IsBusyTimeoutMs)||750,n=this.behaviors.state.isBusy,a=void 0,i=function(){n.value||n.next(!0)},o=function(){a!==void 0&&clearTimeout(a),a=void 0};this.subs.push(xu(this.behaviors.state.isUpdating,this.behaviors.state.isAnimating).subscribe(function(s){var u=t.behaviors.state.isUpdating.value,l=t.behaviors.state.isAnimating.value;u||l?n.value||(o(),a=setTimeout(i,r)):(o(),n.next(!1))})),this.subs.push(this.behaviors.interaction.selectionMode.subscribe(function(s){var u;s||(u=t.managers.interactivity)===null||u===void 0||u.lociSelects.deselectAll()}))},e.prototype.initBuiltInBehavior=function(){var t=this;$m.State.registerDefault(this),$m.Representation.registerDefault(this),$m.Camera.registerDefault(this),$m.Misc.registerDefault(this),this.subs.push(xu(this.state.data.events.log,this.state.behaviors.events.log).subscribe(function(r){return t.events.log.next(r)}))},e.prototype.initBehaviors=function(){return ce(this,void 0,void 0,function(){var t,r,n,l,a,i,u,l,o,s,u,l;return de(this,function(c){switch(c.label){case 0:for(t=this.state.behaviors.build(),r=0,n=Object.keys(Mr.Categories);r<n.length;r++)l=n[r],t.toRoot().apply(Mr.CreateCategory,{label:Mr.Categories[l]},{ref:l,state:{isLocked:!0}});for(a=0,i=this.spec.behaviors;a<i.length;a++)u=i[a],l=Mr.getCategoryId(u.transformer),l==="custom-props"&&t.to(Mr.getCategoryId(u.transformer)).apply(u.transformer,u.defaultParams,{ref:u.transformer.id});return[4,this.runTask(this.state.behaviors.updateTree(t,{doNotUpdateCurrent:!0,doNotLogTiming:!0}))];case 1:for(c.sent(),t=this.state.behaviors.build(),o=0,s=this.spec.behaviors;o<s.length;o++)u=s[o],l=Mr.getCategoryId(u.transformer),l!=="custom-props"&&t.to(Mr.getCategoryId(u.transformer)).apply(u.transformer,u.defaultParams,{ref:u.transformer.id});return[4,this.runTask(this.state.behaviors.updateTree(t,{doNotUpdateCurrent:!0,doNotLogTiming:!0}))];case 2:return c.sent(),[2]}})})},e.prototype.initCustomFormats=function(){if(!!this.spec.customFormats)for(var t=0,r=this.spec.customFormats;t<r.length;t++){var n=r[t];this.dataFormats.add(n[0],n[1])}},e.prototype.initAnimations=function(){if(!!this.spec.animations)for(var t=0,r=this.spec.animations;t<r.length;t++){var n=r[t];this.managers.animation.register(n)}},e.prototype.initDataActions=function(){if(!!this.spec.actions)for(var t=0,r=this.spec.actions;t<r.length;t++){var n=r[t];this.state.data.actions.add(n.action)}},e.prototype.init=function(){return ce(this,void 0,void 0,function(){var t=this;return de(this,function(r){switch(r.label){case 0:return this.subs.push(this.events.log.subscribe(function(n){return t.log.entries=t.log.entries.push(n)})),this.initCustomFormats(),this.initBehaviorEvents(),this.initBuiltInBehavior(),this.managers.interactivity=new Zg(this),this.managers.lociLabels=new nwe(this),this.builders.structure=new U3e(this),this.initAnimations(),this.initDataActions(),[4,this.initBehaviors()];case 1:return r.sent(),this.log.message("Mol* Plugin "+MC+" ["+cye.toLocaleString()+"]"),Pp||this.log.message("Development mode enabled"),Ir&&this.log.message("Debug mode enabled"),[2]}})})},e}(),XTe=function(e){Be(t,e);function t(r){var n=e.call(this,r)||this;return n.spec=r,n.customParamEditors=new Map,n.initCustomParamEditors(),n}return t.prototype.initCustomParamEditors=function(){if(!!this.spec.customParamEditors)for(var r=0,n=this.spec.customParamEditors;r<n.length;r++){var a=n[r],i=a[0],o=a[1];this.customParamEditors.set(i.id,o)}},t.prototype.dispose=function(r){e.prototype.dispose.call(this,r),this.layout.dispose()},t}(WTe),Ac;(function(e){function t(n){return n}e.create=t;function r(n,a){var i,o;if(a.customDurationMs)return a.customDurationMs;var s=(o=(i=a.definition).getDuration)===null||o===void 0?void 0:o.call(i,a.params,n);if((s==null?void 0:s.kind)==="fixed")return s.durationMs}e.getDuration=r})(Ac||(Ac={}));var YTe=Ac.create({name:"built-in.animate-assembly-unwind",display:{name:"Unwind Assembly"},isExportable:!0,params:function(e){for(var t=[["all","All"]],r=e.state.data.select(ar.Generators.rootsOfType(ge.Molecule.Structure)),n=0,a=r;n<a.length;n++){var i=a[n];t.push([i.transform.ref,i.obj.data.models[0].label])}return{durationInMs:E.Numeric(3e3,{min:100,max:1e4,step:100}),playOnce:E.Boolean(!1),target:E.Select(t[0][0],t)}},canApply:function(e){var t=e.state.data,r=cr.RootRef,n=t.select(ar.Generators.ofType(ge.Molecule.Structure.Representation3D,r));return{canApply:n.length>0}},getDuration:function(e){return{kind:"fixed",durationMs:e.durationInMs}},initialState:function(){return{t:0}},setup:function(e,t,r){for(var n=r.state.data,a=!e.target||e.target==="all"?cr.RootRef:e.target,i=n.select(ar.Generators.ofType(ge.Molecule.Structure.Representation3D,a)),o=n.build(),s=!1,u=0,l=i;u<l.length;u++){var c=l[u],d=n.select(ar.Generators.ofTransformer(rt.Representation.UnwindStructureAssemblyRepresentation3D,c.transform.ref));d.length>0||(s=!0,o.to(c).apply(rt.Representation.UnwindStructureAssemblyRepresentation3D,{t:0},{tags:"animate-assembly-unwind"}))}if(!!s)return o.commit({doNotUpdateCurrent:!0})},teardown:function(e,t,r){var n=r.state.data,a=n.select(ar.Generators.ofType(ge.Molecule.Structure.Representation3DState).withTag("animate-assembly-unwind"));if(a.length!==0){for(var i=n.build(),o=0,s=a;o<s.length;o++){var u=s[o];i.delete(u.transform.ref)}return i.commit()}},apply:function(e,t,r){return ce(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d,f;return de(this,function(p){switch(p.label){case 0:if(n=r.plugin.state.data,a=!r.params.target||r.params.target==="all"?cr.RootRef:r.params.target,i=n.select(ar.Generators.ofTransformer(rt.Representation.UnwindStructureAssemblyRepresentation3D,a)),i.length===0)return[2,{kind:"finished"}];for(o=n.build(),s=(t.current-t.lastApplied)/r.params.durationInMs,u=e.t+s,l=!1,r.params.playOnce&&u>=1?(l=!0,u=1):u=u%1,c=0,d=i;c<d.length;c++)f=d[c],o.to(f).update({t:u});return[4,wt.State.Update(r.plugin,{state:n,tree:o,options:{doNotLogTiming:!0}})];case 1:return p.sent(),l?[2,{kind:"finished"}]:[2,{kind:"next",state:{t:u}}]}})})}}),y0=C(),GM=C(),qM=In(),KTe=Ac.create({name:"built-in.animate-camera-spin",display:{name:"Camera Spin"},isExportable:!0,params:function(){return{durationInMs:E.Numeric(4e3,{min:100,max:2e4,step:100}),speed:E.Numeric(1,{min:1,max:10,step:1},{description:"How many times to spin in the specified dutation."}),direction:E.Select("cw",[["cw","Clockwise"],["ccw","Counter Clockwise"]],{cycle:!0})}},initialState:function(e,t){var r;return{snapshot:(r=t.canvas3d)===null||r===void 0?void 0:r.camera.getSnapshot()}},getDuration:function(e){return{kind:"fixed",durationMs:e.durationInMs}},teardown:function(e,t,r){var n;(n=r.canvas3d)===null||n===void 0||n.requestCameraReset({snapshot:t.snapshot,durationMs:0})},apply:function(e,t,r){var n,a;return ce(this,void 0,void 0,function(){var i,o,s,u;return de(this,function(l){return t.current===0?[2,{kind:"next",state:e}]:(i=e.snapshot,i.radiusMax<1e-4?[2,{kind:"finished"}]:(o=Ka(t.current/r.params.durationInMs,0,1),o>=.99999?((n=r.plugin.canvas3d)===null||n===void 0||n.requestCameraReset({snapshot:i,durationMs:0}),[2,{kind:"finished"}]):(s=2*Math.PI*o*r.params.speed*(r.params.direction==="ccw"?-1:1),C.sub(y0,i.position,i.target),C.normalize(GM,i.up),In.setAxisAngle(qM,GM,s),C.transformQuat(y0,y0,qM),u=C.add(C(),i.target,y0),(a=r.plugin.canvas3d)===null||a===void 0||a.requestCameraReset({snapshot:w(w({},i),{position:u}),durationMs:0}),[2,{kind:"next",state:e}])))})})}}),$Te=Ac.create({name:"built-in.animate-model-index",display:{name:"Animate Trajectory"},isExportable:!0,params:function(){return{mode:E.MappedStatic("loop",{palindrome:E.Group({}),loop:E.Group({direction:E.Select("forward",[["forward","Forward"],["backward","Backward"]])}),once:E.Group({direction:E.Select("forward",[["forward","Forward"],["backward","Backward"]])},{isFlat:!0})},{options:[["palindrome","Palindrome"],["loop","Loop"],["once","Once"]]}),duration:E.MappedStatic("fixed",{fixed:E.Group({durationInS:E.Numeric(5,{min:1,max:120,step:.1},{description:"Duration in seconds"})},{isFlat:!0}),computed:E.Group({targetFps:E.Numeric(30,{min:5,max:250,step:1},{label:"Target FPS"})},{isFlat:!0}),sequential:E.Group({maxFps:E.Numeric(30,{min:5,max:60,step:1})},{isFlat:!0})})}},canApply:function(e){for(var t=e.state.data,r=t.select(ar.Generators.ofTransformer(rt.Model.ModelFromTrajectory)),n=0,a=r;n<a.length;n++){var i=a[n],o=ar.findAncestorOfType(t.tree,t.cells,i.transform.ref,ge.Molecule.Trajectory);if(o&&o.obj&&o.obj.data.frameCount>1)return{canApply:!0}}return{canApply:!1,reason:"No trajectory to animate"}},getDuration:function(e,t){var r;if(((r=e.duration)===null||r===void 0?void 0:r.name)==="fixed")return{kind:"fixed",durationMs:e.duration.params.durationInS*1e3};if(e.duration.name==="computed"){for(var n=t.state.data,a=n.select(ar.Generators.ofTransformer(rt.Model.ModelFromTrajectory)),i=0,o=0,s=a;o<s.length;o++){var u=s[o],l=ar.findAncestorOfType(n.tree,n.cells,u.transform.ref,ge.Molecule.Trajectory);if(!(!l||!l.obj)){var c=l.obj;i=Math.max(Math.ceil(1e3*c.data.frameCount/e.duration.params.targetFps),i)}}return{kind:"fixed",durationMs:i}}return{kind:"unknown"}},initialState:function(){return{}},apply:function(e,t,r){return ce(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d,f,p;return de(this,function(h){switch(h.label){case 0:if(r.params.duration.name==="sequential"&&t.current>0&&t.current-t.lastApplied<1e3/r.params.duration.params.maxFps)return[2,{kind:"skip"}];if(n=r.plugin.state.data,a=n.select(ar.Generators.ofTransformer(rt.Model.ModelFromTrajectory)),a.length===0)return[2,{kind:"finished"}];for(i=n.build(),o=r.params,s=e.palindromeDirections||{},u=!1,l=!0,c=function(v){var m=ar.findAncestorOfType(n.tree,n.cells,v.transform.ref,ge.Molecule.Trajectory);if(!m||!m.obj)return"continue";var g=m.obj;if(g.data.frameCount<=1)return"continue";i.to(v).update(function(y){var b=g.data.frameCount;if(b!==1)l=!1;else return y;if(o.duration.name==="sequential"){var x=1;if(o.mode.name==="once"){if(x=o.mode.params.direction==="backward"?-1:1,x===-1&&y.modelIndex===0||x===1&&y.modelIndex===b-1)return u=!0,y}else o.mode.name==="palindrome"&&(y.modelIndex===0?x=1:y.modelIndex===b-1?x=-1:x=s[v.transform.ref]||1);s[v.transform.ref]=x;var S=(y.modelIndex+x)%b;return S<0&&(S+=b),u=u||x===-1&&S===0||x===1&&S===b-1,{modelIndex:S}}else{var _=o.duration.name==="fixed"?o.duration.params.durationInS*1e3:Math.ceil(1e3*g.data.frameCount/o.duration.params.targetFps),A=t.current%_/_;o.mode.name==="loop"&&o.mode.params.direction==="backward"&&(A=1-A),o.mode.name==="palindrome"&&(A=2*A,A>1&&(A=2-A));var S=Math.min(Math.floor(g.data.frameCount*A),g.data.frameCount-1);return u=u||S===g.data.frameCount-1,{modelIndex:S}}})},d=0,f=a;d<f.length;d++)p=f[d],c(p);return l?[3,2]:[4,wt.State.Update(r.plugin,{state:n,tree:i,options:{doNotLogTiming:!0}})];case 1:h.sent(),h.label=2;case 2:return l||o.mode.name==="once"&&u?[2,{kind:"finished"}]:o.mode.name==="palindrome"?[2,{kind:"next",state:{palindromeDirections:s}}]:[2,{kind:"next",state:{}}]}})})}});function jM(e,t,r){var n;return r===void 0&&(r=!1),ce(this,void 0,void 0,function(){return de(this,function(a){switch(a.label){case 0:return t.snapshot.data?[4,e.runTask(e.state.data.setSnapshot(t.snapshot.data))]:[3,2];case 1:a.sent(),a.label=2;case 2:return t.snapshot.camera&&((n=e.canvas3d)===null||n===void 0||n.requestCameraReset({snapshot:t.snapshot.camera.current,durationMs:r||t.snapshot.camera.transitionStyle==="instant"?0:t.snapshot.camera.transitionDurationInMs})),[2]}})})}var QTe=Ac.create({name:"built-in.animate-state-snapshots",display:{name:"State Snapshots"},isExportable:!0,params:function(){return{}},canApply:function(e){var t=e.managers.snapshot.state.entries;return t.size<2?{canApply:!1,reason:"At least 2 states required."}:t.some(function(r){return!!(r!=null&&r.snapshot.startAnimation)})?{canApply:!1,reason:"Nested animations not supported."}:{canApply:e.managers.snapshot.state.entries.size>1}},setup:function(e,t,r){var n=r.managers.snapshot.state.entries.get(0);jM(r,n,!0)},getDuration:function(e,t){return{kind:"fixed",durationMs:t.managers.snapshot.state.entries.toArray().reduce(function(r,n){var a;return r+((a=n.snapshot.durationInMs)!==null&&a!==void 0?a:0)},0)}},initialState:function(e,t){var r=t.managers.snapshot.state.entries.toArray();return{totalDuration:r.reduce(function(n,a){var i;return n+((i=a.snapshot.durationInMs)!==null&&i!==void 0?i:0)},0),snapshots:r,currentIndex:0}},apply:function(e,t,r){var n;return ce(this,void 0,void 0,function(){var a,i,o,s,u;return de(this,function(l){if(t.current>=e.totalDuration)return[2,{kind:"finished"}];for(a=0,i=0,o=0,s=e.snapshots;o<s.length&&(u=s[o],a+=(n=u.snapshot.durationInMs)!==null&&n!==void 0?n:0,!(t.current<a));o++)i++;return i>=e.snapshots.length?[2,{kind:"finished"}]:i===e.currentIndex?[2,{kind:"skip"}]:(jM(r.plugin,e.snapshots[i]),[2,{kind:"next",state:w(w({},e),{currentIndex:i})}])})})}}),ZTe=Ai.build({from:ge.Root,display:{name:"Download Density",description:"Load a density from the provided source and create its default visual."},params:function(e,t){var r=t.dataFormats.options;return{source:E.MappedStatic("pdb-xray",{"pdb-xray":E.Group({provider:E.Group({id:E.Text("1tqn",{label:"Id"}),server:E.Select("rcsb",[["pdbe","PDBe"],["rcsb","RCSB PDB"]])},{pivot:"id"}),type:E.Select("2fofc",[["2fofc","2Fo-Fc"],["fofc","Fo-Fc"]])},{isFlat:!0}),"pdb-xray-ds":E.Group({provider:E.Group({id:E.Text("1tqn",{label:"Id"}),server:E.Select("pdbe",[["pdbe","PDBe"],["rcsb","RCSB PDB"]])},{pivot:"id"}),detail:E.Numeric(3,{min:0,max:6,step:1},{label:"Detail"})},{isFlat:!0}),"pdb-emd-ds":E.Group({provider:E.Group({id:E.Text("emd-8004",{label:"Id"}),server:E.Select("pdbe",[["pdbe","PDBe"],["rcsb","RCSB PDB"]])},{pivot:"id"}),detail:E.Numeric(3,{min:0,max:6,step:1},{label:"Detail"})},{isFlat:!0}),url:E.Group({url:E.Url(""),isBinary:E.Boolean(!1),format:E.Select("auto",r)},{isFlat:!0})},{options:[["pdb-xray","PDB X-ray maps"],["pdb-emd-ds","PDB EMD Density Server"],["pdb-xray-ds","PDB X-ray Density Server"],["url","URL"]]})}}})(function(e,t){var r=e.params;return We.create("Download Density",function(n){return ce(void 0,void 0,void 0,function(){var a,i,o,s,u,l,c,d;return de(this,function(f){switch(f.label){case 0:switch(a=r.source,a.name){case"url":i=a.params;break;case"pdb-xray":i=a.params.provider.server==="pdbe"?{url:gn.Url(a.params.type==="2fofc"?"http://www.ebi.ac.uk/pdbe/coordinates/files/"+a.params.provider.id.toLowerCase()+".ccp4":"http://www.ebi.ac.uk/pdbe/coordinates/files/"+a.params.provider.id.toLowerCase()+"_diff.ccp4"),isBinary:!0,label:"PDBe X-ray map: "+a.params.provider.id}:{url:gn.Url(a.params.type==="2fofc"?"https://edmaps.rcsb.org/maps/"+a.params.provider.id.toLowerCase()+"_2fofc.dsn6":"https://edmaps.rcsb.org/maps/"+a.params.provider.id.toLowerCase()+"_fofc.dsn6"),isBinary:!0,label:"RCSB X-ray map: "+a.params.provider.id};break;case"pdb-emd-ds":i=a.params.provider.server==="pdbe"?{url:gn.Url("https://www.ebi.ac.uk/pdbe/densities/emd/"+a.params.provider.id.toLowerCase()+"/cell?detail="+a.params.detail),isBinary:!0,label:"PDBe EMD Density Server: "+a.params.provider.id}:{url:gn.Url("https://maps.rcsb.org/em/"+a.params.provider.id.toLowerCase()+"/cell?detail="+a.params.detail),isBinary:!0,label:"RCSB PDB EMD Density Server: "+a.params.provider.id};break;case"pdb-xray-ds":i=a.params.provider.server==="pdbe"?{url:gn.Url("https://www.ebi.ac.uk/pdbe/densities/x-ray/"+a.params.provider.id.toLowerCase()+"/cell?detail="+a.params.detail),isBinary:!0,label:"PDBe X-ray Density Server: "+a.params.provider.id}:{url:gn.Url("https://maps.rcsb.org/x-ray/"+a.params.provider.id.toLowerCase()+"/cell?detail="+a.params.detail),isBinary:!0,label:"RCSB PDB X-ray Density Server: "+a.params.provider.id};break;default:throw new Error(a.name+" not supported.")}return[4,t.builders.data.download(i)];case 1:switch(s=f.sent(),u=void 0,a.name){case"url":i=a.params,o=a.params.format==="auto"?t.dataFormats.auto(yw(gn.getUrl(i.url)),(c=s.cell)===null||c===void 0?void 0:c.obj):t.dataFormats.get(a.params.format);break;case"pdb-xray":u=a.params.provider.id,o=a.params.provider.server==="pdbe"?t.dataFormats.get("ccp4"):t.dataFormats.get("dsn6");break;case"pdb-emd-ds":case"pdb-xray-ds":u=a.params.provider.id,o=t.dataFormats.get("dscif");break;default:throw new Error(a.name+" not supported.")}return o?[4,o.parse(t,s,{entryId:u})]:(t.log.warn("DownloadDensity: Format provider not found."),[2]);case 2:return l=f.sent(),[4,(d=o.visuals)===null||d===void 0?void 0:d.call(o,t,l)];case 3:return f.sent(),[2]}})})})}),GN=Ai.build({display:{name:"Assign Volume Colors",description:"Assigns another volume to be available for coloring."},from:ge.Volume.Data,isApplicable:function(e){return!e.data.colorVolume},params:function(e,t){var r=t.state.data.select(ar.Generators.root.subtree().ofType(ge.Volume.Data).filter(function(n){var a;return!!n.obj&&!(!((a=n.obj)===null||a===void 0)&&a.data.colorVolume)&&n.obj!==e}));return r.length===0?{ref:E.Text("",{isHidden:!0,label:"Volume"})}:{ref:E.Select(r[0].transform.ref,r.map(function(n){return[n.transform.ref,n.obj.label]}),{label:"Volume"})}}})(function(e,t){var r=e.ref,n=e.params;return e.state,t.build().to(r).apply(rt.Volume.AssignColorVolume,{ref:n.ref},{dependsOn:[n.ref]}).commit()}),JTe=Object.freeze(Object.defineProperty({__proto__:null,DownloadDensity:ZTe,AssignColorVolume:GN},Symbol.toStringTag,{value:"Module"})),eEe=Ai.build({display:{name:"Open Files",description:"Load one or more files and optionally create default visuals"},from:ge.Root,params:function(e,t){var r=t.dataFormats,n=r.extensions,a=r.options;return{files:E.FileList({accept:Array.from(n.values()).map(function(i){return"."+i}).join(",")+",.gz,.zip",multiple:!0}),format:E.MappedStatic("auto",{auto:E.EmptyGroup(),specific:E.Select(a[0][0],a)}),visuals:E.Boolean(!0,{description:"Add default visuals"})}}})(function(e,t){var r=e.params,n=e.state;return We.create("Open Files",function(a){return ce(void 0,void 0,void 0,function(){return de(this,function(i){switch(i.label){case 0:return t.behaviors.layout.leftPanelTabName.next("data"),[4,n.transaction(function(){return ce(void 0,void 0,void 0,function(){var o,s,u,l,c,d,f,p,h,v,m;return de(this,function(g){switch(g.label){case 0:if(r.files===null)return t.log.error("No file(s) selected"),[2];o=0,s=r.files,g.label=1;case 1:if(!(o<s.length))return[3,9];u=s[o],g.label=2;case 2:return g.trys.push([2,7,,8]),l=yw(u.file),c=t.dataFormats.binaryExtensions.has(l.ext),[4,t.builders.data.readFile({file:u,isBinary:c})];case 3:return d=g.sent().data,f=r.format.name==="auto"?t.dataFormats.auto(l,(v=d.cell)===null||v===void 0?void 0:v.obj):t.dataFormats.get(r.format.params),f?[4,f.parse(t,d)]:(t.log.warn("OpenFiles: could not find data provider for '"+l.name+"."+l.ext+"'"),[3,8]);case 4:return p=g.sent(),r.visuals?[4,(m=f.visuals)===null||m===void 0?void 0:m.call(f,t,p)]:[3,6];case 5:g.sent(),g.label=6;case 6:return[3,8];case 7:return h=g.sent(),t.log.error(h),[3,8];case 8:return o++,[3,1];case 9:return[2]}})})}).runInContext(a)];case 1:return i.sent(),[2]}})})})}),tEe=Ai.build({display:{name:"Download File",description:"Load one or more file from an URL"},from:ge.Root,params:function(e,t){var r=t.dataFormats.options;return{url:E.Url(""),format:E.Select(r[0][0],r),isBinary:E.Boolean(!1),visuals:E.Boolean(!0,{description:"Add default visuals"})}}})(function(e,t){var r=e.params,n=e.state;return We.create("Open Files",function(a){return ce(void 0,void 0,void 0,function(){return de(this,function(i){switch(i.label){case 0:return t.behaviors.layout.leftPanelTabName.next("data"),[4,n.transaction(function(){return ce(void 0,void 0,void 0,function(){var o,s,u,l,c;return de(this,function(d){switch(d.label){case 0:return d.trys.push([0,5,,6]),o=t.dataFormats.get(r.format),o?[4,t.builders.data.download({url:r.url,isBinary:r.isBinary})]:(t.log.warn("DownloadFile: could not find data provider for '"+r.format+"'"),[2]);case 1:return s=d.sent(),[4,o.parse(t,s)];case 2:return u=d.sent(),r.visuals?[4,(c=o.visuals)===null||c===void 0?void 0:c.call(o,t,u)]:[3,4];case 3:d.sent(),d.label=4;case 4:return[3,6];case 5:return l=d.sent(),t.log.error(l),[3,6];case 6:return[2]}})})}).runInContext(a)];case 1:return i.sent(),[2]}})})})}),rEe=Object.freeze(Object.defineProperty({__proto__:null,OpenFiles:eEe,DownloadFile:tEe},Symbol.toStringTag,{value:"Module"})),Jc={Structure:E2e,Volume:JTe,DataFormat:rEe},nEe=Ac.create({name:"built-in.animate-state-interpolation",display:{name:"Animate State (experimental)"},params:function(){return{transtionDurationInMs:E.Numeric(2e3,{min:100,max:3e4,step:10})}},canApply:function(e){return{canApply:e.managers.snapshot.state.entries.size>1}},initialState:function(){return{}},apply:function(e,t,r){return ce(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d,f,p,h,v,m,g,y,b,x,S,_;return de(this,function(A){switch(A.label){case 0:if(n=r.plugin.managers.snapshot.state.entries,n.size<2)return[2,{kind:"finished"}];if(a=t.current%r.params.transtionDurationInMs/r.params.transtionDurationInMs,i=Math.floor(t.current/r.params.transtionDurationInMs)%n.size,o=Math.ceil(t.current/r.params.transtionDurationInMs),o===i&&o++,o=o%n.size,s=n.get(i).snapshot,u=n.get(o).snapshot,!s.data||!u.data)return[2,{kind:"skip"}];for(l=s.data.tree.transforms,c=u.data.tree.transforms,d=r.plugin.state.data,f=d.build(),p=0,h=l;p<h.length;p++)for(v=h[p],m=0,g=c;m<g.length;m++)y=g[m],y.ref===v.ref&&y.version!==v.version&&(b=cr.fromJSON(v),x=cr.fromJSON(y),S=d.cells.get(v.ref),S&&(_=void 0,b.transformer.definition.interpolate?_=b.transformer.definition.interpolate(b.params,x.params,a,r.plugin):_=a<=.5?b.params:x.params,Y0(S,_)||f.to(v.ref).update(_)));return[4,wt.State.Update(r.plugin,{state:d,tree:f,options:{doNotLogTiming:!0}})];case 1:return A.sent(),[2,{kind:"next",state:{}}]}})})}}),aEe=Ac.create({name:"built-in.animate-structure-spin",display:{name:"Spin Structure"},isExportable:!0,params:function(){return{durationInMs:E.Numeric(3e3,{min:100,max:1e4,step:100})}},initialState:function(){return{t:0}},getDuration:function(e){return{kind:"fixed",durationMs:e.durationInMs}},setup:function(e,t,r){return ce(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c;return de(this,function(d){for(n=r.state.data,a=n.select(ar.Generators.ofType(ge.Molecule.Structure.Representation3D)),i=n.build(),o=!1,s=0,u=a;s<u.length;s++)l=u[s],c=n.select(ar.Generators.ofTransformer(rt.Representation.SpinStructureRepresentation3D,l.transform.ref)),!(c.length>0)&&(o=!0,i.to(l.transform.ref).apply(rt.Representation.SpinStructureRepresentation3D,{t:0},{tags:"animate-structure-spin"}));return o?[2,i.commit({doNotUpdateCurrent:!0})]:[2]})})},teardown:function(e,t,r){var n=r.state.data,a=n.select(ar.Generators.ofType(ge.Molecule.Structure.Representation3DState).withTag("animate-structure-spin"));if(a.length!==0){for(var i=n.build(),o=0,s=a;o<s.length;o++){var u=s[o];i.delete(u.transform.ref)}return i.commit()}},apply:function(e,t,r){var n;return ce(this,void 0,void 0,function(){var a,i,o,s,u,l,c,d;return de(this,function(f){switch(f.label){case 0:if(a=r.plugin.state.data,i=a.select(ar.Generators.ofTransformer(rt.Representation.SpinStructureRepresentation3D)),i.length===0)return[2,{kind:"finished"}];for(o=a.build(),s=(t.current-t.lastApplied)/r.params.durationInMs,u=(e.t+s)%1,l=0,c=i;l<c.length;l++)d=c[l],o.to(d).update(w(w({},(n=d.params)===null||n===void 0?void 0:n.values),{t:u}));return[4,wt.State.Update(r.plugin,{state:a,tree:o,options:{doNotLogTiming:!0}})];case 1:return f.sent(),[2,{kind:"next",state:{t:u}}]}})})}}),Zt;(function(e){function t(n,a){return{action:n,customControl:a&&a.customControl,autoUpdate:a&&a.autoUpdate}}e.Action=t;function r(n,a){return a===void 0&&(a={}),{transformer:n,defaultParams:a}}e.Behavior=r})(Zt||(Zt={}));var iEe=function(){return{actions:[Zt.Action(Jc.Structure.DownloadStructure),Zt.Action(Jc.Structure.AddTrajectory),Zt.Action(Jc.Volume.DownloadDensity),Zt.Action(Jc.DataFormat.DownloadFile),Zt.Action(Jc.DataFormat.OpenFiles),Zt.Action(Jc.Structure.EnableModelCustomProps),Zt.Action(Jc.Structure.EnableStructureCustomProps),Zt.Action(XC),Zt.Action(qCe),Zt.Action(vw),Zt.Action(rt.Data.Download),Zt.Action(rt.Data.ParseCif),Zt.Action(rt.Data.ParseCcp4),Zt.Action(rt.Data.ParseDsn6),Zt.Action(rt.Model.TrajectoryFromMmCif),Zt.Action(rt.Model.TrajectoryFromCifCore),Zt.Action(rt.Model.TrajectoryFromPDB),Zt.Action(rt.Model.TransformStructureConformation),Zt.Action(rt.Model.StructureFromModel),Zt.Action(rt.Model.StructureFromTrajectory),Zt.Action(rt.Model.ModelFromTrajectory),Zt.Action(rt.Model.StructureSelectionFromScript),Zt.Action(rt.Representation.StructureRepresentation3D),Zt.Action(rt.Representation.StructureSelectionsDistance3D),Zt.Action(rt.Representation.StructureSelectionsAngle3D),Zt.Action(rt.Representation.StructureSelectionsDihedral3D),Zt.Action(rt.Representation.StructureSelectionsLabel3D),Zt.Action(rt.Representation.StructureSelectionsOrientation3D),Zt.Action(rt.Representation.ModelUnitcell3D),Zt.Action(rt.Representation.StructureBoundingBox3D),Zt.Action(rt.Representation.ExplodeStructureRepresentation3D),Zt.Action(rt.Representation.SpinStructureRepresentation3D),Zt.Action(rt.Representation.UnwindStructureAssemblyRepresentation3D),Zt.Action(rt.Representation.OverpaintStructureRepresentation3DFromScript),Zt.Action(rt.Representation.TransparencyStructureRepresentation3DFromScript),Zt.Action(GN),Zt.Action(rt.Volume.VolumeFromCcp4),Zt.Action(rt.Volume.VolumeFromDsn6),Zt.Action(rt.Volume.VolumeFromCube),Zt.Action(rt.Volume.VolumeFromDx),Zt.Action(rt.Representation.VolumeRepresentation3D)],behaviors:[Zt.Behavior(Ni.Representation.HighlightLoci),Zt.Behavior(Ni.Representation.SelectLoci),Zt.Behavior(Ni.Representation.DefaultLociLabelProvider),Zt.Behavior(Ni.Representation.FocusLoci),Zt.Behavior(Ni.Camera.FocusLoci),Zt.Behavior(Ni.Camera.CameraAxisHelper),Zt.Behavior(Y3),Zt.Behavior(Ni.CustomProps.StructureInfo),Zt.Behavior(Ni.CustomProps.AccessibleSurfaceArea),Zt.Behavior(Ni.CustomProps.BestDatabaseSequenceMapping),Zt.Behavior(Ni.CustomProps.Interactions),Zt.Behavior(Ni.CustomProps.SecondaryStructure),Zt.Behavior(Ni.CustomProps.ValenceModel),Zt.Behavior(Ni.CustomProps.CrossLinkRestraint)],animations:[$Te,KTe,QTe,YTe,aEe,nEe]}},oEe={color:E.Color(dr.black,{description:"Display color of the volume."}),wireframe:E.Boolean(!1,{description:"Control display of the volume as a wireframe."}),opacity:E.Numeric(.3,{min:0,max:1,step:.01},{description:"Opacity of the volume."})},sEe=new Map([["em",[-5,5]],["2fo-fc",[0,3]],["fo-fc(+ve)",[1,5]],["fo-fc(-ve)",[-5,-1]]]),b0=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.ref=ar.findTagInSubtree(r.plugin.state.data.tree,r.props.bCell.transform.ref,r.props.name),r.getVisible=function(){var n=r.plugin.state.data,a=r.ref;return a?!n.cells.get(a).state.isHidden:!1},r.toggleVisible=function(){var n=r.plugin.state.data,a=r.ref;!a||Vd(n,a,!n.cells.get(a).state.isHidden)},r}return t.prototype.componentDidUpdate=function(){this.ref=ar.findTagInSubtree(this.plugin.state.data.tree,this.props.bCell.transform.ref,this.props.name)},t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.data.events.cell.stateUpdated,function(n){r.ref===n.ref&&r.forceUpdate()})},t.prototype.render=function(){var r=this.props,n=r.isRelative,a=r.stats,i=r.channels[r.name],o=a.min,s=a.max,u=a.mean,l=a.sigma,c=Math.round(100*(i.isoValue.kind==="relative"?i.isoValue.relativeValue:i.isoValue.absoluteValue))/100,d=(o-u)/l,f=(s-u)/l;if(!this.props.isUnbounded){var p=sEe.get(this.props.name);this.props.name==="em"?(d=Math.max(p[0],d),f=Math.min(p[1],f)):(d=p[0],f=p[1])}var h=u+l*d,v=u+l*f,m=Px(n?Math.round((v-h)/l)/100:l/100,2),g=n?d:h,y=n?f:v;return L(RW,{label:r.label+(r.isRelative?" \u03C3":""),colorStripe:i.color,pivot:Te("div",w({className:"msp-volume-channel-inline-controls"},{children:[L(pL,{value:c,min:g,max:y,step:m,onChange:function(b){return r.changeIso(r.name,b,n)},disabled:r.params.isDisabled,onEnter:r.params.events.onEnter},void 0),L(Gt,{svg:this.getVisible()?Yd:Xd,onClick:this.toggleVisible,toggleState:!1,disabled:r.params.isDisabled},void 0)]}),void 0),controls:L(Pn,{onChange:function(b){var x=b.name,S=b.value;return r.changeParams(r.name,x,S)},params:oEe,values:i,onEnter:r.params.events.onEnter,isDisabled:r.params.isDisabled},void 0)},void 0)},t}(hr),uEe=function(e){Be(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.changeIso=function(n,a,i){var o,s=r.props.params;r.newParams(w(w({},s),{entry:{name:s.entry.name,params:w(w({},s.entry.params),{channels:w(w({},s.entry.params.channels),(o={},o[n]=w(w({},s.entry.params.channels[n]),{isoValue:i?Ct.IsoValue.relative(a):Ct.IsoValue.absolute(a)}),o))})}}))},r.changeParams=function(n,a,i){var o,s,u=r.props.params;r.newParams(w(w({},u),{entry:{name:u.entry.name,params:w(w({},u.entry.params),{channels:w(w({},u.entry.params.channels),(o={},o[n]=w(w({},u.entry.params.channels[n]),(s={},s[a]=i,s)),o))})}}))},r.changeOption=function(n){var a=n.name,i=n.value,o=r.props.params;if(a==="entry")r.newParams(w(w({},o),{entry:{name:i,params:o.entry.params}}));else{var s=r.props.b.data,u=s.info.kind==="em",l=i.params.isRelative,c=s.info.header.sampling[0],d=o.entry.params.channels,f=o.entry.params.view.name===i.name?o.entry.params.view.params:r.props.info.params.entry.map(o.entry.name).params.view.map(i.name).defaultValue,p=w({},f);i.name==="selection-box"?p.radius=i.params.radius:i.name==="box"?(p.bottomLeft=i.params.bottomLeft,p.topRight=i.params.topRight):i.name==="auto"&&(p.radius=i.params.radius,p.selectionDetailLevel=i.params.selectionDetailLevel),p.isUnbounded=!!i.params.isUnbounded,r.newParams(w(w({},o),{entry:{name:o.entry.name,params:w(w({},o.entry.params),{view:{name:i.name,params:p},detailLevel:i.params.detailLevel,channels:u?{em:r.convert(d.em,c.valuesInfo[0],l)}:{"2fo-fc":r.convert(d["2fo-fc"],c.valuesInfo[0],l),"fo-fc(+ve)":r.convert(d["fo-fc(+ve)"],c.valuesInfo[1],l),"fo-fc(-ve)":r.convert(d["fo-fc(-ve)"],c.valuesInfo[1],l)}})}}))}},r}return t.prototype.areInitial=function(r){return E.areEqual(this.props.info.params,r,this.props.info.initialValues)},t.prototype.newParams=function(r){this.props.events.onChange(r,this.areInitial(r))},t.prototype.convert=function(r,n,a){return w(w({},r),{isoValue:a?Ct.IsoValue.toRelative(r.isoValue,n):Ct.IsoValue.toAbsolute(r.isoValue,n)})},t.prototype.render=function(){if(!this.props.b)return null;var r=this.props.b.data,n=r.info.kind==="em",a=n?"em":"2fo-fc",i=this.props.params,o=this.props.info.params.entry.map(i.entry.name),s=o.params.detailLevel,u=i.entry.params.channels[a].isoValue.kind==="relative",l=r.info.header.sampling[0],c=E.Boolean(u,{description:"Use normalized or absolute isocontour scale.",label:"Normalized"}),d=!!i.entry.params.view.params.isUnbounded,f=E.Boolean(d,{description:"Show full/limited range of iso-values for more fine-grained control.",label:"Unbounded"}),p=i.entry.params.view.name==="off",h={entry:E.Select(i.entry.name,r.data.entries.map(function(m){return[m.dataId,m.dataId]}),{isHidden:p,description:"Which entry with volume data to display."}),view:E.MappedStatic(i.entry.params.view.name,{off:E.Group({isRelative:E.Boolean(u,{isHidden:!0}),isUnbounded:E.Boolean(d,{isHidden:!0})},{description:"Display off."}),box:E.Group({bottomLeft:E.Vec3(C.zero()),topRight:E.Vec3(C.zero()),detailLevel:s,isRelative:c,isUnbounded:f},{description:"Static box defined by cartesian coords."}),"selection-box":E.Group({radius:E.Numeric(5,{min:0,max:50,step:.5},{description:"Radius in \u212B within which the volume is shown."}),detailLevel:s,isRelative:c,isUnbounded:f},{description:"Box around focused element."}),cell:E.Group({detailLevel:s,isRelative:c,isUnbounded:f},{description:"Box around the structure's bounding box."}),auto:E.Group({radius:E.Numeric(5,{min:0,max:50,step:.5},{description:"Radius in \u212B within which the volume is shown."}),detailLevel:s,selectionDetailLevel:w(w({},s),{label:"Selection Detail"}),isRelative:c,isUnbounded:f},{description:"Box around focused element."})},{options:Qa.ViewTypeOptions,description:'Controls what of the volume is displayed. "Off" hides the volume alltogether. "Bounded box" shows the volume inside the given box. "Around Focus" shows the volume around the element/atom last interacted with. "Whole Structure" shows the volume for the whole structure.'})},v={entry:i.entry.name,view:{name:i.entry.params.view.name,params:{detailLevel:i.entry.params.detailLevel,radius:i.entry.params.view.params.radius,bottomLeft:i.entry.params.view.params.bottomLeft,topRight:i.entry.params.view.params.topRight,selectionDetailLevel:i.entry.params.view.params.selectionDetailLevel,isRelative:u,isUnbounded:d}}};return p?L(Pn,{onChange:this.changeOption,params:h,values:v,onEnter:this.props.events.onEnter,isDisabled:this.props.isDisabled},void 0):Te(Rt,{children:[!n&&L(b0,{label:"2Fo-Fc",name:"2fo-fc",bCell:this.props.bCell,channels:i.entry.params.channels,changeIso:this.changeIso,changeParams:this.changeParams,isRelative:u,params:this.props,stats:l.valuesInfo[0],isUnbounded:d},void 0),!n&&L(b0,{label:"Fo-Fc(+ve)",name:"fo-fc(+ve)",bCell:this.props.bCell,channels:i.entry.params.channels,changeIso:this.changeIso,changeParams:this.changeParams,isRelative:u,params:this.props,stats:l.valuesInfo[1],isUnbounded:d},void 0),!n&&L(b0,{label:"Fo-Fc(-ve)",name:"fo-fc(-ve)",bCell:this.props.bCell,channels:i.entry.params.channels,changeIso:this.changeIso,changeParams:this.changeParams,isRelative:u,params:this.props,stats:l.valuesInfo[1],isUnbounded:d},void 0),n&&L(b0,{label:"EM",name:"em",bCell:this.props.bCell,channels:i.entry.params.channels,changeIso:this.changeIso,changeParams:this.changeParams,isRelative:u,params:this.props,stats:l.valuesInfo[0],isUnbounded:d},void 0),L(Pn,{onChange:this.changeOption,params:h,values:v,onEnter:this.props.events.onEnter,isDisabled:this.props.isDisabled},void 0)]},void 0)},t}(hr),qN=function(){return w(w({},iEe()),{customParamEditors:[[vw,uEe]]})};function lEe(e,t){var r=new XTe(t||qN());return r.init(),G7.exports.render(kt.exports.createElement(b3e,{plugin:r}),e),r}var jN=globalThis&&globalThis.__awaiter||function(e,t,r,n){function a(i){return i instanceof r?i:new r(function(o){o(i)})}return new(r||(r=Promise))(function(i,o){function s(c){try{l(n.next(c))}catch(d){o(d)}}function u(c){try{l(n.throw(c))}catch(d){o(d)}}function l(c){c.done?i(c.value):a(c.value).then(s,u)}l((n=n.apply(e,t||[])).next())})};const cEe="",WN=e=>!!e&&jt.isFromPdbArchive(e),dEe={local_metric_values:{label_asym_id:ve.Schema.str,label_comp_id:ve.Schema.str,label_seq_id:ve.Schema.int,metric_id:ve.Schema.int,metric_value:ve.Schema.float,model_id:ve.Schema.int,ordinal_id:ve.Schema.int}},fEe=(e,t)=>{if(!Jr.is(t.sourceData)||!t.sourceData.data.frame.categoryNames.includes(e))return;const r=t.sourceData.data.frame.categories[e].getField("metric_value");if(!(!r||r.rowCount===0))return{timestamp_utc:r.str(0)||dye(new Date)}},pEe=(e,t)=>{const r=fEe("ma_qa_metric_local",t);if(!r)return;const n=mEe(t),a=gEe(t,n.residues);return{info:r,data:a}};function hEe(e,t,r){return jN(this,void 0,void 0,function*(){return{value:pEe(e,t)}})}function o_(e){if(!ze.isAtomic(e.unit))return[-1,"No Score"];const t=dc.get(e.unit.model).value;if(!t||!t.data)return[-1,"No Score"];const r=e.unit.residueIndex[e.element];return t.data.score.has(r)?t.data.score.get(r):[-1,"No Score"]}const WM=[];function vEe(e){if(!e)return WM;const t=dc.get(e.models[0]).value;return!t||!t.data?WM:t.data.category}function mEe(e){if(!Jr.is(e.sourceData))throw new Error("Data format must be mmCIF.");return{residues:R6(dEe.local_metric_values,e.sourceData.data.frame.categories.ma_qa_metric_local)}}const IS={serverUrl:E.Text(cEe,{description:"JSON API Server URL"})},dc=Bd.createProvider({label:"AF Confidence Score",descriptor:Pi({name:"af_confidence_score"}),type:"static",defaultParams:IS,getParams:e=>IS,isApplicable:e=>WN(e),obtain:(e,t,r)=>jN(void 0,void 0,void 0,function*(){return Object.assign(Object.assign({},E.getDefaultValues(IS)),r),yield hEe(e,t)})});function gEe(e,t){const r=new Map,{label_asym_id:n,label_seq_id:a,metric_value:i,_rowCount:o}=t,s=[];for(let u=0;u<o;u++){const l=i.value(u),c=e.atomicHierarchy.index.findResidue("1",n.value(u),a.value(u),"");let d="Very low";l>50&&l<=70?d="Low":l>70&&l<=90?d="Medium":l>90&&(d="High"),r.set(c,[l,d]),Xa(s,d)}return{score:zx.fromResidueMap(r),category:s}}const Uf={"No Score":it.fromRgb(170,170,170),"Very low":it.fromRgb(255,125,69),Low:it.fromRgb(255,219,19),Medium:it.fromRgb(101,203,243),High:it.fromRgb(0,83,214)},yEe={type:E.MappedStatic("score",{score:E.Group({}),category:E.Group({kind:E.Text()})})};function XN(e,t){let r;if(e.structure&&!e.structure.isEmpty&&e.structure.models[0].customProperties.has(dc.descriptor))if(t.type.name==="score")r=n=>{if(Ze.is(n)){const a=o_(n);return Uf[a[1]]}return Uf["No Score"]};else{const n=t.type.params.kind;r=a=>{if(Ze.is(a)){const i=o_(a);return i[1]===n?Uf[i[1]]:Uf["No Score"]}return Uf["No Score"]}}else r=()=>Uf["No Score"];return{factory:XN,granularity:"group",color:r,props:t,description:"Assigns residue colors according to the AF Confidence score"}}const XM={name:"af-confidence",label:"AF Confidence",category:"Validation",factory:XN,getParams:e=>{const t=vEe(e.structure);return t.length===0?{type:E.MappedStatic("score",{score:E.Group({})})}:{type:E.MappedStatic("score",{score:E.Group({}),category:E.Group({kind:E.Select(t[0],E.arrayToOptions(t))},{isFlat:!0})})}},defaultValues:E.getDefaultValues(yEe),isApplicable:e=>{var t;return WN((t=e.structure)===null||t===void 0?void 0:t.models[0])},ensureCustomProperties:{attach:(e,t)=>t.structure?dc.attach(e,t.structure.models[0],void 0,!0):Promise.resolve(),detach:e=>e.structure&&e.structure.models[0].customProperties.reference(dc.descriptor,!1)}};var bEe=Mr.create({name:"af-confidence-prop",category:"custom-props",display:{name:"AlphaFold Confidence Score",description:"AlphaFold Confidence Score."},ctor:class extends Mr.Handler{constructor(){super(...arguments);this.provider=dc,this.labelAfConfScore={label:e=>{if(this.params.showTooltip&&e.kind==="element-loci"&&e.elements.length!==0){const t=e.elements[0],r=t.unit;if(!r.model.customProperties.hasReference(dc.descriptor))return;const n=Ze.create(e.structure,r,r.elements[ke.getAt(t.indices,0)]),a=o_(n);return a&&a[0]>0?`Confidence score: ${a[0]} <small>( ${a[1]} )</small>`:""}}}}register(){this.ctx.customModelProperties.register(this.provider,this.params.autoAttach),this.ctx.managers.lociLabels.addProvider(this.labelAfConfScore),this.ctx.representation.structure.themes.colorThemeRegistry.add(XM)}update(e){const t=this.params.autoAttach!==e.autoAttach;return this.params.autoAttach=e.autoAttach,this.params.showTooltip=e.showTooltip,this.ctx.customModelProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),t}unregister(){this.ctx.customModelProperties.unregister(dc.descriptor.name),this.ctx.managers.lociLabels.removeProvider(this.labelAfConfScore),this.ctx.representation.structure.themes.colorThemeRegistry.remove(XM)}},params:()=>({autoAttach:E.Boolean(!1),showTooltip:E.Boolean(!0)})});var SEe=globalThis&&globalThis.__awaiter||function(e,t,r,n){function a(i){return i instanceof r?i:new r(function(o){o(i)})}return new(r||(r=Promise))(function(i,o){function s(c){try{l(n.next(c))}catch(d){o(d)}}function u(c){try{l(n.throw(c))}catch(d){o(d)}}function l(c){c.done?i(c.value):a(c.value).then(s,u)}l((n=n.apply(e,t||[])).next())})};const mu={layoutIsExpanded:!1,layoutShowControls:!1,layoutShowRemoteState:!1,layoutControlsDisplay:"reactive",layoutShowSequence:!1,layoutShowLog:!1,layoutShowLeftPanel:!1,disableAntialiasing:!1,pixelScale:1,enableWboit:!1,viewportShowExpand:!0,viewportShowSelectionMode:!1,viewportShowAnimation:!1,pdbProvider:"pdbe",viewportShowControls:jr.Viewport.ShowControls.defaultValue,viewportShowSettings:jr.Viewport.ShowSettings.defaultValue};class xEe{constructor(t,r){const n=qN(),a={actions:n.actions,behaviors:[...n.behaviors,Zt.Behavior(bEe,{autoAttach:!0,showTooltip:!0})],layout:{initial:{isExpanded:mu.layoutIsExpanded,showControls:mu.layoutShowControls,controlsDisplay:mu.layoutControlsDisplay}},config:[[jr.General.DisableAntialiasing,mu.disableAntialiasing],[jr.General.PixelScale,mu.pixelScale],[jr.General.EnableWboit,mu.enableWboit],[jr.Viewport.ShowExpand,mu.viewportShowExpand],[jr.Viewport.ShowSelectionMode,mu.viewportShowSelectionMode],[jr.Download.DefaultPdbProvider,mu.pdbProvider],[jr.Structure.DefaultRepresentationPresetParams,{theme:{globalName:"af-confidence",carbonByChainId:!1,focus:{name:"element-symbol",params:{carbonByChainId:!1}}}}]]},i=typeof t=="string"?document.getElementById(t):t;if(!i)throw new Error(`Could not get element with id '${t}'`);this.plugin=lEe(i,a),this.plugin.behaviors.interaction.click.subscribe(o=>{if(Re.is(o.current.loci)){const s=Ze.create();Re.getFirstLocation(o.current.loci,s);const u=ct.residue.label_seq_id(s);r([u])}}),wt.Canvas3D.SetSettings(this.plugin,{settings:o=>{o.renderer.backgroundColor=it(16777215)}})}clear(t){this.plugin.clear(),t&&this.showMessage("Loading",t)}loadPdb(t,r){const n=VC.createDefaultParams(this.plugin.state.data.root.obj,this.plugin),a=this.plugin.config.get(jr.Download.DefaultPdbProvider);return this.plugin.runTask(this.plugin.state.data.applyAction(VC,{source:{name:"pdb",params:{provider:{id:t,server:{name:a,params:$3[a].defaultValue}},options:Object.assign(Object.assign({},n.source.params.options),{representationParams:r==null?void 0:r.representationParams})}}})).then(()=>{this.clearMessages()})}loadAF(t,r){return SEe(this,void 0,void 0,function*(){const{plugin:n}=this,a=yield n.builders.data.download({url:r,isBinary:!1},{state:{isGhost:!0}}),i=yield n.builders.structure.parseTrajectory(a,"mmcif");return this.plugin.builders.structure.hierarchy.applyPreset(i,"all-models",{useDefaultIfSingleModel:!0}).then(()=>this.clearMessages())})}highlight(t){var r,n;const a=(n=(r=this.plugin.managers.structure.hierarchy.current.structures[0])===null||r===void 0?void 0:r.cell.obj)===null||n===void 0?void 0:n.data;if(!a)return;const i=pa.getStructureSelection(s=>s.struct.generator.atomGroups({"residue-test":s.core.logic.or(t.map(({start:u,end:l})=>s.core.rel.inRange([s.struct.atomProperty.macromolecular.label_seq_id(),u,l])))}),a),o=mt.toLociWithSourceUnits(i);this.plugin.managers.camera.focusLoci(o),this.plugin.managers.interactivity.lociSelects.selectOnly({loci:o})}clearHighlight(){this.plugin.managers.interactivity.lociSelects.deselectAll(),wt.Camera.Reset(this.plugin,{})}showMessage(t,r,n){this.clearMessages(),wt.Toast.Show(this.plugin,{title:t,message:r,timeoutMs:n})}clearMessages(){wt.Toast.Hide(this.plugin)}handleResize(){this.plugin.layout.events.updated.next()}}class Zh extends Error{}const YM=(e,t,r,n)=>{if(!r)return null;if(!e||!t||Number.isNaN(e)||Number.isNaN(t))throw new Zh("Invalid start, end coordinates");for(const a of r){if(a.unp_end-a.unp_start!==a.end.residue_number-a.start.residue_number)throw new Zh("Mismatch between protein sequence and structure residues");if(n==="UP_PDB"&&(e<a.unp_start||t>a.unp_end)||n==="PDB_UP"&&(e<a.start.residue_number||t>a.end.residue_number))throw new Zh("Start or end coordinate outside of mapping range");const i=n==="UP_PDB"?a.start.residue_number-a.unp_start:a.unp_start-a.start.residue_number;return{entity:a.entity_id,chain:a.chain_id,start:e+i,end:t+i}}return null};var MS=globalThis&&globalThis.__awaiter||function(e,t,r,n){function a(i){return i instanceof r?i:new r(function(o){o(i)})}return new(r||(r=Promise))(function(i,o){function s(c){try{l(n.next(c))}catch(d){o(d)}}function u(c){try{l(n.throw(c))}catch(d){o(d)}}function l(c){c.done?i(c.value):a(c.value).then(s,u)}l((n=n.apply(e,t||[])).next())})};const KM=(e,t)=>{const{ga:r}=window;r&&r("send","event","protvista-structure",e,t)};class py extends HTMLElement{constructor(){super();this._planHighlight=this._planHighlight.bind(this),this.propagateHighlight=this.propagateHighlight.bind(this)}static get is(){return"protvista-structure"}get css(){return`
    protvista-structure h4 {
      display: inline;
      margin-right: 1em;
    }
      
    .structure-viewer-container {
      position: relative;
      height: ${this._height};
    }
    `}get accession(){return this._accession}set accession(t){this.setAttribute("accession",t)}get structureId(){return this.structureId}set structureId(t){this.setAttribute("structureid",t),this._structureId=t}get height(){return this.getAttribute("height")}connectedCallback(){this.innerHTML="";const t=this.closest("protvista-manager");t&&"register"in t&&"unregister"in t&&(this.manager=t,this.manager.register(this)),this.structureId=this.getAttribute("structureid"),this._accession=this.getAttribute("accession"),this._height=this.getAttribute("height")||"480px",this._highlight=this.getAttribute("highlight")&&py._parseHighlight(this.getAttribute("highlight"));const r=document.createElement("style");r.innerHTML=this.css,this.appendChild(r);const n=document.createElement("div");n.className="structure-viewer-container",n.id="structure-viewer-instance",this.appendChild(n),this._structureViewer=new xEe(n,this.propagateHighlight)}disconnectedCallback(){this.manager&&this.manager.unregister(this)}static get observedAttributes(){return["highlight","structureid","accession","height"]}static _parseHighlight(t){return t?t.split(",").map(n=>{const[a,i]=n.split(":");return{start:Number(a),end:Number(i)}}):[]}attributeChangedCallback(t,r,n){if(r!==n){switch(t){case"structureid":n!==null&&(this._structureId=n),this.selectMolecule();break;case"accession":this._accession=n,this.selectMolecule();break;case"highlight":this._highlight=py._parseHighlight(this.getAttribute("highlight"));break;case"height":this._height=n;break}this._planHighlight()}}_planHighlight(){this._plannedRender||(this._plannedRender=!0,requestAnimationFrame(()=>{this._plannedRender=!1,this._selectedMolecule&&this.highlightChain()}))}loadPDBEntry(t){var r;return MS(this,void 0,void 0,function*(){(r=this._structureViewer)===null||r===void 0||r.clear(t);try{const{payload:n}=yield D4(`https://www.ebi.ac.uk/pdbe/api/mappings/uniprot/${t}`);return KM("load-PDBe",t),n}catch(n){throw this._structureViewer.showMessage("Error","Couldn't load PDB entry"),n}})}loadAFEntry(t){var r;return MS(this,void 0,void 0,function*(){(r=this._structureViewer)===null||r===void 0||r.clear(t);try{const{payload:n}=yield D4(`https://alphafold.ebi.ac.uk/api/prediction/${t}`);return KM("load-AF",t),n}catch(n){throw this._structureViewer.showMessage("Error","Couldn't load AF entry"),n}})}isAF(){return this._structureId.startsWith("AF-")}selectMolecule(){var t;return MS(this,void 0,void 0,function*(){if(!this._structureId||!this._accession)return;let r;if(this.isAF()){const a=(yield this.loadAFEntry(this._accession)).find(i=>i.entryId===this._structureId);yield this._structureViewer.loadAF(this._structureId,a.cifUrl)}else{const n=yield this.loadPDBEntry(this._structureId);r=(t=Object.values(n)[0].UniProt[this._accession])===null||t===void 0?void 0:t.mappings,yield this._structureViewer.loadPdb(this._structureId.toLowerCase())}this._selectedMolecule={id:this._structureId,mappings:r},this._planHighlight()})}propagateHighlight(t){if(!(t!=null&&t.length)||t.some(i=>!Number.isInteger(i)))return;let r;try{r=t.map(i=>YM(i,i,this._selectedMolecule.mappings,"PDB_UP"))}catch(i){if(i instanceof Zh){this._structureViewer.showMessage("Error",i.message);return}throw i}const n=r.filter(Boolean).map(i=>`${i.start}:${i.end}`);this.setAttribute("highlight",n.join(","));const a=new CustomEvent("change",{detail:{highlight:n},bubbles:!0,cancelable:!0});this.dispatchEvent(a)}highlightChain(){if(!this._highlight||typeof this._highlight=="string")return;let t;try{t=this._highlight.map(({start:r,end:n})=>this.isAF()?{start:r,end:n}:YM(r,n,this._selectedMolecule.mappings,"UP_PDB")).filter(Boolean)}catch(r){if(r instanceof Zh){this._structureViewer.clearHighlight(),this._structureViewer.showMessage("Error",r.message);return}throw r}if(!(t!=null&&t.length)){this._structureViewer.clearHighlight();return}this._structureViewer.highlight(t),this._structureViewer.clearMessages()}}const CEe=e=>{const t=new Map;return e.forEach(r=>{r.dataset.filter&&t.set(r.dataset.filter,new Set)}),t},_Ee=(e,t,r,n)=>!r&&t===n||!n&&e===r||e<=r&&t>=n,wEe=(e,t,r,n)=>e>n||t<r,s_=Ji`pd-group-trigger__expanded`,hy=Ji`active`,Jh=Ji`transparent`,u_=Ji`overlapped`,l_=Ji`hidden`,AEe=Ji`
  protvista-datatable table {
    width: 100%;
    padding: 0;
    margin: 0;
    border-spacing: 0;
  }

  protvista-datatable table th {
    position: sticky;
    position: -webkit-sticky;
    position: -moz-sticky;
    position: -ms-sticky;
    position: -o-sticky;
    text-align: left;
    vertical-align: top;
    background-color: var(--protvista-datable__header-background, #fff);
    color: var(--protvista-datable__header-text, #393b42);
    text-overflow: ellipsis;
    top: 0;
    text-transform: uppercase;
    z-index: 400;
  }

  protvista-datatable table th .filter-wrap {
    display: flex;
    flex-direction: column;
  }

  protvista-datatable table th .filter-wrap select {
    width: fit-content;
  }

  protvista-datatable table td,
  protvista-datatable table th {
    padding: 0.2rem;
    border-bottom: 1px solid #c2c4c4;
  }

  protvista-datatable table tr:hover:not(.${hy}):not(.${Jh}) {
    background-color: var(--protvista-datatable__hover, #f1f1f1);
  }

  protvista-datatable table td {
    cursor: pointer;
  }

  protvista-datatable table .pd-group-trigger {
    width: 1rem;
  }

  protvista-datatable table .pd-group-trigger button {
    background: none;
    border: none;
    padding: 0.2rem; // increase click area
    position: relative;
    text-decoration: none;
    cursor: pointer;
    transition: background 250ms ease-in-out, transform 150ms ease;
    -webkit-appearance: none;
    -moz-appearance: none;
  }

  protvista-datatable table .pd-group-trigger button:before {
    display: inline-block;
    content: " ";
    border-style: solid;
    border-width: 0.4rem 0 0.4rem 0.6rem;
    border-color: transparent transparent transparent #161d39;
    transition-duration: 0.3s;
    transition-property: transform;
  }

  protvista-datatable table .pd-group-trigger button.${s_}:before {
    transform: rotate(90deg);
  }

  protvista-datatable table td:nth-child(1) {
    border-left: 0.5rem solid transparent;
  }

  protvista-datatable table .${u_} td:nth-child(1) {
    border-left: 0.5rem solid
      var(--protvista-datatable__overlapped, rgba(255, 0, 0, 0.8));
  }

  protvista-datatable table .${hy} {
    background-color: var(
      --protvista-datatable__active,
      rgba(255, 235, 59, 0.3)
    ) !important;
  }

  protvista-datatable table .${Jh} {
    opacity: 0.2;
  }
  protvista-datatable table .${Jh} td:hover {
    cursor: default;
    background-color: inherit;
  }

  protvista-datatable table .${l_} {
    display: none;
  }

  protvista-datatable table tr[data-group-for] td {
    padding-left: 1.7rem;
    padding-bottom: 0.7rem;
  }

  protvista-datatable table .odd {
    background-color: var(--protvista-datatable__odd, #e4e8eb);
  }

  protvista-datatable table .even {
    background-color: var(--protvista-datatable__even, #fff);
  }
`;class PEe extends nl{constructor(){super();this.height=25,this.visibleChildren=[],this.noScrollToRow=!1,this.noDeselect=!1,this.scrollFilter=new qD(this),this.wheelListener=t=>this.scrollFilter.wheel(t),this.eventHandler=this.eventHandler.bind(this)}static get is(){return"protvista-datatable"}connectedCallback(){super.connectedCallback();const t=this.querySelector("table tbody");if(!t)return;this.mutationObserver=new MutationObserver(()=>{this.init()}),this.mutationObserver.observe(t,{characterData:!0,childList:!0,subtree:!0});const r=document.createElement("style");r.innerHTML=AEe.toString(),document.querySelector("head").appendChild(r),this.closest("protvista-manager")&&(this.manager=this.closest("protvista-manager"),this.manager.register(this)),this.noDeselect||document.addEventListener("click",this.eventHandler),this.classList.add("feature"),this.hasAttribute("filter-scroll")&&document.addEventListener("wheel",this.wheelListener,{capture:!0}),this.init()}disconnectedCallback(){super.disconnectedCallback(),this.manager&&this.manager.unregister(this),document.removeEventListener("click",this.eventHandler),document.removeEventListener("wheel",this.wheelListener),this.mutationObserver.disconnect()}init(){if(this.columns=this.querySelectorAll("table thead th"),!this.querySelector(".pd-group-column-header")){const t=document.createElement("th");t.classList.add("pd-group-column-header");const r=this.querySelector("table thead tr");r.insertBefore(t,r.firstChild)}this.rows=this.querySelectorAll("table tbody tr"),this.rows.forEach(t=>{if(!t.dataset.groupFor&&!t.querySelector(".pd-group-trigger")){const r=t.insertCell(0);if(r.classList.add("pd-group-trigger"),this.querySelector("[data-group-for]")){const n=document.createElement("button");n.dataset.triggerId=t.dataset.id,r.appendChild(n),n.addEventListener("click",a=>this.handleGroupToggle(a))}}t.addEventListener("click",r=>this.handleClick(r,t))}),this.updateRowStyling(),this.selectedFilters=new Map,this.filterMap=this.parseDataForFilters(),this.addFilterOptions()}parseDataForFilters(){const t=CEe(this.columns);return this.rows.forEach(r=>{r.childNodes.forEach(a=>{var i;!((i=a.dataset)===null||i===void 0)&&i.filter&&t.get(a.dataset.filter).add(a.dataset.filterValue)})}),t}addFilterOptions(){this.columns.forEach(t=>{if(t.dataset.filter){let r,n;t.querySelector(".filter-wrap")?(r=t.querySelector("select"),n=t.querySelector(".filter-wrap")):(n=document.createElement("span"),n.className="filter-wrap",n.innerHTML=t.innerHTML,r=document.createElement("select"),r.dataset.testid="select",r.onchange=a=>this.handleFilterChange(a,t.dataset.filter)),r.innerHTML="<option  selected value>-- Select --</option>",this.filterMap.get(t.dataset.filter).forEach(a=>{const i=document.createElement("option");i.value=a,i.label=a,i.dataset.testid="select-option",r.appendChild(i)}),t.innerHTML="",n.appendChild(r),t.appendChild(n)}})}eventHandler(t){const r=t.target;!r.closest("protvista-datatable")&&!r.closest(".feature")&&(this.selectedid=null,this.highlight=null)}static get properties(){return{highlight:{converter:t=>{if(t&&t!=="null")try{const r=t.split(":").map(n=>Number(n));if(r.length!==2)throw new Error("Highlight should be only 2 values separated by ':'.");return[r[0],r[1]]}catch(r){console.error("Invalid highlight coordinates:",r)}return null}},height:{type:Number},displayStart:{type:Number},displayEnd:{type:Number},visibleChildren:{type:Array},selectedid:{type:String},noScrollToRow:{type:Boolean},noDeselect:{type:Boolean}}}static get styles(){return Ji`
      :host {
        display: block;
      }
      .protvista-datatable-container {
        overflow-y: auto;
        // Note: overflow-x was set to 'hidden' but changing
        // to 'auto' doesn't seem to be an issue.
        overflow-x: auto;
      }

      :host([scrollable="true"]) .protvista-datatable-container {
        overflow-y: auto;
        will-change: scroll;
      }

      :host([scrollable="false"]) .protvista-datatable-container {
        overflow-y: hidden;
      }
    `}handleGroupToggle(t){const{triggerId:r}=t.target.dataset;this.visibleChildren.includes(r)?(this.visibleChildren=this.visibleChildren.filter(n=>n!==r),t.target.classList.remove(s_.cssText)):(this.visibleChildren=[...this.visibleChildren,r],t.target.classList.add(s_.cssText))}handleClick(t,r){if(r.classList.contains("transparent"))return;const{id:n,start:a,end:i}=r.dataset;this.selectedid=n;const o={};a&&i&&(o.highlight=`${a}:${i}`),this.selectedid&&(o.selectedid=this.selectedid),this.dispatchEvent(new CustomEvent("change",{detail:o,bubbles:!0,cancelable:!0}))}handleFilterChange(t,r){const{selectedOptions:n}=t.target,{value:a}=n.item(0);a?this.selectedFilters.set(r,a):this.selectedFilters.delete(r),this.updateRowStyling()}isRowVisible(t){const r=!t.dataset.groupFor||t.dataset.groupFor&&this.visibleChildren.includes(t.dataset.groupFor);if(!this.selectedFilters||this.selectedFilters.size===0)return r;for(const[n,a]of this.selectedFilters){let i;if(t.dataset.groupFor?i=this.querySelector(`[data-id="${t.dataset.groupFor}"]`).querySelector(`[data-filter="${n}"]`):i=t.querySelector(`[data-filter="${n}"]`),i&&i.dataset.filterValue!==a)return!1}return r}updateRowStyling(){var t;let r=0;(t=this.rows)===null||t===void 0||t.forEach(n=>{this.isRowVisible(n)?n.classList.remove(l_.cssText):n.classList.add(l_.cssText),n.dataset.groupFor||r++;const{start:i,end:o}=n.dataset;if(n.classList.add(r%2===0?"even":"odd"),this.selectedid&&(this.selectedid===n.dataset.id||n.dataset.groupFor===this.selectedid)?n.classList.add(hy.cssText):n.classList.remove(hy.cssText),wEe(this.displayStart,this.displayEnd,Number(i),Number(o))?n.classList.add(Jh.cssText):n.classList.remove(Jh.cssText),this.highlight&&_Ee(this.highlight[0],this.highlight[1],Number(i),Number(o))?n.classList.add(u_.cssText):n.classList.remove(u_.cssText),n.dataset.groupFor){const s=this.columns.length+1;n.cells[0].colSpan=s-n.cells.length+1}})}scrollIntoView(){if(!this.selectedid)return;const t=this.querySelector(`[data-id="${this.selectedid}"]`);t==null||t.scrollIntoView({behavior:"smooth",block:"center"})}render(){return zr`
      <div
        class="protvista-datatable-container"
        style="max-height:${this.height}rem"
      >
        <slot></slot>
      </div>
    `}updated(){this.updateRowStyling(),this.noScrollToRow||this.scrollIntoView()}}const ho=function(e,t){customElements.get(e)||customElements.define(e,t)};var YN="/assets/spinner.374aaf14.svg",KN="/assets/download.325e4c97.svg",$N=Ji`
  .protvista-loader {
    display: flex;
    justify-content: center;
    padding: 4rem 0;
  }
  .protvista-loader svg {
    height: 100px;
  }

  .protvista-no-results {
    background-color: #e4e8eb;
    display: flex;
    justify-content: center;
    padding: 1rem;
    font-size: 0.8rem;
  }
`;const TEe=[{name:"PDBe",link:"https://www.ebi.ac.uk/pdbe-srv/view/entry/"},{name:"RCSB-PDB",link:"https://www.rcsb.org/structure/"},{name:"PDBj",link:"https://pdbj.org/mine/summary/"},{name:"PDBsum",link:"https://www.ebi.ac.uk/pdbsum/"}],EEe="https://alphafold.ebi.ac.uk/entry/",IEe=e=>e.dbReferences.filter(t=>t.type==="PDB").sort((t,r)=>t.id.localeCompare(r.id)).map(({id:t,properties:r})=>{if(!r)return;const{chains:n,resolution:a,method:i}=r;let o,s;if(n){const l=n.split("=");l.length===2&&([o,s]=l)}return{id:t,source:"PDB",method:i,resolution:!a||a==="-"?void 0:a,downloadLink:`https://www.ebi.ac.uk/pdbe/entry-files/download/pdb${t.toLowerCase()}.ent`,chain:o,positions:s,protvistaFeatureId:t}}).filter(t=>t!==void 0),MEe=e=>e.map(t=>({id:t.entryId,source:"AlphaFold",method:"Predicted",positions:`${t.uniprotStart}-${t.uniprotEnd}`,protvistaFeatureId:t.entryId,downloadLink:t.pdbUrl})),DEe=zr`
  <strong>Model Confidence:</strong>
  <ul class="no-bullet">
    <li>
      <span class="af-legend" style="background-color: rgb(0, 83, 214)"></span>
      Very high (pLDDT > 90)
    </li>
    <li>
      <span
        class="af-legend"
        style="background-color: rgb(101, 203, 243)"
      ></span>
      Confident (90 > pLDDT > 70)
    </li>
    <li>
      <span class="af-legend" style="background-color:rgb(255, 219, 19)"></span>
      Low (70 > pLDDT > 50)
    </li>
    <li>
      <span class="af-legend" style="background-color:rgb(255, 125, 69)"></span>
      Very low (pLDDT < 50)
    </li>
  </ul>
  <p class="small">
    AlphaFold produces a per-residue confidence score (pLDDT) between 0 and 100.
    Some regions with low pLDDT may be unstructured in isolation.
  </p>
`,DS="protvista-styles";class QN extends nl{constructor(){super();ho("protvista-structure",py),ho("protvista-datatable",PEe),this.loading=!0,this.onTableRowClick=this.onTableRowClick.bind(this),this.addStyles()}static get properties(){return{accession:{type:String},structureId:{type:String},data:{type:Object},loading:{type:Boolean}}}async connectedCallback(){if(super.connectedCallback(),!this.accession)return;const t=`https://www.ebi.ac.uk/proteins/api/proteins/${this.accession}`,r=`https://alphafold.ebi.ac.uk/api/prediction/${this.accession}`,n=[];await Promise.all([t,r].map(s=>WD(s).then(u=>n[s]=u.payload,u=>console.warn(u)))),this.loading=!1;const a=IEe(n[t]||[]),i=MEe(n[r]||[]),o=[...a,...i];!o||!o.length||(this.data=o)}disconnectedCallback(){this.removeStyles()}updated(){var t;const r=this.querySelector("protvista-datatable");!(r!=null&&r.selectedid)&&((t=this.data)===null||t===void 0?void 0:t[0])&&(this.onTableRowClick({id:this.data[0].id}),r.selectedid=this.structureId)}addStyles(){var t;if(!document.getElementById(DS)){const r=document.createElement("style");r.id=DS,r.innerHTML=`
      ${$N.toString()}
      ${this.cssStyle}
      `,(t=document.querySelector("head"))===null||t===void 0||t.append(r)}}removeStyles(){const t=document.getElementById(DS);t&&t.remove()}onTableRowClick({id:t}){this.structureId=t,this.structureId.startsWith("AF-")?this.metaInfo=DEe:this.metaInfo=void 0}get cssStyle(){return Ji`
      .protvista-uniprot-structure__structure {
        display: flex;
      }
      .protvista-uniprot-structure__meta {
        flex: 1;
        padding: 1rem;
      }
      .protvista-uniprot-structure__structure protvista-structure {
        z-index: 40000;
        width: 100%;
        flex: 4;
      }
      .protvista-uniprot-structure__meta .small {
        font-size: 0.75rem;
      }
      .protvista-uniprot-structure__meta .no-bullet {
        list-style: none;
        padding: 0;
        margin: 0;
      }
      .protvista-uniprot-structure__meta .no-bullet li {
        padding: 0;
        margin: 0.5rem 0;
      }
      .protvista-uniprot-structure__meta .af-legend::before {
        content: '';
        margin: 0;
        display: inline-block;
        width: 20px;
        height: 16px;
      }
      .download-link svg {
        width: 1rem;
      }
    `}createRenderRoot(){return this}render(){var t;return zr`
      <div class="protvista-uniprot-structure">
        <div class="protvista-uniprot-structure__structure">
          ${this.metaInfo?zr`<div class="protvista-uniprot-structure__meta">
                ${this.metaInfo}
              </div>`:zr``}
          ${this.structureId?zr`<protvista-structure
                structureid=${this.structureId}
                accession=${this.accession}
              ></protvista-structure>`:zr``}
        </div>
        <div class="class="protvista-uniprot-structure__table">
        ${this.data&&this.data.length?zr`<protvista-datatable noScrollToRow noDeselect filter-scroll>
              <table>
                <thead>
                  <tr>
                    <th data-filter="source">Source</th>
                    <th>Identifier</th>
                    <th data-filter="method">Method</th>
                    <th>Resolution</th>
                    <th>Chain</th>
                    <th>Positions</th>
                    <th>Links</th>
                    <th><!--Download--></th>
                  </tr>
                </thead>
                <tbody>
                  ${(t=this.data)===null||t===void 0?void 0:t.map(({source:r,id:n,method:a,resolution:i,chain:o,positions:s,downloadLink:u})=>zr`<tr
                      data-id="${n}"
                      @click="${()=>this.onTableRowClick({id:n})}"
                    >
                      <td data-filter="source" data-filter-value="${r}">
                        <strong>${r}</strong>
                      </td>
                      <td>${n}</td>
                      <td data-filter="method" data-filter-value="${a}">
                        ${a}
                      </td>
                      <td>${i?i.replace("A","\u212B"):""}</td>
                      <td>${o||""}</td>
                      <td>${s||""}</td>
                      <td>
                        ${r==="PDB"?zr`
                              ${TEe.map(l=>zr`
                                  <a href="${l.link}${n}"
                                    >${l.name}</a
                                  >
                                `).reduce((l,c)=>zr` ${l} · ${c} `)}
                            `:zr`<a href="${EEe}${this.accession}"
                              >AlphaFold</a
                            >`}
                      </td>
                      <td>
                        ${u?zr`<a href="${u}" class="download-link"
                              >${H0`${q0(KN)}`}</a
                            >`:""}
                      </td>
                    </tr>`)}
                </tbody>
              </table>
            </protvista-datatable>`:zr``}
        ${this.loading?zr`<div class="protvista-loader">
              ${H0`${q0(YN)}`}
            </div>`:zr``}
        ${!this.data&&!this.loading?zr`<div class="protvista-no-results">
              No structure information available for ${this.accession}
            </div>`:zr``}
      </div>
    `}}var ZN={exports:{}};(function(e){(function(t,r,n){e.exports?e.exports=n():r[t]=n()})("urljoin",nd,function(){function t(r){var n=[];if(r.length===0)return"";if(typeof r[0]!="string")throw new TypeError("Url must be a string. Received "+r[0]);if(r[0].match(/^[^/:]+:\/*$/)&&r.length>1){var a=r.shift();r[0]=a+r[0]}r[0].match(/^file:\/\/\//)?r[0]=r[0].replace(/^([^/:]+):\/*/,"$1:///"):r[0]=r[0].replace(/^([^/:]+):\/*/,"$1://");for(var i=0;i<r.length;i++){var o=r[i];if(typeof o!="string")throw new TypeError("Url must be a string. Received "+o);o!==""&&(i>0&&(o=o.replace(/^[\/]+/,"")),i<r.length-1?o=o.replace(/[\/]+$/,""):o=o.replace(/[\/]+$/,"/"),n.push(o))}var s=n.join("/");s=s.replace(/\/(\?|&|#[^!])/g,"$1");var u=s.split("?");return s=u.shift()+(u.length>0?"?":"")+u.join("&"),s}return function(){var r;return typeof arguments[0]=="object"?r=arguments[0]:r=[].slice.call(arguments),t(r)}})})(ZN);var REe=ZN.exports,JN={exports:{}};(function(e,t){(function(r,n){n()})(nd,function(){function r(l,c){return typeof c=="undefined"?c={autoBom:!1}:typeof c!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),c={autoBom:!c}),c.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(l.type)?new Blob(["\uFEFF",l],{type:l.type}):l}function n(l,c,d){var f=new XMLHttpRequest;f.open("GET",l),f.responseType="blob",f.onload=function(){u(f.response,c,d)},f.onerror=function(){console.error("could not download file")},f.send()}function a(l){var c=new XMLHttpRequest;c.open("HEAD",l,!1);try{c.send()}catch{}return 200<=c.status&&299>=c.status}function i(l){try{l.dispatchEvent(new MouseEvent("click"))}catch{var c=document.createEvent("MouseEvents");c.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),l.dispatchEvent(c)}}var o=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof nd=="object"&&nd.global===nd?nd:void 0,s=o.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),u=o.saveAs||(typeof window!="object"||window!==o?function(){}:"download"in HTMLAnchorElement.prototype&&!s?function(l,c,d){var f=o.URL||o.webkitURL,p=document.createElement("a");c=c||l.name||"download",p.download=c,p.rel="noopener",typeof l=="string"?(p.href=l,p.origin===location.origin?i(p):a(p.href)?n(l,c,d):i(p,p.target="_blank")):(p.href=f.createObjectURL(l),setTimeout(function(){f.revokeObjectURL(p.href)},4e4),setTimeout(function(){i(p)},0))}:"msSaveOrOpenBlob"in navigator?function(l,c,d){if(c=c||l.name||"download",typeof l!="string")navigator.msSaveOrOpenBlob(r(l,d),c);else if(a(l))n(l,c,d);else{var f=document.createElement("a");f.href=l,f.target="_blank",setTimeout(function(){i(f)})}}:function(l,c,d,f){if(f=f||open("","_blank"),f&&(f.document.title=f.document.body.innerText="downloading..."),typeof l=="string")return n(l,c,d);var p=l.type==="application/octet-stream",h=/constructor/i.test(o.HTMLElement)||o.safari,v=/CriOS\/[\d]+/.test(navigator.userAgent);if((v||p&&h||s)&&typeof FileReader!="undefined"){var m=new FileReader;m.onloadend=function(){var b=m.result;b=v?b:b.replace(/^data:[^;]*;/,"data:attachment/file;"),f?f.location.href=b:location=b,f=null},m.readAsDataURL(l)}else{var g=o.URL||o.webkitURL,y=g.createObjectURL(l);f?f.location=y:location.href=y,f=null,setTimeout(function(){g.revokeObjectURL(y)},4e4)}});o.saveAs=u.saveAs=u,e.exports=u})})(JN);const OEe=(e,t="json",r)=>{e.forEach(n=>{JN.exports.saveAs(REe(n.url,`${r}.${t}`,`${r}_${n.type}.${t}`),`${r}_${n.type}.${t}`)})};class FEe extends nl{constructor(){super();this.open=!1,this.format="json"}static get properties(){return{accession:{type:String},config:{type:Array},open:{type:Boolean},format:{type:String}}}static get styles(){return Ji`
      :host {
        position: relative;
      }

      :host button {
        display: inline-block;
        background-color: #FFF;
        border: none;
        padding: 0.2rem;
        margin: 0;
        text-decoration: none;
        font-size: 1rem;
        cursor: pointer;
        text-align: center;
        color: #00709b;
        transition: opacity 250ms ease-in-out, transform 150ms ease;
        opacity: 0.8
        -webkit-appearance: none;
        -moz-appearance: none;
      }

      :host button:hover {
        opacity:1;
      }

      :host button svg {
        width: 1.5rem;
        height: 1.5rem;
        transition: opacity 250ms ease-in-out, transform 150ms ease;
        opacity: 0.8;
      }
      :host button svg:hover {
        opacity: 1;
      }

      .download-menu {
        display: none;
        position: absolute;
        background-color: #fff;
        padding: 1rem;
        box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
        transition: all 0.3s cubic-bezier(.25,.8,.25,1);      
      }
      :host(:hover) .download-menu {
        display: block;
      }
      .download-menu ul {
        margin: 0;
        padding: 0;
      }
      .download-menu li {
        list-style: none;
        margin: 0.5rem 0;
      }
    `}handleDownload(){this.config&&this.accession&&OEe(this.config,this.format,this.accession)}handleSetFormat(t){this.format=t}downloadSVG(){return H0`${q0(KN)}`}render(){return zr`
      <button title="Download">${this.downloadSVG()}</button>
      <div class="${`download-menu ${this.open&&"download-menu-open"}`}">
        <ul>
          <li>
            <label
              ><input
                type="radio"
                name="download-type"
                value="json"
                checked
                @click="${()=>this.handleSetFormat("json")}"
              />JSON</label
            >
          </li>
          <li>
            <label
              ><input
                type="radio"
                name="download-type"
                value="xml"
                @click="${()=>this.handleSetFormat("xml")}"
              />XML</label
            >
          </li>
          <li>
            <label
              ><input
                type="radio"
                name="download-type"
                value="gff"
                @click="${()=>this.handleSetFormat("gff")}"
              />GFF</label
            >
          </li>
        </ul>
        <button @click="${this.handleDownload}">Download</button>
      </div>
    `}}const wu={UPDiseaseColor:"#990000",UPNonDiseaseColor:"#99cc00",predictedColor:"#4c8acd",othersColor:"#009e73"},kEe={uncertain:[/uncertain/i,/conflicting/i,/unclassified/i,/risk factor/i]},BEe=(e,t)=>e.some(({type:r})=>t.some(n=>n.test(r))),ed=(e,t)=>e.map(r=>{const n=r.variants.filter(a=>t(a));return ki(Ha({},r),{variants:[...n]})}),e7=[{name:"disease",type:{name:"consequence",text:"Filter Consequence"},options:{labels:["Likely disease"],colors:[wu.UPDiseaseColor]},filterData:e=>ed(e,t=>{var r;return(r=t.association)===null||r===void 0?void 0:r.some(n=>n.disease)})},{name:"predicted",type:{name:"consequence",text:"Filter Consequence"},options:{labels:["Predicted consequence"],colors:[wu.predictedColor]},filterData:e=>ed(e,t=>t.hasPredictions)},{name:"nonDisease",type:{name:"consequence",text:"Filter Consequence"},options:{labels:["Likely benign"],colors:[wu.UPNonDiseaseColor]},filterData:e=>ed(e,t=>{var r;return(r=t.association)===null||r===void 0?void 0:r.some(n=>n.disease===!1)})},{name:"uncertain",type:{name:"consequence",text:"Filter Consequence"},options:{labels:["Uncertain"],colors:[wu.othersColor]},filterData:e=>ed(e,t=>typeof t.clinicalSignificances=="undefined"&&!t.hasPredictions||t.clinicalSignificances&&BEe(t.clinicalSignificances,kEe.uncertain))},{name:"UniProt",type:{name:"provenance",text:"Filter Provenance"},options:{labels:["UniProt reviewed"],colors:["#9f9f9f"]},filterData:e=>ed(e,t=>t.xrefNames&&(t.xrefNames.includes("uniprot")||t.xrefNames.includes("UniProt")))},{name:"ClinVar",type:{name:"provenance",text:"Filter Provenance"},options:{labels:["ClinVar reviewed"],colors:["#9f9f9f"]},filterData:e=>ed(e,t=>t.xrefNames&&(t.xrefNames.includes("ClinVar")||t.xrefNames.includes("clinvar")))},{name:"LSS",type:{name:"provenance",text:"Filter Provenance"},options:{labels:["Large scale studies"],colors:["#9f9f9f"]},filterData:e=>ed(e,t=>t.sourceType==="large_scale_study"||t.sourceType==="mixed")}],S0=(e,t)=>{const r=[{variants:[t]}],n=e7.find(a=>a.name===e);return n?n.filterData(r)[0].variants.length>0:!1},LEe=e=>S0("disease",e)?wu.UPDiseaseColor:S0("nonDisease",e)?wu.UPNonDiseaseColor:S0("uncertain",e)?wu.othersColor:S0("predicted",e)?wu.predictedColor:wu.othersColor;var NEe=Ji`
  protvista-tooltip a {
    text-decoration: underline;
    color: #fff;
  }
  .track-content {
    width: 80vw;
  }

  .nav-container,
  .category__track {
    display: flex;
    margin-bottom: 0.1rem;
  }

  .category {
    display: none;
    margin-bottom: 0.1rem;
  }

  .category-label,
  .track-label,
  .action-buttons,
  .credits {
    width: 20vw;
    padding: 0.5em;
  }

  .action-buttons {
    display: flex;
    justify-content: flex-end;
    align-items: flex-end;
  }

  .category-label {
    background-color: #b2f5ff;
    cursor: pointer;
  }

  .category-label::before {
    content: ' ';
    display: inline-block;
    width: 0;
    height: 0;
    border-top: 5px solid transparent;
    border-bottom: 5px solid transparent;
    border-left: 5px solid #333;
    margin-right: 5px;
    -webkit-transition: all 0.1s;
    /* Safari */
    -o-transition: all 0.1s;
    transition: all 0.1s;
  }

  .category-label.open::before {
    content: ' ';
    display: inline-block;
    width: 0;
    height: 0;
    border-left: 5px solid transparent;
    border-right: 5px solid transparent;
    border-top: 5px solid #333;
    margin-right: 5px;
  }

  .track-label {
    background-color: #d9faff;
  }

  protvista-track {
    border-top: 1px solid #d9faff;
  }

  .feature {
    cursor: pointer;
  }
`;const UEe=pH,zEe=hH,VEe=wH,HEe=RH,GEe=OH,$M=e7,QM=LEe,p5e=QN,h5e=FEe,qEe={"protvista-feature-adapter":UEe,"protvista-interpro-adapter":GEe,"protvista-proteomics-adapter":zEe,"protvista-structure-adapter":VEe,"protvista-variation-adapter":HEe};class v5e extends nl{constructor(){super();this.displayCoordinates={},this.openCategories=[],this.notooltip=!1,this.nostructure=!1,this.hasData=!1,this.loading=!0,this.data={},this.rawData={},this.displayCoordinates={},this.addStyles()}static get properties(){return{suspend:{type:Boolean,reflect:!0},accession:{type:String,reflect:!0},sequence:{type:String},data:{type:Object},openCategories:{type:Array},config:{type:Object},notooltip:{type:Boolean,reflect:!0},nostructure:{type:Boolean,reflect:!0}}}addStyles(){var t;const r=document.createElement("style");r.innerHTML=`${NEe.toString()} ${$N.toString()}`,(t=document.querySelector("head"))===null||t===void 0||t.append(r)}registerWebComponents(){ho("protvista-navigation",GV),ho("protvista-tooltip",qV),ho("protvista-track",Td),ho("protvista-interpro-track",Bh),ho("protvista-sequence",JV),ho("protvista-variation",__),ho("protvista-variation-graph",nH),ho("protvista-filter",aH),ho("protvista-manager",X0),ho("protvista-uniprot-structure",QN)}async _loadData(){const t=this.accession;if(t&&this.config){const r=this.config.categories.map(({tracks:a})=>a.map(({data:i})=>i[0].url)).flat(),n=[...new Set(r)];await Promise.all(n.map(a=>WD(a.replace("{accession}",t)).then(i=>{var o,s;this.rawData[a]=i.payload,!this.hasData&&((s=(o=i.payload)===null||o===void 0?void 0:o.features)===null||s===void 0?void 0:s.length)&&(this.hasData=!0)},i=>console.warn(i)).catch(i=>{console.log(i)}))),this.config.categories.map(({name:a,tracks:i,trackType:o})=>{const s=i.map(({data:u,name:l,filter:c})=>{const{url:d,adapter:f}=u[0],p=this.rawData[d]||[];if(!p||f==="protvista-variation-adapter"&&p.length===0)return;const h=f?qEe[f](p):p,v=Array.isArray(h)&&c?h.filter(({type:m})=>m===c):h;if(!!v)return this.data[`${a}-${l}`]=v,v});this.data[a]=o==="protvista-variation-graph"?s[0]:s.flat()})}this.loading=!1,this.requestUpdate()}async _loadDataInComponents(){await BV(),Object.entries(this.data).forEach(([t,r])=>{var n,a;const i=document.getElementById(`track-${t}`);i&&i.data!==r&&(i.data=r);const o=(n=this.config)===null||n===void 0?void 0:n.categories.find(({name:s})=>s===t);if(o&&o.tracks&&r&&(r.length>0||((a=r.variants)===null||a===void 0?void 0:a.length))){const s=document.getElementById(`category_${o.name}`);s&&(s.style.display="flex");for(const u of o.tracks){const l=document.getElementById(`track-${t}-${u.name}`);l&&(l.data=this.data[`${t}-${u.name}`])}}})}updated(t){super.updated(t);const r=this.querySelector("protvista-filter");r&&r.filters!==$M&&(r.filters=$M);const n=this.querySelector("protvista-variation");if(n&&n.colorConfig!==QM&&(n.colorConfig=QM),t.has("suspend")){if(this.suspend)return;this._init()}this._loadDataInComponents()}_init(){this.config||(this.config=BH),this.accession&&(this.loadEntry(this.accession).then(t=>{var r;this.sequence=t.sequence.sequence,this.displayCoordinates={start:1,end:(r=this.sequence)===null||r===void 0?void 0:r.length}}),this._loadData())}connectedCallback(){super.connectedCallback(),this.registerWebComponents(),this.suspend||this._init(),this.addEventListener("change",t=>{var r,n,a;!((r=t.detail)===null||r===void 0)&&r.displaystart&&(this.displayCoordinates.start=t.detail.displaystart),!((n=t.detail)===null||n===void 0)&&n.displayend&&(this.displayCoordinates.end=t.detail.displayend),this.notooltip||(!((a=t.detail)===null||a===void 0)&&a.eventtype?t.detail.eventtype==="click"&&this.updateTooltip(t):this._resetTooltip())}),this.notooltip||(this.addEventListener("click",t=>{const r=t.target;if(!r.closest(".feature")&&!r.closest("protvista-tooltip")){const n=this.querySelector("protvista-tooltip");n&&(n.visible=!1)}}),document.addEventListener("click",this._resetTooltip)),this.addEventListener("load",()=>{this.hasData||(this.dispatchEvent(new CustomEvent("protvista-event",{detail:{hasData:!0},bubbles:!0})),this.hasData=!0)})}disconnectedCallback(){this.notooltip||document.removeEventListener("click",this._resetTooltip)}_resetTooltip(t){var r;if(this&&(!t||!(!((r=t.target)===null||r===void 0)&&r.closest("protvista-uniprot")))){const n=this.querySelector("protvista-tooltip");n&&(n.visible=!1)}}async loadEntry(t){try{return await(await fetch(`https://www.ebi.ac.uk/proteins/api/proteins/${t}`)).json()}catch(r){console.error("Couldn't load UniProt entry",r)}}createRenderRoot(){return this}render(){var t,r;return!this.sequence||!this.config||this.suspend?zr``:this.loading?zr`<div class="protvista-loader">
        ${H0`${q0(YN)}`}
      </div>`:this.hasData?zr`
      <protvista-manager
        attributes="length displaystart displayend highlight activefilters filters"
        additionalsubscribers="protvista-structure"
      >
        <div class="nav-container">
          <div class="action-buttons">
            <download-panel
              accession="${this.accession}"
              config="${JSON.stringify(this.config.download)}"
            />
          </div>
          <div class="track-content">
            <protvista-navigation
              length="${this.sequence.length}"
            ></protvista-navigation>
            <protvista-sequence
              length="${this.sequence.length}"
              sequence="${this.sequence}"
              displaystart=${(t=this.displayCoordinates)===null||t===void 0?void 0:t.start}
              displayend="${(r=this.displayCoordinates)===null||r===void 0?void 0:r.end}"
            ></protvista-sequence>
          </div>
        </div>
        ${this.config.categories.map(n=>this.data[n.name]&&zr`
              <div class="category" id="category_${n.name}">
                <div
                  class="category-label"
                  data-category-toggle="${n.name}"
                  @click="${this.handleCategoryClick}"
                >
                  ${n.label}
                </div>

                <div
                  data-id="category_${n.name}"
                  class="aggregate-track-content track-content"
                  .style="${this.openCategories.includes(n.name)?"opacity:0":"opacity:1"}"
                >
                  ${this.data[n.name]&&this.getTrack(n.trackType,"non-overlapping",n.color,n.shape,n.name)}
                </div>
              </div>

              <!-- Expanded Categories -->
              ${n.tracks&&n.tracks.map(a=>{if(this.openCategories.includes(n.name)){const i=this.data[`${n.name}-${a.name}`];return i&&(Array.isArray(i)&&i.length||Object.keys(i).length)?zr`
                        <div class="category__track" id="track_${a.name}">
                          <div class="track-label" title="${a.tooltip}">
                            ${a.filterComponent?this.getFilterComponent(`${n.name}-${a.name}`):a.label}
                          </div>
                          <div
                            class="track-content"
                            data-id="track_${a.name}"
                          >
                            ${this.getTrack(a.trackType,"non-overlapping",a.color||n.color,a.shape||n.shape,`${n.name}-${a.name}`)}
                          </div>
                        </div>
                      `:""}})}
              ${n.tracks?"":this.data[n.name].map(a=>{if(this.openCategories.includes(n.name))return!a||!a.accession?"":zr`
                          <div
                            class="category__track"
                            id="track_${a.accession}"
                          >
                            <div class="track-label" title="${a.accession}">
                              ${a.accession}
                            </div>
                            <div
                              class="track-content"
                              data-id="track_${a.accession}"
                            >
                              ${this.getTrack(n.trackType,"non-overlapping",n.color,n.shape,`${n.name}-${a.accession}`)}
                            </div>
                          </div>
                        `})}
            `)}
        <div class="nav-container">
          <div class="credits"></div>
          <div class="track-content">
            <protvista-sequence
              length="${this.sequence.length}"
              sequence="${this.sequence}"
              displaystart=${this.displayCoordinates.start}
              displayend="${this.displayCoordinates.end}"
            ></protvista-sequence>
          </div>
        </div>
        ${this.nostructure?"":zr`
              <protvista-uniprot-structure
                accession="${this.accession||""}"
              ></protvista-uniprot-structure>
            `}
        <protvista-tooltip />
      </protvista-manager>
    `:zr`<div class="protvista-no-results">
        No feature data available for ${this.accession}
      </div>`}async updateTooltip(t){var r,n;const a=(r=t.detail)===null||r===void 0?void 0:r.feature;if(!a.tooltipContent)return;const i=this.querySelector("protvista-tooltip");if(!!i&&(i.title=`${a.type} ${a.start}-${a.end}`,i.innerHTML=a.tooltipContent,i.visible=!0,!((n=t.detail)===null||n===void 0)&&n.coords)){const[o,s]=t.detail.coords;i.x=o,i.y=s}}handleCategoryClick(t){const r=t.target,n=r.getAttribute("data-category-toggle");n&&!r.classList.contains("open")?(r.classList.add("open"),this.openCategories=[...this.openCategories,n]):(r.classList.remove("open"),this.openCategories=[...this.openCategories].filter(a=>a!==n))}getCategoryTypesAsString(t){return t.map(r=>r.filter).join(",")}getFilterComponent(t){return zr`
      <protvista-filter
        style="minWidth: 20%"
        for="track-${t}"
      ></protvista-filter>
    `}getTrack(t,r="",n="",a="",i=""){var o,s,u,l,c,d,f,p,h,v,m,g;switch(t){case"protvista-track":return zr`
          <protvista-track
            length="${(o=this.sequence)===null||o===void 0?void 0:o.length}"
            layout="${r}"
            color="${n}"
            shape="${a}"
            displaystart="${(s=this.displayCoordinates)===null||s===void 0?void 0:s.start}"
            displayend="${(u=this.displayCoordinates)===null||u===void 0?void 0:u.end}"
            id="track-${i}"
          >
          </protvista-track>
        `;case"protvista-interpro-track":return zr`
          <protvista-interpro-track
            length="${(l=this.sequence)===null||l===void 0?void 0:l.length}"
            color="${n}"
            shape="${a}"
            displaystart="${(c=this.displayCoordinates)===null||c===void 0?void 0:c.start}"
            displayend="${(d=this.displayCoordinates)===null||d===void 0?void 0:d.end}"
            id="track-${i}"
          >
          </protvista-interpro-track>
        `;case"protvista-variation":return zr`
          <protvista-variation
            length="${(f=this.sequence)===null||f===void 0?void 0:f.length}"
            displaystart="${(p=this.displayCoordinates)===null||p===void 0?void 0:p.start}"
            displayend="${(h=this.displayCoordinates)===null||h===void 0?void 0:h.end}"
            id="track-${i}"
          >
          </protvista-variation>
        `;case"protvista-variation-graph":return zr`
          <protvista-variation-graph
            length="${(v=this.sequence)===null||v===void 0?void 0:v.length}"
            displaystart="${(m=this.displayCoordinates)===null||m===void 0?void 0:m.start}"
            displayend="${(g=this.displayCoordinates)===null||g===void 0?void 0:g.end}"
            id="track-${i}"
          >
          </protvista-variation-graph>
        `;default:console.warn("No Matching ProtvistaTrack Found.");break}}}export{h5e as DownloadPanel,p5e as ProtvistaUniprotStructure,QM as colorConfig,v5e as default,$M as filterConfig,UEe as transformDataFeatureAdapter,GEe as transformDataInterproAdapter,zEe as transformDataProteomicsAdapter,VEe as transformDataStructureAdapter,HEe as transformDataVariationAdapter};
